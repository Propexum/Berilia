var K0e=Object.create;var GA=Object.defineProperty;var $0e=Object.getOwnPropertyDescriptor;var Q0e=Object.getOwnPropertyNames;var J0e=Object.getPrototypeOf,eye=Object.prototype.hasOwnProperty;var W=(e,t)=>()=>(e&&(t=e(e=0)),t);var rd=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),io=(e,t)=>{for(var r in t)GA(e,r,{get:t[r],enumerable:!0})},OU=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Q0e(t))!eye.call(e,o)&&o!==r&&GA(e,o,{get:()=>t[o],enumerable:!(n=$0e(t,o))||n.enumerable});return e};var In=(e,t,r)=>(r=e!=null?K0e(J0e(e)):{},OU(t||!e||!e.__esModule?GA(r,"default",{value:e,enumerable:!0}):r,e)),vl=e=>OU(GA({},"__esModule",{value:!0}),e);var xq=rd((wQe,DS)=>{(function(e,t,r,n){"use strict";var o=["","webkit","Moz","MS","ms","o"],i=t.createElement("div"),s="function",a=Math.round,u=Math.abs,h=Date.now;function p(Me,Pe,Ke){return setTimeout(V(Me,Ke),Pe)}function _(Me,Pe,Ke){return Array.isArray(Me)?(y(Me,Ke[Pe],Ke),!0):!1}function y(Me,Pe,Ke){var bt;if(Me)if(Me.forEach)Me.forEach(Pe,Ke);else if(Me.length!==n)for(bt=0;bt<Me.length;)Pe.call(Ke,Me[bt],bt,Me),bt++;else for(bt in Me)Me.hasOwnProperty(bt)&&Pe.call(Ke,Me[bt],bt,Me)}function A(Me,Pe,Ke){var bt="DEPRECATED METHOD: "+Pe+`
`+Ke+` AT 
`;return function(){var Ft=new Error("get-stack-trace"),Xt=Ft&&Ft.stack?Ft.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",hn=e.console&&(e.console.warn||e.console.log);return hn&&hn.call(e.console,bt,Xt),Me.apply(this,arguments)}}var E;typeof Object.assign!="function"?E=function(Pe){if(Pe===n||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(Pe),bt=1;bt<arguments.length;bt++){var Ft=arguments[bt];if(Ft!==n&&Ft!==null)for(var Xt in Ft)Ft.hasOwnProperty(Xt)&&(Ke[Xt]=Ft[Xt])}return Ke}:E=Object.assign;var k=A(function(Pe,Ke,bt){for(var Ft=Object.keys(Ke),Xt=0;Xt<Ft.length;)(!bt||bt&&Pe[Ft[Xt]]===n)&&(Pe[Ft[Xt]]=Ke[Ft[Xt]]),Xt++;return Pe},"extend","Use `assign`."),P=A(function(Pe,Ke){return k(Pe,Ke,!0)},"merge","Use `assign`.");function R(Me,Pe,Ke){var bt=Pe.prototype,Ft;Ft=Me.prototype=Object.create(bt),Ft.constructor=Me,Ft._super=bt,Ke&&E(Ft,Ke)}function V(Me,Pe){return function(){return Me.apply(Pe,arguments)}}function N(Me,Pe){return typeof Me==s?Me.apply(Pe&&Pe[0]||n,Pe):Me}function j(Me,Pe){return Me===n?Pe:Me}function J(Me,Pe,Ke){y(ye(Pe),function(bt){Me.addEventListener(bt,Ke,!1)})}function ne(Me,Pe,Ke){y(ye(Pe),function(bt){Me.removeEventListener(bt,Ke,!1)})}function de(Me,Pe){for(;Me;){if(Me==Pe)return!0;Me=Me.parentNode}return!1}function fe(Me,Pe){return Me.indexOf(Pe)>-1}function ye(Me){return Me.trim().split(/\s+/g)}function ve(Me,Pe,Ke){if(Me.indexOf&&!Ke)return Me.indexOf(Pe);for(var bt=0;bt<Me.length;){if(Ke&&Me[bt][Ke]==Pe||!Ke&&Me[bt]===Pe)return bt;bt++}return-1}function be(Me){return Array.prototype.slice.call(Me,0)}function je(Me,Pe,Ke){for(var bt=[],Ft=[],Xt=0;Xt<Me.length;){var hn=Pe?Me[Xt][Pe]:Me[Xt];ve(Ft,hn)<0&&bt.push(Me[Xt]),Ft[Xt]=hn,Xt++}return Ke&&(Pe?bt=bt.sort(function(Wn,Kn){return Wn[Pe]>Kn[Pe]}):bt=bt.sort()),bt}function Re(Me,Pe){for(var Ke,bt,Ft=Pe[0].toUpperCase()+Pe.slice(1),Xt=0;Xt<o.length;){if(Ke=o[Xt],bt=Ke?Ke+Ft:Pe,bt in Me)return bt;Xt++}return n}var Se=1;function Ue(){return Se++}function qe(Me){var Pe=Me.ownerDocument||Me;return Pe.defaultView||Pe.parentWindow||e}var Je=/mobile|tablet|ip(ad|hone|od)|android/i,gt="ontouchstart"in e,rt=Re(e,"PointerEvent")!==n,At=gt&&Je.test(navigator.userAgent),St="touch",kt="pen",yt="mouse",tr="kinect",vr=25,wr=1,Ir=2,Br=4,qt=8,Lr=1,Yr=2,Rt=4,bn=8,tn=16,sr=Yr|Rt,Rn=bn|tn,dr=sr|Rn,xt=["x","y"],ei=["clientX","clientY"];function Hr(Me,Pe){var Ke=this;this.manager=Me,this.callback=Pe,this.element=Me.element,this.target=Me.options.inputTarget,this.domHandler=function(bt){N(Me.options.enable,[Me])&&Ke.handler(bt)},this.init()}Hr.prototype={handler:function(){},init:function(){this.evEl&&J(this.element,this.evEl,this.domHandler),this.evTarget&&J(this.target,this.evTarget,this.domHandler),this.evWin&&J(qe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ne(this.element,this.evEl,this.domHandler),this.evTarget&&ne(this.target,this.evTarget,this.domHandler),this.evWin&&ne(qe(this.element),this.evWin,this.domHandler)}};function Pn(Me){var Pe,Ke=Me.options.inputClass;return Ke?Pe=Ke:rt?Pe=Oe:At?Pe=Q:gt?Pe=Ee:Pe=cr,new Pe(Me,gn)}function gn(Me,Pe,Ke){var bt=Ke.pointers.length,Ft=Ke.changedPointers.length,Xt=Pe&wr&&bt-Ft===0,hn=Pe&(Br|qt)&&bt-Ft===0;Ke.isFirst=!!Xt,Ke.isFinal=!!hn,Xt&&(Me.session={}),Ke.eventType=Pe,No(Me,Ke),Me.emit("hammer.input",Ke),Me.recognize(Ke),Me.session.prevInput=Ke}function No(Me,Pe){var Ke=Me.session,bt=Pe.pointers,Ft=bt.length;Ke.firstInput||(Ke.firstInput=ba(Pe)),Ft>1&&!Ke.firstMultiple?Ke.firstMultiple=ba(Pe):Ft===1&&(Ke.firstMultiple=!1);var Xt=Ke.firstInput,hn=Ke.firstMultiple,_n=hn?hn.center:Xt.center,Wn=Pe.center=vs(bt);Pe.timeStamp=h(),Pe.deltaTime=Pe.timeStamp-Xt.timeStamp,Pe.angle=eo(_n,Wn),Pe.distance=Zt(_n,Wn),bs(Ke,Pe),Pe.offsetDirection=Do(Pe.deltaX,Pe.deltaY);var Kn=zo(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=Kn.x,Pe.overallVelocityY=Kn.y,Pe.overallVelocity=u(Kn.x)>u(Kn.y)?Kn.x:Kn.y,Pe.scale=hn?ws(hn.pointers,bt):1,Pe.rotation=hn?Xn(hn.pointers,bt):0,Pe.maxPointers=Ke.prevInput?Pe.pointers.length>Ke.prevInput.maxPointers?Pe.pointers.length:Ke.prevInput.maxPointers:Pe.pointers.length,qo(Ke,Pe);var Qr=Me.element;de(Pe.srcEvent.target,Qr)&&(Qr=Pe.srcEvent.target),Pe.target=Qr}function bs(Me,Pe){var Ke=Pe.center,bt=Me.offsetDelta||{},Ft=Me.prevDelta||{},Xt=Me.prevInput||{};(Pe.eventType===wr||Xt.eventType===Br)&&(Ft=Me.prevDelta={x:Xt.deltaX||0,y:Xt.deltaY||0},bt=Me.offsetDelta={x:Ke.x,y:Ke.y}),Pe.deltaX=Ft.x+(Ke.x-bt.x),Pe.deltaY=Ft.y+(Ke.y-bt.y)}function qo(Me,Pe){var Ke=Me.lastInterval||Pe,bt=Pe.timeStamp-Ke.timeStamp,Ft,Xt,hn,_n;if(Pe.eventType!=qt&&(bt>vr||Ke.velocity===n)){var Wn=Pe.deltaX-Ke.deltaX,Kn=Pe.deltaY-Ke.deltaY,Qr=zo(bt,Wn,Kn);Xt=Qr.x,hn=Qr.y,Ft=u(Qr.x)>u(Qr.y)?Qr.x:Qr.y,_n=Do(Wn,Kn),Me.lastInterval=Pe}else Ft=Ke.velocity,Xt=Ke.velocityX,hn=Ke.velocityY,_n=Ke.direction;Pe.velocity=Ft,Pe.velocityX=Xt,Pe.velocityY=hn,Pe.direction=_n}function ba(Me){for(var Pe=[],Ke=0;Ke<Me.pointers.length;)Pe[Ke]={clientX:a(Me.pointers[Ke].clientX),clientY:a(Me.pointers[Ke].clientY)},Ke++;return{timeStamp:h(),pointers:Pe,center:vs(Pe),deltaX:Me.deltaX,deltaY:Me.deltaY}}function vs(Me){var Pe=Me.length;if(Pe===1)return{x:a(Me[0].clientX),y:a(Me[0].clientY)};for(var Ke=0,bt=0,Ft=0;Ft<Pe;)Ke+=Me[Ft].clientX,bt+=Me[Ft].clientY,Ft++;return{x:a(Ke/Pe),y:a(bt/Pe)}}function zo(Me,Pe,Ke){return{x:Pe/Me||0,y:Ke/Me||0}}function Do(Me,Pe){return Me===Pe?Lr:u(Me)>=u(Pe)?Me<0?Yr:Rt:Pe<0?bn:tn}function Zt(Me,Pe,Ke){Ke||(Ke=xt);var bt=Pe[Ke[0]]-Me[Ke[0]],Ft=Pe[Ke[1]]-Me[Ke[1]];return Math.sqrt(bt*bt+Ft*Ft)}function eo(Me,Pe,Ke){Ke||(Ke=xt);var bt=Pe[Ke[0]]-Me[Ke[0]],Ft=Pe[Ke[1]]-Me[Ke[1]];return Math.atan2(Ft,bt)*180/Math.PI}function Xn(Me,Pe){return eo(Pe[1],Pe[0],ei)+eo(Me[1],Me[0],ei)}function ws(Me,Pe){return Zt(Pe[0],Pe[1],ei)/Zt(Me[0],Me[1],ei)}var wo={mousedown:wr,mousemove:Ir,mouseup:Br},Ht="mousedown",$r="mousemove mouseup";function cr(){this.evEl=Ht,this.evWin=$r,this.pressed=!1,Hr.apply(this,arguments)}R(cr,Hr,{handler:function(Pe){var Ke=wo[Pe.type];Ke&wr&&Pe.button===0&&(this.pressed=!0),Ke&Ir&&Pe.which!==1&&(Ke=Br),this.pressed&&(Ke&Br&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[Pe],changedPointers:[Pe],pointerType:yt,srcEvent:Pe}))}});var ji={pointerdown:wr,pointermove:Ir,pointerup:Br,pointercancel:qt,pointerout:qt},to={2:St,3:kt,4:yt,5:tr},zr="pointerdown",Ao="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(zr="MSPointerDown",Ao="MSPointerMove MSPointerUp MSPointerCancel");function Oe(){this.evEl=zr,this.evWin=Ao,Hr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}R(Oe,Hr,{handler:function(Pe){var Ke=this.store,bt=!1,Ft=Pe.type.toLowerCase().replace("ms",""),Xt=ji[Ft],hn=to[Pe.pointerType]||Pe.pointerType,_n=hn==St,Wn=ve(Ke,Pe.pointerId,"pointerId");Xt&wr&&(Pe.button===0||_n)?Wn<0&&(Ke.push(Pe),Wn=Ke.length-1):Xt&(Br|qt)&&(bt=!0),!(Wn<0)&&(Ke[Wn]=Pe,this.callback(this.manager,Xt,{pointers:Ke,changedPointers:[Pe],pointerType:hn,srcEvent:Pe}),bt&&Ke.splice(Wn,1))}});var ue={touchstart:wr,touchmove:Ir,touchend:Br,touchcancel:qt},ge="touchstart",ke="touchstart touchmove touchend touchcancel";function Ve(){this.evTarget=ge,this.evWin=ke,this.started=!1,Hr.apply(this,arguments)}R(Ve,Hr,{handler:function(Pe){var Ke=ue[Pe.type];if(Ke===wr&&(this.started=!0),!!this.started){var bt=We.call(this,Pe,Ke);Ke&(Br|qt)&&bt[0].length-bt[1].length===0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:bt[0],changedPointers:bt[1],pointerType:St,srcEvent:Pe})}}});function We(Me,Pe){var Ke=be(Me.touches),bt=be(Me.changedTouches);return Pe&(Br|qt)&&(Ke=je(Ke.concat(bt),"identifier",!0)),[Ke,bt]}var G={touchstart:wr,touchmove:Ir,touchend:Br,touchcancel:qt},te="touchstart touchmove touchend touchcancel";function Q(){this.evTarget=te,this.targetIds={},Hr.apply(this,arguments)}R(Q,Hr,{handler:function(Pe){var Ke=G[Pe.type],bt=ae.call(this,Pe,Ke);bt&&this.callback(this.manager,Ke,{pointers:bt[0],changedPointers:bt[1],pointerType:St,srcEvent:Pe})}});function ae(Me,Pe){var Ke=be(Me.touches),bt=this.targetIds;if(Pe&(wr|Ir)&&Ke.length===1)return bt[Ke[0].identifier]=!0,[Ke,Ke];var Ft,Xt,hn=be(Me.changedTouches),_n=[],Wn=this.target;if(Xt=Ke.filter(function(Kn){return de(Kn.target,Wn)}),Pe===wr)for(Ft=0;Ft<Xt.length;)bt[Xt[Ft].identifier]=!0,Ft++;for(Ft=0;Ft<hn.length;)bt[hn[Ft].identifier]&&_n.push(hn[Ft]),Pe&(Br|qt)&&delete bt[hn[Ft].identifier],Ft++;if(_n.length)return[je(Xt.concat(_n),"identifier",!0),_n]}var he=2500,we=25;function Ee(){Hr.apply(this,arguments);var Me=V(this.handler,this);this.touch=new Q(this.manager,Me),this.mouse=new cr(this.manager,Me),this.primaryTouch=null,this.lastTouches=[]}R(Ee,Hr,{handler:function(Pe,Ke,bt){var Ft=bt.pointerType==St,Xt=bt.pointerType==yt;if(!(Xt&&bt.sourceCapabilities&&bt.sourceCapabilities.firesTouchEvents)){if(Ft)Xe.call(this,Ke,bt);else if(Xt&&mt.call(this,bt))return;this.callback(Pe,Ke,bt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Xe(Me,Pe){Me&wr?(this.primaryTouch=Pe.changedPointers[0].identifier,ut.call(this,Pe)):Me&(Br|qt)&&ut.call(this,Pe)}function ut(Me){var Pe=Me.changedPointers[0];if(Pe.identifier===this.primaryTouch){var Ke={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(Ke);var bt=this.lastTouches,Ft=function(){var Xt=bt.indexOf(Ke);Xt>-1&&bt.splice(Xt,1)};setTimeout(Ft,he)}}function mt(Me){for(var Pe=Me.srcEvent.clientX,Ke=Me.srcEvent.clientY,bt=0;bt<this.lastTouches.length;bt++){var Ft=this.lastTouches[bt],Xt=Math.abs(Pe-Ft.x),hn=Math.abs(Ke-Ft.y);if(Xt<=we&&hn<=we)return!0}return!1}var Tt=Re(i.style,"touchAction"),jt=Tt!==n,Et="compute",Ct="auto",Dt="manipulation",Lt="none",xr="pan-x",Sr="pan-y",ln=rn();function pr(Me,Pe){this.manager=Me,this.set(Pe)}pr.prototype={set:function(Me){Me==Et&&(Me=this.compute()),jt&&this.manager.element.style&&ln[Me]&&(this.manager.element.style[Tt]=Me),this.actions=Me.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Me=[];return y(this.manager.recognizers,function(Pe){N(Pe.options.enable,[Pe])&&(Me=Me.concat(Pe.getTouchAction()))}),un(Me.join(" "))},preventDefaults:function(Me){var Pe=Me.srcEvent,Ke=Me.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var bt=this.actions,Ft=fe(bt,Lt)&&!ln[Lt],Xt=fe(bt,Sr)&&!ln[Sr],hn=fe(bt,xr)&&!ln[xr];if(Ft){var _n=Me.pointers.length===1,Wn=Me.distance<2,Kn=Me.deltaTime<250;if(_n&&Wn&&Kn)return}if(!(hn&&Xt)&&(Ft||Xt&&Ke&sr||hn&&Ke&Rn))return this.preventSrc(Pe)},preventSrc:function(Me){this.manager.session.prevented=!0,Me.preventDefault()}};function un(Me){if(fe(Me,Lt))return Lt;var Pe=fe(Me,xr),Ke=fe(Me,Sr);return Pe&&Ke?Lt:Pe||Ke?Pe?xr:Sr:fe(Me,Dt)?Dt:Ct}function rn(){if(!jt)return!1;var Me={},Pe=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){Me[Ke]=Pe?e.CSS.supports("touch-action",Ke):!0}),Me}var en=1,Xr=2,di=4,It=8,fr=It,Ur=16,kr=32;function Pr(Me){this.options=E({},this.defaults,Me||{}),this.id=Ue(),this.manager=null,this.options.enable=j(this.options.enable,!0),this.state=en,this.simultaneous={},this.requireFail=[]}Pr.prototype={defaults:{},set:function(Me){return E(this.options,Me),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Me){if(_(Me,"recognizeWith",this))return this;var Pe=this.simultaneous;return Me=qr(Me,this),Pe[Me.id]||(Pe[Me.id]=Me,Me.recognizeWith(this)),this},dropRecognizeWith:function(Me){return _(Me,"dropRecognizeWith",this)?this:(Me=qr(Me,this),delete this.simultaneous[Me.id],this)},requireFailure:function(Me){if(_(Me,"requireFailure",this))return this;var Pe=this.requireFail;return Me=qr(Me,this),ve(Pe,Me)===-1&&(Pe.push(Me),Me.requireFailure(this)),this},dropRequireFailure:function(Me){if(_(Me,"dropRequireFailure",this))return this;Me=qr(Me,this);var Pe=ve(this.requireFail,Me);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Me){return!!this.simultaneous[Me.id]},emit:function(Me){var Pe=this,Ke=this.state;function bt(Ft){Pe.manager.emit(Ft,Me)}Ke<It&&bt(Pe.options.event+xn(Ke)),bt(Pe.options.event),Me.additionalEvent&&bt(Me.additionalEvent),Ke>=It&&bt(Pe.options.event+xn(Ke))},tryEmit:function(Me){if(this.canEmit())return this.emit(Me);this.state=kr},canEmit:function(){for(var Me=0;Me<this.requireFail.length;){if(!(this.requireFail[Me].state&(kr|en)))return!1;Me++}return!0},recognize:function(Me){var Pe=E({},Me);if(!N(this.options.enable,[this,Pe])){this.reset(),this.state=kr;return}this.state&(fr|Ur|kr)&&(this.state=en),this.state=this.process(Pe),this.state&(Xr|di|It|Ur)&&this.tryEmit(Pe)},process:function(Me){},getTouchAction:function(){},reset:function(){}};function xn(Me){return Me&Ur?"cancel":Me&It?"end":Me&di?"move":Me&Xr?"start":""}function on(Me){return Me==tn?"down":Me==bn?"up":Me==Yr?"left":Me==Rt?"right":""}function qr(Me,Pe){var Ke=Pe.manager;return Ke?Ke.get(Me):Me}function Nn(){Pr.apply(this,arguments)}R(Nn,Pr,{defaults:{pointers:1},attrTest:function(Me){var Pe=this.options.pointers;return Pe===0||Me.pointers.length===Pe},process:function(Me){var Pe=this.state,Ke=Me.eventType,bt=Pe&(Xr|di),Ft=this.attrTest(Me);return bt&&(Ke&qt||!Ft)?Pe|Ur:bt||Ft?Ke&Br?Pe|It:Pe&Xr?Pe|di:Xr:kr}});function sn(){Nn.apply(this,arguments),this.pX=null,this.pY=null}R(sn,Nn,{defaults:{event:"pan",threshold:10,pointers:1,direction:dr},getTouchAction:function(){var Me=this.options.direction,Pe=[];return Me&sr&&Pe.push(Sr),Me&Rn&&Pe.push(xr),Pe},directionTest:function(Me){var Pe=this.options,Ke=!0,bt=Me.distance,Ft=Me.direction,Xt=Me.deltaX,hn=Me.deltaY;return Ft&Pe.direction||(Pe.direction&sr?(Ft=Xt===0?Lr:Xt<0?Yr:Rt,Ke=Xt!=this.pX,bt=Math.abs(Me.deltaX)):(Ft=hn===0?Lr:hn<0?bn:tn,Ke=hn!=this.pY,bt=Math.abs(Me.deltaY))),Me.direction=Ft,Ke&&bt>Pe.threshold&&Ft&Pe.direction},attrTest:function(Me){return Nn.prototype.attrTest.call(this,Me)&&(this.state&Xr||!(this.state&Xr)&&this.directionTest(Me))},emit:function(Me){this.pX=Me.deltaX,this.pY=Me.deltaY;var Pe=on(Me.direction);Pe&&(Me.additionalEvent=this.options.event+Pe),this._super.emit.call(this,Me)}});function fn(){Nn.apply(this,arguments)}R(fn,Nn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(Me){return this._super.attrTest.call(this,Me)&&(Math.abs(Me.scale-1)>this.options.threshold||this.state&Xr)},emit:function(Me){if(Me.scale!==1){var Pe=Me.scale<1?"in":"out";Me.additionalEvent=this.options.event+Pe}this._super.emit.call(this,Me)}});function Kr(){Pr.apply(this,arguments),this._timer=null,this._input=null}R(Kr,Pr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ct]},process:function(Me){var Pe=this.options,Ke=Me.pointers.length===Pe.pointers,bt=Me.distance<Pe.threshold,Ft=Me.deltaTime>Pe.time;if(this._input=Me,!bt||!Ke||Me.eventType&(Br|qt)&&!Ft)this.reset();else if(Me.eventType&wr)this.reset(),this._timer=p(function(){this.state=fr,this.tryEmit()},Pe.time,this);else if(Me.eventType&Br)return fr;return kr},reset:function(){clearTimeout(this._timer)},emit:function(Me){this.state===fr&&(Me&&Me.eventType&Br?this.manager.emit(this.options.event+"up",Me):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}});function lo(){Nn.apply(this,arguments)}R(lo,Nn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(Me){return this._super.attrTest.call(this,Me)&&(Math.abs(Me.rotation)>this.options.threshold||this.state&Xr)}});function Bn(){Nn.apply(this,arguments)}R(Bn,Nn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:sr|Rn,pointers:1},getTouchAction:function(){return sn.prototype.getTouchAction.call(this)},attrTest:function(Me){var Pe=this.options.direction,Ke;return Pe&(sr|Rn)?Ke=Me.overallVelocity:Pe&sr?Ke=Me.overallVelocityX:Pe&Rn&&(Ke=Me.overallVelocityY),this._super.attrTest.call(this,Me)&&Pe&Me.offsetDirection&&Me.distance>this.options.threshold&&Me.maxPointers==this.options.pointers&&u(Ke)>this.options.velocity&&Me.eventType&Br},emit:function(Me){var Pe=on(Me.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,Me),this.manager.emit(this.options.event,Me)}});function vn(){Pr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}R(vn,Pr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Dt]},process:function(Me){var Pe=this.options,Ke=Me.pointers.length===Pe.pointers,bt=Me.distance<Pe.threshold,Ft=Me.deltaTime<Pe.time;if(this.reset(),Me.eventType&wr&&this.count===0)return this.failTimeout();if(bt&&Ft&&Ke){if(Me.eventType!=Br)return this.failTimeout();var Xt=this.pTime?Me.timeStamp-this.pTime<Pe.interval:!0,hn=!this.pCenter||Zt(this.pCenter,Me.center)<Pe.posThreshold;this.pTime=Me.timeStamp,this.pCenter=Me.center,!hn||!Xt?this.count=1:this.count+=1,this._input=Me;var _n=this.count%Pe.taps;if(_n===0)return this.hasRequireFailures()?(this._timer=p(function(){this.state=fr,this.tryEmit()},Pe.interval,this),Xr):fr}return kr},failTimeout:function(){return this._timer=p(function(){this.state=kr},this.options.interval,this),kr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==fr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Vn(Me,Pe){return Pe=Pe||{},Pe.recognizers=j(Pe.recognizers,Vn.defaults.preset),new Ui(Me,Pe)}Vn.VERSION="2.0.7",Vn.defaults={domEvents:!1,touchAction:Et,enable:!0,inputTarget:null,inputClass:null,preset:[[lo,{enable:!1}],[fn,{enable:!1},["rotate"]],[Bn,{direction:sr}],[sn,{direction:sr},["swipe"]],[vn],[vn,{event:"doubletap",taps:2},["tap"]],[Kr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Lo=1,Ai=2;function Ui(Me,Pe){this.options=E({},Vn.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||Me,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Me,this.input=Pn(this),this.touchAction=new pr(this,this.options.touchAction),As(this,!0),y(this.options.recognizers,function(Ke){var bt=this.add(new Ke[0](Ke[1]));Ke[2]&&bt.recognizeWith(Ke[2]),Ke[3]&&bt.requireFailure(Ke[3])},this)}Ui.prototype={set:function(Me){return E(this.options,Me),Me.touchAction&&this.touchAction.update(),Me.inputTarget&&(this.input.destroy(),this.input.target=Me.inputTarget,this.input.init()),this},stop:function(Me){this.session.stopped=Me?Ai:Lo},recognize:function(Me){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(Me);var Ke,bt=this.recognizers,Ft=Pe.curRecognizer;(!Ft||Ft&&Ft.state&fr)&&(Ft=Pe.curRecognizer=null);for(var Xt=0;Xt<bt.length;)Ke=bt[Xt],Pe.stopped!==Ai&&(!Ft||Ke==Ft||Ke.canRecognizeWith(Ft))?Ke.recognize(Me):Ke.reset(),!Ft&&Ke.state&(Xr|di|It)&&(Ft=Pe.curRecognizer=Ke),Xt++}},get:function(Me){if(Me instanceof Pr)return Me;for(var Pe=this.recognizers,Ke=0;Ke<Pe.length;Ke++)if(Pe[Ke].options.event==Me)return Pe[Ke];return null},add:function(Me){if(_(Me,"add",this))return this;var Pe=this.get(Me.options.event);return Pe&&this.remove(Pe),this.recognizers.push(Me),Me.manager=this,this.touchAction.update(),Me},remove:function(Me){if(_(Me,"remove",this))return this;if(Me=this.get(Me),Me){var Pe=this.recognizers,Ke=ve(Pe,Me);Ke!==-1&&(Pe.splice(Ke,1),this.touchAction.update())}return this},on:function(Me,Pe){if(Me!==n&&Pe!==n){var Ke=this.handlers;return y(ye(Me),function(bt){Ke[bt]=Ke[bt]||[],Ke[bt].push(Pe)}),this}},off:function(Me,Pe){if(Me!==n){var Ke=this.handlers;return y(ye(Me),function(bt){Pe?Ke[bt]&&Ke[bt].splice(ve(Ke[bt],Pe),1):delete Ke[bt]}),this}},emit:function(Me,Pe){this.options.domEvents&&Ms(Me,Pe);var Ke=this.handlers[Me]&&this.handlers[Me].slice();if(!(!Ke||!Ke.length)){Pe.type=Me,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var bt=0;bt<Ke.length;)Ke[bt](Pe),bt++}},destroy:function(){this.element&&As(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function As(Me,Pe){var Ke=Me.element;if(Ke.style){var bt;y(Me.options.cssProps,function(Ft,Xt){bt=Re(Ke.style,Xt),Pe?(Me.oldCssProps[bt]=Ke.style[bt],Ke.style[bt]=Ft):Ke.style[bt]=Me.oldCssProps[bt]||""}),Pe||(Me.oldCssProps={})}}function Ms(Me,Pe){var Ke=t.createEvent("Event");Ke.initEvent(Me,!0,!0),Ke.gesture=Pe,Pe.target.dispatchEvent(Ke)}E(Vn,{INPUT_START:wr,INPUT_MOVE:Ir,INPUT_END:Br,INPUT_CANCEL:qt,STATE_POSSIBLE:en,STATE_BEGAN:Xr,STATE_CHANGED:di,STATE_ENDED:It,STATE_RECOGNIZED:fr,STATE_CANCELLED:Ur,STATE_FAILED:kr,DIRECTION_NONE:Lr,DIRECTION_LEFT:Yr,DIRECTION_RIGHT:Rt,DIRECTION_UP:bn,DIRECTION_DOWN:tn,DIRECTION_HORIZONTAL:sr,DIRECTION_VERTICAL:Rn,DIRECTION_ALL:dr,Manager:Ui,Input:Hr,TouchAction:pr,TouchInput:Q,MouseInput:cr,PointerEventInput:Oe,TouchMouseInput:Ee,SingleTouchInput:Ve,Recognizer:Pr,AttrRecognizer:Nn,Tap:vn,Pan:sn,Swipe:Bn,Pinch:fn,Rotate:lo,Press:Kr,on:J,off:ne,each:y,merge:P,extend:k,assign:E,inherit:R,bindFn:V,prefixed:Re});var Ss=typeof e<"u"?e:typeof self<"u"?self:{};Ss.Hammer=Vn,typeof define=="function"&&define.amd?define(function(){return Vn}):typeof DS<"u"&&DS.exports?DS.exports=Vn:e[r]=Vn})(window,document,"Hammer")});var $G=rd((Mnt,Q6)=>{"use strict";Q6.exports=iT;Q6.exports.default=iT;function iT(e,t,r){r=r||2;var n=t&&t.length,o=n?t[0]*r:e.length,i=HG(e,0,o,r,!0),s=[];if(!i||i.next===i.prev)return s;var a,u,h,p,_,y,A;if(n&&(i=STe(e,t,i,r)),e.length>80*r){a=h=e[0],u=p=e[1];for(var E=r;E<o;E+=r)_=e[E],y=e[E+1],_<a&&(a=_),y<u&&(u=y),_>h&&(h=_),y>p&&(p=y);A=Math.max(h-a,p-u),A=A!==0?32767/A:0}return Qv(i,s,r,a,u,A,0),s}function HG(e,t,r,n,o){var i,s;if(o===$6(e,t,r,n)>0)for(i=t;i<r;i+=n)s=GG(i,e[i],e[i+1],s);else for(i=r-n;i>=t;i-=n)s=GG(i,e[i],e[i+1],s);return s&&oT(s,s.next)&&(e1(s),s=s.next),s}function tg(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(oT(r,r.next)||Ki(r.prev,r,r.next)===0)){if(e1(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function Qv(e,t,r,n,o,i,s){if(e){!s&&i&&kTe(e,n,o,i);for(var a=e,u,h;e.prev!==e.next;){if(u=e.prev,h=e.next,i?wTe(e,n,o,i):vTe(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(h.i/r|0),e1(e),e=h.next,a=h.next;continue}if(e=h,e===a){s?s===1?(e=ATe(tg(e),t,r),Qv(e,t,r,n,o,i,2)):s===2&&MTe(e,t,r,n,o,i):Qv(tg(e),t,r,n,o,i,1);break}}}}function vTe(e){var t=e.prev,r=e,n=e.next;if(Ki(t,r,n)>=0)return!1;for(var o=t.x,i=r.x,s=n.x,a=t.y,u=r.y,h=n.y,p=o<i?o<s?o:s:i<s?i:s,_=a<u?a<h?a:h:u<h?u:h,y=o>i?o>s?o:s:i>s?i:s,A=a>u?a>h?a:h:u>h?u:h,E=n.next;E!==t;){if(E.x>=p&&E.x<=y&&E.y>=_&&E.y<=A&&k0(o,a,i,u,s,h,E.x,E.y)&&Ki(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function wTe(e,t,r,n){var o=e.prev,i=e,s=e.next;if(Ki(o,i,s)>=0)return!1;for(var a=o.x,u=i.x,h=s.x,p=o.y,_=i.y,y=s.y,A=a<u?a<h?a:h:u<h?u:h,E=p<_?p<y?p:y:_<y?_:y,k=a>u?a>h?a:h:u>h?u:h,P=p>_?p>y?p:y:_>y?_:y,R=X6(A,E,t,r,n),V=X6(k,P,t,r,n),N=e.prevZ,j=e.nextZ;N&&N.z>=R&&j&&j.z<=V;){if(N.x>=A&&N.x<=k&&N.y>=E&&N.y<=P&&N!==o&&N!==s&&k0(a,p,u,_,h,y,N.x,N.y)&&Ki(N.prev,N,N.next)>=0||(N=N.prevZ,j.x>=A&&j.x<=k&&j.y>=E&&j.y<=P&&j!==o&&j!==s&&k0(a,p,u,_,h,y,j.x,j.y)&&Ki(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;N&&N.z>=R;){if(N.x>=A&&N.x<=k&&N.y>=E&&N.y<=P&&N!==o&&N!==s&&k0(a,p,u,_,h,y,N.x,N.y)&&Ki(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;j&&j.z<=V;){if(j.x>=A&&j.x<=k&&j.y>=E&&j.y<=P&&j!==o&&j!==s&&k0(a,p,u,_,h,y,j.x,j.y)&&Ki(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function ATe(e,t,r){var n=e;do{var o=n.prev,i=n.next.next;!oT(o,i)&&XG(o,n,n.next,i)&&Jv(o,i)&&Jv(i,o)&&(t.push(o.i/r|0),t.push(n.i/r|0),t.push(i.i/r|0),e1(n),e1(n.next),n=e=i),n=n.next}while(n!==e);return tg(n)}function MTe(e,t,r,n,o,i){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&RTe(s,a)){var u=KG(s,a);s=tg(s,s.next),u=tg(u,u.next),Qv(s,t,r,n,o,i,0),Qv(u,t,r,n,o,i,0);return}a=a.next}s=s.next}while(s!==e)}function STe(e,t,r,n){var o=[],i,s,a,u,h;for(i=0,s=t.length;i<s;i++)a=t[i]*n,u=i<s-1?t[i+1]*n:e.length,h=HG(e,a,u,n,!1),h===h.next&&(h.steiner=!0),o.push(OTe(h));for(o.sort(TTe),i=0;i<o.length;i++)r=ETe(o[i],r);return r}function TTe(e,t){return e.x-t.x}function ETe(e,t){var r=ITe(e,t);if(!r)return t;var n=KG(r,e);return tg(n,n.next),tg(r,r.next)}function ITe(e,t){var r=t,n=e.x,o=e.y,i=-1/0,s;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>i&&(i=a,s=r.x<r.next.x?r:r.next,a===n))return s}r=r.next}while(r!==t);if(!s)return null;var u=s,h=s.x,p=s.y,_=1/0,y;r=s;do n>=r.x&&r.x>=h&&n!==r.x&&k0(o<p?n:i,o,h,p,o<p?i:n,o,r.x,r.y)&&(y=Math.abs(o-r.y)/(n-r.x),Jv(r,e)&&(y<_||y===_&&(r.x>s.x||r.x===s.x&&CTe(s,r)))&&(s=r,_=y)),r=r.next;while(r!==u);return s}function CTe(e,t){return Ki(e.prev,e,t.prev)<0&&Ki(t.next,e,e.next)<0}function kTe(e,t,r,n){var o=e;do o.z===0&&(o.z=X6(o.x,o.y,t,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,PTe(o)}function PTe(e){var t,r,n,o,i,s,a,u,h=1;do{for(r=e,e=null,i=null,s=0;r;){for(s++,n=r,a=0,t=0;t<h&&(a++,n=n.nextZ,!!n);t++);for(u=h;a>0||u>0&&n;)a!==0&&(u===0||!n||r.z<=n.z)?(o=r,r=r.nextZ,a--):(o=n,n=n.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;r=n}i.nextZ=null,h*=2}while(s>1);return e}function X6(e,t,r,n,o){return e=(e-r)*o|0,t=(t-n)*o|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function OTe(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function k0(e,t,r,n,o,i,s,a){return(o-s)*(t-a)>=(e-s)*(i-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(i-a)>=(o-s)*(n-a)}function RTe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!NTe(e,t)&&(Jv(e,t)&&Jv(t,e)&&zTe(e,t)&&(Ki(e.prev,e,t.prev)||Ki(e,t.prev,t))||oT(e,t)&&Ki(e.prev,e,e.next)>0&&Ki(t.prev,t,t.next)>0)}function Ki(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function oT(e,t){return e.x===t.x&&e.y===t.y}function XG(e,t,r,n){var o=nT(Ki(e,t,r)),i=nT(Ki(e,t,n)),s=nT(Ki(r,n,e)),a=nT(Ki(r,n,t));return!!(o!==i&&s!==a||o===0&&rT(e,r,t)||i===0&&rT(e,n,t)||s===0&&rT(r,e,n)||a===0&&rT(r,t,n))}function rT(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function nT(e){return e>0?1:e<0?-1:0}function NTe(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&XG(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Jv(e,t){return Ki(e.prev,e,e.next)<0?Ki(e,t,e.next)>=0&&Ki(e,e.prev,t)>=0:Ki(e,t,e.prev)<0||Ki(e,e.next,t)<0}function zTe(e,t){var r=e,n=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function KG(e,t){var r=new K6(e.i,e.x,e.y),n=new K6(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function GG(e,t,r,n){var o=new K6(e,t,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function e1(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function K6(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}iT.deviation=function(e,t,r,n){var o=t&&t.length,i=o?t[0]*r:e.length,s=Math.abs($6(e,0,i,r));if(o)for(var a=0,u=t.length;a<u;a++){var h=t[a]*r,p=a<u-1?t[a+1]*r:e.length;s-=Math.abs($6(e,h,p,r))}var _=0;for(a=0;a<n.length;a+=3){var y=n[a]*r,A=n[a+1]*r,E=n[a+2]*r;_+=Math.abs((e[y]-e[E])*(e[A+1]-e[y+1])-(e[y]-e[A])*(e[E+1]-e[y+1]))}return s===0&&_===0?0:Math.abs((_-s)/s)};function $6(e,t,r,n){for(var o=0,i=t,s=r-n;i<r;i+=n)o+=(e[s]-e[i])*(e[i+1]+e[s+1]),s=i;return o}iT.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var s=0;s<t;s++)r.vertices.push(e[o][i][s]);o>0&&(n+=e[o-1].length,r.holes.push(n))}return r}});var nX=rd(xR=>{xR.read=function(e,t,r,n,o){var i,s,a=o*8-n-1,u=(1<<a)-1,h=u>>1,p=-7,_=r?o-1:0,y=r?-1:1,A=e[t+_];for(_+=y,i=A&(1<<-p)-1,A>>=-p,p+=a;p>0;i=i*256+e[t+_],_+=y,p-=8);for(s=i&(1<<-p)-1,i>>=-p,p+=n;p>0;s=s*256+e[t+_],_+=y,p-=8);if(i===0)i=1-h;else{if(i===u)return s?NaN:(A?-1:1)*(1/0);s=s+Math.pow(2,n),i=i-h}return(A?-1:1)*s*Math.pow(2,i-n)};xR.write=function(e,t,r,n,o,i){var s,a,u,h=i*8-o-1,p=(1<<h)-1,_=p>>1,y=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=n?0:i-1,E=n?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=p):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+_>=1?t+=y/u:t+=y*Math.pow(2,1-_),t*u>=2&&(s++,u/=2),s+_>=p?(a=0,s=p):s+_>=1?(a=(t*u-1)*Math.pow(2,o),s=s+_):(a=t*Math.pow(2,_-1)*Math.pow(2,o),s=0));o>=8;e[r+A]=a&255,A+=E,a/=256,o-=8);for(s=s<<o|a,h+=o;h>0;e[r+A]=s&255,A+=E,s/=256,h-=8);e[r+A-E]|=k*128}});var cX=rd((Cst,lX)=>{"use strict";lX.exports=si;var MT=nX();function si(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}si.Varint=0;si.Fixed64=1;si.Bytes=2;si.Fixed32=5;var bR=65536*65536,iX=1/bR,sEe=12,aX=typeof TextDecoder>"u"?null:new TextDecoder("utf8");si.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),o=n>>3,i=this.pos;this.type=n&7,e(o,t,this),this.pos===i&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=ST(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=sX(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=ST(this.buf,this.pos)+ST(this.buf,this.pos+4)*bR;return this.pos+=8,e},readSFixed64:function(){var e=ST(this.buf,this.pos)+sX(this.buf,this.pos+4)*bR;return this.pos+=8,e},readFloat:function(){var e=MT.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=MT.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,aEe(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=sEe&&aX?vEe(this.buf,t,e):bEe(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==si.Bytes)return e.push(this.readVarint(t));var r=Yf(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==si.Bytes)return e.push(this.readSVarint());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==si.Bytes)return e.push(this.readBoolean());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==si.Bytes)return e.push(this.readFloat());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==si.Bytes)return e.push(this.readDouble());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==si.Bytes)return e.push(this.readFixed32());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==si.Bytes)return e.push(this.readSFixed32());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==si.Bytes)return e.push(this.readFixed64());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==si.Bytes)return e.push(this.readSFixed64());var t=Yf(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===si.Varint)for(;this.buf[this.pos++]>127;);else if(t===si.Bytes)this.pos=this.readVarint()+this.pos;else if(t===si.Fixed32)this.pos+=4;else if(t===si.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),B0(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),B0(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),B0(this.buf,e&-1,this.pos),B0(this.buf,Math.floor(e*iX),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),B0(this.buf,e&-1,this.pos),B0(this.buf,Math.floor(e*iX),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){lEe(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=wEe(this.buf,e,this.pos);var r=this.pos-t;r>=128&&oX(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),MT.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),MT.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&oX(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,si.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,fEe,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,hEe,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,mEe,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,dEe,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,pEe,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,gEe,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,_Ee,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,yEe,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,xEe,t)},writeBytesField:function(e,t){this.writeTag(e,si.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,si.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,si.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,si.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,si.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,si.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,si.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,si.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,si.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,si.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function aEe(e,t,r){var n=r.buf,o,i;if(i=n[r.pos++],o=(i&112)>>4,i<128||(i=n[r.pos++],o|=(i&127)<<3,i<128)||(i=n[r.pos++],o|=(i&127)<<10,i<128)||(i=n[r.pos++],o|=(i&127)<<17,i<128)||(i=n[r.pos++],o|=(i&127)<<24,i<128)||(i=n[r.pos++],o|=(i&1)<<31,i<128))return F0(e,o,t);throw new Error("Expected varint not more than 10 bytes")}function Yf(e){return e.type===si.Bytes?e.readVarint()+e.pos:e.pos+1}function F0(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function lEe(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),cEe(r,n,t),uEe(n,t)}function cEe(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function uEe(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function oX(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var o=r.pos-1;o>=e;o--)r.buf[o+n]=r.buf[o]}function fEe(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function hEe(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function dEe(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function pEe(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function mEe(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function gEe(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function _Ee(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function yEe(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function xEe(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function ST(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function B0(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function sX(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function bEe(e,t,r){for(var n="",o=t;o<r;){var i=e[o],s=null,a=i>239?4:i>223?3:i>191?2:1;if(o+a>r)break;var u,h,p;a===1?i<128&&(s=i):a===2?(u=e[o+1],(u&192)===128&&(s=(i&31)<<6|u&63,s<=127&&(s=null))):a===3?(u=e[o+1],h=e[o+2],(u&192)===128&&(h&192)===128&&(s=(i&15)<<12|(u&63)<<6|h&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):a===4&&(u=e[o+1],h=e[o+2],p=e[o+3],(u&192)===128&&(h&192)===128&&(p&192)===128&&(s=(i&15)<<18|(u&63)<<12|(h&63)<<6|p&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,a=1):s>65535&&(s-=65536,n+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),n+=String.fromCharCode(s),o+=a}return n}function vEe(e,t,r){return aX.decode(e.subarray(t,r))}function wEe(e,t,r){for(var n=0,o,i;n<t.length;n++){if(o=t.charCodeAt(n),o>55295&&o<57344)if(i)if(o<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=o;continue}else o=i-55296<<10|o-56320|65536,i=null;else{o>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=o;continue}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);o<128?e[r++]=o:(o<2048?e[r++]=o>>6|192:(o<65536?e[r++]=o>>12|224:(e[r++]=o>>18|240,e[r++]=o>>12&63|128),e[r++]=o>>6&63|128),e[r++]=o&63|128)}return r}});function zX(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function tIe(e,t){var r=zX(e);return function(n,o){return t(r(n),o,e)}}function NX(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var o in n)o in t||r.push(t[o]=o)}),r}function Na(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function rIe(e){return e<0?"-"+Na(-e,6):e>9999?"+"+Na(e,6):Na(e,4)}function nIe(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":rIe(e.getUTCFullYear(),4)+"-"+Na(e.getUTCMonth()+1,2)+"-"+Na(e.getUTCDate(),2)+(o?"T"+Na(t,2)+":"+Na(r,2)+":"+Na(n,2)+"."+Na(o,3)+"Z":n?"T"+Na(t,2)+":"+Na(r,2)+":"+Na(n,2)+"Z":r||t?"T"+Na(t,2)+":"+Na(r,2)+"Z":"")}function Id(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(_,y){var A,E,k=o(_,function(P,R){if(A)return A(P,R-1);E=P,A=y?tIe(P,y):zX(P)});return k.columns=E||[],k}function o(_,y){var A=[],E=_.length,k=0,P=0,R,V=E<=0,N=!1;_.charCodeAt(E-1)===b1&&--E,_.charCodeAt(E-1)===DR&&--E;function j(){if(V)return NR;if(N)return N=!1,RX;var ne,de=k,fe;if(_.charCodeAt(de)===zR){for(;k++<E&&_.charCodeAt(k)!==zR||_.charCodeAt(++k)===zR;);return(ne=k)>=E?V=!0:(fe=_.charCodeAt(k++))===b1?N=!0:fe===DR&&(N=!0,_.charCodeAt(k)===b1&&++k),_.slice(de+1,ne-1).replace(/""/g,'"')}for(;k<E;){if((fe=_.charCodeAt(ne=k++))===b1)N=!0;else if(fe===DR)N=!0,_.charCodeAt(k)===b1&&++k;else if(fe!==r)continue;return _.slice(de,ne)}return V=!0,_.slice(de,E)}for(;(R=j())!==NR;){for(var J=[];R!==RX&&R!==NR;)J.push(R),R=j();y&&(J=y(J,P++))==null||A.push(J)}return A}function i(_,y){return _.map(function(A){return y.map(function(E){return p(A[E])}).join(e)})}function s(_,y){return y==null&&(y=NX(_)),[y.map(p).join(e)].concat(i(_,y)).join(`
`)}function a(_,y){return y==null&&(y=NX(_)),i(_,y).join(`
`)}function u(_){return _.map(h).join(`
`)}function h(_){return _.map(p).join(e)}function p(_){return _==null?"":_ instanceof Date?nIe(_):t.test(_+="")?'"'+_.replace(/"/g,'""')+'"':_}return{parse:n,parseRows:o,format:s,formatBody:a,formatRows:u,formatRow:h,formatValue:p}}var RX,NR,zR,b1,DR,NT=W(()=>{RX={},NR={},zR=34,b1=10,DR=13});var ig,zT,DX,LX,FX,BX,jX,UX,VX=W(()=>{NT();ig=Id(","),zT=ig.parse,DX=ig.parseRows,LX=ig.format,FX=ig.formatBody,BX=ig.formatRows,jX=ig.formatRow,UX=ig.formatValue});var og,DT,WX,ZX,YX,qX,GX,HX,XX=W(()=>{NT();og=Id("	"),DT=og.parse,WX=og.parseRows,ZX=og.format,YX=og.formatBody,qX=og.formatRows,GX=og.formatRow,HX=og.formatValue});function LR(e){for(var t in e){var r=e[t].trim(),n,o;if(!r)r=null;else if(r==="true")r=!0;else if(r==="false")r=!1;else if(r==="NaN")r=NaN;else if(!isNaN(n=+r))r=n;else if(o=r.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))iIe&&o[4]&&!o[7]&&(r=r.replace(/-/g,"/").replace(/T/," ")),r=new Date(r);else continue;e[t]=r}return e}var iIe,KX=W(()=>{iIe=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours()});var FR=W(()=>{NT();VX();XX();KX()});var QX=rd((BR,jR)=>{(function(e,t){typeof BR=="object"&&typeof jR<"u"?jR.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self,e.maplibregl=t())})(BR,function(){"use strict";var e,t,r;function n(i,s){if(!e)e=s;else if(!t)t=s;else{var a="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",u={};e(u),r=s(u),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}}n(["exports"],function(i){"use strict";function s(f,l,d,g){return new(d||(d=Promise))(function(b,T){function C($){try{U(g.next($))}catch(ie){T(ie)}}function D($){try{U(g.throw($))}catch(ie){T(ie)}}function U($){var ie;$.done?b($.value):(ie=$.value,ie instanceof d?ie:new d(function(ce){ce(ie)})).then(C,D)}U((g=g.apply(f,l||[])).next())})}function a(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var u=h;function h(f,l){this.x=f,this.y=l}h.prototype={clone:function(){return new h(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,l){return this.clone()._rotateAround(f,l)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var l=f.x-this.x,d=f.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,l){return Math.atan2(this.x*l-this.y*f,this.x*f+this.y*l)},_matMult:function(f){var l=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=l,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var l=Math.cos(f),d=Math.sin(f),g=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=g,this},_rotateAround:function(f,l){var d=Math.cos(f),g=Math.sin(f),b=l.y+g*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-g*(this.y-l.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(f){return f instanceof h?f:Array.isArray(f)?new h(f[0],f[1]):f};var p=a(u),_=y;function y(f,l,d,g){this.cx=3*f,this.bx=3*(d-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=l,this.p2x=d,this.p2y=g}y.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,l){if(l===void 0&&(l=1e-6),f<0)return 0;if(f>1)return 1;for(var d=f,g=0;g<8;g++){var b=this.sampleCurveX(d)-f;if(Math.abs(b)<l)return d;var T=this.sampleCurveDerivativeX(d);if(Math.abs(T)<1e-6)break;d-=b/T}var C=0,D=1;for(d=f,g=0;g<20&&(b=this.sampleCurveX(d),!(Math.abs(b-f)<l));g++)f>b?C=d:D=d,d=.5*(D-C)+C;return d},solve:function(f,l){return this.sampleCurveY(this.solveCurveX(f,l))}};var A=a(_);let E,k;function P(){return E==null&&(E=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),E}function R(){if(k==null&&(k=!1,P())){let l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let g=0;g<5*5;g++){let b=4*g;l.fillStyle=`rgb(${b},${b+1},${b+2})`,l.fillRect(g%5,Math.floor(g/5),1,1)}let d=l.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&d[g]!==g){k=!0;break}}}return k||!1}function V(f,l,d,g){let b=new A(f,l,d,g);return function(T){return b.solve(T)}}let N=V(.25,.1,.25,1);function j(f,l,d){return Math.min(d,Math.max(l,f))}function J(f,l,d){let g=d-l,b=((f-l)%g+g)%g+l;return b===l?d:b}function ne(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}let de=1;function fe(f,l,d){let g={};for(let b in f)g[b]=l.call(d||this,f[b],b,f);return g}function ye(f,l,d){let g={};for(let b in f)l.call(d||this,f[b],b,f)&&(g[b]=f[b]);return g}function ve(f){return Array.isArray(f)?f.map(ve):typeof f=="object"&&f?fe(f,ve):f}let be={};function je(f){be[f]||(typeof console<"u"&&console.warn(f),be[f]=!0)}function Re(f,l,d){return(d.y-f.y)*(l.x-f.x)>(l.y-f.y)*(d.x-f.x)}function Se(f){let l=0;for(let d,g,b=0,T=f.length,C=T-1;b<T;C=b++)d=f[b],g=f[C],l+=(g.x-d.x)*(d.y+g.y);return l}function Ue(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let qe=null;function Je(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}let gt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function rt(f,l,d,g,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let T=new VideoFrame(f,{timestamp:0});try{let C=T?.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);let D=C.startsWith("BGR"),U=new Uint8ClampedArray(g*b*4);if(yield T.copyTo(U,function($,ie,ce,me,Ae){let Te=4*Math.max(-ie,0),Le=(Math.max(0,ce)-ce)*me*4+Te,He=4*me,Qe=Math.max(0,ie),lt=Math.max(0,ce);return{rect:{x:Qe,y:lt,width:Math.min($.width,ie+me)-Qe,height:Math.min($.height,ce+Ae)-lt},layout:[{offset:Le,stride:He}]}}(f,l,d,g,b)),D)for(let $=0;$<U.length;$+=4){let ie=U[$];U[$]=U[$+2],U[$+2]=ie}return U}finally{T.close()}})}let At,St,kt,yt,tr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f){let l=requestAnimationFrame(f);return{cancel:()=>cancelAnimationFrame(l)}},getImageData(f,l=0){return this.getImageCanvasContext(f).getImageData(-l,-l,f.width+2*l,f.height+2*l)},getImageCanvasContext(f){let l=window.document.createElement("canvas"),d=l.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return l.width=f.width,l.height=f.height,d.drawImage(f,0,0,f.width,f.height),d},resolveURL:f=>(kt||(kt=document.createElement("a")),kt.href=f,kt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(yt==null&&(yt=matchMedia("(prefers-reduced-motion: reduce)")),yt.matches)}},vr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class wr extends Error{constructor(l,d,g,b){super(`AJAXError: ${d} (${l}): ${g}`),this.status=l,this.statusText=d,this.url=g,this.body=b}}let Ir=Ue()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Br=f=>vr.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))];function qt(f,l){let d=new AbortController,g=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Ir(),signal:d.signal}),b=!1,T=!1;return f.type==="json"&&g.headers.set("Accept","application/json"),T||fetch(g).then(C=>C.ok?(D=>{(f.type==="arrayBuffer"||f.type==="image"?D.arrayBuffer():f.type==="json"?D.json():D.text()).then(U=>{T||(b=!0,l(null,U,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(U=>{T||l(new Error(U.message))})})(C):C.blob().then(D=>l(new wr(C.status,C.statusText,f.url,D)))).catch(C=>{C.code!==20&&l(new Error(C.message))}),{cancel:()=>{T=!0,b||d.abort()}}}let Lr=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",f,l);if(!Ue())return(Br(f.url)||qt)(f,l)}if(!(/^file:/.test(d=f.url)||/^file:/.test(Ir())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return qt(f,l);if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",f,l,void 0,!0)}var d;return function(g,b){let T=new XMLHttpRequest;T.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(T.responseType="arraybuffer");for(let C in g.headers)T.setRequestHeader(C,g.headers[C]);return g.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=g.credentials==="include",T.onerror=()=>{b(new Error(T.statusText))},T.onload=()=>{if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let C=T.response;if(g.type==="json")try{C=JSON.parse(T.response)}catch(D){return b(D)}b(null,C,T.getResponseHeader("Cache-Control"),T.getResponseHeader("Expires"))}else{let C=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});b(new wr(T.status,T.statusText,g.url,C))}},T.send(g.body),{cancel:()=>T.abort()}}(f,l)},Yr=function(f,l){return Lr(ne(f,{type:"arrayBuffer"}),l)};function Rt(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;let l=new URL(f),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function bn(f,l,d){d[f]&&d[f].indexOf(l)!==-1||(d[f]=d[f]||[],d[f].push(l))}function tn(f,l,d){if(d&&d[f]){let g=d[f].indexOf(l);g!==-1&&d[f].splice(g,1)}}class sr{constructor(l,d={}){ne(this,d),this.type=l}}class Rn extends sr{constructor(l,d={}){super("error",ne({error:l},d))}}class dr{on(l,d){return this._listeners=this._listeners||{},bn(l,d,this._listeners),this}off(l,d){return tn(l,d,this._listeners),tn(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},bn(l,d,this._oneTimeListeners),this):new Promise(g=>this.once(l,g))}fire(l,d){typeof l=="string"&&(l=new sr(l,d||{}));let g=l.type;if(this.listens(g)){l.target=this;let b=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(let D of b)D.call(this,l);let T=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(let D of T)tn(g,D,this._oneTimeListeners),D.call(this,l);let C=this._eventedParent;C&&(ne(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(l))}else l instanceof Rn&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var xt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ei=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Hr(f,l){let d={};for(let g in f)g!=="ref"&&(d[g]=f[g]);return ei.forEach(g=>{g in l&&(d[g]=l[g])}),d}function Pn(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let d=0;d<f.length;d++)if(!Pn(f[d],l[d]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(let d in f)if(!Pn(f[d],l[d]))return!1;return!0}return f===l}let gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function No(f,l,d){d.push({command:gn.addSource,args:[f,l[f]]})}function bs(f,l,d){l.push({command:gn.removeSource,args:[f]}),d[f]=!0}function qo(f,l,d,g){bs(f,d,g),No(f,l,d)}function ba(f,l,d){let g;for(g in f[d])if(Object.prototype.hasOwnProperty.call(f[d],g)&&g!=="data"&&!Pn(f[d][g],l[d][g]))return!1;for(g in l[d])if(Object.prototype.hasOwnProperty.call(l[d],g)&&g!=="data"&&!Pn(f[d][g],l[d][g]))return!1;return!0}function vs(f,l,d,g,b,T){let C;for(C in l=l||{},f=f||{})Object.prototype.hasOwnProperty.call(f,C)&&(Pn(f[C],l[C])||d.push({command:T,args:[g,C,l[C],b]}));for(C in l)Object.prototype.hasOwnProperty.call(l,C)&&!Object.prototype.hasOwnProperty.call(f,C)&&(Pn(f[C],l[C])||d.push({command:T,args:[g,C,l[C],b]}))}function zo(f){return f.id}function Do(f,l){return f[l.id]=l,f}class Zt{constructor(l,d,g,b){this.message=(l?`${l}: `:"")+g,b&&(this.identifier=b),d!=null&&d.__line__&&(this.line=d.__line__)}}function eo(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}class Xn extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class ws{constructor(l,d=[]){this.parent=l,this.bindings={};for(let[g,b]of d)this.bindings[g]=b}concat(l){return new ws(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}let wo={kind:"null"},Ht={kind:"number"},$r={kind:"string"},cr={kind:"boolean"},ji={kind:"color"},to={kind:"object"},zr={kind:"value"},Ao={kind:"collator"},Oe={kind:"formatted"},ue={kind:"padding"},ge={kind:"resolvedImage"},ke={kind:"variableAnchorOffsetCollection"};function Ve(f,l){return{kind:"array",itemType:f,N:l}}function We(f){if(f.kind==="array"){let l=We(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}let G=[wo,Ht,$r,cr,ji,Oe,to,Ve(zr),ue,ge,ke];function te(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!te(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(let d of G)if(!te(d,l))return null}}return`Expected ${We(f)} but found ${We(l)} instead.`}function Q(f,l){return l.some(d=>d.kind===f.kind)}function ae(f,l){return l.some(d=>d==="null"?f===null:d==="array"?Array.isArray(f):d==="object"?f&&!Array.isArray(f)&&typeof f=="object":d===typeof f)}function he(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}let we=.96422,Ee=.82521,Xe=4/29,ut=6/29,mt=3*ut*ut,Tt=ut*ut*ut,jt=Math.PI/180,Et=180/Math.PI;function Ct(f){return(f%=360)<0&&(f+=360),f}function Dt([f,l,d,g]){let b,T,C=xr((.2225045*(f=Lt(f))+.7168786*(l=Lt(l))+.0606169*(d=Lt(d)))/1);f===l&&l===d?b=T=C:(b=xr((.4360747*f+.3850649*l+.1430804*d)/we),T=xr((.0139322*f+.0971045*l+.7141733*d)/Ee));let D=116*C-16;return[D<0?0:D,500*(b-C),200*(C-T),g]}function Lt(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function xr(f){return f>Tt?Math.pow(f,1/3):f/mt+Xe}function Sr([f,l,d,g]){let b=(f+16)/116,T=isNaN(l)?b:b+l/500,C=isNaN(d)?b:b-d/200;return b=1*pr(b),T=we*pr(T),C=Ee*pr(C),[ln(3.1338561*T-1.6168667*b-.4906146*C),ln(-.9787684*T+1.9161415*b+.033454*C),ln(.0719453*T-.2289914*b+1.4052427*C),g]}function ln(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function pr(f){return f>ut?f*f*f:mt*(f-Xe)}function un(f){return parseInt(f.padEnd(2,f),16)/255}function rn(f,l){return en(l?f/100:f,0,1)}function en(f,l,d){return Math.min(Math.max(l,f),d)}function Xr(f){return!f.some(Number.isNaN)}let di={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class It{constructor(l,d,g,b=1,T=!0){this.r=l,this.g=d,this.b=g,this.a=b,T||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[l,d,g,b]))}static parse(l){if(l instanceof It)return l;if(typeof l!="string")return;let d=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];let b=di[g];if(b){let[C,D,U]=b;return[C/255,D/255,U/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){let C=g.length<6?1:2,D=1;return[un(g.slice(D,D+=C)),un(g.slice(D,D+=C)),un(g.slice(D,D+=C)),un(g.slice(D,D+C)||"ff")]}if(g.startsWith("rgb")){let C=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){let[D,U,$,ie,ce,me,Ae,Te,Le,He,Qe,lt]=C,tt=[ie||" ",Ae||" ",He].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){let ct=[$,me,Le].join(""),vt=ct==="%%%"?100:ct===""?255:0;if(vt){let Ot=[en(+U/vt,0,1),en(+ce/vt,0,1),en(+Te/vt,0,1),Qe?rn(+Qe,lt):1];if(Xr(Ot))return Ot}}return}}let T=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){let[C,D,U,$,ie,ce,me,Ae,Te]=T,Le=[U||" ",ie||" ",me].join("");if(Le==="  "||Le==="  /"||Le===",,"||Le===",,,"){let He=[+D,en(+$,0,100),en(+ce,0,100),Ae?rn(+Ae,Te):1];if(Xr(He))return function([Qe,lt,tt,ct]){function vt(Ot){let lr=(Ot+Qe/30)%12,Or=lt*Math.min(tt,1-tt);return tt-Or*Math.max(-1,Math.min(lr-3,9-lr,1))}return Qe=Ct(Qe),lt/=100,tt/=100,[vt(0),vt(8),vt(4),ct]}(He)}}}(l);return d?new It(...d,!1):void 0}get rgb(){let{r:l,g:d,b:g,a:b}=this,T=b||1/0;return this.overwriteGetter("rgb",[l/T,d/T,g/T,b])}get hcl(){return this.overwriteGetter("hcl",function(l){let[d,g,b,T]=Dt(l),C=Math.sqrt(g*g+b*b);return[Math.round(1e4*C)?Ct(Math.atan2(b,g)*Et):NaN,C,d,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dt(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){let[l,d,g,b]=this.rgb;return`rgba(${[l,d,g].map(T=>Math.round(255*T)).join(",")},${b})`}}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1);class fr{constructor(l,d,g){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ur{constructor(l,d,g,b,T){this.text=l,this.image=d,this.scale=g,this.fontStack=b,this.textColor=T}}class kr{constructor(l){this.sections=l}static fromString(l){return new kr([new Ur(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof kr?l:kr.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Pr{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Pr)return l;if(typeof l=="number")return new Pr([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(let d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Pr(l)}}toString(){return JSON.stringify(this.values)}}let xn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class on{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof on)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){let g=l[d],b=l[d+1];if(typeof g!="string"||!xn.has(g)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new on(l)}}toString(){return JSON.stringify(this.values)}}class qr{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new qr({name:l,available:!1}):null}}function Nn(f,l,d,g){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[f,l,d,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[f,l,d,g]:[f,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sn(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof It||f instanceof fr||f instanceof kr||f instanceof Pr||f instanceof on||f instanceof qr)return!0;if(Array.isArray(f)){for(let l of f)if(!sn(l))return!1;return!0}if(typeof f=="object"){for(let l in f)if(!sn(f[l]))return!1;return!0}return!1}function fn(f){if(f===null)return wo;if(typeof f=="string")return $r;if(typeof f=="boolean")return cr;if(typeof f=="number")return Ht;if(f instanceof It)return ji;if(f instanceof fr)return Ao;if(f instanceof kr)return Oe;if(f instanceof Pr)return ue;if(f instanceof on)return ke;if(f instanceof qr)return ge;if(Array.isArray(f)){let l=f.length,d;for(let g of f){let b=fn(g);if(d){if(d===b)continue;d=zr;break}d=b}return Ve(d||zr,l)}return to}function Kr(f){let l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof It||f instanceof kr||f instanceof Pr||f instanceof on||f instanceof qr?f.toString():JSON.stringify(f)}class lo{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!sn(l[1]))return d.error("invalid value");let g=l[1],b=fn(g),T=d.expectedType;return b.kind!=="array"||b.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(b=T),new lo(b,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Bn{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}let vn={string:$r,number:Ht,boolean:cr,object:to};class Vn{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g,b=1,T=l[0];if(T==="array"){let D,U;if(l.length>2){let $=l[1];if(typeof $!="string"||!($ in vn)||$==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);D=vn[$],b++}else D=zr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);U=l[2],b++}g=Ve(D,U)}else{if(!vn[T])throw new Error(`Types doesn't contain name = ${T}`);g=vn[T]}let C=[];for(;b<l.length;b++){let D=d.parse(l[b],b,zr);if(!D)return null;C.push(D)}return new Vn(g,C)}evaluate(l){for(let d=0;d<this.args.length;d++){let g=this.args[d].evaluate(l);if(!te(this.type,fn(g)))return g;if(d===this.args.length-1)throw new Bn(`Expected value to be of type ${We(this.type)}, but found ${We(fn(g))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let Lo={"to-boolean":cr,"to-color":ji,"to-number":Ht,"to-string":$r};class Ai{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[0];if(!Lo[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&l.length!==2)return d.error("Expected one argument.");let b=Lo[g],T=[];for(let C=1;C<l.length;C++){let D=d.parse(l[C],C,zr);if(!D)return null;T.push(D)}return new Ai(b,T)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,g;for(let b of this.args){if(d=b.evaluate(l),g=null,d instanceof It)return d;if(typeof d=="string"){let T=l.parseColor(d);if(T)return T}else if(Array.isArray(d)&&(g=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Nn(d[0],d[1],d[2],d[3]),!g))return new It(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new Bn(g||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(let g of this.args){d=g.evaluate(l);let b=Pr.parse(d);if(b)return b}throw new Bn(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(let g of this.args){d=g.evaluate(l);let b=on.parse(d);if(b)return b}throw new Bn(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(let g of this.args){if(d=g.evaluate(l),d===null)return 0;let b=Number(d);if(!isNaN(b))return b}throw new Bn(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return kr.fromString(Kr(this.args[0].evaluate(l)));case"resolvedImage":return qr.fromString(Kr(this.args[0].evaluate(l)));default:return Kr(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let Ui=["Unknown","Point","LineString","Polygon"];class As{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ui[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=It.parse(l)),d}}class Ms{constructor(l,d,g=[],b,T=new ws,C=[]){this.registry=l,this.path=g,this.key=g.map(D=>`[${D}]`).join(""),this.scope=T,this.errors=C,this.expectedType=b,this._isConstant=d}parse(l,d,g,b,T={}){return d?this.concat(d,g,b)._parse(l,T):this._parse(l,T)}_parse(l,d){function g(b,T,C){return C==="assert"?new Vn(T,[b]):C==="coerce"?new Ai(T,[b]):b}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let b=l[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let T=this.registry[b];if(T){let C=T.parse(l,this);if(!C)return null;if(this.expectedType){let D=this.expectedType,U=C.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||U.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||U.kind!=="value"&&U.kind!=="string")if(D.kind!=="padding"||U.kind!=="value"&&U.kind!=="number"&&U.kind!=="array")if(D.kind!=="variableAnchorOffsetCollection"||U.kind!=="value"&&U.kind!=="array"){if(this.checkSubtype(D,U))return null}else C=g(C,D,d.typeAnnotation||"coerce");else C=g(C,D,d.typeAnnotation||"coerce");else C=g(C,D,d.typeAnnotation||"coerce");else C=g(C,D,d.typeAnnotation||"assert")}if(!(C instanceof lo)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){let D=new As;try{C=new lo(C.type,C.evaluate(D))}catch(U){return this.error(U.message),null}}return C}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,g){let b=typeof l=="number"?this.path.concat(l):this.path,T=g?this.scope.concat(g):this.scope;return new Ms(this.registry,this._isConstant,b,d||null,T,this.errors)}error(l,...d){let g=`${this.key}${d.map(b=>`[${b}]`).join("")}`;this.errors.push(new Xn(g,l))}checkSubtype(l,d){let g=te(l,d);return g&&this.error(g),g}}class Ss{constructor(l,d,g){this.type=Ao,this.locale=g,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");let g=l[1];if(typeof g!="object"||Array.isArray(g))return d.error("Collator options argument must be an object.");let b=d.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,cr);if(!b)return null;let T=d.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,cr);if(!T)return null;let C=null;return g.locale&&(C=d.parse(g.locale,1,$r),!C)?null:new Ss(b,T,C)}evaluate(l){return new fr(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}let Me=8192;function Pe(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function Ke(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function bt(f,l){let d=(180+f[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,b=Math.pow(2,l.z);return[Math.round(d*b*Me),Math.round(g*b*Me)]}function Ft(f,l,d){let g=f[0]-l[0],b=f[1]-l[1],T=f[0]-d[0],C=f[1]-d[1];return g*C-T*b==0&&g*T<=0&&b*C<=0}function Xt(f,l){let d=!1;for(let C=0,D=l.length;C<D;C++){let U=l[C];for(let $=0,ie=U.length;$<ie-1;$++){if(Ft(f,U[$],U[$+1]))return!1;(b=U[$])[1]>(g=f)[1]!=(T=U[$+1])[1]>g[1]&&g[0]<(T[0]-b[0])*(g[1]-b[1])/(T[1]-b[1])+b[0]&&(d=!d)}}var g,b,T;return d}function hn(f,l){for(let d=0;d<l.length;d++)if(Xt(f,l[d]))return!0;return!1}function _n(f,l,d,g){let b=g[0]-d[0],T=g[1]-d[1],C=(f[0]-d[0])*T-b*(f[1]-d[1]),D=(l[0]-d[0])*T-b*(l[1]-d[1]);return C>0&&D<0||C<0&&D>0}function Wn(f,l,d){for(let $ of d)for(let ie=0;ie<$.length-1;++ie)if((D=[(C=$[ie+1])[0]-(T=$[ie])[0],C[1]-T[1]])[0]*(U=[(b=l)[0]-(g=f)[0],b[1]-g[1]])[1]-D[1]*U[0]!=0&&_n(g,b,T,C)&&_n(T,C,g,b))return!0;var g,b,T,C,D,U;return!1}function Kn(f,l){for(let d=0;d<f.length;++d)if(!Xt(f[d],l))return!1;for(let d=0;d<f.length-1;++d)if(Wn(f[d],f[d+1],l))return!1;return!0}function Qr(f,l){for(let d=0;d<l.length;d++)if(Kn(f,l[d]))return!0;return!1}function Mi(f,l,d){let g=[];for(let b=0;b<f.length;b++){let T=[];for(let C=0;C<f[b].length;C++){let D=bt(f[b][C],d);Pe(l,D),T.push(D)}g.push(T)}return g}function qi(f,l,d){let g=[];for(let b=0;b<f.length;b++){let T=Mi(f[b],l,d);g.push(T)}return g}function Ql(f,l,d,g){if(f[0]<d[0]||f[0]>d[2]){let b=.5*g,T=f[0]-d[0]>b?-g:d[0]-f[0]>b?g:0;T===0&&(T=f[0]-d[2]>b?-g:d[2]-f[0]>b?g:0),f[0]+=T}Pe(l,f)}function Ah(f,l,d,g){let b=Math.pow(2,g.z)*Me,T=[g.x*Me,g.y*Me],C=[];for(let D of f)for(let U of D){let $=[U.x+T[0],U.y+T[1]];Ql($,l,d,b),C.push($)}return C}function Mh(f,l,d,g){let b=Math.pow(2,g.z)*Me,T=[g.x*Me,g.y*Me],C=[];for(let U of f){let $=[];for(let ie of U){let ce=[ie.x+T[0],ie.y+T[1]];Pe(l,ce),$.push(ce)}C.push($)}if(l[2]-l[0]<=b/2){(D=l)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(let U of C)for(let $ of U)Ql($,l,d,b)}var D;return C}class ul{constructor(l,d){this.type=cr,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(sn(l[1])){let g=l[1];if(g.type==="FeatureCollection")for(let b=0;b<g.features.length;++b){let T=g.features[b].geometry.type;if(T==="Polygon"||T==="MultiPolygon")return new ul(g,g.features[b].geometry)}else if(g.type==="Feature"){let b=g.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ul(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ul(g,g)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){let b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],C=d.canonicalID();if(g.type==="Polygon"){let D=Mi(g.coordinates,T,C),U=Ah(d.geometry(),b,T,C);if(!Ke(b,T))return!1;for(let $ of U)if(!Xt($,D))return!1}if(g.type==="MultiPolygon"){let D=qi(g.coordinates,T,C),U=Ah(d.geometry(),b,T,C);if(!Ke(b,T))return!1;for(let $ of U)if(!hn($,D))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){let b=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],C=d.canonicalID();if(g.type==="Polygon"){let D=Mi(g.coordinates,T,C),U=Mh(d.geometry(),b,T,C);if(!Ke(b,T))return!1;for(let $ of U)if(!Kn($,D))return!1}if(g.type==="MultiPolygon"){let D=qi(g.coordinates,T,C),U=Mh(d.geometry(),b,T,C);if(!Ke(b,T))return!1;for(let $ of U)if(!Qr($,D))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class $u{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");let g=l[1];return d.scope.has(g)?new $u(g,d.scope.get(g)):d.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class cs{constructor(l,d,g,b){this.name=l,this.type=d,this._evaluate=g,this.args=b}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){let g=l[0],b=cs.definitions[g];if(!b)return d.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);let T=Array.isArray(b)?b[0]:b.type,C=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,D=C.filter(([$])=>!Array.isArray($)||$.length===l.length-1),U=null;for(let[$,ie]of D){U=new Ms(d.registry,Qu,d.path,null,d.scope);let ce=[],me=!1;for(let Ae=1;Ae<l.length;Ae++){let Te=l[Ae],Le=Array.isArray($)?$[Ae-1]:$.type,He=U.parse(Te,1+ce.length,Le);if(!He){me=!0;break}ce.push(He)}if(!me)if(Array.isArray($)&&$.length!==ce.length)U.error(`Expected ${$.length} arguments, but found ${ce.length} instead.`);else{for(let Ae=0;Ae<ce.length;Ae++){let Te=Array.isArray($)?$[Ae]:$.type,Le=ce[Ae];U.concat(Ae+1).checkSubtype(Te,Le.type)}if(U.errors.length===0)return new cs(g,T,ie,ce)}}if(D.length===1)d.errors.push(...U.errors);else{let $=(D.length?D:C).map(([ce])=>{return me=ce,Array.isArray(me)?`(${me.map(We).join(", ")})`:`(${We(me.type)}...)`;var me}).join(" | "),ie=[];for(let ce=1;ce<l.length;ce++){let me=d.parse(l[ce],1+ie.length);if(!me)return null;ie.push(We(me.type))}d.error(`Expected arguments of type ${$}, but found (${ie.join(", ")}) instead.`)}return null}static register(l,d){cs.definitions=d;for(let g in d)l[g]=cs}}function Qu(f){if(f instanceof $u)return Qu(f.boundExpression);if(f instanceof cs&&f.name==="error"||f instanceof Ss||f instanceof ul)return!1;let l=f instanceof Ai||f instanceof Vn,d=!0;return f.eachChild(g=>{d=l?d&&Qu(g):d&&g instanceof lo}),!!d&&Ju(f)&&ef(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ju(f){if(f instanceof cs&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof ul)return!1;let l=!0;return f.eachChild(d=>{l&&!Ju(d)&&(l=!1)}),l}function Vc(f){if(f instanceof cs&&f.name==="feature-state")return!1;let l=!0;return f.eachChild(d=>{l&&!Vc(d)&&(l=!1)}),l}function ef(f,l){if(f instanceof cs&&l.indexOf(f.name)>=0)return!1;let d=!0;return f.eachChild(g=>{d&&!ef(g,l)&&(d=!1)}),d}function Jl(f,l){let d=f.length-1,g,b,T=0,C=d,D=0;for(;T<=C;)if(D=Math.floor((T+C)/2),g=f[D],b=f[D+1],g<=l){if(D===d||l<b)return D;T=D+1}else{if(!(g>l))throw new Bn("Input is not a number.");C=D-1}return 0}class Fa{constructor(l,d,g){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(let[b,T]of g)this.labels.push(b),this.outputs.push(T)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");let g=d.parse(l[1],1,Ht);if(!g)return null;let b=[],T=null;d.expectedType&&d.expectedType.kind!=="value"&&(T=d.expectedType);for(let C=1;C<l.length;C+=2){let D=C===1?-1/0:l[C],U=l[C+1],$=C,ie=C+1;if(typeof D!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(b.length&&b[b.length-1][0]>=D)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',$);let ce=d.parse(U,ie,T);if(!ce)return null;T=T||ce.type,b.push([D,ce])}return new Fa(T,g,b)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let b=this.input.evaluate(l);if(b<=d[0])return g[0].evaluate(l);let T=d.length;return b>=d[T-1]?g[T-1].evaluate(l):g[Jl(d,b)].evaluate(l)}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Sn(f,l,d){return f+d*(l-f)}function tf(f,l,d){return f.map((g,b)=>Sn(g,l[b],d))}let Go={number:Sn,color:function(f,l,d,g="rgb"){switch(g){case"rgb":{let[b,T,C,D]=tf(f.rgb,l.rgb,d);return new It(b,T,C,D,!1)}case"hcl":{let[b,T,C,D]=f.hcl,[U,$,ie,ce]=l.hcl,me,Ae;if(isNaN(b)||isNaN(U))isNaN(b)?isNaN(U)?me=NaN:(me=U,C!==1&&C!==0||(Ae=$)):(me=b,ie!==1&&ie!==0||(Ae=T));else{let lt=U-b;U>b&&lt>180?lt-=360:U<b&&b-U>180&&(lt+=360),me=b+d*lt}let[Te,Le,He,Qe]=function([lt,tt,ct,vt]){return lt=isNaN(lt)?0:lt*jt,Sr([ct,Math.cos(lt)*tt,Math.sin(lt)*tt,vt])}([me,Ae??Sn(T,$,d),Sn(C,ie,d),Sn(D,ce,d)]);return new It(Te,Le,He,Qe,!1)}case"lab":{let[b,T,C,D]=Sr(tf(f.lab,l.lab,d));return new It(b,T,C,D,!1)}}},array:tf,padding:function(f,l,d){return new Pr(tf(f.values,l.values,d))},variableAnchorOffsetCollection:function(f,l,d){let g=f.values,b=l.values;if(g.length!==b.length)throw new Bn(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${l.toString()}`);let T=[];for(let C=0;C<g.length;C+=2){if(g[C]!==b[C])throw new Bn(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${g[C]}, to[${C}]: ${b[C]}`);T.push(g[C]);let[D,U]=g[C+1],[$,ie]=b[C+1];T.push([Sn(D,$,d),Sn(U,ie,d)])}return new on(T)}};class Ho{constructor(l,d,g,b,T){this.type=l,this.operator=d,this.interpolation=g,this.input=b,this.labels=[],this.outputs=[];for(let[C,D]of T)this.labels.push(C),this.outputs.push(D)}static interpolationFactor(l,d,g,b){let T=0;if(l.name==="exponential")T=Sh(d,l.base,g,b);else if(l.name==="linear")T=Sh(d,1,g,b);else if(l.name==="cubic-bezier"){let C=l.controlPoints;T=new A(C[0],C[1],C[2],C[3]).solve(Sh(d,1,g,b))}return T}static parse(l,d){let[g,b,T,...C]=l;if(!Array.isArray(b)||b.length===0)return d.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){let $=b[1];if(typeof $!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:$}}else{if(b[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(b[0])}`,1,0);{let $=b.slice(1);if($.length!==4||$.some(ie=>typeof ie!="number"||ie<0||ie>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:$}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(T=d.parse(T,2,Ht),!T)return null;let D=[],U=null;g==="interpolate-hcl"||g==="interpolate-lab"?U=ji:d.expectedType&&d.expectedType.kind!=="value"&&(U=d.expectedType);for(let $=0;$<C.length;$+=2){let ie=C[$],ce=C[$+1],me=$+3,Ae=$+4;if(typeof ie!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(D.length&&D[D.length-1][0]>=ie)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);let Te=d.parse(ce,Ae,U);if(!Te)return null;U=U||Te.type,D.push([ie,Te])}return he(U,Ht)||he(U,ji)||he(U,ue)||he(U,ke)||he(U,Ve(Ht))?new Ho(U,g,b,T,D):d.error(`Type ${We(U)} is not interpolatable.`)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let b=this.input.evaluate(l);if(b<=d[0])return g[0].evaluate(l);let T=d.length;if(b>=d[T-1])return g[T-1].evaluate(l);let C=Jl(d,b),D=Ho.interpolationFactor(this.interpolation,b,d[C],d[C+1]),U=g[C].evaluate(l),$=g[C+1].evaluate(l);switch(this.operator){case"interpolate":return Go[this.type.kind](U,$,D);case"interpolate-hcl":return Go.color(U,$,D,"hcl");case"interpolate-lab":return Go.color(U,$,D,"lab")}}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Sh(f,l,d,g){let b=g-d,T=f-d;return b===0?0:l===1?T/b:(Math.pow(l,T)-1)/(Math.pow(l,b)-1)}class rf{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expectected at least one argument.");let g=null,b=d.expectedType;b&&b.kind!=="value"&&(g=b);let T=[];for(let D of l.slice(1)){let U=d.parse(D,1+T.length,g,void 0,{typeAnnotation:"omit"});if(!U)return null;g=g||U.type,T.push(U)}if(!g)throw new Error("No output type");let C=b&&T.some(D=>te(b,D.type));return new rf(C?zr:g,T)}evaluate(l){let d,g=null,b=0;for(let T of this.args)if(b++,g=T.evaluate(l),g&&g instanceof qr&&!g.available&&(d||(d=g.name),g=null,b===this.args.length&&(g=d)),g!==null)break;return g}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}class nf{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(let d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);let g=[];for(let T=1;T<l.length-1;T+=2){let C=l[T];if(typeof C!="string")return d.error(`Expected string, but found ${typeof C} instead.`,T);if(/[^a-zA-Z0-9_]/.test(C))return d.error("Variable names must contain only alphanumeric characters or '_'.",T);let D=d.parse(l[T+1],T+1);if(!D)return null;g.push([C,D])}let b=d.parse(l[l.length-1],l.length-1,d.expectedType,g);return b?new nf(g,b):null}outputDefined(){return this.result.outputDefined()}}class Th{constructor(l,d,g){this.type=l,this.index=d,this.input=g}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Ht),b=d.parse(l[2],2,Ve(d.expectedType||zr));return g&&b?new Th(b.type.itemType,g,b):null}evaluate(l){let d=this.index.evaluate(l),g=this.input.evaluate(l);if(d<0)throw new Bn(`Array index out of bounds: ${d} < 0.`);if(d>=g.length)throw new Bn(`Array index out of bounds: ${d} > ${g.length-1}.`);if(d!==Math.floor(d))throw new Bn(`Array index must be an integer, but found ${d} instead.`);return g[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Eh{constructor(l,d){this.type=cr,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,zr),b=d.parse(l[2],2,zr);return g&&b?Q(g.type,[cr,$r,Ht,wo,zr])?new Eh(g,b):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${We(g.type)} instead`):null}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!g)return!1;if(!ae(d,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${We(fn(d))} instead.`);if(!ae(g,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${We(fn(g))} instead.`);return g.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class of{constructor(l,d,g){this.type=Ht,this.needle=l,this.haystack=d,this.fromIndex=g}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,zr),b=d.parse(l[2],2,zr);if(!g||!b)return null;if(!Q(g.type,[cr,$r,Ht,wo,zr]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${We(g.type)} instead`);if(l.length===4){let T=d.parse(l[3],3,Ht);return T?new of(g,b,T):null}return new of(g,b)}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!ae(d,["boolean","string","number","null"]))throw new Bn(`Expected first argument to be of type boolean, string, number or null, but found ${We(fn(d))} instead.`);if(!ae(g,["string","array"]))throw new Bn(`Expected second argument to be of type array or string, but found ${We(fn(g))} instead.`);if(this.fromIndex){let b=this.fromIndex.evaluate(l);return g.indexOf(d,b)}return g.indexOf(d)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Ih{constructor(l,d,g,b,T,C){this.inputType=l,this.type=d,this.input=g,this.cases=b,this.outputs=T,this.otherwise=C}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let g,b;d.expectedType&&d.expectedType.kind!=="value"&&(b=d.expectedType);let T={},C=[];for(let $=2;$<l.length-1;$+=2){let ie=l[$],ce=l[$+1];Array.isArray(ie)||(ie=[ie]);let me=d.concat($);if(ie.length===0)return me.error("Expected at least one branch label.");for(let Te of ie){if(typeof Te!="number"&&typeof Te!="string")return me.error("Branch labels must be numbers or strings.");if(typeof Te=="number"&&Math.abs(Te)>Number.MAX_SAFE_INTEGER)return me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Te=="number"&&Math.floor(Te)!==Te)return me.error("Numeric branch labels must be integer values.");if(g){if(me.checkSubtype(g,fn(Te)))return null}else g=fn(Te);if(T[String(Te)]!==void 0)return me.error("Branch labels must be unique.");T[String(Te)]=C.length}let Ae=d.parse(ce,$,b);if(!Ae)return null;b=b||Ae.type,C.push(Ae)}let D=d.parse(l[1],1,zr);if(!D)return null;let U=d.parse(l[l.length-1],l.length-1,b);return U?D.type.kind!=="value"&&d.concat(1).checkSubtype(g,D.type)?null:new Ih(g,b,D,T,C,U):null}evaluate(l){let d=this.input.evaluate(l);return(fn(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ch{constructor(l,d,g){this.type=l,this.branches=d,this.otherwise=g}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let g;d.expectedType&&d.expectedType.kind!=="value"&&(g=d.expectedType);let b=[];for(let C=1;C<l.length-1;C+=2){let D=d.parse(l[C],C,cr);if(!D)return null;let U=d.parse(l[C+1],C+1,g);if(!U)return null;b.push([D,U]),g=g||U.type}let T=d.parse(l[l.length-1],l.length-1,g);if(!T)return null;if(!g)throw new Error("Can't infer output type");return new Ch(g,b,T)}evaluate(l){for(let[d,g]of this.branches)if(d.evaluate(l))return g.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(let[d,g]of this.branches)l(d),l(g);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class sf{constructor(l,d,g,b){this.type=l,this.input=d,this.beginIndex=g,this.endIndex=b}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,zr),b=d.parse(l[2],2,Ht);if(!g||!b)return null;if(!Q(g.type,[Ve(zr),$r,zr]))return d.error(`Expected first argument to be of type array or string, but found ${We(g.type)} instead`);if(l.length===4){let T=d.parse(l[3],3,Ht);return T?new sf(g.type,g,b,T):null}return new sf(g.type,g,b)}evaluate(l){let d=this.input.evaluate(l),g=this.beginIndex.evaluate(l);if(!ae(d,["string","array"]))throw new Bn(`Expected first argument to be of type array or string, but found ${We(fn(d))} instead.`);if(this.endIndex){let b=this.endIndex.evaluate(l);return d.slice(g,b)}return d.slice(g)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Up(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Vp(f,l,d,g){return g.compare(l,d)===0}function ec(f,l,d){let g=f!=="=="&&f!=="!=";return class $X{constructor(T,C,D){this.type=cr,this.lhs=T,this.rhs=C,this.collator=D,this.hasUntypedArgument=T.type.kind==="value"||C.type.kind==="value"}static parse(T,C){if(T.length!==3&&T.length!==4)return C.error("Expected two or three arguments.");let D=T[0],U=C.parse(T[1],1,zr);if(!U)return null;if(!Up(D,U.type))return C.concat(1).error(`"${D}" comparisons are not supported for type '${We(U.type)}'.`);let $=C.parse(T[2],2,zr);if(!$)return null;if(!Up(D,$.type))return C.concat(2).error(`"${D}" comparisons are not supported for type '${We($.type)}'.`);if(U.type.kind!==$.type.kind&&U.type.kind!=="value"&&$.type.kind!=="value")return C.error(`Cannot compare types '${We(U.type)}' and '${We($.type)}'.`);g&&(U.type.kind==="value"&&$.type.kind!=="value"?U=new Vn($.type,[U]):U.type.kind!=="value"&&$.type.kind==="value"&&($=new Vn(U.type,[$])));let ie=null;if(T.length===4){if(U.type.kind!=="string"&&$.type.kind!=="string"&&U.type.kind!=="value"&&$.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(ie=C.parse(T[3],3,Ao),!ie)return null}return new $X(U,$,ie)}evaluate(T){let C=this.lhs.evaluate(T),D=this.rhs.evaluate(T);if(g&&this.hasUntypedArgument){let U=fn(C),$=fn(D);if(U.kind!==$.kind||U.kind!=="string"&&U.kind!=="number")throw new Bn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${U.kind}, ${$.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){let U=fn(C),$=fn(D);if(U.kind!=="string"||$.kind!=="string")return l(T,C,D)}return this.collator?d(T,C,D,this.collator.evaluate(T)):l(T,C,D)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}let g_=ec("==",function(f,l,d){return l===d},Vp),__=ec("!=",function(f,l,d){return l!==d},function(f,l,d,g){return!Vp(0,l,d,g)}),Ox=ec("<",function(f,l,d){return l<d},function(f,l,d,g){return g.compare(l,d)<0}),Ln=ec(">",function(f,l,d){return l>d},function(f,l,d,g){return g.compare(l,d)>0}),Wp=ec("<=",function(f,l,d){return l<=d},function(f,l,d,g){return g.compare(l,d)<=0}),y_=ec(">=",function(f,l,d){return l>=d},function(f,l,d,g){return g.compare(l,d)>=0});class Wc{constructor(l,d,g,b,T){this.type=$r,this.number=l,this.locale=d,this.currency=g,this.minFractionDigits=b,this.maxFractionDigits=T}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");let g=d.parse(l[1],1,Ht);if(!g)return null;let b=l[2];if(typeof b!="object"||Array.isArray(b))return d.error("NumberFormat options argument must be an object.");let T=null;if(b.locale&&(T=d.parse(b.locale,1,$r),!T))return null;let C=null;if(b.currency&&(C=d.parse(b.currency,1,$r),!C))return null;let D=null;if(b["min-fraction-digits"]&&(D=d.parse(b["min-fraction-digits"],1,Ht),!D))return null;let U=null;return b["max-fraction-digits"]&&(U=d.parse(b["max-fraction-digits"],1,Ht),!U)?null:new Wc(g,T,C,D,U)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class kh{constructor(l){this.type=Oe,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[1];if(!Array.isArray(g)&&typeof g=="object")return d.error("First argument must be an image or text section.");let b=[],T=!1;for(let C=1;C<=l.length-1;++C){let D=l[C];if(T&&typeof D=="object"&&!Array.isArray(D)){T=!1;let U=null;if(D["font-scale"]&&(U=d.parse(D["font-scale"],1,Ht),!U))return null;let $=null;if(D["text-font"]&&($=d.parse(D["text-font"],1,Ve($r)),!$))return null;let ie=null;if(D["text-color"]&&(ie=d.parse(D["text-color"],1,ji),!ie))return null;let ce=b[b.length-1];ce.scale=U,ce.font=$,ce.textColor=ie}else{let U=d.parse(l[C],1,zr);if(!U)return null;let $=U.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,b.push({content:U,scale:null,font:null,textColor:null})}}return new kh(b)}evaluate(l){return new kr(this.sections.map(d=>{let g=d.content.evaluate(l);return fn(g)===ge?new Ur("",g,null,null,null):new Ur(Kr(g),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null)}))}eachChild(l){for(let d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor)}outputDefined(){return!1}}class Ph{constructor(l){this.type=ge,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");let g=d.parse(l[1],1,$r);return g?new Ph(g):d.error("No image name provided.")}evaluate(l){let d=this.input.evaluate(l),g=qr.fromString(d);return g&&l.availableImages&&(g.available=l.availableImages.indexOf(d)>-1),g}eachChild(l){l(this.input)}outputDefined(){return!1}}class yn{constructor(l){this.type=Ht,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);let g=d.parse(l[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${We(g.type)} instead.`):new yn(g):null}evaluate(l){let d=this.input.evaluate(l);if(typeof d=="string"||Array.isArray(d))return d.length;throw new Bn(`Expected value to be of type string or array, but found ${We(fn(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}let Gr={"==":g_,"!=":__,">":Ln,"<":Ox,">=":y_,"<=":Wp,array:Vn,at:Th,boolean:Vn,case:Ch,coalesce:rf,collator:Ss,format:kh,image:Ph,in:Eh,"index-of":of,interpolate:Ho,"interpolate-hcl":Ho,"interpolate-lab":Ho,length:yn,let:nf,literal:lo,match:Ih,number:Vn,"number-format":Wc,object:Vn,slice:sf,step:Fa,string:Vn,"to-boolean":Ai,"to-color":Ai,"to-number":Ai,"to-string":Ai,var:$u,within:ul};function Zp(f,[l,d,g,b]){l=l.evaluate(f),d=d.evaluate(f),g=g.evaluate(f);let T=b?b.evaluate(f):1,C=Nn(l,d,g,T);if(C)throw new Bn(C);return new It(l/255,d/255,g/255,T,!1)}function Yp(f,l){return f in l}function Oh(f,l){let d=l[f];return d===void 0?null:d}function Gs(f){return{type:f}}function fl(f){return{result:"success",value:f}}function Ba(f){return{result:"error",value:f}}function Zc(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function qp(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function Gp(f){return!!f.expression&&f.expression.interpolated}function Fn(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function pi(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function x_(f){return f}function Tn(f,l){let d=l.type==="color",g=f.stops&&typeof f.stops[0][0]=="object",b=g||!(g||f.property!==void 0),T=f.type||(Gp(l)?"exponential":"interval");if(d||l.type==="padding"){let ie=d?It.parse:Pr.parse;(f=eo({},f)).stops&&(f.stops=f.stops.map(ce=>[ce[0],ie(ce[1])])),f.default=ie(f.default?f.default:l.default)}if(f.colorSpace&&(C=f.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var C;let D,U,$;if(T==="exponential")D=Ts;else if(T==="interval")D=li;else if(T==="categorical"){D=mi,U=Object.create(null);for(let ie of f.stops)U[ie[0]]=ie[1];$=typeof f.stops[0][0]}else{if(T!=="identity")throw new Error(`Unknown function type "${T}"`);D=af}if(g){let ie={},ce=[];for(let Te=0;Te<f.stops.length;Te++){let Le=f.stops[Te],He=Le[0].zoom;ie[He]===void 0&&(ie[He]={zoom:He,type:f.type,property:f.property,default:f.default,stops:[]},ce.push(He)),ie[He].stops.push([Le[0].value,Le[1]])}let me=[];for(let Te of ce)me.push([ie[Te].zoom,Tn(ie[Te],l)]);let Ae={name:"linear"};return{kind:"composite",interpolationType:Ae,interpolationFactor:Ho.interpolationFactor.bind(void 0,Ae),zoomStops:me.map(Te=>Te[0]),evaluate:({zoom:Te},Le)=>Ts({stops:me,base:f.base},l,Te).evaluate(Te,Le)}}if(b){let ie=T==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:ie,interpolationFactor:Ho.interpolationFactor.bind(void 0,ie),zoomStops:f.stops.map(ce=>ce[0]),evaluate:({zoom:ce})=>D(f,l,ce,U,$)}}return{kind:"source",evaluate(ie,ce){let me=ce&&ce.properties?ce.properties[f.property]:void 0;return me===void 0?hl(f.default,l.default):D(f,l,me,U,$)}}}function hl(f,l,d){return f!==void 0?f:l!==void 0?l:d!==void 0?d:void 0}function mi(f,l,d,g,b){return hl(typeof d===b?g[d]:void 0,f.default,l.default)}function li(f,l,d){if(Fn(d)!=="number")return hl(f.default,l.default);let g=f.stops.length;if(g===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[g-1][0])return f.stops[g-1][1];let b=Jl(f.stops.map(T=>T[0]),d);return f.stops[b][1]}function Ts(f,l,d){let g=f.base!==void 0?f.base:1;if(Fn(d)!=="number")return hl(f.default,l.default);let b=f.stops.length;if(b===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[b-1][0])return f.stops[b-1][1];let T=Jl(f.stops.map(ie=>ie[0]),d),C=function(ie,ce,me,Ae){let Te=Ae-me,Le=ie-me;return Te===0?0:ce===1?Le/Te:(Math.pow(ce,Le)-1)/(Math.pow(ce,Te)-1)}(d,g,f.stops[T][0],f.stops[T+1][0]),D=f.stops[T][1],U=f.stops[T+1][1],$=Go[l.type]||x_;return typeof D.evaluate=="function"?{evaluate(...ie){let ce=D.evaluate.apply(void 0,ie),me=U.evaluate.apply(void 0,ie);if(ce!==void 0&&me!==void 0)return $(ce,me,C,f.colorSpace)}}:$(D,U,C,f.colorSpace)}function af(f,l,d){switch(l.type){case"color":d=It.parse(d);break;case"formatted":d=kr.fromString(d.toString());break;case"resolvedImage":d=qr.fromString(d.toString());break;case"padding":d=Pr.parse(d);break;default:Fn(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return hl(d,f.default,l.default)}cs.register(Gr,{error:[{kind:"error"},[$r],(f,[l])=>{throw new Bn(l.evaluate(f))}],typeof:[$r,[zr],(f,[l])=>We(fn(l.evaluate(f)))],"to-rgba":[Ve(Ht,4),[ji],(f,[l])=>{let[d,g,b,T]=l.evaluate(f).rgb;return[255*d,255*g,255*b,T]}],rgb:[ji,[Ht,Ht,Ht],Zp],rgba:[ji,[Ht,Ht,Ht,Ht],Zp],has:{type:cr,overloads:[[[$r],(f,[l])=>Yp(l.evaluate(f),f.properties())],[[$r,to],(f,[l,d])=>Yp(l.evaluate(f),d.evaluate(f))]]},get:{type:zr,overloads:[[[$r],(f,[l])=>Oh(l.evaluate(f),f.properties())],[[$r,to],(f,[l,d])=>Oh(l.evaluate(f),d.evaluate(f))]]},"feature-state":[zr,[$r],(f,[l])=>Oh(l.evaluate(f),f.featureState||{})],properties:[to,[],f=>f.properties()],"geometry-type":[$r,[],f=>f.geometryType()],id:[zr,[],f=>f.id()],zoom:[Ht,[],f=>f.globals.zoom],"heatmap-density":[Ht,[],f=>f.globals.heatmapDensity||0],"line-progress":[Ht,[],f=>f.globals.lineProgress||0],accumulated:[zr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Ht,Gs(Ht),(f,l)=>{let d=0;for(let g of l)d+=g.evaluate(f);return d}],"*":[Ht,Gs(Ht),(f,l)=>{let d=1;for(let g of l)d*=g.evaluate(f);return d}],"-":{type:Ht,overloads:[[[Ht,Ht],(f,[l,d])=>l.evaluate(f)-d.evaluate(f)],[[Ht],(f,[l])=>-l.evaluate(f)]]},"/":[Ht,[Ht,Ht],(f,[l,d])=>l.evaluate(f)/d.evaluate(f)],"%":[Ht,[Ht,Ht],(f,[l,d])=>l.evaluate(f)%d.evaluate(f)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(f,[l,d])=>Math.pow(l.evaluate(f),d.evaluate(f))],sqrt:[Ht,[Ht],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Ht,[Ht],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Ht,[Ht],(f,[l])=>Math.log(l.evaluate(f))],log2:[Ht,[Ht],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Ht,[Ht],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Ht,[Ht],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Ht,[Ht],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Ht,[Ht],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Ht,[Ht],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Ht,[Ht],(f,[l])=>Math.atan(l.evaluate(f))],min:[Ht,Gs(Ht),(f,l)=>Math.min(...l.map(d=>d.evaluate(f)))],max:[Ht,Gs(Ht),(f,l)=>Math.max(...l.map(d=>d.evaluate(f)))],abs:[Ht,[Ht],(f,[l])=>Math.abs(l.evaluate(f))],round:[Ht,[Ht],(f,[l])=>{let d=l.evaluate(f);return d<0?-Math.round(-d):Math.round(d)}],floor:[Ht,[Ht],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Ht,[Ht],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[cr,[$r,zr],(f,[l,d])=>f.properties()[l.value]===d.value],"filter-id-==":[cr,[zr],(f,[l])=>f.id()===l.value],"filter-type-==":[cr,[$r],(f,[l])=>f.geometryType()===l.value],"filter-<":[cr,[$r,zr],(f,[l,d])=>{let g=f.properties()[l.value],b=d.value;return typeof g==typeof b&&g<b}],"filter-id-<":[cr,[zr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<g}],"filter->":[cr,[$r,zr],(f,[l,d])=>{let g=f.properties()[l.value],b=d.value;return typeof g==typeof b&&g>b}],"filter-id->":[cr,[zr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>g}],"filter-<=":[cr,[$r,zr],(f,[l,d])=>{let g=f.properties()[l.value],b=d.value;return typeof g==typeof b&&g<=b}],"filter-id-<=":[cr,[zr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<=g}],"filter->=":[cr,[$r,zr],(f,[l,d])=>{let g=f.properties()[l.value],b=d.value;return typeof g==typeof b&&g>=b}],"filter-id->=":[cr,[zr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>=g}],"filter-has":[cr,[zr],(f,[l])=>l.value in f.properties()],"filter-has-id":[cr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[cr,[Ve($r)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[cr,[Ve(zr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[cr,[$r,Ve(zr)],(f,[l,d])=>d.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[cr,[$r,Ve(zr)],(f,[l,d])=>function(g,b,T,C){for(;T<=C;){let D=T+C>>1;if(b[D]===g)return!0;b[D]>g?C=D-1:T=D+1}return!1}(f.properties()[l.value],d.value,0,d.value.length-1)],all:{type:cr,overloads:[[[cr,cr],(f,[l,d])=>l.evaluate(f)&&d.evaluate(f)],[Gs(cr),(f,l)=>{for(let d of l)if(!d.evaluate(f))return!1;return!0}]]},any:{type:cr,overloads:[[[cr,cr],(f,[l,d])=>l.evaluate(f)||d.evaluate(f)],[Gs(cr),(f,l)=>{for(let d of l)if(d.evaluate(f))return!0;return!1}]]},"!":[cr,[cr],(f,[l])=>!l.evaluate(f)],"is-supported-script":[cr,[$r],(f,[l])=>{let d=f.globals&&f.globals.isSupportedScript;return!d||d(l.evaluate(f))}],upcase:[$r,[$r],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[$r,[$r],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[$r,Gs(zr),(f,l)=>l.map(d=>Kr(d.evaluate(f))).join("")],"resolved-locale":[$r,[Ao],(f,[l])=>l.evaluate(f).resolvedLocale()]});class Rh{constructor(l,d){var g;this.expression=l,this._warningHistory={},this._evaluator=new As,this._defaultValue=d?(g=d).type==="color"&&pi(g.default)?new It(0,0,0,0):g.type==="color"?It.parse(g.default)||null:g.type==="padding"?Pr.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?on.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,g,b,T,C){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=g,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(l,d,g,b,T,C){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=g||null,this._evaluator.canonical=b,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=C||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Bn(`Expected value to be one of ${Object.keys(this._enumValues).map(U=>JSON.stringify(U)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function lf(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Gr}function Nh(f,l){let d=new Ms(Gr,Qu,[],l?function(b){let T={color:ji,string:$r,number:Ht,enum:$r,boolean:cr,formatted:Oe,padding:ue,resolvedImage:ge,variableAnchorOffsetCollection:ke};return b.type==="array"?Ve(T[b.value]||zr,b.length):T[b.type]}(l):void 0),g=d.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?fl(new Rh(g,l)):Ba(d.errors)}class Hp{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!Vc(d.expression)}evaluateWithoutErrorHandling(l,d,g,b,T,C){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,b,T,C)}evaluate(l,d,g,b,T,C){return this._styleExpression.evaluate(l,d,g,b,T,C)}}class zh{constructor(l,d,g,b){this.kind=l,this.zoomStops=g,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!Vc(d.expression),this.interpolationType=b}evaluateWithoutErrorHandling(l,d,g,b,T,C){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,b,T,C)}evaluate(l,d,g,b,T,C){return this._styleExpression.evaluate(l,d,g,b,T,C)}interpolationFactor(l,d,g){return this.interpolationType?Ho.interpolationFactor(this.interpolationType,l,d,g):0}}function Xp(f,l){let d=Nh(f,l);if(d.result==="error")return d;let g=d.value.expression,b=Ju(g);if(!b&&!Zc(l))return Ba([new Xn("","data expressions not supported")]);let T=ef(g,["zoom"]);if(!T&&!qp(l))return Ba([new Xn("","zoom expressions not supported")]);let C=cf(g);return C||T?C instanceof Xn?Ba([C]):C instanceof Ho&&!Gp(l)?Ba([new Xn("",'"interpolate" expressions cannot be used with this property')]):fl(C?new zh(b?"camera":"composite",d.value,C.labels,C instanceof Ho?C.interpolation:void 0):new Hp(b?"constant":"source",d.value)):Ba([new Xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tc{constructor(l,d){this._parameters=l,this._specification=d,eo(this,Tn(this._parameters,this._specification))}static deserialize(l){return new tc(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function cf(f){let l=null;if(f instanceof nf)l=cf(f.result);else if(f instanceof rf){for(let d of f.args)if(l=cf(d),l)break}else(f instanceof Fa||f instanceof Ho)&&f.input instanceof cs&&f.input.name==="zoom"&&(l=f);return l instanceof Xn||f.eachChild(d=>{let g=cf(d);g instanceof Xn?l=g:!l&&g?l=new Xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&g&&l!==g&&(l=new Xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Yc(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(let l of f.slice(1))if(!Yc(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}let dl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Kp(f){if(f==null)return{filter:()=>!0,needGeometry:!1};Yc(f)||(f=Dh(f));let l=Nh(f,dl);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,g,b)=>l.value.evaluate(d,g,{},b),needGeometry:b_(f)}}function Rx(f,l){return f<l?-1:f>l?1:0}function b_(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(let l=1;l<f.length;l++)if(b_(f[l]))return!0;return!1}function Dh(f){if(!f)return!0;let l=f[0];return f.length<=1?l!=="any":l==="=="?$p(f[1],f[2],"=="):l==="!="?qc($p(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?$p(f[1],f[2],l):l==="any"?(d=f.slice(1),["any"].concat(d.map(Dh))):l==="all"?["all"].concat(f.slice(1).map(Dh)):l==="none"?["all"].concat(f.slice(1).map(Dh).map(qc)):l==="in"?v_(f[1],f.slice(2)):l==="!in"?qc(v_(f[1],f.slice(2))):l==="has"?Qp(f[1]):l==="!has"?qc(Qp(f[1])):l!=="within"||f;var d}function $p(f,l,d){switch(f){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,f,l]}}function v_(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",f,["literal",l.sort(Rx)]]:["filter-in-small",f,["literal",l]]}}function Qp(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function qc(f){return["!",f]}function Lh(f){let l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let b="[";for(let T of f)b+=`${Lh(T)},`;return`${b}]`}let d=Object.keys(f).sort(),g="{";for(let b=0;b<d.length;b++)g+=`${JSON.stringify(d[b])}:${Lh(f[d[b]])},`;return`${g}}`}function Fh(f){let l="";for(let d of ei)l+=`/${Lh(f[d])}`;return l}function Jp(f){let l=f.value;return l?[new Zt(f.key,l,"constants have been deprecated as of v8")]:[]}function gi(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function pl(f){if(Array.isArray(f))return f.map(pl);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){let l={};for(let d in f)l[d]=pl(f[d]);return l}return gi(f)}function Xo(f){let l=f.key,d=f.value,g=f.valueSpec||{},b=f.objectElementValidators||{},T=f.style,C=f.styleSpec,D=f.validateSpec,U=[],$=Fn(d);if($!=="object")return[new Zt(l,d,`object expected, ${$} found`)];for(let ie in d){let ce=ie.split(".")[0],me=g[ce]||g["*"],Ae;if(b[ce])Ae=b[ce];else if(g[ce])Ae=D;else if(b["*"])Ae=b["*"];else{if(!g["*"]){U.push(new Zt(l,d[ie],`unknown property "${ie}"`));continue}Ae=D}U=U.concat(Ae({key:(l&&`${l}.`)+ie,value:d[ie],valueSpec:me,style:T,styleSpec:C,object:d,objectKey:ie,validateSpec:D},d))}for(let ie in g)b[ie]||g[ie].required&&g[ie].default===void 0&&d[ie]===void 0&&U.push(new Zt(l,d,`missing required property "${ie}"`));return U}function Gc(f){let l=f.value,d=f.valueSpec,g=f.style,b=f.styleSpec,T=f.key,C=f.arrayElementValidator||f.validateSpec;if(Fn(l)!=="array")return[new Zt(T,l,`array expected, ${Fn(l)} found`)];if(d.length&&l.length!==d.length)return[new Zt(T,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new Zt(T,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let D={type:d.value,values:d.values};b.$version<7&&(D.function=d.function),Fn(d.value)==="object"&&(D=d.value);let U=[];for(let $=0;$<l.length;$++)U=U.concat(C({array:l,arrayIndex:$,value:l[$],valueSpec:D,validateSpec:f.validateSpec,style:g,styleSpec:b,key:`${T}[${$}]`}));return U}function uf(f){let l=f.key,d=f.value,g=f.valueSpec,b=Fn(d);return b==="number"&&d!=d&&(b="NaN"),b!=="number"?[new Zt(l,d,`number expected, ${b} found`)]:"minimum"in g&&d<g.minimum?[new Zt(l,d,`${d} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&d>g.maximum?[new Zt(l,d,`${d} is greater than the maximum value ${g.maximum}`)]:[]}function Bh(f){let l=f.valueSpec,d=gi(f.value.type),g,b,T,C={},D=d!=="categorical"&&f.value.property===void 0,U=!D,$=Fn(f.value.stops)==="array"&&Fn(f.value.stops[0])==="array"&&Fn(f.value.stops[0][0])==="object",ie=Xo({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Ae){if(d==="identity")return[new Zt(Ae.key,Ae.value,'identity function may not have a "stops" property')];let Te=[],Le=Ae.value;return Te=Te.concat(Gc({key:Ae.key,value:Le,valueSpec:Ae.valueSpec,validateSpec:Ae.validateSpec,style:Ae.style,styleSpec:Ae.styleSpec,arrayElementValidator:ce})),Fn(Le)==="array"&&Le.length===0&&Te.push(new Zt(Ae.key,Le,"array must have at least one stop")),Te},default:function(Ae){return Ae.validateSpec({key:Ae.key,value:Ae.value,valueSpec:l,validateSpec:Ae.validateSpec,style:Ae.style,styleSpec:Ae.styleSpec})}}});return d==="identity"&&D&&ie.push(new Zt(f.key,f.value,'missing required property "property"')),d==="identity"||f.value.stops||ie.push(new Zt(f.key,f.value,'missing required property "stops"')),d==="exponential"&&f.valueSpec.expression&&!Gp(f.valueSpec)&&ie.push(new Zt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(U&&!Zc(f.valueSpec)?ie.push(new Zt(f.key,f.value,"property functions not supported")):D&&!qp(f.valueSpec)&&ie.push(new Zt(f.key,f.value,"zoom functions not supported"))),d!=="categorical"&&!$||f.value.property!==void 0||ie.push(new Zt(f.key,f.value,'"property" property is required')),ie;function ce(Ae){let Te=[],Le=Ae.value,He=Ae.key;if(Fn(Le)!=="array")return[new Zt(He,Le,`array expected, ${Fn(Le)} found`)];if(Le.length!==2)return[new Zt(He,Le,`array length 2 expected, length ${Le.length} found`)];if($){if(Fn(Le[0])!=="object")return[new Zt(He,Le,`object expected, ${Fn(Le[0])} found`)];if(Le[0].zoom===void 0)return[new Zt(He,Le,"object stop key must have zoom")];if(Le[0].value===void 0)return[new Zt(He,Le,"object stop key must have value")];if(T&&T>gi(Le[0].zoom))return[new Zt(He,Le[0].zoom,"stop zoom values must appear in ascending order")];gi(Le[0].zoom)!==T&&(T=gi(Le[0].zoom),b=void 0,C={}),Te=Te.concat(Xo({key:`${He}[0]`,value:Le[0],valueSpec:{zoom:{}},validateSpec:Ae.validateSpec,style:Ae.style,styleSpec:Ae.styleSpec,objectElementValidators:{zoom:uf,value:me}}))}else Te=Te.concat(me({key:`${He}[0]`,value:Le[0],valueSpec:{},validateSpec:Ae.validateSpec,style:Ae.style,styleSpec:Ae.styleSpec},Le));return lf(pl(Le[1]))?Te.concat([new Zt(`${He}[1]`,Le[1],"expressions are not allowed in function stops.")]):Te.concat(Ae.validateSpec({key:`${He}[1]`,value:Le[1],valueSpec:l,validateSpec:Ae.validateSpec,style:Ae.style,styleSpec:Ae.styleSpec}))}function me(Ae,Te){let Le=Fn(Ae.value),He=gi(Ae.value),Qe=Ae.value!==null?Ae.value:Te;if(g){if(Le!==g)return[new Zt(Ae.key,Qe,`${Le} stop domain type must match previous stop domain type ${g}`)]}else g=Le;if(Le!=="number"&&Le!=="string"&&Le!=="boolean")return[new Zt(Ae.key,Qe,"stop domain value must be a number, string, or boolean")];if(Le!=="number"&&d!=="categorical"){let lt=`number expected, ${Le} found`;return Zc(l)&&d===void 0&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zt(Ae.key,Qe,lt)]}return d!=="categorical"||Le!=="number"||isFinite(He)&&Math.floor(He)===He?d!=="categorical"&&Le==="number"&&b!==void 0&&He<b?[new Zt(Ae.key,Qe,"stop domain values must appear in ascending order")]:(b=He,d==="categorical"&&He in C?[new Zt(Ae.key,Qe,"stop domain values must be unique")]:(C[He]=!0,[])):[new Zt(Ae.key,Qe,`integer expected, found ${He}`)]}}function ja(f){let l=(f.expressionContext==="property"?Xp:Nh)(pl(f.value),f.valueSpec);if(l.result==="error")return l.value.map(g=>new Zt(`${f.key}${g.key}`,f.value,g.message));let d=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!d.outputDefined())return[new Zt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!Vc(d))return[new Zt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!Vc(d))return[new Zt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!ef(d,["zoom","feature-state"]))return[new Zt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Ju(d))return[new Zt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ff(f){let l=f.key,d=f.value,g=f.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(gi(d))===-1&&b.push(new Zt(l,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(gi(d))===-1&&b.push(new Zt(l,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Hc(f){return Yc(pl(f.value))?ja(eo({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):w_(f)}function w_(f){let l=f.value,d=f.key;if(Fn(l)!=="array")return[new Zt(d,l,`array expected, ${Fn(l)} found`)];let g=f.styleSpec,b,T=[];if(l.length<1)return[new Zt(d,l,"filter array must have at least 1 element")];switch(T=T.concat(ff({key:`${d}[0]`,value:l[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),gi(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&gi(l[1])==="$type"&&T.push(new Zt(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new Zt(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=Fn(l[1]),b!=="string"&&T.push(new Zt(`${d}[1]`,l[1],`string expected, ${b} found`)));for(let C=2;C<l.length;C++)b=Fn(l[C]),gi(l[1])==="$type"?T=T.concat(ff({key:`${d}[${C}]`,value:l[C],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new Zt(`${d}[${C}]`,l[C],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let C=1;C<l.length;C++)T=T.concat(w_({key:`${d}[${C}]`,value:l[C],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":b=Fn(l[1]),l.length!==2?T.push(new Zt(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new Zt(`${d}[1]`,l[1],`string expected, ${b} found`));break;case"within":b=Fn(l[1]),l.length!==2?T.push(new Zt(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="object"&&T.push(new Zt(`${d}[1]`,l[1],`object expected, ${b} found`))}return T}function A_(f,l){let d=f.key,g=f.validateSpec,b=f.style,T=f.styleSpec,C=f.value,D=f.objectKey,U=T[`${l}_${f.layerType}`];if(!U)return[];let $=D.match(/^(.*)-transition$/);if(l==="paint"&&$&&U[$[1]]&&U[$[1]].transition)return g({key:d,value:C,valueSpec:T.transition,style:b,styleSpec:T});let ie=f.valueSpec||U[D];if(!ie)return[new Zt(d,C,`unknown property "${D}"`)];let ce;if(Fn(C)==="string"&&Zc(ie)&&!ie.tokens&&(ce=/^{([^}]+)}$/.exec(C)))return[new Zt(d,C,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ce[1])} }\`.`)];let me=[];return f.layerType==="symbol"&&(D==="text-field"&&b&&!b.glyphs&&me.push(new Zt(d,C,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&pi(pl(C))&&gi(C.type)==="identity"&&me.push(new Zt(d,C,'"text-font" does not support identity functions'))),me.concat(g({key:f.key,value:C,valueSpec:ie,style:b,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:D}))}function M_(f){return A_(f,"paint")}function S_(f){return A_(f,"layout")}function jh(f){let l=[],d=f.value,g=f.key,b=f.style,T=f.styleSpec;d.type||d.ref||l.push(new Zt(g,d,'either "type" or "ref" is required'));let C=gi(d.type),D=gi(d.ref);if(d.id){let U=gi(d.id);for(let $=0;$<f.arrayIndex;$++){let ie=b.layers[$];gi(ie.id)===U&&l.push(new Zt(g,d.id,`duplicate layer id "${d.id}", previously used at line ${ie.id.__line__}`))}}if("ref"in d){let U;["type","source","source-layer","filter","layout"].forEach($=>{$ in d&&l.push(new Zt(g,d[$],`"${$}" is prohibited for ref layers`))}),b.layers.forEach($=>{gi($.id)===D&&(U=$)}),U?U.ref?l.push(new Zt(g,d.ref,"ref cannot reference another ref layer")):C=gi(U.type):l.push(new Zt(g,d.ref,`ref layer "${D}" not found`))}else if(C!=="background")if(d.source){let U=b.sources&&b.sources[d.source],$=U&&gi(U.type);U?$==="vector"&&C==="raster"?l.push(new Zt(g,d.source,`layer "${d.id}" requires a raster source`)):$!=="raster-dem"&&C==="hillshade"?l.push(new Zt(g,d.source,`layer "${d.id}" requires a raster-dem source`)):$==="raster"&&C!=="raster"?l.push(new Zt(g,d.source,`layer "${d.id}" requires a vector source`)):$!=="vector"||d["source-layer"]?$==="raster-dem"&&C!=="hillshade"?l.push(new Zt(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!d.paint||!d.paint["line-gradient"]||$==="geojson"&&U.lineMetrics||l.push(new Zt(g,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Zt(g,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new Zt(g,d.source,`source "${d.source}" not found`))}else l.push(new Zt(g,d,'missing required property "source"'));return l=l.concat(Xo({key:g,value:d,valueSpec:T.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${g}.type`,value:d.type,valueSpec:T.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:d,objectKey:"type"}),filter:Hc,layout:U=>Xo({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":$=>S_(eo({layerType:C},$))}}),paint:U=>Xo({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":$=>M_(eo({layerType:C},$))}})}})),l}function Hs(f){let l=f.value,d=f.key,g=Fn(l);return g!=="string"?[new Zt(d,l,`string expected, ${g} found`)]:[]}let hf={promoteId:function({key:f,value:l}){if(Fn(l)==="string")return Hs({key:f,value:l});{let d=[];for(let g in l)d.push(...Hs({key:`${f}.${g}`,value:l[g]}));return d}}};function Ko(f){let l=f.value,d=f.key,g=f.styleSpec,b=f.style,T=f.validateSpec;if(!l.type)return[new Zt(d,l,'"type" is required')];let C=gi(l.type),D;switch(C){case"vector":case"raster":return D=Xo({key:d,value:l,valueSpec:g[`source_${C.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:hf,validateSpec:T}),D;case"raster-dem":return D=function(U){var $;let ie=($=U.sourceName)!==null&&$!==void 0?$:"",ce=U.value,me=U.styleSpec,Ae=me.source_raster_dem,Te=U.style,Le=[],He=Fn(ce);if(ce===void 0)return Le;if(He!=="object")return Le.push(new Zt("source_raster_dem",ce,`object expected, ${He} found`)),Le;let Qe=gi(ce.encoding)==="custom",lt=["redFactor","greenFactor","blueFactor","baseShift"],tt=U.value.encoding?`"${U.value.encoding}"`:"Default";for(let ct in ce)!Qe&&lt.includes(ct)?Le.push(new Zt(ct,ce[ct],`In "${ie}": "${ct}" is only valid when "encoding" is set to "custom". ${tt} encoding found`)):Ae[ct]?Le=Le.concat(U.validateSpec({key:ct,value:ce[ct],valueSpec:Ae[ct],validateSpec:U.validateSpec,style:Te,styleSpec:me})):Le.push(new Zt(ct,ce[ct],`unknown property "${ct}"`));return Le}({sourceName:d,value:l,style:f.style,styleSpec:g,validateSpec:T}),D;case"geojson":if(D=Xo({key:d,value:l,valueSpec:g.source_geojson,style:b,styleSpec:g,validateSpec:T,objectElementValidators:hf}),l.cluster)for(let U in l.clusterProperties){let[$,ie]=l.clusterProperties[U],ce=typeof $=="string"?[$,["accumulated"],["get",U]]:$;D.push(...ja({key:`${d}.${U}.map`,value:ie,validateSpec:T,expressionContext:"cluster-map"})),D.push(...ja({key:`${d}.${U}.reduce`,value:ce,validateSpec:T,expressionContext:"cluster-reduce"}))}return D;case"video":return Xo({key:d,value:l,valueSpec:g.source_video,style:b,validateSpec:T,styleSpec:g});case"image":return Xo({key:d,value:l,valueSpec:g.source_image,style:b,validateSpec:T,styleSpec:g});case"canvas":return[new Zt(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ff({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:T,styleSpec:g})}}function df(f){let l=f.value,d=f.styleSpec,g=d.light,b=f.style,T=[],C=Fn(l);if(l===void 0)return T;if(C!=="object")return T=T.concat([new Zt("light",l,`object expected, ${C} found`)]),T;for(let D in l){let U=D.match(/^(.*)-transition$/);T=T.concat(U&&g[U[1]]&&g[U[1]].transition?f.validateSpec({key:D,value:l[D],valueSpec:d.transition,validateSpec:f.validateSpec,style:b,styleSpec:d}):g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:b,styleSpec:d}):[new Zt(D,l[D],`unknown property "${D}"`)])}return T}function em(f){let l=f.value,d=f.styleSpec,g=d.terrain,b=f.style,T=[],C=Fn(l);if(l===void 0)return T;if(C!=="object")return T=T.concat([new Zt("terrain",l,`object expected, ${C} found`)]),T;for(let D in l)T=T.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:b,styleSpec:d}):[new Zt(D,l[D],`unknown property "${D}"`)]);return T}function T_(f){let l=[],d=f.value,g=f.key;if(Array.isArray(d)){let b=[],T=[];for(let C in d)d[C].id&&b.includes(d[C].id)&&l.push(new Zt(g,d,`all the sprites' ids must be unique, but ${d[C].id} is duplicated`)),b.push(d[C].id),d[C].url&&T.includes(d[C].url)&&l.push(new Zt(g,d,`all the sprites' URLs must be unique, but ${d[C].url} is duplicated`)),T.push(d[C].url),l=l.concat(Xo({key:`${g}[${C}]`,value:d[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return Hs({key:g,value:d})}let Uh={"*":()=>[],array:Gc,boolean:function(f){let l=f.value,d=f.key,g=Fn(l);return g!=="boolean"?[new Zt(d,l,`boolean expected, ${g} found`)]:[]},number:uf,color:function(f){let l=f.key,d=f.value,g=Fn(d);return g!=="string"?[new Zt(l,d,`color expected, ${g} found`)]:It.parse(String(d))?[]:[new Zt(l,d,`color expected, "${d}" found`)]},constants:Jp,enum:ff,filter:Hc,function:Bh,layer:jh,object:Xo,source:Ko,light:df,terrain:em,string:Hs,formatted:function(f){return Hs(f).length===0?[]:ja(f)},resolvedImage:function(f){return Hs(f).length===0?[]:ja(f)},padding:function(f){let l=f.key,d=f.value;if(Fn(d)==="array"){if(d.length<1||d.length>4)return[new Zt(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];let g={type:"number"},b=[];for(let T=0;T<d.length;T++)b=b.concat(f.validateSpec({key:`${l}[${T}]`,value:d[T],validateSpec:f.validateSpec,valueSpec:g}));return b}return uf({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(f){let l=f.key,d=f.value,g=Fn(d),b=f.styleSpec;if(g!=="array"||d.length<1||d.length%2!=0)return[new Zt(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let C=0;C<d.length;C+=2)T=T.concat(ff({key:`${l}[${C}]`,value:d[C],valueSpec:b.layout_symbol["text-anchor"]})),T=T.concat(Gc({key:`${l}[${C+1}]`,value:d[C+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:b}));return T},sprite:T_};function Ua(f){let l=f.value,d=f.valueSpec,g=f.styleSpec;return f.validateSpec=Ua,d.expression&&pi(gi(l))?Bh(f):d.expression&&lf(pl(l))?ja(f):d.type&&Uh[d.type]?Uh[d.type](f):Xo(eo({},f,{valueSpec:d.type?g[d.type]:d}))}function E_(f){let l=f.value,d=f.key,g=Hs(f);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new Zt(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new Zt(d,l,'"glyphs" url must include a "{range}" token'))),g}function Es(f,l=xt){let d=[];return d=d.concat(Ua({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:Ua,objectElementValidators:{glyphs:E_,"*":()=>[]}})),f.constants&&(d=d.concat(Jp({key:"constants",value:f.constants,style:f,styleSpec:l,validateSpec:Ua}))),Vh(d)}function Va(f){return function(l){return f({...l,validateSpec:Ua})}}function Vh(f){return[].concat(f).sort((l,d)=>l.line-d.line)}function Wa(f){return function(...l){return Vh(f.apply(this,l))}}Es.source=Wa(Va(Ko)),Es.sprite=Wa(Va(T_)),Es.glyphs=Wa(Va(E_)),Es.light=Wa(Va(df)),Es.terrain=Wa(Va(em)),Es.layer=Wa(Va(jh)),Es.filter=Wa(Va(Hc)),Es.paintProperty=Wa(Va(M_)),Es.layoutProperty=Wa(Va(S_));let Xs=Es,tm=Xs.light,pf=Xs.paintProperty,rm=Xs.layoutProperty;function mf(f,l){let d=!1;if(l&&l.length)for(let g of l)f.fire(new Rn(new Error(g.message))),d=!0;return d}class Xc{constructor(l,d,g){let b=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;let C=new Int32Array(this.arrayBuffer);l=C[0],this.d=(d=C[1])+2*(g=C[2]);for(let U=0;U<this.d*this.d;U++){let $=C[3+U],ie=C[3+U+1];b.push($===ie?null:C.subarray($,ie))}let D=C[3+b.length+1];this.keys=C.subarray(C[3+b.length],D),this.bboxes=C.subarray(D),this.insert=this._insertReadonly}else{this.d=d+2*g;for(let C=0;C<this.d*this.d;C++)b.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=g,this.scale=d/l,this.uid=0;let T=g/d*l;this.min=-T,this.max=l+T}insert(l,d,g,b,T){this._forEachCell(d,g,b,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,g,b,T,C){this.cells[T].push(C)}query(l,d,g,b,T){let C=this.min,D=this.max;if(l<=C&&d<=C&&D<=g&&D<=b&&!T)return Array.prototype.slice.call(this.keys);{let U=[];return this._forEachCell(l,d,g,b,this._queryCell,U,{},T),U}}_queryCell(l,d,g,b,T,C,D,U){let $=this.cells[T];if($!==null){let ie=this.keys,ce=this.bboxes;for(let me=0;me<$.length;me++){let Ae=$[me];if(D[Ae]===void 0){let Te=4*Ae;(U?U(ce[Te+0],ce[Te+1],ce[Te+2],ce[Te+3]):l<=ce[Te+2]&&d<=ce[Te+3]&&g>=ce[Te+0]&&b>=ce[Te+1])?(D[Ae]=!0,C.push(ie[Ae])):D[Ae]=!1}}}}_forEachCell(l,d,g,b,T,C,D,U){let $=this._convertToCellCoord(l),ie=this._convertToCellCoord(d),ce=this._convertToCellCoord(g),me=this._convertToCellCoord(b);for(let Ae=$;Ae<=ce;Ae++)for(let Te=ie;Te<=me;Te++){let Le=this.d*Te+Ae;if((!U||U(this._convertFromCellCoord(Ae),this._convertFromCellCoord(Te),this._convertFromCellCoord(Ae+1),this._convertFromCellCoord(Te+1)))&&T.call(this,l,d,g,b,Le,C,D,U))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let l=this.cells,d=3+this.cells.length+1+1,g=0;for(let C=0;C<this.cells.length;C++)g+=this.cells[C].length;let b=new Int32Array(d+g+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let T=d;for(let C=0;C<l.length;C++){let D=l[C];b[3+C]=T,b.set(D,T),T+=D.length}return b[3+l.length]=T,b.set(this.keys,T),T+=this.keys.length,b[3+l.length+1]=T,b.set(this.bboxes,T),T+=this.bboxes.length,b.buffer}static serialize(l,d){let g=l.toArrayBuffer();return d&&d.push(g),{buffer:g}}static deserialize(l){return new Xc(l.buffer)}}let Za={};function _r(f,l,d={}){if(Za[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),Za[f]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}_r("Object",Object),_r("TransferableGridIndex",Xc),_r("Color",It),_r("Error",Error),_r("AJAXError",wr),_r("ResolvedImage",qr),_r("StylePropertyFunction",tc),_r("StyleExpression",Rh,{omit:["_evaluator"]}),_r("ZoomDependentExpression",zh),_r("ZoomConstantExpression",Hp),_r("CompoundExpression",cs,{omit:["_evaluate"]});for(let f in Gr)Gr[f]._classRegistryKey||_r(`Expression_${f}`,Gr[f]);function Wh(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function ml(f,l){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob)return f;if(Wh(f)||Je(f))return l&&l.push(f),f;if(ArrayBuffer.isView(f)){let d=f;return l&&l.push(d.buffer),d}if(f instanceof ImageData)return l&&l.push(f.data.buffer),f;if(Array.isArray(f)){let d=[];for(let g of f)d.push(ml(g,l));return d}if(typeof f=="object"){let d=f.constructor,g=d._classRegistryKey;if(!g)throw new Error("can't serialize object of unregistered class");if(!Za[g])throw new Error(`${g} is not registered.`);let b=d.serialize?d.serialize(f,l):{};if(d.serialize){if(l&&b===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let T in f){if(!f.hasOwnProperty(T)||Za[g].omit.indexOf(T)>=0)continue;let C=f[T];b[T]=Za[g].shallow.indexOf(T)>=0?C:ml(C,l)}f instanceof Error&&(b.message=f.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(b.$name=g),b}throw new Error("can't serialize object of type "+typeof f)}function Kc(f){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||Wh(f)||Je(f)||ArrayBuffer.isView(f)||f instanceof ImageData)return f;if(Array.isArray(f))return f.map(Kc);if(typeof f=="object"){let l=f.$name||"Object";if(!Za[l])throw new Error(`can't deserialize unregistered class ${l}`);let{klass:d}=Za[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(f);let g=Object.create(d.prototype);for(let b of Object.keys(f)){if(b==="$name")continue;let T=f[b];g[b]=Za[l].shallow.indexOf(b)>=0?T:Kc(T)}return g}throw new Error("can't deserialize object of type "+typeof f)}class I_{constructor(){this.first=!0}update(l,d){let g=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=g,!0))}}let ir={"Latin-1 Supplement":f=>f>=128&&f<=255,Arabic:f=>f>=1536&&f<=1791,"Arabic Supplement":f=>f>=1872&&f<=1919,"Arabic Extended-A":f=>f>=2208&&f<=2303,"Hangul Jamo":f=>f>=4352&&f<=4607,"Unified Canadian Aboriginal Syllabics":f=>f>=5120&&f<=5759,Khmer:f=>f>=6016&&f<=6143,"Unified Canadian Aboriginal Syllabics Extended":f=>f>=6320&&f<=6399,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"CJK Radicals Supplement":f=>f>=11904&&f<=12031,"Kangxi Radicals":f=>f>=12032&&f<=12255,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Bopomofo:f=>f>=12544&&f<=12591,"Hangul Compatibility Jamo":f=>f>=12592&&f<=12687,Kanbun:f=>f>=12688&&f<=12703,"Bopomofo Extended":f=>f>=12704&&f<=12735,"CJK Strokes":f=>f>=12736&&f<=12783,"Katakana Phonetic Extensions":f=>f>=12784&&f<=12799,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"CJK Unified Ideographs Extension A":f=>f>=13312&&f<=19903,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Yi Syllables":f=>f>=40960&&f<=42127,"Yi Radicals":f=>f>=42128&&f<=42191,"Hangul Jamo Extended-A":f=>f>=43360&&f<=43391,"Hangul Syllables":f=>f>=44032&&f<=55215,"Hangul Jamo Extended-B":f=>f>=55216&&f<=55295,"Private Use Area":f=>f>=57344&&f<=63743,"CJK Compatibility Ideographs":f=>f>=63744&&f<=64255,"Arabic Presentation Forms-A":f=>f>=64336&&f<=65023,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Arabic Presentation Forms-B":f=>f>=65136&&f<=65279,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function nm(f){for(let l of f)if(om(l.charCodeAt(0)))return!0;return!1}function im(f){for(let l of f)if(!gl(l.charCodeAt(0)))return!1;return!0}function gl(f){return!(ir.Arabic(f)||ir["Arabic Supplement"](f)||ir["Arabic Extended-A"](f)||ir["Arabic Presentation Forms-A"](f)||ir["Arabic Presentation Forms-B"](f))}function om(f){return!(f!==746&&f!==747&&(f<4352||!(ir["Bopomofo Extended"](f)||ir.Bopomofo(f)||ir["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||ir["CJK Compatibility Ideographs"](f)||ir["CJK Compatibility"](f)||ir["CJK Radicals Supplement"](f)||ir["CJK Strokes"](f)||!(!ir["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||ir["CJK Unified Ideographs Extension A"](f)||ir["CJK Unified Ideographs"](f)||ir["Enclosed CJK Letters and Months"](f)||ir["Hangul Compatibility Jamo"](f)||ir["Hangul Jamo Extended-A"](f)||ir["Hangul Jamo Extended-B"](f)||ir["Hangul Jamo"](f)||ir["Hangul Syllables"](f)||ir.Hiragana(f)||ir["Ideographic Description Characters"](f)||ir.Kanbun(f)||ir["Kangxi Radicals"](f)||ir["Katakana Phonetic Extensions"](f)||ir.Katakana(f)&&f!==12540||!(!ir["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!ir["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||ir["Unified Canadian Aboriginal Syllabics"](f)||ir["Unified Canadian Aboriginal Syllabics Extended"](f)||ir["Vertical Forms"](f)||ir["Yijing Hexagram Symbols"](f)||ir["Yi Syllables"](f)||ir["Yi Radicals"](f))))}function C_(f){return!(om(f)||function(l){return!!(ir["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||ir["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||ir["Letterlike Symbols"](l)||ir["Number Forms"](l)||ir["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||ir["Control Pictures"](l)&&l!==9251||ir["Optical Character Recognition"](l)||ir["Enclosed Alphanumerics"](l)||ir["Geometric Shapes"](l)||ir["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||ir["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||ir["CJK Symbols and Punctuation"](l)||ir.Katakana(l)||ir["Private Use Area"](l)||ir["CJK Compatibility Forms"](l)||ir["Small Form Variants"](l)||ir["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(f))}function Zh(f){return f>=1424&&f<=2303||ir["Arabic Presentation Forms-A"](f)||ir["Arabic Presentation Forms-B"](f)}function k_(f,l){return!(!l&&Zh(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||ir.Khmer(f))}function sm(f){for(let l of f)if(Zh(l.charCodeAt(0)))return!0;return!1}let am="deferred",$c="loading",Yh="loaded",lm=null,$o="unavailable",_l=null,Qc=function(f){f&&typeof f=="string"&&f.indexOf("NetworkError")>-1&&($o="error"),lm&&lm(f)};function qh(){Jc.fire(new sr("pluginStateChange",{pluginStatus:$o,pluginURL:_l}))}let Jc=new dr,cm=function(){return $o},um=function(){if($o!==am||!_l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$o=$c,qh(),_l&&Yr({url:_l},f=>{f?Qc(f):($o=Yh,qh())})},Mo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$o===Yh||Mo.applyArabicShaping!=null,isLoading:()=>$o===$c,setState(f){if(!Ue())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");$o=f.pluginStatus,_l=f.pluginURL},isParsed(){if(!Ue())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Mo.applyArabicShaping!=null&&Mo.processBidirectionalText!=null&&Mo.processStyledBidirectionalText!=null},getPluginURL(){if(!Ue())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return _l}};class ii{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new I_,this.transition={})}isSupportedScript(l){return function(d,g){for(let b of d)if(!k_(b.charCodeAt(0),g))return!1;return!0}(l,Mo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let l=this.zoom,d=l-Math.floor(l),g=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*d}}}class gf{constructor(l,d){this.property=l,this.value=d,this.expression=function(g,b){if(pi(g))return new tc(g,b);if(lf(g)){let T=Xp(g,b);if(T.result==="error")throw new Error(T.value.map(C=>`${C.key}: ${C.message}`).join(", "));return T.value}{let T=g;return b.type==="color"&&typeof g=="string"?T=It.parse(g):b.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(g)&&(T=on.parse(g)):T=Pr.parse(g),{kind:"constant",evaluate:()=>T}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,g){return this.property.possiblyEvaluate(this,l,d,g)}}class Gh{constructor(l){this.property=l,this.value=new gf(l,void 0)}transitioned(l,d){return new _f(this.property,this.value,d,ne({},l.transition,this.transition),l.now)}untransitioned(){return new _f(this.property,this.value,null,{},0)}}class fm{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return ve(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Gh(this._values[l].property)),this._values[l].value=new gf(this._values[l].property,d===null?void 0:ve(d))}getTransition(l){return ve(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Gh(this._values[l].property)),this._values[l].transition=ve(d)||void 0}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g);let b=this.getTransition(d);b!==void 0&&(l[`${d}-transition`]=b)}return l}transitioned(l,d){let g=new P_(this._properties);for(let b of Object.keys(this._values))g._values[b]=this._values[b].transitioned(l,d._values[b]);return g}untransitioned(){let l=new P_(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class _f{constructor(l,d,g,b,T){this.property=l,this.value=d,this.begin=T+b.delay||0,this.end=this.begin+b.duration||0,l.specification.transition&&(b.delay||b.duration)&&(this.prior=g)}possiblyEvaluate(l,d,g){let b=l.now||0,T=this.value.possiblyEvaluate(l,d,g),C=this.prior;if(C){if(b>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(b<this.begin)return C.possiblyEvaluate(l,d,g);{let D=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(l,d,g),T,function(U){if(U<=0)return 0;if(U>=1)return 1;let $=U*U,ie=$*U;return 4*(U<.5?ie:3*(U-$)+ie-.75)}(D))}}return T}}class P_{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,g){let b=new Hh(this._properties);for(let T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(l,d,g);return b}hasTransition(){for(let l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Nx{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return ve(this._values[l].value)}setValue(l,d){this._values[l]=new gf(this._values[l].property,d===null?void 0:ve(d))}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g)}return l}possiblyEvaluate(l,d,g){let b=new Hh(this._properties);for(let T of Object.keys(this._values))b._values[T]=this._values[T].possiblyEvaluate(l,d,g);return b}}class Fo{constructor(l,d,g){this.property=l,this.value=d,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,g,b){return this.property.evaluate(this.value,this.parameters,l,d,g,b)}}class Hh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Rr{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,g){let b=Go[this.specification.type];return b?b(l,d,g):l}}class Wr{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,g,b){return new Fo(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},g,b)}:l.expression,d)}interpolate(l,d,g){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Fo(this,{kind:"constant",value:void 0},l.parameters);let b=Go[this.specification.type];if(b){let T=b(l.value.value,d.value.value,g);return new Fo(this,{kind:"constant",value:T},l.parameters)}return l}evaluate(l,d,g,b,T,C){return l.kind==="constant"?l.value:l.evaluate(d,g,b,T,C)}}class yf extends Wr{possiblyEvaluate(l,d,g,b){if(l.value===void 0)return new Fo(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){let T=l.expression.evaluate(d,null,{},g,b),C=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,D=this._calculate(C,C,C,d);return new Fo(this,{kind:"constant",value:D},d)}if(l.expression.kind==="camera"){let T=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Fo(this,{kind:"constant",value:T},d)}return new Fo(this,l.expression,d)}evaluate(l,d,g,b,T,C){if(l.kind==="source"){let D=l.evaluate(d,g,b,T,C);return this._calculate(D,D,D,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},g,b),l.evaluate({zoom:Math.floor(d.zoom)},g,b),l.evaluate({zoom:Math.floor(d.zoom)+1},g,b),d):l.value}_calculate(l,d,g,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class xf{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,b){if(l.value!==void 0){if(l.expression.kind==="constant"){let T=l.expression.evaluate(d,null,{},g,b);return this._calculate(T,T,T,d)}return this._calculate(l.expression.evaluate(new ii(Math.floor(d.zoom-1),d)),l.expression.evaluate(new ii(Math.floor(d.zoom),d)),l.expression.evaluate(new ii(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,g,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class rc{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,b){return!!l.expression.evaluate(d,null,{},g,b)}interpolate(){return!1}}class Ni{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let d in l){let g=l[d];g.specification.overridable&&this.overridableProperties.push(d);let b=this.defaultPropertyValues[d]=new gf(g,void 0),T=this.defaultTransitionablePropertyValues[d]=new Gh(g);this.defaultTransitioningPropertyValues[d]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=b.possiblyEvaluate({})}}}_r("DataDrivenProperty",Wr),_r("DataConstantProperty",Rr),_r("CrossFadedDataDrivenProperty",yf),_r("CrossFadedProperty",xf),_r("ColorRampProperty",rc);let hm="-transition";class Is extends dr{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Nx(d.layout)),d.paint)){this._transitionablePaint=new fm(d.paint);for(let g in l.paint)this.setPaintProperty(g,l.paint[g],{validate:!1});for(let g in l.layout)this.setLayoutProperty(g,l.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hh(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,g={}){d!=null&&this._validate(rm,`layers.${this.id}.layout.${l}`,l,d,g)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(hm)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,g={}){if(d!=null&&this._validate(pf,`layers.${this.id}.paint.${l}`,l,d,g))return!1;if(l.endsWith(hm))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{let b=this._transitionablePaint._values[l],T=b.property.specification["property-type"]==="cross-faded-data-driven",C=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);let U=this._transitionablePaint._values[l].value;return U.isDataDriven()||C||T||this._handleOverridablePaintPropertyUpdate(l,D,U)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,g){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){let l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),ye(l,(d,g)=>!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length))}_validate(l,d,g,b,T={}){return(!T||T.validate!==!1)&&mf(this,l.call(Xs,{key:d,layerType:this.type,objectKey:g,value:b,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let l in this.paint._values){let d=this.paint.get(l);if(d instanceof Fo&&Zc(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}let O_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nc{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Si{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){let d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _i(f,l=1){let d=0,g=0;return{members:f.map(b=>{let T=O_[b.type].BYTES_PER_ELEMENT,C=d=ic(d,Math.max(l,T)),D=b.components||1;return g=Math.max(g,T),d+=T*D,{name:b.name,type:b.type,components:D,offset:C}}),size:ic(d,Math.max(g,l)),alignment:l}}function ic(f,l){return Math.ceil(f/l)*l}class bf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let b=2*l;return this.int16[b+0]=d,this.int16[b+1]=g,l}}bf.prototype.bytesPerElement=4,_r("StructArrayLayout2i4",bf);class vf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,l,d,g)}emplace(l,d,g,b){let T=3*l;return this.int16[T+0]=d,this.int16[T+1]=g,this.int16[T+2]=b,l}}vf.prototype.bytesPerElement=6,_r("StructArrayLayout3i6",vf);class yl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,l,d,g,b)}emplace(l,d,g,b,T){let C=4*l;return this.int16[C+0]=d,this.int16[C+1]=g,this.int16[C+2]=b,this.int16[C+3]=T,l}}yl.prototype.bytesPerElement=8,_r("StructArrayLayout4i8",yl);class wf extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,b,T,C)}emplace(l,d,g,b,T,C,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=b,this.int16[U+3]=T,this.int16[U+4]=C,this.int16[U+5]=D,l}}wf.prototype.bytesPerElement=12,_r("StructArrayLayout2i4i12",wf);class dm extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,b,T,C)}emplace(l,d,g,b,T,C,D){let U=4*l,$=8*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.uint8[$+4]=b,this.uint8[$+5]=T,this.uint8[$+6]=C,this.uint8[$+7]=D,l}}dm.prototype.bytesPerElement=8,_r("StructArrayLayout2i4ub8",dm);class eu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let b=2*l;return this.float32[b+0]=d,this.float32[b+1]=g,l}}eu.prototype.bytesPerElement=8,_r("StructArrayLayout2f8",eu);class Xh extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C,D,U,$,ie){let ce=this.length;return this.resize(ce+1),this.emplace(ce,l,d,g,b,T,C,D,U,$,ie)}emplace(l,d,g,b,T,C,D,U,$,ie,ce){let me=10*l;return this.uint16[me+0]=d,this.uint16[me+1]=g,this.uint16[me+2]=b,this.uint16[me+3]=T,this.uint16[me+4]=C,this.uint16[me+5]=D,this.uint16[me+6]=U,this.uint16[me+7]=$,this.uint16[me+8]=ie,this.uint16[me+9]=ce,l}}Xh.prototype.bytesPerElement=20,_r("StructArrayLayout10ui20",Xh);class pm extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C,D,U,$,ie,ce,me){let Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,l,d,g,b,T,C,D,U,$,ie,ce,me)}emplace(l,d,g,b,T,C,D,U,$,ie,ce,me,Ae){let Te=12*l;return this.int16[Te+0]=d,this.int16[Te+1]=g,this.int16[Te+2]=b,this.int16[Te+3]=T,this.uint16[Te+4]=C,this.uint16[Te+5]=D,this.uint16[Te+6]=U,this.uint16[Te+7]=$,this.int16[Te+8]=ie,this.int16[Te+9]=ce,this.int16[Te+10]=me,this.int16[Te+11]=Ae,l}}pm.prototype.bytesPerElement=24,_r("StructArrayLayout4i4ui4i24",pm);class zn extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,l,d,g)}emplace(l,d,g,b){let T=3*l;return this.float32[T+0]=d,this.float32[T+1]=g,this.float32[T+2]=b,l}}zn.prototype.bytesPerElement=12,_r("StructArrayLayout3f12",zn);class M extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}M.prototype.bytesPerElement=4,_r("StructArrayLayout1ul4",M);class c extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C,D,U,$){let ie=this.length;return this.resize(ie+1),this.emplace(ie,l,d,g,b,T,C,D,U,$)}emplace(l,d,g,b,T,C,D,U,$,ie){let ce=10*l,me=5*l;return this.int16[ce+0]=d,this.int16[ce+1]=g,this.int16[ce+2]=b,this.int16[ce+3]=T,this.int16[ce+4]=C,this.int16[ce+5]=D,this.uint32[me+3]=U,this.uint16[ce+8]=$,this.uint16[ce+9]=ie,l}}c.prototype.bytesPerElement=20,_r("StructArrayLayout6i1ul2ui20",c);class m extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,b,T,C)}emplace(l,d,g,b,T,C,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=b,this.int16[U+3]=T,this.int16[U+4]=C,this.int16[U+5]=D,l}}m.prototype.bytesPerElement=12,_r("StructArrayLayout2i2i2i12",m);class x extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T){let C=this.length;return this.resize(C+1),this.emplace(C,l,d,g,b,T)}emplace(l,d,g,b,T,C){let D=4*l,U=8*l;return this.float32[D+0]=d,this.float32[D+1]=g,this.float32[D+2]=b,this.int16[U+6]=T,this.int16[U+7]=C,l}}x.prototype.bytesPerElement=16,_r("StructArrayLayout2f1f2i16",x);class v extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,l,d,g,b)}emplace(l,d,g,b,T){let C=12*l,D=3*l;return this.uint8[C+0]=d,this.uint8[C+1]=g,this.float32[D+1]=b,this.float32[D+2]=T,l}}v.prototype.bytesPerElement=12,_r("StructArrayLayout2ub2f12",v);class S extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,l,d,g)}emplace(l,d,g,b){let T=3*l;return this.uint16[T+0]=d,this.uint16[T+1]=g,this.uint16[T+2]=b,l}}S.prototype.bytesPerElement=6,_r("StructArrayLayout3ui6",S);class L extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe){let lt=this.length;return this.resize(lt+1),this.emplace(lt,l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe)}emplace(l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe,lt){let tt=24*l,ct=12*l,vt=48*l;return this.int16[tt+0]=d,this.int16[tt+1]=g,this.uint16[tt+2]=b,this.uint16[tt+3]=T,this.uint32[ct+2]=C,this.uint32[ct+3]=D,this.uint32[ct+4]=U,this.uint16[tt+10]=$,this.uint16[tt+11]=ie,this.uint16[tt+12]=ce,this.float32[ct+7]=me,this.float32[ct+8]=Ae,this.uint8[vt+36]=Te,this.uint8[vt+37]=Le,this.uint8[vt+38]=He,this.uint32[ct+10]=Qe,this.int16[tt+22]=lt,l}}L.prototype.bytesPerElement=48,_r("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",L);class F extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe,lt,tt,ct,vt,Ot,lr,Or,ar,rr,Kt,Ar){let Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe,lt,tt,ct,vt,Ot,lr,Or,ar,rr,Kt,Ar)}emplace(l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le,He,Qe,lt,tt,ct,vt,Ot,lr,Or,ar,rr,Kt,Ar,Qt){let Wt=32*l,jr=16*l;return this.int16[Wt+0]=d,this.int16[Wt+1]=g,this.int16[Wt+2]=b,this.int16[Wt+3]=T,this.int16[Wt+4]=C,this.int16[Wt+5]=D,this.int16[Wt+6]=U,this.int16[Wt+7]=$,this.uint16[Wt+8]=ie,this.uint16[Wt+9]=ce,this.uint16[Wt+10]=me,this.uint16[Wt+11]=Ae,this.uint16[Wt+12]=Te,this.uint16[Wt+13]=Le,this.uint16[Wt+14]=He,this.uint16[Wt+15]=Qe,this.uint16[Wt+16]=lt,this.uint16[Wt+17]=tt,this.uint16[Wt+18]=ct,this.uint16[Wt+19]=vt,this.uint16[Wt+20]=Ot,this.uint16[Wt+21]=lr,this.uint16[Wt+22]=Or,this.uint32[jr+12]=ar,this.float32[jr+13]=rr,this.float32[jr+14]=Kt,this.uint16[Wt+30]=Ar,this.uint16[Wt+31]=Qt,l}}F.prototype.bytesPerElement=64,_r("StructArrayLayout8i15ui1ul2f2ui64",F);class Y extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}Y.prototype.bytesPerElement=4,_r("StructArrayLayout1f4",Y);class re extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,l,d,g)}emplace(l,d,g,b){let T=3*l;return this.uint16[6*l+0]=d,this.float32[T+1]=g,this.float32[T+2]=b,l}}re.prototype.bytesPerElement=12,_r("StructArrayLayout1ui2f12",re);class se extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let b=this.length;return this.resize(b+1),this.emplace(b,l,d,g)}emplace(l,d,g,b){let T=4*l;return this.uint32[2*l+0]=d,this.uint16[T+2]=g,this.uint16[T+3]=b,l}}se.prototype.bytesPerElement=8,_r("StructArrayLayout1ul2ui8",se);class le extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let b=2*l;return this.uint16[b+0]=d,this.uint16[b+1]=g,l}}le.prototype.bytesPerElement=4,_r("StructArrayLayout2ui4",le);class xe extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}xe.prototype.bytesPerElement=2,_r("StructArrayLayout1ui2",xe);class Ne extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,b){let T=this.length;return this.resize(T+1),this.emplace(T,l,d,g,b)}emplace(l,d,g,b,T){let C=4*l;return this.float32[C+0]=d,this.float32[C+1]=g,this.float32[C+2]=b,this.float32[C+3]=T,l}}Ne.prototype.bytesPerElement=16,_r("StructArrayLayout4f16",Ne);class De extends nc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new p(this.anchorPointX,this.anchorPointY)}}De.prototype.size=20;class Ze extends c{get(l){return new De(this,l)}}_r("CollisionBoxArray",Ze);class ze extends nc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ze.prototype.size=48;class nt extends L{get(l){return new ze(this,l)}}_r("PlacedSymbolArray",nt);class _t extends nc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_t.prototype.size=64;class $e extends F{get(l){return new _t(this,l)}}_r("SymbolInstanceArray",$e);class st extends Y{getoffsetX(l){return this.float32[1*l+0]}}_r("GlyphOffsetArray",st);class wt extends vf{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}_r("SymbolLineVertexArray",wt);class Mt extends nc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Mt.prototype.size=12;class Pt extends re{get(l){return new Mt(this,l)}}_r("TextAnchorOffsetArray",Pt);class Vt extends nc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Vt.prototype.size=8;class zt extends se{get(l){return new Vt(this,l)}}_r("FeatureIndexArray",zt);class Gt extends bf{}class Er extends bf{}class pn extends bf{}class er extends wf{}class I extends dm{}class O extends eu{}class z extends Xh{}class Z extends pm{}class H extends zn{}class K extends M{}class B extends m{}class q extends v{}class X extends S{}class ee extends le{}let oe=_i([{name:"a_pos",components:2,type:"Int16"}],4),{members:pe}=oe;class _e{constructor(l=[]){this.segments=l}prepareSegment(l,d,g,b){let T=this.segments[this.segments.length-1];return l>_e.MAX_VERTEX_ARRAY_LENGTH&&je(`Max vertices per segment is ${_e.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!T||T.vertexLength+l>_e.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==b)&&(T={vertexOffset:d.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},b!==void 0&&(T.sortKey=b),this.segments.push(T)),T}get(){return this.segments}destroy(){for(let l of this.segments)for(let d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,g,b){return new _e([{vertexOffset:l,primitiveOffset:d,vertexLength:g,primitiveLength:b,vaos:{},sortKey:0}])}}function Ce(f,l){return 256*(f=j(Math.floor(f),0,255))+j(Math.floor(l),0,255)}_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_r("SegmentVector",_e);let Be=_i([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fe={exports:{}},Ge={exports:{}};Ge.exports=function(f,l){var d,g,b,T,C,D,U,$;for(g=f.length-(d=3&f.length),b=l,C=3432918353,D=461845907,$=0;$<g;)U=255&f.charCodeAt($)|(255&f.charCodeAt(++$))<<8|(255&f.charCodeAt(++$))<<16|(255&f.charCodeAt(++$))<<24,++$,b=27492+(65535&(T=5*(65535&(b=(b^=U=(65535&(U=(U=(65535&U)*C+(((U>>>16)*C&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(U=0,d){case 3:U^=(255&f.charCodeAt($+2))<<16;case 2:U^=(255&f.charCodeAt($+1))<<8;case 1:b^=U=(65535&(U=(U=(65535&(U^=255&f.charCodeAt($)))*C+(((U>>>16)*C&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return b^=f.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var it=Ge.exports,at={exports:{}};at.exports=function(f,l){for(var d,g=f.length,b=l^g,T=0;g>=4;)d=1540483477*(65535&(d=255&f.charCodeAt(T)|(255&f.charCodeAt(++T))<<8|(255&f.charCodeAt(++T))<<16|(255&f.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++T;switch(g){case 3:b^=(255&f.charCodeAt(T+2))<<16;case 2:b^=(255&f.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&f.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var ot=it,dt=at.exports;Fe.exports=ot,Fe.exports.murmur3=ot,Fe.exports.murmur2=dt;var Nt=a(Fe.exports);class or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,g,b){this.ids.push(br(l)),this.positions.push(d,g,b)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let d=br(l),g=0,b=this.ids.length-1;for(;g<b;){let C=g+b>>1;this.ids[C]>=d?b=C:g=C+1}let T=[];for(;this.ids[g]===d;)T.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return T}static serialize(l,d){let g=new Float64Array(l.ids),b=new Uint32Array(l.positions);return yr(g,b,0,g.length-1),d&&d.push(g.buffer,b.buffer),{ids:g,positions:b}}static deserialize(l){let d=new or;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function br(f){let l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:Nt(String(f))}function yr(f,l,d,g){for(;d<g;){let b=f[d+g>>1],T=d-1,C=g+1;for(;;){do T++;while(f[T]<b);do C--;while(f[C]>b);if(T>=C)break;Zr(f,T,C),Zr(l,3*T,3*C),Zr(l,3*T+1,3*C+1),Zr(l,3*T+2,3*C+2)}C-d<g-C?(yr(f,l,d,C),d=C+1):(yr(f,l,C+1,g),g=C)}}function Zr(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}_r("FeaturePositionMap",or);class Ti{constructor(l,d){this.gl=l.gl,this.location=d}}class So extends Ti{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Ks extends Ti{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class tu extends Ti{constructor(l,d){super(l,d),this.current=It.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}let mm=new Float32Array(16);function Ya(f){return[Ce(255*f.r,255*f.g),Ce(255*f.b,255*f.a)]}class dn{constructor(l,d,g){this.value=l,this.uniformNames=d.map(b=>`u_${b}`),this.type=g}setUniform(l,d,g){l.set(g.constantOr(this.value))}getBinding(l,d,g){return this.type==="color"?new tu(l,d):new So(l,d)}}class Cs{constructor(l,d){this.uniformNames=d.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,g,b){let T=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&l.set(T)}getBinding(l,d,g){return g.substr(0,9)==="u_pattern"?new Ks(l,d):new So(l,d)}}class fi{constructor(l,d,g,b){this.expression=l,this.type=g,this.maxValue=0,this.paintVertexAttributes=d.map(T=>({name:`a_${T}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(l,d,g,b,T){let C=this.paintVertexArray.length,D=this.expression.evaluate(new ii(0),d,{},b,[],T);this.paintVertexArray.resize(l),this._setPaintValue(C,l,D)}updatePaintArray(l,d,g,b){let T=this.expression.evaluate({zoom:0},g,b);this._setPaintValue(l,d,T)}_setPaintValue(l,d,g){if(this.type==="color"){let b=Ya(g);for(let T=l;T<d;T++)this.paintVertexArray.emplace(T,b[0],b[1])}else{for(let b=l;b<d;b++)this.paintVertexArray.emplace(b,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Di{constructor(l,d,g,b,T,C){this.expression=l,this.uniformNames=d.map(D=>`u_${D}_t`),this.type=g,this.useIntegerZoom=b,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=d.map(D=>({name:`a_${D}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(l,d,g,b,T){let C=this.expression.evaluate(new ii(this.zoom),d,{},b,[],T),D=this.expression.evaluate(new ii(this.zoom+1),d,{},b,[],T),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,C,D)}updatePaintArray(l,d,g,b){let T=this.expression.evaluate({zoom:this.zoom},g,b),C=this.expression.evaluate({zoom:this.zoom+1},g,b);this._setPaintValue(l,d,T,C)}_setPaintValue(l,d,g,b){if(this.type==="color"){let T=Ya(g),C=Ya(b);for(let D=l;D<d;D++)this.paintVertexArray.emplace(D,T[0],T[1],C[0],C[1])}else{for(let T=l;T<d;T++)this.paintVertexArray.emplace(T,g,b);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(b))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){let g=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,b=j(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);l.set(b)}getBinding(l,d,g){return new So(l,d)}}class co{constructor(l,d,g,b,T,C){this.expression=l,this.type=d,this.useIntegerZoom=g,this.zoom=b,this.layerId=C,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(l,d,g){let b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(b,l,d.patterns&&d.patterns[this.layerId],g)}updatePaintArray(l,d,g,b,T){this._setPaintValues(l,d,g.patterns&&g.patterns[this.layerId],T)}_setPaintValues(l,d,g,b){if(!b||!g)return;let{min:T,mid:C,max:D}=g,U=b[T],$=b[C],ie=b[D];if(U&&$&&ie)for(let ce=l;ce<d;ce++)this.zoomInPaintVertexArray.emplace(ce,$.tl[0],$.tl[1],$.br[0],$.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],$.pixelRatio,U.pixelRatio),this.zoomOutPaintVertexArray.emplace(ce,$.tl[0],$.tl[1],$.br[0],$.br[1],ie.tl[0],ie.tl[1],ie.br[0],ie.br[1],$.pixelRatio,ie.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,Be.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,Be.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vi{constructor(l,d,g){this.binders={},this._buffers=[];let b=[];for(let T in l.paint._values){if(!g(T))continue;let C=l.paint.get(T);if(!(C instanceof Fo&&Zc(C.property.specification)))continue;let D=gm(T,l.type),U=C.value,$=C.property.specification.type,ie=C.property.useIntegerZoom,ce=C.property.specification["property-type"],me=ce==="cross-faded"||ce==="cross-faded-data-driven";if(U.kind==="constant")this.binders[T]=me?new Cs(U.value,D):new dn(U.value,D,$),b.push(`/u_${T}`);else if(U.kind==="source"||me){let Ae=To(T,$,"source");this.binders[T]=me?new co(U,$,ie,d,Ae,l.id):new fi(U,D,$,Ae),b.push(`/a_${T}`)}else{let Ae=To(T,$,"composite");this.binders[T]=new Di(U,D,$,ie,d,Ae),b.push(`/z_${T}`)}}this.cacheKey=b.sort().join("")}getMaxValue(l){let d=this.binders[l];return d instanceof fi||d instanceof Di?d.maxValue:0}populatePaintArrays(l,d,g,b,T){for(let C in this.binders){let D=this.binders[C];(D instanceof fi||D instanceof Di||D instanceof co)&&D.populatePaintArray(l,d,g,b,T)}}setConstantPatternPositions(l,d){for(let g in this.binders){let b=this.binders[g];b instanceof Cs&&b.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,g,b,T){let C=!1;for(let D in l){let U=d.getPositions(D);for(let $ of U){let ie=g.feature($.index);for(let ce in this.binders){let me=this.binders[ce];if((me instanceof fi||me instanceof Di||me instanceof co)&&me.expression.isStateDependent===!0){let Ae=b.paint.get(ce);me.expression=Ae.value,me.updatePaintArray($.start,$.end,ie,l[D],T),C=!0}}}}return C}defines(){let l=[];for(let d in this.binders){let g=this.binders[d];(g instanceof dn||g instanceof Cs)&&l.push(...g.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return l}getBinderAttributes(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof fi||g instanceof Di)for(let b=0;b<g.paintVertexAttributes.length;b++)l.push(g.paintVertexAttributes[b].name);else if(g instanceof co)for(let b=0;b<Be.members.length;b++)l.push(Be.members[b].name)}return l}getBinderUniforms(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof dn||g instanceof Cs||g instanceof Di)for(let b of g.uniformNames)l.push(b)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){let g=[];for(let b in this.binders){let T=this.binders[b];if(T instanceof dn||T instanceof Cs||T instanceof Di){for(let C of T.uniformNames)if(d[C]){let D=T.getBinding(l,d[C],C);g.push({name:C,property:b,binding:D})}}}return g}setUniforms(l,d,g,b){for(let{name:T,property:C,binding:D}of d)this.binders[C].setUniform(D,b,g.get(C),T)}updatePaintBuffers(l){this._buffers=[];for(let d in this.binders){let g=this.binders[d];if(l&&g instanceof co){let b=l.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(g instanceof fi||g instanceof Di)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(l){for(let d in this.binders){let g=this.binders[d];(g instanceof fi||g instanceof Di||g instanceof co)&&g.upload(l)}this.updatePaintBuffers()}destroy(){for(let l in this.binders){let d=this.binders[l];(d instanceof fi||d instanceof Di||d instanceof co)&&d.destroy()}}}class ro{constructor(l,d,g=()=>!0){this.programConfigurations={};for(let b of l)this.programConfigurations[b.id]=new Vi(b,d,g);this.needsUpload=!1,this._featureMap=new or,this._bufferOffset=0}populatePaintArrays(l,d,g,b,T,C){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(l,d,b,T,C);d.id!==void 0&&this._featureMap.add(d.id,g,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,g,b){for(let T of g)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(l,this._featureMap,d,T,b)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(let d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(let l in this.programConfigurations)this.programConfigurations[l].destroy()}}function gm(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function To(f,l,d){let g={color:{source:eu,composite:Ne},number:{source:Y,composite:eu}},b=function(T){return{"line-pattern":{source:z,composite:z},"fill-pattern":{source:z,composite:z},"fill-extrusion-pattern":{source:z,composite:z}}[T]}(f);return b&&b[d]||g[l][d]}_r("ConstantBinder",dn),_r("CrossFadedConstantBinder",Cs),_r("SourceExpressionBinder",fi),_r("CrossFadedCompositeBinder",co),_r("CompositeExpressionBinder",Di),_r("ProgramConfiguration",Vi,{omit:["_buffers"]}),_r("ProgramConfigurationSet",ro);let Dr=8192,jn=Math.pow(2,14)-1,Ei=-jn-1;function Li(f){let l=Dr/f.extent,d=f.loadGeometry();for(let g=0;g<d.length;g++){let b=d[g];for(let T=0;T<b.length;T++){let C=b[T],D=Math.round(C.x*l),U=Math.round(C.y*l);C.x=j(D,Ei,jn),C.y=j(U,Ei,jn),(D<C.x||D>C.x+1||U<C.y||U>C.y+1)&&je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function Eo(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?Li(f):[]}}function qa(f,l,d,g,b){f.emplaceBack(2*l+(g+1)/2,2*d+(b+1)/2)}class k4{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Er,this.indexArray=new X,this.segments=new _e,this.programConfigurations=new ro(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){let b=this.layers[0],T=[],C=null,D=!1;b.type==="circle"&&(C=b.layout.get("circle-sort-key"),D=!C.isConstant());for(let{feature:U,id:$,index:ie,sourceLayerIndex:ce}of l){let me=this.layers[0]._featureFilter.needGeometry,Ae=Eo(U,me);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),Ae,g))continue;let Te=D?C.evaluate(Ae,{},g):void 0,Le={id:$,properties:U.properties,type:U.type,sourceLayerIndex:ce,index:ie,geometry:me?Ae.geometry:Li(U),patterns:{},sortKey:Te};T.push(Le)}D&&T.sort((U,$)=>U.sortKey-$.sortKey);for(let U of T){let{geometry:$,index:ie,sourceLayerIndex:ce}=U,me=l[ie].feature;this.addFeature(U,$,ie,g),d.featureIndex.insert(me,$,ie,ce,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,pe),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,g,b){for(let T of d)for(let C of T){let D=C.x,U=C.y;if(D<0||D>=Dr||U<0||U>=Dr)continue;let $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),ie=$.vertexLength;qa(this.layoutVertexArray,D,U,-1,-1),qa(this.layoutVertexArray,D,U,1,-1),qa(this.layoutVertexArray,D,U,1,1),qa(this.layoutVertexArray,D,U,-1,1),this.indexArray.emplaceBack(ie,ie+1,ie+2),this.indexArray.emplaceBack(ie,ie+3,ie+2),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,{},b)}}function ej(f,l){for(let d=0;d<f.length;d++)if(R_(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(R_(f,l[d]))return!0;return!!P4(f,l)}function n_e(f,l,d){return!!R_(f,l)||!!O4(l,f,d)}function tj(f,l){if(f.length===1)return nj(l,f[0]);for(let d=0;d<l.length;d++){let g=l[d];for(let b=0;b<g.length;b++)if(R_(f,g[b]))return!0}for(let d=0;d<f.length;d++)if(nj(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(P4(f,l[d]))return!0;return!1}function i_e(f,l,d){if(f.length>1){if(P4(f,l))return!0;for(let g=0;g<l.length;g++)if(O4(l[g],f,d))return!0}for(let g=0;g<f.length;g++)if(O4(f[g],l,d))return!0;return!1}function P4(f,l){if(f.length===0||l.length===0)return!1;for(let d=0;d<f.length-1;d++){let g=f[d],b=f[d+1];for(let T=0;T<l.length-1;T++)if(o_e(g,b,l[T],l[T+1]))return!0}return!1}function o_e(f,l,d,g){return Re(f,d,g)!==Re(l,d,g)&&Re(f,l,d)!==Re(f,l,g)}function O4(f,l,d){let g=d*d;if(l.length===1)return f.distSqr(l[0])<g;for(let b=1;b<l.length;b++)if(rj(f,l[b-1],l[b])<g)return!0;return!1}function rj(f,l,d){let g=l.distSqr(d);if(g===0)return f.distSqr(l);let b=((f.x-l.x)*(d.x-l.x)+(f.y-l.y)*(d.y-l.y))/g;return f.distSqr(b<0?l:b>1?d:d.sub(l)._mult(b)._add(l))}function nj(f,l){let d,g,b,T=!1;for(let C=0;C<f.length;C++){d=f[C];for(let D=0,U=d.length-1;D<d.length;U=D++)g=d[D],b=d[U],g.y>l.y!=b.y>l.y&&l.x<(b.x-g.x)*(l.y-g.y)/(b.y-g.y)+g.x&&(T=!T)}return T}function R_(f,l){let d=!1;for(let g=0,b=f.length-1;g<f.length;b=g++){let T=f[g],C=f[b];T.y>l.y!=C.y>l.y&&l.x<(C.x-T.x)*(l.y-T.y)/(C.y-T.y)+T.x&&(d=!d)}return d}function s_e(f,l,d){let g=d[0],b=d[2];if(f.x<g.x&&l.x<g.x||f.x>b.x&&l.x>b.x||f.y<g.y&&l.y<g.y||f.y>b.y&&l.y>b.y)return!1;let T=Re(f,l,d[0]);return T!==Re(f,l,d[1])||T!==Re(f,l,d[2])||T!==Re(f,l,d[3])}function zx(f,l,d){let g=l.paint.get(f).value;return g.kind==="constant"?g.value:d.programConfigurations.get(l.id).getMaxValue(f)}function EA(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function IA(f,l,d,g,b){if(!l[0]&&!l[1])return f;let T=p.convert(l)._mult(b);d==="viewport"&&T._rotate(-g);let C=[];for(let D=0;D<f.length;D++)C.push(f[D].sub(T));return C}let ij,oj;_r("CircleBucket",k4,{omit:["layers"]});var a_e={get paint(){return oj=oj||new Ni({"circle-radius":new Wr(xt.paint_circle["circle-radius"]),"circle-color":new Wr(xt.paint_circle["circle-color"]),"circle-blur":new Wr(xt.paint_circle["circle-blur"]),"circle-opacity":new Wr(xt.paint_circle["circle-opacity"]),"circle-translate":new Rr(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new Rr(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rr(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rr(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wr(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wr(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wr(xt.paint_circle["circle-stroke-opacity"])})},get layout(){return ij=ij||new Ni({"circle-sort-key":new Wr(xt.layout_circle["circle-sort-key"])})}},ks=1e-6,N_=typeof Float32Array<"u"?Float32Array:Array;function R4(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function sj(f,l,d){var g=l[0],b=l[1],T=l[2],C=l[3],D=l[4],U=l[5],$=l[6],ie=l[7],ce=l[8],me=l[9],Ae=l[10],Te=l[11],Le=l[12],He=l[13],Qe=l[14],lt=l[15],tt=d[0],ct=d[1],vt=d[2],Ot=d[3];return f[0]=tt*g+ct*D+vt*ce+Ot*Le,f[1]=tt*b+ct*U+vt*me+Ot*He,f[2]=tt*T+ct*$+vt*Ae+Ot*Qe,f[3]=tt*C+ct*ie+vt*Te+Ot*lt,f[4]=(tt=d[4])*g+(ct=d[5])*D+(vt=d[6])*ce+(Ot=d[7])*Le,f[5]=tt*b+ct*U+vt*me+Ot*He,f[6]=tt*T+ct*$+vt*Ae+Ot*Qe,f[7]=tt*C+ct*ie+vt*Te+Ot*lt,f[8]=(tt=d[8])*g+(ct=d[9])*D+(vt=d[10])*ce+(Ot=d[11])*Le,f[9]=tt*b+ct*U+vt*me+Ot*He,f[10]=tt*T+ct*$+vt*Ae+Ot*Qe,f[11]=tt*C+ct*ie+vt*Te+Ot*lt,f[12]=(tt=d[12])*g+(ct=d[13])*D+(vt=d[14])*ce+(Ot=d[15])*Le,f[13]=tt*b+ct*U+vt*me+Ot*He,f[14]=tt*T+ct*$+vt*Ae+Ot*Qe,f[15]=tt*C+ct*ie+vt*Te+Ot*lt,f}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)});var Dx,l_e=sj;function CA(f,l,d){var g=l[0],b=l[1],T=l[2],C=l[3];return f[0]=d[0]*g+d[4]*b+d[8]*T+d[12]*C,f[1]=d[1]*g+d[5]*b+d[9]*T+d[13]*C,f[2]=d[2]*g+d[6]*b+d[10]*T+d[14]*C,f[3]=d[3]*g+d[7]*b+d[11]*T+d[15]*C,f}Dx=new N_(4),N_!=Float32Array&&(Dx[0]=0,Dx[1]=0,Dx[2]=0,Dx[3]=0);class c_e extends Is{constructor(l){super(l,a_e)}createBucket(l){return new k4(l)}queryRadius(l){let d=l;return zx("circle-radius",this,d)+zx("circle-stroke-width",this,d)+EA(this.paint.get("circle-translate"))}queryIntersectsFeature(l,d,g,b,T,C,D,U){let $=IA(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,D),ie=this.paint.get("circle-radius").evaluate(d,g)+this.paint.get("circle-stroke-width").evaluate(d,g),ce=this.paint.get("circle-pitch-alignment")==="map",me=ce?$:function(Te,Le){return Te.map(He=>aj(He,Le))}($,U),Ae=ce?ie*D:ie;for(let Te of b)for(let Le of Te){let He=ce?Le:aj(Le,U),Qe=Ae,lt=CA([],[Le.x,Le.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Qe*=lt[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Qe*=C.cameraToCenterDistance/lt[3]),n_e(me,He,Qe))return!0}return!1}}function aj(f,l){let d=CA([],[f.x,f.y,0,1],l);return new p(d[0]/d[3],d[1]/d[3])}class lj extends k4{}let cj;_r("HeatmapBucket",lj,{omit:["layers"]});var u_e={get paint(){return cj=cj||new Ni({"heatmap-radius":new Wr(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wr(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rr(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rr(xt.paint_heatmap["heatmap-opacity"])})}};function N4(f,{width:l,height:d},g,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==l*d*g)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${l*d*g}`)}else b=new Uint8Array(l*d*g);return f.width=l,f.height=d,f.data=b,f}function uj(f,{width:l,height:d},g){if(l===f.width&&d===f.height)return;let b=N4({},{width:l,height:d},g);z4(f,b,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,d)},g),f.width=l,f.height=d,f.data=b.data}function z4(f,l,d,g,b,T){if(b.width===0||b.height===0)return l;if(b.width>f.width||b.height>f.height||d.x>f.width-b.width||d.y>f.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>l.width||b.height>l.height||g.x>l.width-b.width||g.y>l.height-b.height)throw new RangeError("out of range destination coordinates for image copy");let C=f.data,D=l.data;if(C===D)throw new Error("srcData equals dstData, so image is already copied");for(let U=0;U<b.height;U++){let $=((d.y+U)*f.width+d.x)*T,ie=((g.y+U)*l.width+g.x)*T;for(let ce=0;ce<b.width*T;ce++)D[ie+ce]=C[$+ce]}return l}class Lx{constructor(l,d){N4(this,l,1,d)}resize(l){uj(this,l,1)}clone(){return new Lx({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,b,T){z4(l,d,g,b,T,1)}}class Ga{constructor(l,d){N4(this,l,4,d)}resize(l){uj(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,b,T){z4(l,d,g,b,T,4)}}function fj(f){let l={},d=f.resolution||256,g=f.clips?f.clips.length:1,b=f.image||new Ga({width:d,height:g});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);let T=(C,D,U)=>{l[f.evaluationKey]=U;let $=f.expression.evaluate(l);b.data[C+D+0]=Math.floor(255*$.r/$.a),b.data[C+D+1]=Math.floor(255*$.g/$.a),b.data[C+D+2]=Math.floor(255*$.b/$.a),b.data[C+D+3]=Math.floor(255*$.a)};if(f.clips)for(let C=0,D=0;C<g;++C,D+=4*d)for(let U=0,$=0;U<d;U++,$+=4){let ie=U/(d-1),{start:ce,end:me}=f.clips[C];T(D,$,ce*(1-ie)+me*ie)}else for(let C=0,D=0;C<d;C++,D+=4)T(0,D,C/(d-1));return b}_r("AlphaImage",Lx),_r("RGBAImage",Ga);class f_e extends Is{createBucket(l){return new lj(l)}constructor(l){super(l,u_e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fj({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let hj;var h_e={get paint(){return hj=hj||new Ni({"hillshade-illumination-direction":new Rr(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rr(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rr(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rr(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rr(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rr(xt.paint_hillshade["hillshade-accent-color"])})}};class d_e extends Is{constructor(l){super(l,h_e)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let p_e=_i([{name:"a_pos",components:2,type:"Int16"}],4),{members:m_e}=p_e;var D4={exports:{}};function kA(f,l,d){d=d||2;var g,b,T,C,D,U,$,ie=l&&l.length,ce=ie?l[0]*d:f.length,me=dj(f,0,ce,d,!0),Ae=[];if(!me||me.next===me.prev)return Ae;if(ie&&(me=function(Le,He,Qe,lt){var tt,ct,vt,Ot=[];for(tt=0,ct=He.length;tt<ct;tt++)(vt=dj(Le,He[tt]*lt,tt<ct-1?He[tt+1]*lt:Le.length,lt,!1))===vt.next&&(vt.steiner=!0),Ot.push(A_e(vt));for(Ot.sort(b_e),tt=0;tt<Ot.length;tt++)Qe=v_e(Ot[tt],Qe);return Qe}(f,l,me,d)),f.length>80*d){g=T=f[0],b=C=f[1];for(var Te=d;Te<ce;Te+=d)(D=f[Te])<g&&(g=D),(U=f[Te+1])<b&&(b=U),D>T&&(T=D),U>C&&(C=U);$=($=Math.max(T-g,C-b))!==0?32767/$:0}return Fx(me,Ae,d,g,b,$,0),Ae}function dj(f,l,d,g,b){var T,C;if(b===B4(f,l,d,g)>0)for(T=l;T<d;T+=g)C=gj(T,f[T],f[T+1],C);else for(T=d-g;T>=l;T-=g)C=gj(T,f[T],f[T+1],C);return C&&PA(C,C.next)&&(jx(C),C=C.next),C}function _m(f,l){if(!f)return f;l||(l=f);var d,g=f;do if(d=!1,g.steiner||!PA(g,g.next)&&Gi(g.prev,g,g.next)!==0)g=g.next;else{if(jx(g),(g=l=g.prev)===g.next)break;d=!0}while(d||g!==l);return l}function Fx(f,l,d,g,b,T,C){if(f){!C&&T&&function(ie,ce,me,Ae){var Te=ie;do Te.z===0&&(Te.z=L4(Te.x,Te.y,ce,me,Ae)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==ie);Te.prevZ.nextZ=null,Te.prevZ=null,function(Le){var He,Qe,lt,tt,ct,vt,Ot,lr,Or=1;do{for(Qe=Le,Le=null,ct=null,vt=0;Qe;){for(vt++,lt=Qe,Ot=0,He=0;He<Or&&(Ot++,lt=lt.nextZ);He++);for(lr=Or;Ot>0||lr>0&&lt;)Ot!==0&&(lr===0||!lt||Qe.z<=lt.z)?(tt=Qe,Qe=Qe.nextZ,Ot--):(tt=lt,lt=lt.nextZ,lr--),ct?ct.nextZ=tt:Le=tt,tt.prevZ=ct,ct=tt;Qe=lt}ct.nextZ=null,Or*=2}while(vt>1)}(Te)}(f,g,b,T);for(var D,U,$=f;f.prev!==f.next;)if(D=f.prev,U=f.next,T?__e(f,g,b,T):g_e(f))l.push(D.i/d|0),l.push(f.i/d|0),l.push(U.i/d|0),jx(f),f=U.next,$=U.next;else if((f=U)===$){C?C===1?Fx(f=y_e(_m(f),l,d),l,d,g,b,T,2):C===2&&x_e(f,l,d,g,b,T):Fx(_m(f),l,d,g,b,T,1);break}}}function g_e(f){var l=f.prev,d=f,g=f.next;if(Gi(l,d,g)>=0)return!1;for(var b=l.x,T=d.x,C=g.x,D=l.y,U=d.y,$=g.y,ie=b<T?b<C?b:C:T<C?T:C,ce=D<U?D<$?D:$:U<$?U:$,me=b>T?b>C?b:C:T>C?T:C,Ae=D>U?D>$?D:$:U>$?U:$,Te=g.next;Te!==l;){if(Te.x>=ie&&Te.x<=me&&Te.y>=ce&&Te.y<=Ae&&z_(b,D,T,U,C,$,Te.x,Te.y)&&Gi(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function __e(f,l,d,g){var b=f.prev,T=f,C=f.next;if(Gi(b,T,C)>=0)return!1;for(var D=b.x,U=T.x,$=C.x,ie=b.y,ce=T.y,me=C.y,Ae=D<U?D<$?D:$:U<$?U:$,Te=ie<ce?ie<me?ie:me:ce<me?ce:me,Le=D>U?D>$?D:$:U>$?U:$,He=ie>ce?ie>me?ie:me:ce>me?ce:me,Qe=L4(Ae,Te,l,d,g),lt=L4(Le,He,l,d,g),tt=f.prevZ,ct=f.nextZ;tt&&tt.z>=Qe&&ct&&ct.z<=lt;){if(tt.x>=Ae&&tt.x<=Le&&tt.y>=Te&&tt.y<=He&&tt!==b&&tt!==C&&z_(D,ie,U,ce,$,me,tt.x,tt.y)&&Gi(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,ct.x>=Ae&&ct.x<=Le&&ct.y>=Te&&ct.y<=He&&ct!==b&&ct!==C&&z_(D,ie,U,ce,$,me,ct.x,ct.y)&&Gi(ct.prev,ct,ct.next)>=0))return!1;ct=ct.nextZ}for(;tt&&tt.z>=Qe;){if(tt.x>=Ae&&tt.x<=Le&&tt.y>=Te&&tt.y<=He&&tt!==b&&tt!==C&&z_(D,ie,U,ce,$,me,tt.x,tt.y)&&Gi(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;ct&&ct.z<=lt;){if(ct.x>=Ae&&ct.x<=Le&&ct.y>=Te&&ct.y<=He&&ct!==b&&ct!==C&&z_(D,ie,U,ce,$,me,ct.x,ct.y)&&Gi(ct.prev,ct,ct.next)>=0)return!1;ct=ct.nextZ}return!0}function y_e(f,l,d){var g=f;do{var b=g.prev,T=g.next.next;!PA(b,T)&&pj(b,g,g.next,T)&&Bx(b,T)&&Bx(T,b)&&(l.push(b.i/d|0),l.push(g.i/d|0),l.push(T.i/d|0),jx(g),jx(g.next),g=f=T),g=g.next}while(g!==f);return _m(g)}function x_e(f,l,d,g,b,T){var C=f;do{for(var D=C.next.next;D!==C.prev;){if(C.i!==D.i&&M_e(C,D)){var U=mj(C,D);return C=_m(C,C.next),U=_m(U,U.next),Fx(C,l,d,g,b,T,0),void Fx(U,l,d,g,b,T,0)}D=D.next}C=C.next}while(C!==f)}function b_e(f,l){return f.x-l.x}function v_e(f,l){var d=function(b,T){var C,D=T,U=b.x,$=b.y,ie=-1/0;do{if($<=D.y&&$>=D.next.y&&D.next.y!==D.y){var ce=D.x+($-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(ce<=U&&ce>ie&&(ie=ce,C=D.x<D.next.x?D:D.next,ce===U))return C}D=D.next}while(D!==T);if(!C)return null;var me,Ae=C,Te=C.x,Le=C.y,He=1/0;D=C;do U>=D.x&&D.x>=Te&&U!==D.x&&z_($<Le?U:ie,$,Te,Le,$<Le?ie:U,$,D.x,D.y)&&(me=Math.abs($-D.y)/(U-D.x),Bx(D,b)&&(me<He||me===He&&(D.x>C.x||D.x===C.x&&w_e(C,D)))&&(C=D,He=me)),D=D.next;while(D!==Ae);return C}(f,l);if(!d)return l;var g=mj(d,f);return _m(g,g.next),_m(d,d.next)}function w_e(f,l){return Gi(f.prev,f,l.prev)<0&&Gi(l.next,f,f.next)<0}function L4(f,l,d,g,b){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-d)*b|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-g)*b|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function A_e(f){var l=f,d=f;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==f);return d}function z_(f,l,d,g,b,T,C,D){return(b-C)*(l-D)>=(f-C)*(T-D)&&(f-C)*(g-D)>=(d-C)*(l-D)&&(d-C)*(T-D)>=(b-C)*(g-D)}function M_e(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!function(d,g){var b=d;do{if(b.i!==d.i&&b.next.i!==d.i&&b.i!==g.i&&b.next.i!==g.i&&pj(b,b.next,d,g))return!0;b=b.next}while(b!==d);return!1}(f,l)&&(Bx(f,l)&&Bx(l,f)&&function(d,g){var b=d,T=!1,C=(d.x+g.x)/2,D=(d.y+g.y)/2;do b.y>D!=b.next.y>D&&b.next.y!==b.y&&C<(b.next.x-b.x)*(D-b.y)/(b.next.y-b.y)+b.x&&(T=!T),b=b.next;while(b!==d);return T}(f,l)&&(Gi(f.prev,f,l.prev)||Gi(f,l.prev,l))||PA(f,l)&&Gi(f.prev,f,f.next)>0&&Gi(l.prev,l,l.next)>0)}function Gi(f,l,d){return(l.y-f.y)*(d.x-l.x)-(l.x-f.x)*(d.y-l.y)}function PA(f,l){return f.x===l.x&&f.y===l.y}function pj(f,l,d,g){var b=RA(Gi(f,l,d)),T=RA(Gi(f,l,g)),C=RA(Gi(d,g,f)),D=RA(Gi(d,g,l));return b!==T&&C!==D||!(b!==0||!OA(f,d,l))||!(T!==0||!OA(f,g,l))||!(C!==0||!OA(d,f,g))||!(D!==0||!OA(d,l,g))}function OA(f,l,d){return l.x<=Math.max(f.x,d.x)&&l.x>=Math.min(f.x,d.x)&&l.y<=Math.max(f.y,d.y)&&l.y>=Math.min(f.y,d.y)}function RA(f){return f>0?1:f<0?-1:0}function Bx(f,l){return Gi(f.prev,f,f.next)<0?Gi(f,l,f.next)>=0&&Gi(f,f.prev,l)>=0:Gi(f,l,f.prev)<0||Gi(f,f.next,l)<0}function mj(f,l){var d=new F4(f.i,f.x,f.y),g=new F4(l.i,l.x,l.y),b=f.next,T=l.prev;return f.next=l,l.prev=f,d.next=b,b.prev=d,g.next=d,d.prev=g,T.next=g,g.prev=T,g}function gj(f,l,d,g){var b=new F4(f,l,d);return g?(b.next=g.next,b.prev=g,g.next.prev=b,g.next=b):(b.prev=b,b.next=b),b}function jx(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function F4(f,l,d){this.i=f,this.x=l,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B4(f,l,d,g){for(var b=0,T=l,C=d-g;T<d;T+=g)b+=(f[C]-f[T])*(f[T+1]+f[C+1]),C=T;return b}D4.exports=kA,D4.exports.default=kA,kA.deviation=function(f,l,d,g){var b=l&&l.length,T=Math.abs(B4(f,0,b?l[0]*d:f.length,d));if(b)for(var C=0,D=l.length;C<D;C++)T-=Math.abs(B4(f,l[C]*d,C<D-1?l[C+1]*d:f.length,d));var U=0;for(C=0;C<g.length;C+=3){var $=g[C]*d,ie=g[C+1]*d,ce=g[C+2]*d;U+=Math.abs((f[$]-f[ce])*(f[ie+1]-f[$+1])-(f[$]-f[ie])*(f[ce+1]-f[$+1]))}return T===0&&U===0?0:Math.abs((U-T)/T)},kA.flatten=function(f){for(var l=f[0][0].length,d={vertices:[],holes:[],dimensions:l},g=0,b=0;b<f.length;b++){for(var T=0;T<f[b].length;T++)for(var C=0;C<l;C++)d.vertices.push(f[b][T][C]);b>0&&d.holes.push(g+=f[b-1].length)}return d};var _j=a(D4.exports);function S_e(f,l,d,g,b){yj(f,l,d||0,g||f.length-1,b||T_e)}function yj(f,l,d,g,b){for(;g>d;){if(g-d>600){var T=g-d+1,C=l-d+1,D=Math.log(T),U=.5*Math.exp(2*D/3),$=.5*Math.sqrt(D*U*(T-U)/T)*(C-T/2<0?-1:1);yj(f,l,Math.max(d,Math.floor(l-C*U/T+$)),Math.min(g,Math.floor(l+(T-C)*U/T+$)),b)}var ie=f[l],ce=d,me=g;for(Ux(f,d,l),b(f[g],ie)>0&&Ux(f,d,g);ce<me;){for(Ux(f,ce,me),ce++,me--;b(f[ce],ie)<0;)ce++;for(;b(f[me],ie)>0;)me--}b(f[d],ie)===0?Ux(f,d,me):Ux(f,++me,g),me<=l&&(d=me+1),l<=me&&(g=me-1)}}function Ux(f,l,d){var g=f[l];f[l]=f[d],f[d]=g}function T_e(f,l){return f<l?-1:f>l?1:0}function j4(f,l){let d=f.length;if(d<=1)return[f];let g=[],b,T;for(let C=0;C<d;C++){let D=Se(f[C]);D!==0&&(f[C].area=Math.abs(D),T===void 0&&(T=D<0),T===D<0?(b&&g.push(b),b=[f[C]]):b.push(f[C]))}if(b&&g.push(b),l>1)for(let C=0;C<g.length;C++)g[C].length<=l||(S_e(g[C],l,1,g[C].length-1,E_e),g[C]=g[C].slice(0,l));return g}function E_e(f,l){return l.area-f.area}function U4(f,l,d){let g=d.patternDependencies,b=!1;for(let T of l){let C=T.paint.get(`${f}-pattern`);C.isConstant()||(b=!0);let D=C.constantOr(null);D&&(b=!0,g[D.to]=!0,g[D.from]=!0)}return b}function V4(f,l,d,g,b){let T=b.patternDependencies;for(let C of l){let D=C.paint.get(`${f}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:g-1},d,{},b.availableImages),$=D.evaluate({zoom:g},d,{},b.availableImages),ie=D.evaluate({zoom:g+1},d,{},b.availableImages);U=U&&U.name?U.name:U,$=$&&$.name?$.name:$,ie=ie&&ie.name?ie.name:ie,T[U]=!0,T[$]=!0,T[ie]=!0,d.patterns[C.id]={min:U,mid:$,max:ie}}}return d}class W4{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pn,this.indexArray=new X,this.indexArray2=new ee,this.programConfigurations=new ro(l.layers,l.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=U4("fill",this.layers,d);let b=this.layers[0].layout.get("fill-sort-key"),T=!b.isConstant(),C=[];for(let{feature:D,id:U,index:$,sourceLayerIndex:ie}of l){let ce=this.layers[0]._featureFilter.needGeometry,me=Eo(D,ce);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),me,g))continue;let Ae=T?b.evaluate(me,{},g,d.availableImages):void 0,Te={id:U,properties:D.properties,type:D.type,sourceLayerIndex:ie,index:$,geometry:ce?me.geometry:Li(D),patterns:{},sortKey:Ae};C.push(Te)}T&&C.sort((D,U)=>D.sortKey-U.sortKey);for(let D of C){let{geometry:U,index:$,sourceLayerIndex:ie}=D;if(this.hasPattern){let ce=V4("fill",this.layers,D,this.zoom,d);this.patternFeatures.push(ce)}else this.addFeature(D,U,$,g,{});d.featureIndex.insert(l[$].feature,U,$,ie,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,m_e),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,g,b,T){for(let C of j4(d,500)){let D=0;for(let Ae of C)D+=Ae.length;let U=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),$=U.vertexLength,ie=[],ce=[];for(let Ae of C){if(Ae.length===0)continue;Ae!==C[0]&&ce.push(ie.length/2);let Te=this.segments2.prepareSegment(Ae.length,this.layoutVertexArray,this.indexArray2),Le=Te.vertexLength;this.layoutVertexArray.emplaceBack(Ae[0].x,Ae[0].y),this.indexArray2.emplaceBack(Le+Ae.length-1,Le),ie.push(Ae[0].x),ie.push(Ae[0].y);for(let He=1;He<Ae.length;He++)this.layoutVertexArray.emplaceBack(Ae[He].x,Ae[He].y),this.indexArray2.emplaceBack(Le+He-1,Le+He),ie.push(Ae[He].x),ie.push(Ae[He].y);Te.vertexLength+=Ae.length,Te.primitiveLength+=Ae.length}let me=_j(ie,ce);for(let Ae=0;Ae<me.length;Ae+=3)this.indexArray.emplaceBack($+me[Ae],$+me[Ae+1],$+me[Ae+2]);U.vertexLength+=D,U.primitiveLength+=me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,T,b)}}let xj,bj;_r("FillBucket",W4,{omit:["layers","patternFeatures"]});var I_e={get paint(){return bj=bj||new Ni({"fill-antialias":new Rr(xt.paint_fill["fill-antialias"]),"fill-opacity":new Wr(xt.paint_fill["fill-opacity"]),"fill-color":new Wr(xt.paint_fill["fill-color"]),"fill-outline-color":new Wr(xt.paint_fill["fill-outline-color"]),"fill-translate":new Rr(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new Rr(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yf(xt.paint_fill["fill-pattern"])})},get layout(){return xj=xj||new Ni({"fill-sort-key":new Wr(xt.layout_fill["fill-sort-key"])})}};class C_e extends Is{constructor(l){super(l,I_e)}recalculate(l,d){super.recalculate(l,d);let g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new W4(l)}queryRadius(){return EA(this.paint.get("fill-translate"))}queryIntersectsFeature(l,d,g,b,T,C,D){return tj(IA(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,D),b)}isTileClipped(){return!0}}let k_e=_i([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),P_e=_i([{name:"a_centroid",components:2,type:"Int16"}],4),{members:O_e}=k_e;var Kh={},R_e=u,vj=D_;function D_(f,l,d,g,b){this.properties={},this.extent=d,this.type=0,this._pbf=f,this._geometry=-1,this._keys=g,this._values=b,f.readFields(N_e,this,l)}function N_e(f,l,d){f==1?l.id=d.readVarint():f==2?function(g,b){for(var T=g.readVarint()+g.pos;g.pos<T;){var C=b._keys[g.readVarint()],D=b._values[g.readVarint()];b.properties[C]=D}}(d,l):f==3?l.type=d.readVarint():f==4&&(l._geometry=d.pos)}function z_e(f){for(var l,d,g=0,b=0,T=f.length,C=T-1;b<T;C=b++)g+=((d=f[C]).x-(l=f[b]).x)*(l.y+d.y);return g}D_.types=["Unknown","Point","LineString","Polygon"],D_.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var l,d=f.readVarint()+f.pos,g=1,b=0,T=0,C=0,D=[];f.pos<d;){if(b<=0){var U=f.readVarint();g=7&U,b=U>>3}if(b--,g===1||g===2)T+=f.readSVarint(),C+=f.readSVarint(),g===1&&(l&&D.push(l),l=[]),l.push(new R_e(T,C));else{if(g!==7)throw new Error("unknown command "+g);l&&l.push(l[0].clone())}}return l&&D.push(l),D},D_.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var l=f.readVarint()+f.pos,d=1,g=0,b=0,T=0,C=1/0,D=-1/0,U=1/0,$=-1/0;f.pos<l;){if(g<=0){var ie=f.readVarint();d=7&ie,g=ie>>3}if(g--,d===1||d===2)(b+=f.readSVarint())<C&&(C=b),b>D&&(D=b),(T+=f.readSVarint())<U&&(U=T),T>$&&($=T);else if(d!==7)throw new Error("unknown command "+d)}return[C,U,D,$]},D_.prototype.toGeoJSON=function(f,l,d){var g,b,T=this.extent*Math.pow(2,d),C=this.extent*f,D=this.extent*l,U=this.loadGeometry(),$=D_.types[this.type];function ie(Ae){for(var Te=0;Te<Ae.length;Te++){var Le=Ae[Te];Ae[Te]=[360*(Le.x+C)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(Le.y+D)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var ce=[];for(g=0;g<U.length;g++)ce[g]=U[g][0];ie(U=ce);break;case 2:for(g=0;g<U.length;g++)ie(U[g]);break;case 3:for(U=function(Ae){var Te=Ae.length;if(Te<=1)return[Ae];for(var Le,He,Qe=[],lt=0;lt<Te;lt++){var tt=z_e(Ae[lt]);tt!==0&&(He===void 0&&(He=tt<0),He===tt<0?(Le&&Qe.push(Le),Le=[Ae[lt]]):Le.push(Ae[lt]))}return Le&&Qe.push(Le),Qe}(U),g=0;g<U.length;g++)for(b=0;b<U[g].length;b++)ie(U[g][b])}U.length===1?U=U[0]:$="Multi"+$;var me={type:"Feature",geometry:{type:$,coordinates:U},properties:this.properties};return"id"in this&&(me.id=this.id),me};var D_e=vj,wj=Aj;function Aj(f,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(L_e,this,l),this.length=this._features.length}function L_e(f,l,d){f===15?l.version=d.readVarint():f===1?l.name=d.readString():f===5?l.extent=d.readVarint():f===2?l._features.push(d.pos):f===3?l._keys.push(d.readString()):f===4&&l._values.push(function(g){for(var b=null,T=g.readVarint()+g.pos;g.pos<T;){var C=g.readVarint()>>3;b=C===1?g.readString():C===2?g.readFloat():C===3?g.readDouble():C===4?g.readVarint64():C===5?g.readVarint():C===6?g.readSVarint():C===7?g.readBoolean():null}return b}(d))}Aj.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var l=this._pbf.readVarint()+this._pbf.pos;return new D_e(this._pbf,l,this.extent,this._keys,this._values)};var F_e=wj;function B_e(f,l,d){if(f===3){var g=new F_e(d,d.readVarint()+d.pos);g.length&&(l[g.name]=g)}}Kh.VectorTile=function(f,l){this.layers=f.readFields(B_e,{},l)},Kh.VectorTileFeature=vj,Kh.VectorTileLayer=wj;let j_e=Kh.VectorTileFeature.types,Z4=Math.pow(2,13);function Vx(f,l,d,g,b,T,C,D){f.emplaceBack(l,d,2*Math.floor(g*Z4)+C,b*Z4*2,T*Z4*2,Math.round(D))}class Y4{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new er,this.centroidVertexArray=new Gt,this.indexArray=new X,this.programConfigurations=new ro(l.layers,l.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.features=[],this.hasPattern=U4("fill-extrusion",this.layers,d);for(let{feature:b,id:T,index:C,sourceLayerIndex:D}of l){let U=this.layers[0]._featureFilter.needGeometry,$=Eo(b,U);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),$,g))continue;let ie={id:T,sourceLayerIndex:D,index:C,geometry:U?$.geometry:Li(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(V4("fill-extrusion",this.layers,ie,this.zoom,d)):this.addFeature(ie,ie.geometry,C,g,{}),d.featureIndex.insert(b,ie.geometry,C,D,this.index,!0)}}addFeatures(l,d,g){for(let b of this.features){let{geometry:T}=b;this.addFeature(b,T,b.index,d,g)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,O_e),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,P_e.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,g,b,T){let C={x:0,y:0,vertexCount:0};for(let D of j4(d,500)){let U=0;for(let Te of D)U+=Te.length;let $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Te of D){if(Te.length===0||V_e(Te))continue;let Le=0;for(let He=0;He<Te.length;He++){let Qe=Te[He];if(He>=1){let lt=Te[He-1];if(!U_e(Qe,lt)){$.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let tt=Qe.sub(lt)._perp()._unit(),ct=lt.dist(Qe);Le+ct>32768&&(Le=0),Vx(this.layoutVertexArray,Qe.x,Qe.y,tt.x,tt.y,0,0,Le),Vx(this.layoutVertexArray,Qe.x,Qe.y,tt.x,tt.y,0,1,Le),C.x+=2*Qe.x,C.y+=2*Qe.y,C.vertexCount+=2,Le+=ct,Vx(this.layoutVertexArray,lt.x,lt.y,tt.x,tt.y,0,0,Le),Vx(this.layoutVertexArray,lt.x,lt.y,tt.x,tt.y,0,1,Le),C.x+=2*lt.x,C.y+=2*lt.y,C.vertexCount+=2;let vt=$.vertexLength;this.indexArray.emplaceBack(vt,vt+2,vt+1),this.indexArray.emplaceBack(vt+1,vt+2,vt+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+U>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray)),j_e[l.type]!=="Polygon")continue;let ie=[],ce=[],me=$.vertexLength;for(let Te of D)if(Te.length!==0){Te!==D[0]&&ce.push(ie.length/2);for(let Le=0;Le<Te.length;Le++){let He=Te[Le];Vx(this.layoutVertexArray,He.x,He.y,0,0,1,1,0),C.x+=He.x,C.y+=He.y,C.vertexCount+=1,ie.push(He.x),ie.push(He.y)}}let Ae=_j(ie,ce);for(let Te=0;Te<Ae.length;Te+=3)this.indexArray.emplaceBack(me+Ae[Te],me+Ae[Te+2],me+Ae[Te+1]);$.primitiveLength+=Ae.length/3,$.vertexLength+=U}for(let D=0;D<C.vertexCount;D++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,T,b)}}function U_e(f,l){return f.x===l.x&&(f.x<0||f.x>Dr)||f.y===l.y&&(f.y<0||f.y>Dr)}function V_e(f){return f.every(l=>l.x<0)||f.every(l=>l.x>Dr)||f.every(l=>l.y<0)||f.every(l=>l.y>Dr)}let Mj;_r("FillExtrusionBucket",Y4,{omit:["layers","features"]});var W_e={get paint(){return Mj=Mj||new Ni({"fill-extrusion-opacity":new Rr(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wr(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rr(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rr(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yf(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wr(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wr(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rr(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Z_e extends Is{constructor(l){super(l,W_e)}createBucket(l){return new Y4(l)}queryRadius(){return EA(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,d,g,b,T,C,D,U){let $=IA(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,D),ie=this.paint.get("fill-extrusion-height").evaluate(d,g),ce=this.paint.get("fill-extrusion-base").evaluate(d,g),me=function(Te,Le,He,Qe){let lt=[];for(let tt of Te){let ct=[tt.x,tt.y,0,1];CA(ct,ct,Le),lt.push(new p(ct[0]/ct[3],ct[1]/ct[3]))}return lt}($,U),Ae=function(Te,Le,He,Qe){let lt=[],tt=[],ct=Qe[8]*Le,vt=Qe[9]*Le,Ot=Qe[10]*Le,lr=Qe[11]*Le,Or=Qe[8]*He,ar=Qe[9]*He,rr=Qe[10]*He,Kt=Qe[11]*He;for(let Ar of Te){let Qt=[],Wt=[];for(let jr of Ar){let Nr=jr.x,wn=jr.y,yi=Qe[0]*Nr+Qe[4]*wn+Qe[12],Ii=Qe[1]*Nr+Qe[5]*wn+Qe[13],fo=Qe[2]*Nr+Qe[6]*wn+Qe[14],va=Qe[3]*Nr+Qe[7]*wn+Qe[15],Ps=fo+Ot,no=va+lr,Bo=yi+Or,Jo=Ii+ar,Os=fo+rr,Rs=va+Kt,ho=new p((yi+ct)/no,(Ii+vt)/no);ho.z=Ps/no,Qt.push(ho);let po=new p(Bo/Rs,Jo/Rs);po.z=Os/Rs,Wt.push(po)}lt.push(Qt),tt.push(Wt)}return[lt,tt]}(b,ce,ie,U);return function(Te,Le,He){let Qe=1/0;tj(He,Le)&&(Qe=Sj(He,Le[0]));for(let lt=0;lt<Le.length;lt++){let tt=Le[lt],ct=Te[lt];for(let vt=0;vt<tt.length-1;vt++){let Ot=tt[vt],lr=[Ot,tt[vt+1],ct[vt+1],ct[vt],Ot];ej(He,lr)&&(Qe=Math.min(Qe,Sj(He,lr)))}}return Qe!==1/0&&Qe}(Ae[0],Ae[1],me)}}function Wx(f,l){return f.x*l.x+f.y*l.y}function Sj(f,l){if(f.length===1){let d=0,g=l[d++],b;for(;!b||g.equals(b);)if(b=l[d++],!b)return 1/0;for(;d<l.length;d++){let T=l[d],C=f[0],D=b.sub(g),U=T.sub(g),$=C.sub(g),ie=Wx(D,D),ce=Wx(D,U),me=Wx(U,U),Ae=Wx($,D),Te=Wx($,U),Le=ie*me-ce*ce,He=(me*Ae-ce*Te)/Le,Qe=(ie*Te-ce*Ae)/Le,lt=g.z*(1-He-Qe)+b.z*He+T.z*Qe;if(isFinite(lt))return lt}return 1/0}{let d=1/0;for(let g of l)d=Math.min(d,g.z);return d}}let Y_e=_i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:q_e}=Y_e,G_e=_i([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:H_e}=G_e,X_e=Kh.VectorTileFeature.types,K_e=Math.cos(Math.PI/180*37.5),Tj=Math.pow(2,14)/.5;class q4{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new I,this.layoutVertexArray2=new O,this.indexArray=new X,this.programConfigurations=new ro(l.layers,l.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=U4("line",this.layers,d);let b=this.layers[0].layout.get("line-sort-key"),T=!b.isConstant(),C=[];for(let{feature:D,id:U,index:$,sourceLayerIndex:ie}of l){let ce=this.layers[0]._featureFilter.needGeometry,me=Eo(D,ce);if(!this.layers[0]._featureFilter.filter(new ii(this.zoom),me,g))continue;let Ae=T?b.evaluate(me,{},g):void 0,Te={id:U,properties:D.properties,type:D.type,sourceLayerIndex:ie,index:$,geometry:ce?me.geometry:Li(D),patterns:{},sortKey:Ae};C.push(Te)}T&&C.sort((D,U)=>D.sortKey-U.sortKey);for(let D of C){let{geometry:U,index:$,sourceLayerIndex:ie}=D;if(this.hasPattern){let ce=V4("line",this.layers,D,this.zoom,d);this.patternFeatures.push(ce)}else this.addFeature(D,U,$,g,{});d.featureIndex.insert(l[$].feature,U,$,ie,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,H_e)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,q_e),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,g,b,T){let C=this.layers[0].layout,D=C.get("line-join").evaluate(l,{}),U=C.get("line-cap"),$=C.get("line-miter-limit"),ie=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(let ce of d)this.addLine(ce,l,D,U,$,ie);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,T,b)}addLine(l,d,g,b,T,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Qe=0;Qe<l.length-1;Qe++)this.totalDistance+=l[Qe].dist(l[Qe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=X_e[d.type]==="Polygon",U=l.length;for(;U>=2&&l[U-1].equals(l[U-2]);)U--;let $=0;for(;$<U-1&&l[$].equals(l[$+1]);)$++;if(U<(D?3:2))return;g==="bevel"&&(T=1.05);let ie=this.overscaling<=16?15*Dr/(512*this.overscaling):0,ce=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray),me,Ae,Te,Le,He;this.e1=this.e2=-1,D&&(me=l[U-2],He=l[$].sub(me)._unit()._perp());for(let Qe=$;Qe<U;Qe++){if(Te=Qe===U-1?D?l[$+1]:void 0:l[Qe+1],Te&&l[Qe].equals(Te))continue;He&&(Le=He),me&&(Ae=me),me=l[Qe],He=Te?Te.sub(me)._unit()._perp():Le,Le=Le||He;let lt=Le.add(He);lt.x===0&&lt.y===0||lt._unit();let tt=Le.x*He.x+Le.y*He.y,ct=lt.x*He.x+lt.y*He.y,vt=ct!==0?1/ct:1/0,Ot=2*Math.sqrt(2-2*ct),lr=ct<K_e&&Ae&&Te,Or=Le.x*He.y-Le.y*He.x>0;if(lr&&Qe>$){let Kt=me.dist(Ae);if(Kt>2*ie){let Ar=me.sub(me.sub(Ae)._mult(ie/Kt)._round());this.updateDistance(Ae,Ar),this.addCurrentVertex(Ar,Le,0,0,ce),Ae=Ar}}let ar=Ae&&Te,rr=ar?g:D?"butt":b;if(ar&&rr==="round"&&(vt<C?rr="miter":vt<=2&&(rr="fakeround")),rr==="miter"&&vt>T&&(rr="bevel"),rr==="bevel"&&(vt>2&&(rr="flipbevel"),vt<T&&(rr="miter")),Ae&&this.updateDistance(Ae,me),rr==="miter")lt._mult(vt),this.addCurrentVertex(me,lt,0,0,ce);else if(rr==="flipbevel"){if(vt>100)lt=He.mult(-1);else{let Kt=vt*Le.add(He).mag()/Le.sub(He).mag();lt._perp()._mult(Kt*(Or?-1:1))}this.addCurrentVertex(me,lt,0,0,ce),this.addCurrentVertex(me,lt.mult(-1),0,0,ce)}else if(rr==="bevel"||rr==="fakeround"){let Kt=-Math.sqrt(vt*vt-1),Ar=Or?Kt:0,Qt=Or?0:Kt;if(Ae&&this.addCurrentVertex(me,Le,Ar,Qt,ce),rr==="fakeround"){let Wt=Math.round(180*Ot/Math.PI/20);for(let jr=1;jr<Wt;jr++){let Nr=jr/Wt;if(Nr!==.5){let yi=Nr-.5;Nr+=Nr*yi*(Nr-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*yi*yi+(.848013+tt*(.215638*tt-1.06021)))}let wn=He.sub(Le)._mult(Nr)._add(Le)._unit()._mult(Or?-1:1);this.addHalfVertex(me,wn.x,wn.y,!1,Or,0,ce)}}Te&&this.addCurrentVertex(me,He,-Ar,-Qt,ce)}else if(rr==="butt")this.addCurrentVertex(me,lt,0,0,ce);else if(rr==="square"){let Kt=Ae?1:-1;this.addCurrentVertex(me,lt,Kt,Kt,ce)}else rr==="round"&&(Ae&&(this.addCurrentVertex(me,Le,0,0,ce),this.addCurrentVertex(me,Le,1,1,ce,!0)),Te&&(this.addCurrentVertex(me,He,-1,-1,ce,!0),this.addCurrentVertex(me,He,0,0,ce)));if(lr&&Qe<U-1){let Kt=me.dist(Te);if(Kt>2*ie){let Ar=me.add(Te.sub(me)._mult(ie/Kt)._round());this.updateDistance(me,Ar),this.addCurrentVertex(Ar,He,0,0,ce),me=Ar}}}}addCurrentVertex(l,d,g,b,T,C=!1){let D=d.y*b-d.x,U=-d.y-d.x*b;this.addHalfVertex(l,d.x+d.y*g,d.y-d.x*g,C,!1,g,T),this.addHalfVertex(l,D,U,C,!0,-b,T),this.distance>Tj/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,g,b,T,C))}addHalfVertex({x:l,y:d},g,b,T,C,D,U){let $=.5*(this.lineClips?this.scaledDistance*(Tj-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(T?1:0),(d<<1)+(C?1:0),Math.round(63*g)+128,Math.round(63*b)+128,1+(D===0?0:D<0?-1:1)|(63&$)<<2,$>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let ie=U.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,ie),U.primitiveLength++),C?this.e2=ie:this.e1=ie}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let Ej,Ij;_r("LineBucket",q4,{omit:["layers","patternFeatures"]});var Cj={get paint(){return Ij=Ij||new Ni({"line-opacity":new Wr(xt.paint_line["line-opacity"]),"line-color":new Wr(xt.paint_line["line-color"]),"line-translate":new Rr(xt.paint_line["line-translate"]),"line-translate-anchor":new Rr(xt.paint_line["line-translate-anchor"]),"line-width":new Wr(xt.paint_line["line-width"]),"line-gap-width":new Wr(xt.paint_line["line-gap-width"]),"line-offset":new Wr(xt.paint_line["line-offset"]),"line-blur":new Wr(xt.paint_line["line-blur"]),"line-dasharray":new xf(xt.paint_line["line-dasharray"]),"line-pattern":new yf(xt.paint_line["line-pattern"]),"line-gradient":new rc(xt.paint_line["line-gradient"])})},get layout(){return Ej=Ej||new Ni({"line-cap":new Rr(xt.layout_line["line-cap"]),"line-join":new Wr(xt.layout_line["line-join"]),"line-miter-limit":new Rr(xt.layout_line["line-miter-limit"]),"line-round-limit":new Rr(xt.layout_line["line-round-limit"]),"line-sort-key":new Wr(xt.layout_line["line-sort-key"])})}};class $_e extends Wr{possiblyEvaluate(l,d){return d=new ii(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,g,b){return d=ne({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,g,b)}}let NA;class Q_e extends Is{constructor(l){super(l,Cj),this.gradientVersion=0,NA||(NA=new $_e(Cj.paint.properties["line-width"].specification),NA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let d=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof Fa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=NA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new q4(l)}queryRadius(l){let d=l,g=kj(zx("line-width",this,d),zx("line-gap-width",this,d)),b=zx("line-offset",this,d);return g/2+Math.abs(b)+EA(this.paint.get("line-translate"))}queryIntersectsFeature(l,d,g,b,T,C,D){let U=IA(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,D),$=D/2*kj(this.paint.get("line-width").evaluate(d,g),this.paint.get("line-gap-width").evaluate(d,g)),ie=this.paint.get("line-offset").evaluate(d,g);return ie&&(b=function(ce,me){let Ae=[];for(let Te=0;Te<ce.length;Te++){let Le=ce[Te],He=[];for(let Qe=0;Qe<Le.length;Qe++){let lt=Le[Qe-1],tt=Le[Qe],ct=Le[Qe+1],vt=Qe===0?new p(0,0):tt.sub(lt)._unit()._perp(),Ot=Qe===Le.length-1?new p(0,0):ct.sub(tt)._unit()._perp(),lr=vt._add(Ot)._unit(),Or=lr.x*Ot.x+lr.y*Ot.y;Or!==0&&lr._mult(1/Or),He.push(lr._mult(me)._add(tt))}Ae.push(He)}return Ae}(b,ie*D)),function(ce,me,Ae){for(let Te=0;Te<me.length;Te++){let Le=me[Te];if(ce.length>=3){for(let He=0;He<Le.length;He++)if(R_(ce,Le[He]))return!0}if(i_e(ce,Le,Ae))return!0}return!1}(U,b,$)}isTileClipped(){return!0}}function kj(f,l){return l>0?l+2*f:f}let J_e=_i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),e0e=_i([{name:"a_projected_pos",components:3,type:"Float32"}],4);_i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let t0e=_i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);_i([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Pj=_i([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),r0e=_i([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function n0e(f,l,d){return f.sections.forEach(g=>{g.text=function(b,T,C){let D=T.layout.get("text-transform").evaluate(C,{});return D==="uppercase"?b=b.toLocaleUpperCase():D==="lowercase"&&(b=b.toLocaleLowerCase()),Mo.applyArabicShaping&&(b=Mo.applyArabicShaping(b)),b}(g.text,l,d)}),f}_i([{name:"triangle",components:3,type:"Uint16"}]),_i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_i([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_i([{type:"Float32",name:"offsetX"}]),_i([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_i([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let Zx={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var uo=24,Oj=oi,Rj=function(f,l,d,g,b){var T,C,D=8*b-g-1,U=(1<<D)-1,$=U>>1,ie=-7,ce=d?b-1:0,me=d?-1:1,Ae=f[l+ce];for(ce+=me,T=Ae&(1<<-ie)-1,Ae>>=-ie,ie+=D;ie>0;T=256*T+f[l+ce],ce+=me,ie-=8);for(C=T&(1<<-ie)-1,T>>=-ie,ie+=g;ie>0;C=256*C+f[l+ce],ce+=me,ie-=8);if(T===0)T=1-$;else{if(T===U)return C?NaN:1/0*(Ae?-1:1);C+=Math.pow(2,g),T-=$}return(Ae?-1:1)*C*Math.pow(2,T-g)},Nj=function(f,l,d,g,b,T){var C,D,U,$=8*T-b-1,ie=(1<<$)-1,ce=ie>>1,me=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ae=g?0:T-1,Te=g?1:-1,Le=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(D=isNaN(l)?1:0,C=ie):(C=Math.floor(Math.log(l)/Math.LN2),l*(U=Math.pow(2,-C))<1&&(C--,U*=2),(l+=C+ce>=1?me/U:me*Math.pow(2,1-ce))*U>=2&&(C++,U/=2),C+ce>=ie?(D=0,C=ie):C+ce>=1?(D=(l*U-1)*Math.pow(2,b),C+=ce):(D=l*Math.pow(2,ce-1)*Math.pow(2,b),C=0));b>=8;f[d+Ae]=255&D,Ae+=Te,D/=256,b-=8);for(C=C<<b|D,$+=b;$>0;f[d+Ae]=255&C,Ae+=Te,C/=256,$-=8);f[d+Ae-Te]|=128*Le};function oi(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}oi.Varint=0,oi.Fixed64=1,oi.Bytes=2,oi.Fixed32=5;var G4=4294967296,zj=1/G4,Dj=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Af(f){return f.type===oi.Bytes?f.readVarint()+f.pos:f.pos+1}function L_(f,l,d){return d?4294967296*l+(f>>>0):4294967296*(l>>>0)+(f>>>0)}function Lj(f,l,d){var g=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));d.realloc(g);for(var b=d.pos-1;b>=f;b--)d.buf[b+g]=d.buf[b]}function i0e(f,l){for(var d=0;d<f.length;d++)l.writeVarint(f[d])}function o0e(f,l){for(var d=0;d<f.length;d++)l.writeSVarint(f[d])}function s0e(f,l){for(var d=0;d<f.length;d++)l.writeFloat(f[d])}function a0e(f,l){for(var d=0;d<f.length;d++)l.writeDouble(f[d])}function l0e(f,l){for(var d=0;d<f.length;d++)l.writeBoolean(f[d])}function c0e(f,l){for(var d=0;d<f.length;d++)l.writeFixed32(f[d])}function u0e(f,l){for(var d=0;d<f.length;d++)l.writeSFixed32(f[d])}function f0e(f,l){for(var d=0;d<f.length;d++)l.writeFixed64(f[d])}function h0e(f,l){for(var d=0;d<f.length;d++)l.writeSFixed64(f[d])}function zA(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+16777216*f[l+3]}function F_(f,l,d){f[d]=l,f[d+1]=l>>>8,f[d+2]=l>>>16,f[d+3]=l>>>24}function Fj(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+(f[l+3]<<24)}oi.prototype={destroy:function(){this.buf=null},readFields:function(f,l,d){for(d=d||this.length;this.pos<d;){var g=this.readVarint(),b=g>>3,T=this.pos;this.type=7&g,f(b,l,this),this.pos===T&&this.skip(g)}return l},readMessage:function(f,l){return this.readFields(f,l,this.readVarint()+this.pos)},readFixed32:function(){var f=zA(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=Fj(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=zA(this.buf,this.pos)+zA(this.buf,this.pos+4)*G4;return this.pos+=8,f},readSFixed64:function(){var f=zA(this.buf,this.pos)+Fj(this.buf,this.pos+4)*G4;return this.pos+=8,f},readFloat:function(){var f=Rj(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=Rj(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var l,d,g=this.buf;return l=127&(d=g[this.pos++]),d<128?l:(l|=(127&(d=g[this.pos++]))<<7,d<128?l:(l|=(127&(d=g[this.pos++]))<<14,d<128?l:(l|=(127&(d=g[this.pos++]))<<21,d<128?l:function(b,T,C){var D,U,$=C.buf;if(D=(112&(U=$[C.pos++]))>>4,U<128||(D|=(127&(U=$[C.pos++]))<<3,U<128)||(D|=(127&(U=$[C.pos++]))<<10,U<128)||(D|=(127&(U=$[C.pos++]))<<17,U<128)||(D|=(127&(U=$[C.pos++]))<<24,U<128)||(D|=(1&(U=$[C.pos++]))<<31,U<128))return L_(b,D,T);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(d=g[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,l=this.pos;return this.pos=f,f-l>=12&&Dj?function(d,g,b){return Dj.decode(d.subarray(g,b))}(this.buf,l,f):function(d,g,b){for(var T="",C=g;C<b;){var D,U,$,ie=d[C],ce=null,me=ie>239?4:ie>223?3:ie>191?2:1;if(C+me>b)break;me===1?ie<128&&(ce=ie):me===2?(192&(D=d[C+1]))==128&&(ce=(31&ie)<<6|63&D)<=127&&(ce=null):me===3?(U=d[C+2],(192&(D=d[C+1]))==128&&(192&U)==128&&((ce=(15&ie)<<12|(63&D)<<6|63&U)<=2047||ce>=55296&&ce<=57343)&&(ce=null)):me===4&&(U=d[C+2],$=d[C+3],(192&(D=d[C+1]))==128&&(192&U)==128&&(192&$)==128&&((ce=(15&ie)<<18|(63&D)<<12|(63&U)<<6|63&$)<=65535||ce>=1114112)&&(ce=null)),ce===null?(ce=65533,me=1):ce>65535&&(ce-=65536,T+=String.fromCharCode(ce>>>10&1023|55296),ce=56320|1023&ce),T+=String.fromCharCode(ce),C+=me}return T}(this.buf,l,f)},readBytes:function(){var f=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,f);return this.pos=f,l},readPackedVarint:function(f,l){if(this.type!==oi.Bytes)return f.push(this.readVarint(l));var d=Af(this);for(f=f||[];this.pos<d;)f.push(this.readVarint(l));return f},readPackedSVarint:function(f){if(this.type!==oi.Bytes)return f.push(this.readSVarint());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==oi.Bytes)return f.push(this.readBoolean());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==oi.Bytes)return f.push(this.readFloat());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==oi.Bytes)return f.push(this.readDouble());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==oi.Bytes)return f.push(this.readFixed32());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==oi.Bytes)return f.push(this.readSFixed32());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==oi.Bytes)return f.push(this.readFixed64());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==oi.Bytes)return f.push(this.readSFixed64());var l=Af(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed64());return f},skip:function(f){var l=7&f;if(l===oi.Varint)for(;this.buf[this.pos++]>127;);else if(l===oi.Bytes)this.pos=this.readVarint()+this.pos;else if(l===oi.Fixed32)this.pos+=4;else{if(l!==oi.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(f,l){this.writeVarint(f<<3|l)},realloc:function(f){for(var l=this.length||16;l<this.pos+f;)l*=2;if(l!==this.length){var d=new Uint8Array(l);d.set(this.buf),this.buf=d,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),F_(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),F_(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),F_(this.buf,-1&f,this.pos),F_(this.buf,Math.floor(f*zj),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),F_(this.buf,-1&f,this.pos),F_(this.buf,Math.floor(f*zj),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?function(l,d){var g,b;if(l>=0?(g=l%4294967296|0,b=l/4294967296|0):(b=~(-l/4294967296),4294967295^(g=~(-l%4294967296))?g=g+1|0:(g=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(T,C,D){D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,T>>>=7,D.buf[D.pos++]=127&T|128,D.buf[D.pos]=127&(T>>>=7)}(g,0,d),function(T,C){var D=(7&T)<<4;C.buf[C.pos++]|=D|((T>>>=3)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T|((T>>>=7)?128:0),T&&(C.buf[C.pos++]=127&T)))))}(b,d)}(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var l=this.pos;this.pos=function(g,b,T){for(var C,D,U=0;U<b.length;U++){if((C=b.charCodeAt(U))>55295&&C<57344){if(!D){C>56319||U+1===b.length?(g[T++]=239,g[T++]=191,g[T++]=189):D=C;continue}if(C<56320){g[T++]=239,g[T++]=191,g[T++]=189,D=C;continue}C=D-55296<<10|C-56320|65536,D=null}else D&&(g[T++]=239,g[T++]=191,g[T++]=189,D=null);C<128?g[T++]=C:(C<2048?g[T++]=C>>6|192:(C<65536?g[T++]=C>>12|224:(g[T++]=C>>18|240,g[T++]=C>>12&63|128),g[T++]=C>>6&63|128),g[T++]=63&C|128)}return T}(this.buf,f,this.pos);var d=this.pos-l;d>=128&&Lj(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeFloat:function(f){this.realloc(4),Nj(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),Nj(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var l=f.length;this.writeVarint(l),this.realloc(l);for(var d=0;d<l;d++)this.buf[this.pos++]=f[d]},writeRawMessage:function(f,l){this.pos++;var d=this.pos;f(l,this);var g=this.pos-d;g>=128&&Lj(d,g,this),this.pos=d-1,this.writeVarint(g),this.pos+=g},writeMessage:function(f,l,d){this.writeTag(f,oi.Bytes),this.writeRawMessage(l,d)},writePackedVarint:function(f,l){l.length&&this.writeMessage(f,i0e,l)},writePackedSVarint:function(f,l){l.length&&this.writeMessage(f,o0e,l)},writePackedBoolean:function(f,l){l.length&&this.writeMessage(f,l0e,l)},writePackedFloat:function(f,l){l.length&&this.writeMessage(f,s0e,l)},writePackedDouble:function(f,l){l.length&&this.writeMessage(f,a0e,l)},writePackedFixed32:function(f,l){l.length&&this.writeMessage(f,c0e,l)},writePackedSFixed32:function(f,l){l.length&&this.writeMessage(f,u0e,l)},writePackedFixed64:function(f,l){l.length&&this.writeMessage(f,f0e,l)},writePackedSFixed64:function(f,l){l.length&&this.writeMessage(f,h0e,l)},writeBytesField:function(f,l){this.writeTag(f,oi.Bytes),this.writeBytes(l)},writeFixed32Field:function(f,l){this.writeTag(f,oi.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(f,l){this.writeTag(f,oi.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(f,l){this.writeTag(f,oi.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(f,l){this.writeTag(f,oi.Fixed64),this.writeSFixed64(l)},writeVarintField:function(f,l){this.writeTag(f,oi.Varint),this.writeVarint(l)},writeSVarintField:function(f,l){this.writeTag(f,oi.Varint),this.writeSVarint(l)},writeStringField:function(f,l){this.writeTag(f,oi.Bytes),this.writeString(l)},writeFloatField:function(f,l){this.writeTag(f,oi.Fixed32),this.writeFloat(l)},writeDoubleField:function(f,l){this.writeTag(f,oi.Fixed64),this.writeDouble(l)},writeBooleanField:function(f,l){this.writeVarintField(f,!!l)}};var H4=a(Oj);let X4=3;function d0e(f,l,d){f===1&&d.readMessage(p0e,l)}function p0e(f,l,d){if(f===3){let{id:g,bitmap:b,width:T,height:C,left:D,top:U,advance:$}=d.readMessage(m0e,{});l.push({id:g,bitmap:new Lx({width:T+2*X4,height:C+2*X4},b),metrics:{width:T,height:C,left:D,top:U,advance:$}})}}function m0e(f,l,d){f===1?l.id=d.readVarint():f===2?l.bitmap=d.readBytes():f===3?l.width=d.readVarint():f===4?l.height=d.readVarint():f===5?l.left=d.readSVarint():f===6?l.top=d.readSVarint():f===7&&(l.advance=d.readVarint())}let Bj=X4;function jj(f){let l=0,d=0;for(let C of f)l+=C.w*C.h,d=Math.max(d,C.w);f.sort((C,D)=>D.h-C.h);let g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}],b=0,T=0;for(let C of f)for(let D=g.length-1;D>=0;D--){let U=g[D];if(!(C.w>U.w||C.h>U.h)){if(C.x=U.x,C.y=U.y,T=Math.max(T,C.y+C.h),b=Math.max(b,C.x+C.w),C.w===U.w&&C.h===U.h){let $=g.pop();D<g.length&&(g[D]=$)}else C.h===U.h?(U.x+=C.w,U.w-=C.w):C.w===U.w?(U.y+=C.h,U.h-=C.h):(g.push({x:U.x+C.w,y:U.y,w:U.w-C.w,h:C.h}),U.y+=C.h,U.h-=C.h);break}}return{w:b,h:T,fill:l/(b*T)||0}}let $s=1;class K4{constructor(l,{pixelRatio:d,version:g,stretchX:b,stretchY:T,content:C}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=b,this.stretchY=T,this.content=C,this.version=g}get tl(){return[this.paddedRect.x+$s,this.paddedRect.y+$s]}get br(){return[this.paddedRect.x+this.paddedRect.w-$s,this.paddedRect.y+this.paddedRect.h-$s]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*$s)/this.pixelRatio,(this.paddedRect.h-2*$s)/this.pixelRatio]}}class Uj{constructor(l,d){let g={},b={};this.haveRenderCallbacks=[];let T=[];this.addImages(l,g,T),this.addImages(d,b,T);let{w:C,h:D}=jj(T),U=new Ga({width:C||1,height:D||1});for(let $ in l){let ie=l[$],ce=g[$].paddedRect;Ga.copy(ie.data,U,{x:0,y:0},{x:ce.x+$s,y:ce.y+$s},ie.data)}for(let $ in d){let ie=d[$],ce=b[$].paddedRect,me=ce.x+$s,Ae=ce.y+$s,Te=ie.data.width,Le=ie.data.height;Ga.copy(ie.data,U,{x:0,y:0},{x:me,y:Ae},ie.data),Ga.copy(ie.data,U,{x:0,y:Le-1},{x:me,y:Ae-1},{width:Te,height:1}),Ga.copy(ie.data,U,{x:0,y:0},{x:me,y:Ae+Le},{width:Te,height:1}),Ga.copy(ie.data,U,{x:Te-1,y:0},{x:me-1,y:Ae},{width:1,height:Le}),Ga.copy(ie.data,U,{x:0,y:0},{x:me+Te,y:Ae},{width:1,height:Le})}this.image=U,this.iconPositions=g,this.patternPositions=b}addImages(l,d,g){for(let b in l){let T=l[b],C={x:0,y:0,w:T.data.width+2*$s,h:T.data.height+2*$s};g.push(C),d[b]=new K4(C,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let g in l.updatedImages)this.patchUpdatedImage(this.iconPositions[g],l.getImage(g),d),this.patchUpdatedImage(this.patternPositions[g],l.getImage(g),d)}patchUpdatedImage(l,d,g){if(!l||!d||l.version===d.version)return;l.version=d.version;let[b,T]=l.tl;g.update(d.data,void 0,{x:b,y:T})}}var $h;_r("ImagePosition",K4),_r("ImageAtlas",Uj),i.ai=void 0,($h=i.ai||(i.ai={}))[$h.none=0]="none",$h[$h.horizontal=1]="horizontal",$h[$h.vertical=2]="vertical",$h[$h.horizontalOnly=3]="horizontalOnly";let Yx=-17;class qx{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,d){let g=new qx;return g.scale=l||1,g.fontStack=d,g}static forImage(l){let d=new qx;return d.imageName=l,d}}class B_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){let g=new B_;for(let b=0;b<l.sections.length;b++){let T=l.sections[b];T.image?g.addImageSection(T):g.addTextSection(T,d)}return g}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let g=0;g<l.length;g++){let b=l.charCodeAt(g+1)||null,T=l.charCodeAt(g-1)||null;d+=b&&C_(b)&&!Zx[l[g+1]]||T&&C_(T)&&!Zx[l[g-1]]||!Zx[l[g]]?l[g]:Zx[l[g]]}return d}(this.text)}trim(){let l=0;for(let g=0;g<this.text.length&&LA[this.text.charCodeAt(g)];g++)l++;let d=this.text.length;for(let g=this.text.length-1;g>=0&&g>=l&&LA[this.text.charCodeAt(g)];g--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){let g=new B_;return g.text=this.text.substring(l,d),g.sectionIndex=this.sectionIndex.slice(l,d),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}addTextSection(l,d){this.text+=l.text,this.sections.push(qx.forText(l.scale,l.fontStack||d));let g=this.sections.length-1;for(let b=0;b<l.text.length;++b)this.sectionIndex.push(g)}addImageSection(l){let d=l.image?l.image.name:"";if(d.length===0)return void je("Can't add FormattedSection with an empty image.");let g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(qx.forImage(d)),this.sectionIndex.push(this.sections.length-1)):je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function DA(f,l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le){let He=B_.fromFeature(f,b),Qe;ce===i.ai.vertical&&He.verticalizePunctuation();let{processBidirectionalText:lt,processStyledBidirectionalText:tt}=Mo;if(lt&&He.sections.length===1){Qe=[];let Ot=lt(He.toString(),$4(He,$,T,l,g,Ae,Te));for(let lr of Ot){let Or=new B_;Or.text=lr,Or.sections=He.sections;for(let ar=0;ar<lr.length;ar++)Or.sectionIndex.push(0);Qe.push(Or)}}else if(tt){Qe=[];let Ot=tt(He.text,He.sectionIndex,$4(He,$,T,l,g,Ae,Te));for(let lr of Ot){let Or=new B_;Or.text=lr[0],Or.sectionIndex=lr[1],Or.sections=He.sections,Qe.push(Or)}}else Qe=function(Ot,lr){let Or=[],ar=Ot.text,rr=0;for(let Kt of lr)Or.push(Ot.substring(rr,Kt)),rr=Kt;return rr<ar.length&&Or.push(Ot.substring(rr,ar.length)),Or}(He,$4(He,$,T,l,g,Ae,Te));let ct=[],vt={positionedLines:ct,text:He.toString(),top:ie[1],bottom:ie[1],left:ie[0],right:ie[0],writingMode:ce,iconsInText:!1,verticalizable:!1};return function(Ot,lr,Or,ar,rr,Kt,Ar,Qt,Wt,jr,Nr,wn){let yi=0,Ii=Yx,fo=0,va=0,Ps=Qt==="right"?1:Qt==="left"?0:.5,no=0;for(let ho of rr){ho.trim();let po=ho.getMaxScale(),us=(po-1)*uo,Ns={positionedGlyphs:[],lineOffset:0};Ot.positionedLines[no]=Ns;let fs=Ns.positionedGlyphs,Qs=0;if(!ho.length()){Ii+=Kt,++no;continue}for(let mo=0;mo<ho.length();mo++){let En=ho.getSection(mo),hs=ho.getSectionIndex(mo),es=ho.getCharCode(mo),go=0,xl=null,oc=null,sc=null,Mf=uo,bl=!(Wt===i.ai.horizontal||!Nr&&!om(es)||Nr&&(LA[es]||(Bo=es,ir.Arabic(Bo)||ir["Arabic Supplement"](Bo)||ir["Arabic Extended-A"](Bo)||ir["Arabic Presentation Forms-A"](Bo)||ir["Arabic Presentation Forms-B"](Bo))));if(En.imageName){let Xa=ar[En.imageName];if(!Xa)continue;sc=En.imageName,Ot.iconsInText=Ot.iconsInText||!0,oc=Xa.paddedRect;let ea=Xa.displaySize;En.scale=En.scale*uo/wn,xl={width:ea[0],height:ea[1],left:$s,top:-Bj,advance:bl?ea[1]:ea[0]},go=us+(uo-ea[1]*En.scale),Mf=xl.advance;let Sf=bl?ea[0]*En.scale-uo*po:ea[1]*En.scale-uo*po;Sf>0&&Sf>Qs&&(Qs=Sf)}else{let Xa=Or[En.fontStack],ea=Xa&&Xa[es];if(ea&&ea.rect)oc=ea.rect,xl=ea.metrics;else{let Sf=lr[En.fontStack],$x=Sf&&Sf[es];if(!$x)continue;xl=$x.metrics}go=(po-En.scale)*uo}bl?(Ot.verticalizable=!0,fs.push({glyph:es,imageName:sc,x:yi,y:Ii+go,vertical:bl,scale:En.scale,fontStack:En.fontStack,sectionIndex:hs,metrics:xl,rect:oc}),yi+=Mf*En.scale+jr):(fs.push({glyph:es,imageName:sc,x:yi,y:Ii+go,vertical:bl,scale:En.scale,fontStack:En.fontStack,sectionIndex:hs,metrics:xl,rect:oc}),yi+=xl.advance*En.scale+jr)}fs.length!==0&&(fo=Math.max(yi-jr,fo),y0e(fs,0,fs.length-1,Ps,Qs)),yi=0;let Js=Kt*po+Qs;Ns.lineOffset=Math.max(Qs,us),Ii+=Js,va=Math.max(Js,va),++no}var Bo;let Jo=Ii-Yx,{horizontalAlign:Os,verticalAlign:Rs}=Q4(Ar);(function(ho,po,us,Ns,fs,Qs,Js,mo,En){let hs=(po-us)*fs,es=0;es=Qs!==Js?-mo*Ns-Yx:(-Ns*En+.5)*Js;for(let go of ho)for(let xl of go.positionedGlyphs)xl.x+=hs,xl.y+=es})(Ot.positionedLines,Ps,Os,Rs,fo,va,Kt,Jo,rr.length),Ot.top+=-Rs*Jo,Ot.bottom=Ot.top+Jo,Ot.left+=-Os*fo,Ot.right=Ot.left+fo}(vt,l,d,g,Qe,C,D,U,ce,$,me,Le),!function(Ot){for(let lr of Ot)if(lr.positionedGlyphs.length!==0)return!1;return!0}(ct)&&vt}let LA={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},g0e={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Vj(f,l,d,g,b,T){if(l.imageName){let C=g[l.imageName];return C?C.displaySize[0]*l.scale*uo/T+b:0}{let C=d[l.fontStack],D=C&&C[f];return D?D.metrics.advance*l.scale+b:0}}function Wj(f,l,d,g){let b=Math.pow(f-l,2);return g?f<l?b/2:2*b:b+Math.abs(d)*d}function _0e(f,l,d){let g=0;return f===10&&(g-=1e4),d&&(g+=150),f!==40&&f!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function Zj(f,l,d,g,b,T){let C=null,D=Wj(l,d,b,T);for(let U of g){let $=Wj(l-U.x,d,b,T)+U.badness;$<=D&&(C=U,D=$)}return{index:f,x:l,priorBreak:C,badness:D}}function Yj(f){return f?Yj(f.priorBreak).concat(f.index):[]}function $4(f,l,d,g,b,T,C){if(T!=="point")return[];if(!f)return[];let D=[],U=function(me,Ae,Te,Le,He,Qe){let lt=0;for(let tt=0;tt<me.length();tt++){let ct=me.getSection(tt);lt+=Vj(me.getCharCode(tt),ct,Le,He,Ae,Qe)}return lt/Math.max(1,Math.ceil(lt/Te))}(f,l,d,g,b,C),$=f.text.indexOf("\u200B")>=0,ie=0;for(let me=0;me<f.length();me++){let Ae=f.getSection(me),Te=f.getCharCode(me);if(LA[Te]||(ie+=Vj(Te,Ae,g,b,l,C)),me<f.length()-1){let Le=!((ce=Te)<11904||!(ir["Bopomofo Extended"](ce)||ir.Bopomofo(ce)||ir["CJK Compatibility Forms"](ce)||ir["CJK Compatibility Ideographs"](ce)||ir["CJK Compatibility"](ce)||ir["CJK Radicals Supplement"](ce)||ir["CJK Strokes"](ce)||ir["CJK Symbols and Punctuation"](ce)||ir["CJK Unified Ideographs Extension A"](ce)||ir["CJK Unified Ideographs"](ce)||ir["Enclosed CJK Letters and Months"](ce)||ir["Halfwidth and Fullwidth Forms"](ce)||ir.Hiragana(ce)||ir["Ideographic Description Characters"](ce)||ir["Kangxi Radicals"](ce)||ir["Katakana Phonetic Extensions"](ce)||ir.Katakana(ce)||ir["Vertical Forms"](ce)||ir["Yi Radicals"](ce)||ir["Yi Syllables"](ce)));(g0e[Te]||Le||Ae.imageName)&&D.push(Zj(me+1,ie,U,D,_0e(Te,f.getCharCode(me+1),Le&&$),!1))}}var ce;return Yj(Zj(f.length(),ie,U,D,0,!0))}function Q4(f){let l=.5,d=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function y0e(f,l,d,g,b){if(!g&&!b)return;let T=f[d],C=(f[d].x+T.metrics.advance*T.scale)*g;for(let D=l;D<=d;D++)f[D].x-=C,f[D].y+=b}function x0e(f,l,d){let{horizontalAlign:g,verticalAlign:b}=Q4(d),T=l[0]-f.displaySize[0]*g,C=l[1]-f.displaySize[1]*b;return{image:f,top:C,bottom:C+f.displaySize[1],left:T,right:T+f.displaySize[0]}}function qj(f,l,d,g,b,T){let C=f.image,D;if(C.content){let He=C.content,Qe=C.pixelRatio||1;D=[He[0]/Qe,He[1]/Qe,C.displaySize[0]-He[2]/Qe,C.displaySize[1]-He[3]/Qe]}let U=l.left*T,$=l.right*T,ie,ce,me,Ae;d==="width"||d==="both"?(Ae=b[0]+U-g[3],ce=b[0]+$+g[1]):(Ae=b[0]+(U+$-C.displaySize[0])/2,ce=Ae+C.displaySize[0]);let Te=l.top*T,Le=l.bottom*T;return d==="height"||d==="both"?(ie=b[1]+Te-g[0],me=b[1]+Le+g[2]):(ie=b[1]+(Te+Le-C.displaySize[1])/2,me=ie+C.displaySize[1]),{image:C,top:ie,right:ce,bottom:me,left:Ae,collisionPadding:D}}let Gx=255,ru=128,Qh=Gx*ru;function Gj(f,l){let{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new ii(f+1))};if(d.kind==="source")return{kind:"source"};{let{zoomStops:g,interpolationType:b}=d,T=0;for(;T<g.length&&g[T]<=f;)T++;T=Math.max(0,T-1);let C=T;for(;C<g.length&&g[C]<f+1;)C++;C=Math.min(g.length-1,C);let D=g[T],U=g[C];return d.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:U,interpolationType:b}:{kind:"camera",minZoom:D,maxZoom:U,minSize:d.evaluate(new ii(D)),maxSize:d.evaluate(new ii(U)),interpolationType:b}}}function J4(f,l,d){let g="never",b=f.get(l);return b?g=b:f.get(d)&&(g="always"),g}let b0e=Kh.VectorTileFeature.types,v0e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function FA(f,l,d,g,b,T,C,D,U,$,ie,ce,me){let Ae=D?Math.min(Qh,Math.round(D[0])):0,Te=D?Math.min(Qh,Math.round(D[1])):0;f.emplaceBack(l,d,Math.round(32*g),Math.round(32*b),T,C,(Ae<<1)+(U?1:0),Te,16*$,16*ie,256*ce,256*me)}function e5(f,l,d){f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d)}function w0e(f){for(let l of f.sections)if(sm(l.text))return!0;return!1}class t5{constructor(l){this.layoutVertexArray=new Z,this.indexArray=new X,this.programConfigurations=l,this.segments=new _e,this.dynamicLayoutVertexArray=new H,this.opacityVertexArray=new K,this.hasVisibleVertices=!1,this.placedSymbolArray=new nt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,g,b){this.isEmpty()||(g&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,J_e.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,e0e.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,v0e,!0),this.opacityVertexBuffer.itemSize=1),(g||b)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_r("SymbolBuffers",t5);class r5{constructor(l,d,g){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new g,this.segments=new _e,this.collisionVertexArray=new q}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,t0e.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_r("CollisionBuffers",r5);class j_{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(C=>C.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=R4([]),this.placementViewportMatrix=R4([]);let d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gj(this.zoom,d["text-size"]),this.iconSizeData=Gj(this.zoom,d["icon-size"]);let g=this.layers[0].layout,b=g.get("symbol-sort-key"),T=g.get("symbol-z-order");this.canOverlap=J4(g,"text-overlap","text-allow-overlap")!=="never"||J4(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(C=>i.ai[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=l.sourceID}createArrays(){this.text=new t5(new ro(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new t5(new ro(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new st,this.lineVertexArray=new wt,this.symbolInstances=new $e,this.textAnchorOffsets=new Pt}calculateGlyphDependencies(l,d,g,b,T){for(let C=0;C<l.length;C++)if(d[l.charCodeAt(C)]=!0,(g||b)&&T){let D=Zx[l.charAt(C)];D&&(d[D.charCodeAt(0)]=!0)}}populate(l,d,g){let b=this.layers[0],T=b.layout,C=T.get("text-font"),D=T.get("text-field"),U=T.get("icon-image"),$=(D.value.kind!=="constant"||D.value.value instanceof kr&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),ie=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,ce=T.get("symbol-sort-key");if(this.features=[],!$&&!ie)return;let me=d.iconDependencies,Ae=d.glyphDependencies,Te=d.availableImages,Le=new ii(this.zoom);for(let{feature:He,id:Qe,index:lt,sourceLayerIndex:tt}of l){let ct=b._featureFilter.needGeometry,vt=Eo(He,ct);if(!b._featureFilter.filter(Le,vt,g))continue;let Ot,lr;if(ct||(vt.geometry=Li(He)),$){let ar=b.getValueAndResolveTokens("text-field",vt,g,Te),rr=kr.factory(ar);w0e(rr)&&(this.hasRTLText=!0),(!this.hasRTLText||cm()==="unavailable"||this.hasRTLText&&Mo.isParsed())&&(Ot=n0e(rr,b,vt))}if(ie){let ar=b.getValueAndResolveTokens("icon-image",vt,g,Te);lr=ar instanceof qr?ar:qr.fromString(ar)}if(!Ot&&!lr)continue;let Or=this.sortFeaturesByKey?ce.evaluate(vt,{},g):void 0;if(this.features.push({id:Qe,text:Ot,icon:lr,index:lt,sourceLayerIndex:tt,geometry:vt.geometry,properties:He.properties,type:b0e[He.type],sortKey:Or}),lr&&(me[lr.name]=!0),Ot){let ar=C.evaluate(vt,{},g).join(","),rr=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(i.ai.vertical)>=0;for(let Kt of Ot.sections)if(Kt.image)me[Kt.image.name]=!0;else{let Ar=nm(Ot.toString()),Qt=Kt.fontStack||ar,Wt=Ae[Qt]=Ae[Qt]||{};this.calculateGlyphDependencies(Kt.text,Wt,rr,this.allowVerticalPlacement,Ar)}}}T.get("symbol-placement")==="line"&&(this.features=function(He){let Qe={},lt={},tt=[],ct=0;function vt(ar){tt.push(He[ar]),ct++}function Ot(ar,rr,Kt){let Ar=lt[ar];return delete lt[ar],lt[rr]=Ar,tt[Ar].geometry[0].pop(),tt[Ar].geometry[0]=tt[Ar].geometry[0].concat(Kt[0]),Ar}function lr(ar,rr,Kt){let Ar=Qe[rr];return delete Qe[rr],Qe[ar]=Ar,tt[Ar].geometry[0].shift(),tt[Ar].geometry[0]=Kt[0].concat(tt[Ar].geometry[0]),Ar}function Or(ar,rr,Kt){let Ar=Kt?rr[0][rr[0].length-1]:rr[0][0];return`${ar}:${Ar.x}:${Ar.y}`}for(let ar=0;ar<He.length;ar++){let rr=He[ar],Kt=rr.geometry,Ar=rr.text?rr.text.toString():null;if(!Ar){vt(ar);continue}let Qt=Or(Ar,Kt),Wt=Or(Ar,Kt,!0);if(Qt in lt&&Wt in Qe&&lt[Qt]!==Qe[Wt]){let jr=lr(Qt,Wt,Kt),Nr=Ot(Qt,Wt,tt[jr].geometry);delete Qe[Qt],delete lt[Wt],lt[Or(Ar,tt[Nr].geometry,!0)]=Nr,tt[jr].geometry=null}else Qt in lt?Ot(Qt,Wt,Kt):Wt in Qe?lr(Qt,Wt,Kt):(vt(ar),Qe[Qt]=ct-1,lt[Wt]=ct-1)}return tt.filter(ar=>ar.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((He,Qe)=>He.sortKey-Qe.sortKey)}update(l,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,g),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){let g=this.lineVertexArray.length;if(l.segment!==void 0){let b=l.dist(d[l.segment+1]),T=l.dist(d[l.segment]),C={};for(let D=l.segment+1;D<d.length;D++)C[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:b},D<d.length-1&&(b+=d[D+1].dist(d[D]));for(let D=l.segment||0;D>=0;D--)C[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:T},D>0&&(T+=d[D-1].dist(d[D]));for(let D=0;D<d.length;D++){let U=C[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(l,d,g,b,T,C,D,U,$,ie,ce,me){let Ae=l.indexArray,Te=l.layoutVertexArray,Le=l.segments.prepareSegment(4*d.length,Te,Ae,this.canOverlap?C.sortKey:void 0),He=this.glyphOffsetArray.length,Qe=Le.vertexLength,lt=this.allowVerticalPlacement&&D===i.ai.vertical?Math.PI/2:0,tt=C.text&&C.text.sections;for(let ct=0;ct<d.length;ct++){let{tl:vt,tr:Ot,bl:lr,br:Or,tex:ar,pixelOffsetTL:rr,pixelOffsetBR:Kt,minFontScaleX:Ar,minFontScaleY:Qt,glyphOffset:Wt,isSDF:jr,sectionIndex:Nr}=d[ct],wn=Le.vertexLength,yi=Wt[1];FA(Te,U.x,U.y,vt.x,yi+vt.y,ar.x,ar.y,g,jr,rr.x,rr.y,Ar,Qt),FA(Te,U.x,U.y,Ot.x,yi+Ot.y,ar.x+ar.w,ar.y,g,jr,Kt.x,rr.y,Ar,Qt),FA(Te,U.x,U.y,lr.x,yi+lr.y,ar.x,ar.y+ar.h,g,jr,rr.x,Kt.y,Ar,Qt),FA(Te,U.x,U.y,Or.x,yi+Or.y,ar.x+ar.w,ar.y+ar.h,g,jr,Kt.x,Kt.y,Ar,Qt),e5(l.dynamicLayoutVertexArray,U,lt),Ae.emplaceBack(wn,wn+1,wn+2),Ae.emplaceBack(wn+1,wn+2,wn+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wt[0]),ct!==d.length-1&&Nr===d[ct+1].sectionIndex||l.programConfigurations.populatePaintArrays(Te.length,C,C.index,{},me,tt&&tt[Nr])}l.placedSymbolArray.emplaceBack(U.x,U.y,He,this.glyphOffsetArray.length-He,Qe,$,ie,U.segment,g?g[0]:0,g?g[1]:0,b[0],b[1],D,0,!1,0,ce)}_addCollisionDebugVertex(l,d,g,b,T,C){return d.emplaceBack(0,0),l.emplaceBack(g.x,g.y,b,T,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(l,d,g,b,T,C,D){let U=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),$=U.vertexLength,ie=T.layoutVertexArray,ce=T.collisionVertexArray,me=D.anchorX,Ae=D.anchorY;this._addCollisionDebugVertex(ie,ce,C,me,Ae,new p(l,d)),this._addCollisionDebugVertex(ie,ce,C,me,Ae,new p(g,d)),this._addCollisionDebugVertex(ie,ce,C,me,Ae,new p(g,b)),this._addCollisionDebugVertex(ie,ce,C,me,Ae,new p(l,b)),U.vertexLength+=4;let Te=T.indexArray;Te.emplaceBack($,$+1),Te.emplaceBack($+1,$+2),Te.emplaceBack($+2,$+3),Te.emplaceBack($+3,$),U.primitiveLength+=4}addDebugCollisionBoxes(l,d,g,b){for(let T=l;T<d;T++){let C=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,b?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new r5(B,Pj.members,ee),this.iconCollisionBox=new r5(B,Pj.members,ee);for(let l=0;l<this.symbolInstances.length;l++){let d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,g,b,T,C,D,U,$){let ie={};for(let ce=d;ce<g;ce++){let me=l.get(ce);ie.textBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ie.textFeatureIndex=me.featureIndex;break}for(let ce=b;ce<T;ce++){let me=l.get(ce);ie.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ie.verticalTextFeatureIndex=me.featureIndex;break}for(let ce=C;ce<D;ce++){let me=l.get(ce);ie.iconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ie.iconFeatureIndex=me.featureIndex;break}for(let ce=U;ce<$;ce++){let me=l.get(ce);ie.verticalIconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ie.verticalIconFeatureIndex=me.featureIndex;break}return ie}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){let g=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){let g=l.placedSymbolArray.get(d),b=g.vertexStartIndex+4*g.numGlyphs;for(let T=g.vertexStartIndex;T<b;T+=4)l.indexArray.emplaceBack(T,T+1,T+2),l.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let d=Math.sin(l),g=Math.cos(l),b=[],T=[],C=[];for(let D=0;D<this.symbolInstances.length;++D){C.push(D);let U=this.symbolInstances.get(D);b.push(0|Math.round(d*U.anchorX+g*U.anchorY)),T.push(U.featureIndex)}return C.sort((D,U)=>b[D]-b[U]||T[U]-T[D]),C}addToSortKeyRanges(l,d){let g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===d?g.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let d of this.symbolInstanceIndexes){let g=this.symbolInstances.get(d);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((b,T,C)=>{b>=0&&C.indexOf(b)===T&&this.addIndicesForPlacedSymbol(this.text,b)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Hj,Xj;_r("SymbolBucket",j_,{omit:["layers","collisionBoxArray","features","compareText"]}),j_.MAX_GLYPHS=65535,j_.addDynamicAttributes=e5;var n5={get paint(){return Xj=Xj||new Ni({"icon-opacity":new Wr(xt.paint_symbol["icon-opacity"]),"icon-color":new Wr(xt.paint_symbol["icon-color"]),"icon-halo-color":new Wr(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wr(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wr(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new Rr(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rr(xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wr(xt.paint_symbol["text-opacity"]),"text-color":new Wr(xt.paint_symbol["text-color"],{runtimeType:ji,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Wr(xt.paint_symbol["text-halo-color"]),"text-halo-width":new Wr(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new Wr(xt.paint_symbol["text-halo-blur"]),"text-translate":new Rr(xt.paint_symbol["text-translate"]),"text-translate-anchor":new Rr(xt.paint_symbol["text-translate-anchor"])})},get layout(){return Hj=Hj||new Ni({"symbol-placement":new Rr(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new Rr(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rr(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wr(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rr(xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rr(xt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Rr(xt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Rr(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rr(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rr(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wr(xt.layout_symbol["icon-size"]),"icon-text-fit":new Rr(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rr(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wr(xt.layout_symbol["icon-image"]),"icon-rotate":new Wr(xt.layout_symbol["icon-rotate"]),"icon-padding":new Wr(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new Rr(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new Wr(xt.layout_symbol["icon-offset"]),"icon-anchor":new Wr(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rr(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rr(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rr(xt.layout_symbol["text-rotation-alignment"]),"text-field":new Wr(xt.layout_symbol["text-field"]),"text-font":new Wr(xt.layout_symbol["text-font"]),"text-size":new Wr(xt.layout_symbol["text-size"]),"text-max-width":new Wr(xt.layout_symbol["text-max-width"]),"text-line-height":new Rr(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new Wr(xt.layout_symbol["text-letter-spacing"]),"text-justify":new Wr(xt.layout_symbol["text-justify"]),"text-radial-offset":new Wr(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rr(xt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wr(xt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wr(xt.layout_symbol["text-anchor"]),"text-max-angle":new Rr(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new Rr(xt.layout_symbol["text-writing-mode"]),"text-rotate":new Wr(xt.layout_symbol["text-rotate"]),"text-padding":new Rr(xt.layout_symbol["text-padding"]),"text-keep-upright":new Rr(xt.layout_symbol["text-keep-upright"]),"text-transform":new Wr(xt.layout_symbol["text-transform"]),"text-offset":new Wr(xt.layout_symbol["text-offset"]),"text-allow-overlap":new Rr(xt.layout_symbol["text-allow-overlap"]),"text-overlap":new Rr(xt.layout_symbol["text-overlap"]),"text-ignore-placement":new Rr(xt.layout_symbol["text-ignore-placement"]),"text-optional":new Rr(xt.layout_symbol["text-optional"])})}};class Kj{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:wo,this.defaultValue=l}evaluate(l){if(l.formattedSection){let d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_r("FormatSectionOverride",Kj,{omit:["defaultValue"]});class BA extends Is{constructor(l){super(l,n5)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let g=this.layout.get("text-writing-mode");if(g){let b=[];for(let T of g)b.indexOf(T)<0&&b.push(T);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,g,b){let T=this.layout.get(l).evaluate(d,{},g,b),C=this._unevaluatedLayout._values[l];return C.isDataDriven()||lf(C.value)||!T?T:function(D,U){return U.replace(/{([^{}]+)}/g,($,ie)=>D&&ie in D?String(D[ie]):"")}(d.properties,T)}createBucket(l){return new j_(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let l of n5.paint.overridableProperties){if(!BA.hasPaintOverride(this.layout,l))continue;let d=this.paint.get(l),g=new Kj(d),b=new Rh(g,d.property.specification),T=null;T=d.value.kind==="constant"||d.value.kind==="source"?new Hp("source",b):new zh("composite",b,d.value.zoomStops),this.paint._values[l]=new Fo(d.property,T,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&BA.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){let g=l.get("text-field"),b=n5.paint.properties[d],T=!1,C=D=>{for(let U of D)if(b.overrides&&b.overrides.hasOverride(U))return void(T=!0)};if(g.value.kind==="constant"&&g.value.value instanceof kr)C(g.value.value.sections);else if(g.value.kind==="source"){let D=$=>{T||($ instanceof lo&&fn($.value)===Oe?C($.value.sections):$ instanceof kh?C($.sections):$.eachChild(D))},U=g.value;U._styleExpression&&D(U._styleExpression.expression)}return T}}let $j;var A0e={get paint(){return $j=$j||new Ni({"background-color":new Rr(xt.paint_background["background-color"]),"background-pattern":new xf(xt.paint_background["background-pattern"]),"background-opacity":new Rr(xt.paint_background["background-opacity"])})}};class M0e extends Is{constructor(l){super(l,A0e)}}let Qj;var S0e={get paint(){return Qj=Qj||new Ni({"raster-opacity":new Rr(xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rr(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rr(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rr(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new Rr(xt.paint_raster["raster-saturation"]),"raster-contrast":new Rr(xt.paint_raster["raster-contrast"]),"raster-resampling":new Rr(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new Rr(xt.paint_raster["raster-fade-duration"])})}};class T0e extends Is{constructor(l){super(l,S0e)}}class E0e extends Is{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class I0e{constructor(l){this._callback=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let i5=63710088e-1;class Jh{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Jh(J(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){let d=Math.PI/180,g=this.lat*d,b=l.lat*d,T=Math.sin(g)*Math.sin(b)+Math.cos(g)*Math.cos(b)*Math.cos((l.lng-this.lng)*d);return i5*Math.acos(Math.min(T,1))}static convert(l){if(l instanceof Jh)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Jh(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Jh(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Jj=2*Math.PI*i5;function eU(f){return Jj*Math.cos(f*Math.PI/180)}function tU(f){return(180+f)/360}function rU(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function nU(f,l){return f/eU(l)}function iU(f){return 360*f-180}function o5(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class jA{constructor(l,d,g=0){this.x=+l,this.y=+d,this.z=+g}static fromLngLat(l,d=0){let g=Jh.convert(l);return new jA(tU(g.lng),rU(g.lat),nU(d,g.lat))}toLngLat(){return new Jh(iU(this.x),o5(this.y))}toAltitude(){return this.z*eU(o5(this.y))}meterInMercatorCoordinateUnits(){return 1/Jj*(l=o5(this.y),1/Math.cos(l*Math.PI/180));var l}}function oU(f,l,d){var g=2*Math.PI*6378137/256/Math.pow(2,d);return[f*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}class s5{constructor(l,d,g){if(l<0||l>25||g<0||g>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))throw new Error(`x=${d}, y=${g}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=g,this.key=Hx(0,l,l,d,g)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,g){let b=(C=this.y,D=this.z,U=oU(256*(T=this.x),256*(C=Math.pow(2,D)-C-1),D),$=oU(256*(T+1),256*(C+1),D),U[0]+","+U[1]+","+$[0]+","+$[1]);var T,C,D,U,$;let ie=function(ce,me,Ae){let Te,Le="";for(let He=ce;He>0;He--)Te=1<<He-1,Le+=(me&Te?1:0)+(Ae&Te?2:0);return Le}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,ie).replace(/{bbox-epsg-3857}/g,b)}isChildOf(l){let d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){let d=Math.pow(2,this.z);return new p((l.x*d-this.x)*Dr,(l.y*d-this.y)*Dr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sU{constructor(l,d){this.wrap=l,this.canonical=d,this.key=Hx(l,d.z,d.z,d.x,d.y)}}class Ha{constructor(l,d,g,b,T){if(l<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${g}`);this.overscaledZ=l,this.wrap=d,this.canonical=new s5(g,+b,+T),this.key=Hx(d,l,g,b,T)}clone(){return new Ha(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let d=this.canonical.z-l;return l>this.canonical.z?new Ha(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ha(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let g=this.canonical.z-l;return l>this.canonical.z?Hx(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):Hx(this.wrap*+d,l,l,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(l){if(l.wrap!==this.wrap)return!1;let d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new Ha(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let d=this.canonical.z+1,g=2*this.canonical.x,b=2*this.canonical.y;return[new Ha(d,this.wrap,d,g,b),new Ha(d,this.wrap,d,g+1,b),new Ha(d,this.wrap,d,g,b+1),new Ha(d,this.wrap,d,g+1,b+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Ha(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Ha(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sU(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new jA(l.x-this.wrap,l.y))}}function Hx(f,l,d,g,b){(f*=2)<0&&(f=-1*f-1);let T=1<<d;return(T*T*f+T*b+g).toString(36)+d.toString(36)+l.toString(36)}_r("CanonicalTileID",s5),_r("OverscaledTileID",Ha,{omit:["posMatrix"]});class aU{constructor(l,d,g,b=1,T=1,C=1,D=0){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void je(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;let U=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=T,this.blueFactor=C,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let $=0;$<U;$++)this.data[this._idx(-1,$)]=this.data[this._idx(0,$)],this.data[this._idx(U,$)]=this.data[this._idx(U-1,$)],this.data[this._idx($,-1)]=this.data[this._idx($,0)],this.data[this._idx($,U)]=this.data[this._idx($,U-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(U,-1)]=this.data[this._idx(U-1,0)],this.data[this._idx(-1,U)]=this.data[this._idx(0,U-1)],this.data[this._idx(U,U)]=this.data[this._idx(U-1,U-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let $=0;$<U;$++)for(let ie=0;ie<U;ie++){let ce=this.get($,ie);ce>this.max&&(this.max=ce),ce<this.min&&(this.min=ce)}}get(l,d){let g=new Uint8Array(this.data.buffer),b=4*this._idx(l,d);return this.unpack(g[b],g[b+1],g[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,g){return l*this.redFactor+d*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Ga({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,g){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let b=d*this.dim,T=d*this.dim+this.dim,C=g*this.dim,D=g*this.dim+this.dim;switch(d){case-1:b=T-1;break;case 1:T=b+1}switch(g){case-1:C=D-1;break;case 1:D=C+1}let U=-d*this.dim,$=-g*this.dim;for(let ie=C;ie<D;ie++)for(let ce=b;ce<T;ce++)this.data[this._idx(ce,ie)]=l.data[this._idx(ce+U,ie+$)]}}_r("DEMData",aU);class lU{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){let g=l[d];this._stringToNumber[g]=d,this._numberToString[d]=g}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class cU{constructor(l,d,g,b,T){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=g,l._y=b,this.properties=l.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){let l={geometry:this.geometry};for(let d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class uU{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new Xc(Dr,16,0),this.grid3D=new Xc(Dr,16,0),this.featureIndexArray=new zt,this.promoteId=d}insert(l,d,g,b,T,C){let D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,b,T);let U=C?this.grid3D:this.grid;for(let $=0;$<d.length;$++){let ie=d[$],ce=[1/0,1/0,-1/0,-1/0];for(let me=0;me<ie.length;me++){let Ae=ie[me];ce[0]=Math.min(ce[0],Ae.x),ce[1]=Math.min(ce[1],Ae.y),ce[2]=Math.max(ce[2],Ae.x),ce[3]=Math.max(ce[3],Ae.y)}ce[0]<Dr&&ce[1]<Dr&&ce[2]>=0&&ce[3]>=0&&U.insert(D,ce[0],ce[1],ce[2],ce[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Kh.VectorTile(new H4(this.rawTileData)).layers,this.sourceLayerCoder=new lU(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,g,b){this.loadVTLayers();let T=l.params||{},C=Dr/l.tileSize/l.scale,D=Kp(T.filter),U=l.queryGeometry,$=l.queryPadding*C,ie=hU(U),ce=this.grid.query(ie.minX-$,ie.minY-$,ie.maxX+$,ie.maxY+$),me=hU(l.cameraQueryGeometry),Ae=this.grid3D.query(me.minX-$,me.minY-$,me.maxX+$,me.maxY+$,(He,Qe,lt,tt)=>function(ct,vt,Ot,lr,Or){for(let rr of ct)if(vt<=rr.x&&Ot<=rr.y&&lr>=rr.x&&Or>=rr.y)return!0;let ar=[new p(vt,Ot),new p(vt,Or),new p(lr,Or),new p(lr,Ot)];if(ct.length>2){for(let rr of ar)if(R_(ct,rr))return!0}for(let rr=0;rr<ct.length-1;rr++)if(s_e(ct[rr],ct[rr+1],ar))return!0;return!1}(l.cameraQueryGeometry,He-$,Qe-$,lt+$,tt+$));for(let He of Ae)ce.push(He);ce.sort(C0e);let Te={},Le;for(let He=0;He<ce.length;He++){let Qe=ce[He];if(Qe===Le)continue;Le=Qe;let lt=this.featureIndexArray.get(Qe),tt=null;this.loadMatchingFeature(Te,lt.bucketIndex,lt.sourceLayerIndex,lt.featureIndex,D,T.layers,T.availableImages,d,g,b,(ct,vt,Ot)=>(tt||(tt=Li(ct)),vt.queryIntersectsFeature(U,ct,Ot,tt,this.z,l.transform,C,l.pixelPosMatrix)))}return Te}loadMatchingFeature(l,d,g,b,T,C,D,U,$,ie,ce){let me=this.bucketLayerIDs[d];if(C&&!function(He,Qe){for(let lt=0;lt<He.length;lt++)if(Qe.indexOf(He[lt])>=0)return!0;return!1}(C,me))return;let Ae=this.sourceLayerCoder.decode(g),Te=this.vtLayers[Ae].feature(b);if(T.needGeometry){let He=Eo(Te,!0);if(!T.filter(new ii(this.tileID.overscaledZ),He,this.tileID.canonical))return}else if(!T.filter(new ii(this.tileID.overscaledZ),Te))return;let Le=this.getId(Te,Ae);for(let He=0;He<me.length;He++){let Qe=me[He];if(C&&C.indexOf(Qe)<0)continue;let lt=U[Qe];if(!lt)continue;let tt={};Le&&ie&&(tt=ie.getState(lt.sourceLayer||"_geojsonTileLayer",Le));let ct=ne({},$[Qe]);ct.paint=fU(ct.paint,lt.paint,Te,tt,D),ct.layout=fU(ct.layout,lt.layout,Te,tt,D);let vt=!ce||ce(Te,lt,tt);if(!vt)continue;let Ot=new cU(Te,this.z,this.x,this.y,Le);Ot.layer=ct;let lr=l[Qe];lr===void 0&&(lr=l[Qe]=[]),lr.push({featureIndex:b,feature:Ot,intersectionZ:vt})}}lookupSymbolFeatures(l,d,g,b,T,C,D,U){let $={};this.loadVTLayers();let ie=Kp(T);for(let ce of l)this.loadMatchingFeature($,g,b,ce,ie,C,D,U,d);return $}hasLayer(l){for(let d of this.bucketLayerIDs)for(let g of d)if(l===g)return!0;return!1}getId(l,d){let g=l.id;return this.promoteId&&(g=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof g=="boolean"&&(g=Number(g))),g}}function fU(f,l,d,g,b){return fe(f,(T,C)=>{let D=l instanceof Hh?l.get(C):null;return D&&D.evaluate?D.evaluate(d,g,b):D})}function hU(f){let l=1/0,d=1/0,g=-1/0,b=-1/0;for(let T of f)l=Math.min(l,T.x),d=Math.min(d,T.y),g=Math.max(g,T.x),b=Math.max(b,T.y);return{minX:l,minY:d,maxX:g,maxY:b}}function C0e(f,l){return l-f}function dU(f,l,d,g,b){let T=[];for(let C=0;C<f.length;C++){let D=f[C],U;for(let $=0;$<D.length-1;$++){let ie=D[$],ce=D[$+1];ie.x<l&&ce.x<l||(ie.x<l?ie=new p(l,ie.y+(l-ie.x)/(ce.x-ie.x)*(ce.y-ie.y))._round():ce.x<l&&(ce=new p(l,ie.y+(l-ie.x)/(ce.x-ie.x)*(ce.y-ie.y))._round()),ie.y<d&&ce.y<d||(ie.y<d?ie=new p(ie.x+(d-ie.y)/(ce.y-ie.y)*(ce.x-ie.x),d)._round():ce.y<d&&(ce=new p(ie.x+(d-ie.y)/(ce.y-ie.y)*(ce.x-ie.x),d)._round()),ie.x>=g&&ce.x>=g||(ie.x>=g?ie=new p(g,ie.y+(g-ie.x)/(ce.x-ie.x)*(ce.y-ie.y))._round():ce.x>=g&&(ce=new p(g,ie.y+(g-ie.x)/(ce.x-ie.x)*(ce.y-ie.y))._round()),ie.y>=b&&ce.y>=b||(ie.y>=b?ie=new p(ie.x+(b-ie.y)/(ce.y-ie.y)*(ce.x-ie.x),b)._round():ce.y>=b&&(ce=new p(ie.x+(b-ie.y)/(ce.y-ie.y)*(ce.x-ie.x),b)._round()),U&&ie.equals(U[U.length-1])||(U=[ie],T.push(U)),U.push(ce)))))}}return T}_r("FeatureIndex",uU,{omit:["rawTileData","sourceLayerCoder"]});class ed extends p{constructor(l,d,g,b){super(l,d),this.angle=g,b!==void 0&&(this.segment=b)}clone(){return new ed(this.x,this.y,this.angle,this.segment)}}function pU(f,l,d,g,b){if(l.segment===void 0||d===0)return!0;let T=l,C=l.segment+1,D=0;for(;D>-d/2;){if(C--,C<0)return!1;D-=f[C].dist(T),T=f[C]}D+=f[C].dist(f[C+1]),C++;let U=[],$=0;for(;D<d/2;){let ie=f[C],ce=f[C+1];if(!ce)return!1;let me=f[C-1].angleTo(ie)-ie.angleTo(ce);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:D,angleDelta:me}),$+=me;D-U[0].distance>g;)$-=U.shift().angleDelta;if($>b)return!1;C++,D+=ie.dist(ce)}return!0}function mU(f){let l=0;for(let d=0;d<f.length-1;d++)l+=f[d].dist(f[d+1]);return l}function gU(f,l,d){return f?.6*l*d:0}function _U(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function k0e(f,l,d,g,b,T){let C=gU(d,b,T),D=_U(d,g)*T,U=0,$=mU(f)/2;for(let ie=0;ie<f.length-1;ie++){let ce=f[ie],me=f[ie+1],Ae=ce.dist(me);if(U+Ae>$){let Te=($-U)/Ae,Le=Go.number(ce.x,me.x,Te),He=Go.number(ce.y,me.y,Te),Qe=new ed(Le,He,me.angleTo(ce),ie);return Qe._round(),!C||pU(f,Qe,D,C,l)?Qe:void 0}U+=Ae}}function P0e(f,l,d,g,b,T,C,D,U){let $=gU(g,T,C),ie=_U(g,b),ce=ie*C,me=f[0].x===0||f[0].x===U||f[0].y===0||f[0].y===U;return l-ce<l/4&&(l=ce+l/4),yU(f,me?l/2*D%l:(ie/2+2*T)*C*D%l,l,$,d,ce,me,!1,U)}function yU(f,l,d,g,b,T,C,D,U){let $=T/2,ie=mU(f),ce=0,me=l-d,Ae=[];for(let Te=0;Te<f.length-1;Te++){let Le=f[Te],He=f[Te+1],Qe=Le.dist(He),lt=He.angleTo(Le);for(;me+d<ce+Qe;){me+=d;let tt=(me-ce)/Qe,ct=Go.number(Le.x,He.x,tt),vt=Go.number(Le.y,He.y,tt);if(ct>=0&&ct<U&&vt>=0&&vt<U&&me-$>=0&&me+$<=ie){let Ot=new ed(ct,vt,lt,Te);Ot._round(),g&&!pU(f,Ot,T,g,b)||Ae.push(Ot)}}ce+=Qe}return D||Ae.length||C||(Ae=yU(f,ce/2,d,g,b,T,C,!0,U)),Ae}_r("Anchor",ed);let U_=$s;function xU(f,l,d,g){let b=[],T=f.image,C=T.pixelRatio,D=T.paddedRect.w-2*U_,U=T.paddedRect.h-2*U_,$=f.right-f.left,ie=f.bottom-f.top,ce=T.stretchX||[[0,D]],me=T.stretchY||[[0,U]],Ae=(Kt,Ar)=>Kt+Ar[1]-Ar[0],Te=ce.reduce(Ae,0),Le=me.reduce(Ae,0),He=D-Te,Qe=U-Le,lt=0,tt=Te,ct=0,vt=Le,Ot=0,lr=He,Or=0,ar=Qe;if(T.content&&g){let Kt=T.content;lt=UA(ce,0,Kt[0]),ct=UA(me,0,Kt[1]),tt=UA(ce,Kt[0],Kt[2]),vt=UA(me,Kt[1],Kt[3]),Ot=Kt[0]-lt,Or=Kt[1]-ct,lr=Kt[2]-Kt[0]-tt,ar=Kt[3]-Kt[1]-vt}let rr=(Kt,Ar,Qt,Wt)=>{let jr=VA(Kt.stretch-lt,tt,$,f.left),Nr=WA(Kt.fixed-Ot,lr,Kt.stretch,Te),wn=VA(Ar.stretch-ct,vt,ie,f.top),yi=WA(Ar.fixed-Or,ar,Ar.stretch,Le),Ii=VA(Qt.stretch-lt,tt,$,f.left),fo=WA(Qt.fixed-Ot,lr,Qt.stretch,Te),va=VA(Wt.stretch-ct,vt,ie,f.top),Ps=WA(Wt.fixed-Or,ar,Wt.stretch,Le),no=new p(jr,wn),Bo=new p(Ii,wn),Jo=new p(Ii,va),Os=new p(jr,va),Rs=new p(Nr/C,yi/C),ho=new p(fo/C,Ps/C),po=l*Math.PI/180;if(po){let fs=Math.sin(po),Qs=Math.cos(po),Js=[Qs,-fs,fs,Qs];no._matMult(Js),Bo._matMult(Js),Os._matMult(Js),Jo._matMult(Js)}let us=Kt.stretch+Kt.fixed,Ns=Ar.stretch+Ar.fixed;return{tl:no,tr:Bo,bl:Os,br:Jo,tex:{x:T.paddedRect.x+U_+us,y:T.paddedRect.y+U_+Ns,w:Qt.stretch+Qt.fixed-us,h:Wt.stretch+Wt.fixed-Ns},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rs,pixelOffsetBR:ho,minFontScaleX:lr/C/$,minFontScaleY:ar/C/ie,isSDF:d}};if(g&&(T.stretchX||T.stretchY)){let Kt=bU(ce,He,Te),Ar=bU(me,Qe,Le);for(let Qt=0;Qt<Kt.length-1;Qt++){let Wt=Kt[Qt],jr=Kt[Qt+1];for(let Nr=0;Nr<Ar.length-1;Nr++)b.push(rr(Wt,Ar[Nr],jr,Ar[Nr+1]))}}else b.push(rr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:U+1}));return b}function UA(f,l,d){let g=0;for(let b of f)g+=Math.max(l,Math.min(d,b[1]))-Math.max(l,Math.min(d,b[0]));return g}function bU(f,l,d){let g=[{fixed:-U_,stretch:0}];for(let[b,T]of f){let C=g[g.length-1];g.push({fixed:b-C.stretch,stretch:C.stretch}),g.push({fixed:b-C.stretch,stretch:C.stretch+(T-b)})}return g.push({fixed:l+U_,stretch:d}),g}function VA(f,l,d,g){return f/l*d+g}function WA(f,l,d,g){return f-l*d/g}class ZA{constructor(l,d,g,b,T,C,D,U,$,ie){if(this.boxStartIndex=l.length,$){let ce=C.top,me=C.bottom,Ae=C.collisionPadding;Ae&&(ce-=Ae[1],me+=Ae[3]);let Te=me-ce;Te>0&&(Te=Math.max(10,Te),this.circleDiameter=Te)}else{let ce=C.top*D-U[0],me=C.bottom*D+U[2],Ae=C.left*D-U[3],Te=C.right*D+U[1],Le=C.collisionPadding;if(Le&&(Ae-=Le[0]*D,ce-=Le[1]*D,Te+=Le[2]*D,me+=Le[3]*D),ie){let He=new p(Ae,ce),Qe=new p(Te,ce),lt=new p(Ae,me),tt=new p(Te,me),ct=ie*Math.PI/180;He._rotate(ct),Qe._rotate(ct),lt._rotate(ct),tt._rotate(ct),Ae=Math.min(He.x,Qe.x,lt.x,tt.x),Te=Math.max(He.x,Qe.x,lt.x,tt.x),ce=Math.min(He.y,Qe.y,lt.y,tt.y),me=Math.max(He.y,Qe.y,lt.y,tt.y)}l.emplaceBack(d.x,d.y,Ae,ce,Te,me,g,b,T)}this.boxEndIndex=l.length}}class O0e{constructor(l=[],d=R0e){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let l=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:d,compare:g}=this,b=d[l];for(;l>0;){let T=l-1>>1,C=d[T];if(g(b,C)>=0)break;d[l]=C,l=T}d[l]=b}_down(l){let{data:d,compare:g}=this,b=this.length>>1,T=d[l];for(;l<b;){let C=1+(l<<1),D=d[C],U=C+1;if(U<this.length&&g(d[U],D)<0&&(C=U,D=d[U]),g(D,T)>=0)break;d[l]=D,l=C}d[l]=T}}function R0e(f,l){return f<l?-1:f>l?1:0}function N0e(f,l=1,d=!1){let g=1/0,b=1/0,T=-1/0,C=-1/0,D=f[0];for(let Ae=0;Ae<D.length;Ae++){let Te=D[Ae];(!Ae||Te.x<g)&&(g=Te.x),(!Ae||Te.y<b)&&(b=Te.y),(!Ae||Te.x>T)&&(T=Te.x),(!Ae||Te.y>C)&&(C=Te.y)}let U=Math.min(T-g,C-b),$=U/2,ie=new O0e([],z0e);if(U===0)return new p(g,b);for(let Ae=g;Ae<T;Ae+=U)for(let Te=b;Te<C;Te+=U)ie.push(new V_(Ae+$,Te+$,$,f));let ce=function(Ae){let Te=0,Le=0,He=0,Qe=Ae[0];for(let lt=0,tt=Qe.length,ct=tt-1;lt<tt;ct=lt++){let vt=Qe[lt],Ot=Qe[ct],lr=vt.x*Ot.y-Ot.x*vt.y;Le+=(vt.x+Ot.x)*lr,He+=(vt.y+Ot.y)*lr,Te+=3*lr}return new V_(Le/Te,He/Te,0,Ae)}(f),me=ie.length;for(;ie.length;){let Ae=ie.pop();(Ae.d>ce.d||!ce.d)&&(ce=Ae,d&&console.log("found best %d after %d probes",Math.round(1e4*Ae.d)/1e4,me)),Ae.max-ce.d<=l||($=Ae.h/2,ie.push(new V_(Ae.p.x-$,Ae.p.y-$,$,f)),ie.push(new V_(Ae.p.x+$,Ae.p.y-$,$,f)),ie.push(new V_(Ae.p.x-$,Ae.p.y+$,$,f)),ie.push(new V_(Ae.p.x+$,Ae.p.y+$,$,f)),me+=4)}return d&&(console.log(`num probes: ${me}`),console.log(`best distance: ${ce.d}`)),ce.p}function z0e(f,l){return l.max-f.max}function V_(f,l,d,g){this.p=new p(f,l),this.h=d,this.d=function(b,T){let C=!1,D=1/0;for(let U=0;U<T.length;U++){let $=T[U];for(let ie=0,ce=$.length,me=ce-1;ie<ce;me=ie++){let Ae=$[ie],Te=$[me];Ae.y>b.y!=Te.y>b.y&&b.x<(Te.x-Ae.x)*(b.y-Ae.y)/(Te.y-Ae.y)+Ae.x&&(C=!C),D=Math.min(D,rj(b,Ae,Te))}}return(C?1:-1)*Math.sqrt(D)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var Qo;i.aq=void 0,(Qo=i.aq||(i.aq={}))[Qo.center=1]="center",Qo[Qo.left=2]="left",Qo[Qo.right=3]="right",Qo[Qo.top=4]="top",Qo[Qo.bottom=5]="bottom",Qo[Qo["top-left"]=6]="top-left",Qo[Qo["top-right"]=7]="top-right",Qo[Qo["bottom-left"]=8]="bottom-left",Qo[Qo["bottom-right"]=9]="bottom-right";let td=7,a5=Number.POSITIVE_INFINITY;function vU(f,l){return l[1]!==a5?function(d,g,b){let T=0,C=0;switch(g=Math.abs(g),b=Math.abs(b),d){case"top-right":case"top-left":case"top":C=b-td;break;case"bottom-right":case"bottom-left":case"bottom":C=-b+td}switch(d){case"top-right":case"bottom-right":case"right":T=-g;break;case"top-left":case"bottom-left":case"left":T=g}return[T,C]}(f,l[0],l[1]):function(d,g){let b=0,T=0;g<0&&(g=0);let C=g/Math.SQRT2;switch(d){case"top-right":case"top-left":T=C-td;break;case"bottom-right":case"bottom-left":T=-C+td;break;case"bottom":T=-g+td;break;case"top":T=g-td}switch(d){case"top-right":case"bottom-right":b=-C;break;case"top-left":case"bottom-left":b=C;break;case"left":b=g;break;case"right":b=-g}return[b,T]}(f,l[0])}function wU(f,l,d){var g;let b=f.layout,T=(g=b.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(l,{},d);if(T){let D=T.values,U=[];for(let $=0;$<D.length;$+=2){let ie=U[$]=D[$],ce=D[$+1].map(me=>me*uo);ie.startsWith("top")?ce[1]-=td:ie.startsWith("bottom")&&(ce[1]+=td),U[$+1]=ce}return new on(U)}let C=b.get("text-variable-anchor");if(C){let D;D=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(l,{},d)*uo,a5]:b.get("text-offset").evaluate(l,{},d).map($=>$*uo);let U=[];for(let $ of C)U.push($,vU($,D));return new on(U)}return null}function l5(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function D0e(f,l,d,g,b,T,C,D,U,$,ie){let ce=T.textMaxSize.evaluate(l,{});ce===void 0&&(ce=C);let me=f.layers[0].layout,Ae=me.get("icon-offset").evaluate(l,{},ie),Te=MU(d.horizontal),Le=C/24,He=f.tilePixelRatio*Le,Qe=f.tilePixelRatio*ce/24,lt=f.tilePixelRatio*D,tt=f.tilePixelRatio*me.get("symbol-spacing"),ct=me.get("text-padding")*f.tilePixelRatio,vt=function(Wt,jr,Nr,wn=1){let yi=Wt.get("icon-padding").evaluate(jr,{},Nr),Ii=yi&&yi.values;return[Ii[0]*wn,Ii[1]*wn,Ii[2]*wn,Ii[3]*wn]}(me,l,ie,f.tilePixelRatio),Ot=me.get("text-max-angle")/180*Math.PI,lr=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",Or=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",ar=me.get("symbol-placement"),rr=tt/2,Kt=me.get("icon-text-fit"),Ar;g&&Kt!=="none"&&(f.allowVerticalPlacement&&d.vertical&&(Ar=qj(g,d.vertical,Kt,me.get("icon-text-fit-padding"),Ae,Le)),Te&&(g=qj(g,Te,Kt,me.get("icon-text-fit-padding"),Ae,Le)));let Qt=(Wt,jr)=>{jr.x<0||jr.x>=Dr||jr.y<0||jr.y>=Dr||function(Nr,wn,yi,Ii,fo,va,Ps,no,Bo,Jo,Os,Rs,ho,po,us,Ns,fs,Qs,Js,mo,En,hs,es,go,xl){let oc=Nr.addToLineVertexArray(wn,yi),sc,Mf,bl,Xa,ea=0,Sf=0,$x=0,IU=0,g5=-1,_5=-1,Tf={},CU=Nt("");if(Nr.allowVerticalPlacement&&Ii.vertical){let ds=no.layout.get("text-rotate").evaluate(En,{},go)+90;bl=new ZA(Bo,wn,Jo,Os,Rs,Ii.vertical,ho,po,us,ds),Ps&&(Xa=new ZA(Bo,wn,Jo,Os,Rs,Ps,fs,Qs,us,ds))}if(fo){let ds=no.layout.get("icon-rotate").evaluate(En,{}),Ka=no.layout.get("icon-text-fit")!=="none",ym=xU(fo,ds,es,Ka),lc=Ps?xU(Ps,ds,es,Ka):void 0;Mf=new ZA(Bo,wn,Jo,Os,Rs,fo,fs,Qs,!1,ds),ea=4*ym.length;let xm=Nr.iconSizeData,nu=null;xm.kind==="source"?(nu=[ru*no.layout.get("icon-size").evaluate(En,{})],nu[0]>Qh&&je(`${Nr.layerIds[0]}: Value for "icon-size" is >= ${Gx}. Reduce your "icon-size".`)):xm.kind==="composite"&&(nu=[ru*hs.compositeIconSizes[0].evaluate(En,{},go),ru*hs.compositeIconSizes[1].evaluate(En,{},go)],(nu[0]>Qh||nu[1]>Qh)&&je(`${Nr.layerIds[0]}: Value for "icon-size" is >= ${Gx}. Reduce your "icon-size".`)),Nr.addSymbols(Nr.icon,ym,nu,mo,Js,En,i.ai.none,wn,oc.lineStartIndex,oc.lineLength,-1,go),g5=Nr.icon.placedSymbolArray.length-1,lc&&(Sf=4*lc.length,Nr.addSymbols(Nr.icon,lc,nu,mo,Js,En,i.ai.vertical,wn,oc.lineStartIndex,oc.lineLength,-1,go),_5=Nr.icon.placedSymbolArray.length-1)}let kU=Object.keys(Ii.horizontal);for(let ds of kU){let Ka=Ii.horizontal[ds];if(!sc){CU=Nt(Ka.text);let lc=no.layout.get("text-rotate").evaluate(En,{},go);sc=new ZA(Bo,wn,Jo,Os,Rs,Ka,ho,po,us,lc)}let ym=Ka.positionedLines.length===1;if($x+=AU(Nr,wn,Ka,va,no,us,En,Ns,oc,Ii.vertical?i.ai.horizontal:i.ai.horizontalOnly,ym?kU:[ds],Tf,g5,hs,go),ym)break}Ii.vertical&&(IU+=AU(Nr,wn,Ii.vertical,va,no,us,En,Ns,oc,i.ai.vertical,["vertical"],Tf,_5,hs,go));let B0e=sc?sc.boxStartIndex:Nr.collisionBoxArray.length,j0e=sc?sc.boxEndIndex:Nr.collisionBoxArray.length,U0e=bl?bl.boxStartIndex:Nr.collisionBoxArray.length,V0e=bl?bl.boxEndIndex:Nr.collisionBoxArray.length,W0e=Mf?Mf.boxStartIndex:Nr.collisionBoxArray.length,Z0e=Mf?Mf.boxEndIndex:Nr.collisionBoxArray.length,Y0e=Xa?Xa.boxStartIndex:Nr.collisionBoxArray.length,q0e=Xa?Xa.boxEndIndex:Nr.collisionBoxArray.length,ac=-1,qA=(ds,Ka)=>ds&&ds.circleDiameter?Math.max(ds.circleDiameter,Ka):Ka;ac=qA(sc,ac),ac=qA(bl,ac),ac=qA(Mf,ac),ac=qA(Xa,ac);let PU=ac>-1?1:0;PU&&(ac*=xl/uo),Nr.glyphOffsetArray.length>=j_.MAX_GLYPHS&&je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),En.sortKey!==void 0&&Nr.addToSortKeyRanges(Nr.symbolInstances.length,En.sortKey);let G0e=wU(no,En,go),[H0e,X0e]=function(ds,Ka){let ym=ds.length,lc=Ka?.values;if(lc?.length>0)for(let xm=0;xm<lc.length;xm+=2){let nu=lc[xm+1];ds.emplaceBack(i.aq[lc[xm]],nu[0],nu[1])}return[ym,ds.length]}(Nr.textAnchorOffsets,G0e);Nr.symbolInstances.emplaceBack(wn.x,wn.y,Tf.right>=0?Tf.right:-1,Tf.center>=0?Tf.center:-1,Tf.left>=0?Tf.left:-1,Tf.vertical||-1,g5,_5,CU,B0e,j0e,U0e,V0e,W0e,Z0e,Y0e,q0e,Jo,$x,IU,ea,Sf,PU,0,ho,ac,H0e,X0e)}(f,jr,Wt,d,g,b,Ar,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,He,[ct,ct,ct,ct],lr,U,lt,vt,Or,Ae,l,T,$,ie,C)};if(ar==="line")for(let Wt of dU(l.geometry,0,0,Dr,Dr)){let jr=P0e(Wt,tt,Ot,d.vertical||Te,g,24,Qe,f.overscaling,Dr);for(let Nr of jr)Te&&L0e(f,Te.text,rr,Nr)||Qt(Wt,Nr)}else if(ar==="line-center"){for(let Wt of l.geometry)if(Wt.length>1){let jr=k0e(Wt,Ot,d.vertical||Te,g,24,Qe);jr&&Qt(Wt,jr)}}else if(l.type==="Polygon")for(let Wt of j4(l.geometry,0)){let jr=N0e(Wt,16);Qt(Wt[0],new ed(jr.x,jr.y,0))}else if(l.type==="LineString")for(let Wt of l.geometry)Qt(Wt,new ed(Wt[0].x,Wt[0].y,0));else if(l.type==="Point")for(let Wt of l.geometry)for(let jr of Wt)Qt([jr],new ed(jr.x,jr.y,0))}function AU(f,l,d,g,b,T,C,D,U,$,ie,ce,me,Ae,Te){let Le=function(lt,tt,ct,vt,Ot,lr,Or,ar){let rr=vt.layout.get("text-rotate").evaluate(lr,{})*Math.PI/180,Kt=[];for(let Ar of tt.positionedLines)for(let Qt of Ar.positionedGlyphs){if(!Qt.rect)continue;let Wt=Qt.rect||{},jr=Bj+1,Nr=!0,wn=1,yi=0,Ii=(Ot||ar)&&Qt.vertical,fo=Qt.metrics.advance*Qt.scale/2;if(ar&&tt.verticalizable&&(yi=Ar.lineOffset/2-(Qt.imageName?-(uo-Qt.metrics.width*Qt.scale)/2:(Qt.scale-1)*uo)),Qt.imageName){let mo=Or[Qt.imageName];Nr=mo.sdf,wn=mo.pixelRatio,jr=$s/wn}let va=Ot?[Qt.x+fo,Qt.y]:[0,0],Ps=Ot?[0,0]:[Qt.x+fo+ct[0],Qt.y+ct[1]-yi],no=[0,0];Ii&&(no=Ps,Ps=[0,0]);let Bo=Qt.metrics.isDoubleResolution?2:1,Jo=(Qt.metrics.left-jr)*Qt.scale-fo+Ps[0],Os=(-Qt.metrics.top-jr)*Qt.scale+Ps[1],Rs=Jo+Wt.w/Bo*Qt.scale/wn,ho=Os+Wt.h/Bo*Qt.scale/wn,po=new p(Jo,Os),us=new p(Rs,Os),Ns=new p(Jo,ho),fs=new p(Rs,ho);if(Ii){let mo=new p(-fo,fo-Yx),En=-Math.PI/2,hs=uo/2-fo,es=new p(5-Yx-hs,-(Qt.imageName?hs:0)),go=new p(...no);po._rotateAround(En,mo)._add(es)._add(go),us._rotateAround(En,mo)._add(es)._add(go),Ns._rotateAround(En,mo)._add(es)._add(go),fs._rotateAround(En,mo)._add(es)._add(go)}if(rr){let mo=Math.sin(rr),En=Math.cos(rr),hs=[En,-mo,mo,En];po._matMult(hs),us._matMult(hs),Ns._matMult(hs),fs._matMult(hs)}let Qs=new p(0,0),Js=new p(0,0);Kt.push({tl:po,tr:us,bl:Ns,br:fs,tex:Wt,writingMode:tt.writingMode,glyphOffset:va,sectionIndex:Qt.sectionIndex,isSDF:Nr,pixelOffsetTL:Qs,pixelOffsetBR:Js,minFontScaleX:0,minFontScaleY:0})}return Kt}(0,d,D,b,T,C,g,f.allowVerticalPlacement),He=f.textSizeData,Qe=null;He.kind==="source"?(Qe=[ru*b.layout.get("text-size").evaluate(C,{})],Qe[0]>Qh&&je(`${f.layerIds[0]}: Value for "text-size" is >= ${Gx}. Reduce your "text-size".`)):He.kind==="composite"&&(Qe=[ru*Ae.compositeTextSizes[0].evaluate(C,{},Te),ru*Ae.compositeTextSizes[1].evaluate(C,{},Te)],(Qe[0]>Qh||Qe[1]>Qh)&&je(`${f.layerIds[0]}: Value for "text-size" is >= ${Gx}. Reduce your "text-size".`)),f.addSymbols(f.text,Le,Qe,D,T,C,$,l,U.lineStartIndex,U.lineLength,me,Te);for(let lt of ie)ce[lt]=f.text.placedSymbolArray.length-1;return 4*Le.length}function MU(f){for(let l in f)return f[l];return null}function L0e(f,l,d,g){let b=f.compareText;if(l in b){let T=b[l];for(let C=T.length-1;C>=0;C--)if(g.dist(T[C])<d)return!0}else b[l]=[];return b[l].push(g),!1}let SU=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class c5{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[d,g]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");let b=g>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);let T=SU[15&g];if(!T)throw new Error("Unrecognized array type.");let[C]=new Uint16Array(l,2,1),[D]=new Uint32Array(l,4,1);return new c5(D,C,T,l)}constructor(l,d=64,g=Float64Array,b){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=g,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;let T=SU.indexOf(this.ArrayType),C=2*l*this.ArrayType.BYTES_PER_ELEMENT,D=l*this.IndexArrayType.BYTES_PER_ELEMENT,U=(8-D%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${g}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+C+D+U),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){let g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=l,this.coords[this._pos++]=d,g}finish(){let l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return u5(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,g,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:T,coords:C,nodeSize:D}=this,U=[0,T.length-1,0],$=[];for(;U.length;){let ie=U.pop()||0,ce=U.pop()||0,me=U.pop()||0;if(ce-me<=D){for(let He=me;He<=ce;He++){let Qe=C[2*He],lt=C[2*He+1];Qe>=l&&Qe<=g&&lt>=d&&lt<=b&&$.push(T[He])}continue}let Ae=me+ce>>1,Te=C[2*Ae],Le=C[2*Ae+1];Te>=l&&Te<=g&&Le>=d&&Le<=b&&$.push(T[Ae]),(ie===0?l<=Te:d<=Le)&&(U.push(me),U.push(Ae-1),U.push(1-ie)),(ie===0?g>=Te:b>=Le)&&(U.push(Ae+1),U.push(ce),U.push(1-ie))}return $}within(l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:b,coords:T,nodeSize:C}=this,D=[0,b.length-1,0],U=[],$=g*g;for(;D.length;){let ie=D.pop()||0,ce=D.pop()||0,me=D.pop()||0;if(ce-me<=C){for(let He=me;He<=ce;He++)EU(T[2*He],T[2*He+1],l,d)<=$&&U.push(b[He]);continue}let Ae=me+ce>>1,Te=T[2*Ae],Le=T[2*Ae+1];EU(Te,Le,l,d)<=$&&U.push(b[Ae]),(ie===0?l-g<=Te:d-g<=Le)&&(D.push(me),D.push(Ae-1),D.push(1-ie)),(ie===0?l+g>=Te:d+g>=Le)&&(D.push(Ae+1),D.push(ce),D.push(1-ie))}return U}}function u5(f,l,d,g,b,T){if(b-g<=d)return;let C=g+b>>1;TU(f,l,C,g,b,T),u5(f,l,d,g,C-1,1-T),u5(f,l,d,C+1,b,1-T)}function TU(f,l,d,g,b,T){for(;b>g;){if(b-g>600){let $=b-g+1,ie=d-g+1,ce=Math.log($),me=.5*Math.exp(2*ce/3),Ae=.5*Math.sqrt(ce*me*($-me)/$)*(ie-$/2<0?-1:1);TU(f,l,d,Math.max(g,Math.floor(d-ie*me/$+Ae)),Math.min(b,Math.floor(d+($-ie)*me/$+Ae)),T)}let C=l[2*d+T],D=g,U=b;for(Xx(f,l,g,d),l[2*b+T]>C&&Xx(f,l,g,b);D<U;){for(Xx(f,l,D,U),D++,U--;l[2*D+T]<C;)D++;for(;l[2*U+T]>C;)U--}l[2*g+T]===C?Xx(f,l,g,U):(U++,Xx(f,l,U,b)),U<=d&&(g=U+1),d<=U&&(b=U-1)}}function Xx(f,l,d,g){f5(f,d,g),f5(l,2*d,2*g),f5(l,2*d+1,2*g+1)}function f5(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}function EU(f,l,d,g){let b=f-d,T=l-g;return b*b+T*T}var h5;i.bh=void 0,(h5=i.bh||(i.bh={})).create="create",h5.load="load",h5.fullLoad="fullLoad";let YA=null,Kx=[],d5=1e3/60,p5="loadTime",m5="fullLoadTime",F0e={mark(f){performance.mark(f)},frame(f){let l=f;YA!=null&&Kx.push(l-YA),YA=l},clearMetrics(){YA=null,Kx=[],performance.clearMeasures(p5),performance.clearMeasures(m5);for(let f in i.bh)performance.clearMarks(i.bh[f])},getPerformanceMetrics(){performance.measure(p5,i.bh.create,i.bh.load),performance.measure(m5,i.bh.create,i.bh.fullLoad);let f=performance.getEntriesByName(p5)[0].duration,l=performance.getEntriesByName(m5)[0].duration,d=Kx.length,g=1/(Kx.reduce((T,C)=>T+C,0)/d/1e3),b=Kx.filter(T=>T>d5).reduce((T,C)=>T+(C-d5)/d5,0);return{loadTime:f,fullLoadTime:l,fps:g,percentDroppedFrames:b/(d+b)*100,totalFrames:d}}};i.$=function(f,l,d){var g,b,T,C,D,U,$,ie,ce,me,Ae,Te,Le=d[0],He=d[1],Qe=d[2];return l===f?(f[12]=l[0]*Le+l[4]*He+l[8]*Qe+l[12],f[13]=l[1]*Le+l[5]*He+l[9]*Qe+l[13],f[14]=l[2]*Le+l[6]*He+l[10]*Qe+l[14],f[15]=l[3]*Le+l[7]*He+l[11]*Qe+l[15]):(b=l[1],T=l[2],C=l[3],D=l[4],U=l[5],$=l[6],ie=l[7],ce=l[8],me=l[9],Ae=l[10],Te=l[11],f[0]=g=l[0],f[1]=b,f[2]=T,f[3]=C,f[4]=D,f[5]=U,f[6]=$,f[7]=ie,f[8]=ce,f[9]=me,f[10]=Ae,f[11]=Te,f[12]=g*Le+D*He+ce*Qe+l[12],f[13]=b*Le+U*He+me*Qe+l[13],f[14]=T*Le+$*He+Ae*Qe+l[14],f[15]=C*Le+ie*He+Te*Qe+l[15]),f},i.A=N_,i.B=Go,i.C=class{constructor(f,l,d){this.receive=g=>{let b=g.data,T=b.id;if(T&&(!b.targetMapId||this.mapId===b.targetMapId))if(b.type==="<cancel>"){delete this.tasks[T];let C=this.cancelCallbacks[T];delete this.cancelCallbacks[T],C&&C()}else Ue()||b.mustQueue?(this.tasks[T]=b,this.taskQueue.push(T),this.invoker.trigger()):this.processTask(T,b)},this.process=()=>{if(!this.taskQueue.length)return;let g=this.taskQueue.shift(),b=this.tasks[g];delete this.tasks[g],this.taskQueue.length&&this.invoker.trigger(),b&&this.processTask(g,b)},this.target=f,this.parent=l,this.mapId=d,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new I0e(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ue()?f:window}send(f,l,d,g,b=!1){let T=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(this.callbacks[T]=d);let C=[],D={id:T,type:f,hasCallback:!!d,targetMapId:g,mustQueue:b,sourceMapId:this.mapId,data:ml(l,C)};return this.target.postMessage(D,{transfer:C}),{cancel:()=>{d&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}processTask(f,l){if(l.type==="<response>"){let d=this.callbacks[f];delete this.callbacks[f],d&&(l.error?d(Kc(l.error)):d(null,Kc(l.data)))}else{let d=!1,g=[],b=l.hasCallback?(D,U)=>{d=!0,delete this.cancelCallbacks[f];let $={id:f,type:"<response>",sourceMapId:this.mapId,error:D?ml(D):null,data:ml(U,g)};this.target.postMessage($,{transfer:g})}:D=>{d=!0},T=null,C=Kc(l.data);if(this.parent[l.type])T=this.parent[l.type](l.sourceMapId,C,b);else if("getWorkerSource"in this.parent){let D=l.type.split(".");T=this.parent.getWorkerSource(l.sourceMapId,D[0],C.source)[D[1]](C,b)}else b(new Error(`Could not find function ${l.type}`));!d&&T&&T.cancel&&(this.cancelCallbacks[f]=T.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},i.D=Rr,i.E=dr,i.F=function(f,l){let d={};for(let g=0;g<l.length;g++){let b=l[g];b in f&&(d[b]=f[b])}return d},i.G=tU,i.H=rU,i.I=K4,i.J=P,i.K=R,i.L=Jh,i.M=rt,i.N=Dr,i.O=Ha,i.P=p,i.Q=_i,i.R=Ga,i.S=_e,i.T=fm,i.U=jA,i.V=class extends yl{},i.W=s5,i.X=function(f,l){let d=window.document.createElement("video");d.muted=!0,d.onloadstart=function(){l(null,d)};for(let g=0;g<f.length;g++){let b=window.document.createElement("source");Rt(f[g])||(d.crossOrigin="Anonymous"),b.src=f[g],d.appendChild(b)}return{cancel:()=>{}}},i.Y=Zt,i.Z=function(){var f=new N_(16);return N_!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},i._=s,i.a=Je,i.a$=class extends xe{},i.a0=function(f,l,d){var g=d[0],b=d[1],T=d[2];return f[0]=l[0]*g,f[1]=l[1]*g,f[2]=l[2]*g,f[3]=l[3]*g,f[4]=l[4]*b,f[5]=l[5]*b,f[6]=l[6]*b,f[7]=l[7]*b,f[8]=l[8]*T,f[9]=l[9]*T,f[10]=l[10]*T,f[11]=l[11]*T,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},i.a1=sj,i.a2=function(){return de++},i.a3=Ze,i.a4=j_,i.a5=function(){Mo.isLoading()||Mo.isLoaded()||cm()!=="deferred"||um()},i.a6=Kp,i.a7=Eo,i.a8=ii,i.a9=cU,i.aA=Qc,i.aB=function(f){f=f.slice();let l=Object.create(null);for(let d=0;d<f.length;d++)l[f[d].id]=f[d];for(let d=0;d<f.length;d++)"ref"in f[d]&&(f[d]=Hr(f[d],l[f[d].ref]));return f},i.aC=function(f){if(f.type==="custom")return new E0e(f);switch(f.type){case"background":return new M0e(f);case"circle":return new c_e(f);case"fill":return new C_e(f);case"fill-extrusion":return new Z_e(f);case"heatmap":return new f_e(f);case"hillshade":return new d_e(f);case"line":return new Q_e(f);case"raster":return new T0e(f);case"symbol":return new BA(f)}},i.aD=ve,i.aE=function(f,l){if(!f)return[{command:gn.setStyle,args:[l]}];let d=[];try{if(!Pn(f.version,l.version))return[{command:gn.setStyle,args:[l]}];Pn(f.center,l.center)||d.push({command:gn.setCenter,args:[l.center]}),Pn(f.zoom,l.zoom)||d.push({command:gn.setZoom,args:[l.zoom]}),Pn(f.bearing,l.bearing)||d.push({command:gn.setBearing,args:[l.bearing]}),Pn(f.pitch,l.pitch)||d.push({command:gn.setPitch,args:[l.pitch]}),Pn(f.sprite,l.sprite)||d.push({command:gn.setSprite,args:[l.sprite]}),Pn(f.glyphs,l.glyphs)||d.push({command:gn.setGlyphs,args:[l.glyphs]}),Pn(f.transition,l.transition)||d.push({command:gn.setTransition,args:[l.transition]}),Pn(f.light,l.light)||d.push({command:gn.setLight,args:[l.light]});let g={},b=[];(function(C,D,U,$){let ie;for(ie in D=D||{},C=C||{})Object.prototype.hasOwnProperty.call(C,ie)&&(Object.prototype.hasOwnProperty.call(D,ie)||bs(ie,U,$));for(ie in D)Object.prototype.hasOwnProperty.call(D,ie)&&(Object.prototype.hasOwnProperty.call(C,ie)?Pn(C[ie],D[ie])||(C[ie].type==="geojson"&&D[ie].type==="geojson"&&ba(C,D,ie)?U.push({command:gn.setGeoJSONSourceData,args:[ie,D[ie].data]}):qo(ie,D,U,$)):No(ie,D,U))})(f.sources,l.sources,b,g);let T=[];f.layers&&f.layers.forEach(C=>{g[C.source]?d.push({command:gn.removeLayer,args:[C.id]}):T.push(C)}),d=d.concat(b),function(C,D,U){D=D||[];let $=(C=C||[]).map(zo),ie=D.map(zo),ce=C.reduce(Do,{}),me=D.reduce(Do,{}),Ae=$.slice(),Te=Object.create(null),Le,He,Qe,lt,tt,ct,vt;for(Le=0,He=0;Le<$.length;Le++)Qe=$[Le],Object.prototype.hasOwnProperty.call(me,Qe)?He++:(U.push({command:gn.removeLayer,args:[Qe]}),Ae.splice(Ae.indexOf(Qe,He),1));for(Le=0,He=0;Le<ie.length;Le++)Qe=ie[ie.length-1-Le],Ae[Ae.length-1-Le]!==Qe&&(Object.prototype.hasOwnProperty.call(ce,Qe)?(U.push({command:gn.removeLayer,args:[Qe]}),Ae.splice(Ae.lastIndexOf(Qe,Ae.length-He),1)):He++,ct=Ae[Ae.length-Le],U.push({command:gn.addLayer,args:[me[Qe],ct]}),Ae.splice(Ae.length-Le,0,Qe),Te[Qe]=!0);for(Le=0;Le<ie.length;Le++)if(Qe=ie[Le],lt=ce[Qe],tt=me[Qe],!Te[Qe]&&!Pn(lt,tt))if(Pn(lt.source,tt.source)&&Pn(lt["source-layer"],tt["source-layer"])&&Pn(lt.type,tt.type)){for(vt in vs(lt.layout,tt.layout,U,Qe,null,gn.setLayoutProperty),vs(lt.paint,tt.paint,U,Qe,null,gn.setPaintProperty),Pn(lt.filter,tt.filter)||U.push({command:gn.setFilter,args:[Qe,tt.filter]}),Pn(lt.minzoom,tt.minzoom)&&Pn(lt.maxzoom,tt.maxzoom)||U.push({command:gn.setLayerZoomRange,args:[Qe,tt.minzoom,tt.maxzoom]}),lt)Object.prototype.hasOwnProperty.call(lt,vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&(vt.indexOf("paint.")===0?vs(lt[vt],tt[vt],U,Qe,vt.slice(6),gn.setPaintProperty):Pn(lt[vt],tt[vt])||U.push({command:gn.setLayerProperty,args:[Qe,vt,tt[vt]]}));for(vt in tt)Object.prototype.hasOwnProperty.call(tt,vt)&&!Object.prototype.hasOwnProperty.call(lt,vt)&&vt!=="layout"&&vt!=="paint"&&vt!=="filter"&&vt!=="metadata"&&vt!=="minzoom"&&vt!=="maxzoom"&&(vt.indexOf("paint.")===0?vs(lt[vt],tt[vt],U,Qe,vt.slice(6),gn.setPaintProperty):Pn(lt[vt],tt[vt])||U.push({command:gn.setLayerProperty,args:[Qe,vt,tt[vt]]}))}else U.push({command:gn.removeLayer,args:[Qe]}),ct=Ae[Ae.lastIndexOf(Qe)+1],U.push({command:gn.addLayer,args:[tt,ct]})}(T,l.layers,d)}catch(g){console.warn("Unable to compute style diff:",g),d=[{command:gn.setStyle,args:[l]}]}return d},i.aF=function(f){let l=[],d=f.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},i.aG=function f(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let g=0;g<l.length;g++)if(!f(l[g],d[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(let g in l)if(!f(l[g],d[g]))return!1;return!0}return l===d},i.aH=fe,i.aI=ye,i.aJ=Jc,i.aK=function(f){return f({pluginStatus:$o,pluginURL:_l}),Jc.on("pluginStateChange",f),f},i.aL=class extends Ti{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},i.aM=So,i.aN=class extends Ti{constructor(f,l){super(f,l),this.current=mm}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},i.aO=Ks,i.aP=class extends Ti{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},i.aQ=class extends Ti{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},i.aR=tu,i.aS=function(f,l,d,g,b,T,C){var D=1/(l-d),U=1/(g-b),$=1/(T-C);return f[0]=-2*D,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*U,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*$,f[11]=0,f[12]=(l+d)*D,f[13]=(b+g)*U,f[14]=(C+T)*$,f[15]=1,f},i.aT=It,i.aU=l_e,i.aV=class extends x{},i.aW=r0e,i.aX=class extends S{},i.aY=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},i.aZ=fj,i.a_=Gt,i.aa=function(f){let l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,g,b,T)=>{let C=b||T;return l[g]=!C||C.toLowerCase(),""}),l["max-age"]){let d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},i.ab=function(f,l){let d=[];for(let g in f)g in l||d.push(g);return d},i.ac=function(f){if(qe==null){let l=f.navigator?f.navigator.userAgent:null;qe=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return qe},i.ad=j,i.ae=function(f,l,d){var g=Math.sin(d),b=Math.cos(d),T=l[0],C=l[1],D=l[2],U=l[3],$=l[4],ie=l[5],ce=l[6],me=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=T*b+$*g,f[1]=C*b+ie*g,f[2]=D*b+ce*g,f[3]=U*b+me*g,f[4]=$*b-T*g,f[5]=ie*b-C*g,f[6]=ce*b-D*g,f[7]=me*b-U*g,f},i.af=function(f){var l=new N_(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},i.ag=CA,i.ah=function(f,l){let d=0,g=0;if(f.kind==="constant")g=f.layoutSize;else if(f.kind!=="source"){let{interpolationType:b,minZoom:T,maxZoom:C}=f,D=b?j(Ho.interpolationFactor(b,l,T,C),0,1):0;f.kind==="camera"?g=Go.number(f.minSize,f.maxSize,D):d=D}return{uSizeT:d,uSize:g}},i.aj=function(f,{uSize:l,uSizeT:d},{lowerSize:g,upperSize:b}){return f.kind==="source"?g/ru:f.kind==="composite"?Go.number(g/ru,b/ru,d):l},i.ak=e5,i.al=function(f,l,d,g){let b=l.y-f.y,T=l.x-f.x,C=g.y-d.y,D=g.x-d.x,U=C*T-D*b;if(U===0)return null;let $=(D*(f.y-d.y)-C*(f.x-d.x))/U;return new p(f.x+$*T,f.y+$*b)},i.am=dU,i.an=ej,i.ao=R4,i.ap=uo,i.ar=J4,i.as=function(f,l){var d=l[0],g=l[1],b=l[2],T=l[3],C=l[4],D=l[5],U=l[6],$=l[7],ie=l[8],ce=l[9],me=l[10],Ae=l[11],Te=l[12],Le=l[13],He=l[14],Qe=l[15],lt=d*D-g*C,tt=d*U-b*C,ct=d*$-T*C,vt=g*U-b*D,Ot=g*$-T*D,lr=b*$-T*U,Or=ie*Le-ce*Te,ar=ie*He-me*Te,rr=ie*Qe-Ae*Te,Kt=ce*He-me*Le,Ar=ce*Qe-Ae*Le,Qt=me*Qe-Ae*He,Wt=lt*Qt-tt*Ar+ct*Kt+vt*rr-Ot*ar+lr*Or;return Wt?(f[0]=(D*Qt-U*Ar+$*Kt)*(Wt=1/Wt),f[1]=(b*Ar-g*Qt-T*Kt)*Wt,f[2]=(Le*lr-He*Ot+Qe*vt)*Wt,f[3]=(me*Ot-ce*lr-Ae*vt)*Wt,f[4]=(U*rr-C*Qt-$*ar)*Wt,f[5]=(d*Qt-b*rr+T*ar)*Wt,f[6]=(He*ct-Te*lr-Qe*tt)*Wt,f[7]=(ie*lr-me*ct+Ae*tt)*Wt,f[8]=(C*Ar-D*rr+$*Or)*Wt,f[9]=(g*rr-d*Ar-T*Or)*Wt,f[10]=(Te*Ot-Le*ct+Qe*lt)*Wt,f[11]=(ce*ct-ie*Ot-Ae*lt)*Wt,f[12]=(D*ar-C*Kt-U*Or)*Wt,f[13]=(d*Kt-g*ar+b*Or)*Wt,f[14]=(Le*tt-Te*vt-He*lt)*Wt,f[15]=(ie*vt-ce*tt+me*lt)*Wt,f):null},i.at=l5,i.au=Q4,i.av=c5,i.aw=function(){let f={},l=xt.$version;for(let d in xt.$root){let g=xt.$root[d];if(g.required){let b=null;b=d==="version"?l:g.type==="array"?[]:{},b!=null&&(f[d]=b)}}return f},i.ax=gn,i.ay=I_,i.az=Ir,i.b=function(f,l){let d=new Blob([new Uint8Array(f)],{type:"image/png"});createImageBitmap(d).then(g=>{l(null,g)}).catch(g=>{l(new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},i.b0=X,i.b1=function(f,l){var d=f[0],g=f[1],b=f[2],T=f[3],C=f[4],D=f[5],U=f[6],$=f[7],ie=f[8],ce=f[9],me=f[10],Ae=f[11],Te=f[12],Le=f[13],He=f[14],Qe=f[15],lt=l[0],tt=l[1],ct=l[2],vt=l[3],Ot=l[4],lr=l[5],Or=l[6],ar=l[7],rr=l[8],Kt=l[9],Ar=l[10],Qt=l[11],Wt=l[12],jr=l[13],Nr=l[14],wn=l[15];return Math.abs(d-lt)<=ks*Math.max(1,Math.abs(d),Math.abs(lt))&&Math.abs(g-tt)<=ks*Math.max(1,Math.abs(g),Math.abs(tt))&&Math.abs(b-ct)<=ks*Math.max(1,Math.abs(b),Math.abs(ct))&&Math.abs(T-vt)<=ks*Math.max(1,Math.abs(T),Math.abs(vt))&&Math.abs(C-Ot)<=ks*Math.max(1,Math.abs(C),Math.abs(Ot))&&Math.abs(D-lr)<=ks*Math.max(1,Math.abs(D),Math.abs(lr))&&Math.abs(U-Or)<=ks*Math.max(1,Math.abs(U),Math.abs(Or))&&Math.abs($-ar)<=ks*Math.max(1,Math.abs($),Math.abs(ar))&&Math.abs(ie-rr)<=ks*Math.max(1,Math.abs(ie),Math.abs(rr))&&Math.abs(ce-Kt)<=ks*Math.max(1,Math.abs(ce),Math.abs(Kt))&&Math.abs(me-Ar)<=ks*Math.max(1,Math.abs(me),Math.abs(Ar))&&Math.abs(Ae-Qt)<=ks*Math.max(1,Math.abs(Ae),Math.abs(Qt))&&Math.abs(Te-Wt)<=ks*Math.max(1,Math.abs(Te),Math.abs(Wt))&&Math.abs(Le-jr)<=ks*Math.max(1,Math.abs(Le),Math.abs(jr))&&Math.abs(He-Nr)<=ks*Math.max(1,Math.abs(He),Math.abs(Nr))&&Math.abs(Qe-wn)<=ks*Math.max(1,Math.abs(Qe),Math.abs(wn))},i.b2=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},i.b3=function(f,l,d){return f[0]=l[0]*d[0],f[1]=l[1]*d[1],f[2]=l[2]*d[2],f[3]=l[3]*d[3],f},i.b4=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]*l[3]},i.b5=J,i.b6=sU,i.b7=nU,i.b8=function(f,l,d,g,b){var T,C=1/Math.tan(l/2);return f[0]=C/d,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=C,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,b!=null&&b!==1/0?(f[10]=(b+g)*(T=1/(g-b)),f[14]=2*b*g*T):(f[10]=-1,f[14]=-2*g),f},i.b9=function(f,l,d){var g=Math.sin(d),b=Math.cos(d),T=l[4],C=l[5],D=l[6],U=l[7],$=l[8],ie=l[9],ce=l[10],me=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=T*b+$*g,f[5]=C*b+ie*g,f[6]=D*b+ce*g,f[7]=U*b+me*g,f[8]=$*b-T*g,f[9]=ie*b-C*g,f[10]=ce*b-D*g,f[11]=me*b-U*g,f},i.bA=u,i.bB=Oj,i.bC=Nh,i.bD=Mo,i.ba=V,i.bb=N,i.bc=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},i.bd=class extends vf{},i.be=i5,i.bf=iU,i.bg=F0e,i.bi=wr,i.bj=function(f,l,d=!1){if($o===am||$o===$c||$o===Yh)throw new Error("setRTLTextPlugin cannot be called multiple times.");_l=tr.resolveURL(f),$o=am,lm=l,qh(),d||um()},i.bk=cm,i.bl=function(f,l){let d={};for(let b=0;b<f.length;b++){let T=l&&l[f[b].id]||Fh(f[b]);l&&(l[f[b].id]=T);let C=d[T];C||(C=d[T]=[]),C.push(f[b])}let g=[];for(let b in d)g.push(d[b]);return g},i.bm=_r,i.bn=lU,i.bo=uU,i.bp=Uj,i.bq=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=Dr/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;let l=f.bucket.layers[0],d=l.layout,g=l._unevaluatedLayout._values,b={layoutIconSize:g["icon-size"].possiblyEvaluate(new ii(f.bucket.zoom+1),f.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new ii(f.bucket.zoom+1),f.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new ii(18))};if(f.bucket.textSizeData.kind==="composite"){let{minZoom:$,maxZoom:ie}=f.bucket.textSizeData;b.compositeTextSizes=[g["text-size"].possiblyEvaluate(new ii($),f.canonical),g["text-size"].possiblyEvaluate(new ii(ie),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){let{minZoom:$,maxZoom:ie}=f.bucket.iconSizeData;b.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new ii($),f.canonical),g["icon-size"].possiblyEvaluate(new ii(ie),f.canonical)]}let T=d.get("text-line-height")*uo,C=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",D=d.get("text-keep-upright"),U=d.get("text-size");for(let $ of f.bucket.features){let ie=d.get("text-font").evaluate($,{},f.canonical).join(","),ce=U.evaluate($,{},f.canonical),me=b.layoutTextSize.evaluate($,{},f.canonical),Ae=b.layoutIconSize.evaluate($,{},f.canonical),Te={horizontal:{},vertical:void 0},Le=$.text,He,Qe=[0,0];if(Le){let ct=Le.toString(),vt=d.get("text-letter-spacing").evaluate($,{},f.canonical)*uo,Ot=im(ct)?vt:0,lr=d.get("text-anchor").evaluate($,{},f.canonical),Or=wU(l,$,f.canonical);if(!Or){let Qt=d.get("text-radial-offset").evaluate($,{},f.canonical);Qe=Qt?vU(lr,[Qt*uo,a5]):d.get("text-offset").evaluate($,{},f.canonical).map(Wt=>Wt*uo)}let ar=C?"center":d.get("text-justify").evaluate($,{},f.canonical),rr=d.get("symbol-placement"),Kt=rr==="point"?d.get("text-max-width").evaluate($,{},f.canonical)*uo:0,Ar=()=>{f.bucket.allowVerticalPlacement&&nm(ct)&&(Te.vertical=DA(Le,f.glyphMap,f.glyphPositions,f.imagePositions,ie,Kt,T,lr,"left",Ot,Qe,i.ai.vertical,!0,rr,me,ce))};if(!C&&Or){let Qt=new Set;if(ar==="auto")for(let jr=0;jr<Or.values.length;jr+=2)Qt.add(l5(Or.values[jr]));else Qt.add(ar);let Wt=!1;for(let jr of Qt)if(!Te.horizontal[jr])if(Wt)Te.horizontal[jr]=Te.horizontal[0];else{let Nr=DA(Le,f.glyphMap,f.glyphPositions,f.imagePositions,ie,Kt,T,"center",jr,Ot,Qe,i.ai.horizontal,!1,rr,me,ce);Nr&&(Te.horizontal[jr]=Nr,Wt=Nr.positionedLines.length===1)}Ar()}else{ar==="auto"&&(ar=l5(lr));let Qt=DA(Le,f.glyphMap,f.glyphPositions,f.imagePositions,ie,Kt,T,lr,ar,Ot,Qe,i.ai.horizontal,!1,rr,me,ce);Qt&&(Te.horizontal[ar]=Qt),Ar(),nm(ct)&&C&&D&&(Te.vertical=DA(Le,f.glyphMap,f.glyphPositions,f.imagePositions,ie,Kt,T,lr,ar,Ot,Qe,i.ai.vertical,!1,rr,me,ce))}}let lt=!1;if($.icon&&$.icon.name){let ct=f.imageMap[$.icon.name];ct&&(He=x0e(f.imagePositions[$.icon.name],d.get("icon-offset").evaluate($,{},f.canonical),d.get("icon-anchor").evaluate($,{},f.canonical)),lt=!!ct.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=lt:f.bucket.sdfIcons!==lt&&je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==f.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}let tt=MU(Te.horizontal)||Te.vertical;f.bucket.iconsInText=!!tt&&tt.iconsInText,(tt||He)&&D0e(f.bucket,$,Te,He,f.imageMap,b,me,Ae,Qe,lt,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},i.br=q4,i.bs=W4,i.bt=Y4,i.bu=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},i.bv=H4,i.bw=Kh,i.bx=function(f,l,d,g,b){return s(this,void 0,void 0,function*(){if(R())try{return yield rt(f,l,d,g,b)}catch{}return function(T,C,D,U,$){let ie=T.width,ce=T.height;At&&St||(At=new OffscreenCanvas(ie,ce),St=At.getContext("2d",{willReadFrequently:!0})),At.width=ie,At.height=ce,St.drawImage(T,0,0,ie,ce);let me=St.getImageData(C,D,U,$);return St.clearRect(0,0,ie,ce),me.data}(f,l,d,g,b)})},i.by=aU,i.bz=a,i.c=vr,i.d=function(f,l){let d=new Image;d.onload=()=>{l(null,d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=gt})},d.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let g=new Blob([new Uint8Array(f)],{type:"image/png"});d.src=f.byteLength?URL.createObjectURL(g):gt},i.e=ne,i.f=function(f,l){return Lr(ne(f,{type:"json"}),l)},i.g=Br,i.h=tr,i.i=Ue,i.j=Rn,i.k=sr,i.l=Yr,i.m=Lr,i.n=function(f){return new H4(f).readFields(d0e,[])},i.o=function(f,l,d){if(!f.length)return d(null,[]);let g=f.length,b=new Array(f.length),T=null;f.forEach((C,D)=>{l(C,(U,$)=>{U&&(T=U),b[D]=$,--g==0&&d(T,b)})})},i.p=jj,i.q=Lx,i.r=Ni,i.s=Rt,i.t=tm,i.u=ir,i.v=xt,i.w=je,i.x=mf,i.y=Xs,i.z=function([f,l,d]){return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(d),y:f*Math.sin(l)*Math.sin(d),z:f*Math.cos(d)}}}),n(["./shared"],function(i){"use strict";class s{constructor(ue){this.keyCache={},ue&&this.replace(ue)}replace(ue){this._layerConfigs={},this._layers={},this.update(ue,[])}update(ue,ge){for(let Ve of ue){this._layerConfigs[Ve.id]=Ve;let We=this._layers[Ve.id]=i.aC(Ve);We._featureFilter=i.a6(We.filter),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id]}for(let Ve of ge)delete this.keyCache[Ve],delete this._layerConfigs[Ve],delete this._layers[Ve];this.familiesBySource={};let ke=i.bl(Object.values(this._layerConfigs),this.keyCache);for(let Ve of ke){let We=Ve.map(we=>this._layers[we.id]),G=We[0];if(G.visibility==="none")continue;let te=G.source||"",Q=this.familiesBySource[te];Q||(Q=this.familiesBySource[te]={});let ae=G.sourceLayer||"_geojsonTileLayer",he=Q[ae];he||(he=Q[ae]=[]),he.push(We)}}}class a{constructor(ue){let ge={},ke=[];for(let te in ue){let Q=ue[te],ae=ge[te]={};for(let he in Q){let we=Q[+he];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;let Ee={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};ke.push(Ee),ae[he]={rect:Ee,metrics:we.metrics}}}let{w:Ve,h:We}=i.p(ke),G=new i.q({width:Ve||1,height:We||1});for(let te in ue){let Q=ue[te];for(let ae in Q){let he=Q[+ae];if(!he||he.bitmap.width===0||he.bitmap.height===0)continue;let we=ge[te][ae].rect;i.q.copy(he.bitmap,G,{x:0,y:0},{x:we.x+1,y:we.y+1},he.bitmap)}}this.image=G,this.positions=ge}}i.bm("GlyphAtlas",a);class u{constructor(ue){this.tileID=new i.O(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),this.uid=ue.uid,this.zoom=ue.zoom,this.pixelRatio=ue.pixelRatio,this.tileSize=ue.tileSize,this.source=ue.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ue.showCollisionBoxes,this.collectResourceTiming=!!ue.collectResourceTiming,this.returnDependencies=!!ue.returnDependencies,this.promoteId=ue.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(ue,ge,ke,Ve,We){this.status="parsing",this.data=ue,this.collisionBoxArray=new i.a3;let G=new i.bn(Object.keys(ue.layers).sort()),te=new i.bo(this.tileID,this.promoteId);te.bucketLayerIDs=[];let Q={},ae={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ke},he=ge.familiesBySource[this.source];for(let Dt in he){let Lt=ue.layers[Dt];if(!Lt)continue;Lt.version===1&&i.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let xr=G.encode(Dt),Sr=[];for(let ln=0;ln<Lt.length;ln++){let pr=Lt.feature(ln),un=te.getId(pr,Dt);Sr.push({feature:pr,id:un,index:ln,sourceLayerIndex:xr})}for(let ln of he[Dt]){let pr=ln[0];pr.source!==this.source&&i.w(`layer.source = ${pr.source} does not equal this.source = ${this.source}`),pr.minzoom&&this.zoom<Math.floor(pr.minzoom)||pr.maxzoom&&this.zoom>=pr.maxzoom||pr.visibility!=="none"&&(h(ln,this.zoom,ke),(Q[pr.id]=pr.createBucket({index:te.bucketLayerIDs.length,layers:ln,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xr,sourceID:this.source})).populate(Sr,ae,this.tileID.canonical),te.bucketLayerIDs.push(ln.map(un=>un.id)))}}let we,Ee,Xe,ut,mt=i.aH(ae.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt?.cancel()),this.inFlightDependencies=[];let Tt=++this.dependencySentinel;Object.keys(mt).length?this.inFlightDependencies.push(Ve.send("getGlyphs",{uid:this.uid,stacks:mt,source:this.source,tileID:this.tileID,type:"glyphs"},(Dt,Lt)=>{Tt===this.dependencySentinel&&(we||(we=Dt,Ee=Lt,Ct.call(this)))})):Ee={};let jt=Object.keys(ae.iconDependencies);jt.length?this.inFlightDependencies.push(Ve.send("getImages",{icons:jt,source:this.source,tileID:this.tileID,type:"icons"},(Dt,Lt)=>{Tt===this.dependencySentinel&&(we||(we=Dt,Xe=Lt,Ct.call(this)))})):Xe={};let Et=Object.keys(ae.patternDependencies);function Ct(){if(we)return We(we);if(Ee&&Xe&&ut){let Dt=new a(Ee),Lt=new i.bp(Xe,ut);for(let xr in Q){let Sr=Q[xr];Sr instanceof i.a4?(h(Sr.layers,this.zoom,ke),i.bq({bucket:Sr,glyphMap:Ee,glyphPositions:Dt.positions,imageMap:Xe,imagePositions:Lt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Sr.hasPattern&&(Sr instanceof i.br||Sr instanceof i.bs||Sr instanceof i.bt)&&(h(Sr.layers,this.zoom,ke),Sr.addFeatures(ae,this.tileID.canonical,Lt.patternPositions))}this.status="done",We(null,{buckets:Object.values(Q).filter(xr=>!xr.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dt.image,imageAtlas:Lt,glyphMap:this.returnDependencies?Ee:null,iconMap:this.returnDependencies?Xe:null,glyphPositions:this.returnDependencies?Dt.positions:null})}}Et.length?this.inFlightDependencies.push(Ve.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"},(Dt,Lt)=>{Tt===this.dependencySentinel&&(we||(we=Dt,ut=Lt,Ct.call(this)))})):ut={},Ct.call(this)}}function h(Oe,ue,ge){let ke=new i.a8(ue);for(let Ve of Oe)Ve.recalculate(ke,ge)}function p(Oe,ue){let ge=i.l(Oe.request,(ke,Ve,We,G)=>{if(ke)ue(ke);else if(Ve)try{let te=new i.bw.VectorTile(new i.bv(Ve));ue(null,{vectorTile:te,rawData:Ve,cacheControl:We,expires:G})}catch(te){let Q=new Uint8Array(Ve),ae=`Unable to parse the tile at ${Oe.request.url}, `;ae+=Q[0]===31&&Q[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.messge}`,ue(new Error(ae))}});return()=>{ge.cancel(),ue()}}class _{constructor(ue,ge,ke,Ve){this.actor=ue,this.layerIndex=ge,this.availableImages=ke,this.loadVectorData=Ve||p,this.fetching={},this.loading={},this.loaded={}}loadTile(ue,ge){let ke=ue.uid;this.loading||(this.loading={});let Ve=!!(ue&&ue.request&&ue.request.collectResourceTiming)&&new i.bu(ue.request),We=this.loading[ke]=new u(ue);We.abort=this.loadVectorData(ue,(G,te)=>{if(delete this.loading[ke],G||!te)return We.status="done",this.loaded[ke]=We,ge(G);let Q=te.rawData,ae={};te.expires&&(ae.expires=te.expires),te.cacheControl&&(ae.cacheControl=te.cacheControl);let he={};if(Ve){let we=Ve.finish();we&&(he.resourceTiming=JSON.parse(JSON.stringify(we)))}We.vectorTile=te.vectorTile,We.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,Ee)=>{if(delete this.fetching[ke],we||!Ee)return ge(we);ge(null,i.e({rawTileData:Q.slice(0)},Ee,ae,he))}),this.loaded=this.loaded||{},this.loaded[ke]=We,this.fetching[ke]={rawTileData:Q,cacheControl:ae,resourceTiming:he}})}reloadTile(ue,ge){let ke=this.loaded,Ve=ue.uid;if(ke&&ke[Ve]){let We=ke[Ve];We.showCollisionBoxes=ue.showCollisionBoxes,We.status==="parsing"?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,(G,te)=>{if(G||!te)return ge(G,te);let Q;if(this.fetching[Ve]){let{rawTileData:ae,cacheControl:he,resourceTiming:we}=this.fetching[Ve];delete this.fetching[Ve],Q=i.e({rawTileData:ae.slice(0)},te,he,we)}else Q=te;ge(null,Q)}):We.status==="done"&&(We.vectorTile?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,ge):ge())}}abortTile(ue,ge){let ke=this.loading,Ve=ue.uid;ke&&ke[Ve]&&ke[Ve].abort&&(ke[Ve].abort(),delete ke[Ve]),ge()}removeTile(ue,ge){let ke=this.loaded,Ve=ue.uid;ke&&ke[Ve]&&delete ke[Ve],ge()}}class y{constructor(){this.loaded={}}loadTile(ue,ge){return i._(this,void 0,void 0,function*(){let{uid:ke,encoding:Ve,rawImageData:We,redFactor:G,greenFactor:te,blueFactor:Q,baseShift:ae}=ue,he=We.width+2,we=We.height+2,Ee=i.a(We)?new i.R({width:he,height:we},yield i.bx(We,-1,-1,he,we)):We,Xe=new i.by(ke,Ee,Ve,G,te,Q,ae);this.loaded=this.loaded||{},this.loaded[ke]=Xe,ge(null,Xe)})}removeTile(ue){let ge=this.loaded,ke=ue.uid;ge&&ge[ke]&&delete ge[ke]}}function A(Oe,ue){if(Oe.length!==0){E(Oe[0],ue);for(var ge=1;ge<Oe.length;ge++)E(Oe[ge],!ue)}}function E(Oe,ue){for(var ge=0,ke=0,Ve=0,We=Oe.length,G=We-1;Ve<We;G=Ve++){var te=(Oe[Ve][0]-Oe[G][0])*(Oe[G][1]+Oe[Ve][1]),Q=ge+te;ke+=Math.abs(ge)>=Math.abs(te)?ge-Q+te:te-Q+ge,ge=Q}ge+ke>=0!=!!ue&&Oe.reverse()}var k=i.bz(function Oe(ue,ge){var ke,Ve=ue&&ue.type;if(Ve==="FeatureCollection")for(ke=0;ke<ue.features.length;ke++)Oe(ue.features[ke],ge);else if(Ve==="GeometryCollection")for(ke=0;ke<ue.geometries.length;ke++)Oe(ue.geometries[ke],ge);else if(Ve==="Feature")Oe(ue.geometry,ge);else if(Ve==="Polygon")A(ue.coordinates,ge);else if(Ve==="MultiPolygon")for(ke=0;ke<ue.coordinates.length;ke++)A(ue.coordinates[ke],ge);return ue});let P=i.bw.VectorTileFeature.prototype.toGeoJSON;var R={exports:{}},V=i.bA,N=i.bw.VectorTileFeature,j=J;function J(Oe,ue){this.options=ue||{},this.features=Oe,this.length=Oe.length}function ne(Oe,ue){this.id=typeof Oe.id=="number"?Oe.id:void 0,this.type=Oe.type,this.rawGeometry=Oe.type===1?[Oe.geometry]:Oe.geometry,this.properties=Oe.tags,this.extent=ue||4096}J.prototype.feature=function(Oe){return new ne(this.features[Oe],this.options.extent)},ne.prototype.loadGeometry=function(){var Oe=this.rawGeometry;this.geometry=[];for(var ue=0;ue<Oe.length;ue++){for(var ge=Oe[ue],ke=[],Ve=0;Ve<ge.length;Ve++)ke.push(new V(ge[Ve][0],ge[Ve][1]));this.geometry.push(ke)}return this.geometry},ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Oe=this.geometry,ue=1/0,ge=-1/0,ke=1/0,Ve=-1/0,We=0;We<Oe.length;We++)for(var G=Oe[We],te=0;te<G.length;te++){var Q=G[te];ue=Math.min(ue,Q.x),ge=Math.max(ge,Q.x),ke=Math.min(ke,Q.y),Ve=Math.max(Ve,Q.y)}return[ue,ke,ge,Ve]},ne.prototype.toGeoJSON=N.prototype.toGeoJSON;var de=i.bB,fe=j;function ye(Oe){var ue=new de;return function(ge,ke){for(var Ve in ge.layers)ke.writeMessage(3,ve,ge.layers[Ve])}(Oe,ue),ue.finish()}function ve(Oe,ue){var ge;ue.writeVarintField(15,Oe.version||1),ue.writeStringField(1,Oe.name||""),ue.writeVarintField(5,Oe.extent||4096);var ke={keys:[],values:[],keycache:{},valuecache:{}};for(ge=0;ge<Oe.length;ge++)ke.feature=Oe.feature(ge),ue.writeMessage(2,be,ke);var Ve=ke.keys;for(ge=0;ge<Ve.length;ge++)ue.writeStringField(3,Ve[ge]);var We=ke.values;for(ge=0;ge<We.length;ge++)ue.writeMessage(4,qe,We[ge])}function be(Oe,ue){var ge=Oe.feature;ge.id!==void 0&&ue.writeVarintField(1,ge.id),ue.writeMessage(2,je,Oe),ue.writeVarintField(3,ge.type),ue.writeMessage(4,Ue,ge)}function je(Oe,ue){var ge=Oe.feature,ke=Oe.keys,Ve=Oe.values,We=Oe.keycache,G=Oe.valuecache;for(var te in ge.properties){var Q=ge.properties[te],ae=We[te];if(Q!==null){ae===void 0&&(ke.push(te),We[te]=ae=ke.length-1),ue.writeVarint(ae);var he=typeof Q;he!=="string"&&he!=="boolean"&&he!=="number"&&(Q=JSON.stringify(Q));var we=he+":"+Q,Ee=G[we];Ee===void 0&&(Ve.push(Q),G[we]=Ee=Ve.length-1),ue.writeVarint(Ee)}}}function Re(Oe,ue){return(ue<<3)+(7&Oe)}function Se(Oe){return Oe<<1^Oe>>31}function Ue(Oe,ue){for(var ge=Oe.loadGeometry(),ke=Oe.type,Ve=0,We=0,G=ge.length,te=0;te<G;te++){var Q=ge[te],ae=1;ke===1&&(ae=Q.length),ue.writeVarint(Re(1,ae));for(var he=ke===3?Q.length-1:Q.length,we=0;we<he;we++){we===1&&ke!==1&&ue.writeVarint(Re(2,he-1));var Ee=Q[we].x-Ve,Xe=Q[we].y-We;ue.writeVarint(Se(Ee)),ue.writeVarint(Se(Xe)),Ve+=Ee,We+=Xe}ke===3&&ue.writeVarint(Re(7,1))}}function qe(Oe,ue){var ge=typeof Oe;ge==="string"?ue.writeStringField(1,Oe):ge==="boolean"?ue.writeBooleanField(7,Oe):ge==="number"&&(Oe%1!=0?ue.writeDoubleField(3,Oe):Oe<0?ue.writeSVarintField(6,Oe):ue.writeVarintField(5,Oe))}R.exports=ye,R.exports.fromVectorTileJs=ye,R.exports.fromGeojsonVt=function(Oe,ue){ue=ue||{};var ge={};for(var ke in Oe)ge[ke]=new fe(Oe[ke].features,ue),ge[ke].name=ke,ge[ke].version=ue.version,ge[ke].extent=ue.extent;return ye({layers:ge})},R.exports.GeoJSONWrapper=fe;var Je=i.bz(R.exports);let gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},rt=Math.fround||(At=new Float32Array(1),Oe=>(At[0]=+Oe,At[0]));var At;let St=3,kt=5,yt=6;class tr{constructor(ue){this.options=Object.assign(Object.create(gt),ue),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ue){let{log:ge,minZoom:ke,maxZoom:Ve}=this.options;ge&&console.time("total time");let We=`prepare ${ue.length} points`;ge&&console.time(We),this.points=ue;let G=[];for(let Q=0;Q<ue.length;Q++){let ae=ue[Q];if(!ae.geometry)continue;let[he,we]=ae.geometry.coordinates,Ee=rt(Ir(he)),Xe=rt(Br(we));G.push(Ee,Xe,1/0,Q,-1,1),this.options.reduce&&G.push(0)}let te=this.trees[Ve+1]=this._createTree(G);ge&&console.timeEnd(We);for(let Q=Ve;Q>=ke;Q--){let ae=+Date.now();te=this.trees[Q]=this._createTree(this._cluster(te,Q)),ge&&console.log("z%d: %d clusters in %dms",Q,te.numItems,+Date.now()-ae)}return ge&&console.timeEnd("total time"),this}getClusters(ue,ge){let ke=((ue[0]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,ue[1])),We=ue[2]===180?180:((ue[2]+180)%360+360)%360-180,G=Math.max(-90,Math.min(90,ue[3]));if(ue[2]-ue[0]>=360)ke=-180,We=180;else if(ke>We){let we=this.getClusters([ke,Ve,180,G],ge),Ee=this.getClusters([-180,Ve,We,G],ge);return we.concat(Ee)}let te=this.trees[this._limitZoom(ge)],Q=te.range(Ir(ke),Br(G),Ir(We),Br(Ve)),ae=te.data,he=[];for(let we of Q){let Ee=this.stride*we;he.push(ae[Ee+kt]>1?vr(ae,Ee,this.clusterProps):this.points[ae[Ee+St]])}return he}getChildren(ue){let ge=this._getOriginId(ue),ke=this._getOriginZoom(ue),Ve="No cluster with the specified id.",We=this.trees[ke];if(!We)throw new Error(Ve);let G=We.data;if(ge*this.stride>=G.length)throw new Error(Ve);let te=this.options.radius/(this.options.extent*Math.pow(2,ke-1)),Q=We.within(G[ge*this.stride],G[ge*this.stride+1],te),ae=[];for(let he of Q){let we=he*this.stride;G[we+4]===ue&&ae.push(G[we+kt]>1?vr(G,we,this.clusterProps):this.points[G[we+St]])}if(ae.length===0)throw new Error(Ve);return ae}getLeaves(ue,ge,ke){let Ve=[];return this._appendLeaves(Ve,ue,ge=ge||10,ke=ke||0,0),Ve}getTile(ue,ge,ke){let Ve=this.trees[this._limitZoom(ue)],We=Math.pow(2,ue),{extent:G,radius:te}=this.options,Q=te/G,ae=(ke-Q)/We,he=(ke+1+Q)/We,we={features:[]};return this._addTileFeatures(Ve.range((ge-Q)/We,ae,(ge+1+Q)/We,he),Ve.data,ge,ke,We,we),ge===0&&this._addTileFeatures(Ve.range(1-Q/We,ae,1,he),Ve.data,We,ke,We,we),ge===We-1&&this._addTileFeatures(Ve.range(0,ae,Q/We,he),Ve.data,-1,ke,We,we),we.features.length?we:null}getClusterExpansionZoom(ue){let ge=this._getOriginZoom(ue)-1;for(;ge<=this.options.maxZoom;){let ke=this.getChildren(ue);if(ge++,ke.length!==1)break;ue=ke[0].properties.cluster_id}return ge}_appendLeaves(ue,ge,ke,Ve,We){let G=this.getChildren(ge);for(let te of G){let Q=te.properties;if(Q&&Q.cluster?We+Q.point_count<=Ve?We+=Q.point_count:We=this._appendLeaves(ue,Q.cluster_id,ke,Ve,We):We<Ve?We++:ue.push(te),ue.length===ke)break}return We}_createTree(ue){let ge=new i.av(ue.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ke=0;ke<ue.length;ke+=this.stride)ge.add(ue[ke],ue[ke+1]);return ge.finish(),ge.data=ue,ge}_addTileFeatures(ue,ge,ke,Ve,We,G){for(let te of ue){let Q=te*this.stride,ae=ge[Q+kt]>1,he,we,Ee;if(ae)he=wr(ge,Q,this.clusterProps),we=ge[Q],Ee=ge[Q+1];else{let mt=this.points[ge[Q+St]];he=mt.properties;let[Tt,jt]=mt.geometry.coordinates;we=Ir(Tt),Ee=Br(jt)}let Xe={type:1,geometry:[[Math.round(this.options.extent*(we*We-ke)),Math.round(this.options.extent*(Ee*We-Ve))]],tags:he},ut;ut=ae||this.options.generateId?ge[Q+St]:this.points[ge[Q+St]].id,ut!==void 0&&(Xe.id=ut),G.features.push(Xe)}}_limitZoom(ue){return Math.max(this.options.minZoom,Math.min(Math.floor(+ue),this.options.maxZoom+1))}_cluster(ue,ge){let{radius:ke,extent:Ve,reduce:We,minPoints:G}=this.options,te=ke/(Ve*Math.pow(2,ge)),Q=ue.data,ae=[],he=this.stride;for(let we=0;we<Q.length;we+=he){if(Q[we+2]<=ge)continue;Q[we+2]=ge;let Ee=Q[we],Xe=Q[we+1],ut=ue.within(Q[we],Q[we+1],te),mt=Q[we+kt],Tt=mt;for(let jt of ut){let Et=jt*he;Q[Et+2]>ge&&(Tt+=Q[Et+kt])}if(Tt>mt&&Tt>=G){let jt,Et=Ee*mt,Ct=Xe*mt,Dt=-1,Lt=((we/he|0)<<5)+(ge+1)+this.points.length;for(let xr of ut){let Sr=xr*he;if(Q[Sr+2]<=ge)continue;Q[Sr+2]=ge;let ln=Q[Sr+kt];Et+=Q[Sr]*ln,Ct+=Q[Sr+1]*ln,Q[Sr+4]=Lt,We&&(jt||(jt=this._map(Q,we,!0),Dt=this.clusterProps.length,this.clusterProps.push(jt)),We(jt,this._map(Q,Sr)))}Q[we+4]=Lt,ae.push(Et/Tt,Ct/Tt,1/0,Lt,-1,Tt),We&&ae.push(Dt)}else{for(let jt=0;jt<he;jt++)ae.push(Q[we+jt]);if(Tt>1)for(let jt of ut){let Et=jt*he;if(!(Q[Et+2]<=ge)){Q[Et+2]=ge;for(let Ct=0;Ct<he;Ct++)ae.push(Q[Et+Ct])}}}}return ae}_getOriginId(ue){return ue-this.points.length>>5}_getOriginZoom(ue){return(ue-this.points.length)%32}_map(ue,ge,ke){if(ue[ge+kt]>1){let G=this.clusterProps[ue[ge+yt]];return ke?Object.assign({},G):G}let Ve=this.points[ue[ge+St]].properties,We=this.options.map(Ve);return ke&&We===Ve?Object.assign({},We):We}}function vr(Oe,ue,ge){return{type:"Feature",id:Oe[ue+St],properties:wr(Oe,ue,ge),geometry:{type:"Point",coordinates:[(ke=Oe[ue],360*(ke-.5)),qt(Oe[ue+1])]}};var ke}function wr(Oe,ue,ge){let ke=Oe[ue+kt],Ve=ke>=1e4?`${Math.round(ke/1e3)}k`:ke>=1e3?Math.round(ke/100)/10+"k":ke,We=Oe[ue+yt],G=We===-1?{}:Object.assign({},ge[We]);return Object.assign(G,{cluster:!0,cluster_id:Oe[ue+St],point_count:ke,point_count_abbreviated:Ve})}function Ir(Oe){return Oe/360+.5}function Br(Oe){let ue=Math.sin(Oe*Math.PI/180),ge=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return ge<0?0:ge>1?1:ge}function qt(Oe){let ue=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(ue))/Math.PI-90}function Lr(Oe,ue,ge,ke){for(var Ve,We=ke,G=ge-ue>>1,te=ge-ue,Q=Oe[ue],ae=Oe[ue+1],he=Oe[ge],we=Oe[ge+1],Ee=ue+3;Ee<ge;Ee+=3){var Xe=Yr(Oe[Ee],Oe[Ee+1],Q,ae,he,we);if(Xe>We)Ve=Ee,We=Xe;else if(Xe===We){var ut=Math.abs(Ee-G);ut<te&&(Ve=Ee,te=ut)}}We>ke&&(Ve-ue>3&&Lr(Oe,ue,Ve,ke),Oe[Ve+2]=We,ge-Ve>3&&Lr(Oe,Ve,ge,ke))}function Yr(Oe,ue,ge,ke,Ve,We){var G=Ve-ge,te=We-ke;if(G!==0||te!==0){var Q=((Oe-ge)*G+(ue-ke)*te)/(G*G+te*te);Q>1?(ge=Ve,ke=We):Q>0&&(ge+=G*Q,ke+=te*Q)}return(G=Oe-ge)*G+(te=ue-ke)*te}function Rt(Oe,ue,ge,ke){var Ve={id:Oe===void 0?null:Oe,type:ue,geometry:ge,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(We){var G=We.geometry,te=We.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")bn(We,G);else if(te==="Polygon"||te==="MultiLineString")for(var Q=0;Q<G.length;Q++)bn(We,G[Q]);else if(te==="MultiPolygon")for(Q=0;Q<G.length;Q++)for(var ae=0;ae<G[Q].length;ae++)bn(We,G[Q][ae])}(Ve),Ve}function bn(Oe,ue){for(var ge=0;ge<ue.length;ge+=3)Oe.minX=Math.min(Oe.minX,ue[ge]),Oe.minY=Math.min(Oe.minY,ue[ge+1]),Oe.maxX=Math.max(Oe.maxX,ue[ge]),Oe.maxY=Math.max(Oe.maxY,ue[ge+1])}function tn(Oe,ue,ge,ke){if(ue.geometry){var Ve=ue.geometry.coordinates,We=ue.geometry.type,G=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2),te=[],Q=ue.id;if(ge.promoteId?Q=ue.properties[ge.promoteId]:ge.generateId&&(Q=ke||0),We==="Point")sr(Ve,te);else if(We==="MultiPoint")for(var ae=0;ae<Ve.length;ae++)sr(Ve[ae],te);else if(We==="LineString")Rn(Ve,te,G,!1);else if(We==="MultiLineString"){if(ge.lineMetrics){for(ae=0;ae<Ve.length;ae++)Rn(Ve[ae],te=[],G,!1),Oe.push(Rt(Q,"LineString",te,ue.properties));return}dr(Ve,te,G,!1)}else if(We==="Polygon")dr(Ve,te,G,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(ae=0;ae<ue.geometry.geometries.length;ae++)tn(Oe,{id:Q,geometry:ue.geometry.geometries[ae],properties:ue.properties},ge,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<Ve.length;ae++){var he=[];dr(Ve[ae],he,G,!0),te.push(he)}}Oe.push(Rt(Q,We,te,ue.properties))}}function sr(Oe,ue){ue.push(xt(Oe[0])),ue.push(ei(Oe[1])),ue.push(0)}function Rn(Oe,ue,ge,ke){for(var Ve,We,G=0,te=0;te<Oe.length;te++){var Q=xt(Oe[te][0]),ae=ei(Oe[te][1]);ue.push(Q),ue.push(ae),ue.push(0),te>0&&(G+=ke?(Ve*ae-Q*We)/2:Math.sqrt(Math.pow(Q-Ve,2)+Math.pow(ae-We,2))),Ve=Q,We=ae}var he=ue.length-3;ue[2]=1,Lr(ue,0,he,ge),ue[he+2]=1,ue.size=Math.abs(G),ue.start=0,ue.end=ue.size}function dr(Oe,ue,ge,ke){for(var Ve=0;Ve<Oe.length;Ve++){var We=[];Rn(Oe[Ve],We,ge,ke),ue.push(We)}}function xt(Oe){return Oe/360+.5}function ei(Oe){var ue=Math.sin(Oe*Math.PI/180),ge=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return ge<0?0:ge>1?1:ge}function Hr(Oe,ue,ge,ke,Ve,We,G,te){if(ke/=ue,We>=(ge/=ue)&&G<ke)return Oe;if(G<ge||We>=ke)return null;for(var Q=[],ae=0;ae<Oe.length;ae++){var he=Oe[ae],we=he.geometry,Ee=he.type,Xe=Ve===0?he.minX:he.minY,ut=Ve===0?he.maxX:he.maxY;if(Xe>=ge&&ut<ke)Q.push(he);else if(!(ut<ge||Xe>=ke)){var mt=[];if(Ee==="Point"||Ee==="MultiPoint")Pn(we,mt,ge,ke,Ve);else if(Ee==="LineString")gn(we,mt,ge,ke,Ve,!1,te.lineMetrics);else if(Ee==="MultiLineString")bs(we,mt,ge,ke,Ve,!1);else if(Ee==="Polygon")bs(we,mt,ge,ke,Ve,!0);else if(Ee==="MultiPolygon")for(var Tt=0;Tt<we.length;Tt++){var jt=[];bs(we[Tt],jt,ge,ke,Ve,!0),jt.length&&mt.push(jt)}if(mt.length){if(te.lineMetrics&&Ee==="LineString"){for(Tt=0;Tt<mt.length;Tt++)Q.push(Rt(he.id,Ee,mt[Tt],he.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(mt.length===1?(Ee="LineString",mt=mt[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=mt.length===3?"Point":"MultiPoint"),Q.push(Rt(he.id,Ee,mt,he.tags))}}}return Q.length?Q:null}function Pn(Oe,ue,ge,ke,Ve){for(var We=0;We<Oe.length;We+=3){var G=Oe[We+Ve];G>=ge&&G<=ke&&(ue.push(Oe[We]),ue.push(Oe[We+1]),ue.push(Oe[We+2]))}}function gn(Oe,ue,ge,ke,Ve,We,G){for(var te,Q,ae=No(Oe),he=Ve===0?ba:vs,we=Oe.start,Ee=0;Ee<Oe.length-3;Ee+=3){var Xe=Oe[Ee],ut=Oe[Ee+1],mt=Oe[Ee+2],Tt=Oe[Ee+3],jt=Oe[Ee+4],Et=Ve===0?Xe:ut,Ct=Ve===0?Tt:jt,Dt=!1;G&&(te=Math.sqrt(Math.pow(Xe-Tt,2)+Math.pow(ut-jt,2))),Et<ge?Ct>ge&&(Q=he(ae,Xe,ut,Tt,jt,ge),G&&(ae.start=we+te*Q)):Et>ke?Ct<ke&&(Q=he(ae,Xe,ut,Tt,jt,ke),G&&(ae.start=we+te*Q)):qo(ae,Xe,ut,mt),Ct<ge&&Et>=ge&&(Q=he(ae,Xe,ut,Tt,jt,ge),Dt=!0),Ct>ke&&Et<=ke&&(Q=he(ae,Xe,ut,Tt,jt,ke),Dt=!0),!We&&Dt&&(G&&(ae.end=we+te*Q),ue.push(ae),ae=No(Oe)),G&&(we+=te)}var Lt=Oe.length-3;Xe=Oe[Lt],ut=Oe[Lt+1],mt=Oe[Lt+2],(Et=Ve===0?Xe:ut)>=ge&&Et<=ke&&qo(ae,Xe,ut,mt),Lt=ae.length-3,We&&Lt>=3&&(ae[Lt]!==ae[0]||ae[Lt+1]!==ae[1])&&qo(ae,ae[0],ae[1],ae[2]),ae.length&&ue.push(ae)}function No(Oe){var ue=[];return ue.size=Oe.size,ue.start=Oe.start,ue.end=Oe.end,ue}function bs(Oe,ue,ge,ke,Ve,We){for(var G=0;G<Oe.length;G++)gn(Oe[G],ue,ge,ke,Ve,We,!1)}function qo(Oe,ue,ge,ke){Oe.push(ue),Oe.push(ge),Oe.push(ke)}function ba(Oe,ue,ge,ke,Ve,We){var G=(We-ue)/(ke-ue);return Oe.push(We),Oe.push(ge+(Ve-ge)*G),Oe.push(1),G}function vs(Oe,ue,ge,ke,Ve,We){var G=(We-ge)/(Ve-ge);return Oe.push(ue+(ke-ue)*G),Oe.push(We),Oe.push(1),G}function zo(Oe,ue){for(var ge=[],ke=0;ke<Oe.length;ke++){var Ve,We=Oe[ke],G=We.type;if(G==="Point"||G==="MultiPoint"||G==="LineString")Ve=Do(We.geometry,ue);else if(G==="MultiLineString"||G==="Polygon"){Ve=[];for(var te=0;te<We.geometry.length;te++)Ve.push(Do(We.geometry[te],ue))}else if(G==="MultiPolygon")for(Ve=[],te=0;te<We.geometry.length;te++){for(var Q=[],ae=0;ae<We.geometry[te].length;ae++)Q.push(Do(We.geometry[te][ae],ue));Ve.push(Q)}ge.push(Rt(We.id,G,Ve,We.tags))}return ge}function Do(Oe,ue){var ge=[];ge.size=Oe.size,Oe.start!==void 0&&(ge.start=Oe.start,ge.end=Oe.end);for(var ke=0;ke<Oe.length;ke+=3)ge.push(Oe[ke]+ue,Oe[ke+1],Oe[ke+2]);return ge}function Zt(Oe,ue){if(Oe.transformed)return Oe;var ge,ke,Ve,We=1<<Oe.z,G=Oe.x,te=Oe.y;for(ge=0;ge<Oe.features.length;ge++){var Q=Oe.features[ge],ae=Q.geometry,he=Q.type;if(Q.geometry=[],he===1)for(ke=0;ke<ae.length;ke+=2)Q.geometry.push(eo(ae[ke],ae[ke+1],ue,We,G,te));else for(ke=0;ke<ae.length;ke++){var we=[];for(Ve=0;Ve<ae[ke].length;Ve+=2)we.push(eo(ae[ke][Ve],ae[ke][Ve+1],ue,We,G,te));Q.geometry.push(we)}}return Oe.transformed=!0,Oe}function eo(Oe,ue,ge,ke,Ve,We){return[Math.round(ge*(Oe*ke-Ve)),Math.round(ge*(ue*ke-We))]}function Xn(Oe,ue,ge,ke,Ve){for(var We=ue===Ve.maxZoom?0:Ve.tolerance/((1<<ue)*Ve.extent),G={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ge,y:ke,z:ue,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<Oe.length;te++){G.numFeatures++,ws(G,Oe[te],We,Ve);var Q=Oe[te].minX,ae=Oe[te].minY,he=Oe[te].maxX,we=Oe[te].maxY;Q<G.minX&&(G.minX=Q),ae<G.minY&&(G.minY=ae),he>G.maxX&&(G.maxX=he),we>G.maxY&&(G.maxY=we)}return G}function ws(Oe,ue,ge,ke){var Ve=ue.geometry,We=ue.type,G=[];if(We==="Point"||We==="MultiPoint")for(var te=0;te<Ve.length;te+=3)G.push(Ve[te]),G.push(Ve[te+1]),Oe.numPoints++,Oe.numSimplified++;else if(We==="LineString")wo(G,Ve,Oe,ge,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(te=0;te<Ve.length;te++)wo(G,Ve[te],Oe,ge,We==="Polygon",te===0);else if(We==="MultiPolygon")for(var Q=0;Q<Ve.length;Q++){var ae=Ve[Q];for(te=0;te<ae.length;te++)wo(G,ae[te],Oe,ge,!0,te===0)}if(G.length){var he=ue.tags||null;if(We==="LineString"&&ke.lineMetrics){for(var we in he={},ue.tags)he[we]=ue.tags[we];he.mapbox_clip_start=Ve.start/Ve.size,he.mapbox_clip_end=Ve.end/Ve.size}var Ee={geometry:G,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:he};ue.id!==null&&(Ee.id=ue.id),Oe.features.push(Ee)}}function wo(Oe,ue,ge,ke,Ve,We){var G=ke*ke;if(ke>0&&ue.size<(Ve?G:ke))ge.numPoints+=ue.length/3;else{for(var te=[],Q=0;Q<ue.length;Q+=3)(ke===0||ue[Q+2]>G)&&(ge.numSimplified++,te.push(ue[Q]),te.push(ue[Q+1])),ge.numPoints++;Ve&&function(ae,he){for(var we=0,Ee=0,Xe=ae.length,ut=Xe-2;Ee<Xe;ut=Ee,Ee+=2)we+=(ae[Ee]-ae[ut])*(ae[Ee+1]+ae[ut+1]);if(we>0===he)for(Ee=0,Xe=ae.length;Ee<Xe/2;Ee+=2){var mt=ae[Ee],Tt=ae[Ee+1];ae[Ee]=ae[Xe-2-Ee],ae[Ee+1]=ae[Xe-1-Ee],ae[Xe-2-Ee]=mt,ae[Xe-1-Ee]=Tt}}(te,We),Oe.push(te)}}function Ht(Oe,ue){var ge=(ue=this.options=function(Ve,We){for(var G in We)Ve[G]=We[G];return Ve}(Object.create(this.options),ue)).debug;if(ge&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");var ke=function(Ve,We){var G=[];if(Ve.type==="FeatureCollection")for(var te=0;te<Ve.features.length;te++)tn(G,Ve.features[te],We,te);else tn(G,Ve.type==="Feature"?Ve:{geometry:Ve},We);return G}(Oe,ue);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=function(Ve,We){var G=We.buffer/We.extent,te=Ve,Q=Hr(Ve,1,-1-G,G,0,-1,2,We),ae=Hr(Ve,1,1-G,2+G,0,-1,2,We);return(Q||ae)&&(te=Hr(Ve,1,-G,1+G,0,-1,2,We)||[],Q&&(te=zo(Q,1).concat(te)),ae&&(te=te.concat(zo(ae,-1)))),te}(ke,ue),ke.length&&this.splitTile(ke,0,0,0),ge&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $r(Oe,ue,ge){return 32*((1<<Oe)*ge+ue)+Oe}function cr(Oe,ue){return ue?Oe.properties[ue]:Oe.id}function ji(Oe,ue){if(Oe==null)return!0;if(Oe.type==="Feature")return cr(Oe,ue)!=null;if(Oe.type==="FeatureCollection"){let ge=new Set;for(let ke of Oe.features){let Ve=cr(ke,ue);if(Ve==null||ge.has(Ve))return!1;ge.add(Ve)}return!0}return!1}function to(Oe,ue){let ge=new Map;if(Oe!=null)if(Oe.type==="Feature")ge.set(cr(Oe,ue),Oe);else for(let ke of Oe.features)ge.set(cr(ke,ue),ke);return ge}Ht.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ht.prototype.splitTile=function(Oe,ue,ge,ke,Ve,We,G){for(var te=[Oe,ue,ge,ke],Q=this.options,ae=Q.debug;te.length;){ke=te.pop(),ge=te.pop(),ue=te.pop(),Oe=te.pop();var he=1<<ue,we=$r(ue,ge,ke),Ee=this.tiles[we];if(!Ee&&(ae>1&&console.time("creation"),Ee=this.tiles[we]=Xn(Oe,ue,ge,ke,Q),this.tileCoords.push({z:ue,x:ge,y:ke}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ge,ke,Ee.numFeatures,Ee.numPoints,Ee.numSimplified),console.timeEnd("creation"));var Xe="z"+ue;this.stats[Xe]=(this.stats[Xe]||0)+1,this.total++}if(Ee.source=Oe,Ve){if(ue===Q.maxZoom||ue===Ve)continue;var ut=1<<Ve-ue;if(ge!==Math.floor(We/ut)||ke!==Math.floor(G/ut))continue}else if(ue===Q.indexMaxZoom||Ee.numPoints<=Q.indexMaxPoints)continue;if(Ee.source=null,Oe.length!==0){ae>1&&console.time("clipping");var mt,Tt,jt,Et,Ct,Dt,Lt=.5*Q.buffer/Q.extent,xr=.5-Lt,Sr=.5+Lt,ln=1+Lt;mt=Tt=jt=Et=null,Ct=Hr(Oe,he,ge-Lt,ge+Sr,0,Ee.minX,Ee.maxX,Q),Dt=Hr(Oe,he,ge+xr,ge+ln,0,Ee.minX,Ee.maxX,Q),Oe=null,Ct&&(mt=Hr(Ct,he,ke-Lt,ke+Sr,1,Ee.minY,Ee.maxY,Q),Tt=Hr(Ct,he,ke+xr,ke+ln,1,Ee.minY,Ee.maxY,Q),Ct=null),Dt&&(jt=Hr(Dt,he,ke-Lt,ke+Sr,1,Ee.minY,Ee.maxY,Q),Et=Hr(Dt,he,ke+xr,ke+ln,1,Ee.minY,Ee.maxY,Q),Dt=null),ae>1&&console.timeEnd("clipping"),te.push(mt||[],ue+1,2*ge,2*ke),te.push(Tt||[],ue+1,2*ge,2*ke+1),te.push(jt||[],ue+1,2*ge+1,2*ke),te.push(Et||[],ue+1,2*ge+1,2*ke+1)}}},Ht.prototype.getTile=function(Oe,ue,ge){var ke=this.options,Ve=ke.extent,We=ke.debug;if(Oe<0||Oe>24)return null;var G=1<<Oe,te=$r(Oe,ue=(ue%G+G)%G,ge);if(this.tiles[te])return Zt(this.tiles[te],Ve);We>1&&console.log("drilling down to z%d-%d-%d",Oe,ue,ge);for(var Q,ae=Oe,he=ue,we=ge;!Q&&ae>0;)ae--,he=Math.floor(he/2),we=Math.floor(we/2),Q=this.tiles[$r(ae,he,we)];return Q&&Q.source?(We>1&&console.log("found parent tile z%d-%d-%d",ae,he,we),We>1&&console.time("drilling down"),this.splitTile(Q.source,ae,he,we,Oe,ue,ge),We>1&&console.timeEnd("drilling down"),this.tiles[te]?Zt(this.tiles[te],Ve):null):null};class zr extends _{constructor(ue,ge,ke,Ve){super(ue,ge,ke),this._dataUpdateable=new Map,this.loadGeoJSON=(We,G)=>{let{promoteId:te}=We;if(We.request)return i.f(We.request,(Q,ae,he,we)=>{this._dataUpdateable=ji(ae,te)?to(ae,te):void 0,G(Q,ae,he,we)});if(typeof We.data=="string")try{let Q=JSON.parse(We.data);this._dataUpdateable=ji(Q,te)?to(Q,te):void 0,G(null,Q)}catch{G(new Error(`Input data given to '${We.source}' is not a valid GeoJSON object.`))}else We.dataDiff?this._dataUpdateable?(function(Q,ae,he){var we,Ee,Xe,ut;if(ae.removeAll&&Q.clear(),ae.remove)for(let mt of ae.remove)Q.delete(mt);if(ae.add)for(let mt of ae.add){let Tt=cr(mt,he);Tt!=null&&Q.set(Tt,mt)}if(ae.update)for(let mt of ae.update){let Tt=Q.get(mt.id);if(Tt==null)continue;let jt=!mt.removeAllProperties&&(((we=mt.removeProperties)===null||we===void 0?void 0:we.length)>0||((Ee=mt.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0);if((mt.newGeometry||mt.removeAllProperties||jt)&&(Tt=Object.assign({},Tt),Q.set(mt.id,Tt),jt&&(Tt.properties=Object.assign({},Tt.properties))),mt.newGeometry&&(Tt.geometry=mt.newGeometry),mt.removeAllProperties)Tt.properties={};else if(((Xe=mt.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0)for(let Et of mt.removeProperties)Object.prototype.hasOwnProperty.call(Tt.properties,Et)&&delete Tt.properties[Et];if(((ut=mt.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0)for(let{key:Et,value:Ct}of mt.addOrUpdateProperties)Tt.properties[Et]=Ct}}(this._dataUpdateable,We.dataDiff,te),G(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):G(new Error(`Cannot update existing geojson data in ${We.source}`)):G(new Error(`Input data given to '${We.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Ve&&(this.loadGeoJSON=Ve)}loadGeoJSONTile(ue,ge){let ke=ue.tileID.canonical;if(!this._geoJSONIndex)return ge(null,null);let Ve=this._geoJSONIndex.getTile(ke.z,ke.x,ke.y);if(!Ve)return ge(null,null);let We=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.N,this.length=te.length,this._features=te}feature(te){return new class{constructor(Q){this._feature=Q,this.extent=i.N,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){let Q=[];for(let ae of this._feature.geometry)Q.push([new i.P(ae[0],ae[1])]);return Q}{let Q=[];for(let ae of this._feature.geometry){let he=[];for(let we of ae)he.push(new i.P(we[0],we[1]));Q.push(he)}return Q}}toGeoJSON(Q,ae,he){return P.call(this,Q,ae,he)}}(this._features[te])}}(Ve.features),G=Je(We);G.byteOffset===0&&G.byteLength===G.buffer.byteLength||(G=new Uint8Array(G)),ge(null,{vectorTile:We,rawData:G.buffer})}loadData(ue,ge){var ke;(ke=this._pendingRequest)===null||ke===void 0||ke.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let Ve=!!(ue&&ue.request&&ue.request.collectResourceTiming)&&new i.bu(ue.request);this._pendingCallback=ge,this._pendingRequest=this.loadGeoJSON(ue,(We,G)=>{if(delete this._pendingCallback,delete this._pendingRequest,We||!G)return ge(We);if(typeof G!="object")return ge(new Error(`Input data given to '${ue.source}' is not a valid GeoJSON object.`));{k(G,!0);try{if(ue.filter){let Q=i.bC(ue.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(he=>`${he.key}: ${he.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(he=>Q.value.evaluate({zoom:0},he))}}this._geoJSONIndex=ue.cluster?new tr(function({superclusterOptions:Q,clusterProperties:ae}){if(!ae||!Q)return Q;let he={},we={},Ee={accumulated:null,zoom:0},Xe={properties:null},ut=Object.keys(ae);for(let mt of ut){let[Tt,jt]=ae[mt],Et=i.bC(jt),Ct=i.bC(typeof Tt=="string"?[Tt,["accumulated"],["get",mt]]:Tt);he[mt]=Et.value,we[mt]=Ct.value}return Q.map=mt=>{Xe.properties=mt;let Tt={};for(let jt of ut)Tt[jt]=he[jt].evaluate(Ee,Xe);return Tt},Q.reduce=(mt,Tt)=>{Xe.properties=Tt;for(let jt of ut)Ee.accumulated=mt[jt],mt[jt]=we[jt].evaluate(Ee,Xe)},Q}(ue)).load(G.features):function(Q,ae){return new Ht(Q,ae)}(G,ue.geojsonVtOptions)}catch(Q){return ge(Q)}this.loaded={};let te={};if(Ve){let Q=Ve.finish();Q&&(te.resourceTiming={},te.resourceTiming[ue.source]=JSON.parse(JSON.stringify(Q)))}ge(null,te)}})}reloadTile(ue,ge){let ke=this.loaded;return ke&&ke[ue.uid]?super.reloadTile(ue,ge):this.loadTile(ue,ge)}removeSource(ue,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()}getClusterExpansionZoom(ue,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(ue.clusterId))}catch(ke){ge(ke)}}getClusterChildren(ue,ge){try{ge(null,this._geoJSONIndex.getChildren(ue.clusterId))}catch(ke){ge(ke)}}getClusterLeaves(ue,ge){try{ge(null,this._geoJSONIndex.getLeaves(ue.clusterId,ue.limit,ue.offset))}catch(ke){ge(ke)}}}class Ao{constructor(ue){this.self=ue,this.actor=new i.C(ue,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:_,geojson:zr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ge,ke)=>{if(this.workerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.workerSourceTypes[ge]=ke},this.self.registerRTLTextPlugin=ge=>{if(i.bD.isParsed())throw new Error("RTL text plugin already registered.");i.bD.applyArabicShaping=ge.applyArabicShaping,i.bD.processBidirectionalText=ge.processBidirectionalText,i.bD.processStyledBidirectionalText=ge.processStyledBidirectionalText}}setReferrer(ue,ge){this.referrer=ge}setImages(ue,ge,ke){this.availableImages[ue]=ge;for(let Ve in this.workerSources[ue]){let We=this.workerSources[ue][Ve];for(let G in We)We[G].availableImages=ge}ke()}setLayers(ue,ge,ke){this.getLayerIndex(ue).replace(ge),ke()}updateLayers(ue,ge,ke){this.getLayerIndex(ue).update(ge.layers,ge.removedIds),ke()}loadTile(ue,ge,ke){this.getWorkerSource(ue,ge.type,ge.source).loadTile(ge,ke)}loadDEMTile(ue,ge,ke){this.getDEMWorkerSource(ue,ge.source).loadTile(ge,ke)}reloadTile(ue,ge,ke){this.getWorkerSource(ue,ge.type,ge.source).reloadTile(ge,ke)}abortTile(ue,ge,ke){this.getWorkerSource(ue,ge.type,ge.source).abortTile(ge,ke)}removeTile(ue,ge,ke){this.getWorkerSource(ue,ge.type,ge.source).removeTile(ge,ke)}removeDEMTile(ue,ge){this.getDEMWorkerSource(ue,ge.source).removeTile(ge)}removeSource(ue,ge,ke){if(!this.workerSources[ue]||!this.workerSources[ue][ge.type]||!this.workerSources[ue][ge.type][ge.source])return;let Ve=this.workerSources[ue][ge.type][ge.source];delete this.workerSources[ue][ge.type][ge.source],Ve.removeSource!==void 0?Ve.removeSource(ge,ke):ke()}loadWorkerSource(ue,ge,ke){try{this.self.importScripts(ge.url),ke()}catch(Ve){ke(Ve.toString())}}syncRTLPluginState(ue,ge,ke){try{i.bD.setState(ge);let Ve=i.bD.getPluginURL();if(i.bD.isLoaded()&&!i.bD.isParsed()&&Ve!=null){this.self.importScripts(Ve);let We=i.bD.isParsed();ke(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ve}`),We)}}catch(Ve){ke(Ve.toString())}}getAvailableImages(ue){let ge=this.availableImages[ue];return ge||(ge=[]),ge}getLayerIndex(ue){let ge=this.layerIndexes[ue];return ge||(ge=this.layerIndexes[ue]=new s),ge}getWorkerSource(ue,ge,ke){return this.workerSources[ue]||(this.workerSources[ue]={}),this.workerSources[ue][ge]||(this.workerSources[ue][ge]={}),this.workerSources[ue][ge][ke]||(this.workerSources[ue][ge][ke]=new this.workerSourceTypes[ge]({send:(Ve,We,G)=>{this.actor.send(Ve,We,G,ue)}},this.getLayerIndex(ue),this.getAvailableImages(ue))),this.workerSources[ue][ge][ke]}getDEMWorkerSource(ue,ge){return this.demWorkerSources[ue]||(this.demWorkerSources[ue]={}),this.demWorkerSources[ue][ge]||(this.demWorkerSources[ue][ge]=new y),this.demWorkerSources[ue][ge]}}return i.i()&&(self.worker=new Ao(self)),Ao}),n(["./shared"],function(i){"use strict";var s="3.6.2";class a{static testProp(c){if(!a.docStyle)return c[0];for(let m=0;m<c.length;m++)if(c[m]in a.docStyle)return c[m];return c[0]}static create(c,m,x){let v=window.document.createElement(c);return m!==void 0&&(v.className=m),x&&x.appendChild(v),v}static createNS(c,m){return window.document.createElementNS(c,m)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(c,m){c.style[a.transformProp]=m}static addEventListener(c,m,x,v={}){c.addEventListener(m,x,"passive"in v?v:v.capture)}static removeEventListener(c,m,x,v={}){c.removeEventListener(m,x,"passive"in v?v:v.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",a.suppressClickInternal,!0)},0)}static mousePos(c,m){let x=c.getBoundingClientRect();return new i.P(m.clientX-x.left-c.clientLeft,m.clientY-x.top-c.clientTop)}static touchPos(c,m){let x=c.getBoundingClientRect(),v=[];for(let S=0;S<m.length;S++)v.push(new i.P(m[S].clientX-x.left-c.clientLeft,m[S].clientY-x.top-c.clientTop));return v}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}}a.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);let u={supported:!1,testSupport:function(M){!_&&p&&(y?A(M):h=M)}},h,p,_=!1,y=!1;function A(M){let c=M.createTexture();M.bindTexture(M.TEXTURE_2D,c);try{if(M.texImage2D(M.TEXTURE_2D,0,M.RGBA,M.RGBA,M.UNSIGNED_BYTE,p),M.isContextLost())return;u.supported=!0}catch{}M.deleteTexture(c),_=!0}var E,k;typeof document<"u"&&(p=document.createElement("img"),p.onload=function(){h&&A(h),h=null,y=!0},p.onerror=function(){_=!0,h=null},p.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(M){let c,m,x,v;M.resetRequestQueue=()=>{c=[],m=0,x=0,v={}},M.addThrottleControl=re=>{let se=x++;return v[se]=re,se},M.removeThrottleControl=re=>{delete v[re],F()},M.getImage=(re,se,le=!0)=>{u.supported&&(re.headers||(re.headers={}),re.headers.accept="image/webp,*/*");let xe={requestParameters:re,supportImageRefresh:le,callback:se,cancelled:!1,completed:!1,cancel:()=>{xe.completed||xe.cancelled||(xe.cancelled=!0,xe.innerRequest&&(xe.innerRequest.cancel(),m--),F())}};return c.push(xe),F(),xe};let S=re=>{let{requestParameters:se,supportImageRefresh:le,callback:xe}=re;return i.e(se,{type:"image"}),(le!==!1||i.i()||i.g(se.url)||se.headers&&!Object.keys(se.headers).reduce((Ne,De)=>Ne&&De==="accept",!0)?i.m:Y)(se,(Ne,De,Ze,ze)=>{L(re,xe,Ne,De,Ze,ze)})},L=(re,se,le,xe,Ne,De)=>{le?se(le):xe instanceof HTMLImageElement||i.a(xe)?se(null,xe):xe&&((Ze,ze)=>{typeof createImageBitmap=="function"?i.b(Ze,ze):i.d(Ze,ze)})(xe,(Ze,ze)=>{Ze!=null?se(Ze):ze!=null&&se(null,ze,{cacheControl:Ne,expires:De})}),re.cancelled||(re.completed=!0,m--,F())},F=()=>{let re=(()=>{let se=Object.keys(v),le=!1;if(se.length>0){for(let xe of se)if(le=v[xe](),le)break}return le})()?i.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:i.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let se=m;se<re&&c.length>0;se++){let le=c.shift();if(le.cancelled){se--;continue}let xe=S(le);m++,le.innerRequest=xe}},Y=(re,se)=>{let le=new Image,xe=re.url,Ne=!1,De=re.credentials;return De&&De==="include"?le.crossOrigin="use-credentials":(De&&De==="same-origin"||!i.s(xe))&&(le.crossOrigin="anonymous"),le.fetchPriority="high",le.onload=()=>{se(null,le),le.onerror=le.onload=null},le.onerror=()=>{Ne||se(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),le.onerror=le.onload=null},le.src=xe,{cancel:()=>{Ne=!0,le.src=""}}}}(E||(E={})),E.resetRequestQueue(),function(M){M.Glyphs="Glyphs",M.Image="Image",M.Source="Source",M.SpriteImage="SpriteImage",M.SpriteJSON="SpriteJSON",M.Style="Style",M.Tile="Tile",M.Unknown="Unknown"}(k||(k={}));class P{constructor(c){this._transformRequestFn=c}transformRequest(c,m){return this._transformRequestFn&&this._transformRequestFn(c,m)||{url:c}}normalizeSpriteURL(c,m,x){let v=function(S){let L=S.match(R);if(!L)throw new Error(`Unable to parse URL "${S}"`);return{protocol:L[1],authority:L[2],path:L[3]||"/",params:L[4]?L[4].split("&"):[]}}(c);return v.path+=`${m}${x}`,function(S){let L=S.params.length?`?${S.params.join("&")}`:"";return`${S.protocol}://${S.authority}${S.path}${L}`}(v)}setTransformRequest(c){this._transformRequestFn=c}}let R=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function V(M){var c=new i.A(3);return c[0]=M[0],c[1]=M[1],c[2]=M[2],c}var N,j=function(M,c,m){return M[0]=c[0]-m[0],M[1]=c[1]-m[1],M[2]=c[2]-m[2],M};N=new i.A(3),i.A!=Float32Array&&(N[0]=0,N[1]=0,N[2]=0);var J=function(M){var c=M[0],m=M[1];return c*c+m*m};function ne(M){let c=[];if(typeof M=="string")c.push({id:"default",url:M});else if(M&&M.length>0){let m=[];for(let{id:x,url:v}of M){let S=`${x}${v}`;m.indexOf(S)===-1&&(m.push(S),c.push({id:x,url:v}))}}return c}function de(M,c,m,x,v){if(x)return void M(x);if(v!==Object.values(c).length||v!==Object.values(m).length)return;let S={};for(let L in c){S[L]={};let F=i.h.getImageCanvasContext(m[L]),Y=c[L];for(let re in Y){let{width:se,height:le,x:xe,y:Ne,sdf:De,pixelRatio:Ze,stretchX:ze,stretchY:nt,content:_t}=Y[re];S[L][re]={data:null,pixelRatio:Ze,sdf:De,stretchX:ze,stretchY:nt,content:_t,spriteData:{width:se,height:le,x:xe,y:Ne,context:F}}}}M(null,S)}(function(){var M=new i.A(2);i.A!=Float32Array&&(M[0]=0,M[1]=0)})();class fe{constructor(c,m,x,v){this.context=c,this.format=x,this.texture=c.gl.createTexture(),this.update(m,v)}update(c,m,x){let{width:v,height:S}=c,L=!(this.size&&this.size[0]===v&&this.size[1]===S||x),{context:F}=this,{gl:Y}=F;if(this.useMipmap=!!(m&&m.useMipmap),Y.bindTexture(Y.TEXTURE_2D,this.texture),F.pixelStoreUnpackFlipY.set(!1),F.pixelStoreUnpack.set(1),F.pixelStoreUnpackPremultiplyAlpha.set(this.format===Y.RGBA&&(!m||m.premultiply!==!1)),L)this.size=[v,S],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||i.a(c)?Y.texImage2D(Y.TEXTURE_2D,0,this.format,this.format,Y.UNSIGNED_BYTE,c):Y.texImage2D(Y.TEXTURE_2D,0,this.format,v,S,0,this.format,Y.UNSIGNED_BYTE,c.data);else{let{x:re,y:se}=x||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||i.a(c)?Y.texSubImage2D(Y.TEXTURE_2D,0,re,se,Y.RGBA,Y.UNSIGNED_BYTE,c):Y.texSubImage2D(Y.TEXTURE_2D,0,re,se,v,S,Y.RGBA,Y.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&Y.generateMipmap(Y.TEXTURE_2D)}bind(c,m,x){let{context:v}=this,{gl:S}=v;S.bindTexture(S.TEXTURE_2D,this.texture),x!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=S.LINEAR),c!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,c),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,x||c),this.filter=c),m!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,m),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,m),this.wrap=m)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function ye(M){let{userImage:c}=M;return!!(c&&c.render&&c.render())&&(M.data.replace(new Uint8Array(c.data.buffer)),!0)}class ve extends i.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new i.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(let{ids:m,callback:x}of this.requestors)this._notify(m,x);this.requestors=[]}}getImage(c){let m=this.images[c];if(m&&!m.data&&m.spriteData){let x=m.spriteData;m.data=new i.R({width:x.width,height:x.height},x.context.getImageData(x.x,x.y,x.width,x.height).data),m.spriteData=null}return m}addImage(c,m){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,m)&&(this.images[c]=m)}_validate(c,m){let x=!0,v=m.data||m.spriteData;return this._validateStretch(m.stretchX,v&&v.width)||(this.fire(new i.j(new Error(`Image "${c}" has invalid "stretchX" value`))),x=!1),this._validateStretch(m.stretchY,v&&v.height)||(this.fire(new i.j(new Error(`Image "${c}" has invalid "stretchY" value`))),x=!1),this._validateContent(m.content,m)||(this.fire(new i.j(new Error(`Image "${c}" has invalid "content" value`))),x=!1),x}_validateStretch(c,m){if(!c)return!0;let x=0;for(let v of c){if(v[0]<x||v[1]<v[0]||m<v[1])return!1;x=v[1]}return!0}_validateContent(c,m){if(!c)return!0;if(c.length!==4)return!1;let x=m.spriteData,v=x&&x.width||m.data.width,S=x&&x.height||m.data.height;return!(c[0]<0||v<c[0]||c[1]<0||S<c[1]||c[2]<0||v<c[2]||c[3]<0||S<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,m,x=!0){let v=this.getImage(c);if(x&&(v.data.width!==m.data.width||v.data.height!==m.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${m.data.width}x${m.data.height}).`);m.version=v.version+1,this.images[c]=m,this.updatedImages[c]=!0}removeImage(c){let m=this.images[c];delete this.images[c],delete this.patterns[c],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,m){let x=!0;if(!this.isLoaded())for(let v of c)this.images[v]||(x=!1);this.isLoaded()||x?this._notify(c,m):this.requestors.push({ids:c,callback:m})}_notify(c,m){let x={};for(let v of c){let S=this.getImage(v);S||(this.fire(new i.k("styleimagemissing",{id:v})),S=this.getImage(v)),S?x[v]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:i.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,x)}getPixelSize(){let{width:c,height:m}=this.atlasImage;return{width:c,height:m}}getPattern(c){let m=this.patterns[c],x=this.getImage(c);if(!x)return null;if(m&&m.position.version===x.version)return m.position;if(m)m.position.version=x.version;else{let v={w:x.data.width+2,h:x.data.height+2,x:0,y:0},S=new i.I(v,x);this.patterns[c]={bin:v,position:S}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){let m=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new fe(c,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){let c=[];for(let S in this.patterns)c.push(this.patterns[S].bin);let{w:m,h:x}=i.p(c),v=this.atlasImage;v.resize({width:m||1,height:x||1});for(let S in this.patterns){let{bin:L}=this.patterns[S],F=L.x+1,Y=L.y+1,re=this.getImage(S).data,se=re.width,le=re.height;i.R.copy(re,v,{x:0,y:0},{x:F,y:Y},{width:se,height:le}),i.R.copy(re,v,{x:0,y:le-1},{x:F,y:Y-1},{width:se,height:1}),i.R.copy(re,v,{x:0,y:0},{x:F,y:Y+le},{width:se,height:1}),i.R.copy(re,v,{x:se-1,y:0},{x:F-1,y:Y},{width:1,height:le}),i.R.copy(re,v,{x:0,y:0},{x:F+se,y:Y},{width:1,height:le})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(let m of c){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;let x=this.getImage(m);x||i.w(`Image with ID: "${m}" was not found`),ye(x)&&this.updateImage(m,x)}}}let be=1e20;function je(M,c,m,x,v,S,L,F,Y){for(let re=c;re<c+x;re++)Re(M,m*S+re,S,v,L,F,Y);for(let re=m;re<m+v;re++)Re(M,re*S+c,1,x,L,F,Y)}function Re(M,c,m,x,v,S,L){S[0]=0,L[0]=-be,L[1]=be,v[0]=M[c];for(let F=1,Y=0,re=0;F<x;F++){v[F]=M[c+F*m];let se=F*F;do{let le=S[Y];re=(v[F]-v[le]+se-le*le)/(F-le)/2}while(re<=L[Y]&&--Y>-1);Y++,S[Y]=F,L[Y]=re,L[Y+1]=be}for(let F=0,Y=0;F<x;F++){for(;L[Y+1]<F;)Y++;let re=S[Y],se=F-re;M[c+F*m]=v[re]+se*se}}class Se{constructor(c,m){this.requestManager=c,this.localIdeographFontFamily=m,this.entries={}}setURL(c){this.url=c}getGlyphs(c,m){let x=[];for(let v in c)for(let S of c[v])x.push({stack:v,id:S});i.o(x,({stack:v,id:S},L)=>{let F=this.entries[v];F||(F=this.entries[v]={glyphs:{},requests:{},ranges:{}});let Y=F.glyphs[S];if(Y!==void 0)return void L(null,{stack:v,id:S,glyph:Y});if(Y=this._tinySDF(F,v,S),Y)return F.glyphs[S]=Y,void L(null,{stack:v,id:S,glyph:Y});let re=Math.floor(S/256);if(256*re>65535)return void L(new Error("glyphs > 65535 not supported"));if(F.ranges[re])return void L(null,{stack:v,id:S,glyph:Y});if(!this.url)return void L(new Error("glyphsUrl is not set"));let se=F.requests[re];se||(se=F.requests[re]=[],Se.loadGlyphRange(v,re,this.url,this.requestManager,(le,xe)=>{if(xe){for(let Ne in xe)this._doesCharSupportLocalGlyph(+Ne)||(F.glyphs[+Ne]=xe[+Ne]);F.ranges[re]=!0}for(let Ne of se)Ne(le,xe);delete F.requests[re]})),se.push((le,xe)=>{le?L(le):xe&&L(null,{stack:v,id:S,glyph:xe[S]||null})})},(v,S)=>{if(v)m(v);else if(S){let L={};for(let{stack:F,id:Y,glyph:re}of S)(L[F]||(L[F]={}))[Y]=re&&{id:re.id,bitmap:re.bitmap.clone(),metrics:re.metrics};m(null,L)}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&(i.u["CJK Unified Ideographs"](c)||i.u["Hangul Syllables"](c)||i.u.Hiragana(c)||i.u.Katakana(c))}_tinySDF(c,m,x){let v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(x))return;let S=c.tinySDF;if(!S){let F="400";/bold/i.test(m)?F="900":/medium/i.test(m)?F="500":/light/i.test(m)&&(F="200"),S=c.tinySDF=new Se.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:F})}let L=S.draw(String.fromCharCode(x));return{id:x,bitmap:new i.q({width:L.width||60,height:L.height||60},L.data),metrics:{width:L.glyphWidth/2||24,height:L.glyphHeight/2||24,left:L.glyphLeft/2+.5||0,top:L.glyphTop/2-27.5||-8,advance:L.glyphAdvance/2||24,isDoubleResolution:!0}}}}Se.loadGlyphRange=function(M,c,m,x,v){let S=256*c,L=S+255,F=x.transformRequest(m.replace("{fontstack}",M).replace("{range}",`${S}-${L}`),k.Glyphs);i.l(F,(Y,re)=>{if(Y)v(Y);else if(re){let se={};for(let le of i.n(re))se[le.id]=le;v(null,se)}})},Se.TinySDF=class{constructor({fontSize:M=24,buffer:c=3,radius:m=8,cutoff:x=.25,fontFamily:v="sans-serif",fontWeight:S="normal",fontStyle:L="normal"}={}){this.buffer=c,this.cutoff=x,this.radius=m;let F=this.size=M+4*c,Y=this._createCanvas(F),re=this.ctx=Y.getContext("2d",{willReadFrequently:!0});re.font=`${L} ${S} ${M}px ${v}`,re.textBaseline="alphabetic",re.textAlign="left",re.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Uint16Array(F)}_createCanvas(M){let c=document.createElement("canvas");return c.width=c.height=M,c}draw(M){let{width:c,actualBoundingBoxAscent:m,actualBoundingBoxDescent:x,actualBoundingBoxLeft:v,actualBoundingBoxRight:S}=this.ctx.measureText(M),L=Math.ceil(m),F=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-v))),Y=Math.min(this.size-this.buffer,L+Math.ceil(x)),re=F+2*this.buffer,se=Y+2*this.buffer,le=Math.max(re*se,0),xe=new Uint8ClampedArray(le),Ne={data:xe,width:re,height:se,glyphWidth:F,glyphHeight:Y,glyphTop:L,glyphLeft:0,glyphAdvance:c};if(F===0||Y===0)return Ne;let{ctx:De,buffer:Ze,gridInner:ze,gridOuter:nt}=this;De.clearRect(Ze,Ze,F,Y),De.fillText(M,Ze,Ze+L);let _t=De.getImageData(Ze,Ze,F,Y);nt.fill(be,0,le),ze.fill(0,0,le);for(let $e=0;$e<Y;$e++)for(let st=0;st<F;st++){let wt=_t.data[4*($e*F+st)+3]/255;if(wt===0)continue;let Mt=($e+Ze)*re+st+Ze;if(wt===1)nt[Mt]=0,ze[Mt]=be;else{let Pt=.5-wt;nt[Mt]=Pt>0?Pt*Pt:0,ze[Mt]=Pt<0?Pt*Pt:0}}je(nt,0,0,re,se,re,this.f,this.v,this.z),je(ze,Ze,Ze,F,Y,re,this.f,this.v,this.z);for(let $e=0;$e<le;$e++){let st=Math.sqrt(nt[$e])-Math.sqrt(ze[$e]);xe[$e]=Math.round(255-255*(st/this.radius+this.cutoff))}return Ne}};class Ue{constructor(){this.specification=i.v.light.position}possiblyEvaluate(c,m){return i.z(c.expression.evaluate(m))}interpolate(c,m,x){return{x:i.B.number(c.x,m.x,x),y:i.B.number(c.y,m.y,x),z:i.B.number(c.z,m.z,x)}}}let qe;class Je extends i.E{constructor(c){super(),qe=qe||new i.r({anchor:new i.D(i.v.light.anchor),position:new Ue,color:new i.D(i.v.light.color),intensity:new i.D(i.v.light.intensity)}),this._transitionable=new i.T(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,m={}){if(!this._validate(i.t,c,m))for(let x in c){let v=c[x];x.endsWith("-transition")?this._transitionable.setTransition(x.slice(0,-11),v):this._transitionable.setValue(x,v)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,m,x){return(!x||x.validate!==!1)&&i.x(this,c.call(i.y,i.e({value:m,style:{glyphs:!0,sprite:!0},styleSpec:i.v})))}}class gt{constructor(c,m){this.width=c,this.height=m,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,m){let x=c.join(",")+String(m);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(c,m)),this.dashEntry[x]}getDashRanges(c,m,x){let v=[],S=c.length%2==1?-c[c.length-1]*x:0,L=c[0]*x,F=!0;v.push({left:S,right:L,isDash:F,zeroLength:c[0]===0});let Y=c[0];for(let re=1;re<c.length;re++){F=!F;let se=c[re];S=Y*x,Y+=se,L=Y*x,v.push({left:S,right:L,isDash:F,zeroLength:se===0})}return v}addRoundDash(c,m,x){let v=m/2;for(let S=-x;S<=x;S++){let L=this.width*(this.nextRow+x+S),F=0,Y=c[F];for(let re=0;re<this.width;re++){re/Y.right>1&&(Y=c[++F]);let se=Math.abs(re-Y.left),le=Math.abs(re-Y.right),xe=Math.min(se,le),Ne,De=S/x*(v+1);if(Y.isDash){let Ze=v-Math.abs(De);Ne=Math.sqrt(xe*xe+Ze*Ze)}else Ne=v-Math.sqrt(xe*xe+De*De);this.data[L+re]=Math.max(0,Math.min(255,Ne+128))}}}addRegularDash(c){for(let F=c.length-1;F>=0;--F){let Y=c[F],re=c[F+1];Y.zeroLength?c.splice(F,1):re&&re.isDash===Y.isDash&&(re.left=Y.left,c.splice(F,1))}let m=c[0],x=c[c.length-1];m.isDash===x.isDash&&(m.left=x.left-this.width,x.right=m.right+this.width);let v=this.width*this.nextRow,S=0,L=c[S];for(let F=0;F<this.width;F++){F/L.right>1&&(L=c[++S]);let Y=Math.abs(F-L.left),re=Math.abs(F-L.right),se=Math.min(Y,re);this.data[v+F]=Math.max(0,Math.min(255,(L.isDash?se:-se)+128))}}addDash(c,m){let x=m?7:0,v=2*x+1;if(this.nextRow+v>this.height)return i.w("LineAtlas out of space"),null;let S=0;for(let F=0;F<c.length;F++)S+=c[F];if(S!==0){let F=this.width/S,Y=this.getDashRanges(c,this.width,F);m?this.addRoundDash(Y,F,x):this.addRegularDash(Y)}let L={y:(this.nextRow+x+.5)/this.height,height:2*x/this.height,width:S};return this.nextRow+=v,this.dirty=!0,L}bind(c){let m=c.gl;this.texture?(m.bindTexture(m.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,m.texSubImage2D(m.TEXTURE_2D,0,0,0,this.width,this.height,m.ALPHA,m.UNSIGNED_BYTE,this.data))):(this.texture=m.createTexture(),m.bindTexture(m.TEXTURE_2D,this.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texImage2D(m.TEXTURE_2D,0,m.ALPHA,this.width,this.height,0,m.ALPHA,m.UNSIGNED_BYTE,this.data))}}class rt{constructor(c,m,x){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=x;let v=this.workerPool.acquire(x);for(let S=0;S<v.length;S++){let L=new i.C(v[S],m,x);L.name=`Worker ${S}`,this.actors.push(L)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,m,x){i.o(this.actors,(v,S)=>{v.send(c,m,S)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(c=!0){this.actors.forEach(m=>{m.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}}function At(M,c,m){let x=function(v,S){if(v)return m(v);if(S){let L=i.F(i.e(S,M),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(L.vectorLayers=S.vector_layers,L.vectorLayerIds=L.vectorLayers.map(F=>F.id)),m(null,L)}};return M.url?i.f(c.transformRequest(M.url,k.Source),x):i.h.frame(()=>x(null,M))}class St{constructor(c,m){c&&(m?this.setSouthWest(c).setNorthEast(m):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof i.L?new i.L(c.lng,c.lat):i.L.convert(c),this}setSouthWest(c){return this._sw=c instanceof i.L?new i.L(c.lng,c.lat):i.L.convert(c),this}extend(c){let m=this._sw,x=this._ne,v,S;if(c instanceof i.L)v=c,S=c;else{if(!(c instanceof St))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(St.convert(c)):this.extend(i.L.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(i.L.convert(c)):this;if(v=c._sw,S=c._ne,!v||!S)return this}return m||x?(m.lng=Math.min(v.lng,m.lng),m.lat=Math.min(v.lat,m.lat),x.lng=Math.max(S.lng,x.lng),x.lat=Math.max(S.lat,x.lat)):(this._sw=new i.L(v.lng,v.lat),this._ne=new i.L(S.lng,S.lat)),this}getCenter(){return new i.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new i.L(this.getWest(),this.getNorth())}getSouthEast(){return new i.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){let{lng:m,lat:x}=i.L.convert(c),v=this._sw.lng<=m&&m<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=m&&m>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&v}static convert(c){return c instanceof St?c:c&&new St(c)}static fromLngLat(c,m=0){let x=360*m/40075017,v=x/Math.cos(Math.PI/180*c.lat);return new St(new i.L(c.lng-v,c.lat-x),new i.L(c.lng+v,c.lat+x))}}class kt{constructor(c,m,x){this.bounds=St.convert(this.validateBounds(c)),this.minzoom=m||0,this.maxzoom=x||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){let m=Math.pow(2,c.z),x=Math.floor(i.G(this.bounds.getWest())*m),v=Math.floor(i.H(this.bounds.getNorth())*m),S=Math.ceil(i.G(this.bounds.getEast())*m),L=Math.ceil(i.H(this.bounds.getSouth())*m);return c.x>=x&&c.x<S&&c.y>=v&&c.y<L}}class yt extends i.E{constructor(c,m,x,v){if(super(),this.load=()=>{this._loaded=!1,this.fire(new i.k("dataloading",{dataType:"source"})),this._tileJSONRequest=At(this._options,this.map._requestManager,(S,L)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),S?this.fire(new i.j(S)):L&&(i.e(this,L),L.bounds&&(this.tileBounds=new kt(L.bounds,this.minzoom,this.maxzoom)),this.fire(new i.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>i.e({},this._options),this.id=c,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.e(this,i.F(m,["url","scheme","tileSize","promoteId"])),this._options=i.e({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(c,m){let x=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v={request:this.map._requestManager.transformRequest(x,k.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function S(L,F){return delete c.request,c.aborted?m(null):L&&L.status!==404?m(L):(F&&F.resourceTiming&&(c.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&c.setExpiryData(F),c.loadVectorData(F,this.map.painter),m(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}v.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=m:c.request=c.actor.send("reloadTile",v,S.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",v,S.bind(this)))}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class tr extends i.E{constructor(c,m,x,v){super(),this.id=c,this.dispatcher=x,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.e({type:"raster"},m),i.e(this,i.F(m,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new i.k("dataloading",{dataType:"source"})),this._tileJSONRequest=At(this._options,this.map._requestManager,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new i.j(c)):m&&(i.e(this,m),m.bounds&&(this.tileBounds=new kt(m.bounds,this.minzoom,this.maxzoom)),this.fire(new i.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}serialize(){return i.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,m){let x=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.request=E.getImage(this.map._requestManager.transformRequest(x,k.Tile),(v,S,L)=>{if(delete c.request,c.aborted)c.state="unloaded",m(null);else if(v)c.state="errored",m(v);else if(S){this.map._refreshExpiredTiles&&L&&c.setExpiryData(L);let F=this.map.painter.context,Y=F.gl;c.texture=this.map.painter.getTileTexture(S.width),c.texture?c.texture.update(S,{useMipmap:!0}):(c.texture=new fe(F,S,Y.RGBA,{useMipmap:!0}),c.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),F.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),c.state="loaded",m(null)}},this.map._refreshExpiredTiles)}abortTile(c,m){c.request&&(c.request.cancel(),delete c.request),m()}unloadTile(c,m){c.texture&&this.map.painter.saveTileTexture(c.texture),m()}hasTransition(){return!1}}class vr extends tr{constructor(c,m,x,v){super(c,m,x,v),this.type="raster-dem",this.maxzoom=22,this._options=i.e({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox",this.redFactor=m.redFactor,this.greenFactor=m.greenFactor,this.blueFactor=m.blueFactor,this.baseShift=m.baseShift}loadTile(c,m){let x=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),v=this.map._requestManager.transformRequest(x,k.Tile);function S(L,F){L&&(c.state="errored",m(L)),F&&(c.dem=F,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded",m(null))}c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.request=E.getImage(v,(L,F,Y)=>i._(this,void 0,void 0,function*(){if(delete c.request,c.aborted)c.state="unloaded",m(null);else if(L)c.state="errored",m(L);else if(F){this.map._refreshExpiredTiles&&c.setExpiryData(Y);let re=i.a(F)&&i.J()?F:yield function(le){return i._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&i.K()){let xe=le.width+2,Ne=le.height+2;try{return new i.R({width:xe,height:Ne},yield i.M(le,-1,-1,xe,Ne))}catch{}}return i.h.getImageData(le,1)})}(F),se={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:re,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",se,S))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(c){let m=c.canonical,x=Math.pow(2,m.z),v=(m.x-1+x)%x,S=m.x===0?c.wrap-1:c.wrap,L=(m.x+1+x)%x,F=m.x+1===x?c.wrap+1:c.wrap,Y={};return Y[new i.O(c.overscaledZ,S,m.z,v,m.y).key]={backfilled:!1},Y[new i.O(c.overscaledZ,F,m.z,L,m.y).key]={backfilled:!1},m.y>0&&(Y[new i.O(c.overscaledZ,S,m.z,v,m.y-1).key]={backfilled:!1},Y[new i.O(c.overscaledZ,c.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},Y[new i.O(c.overscaledZ,F,m.z,L,m.y-1).key]={backfilled:!1}),m.y+1<x&&(Y[new i.O(c.overscaledZ,S,m.z,v,m.y+1).key]={backfilled:!1},Y[new i.O(c.overscaledZ,c.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},Y[new i.O(c.overscaledZ,F,m.z,L,m.y+1).key]={backfilled:!1}),Y}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})}}class wr extends i.E{constructor(c,m,x,v){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>i.e({},this._options,{type:this.type,data:this._data}),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=x.getActor(),this.setEventedParent(v),this._data=m.data,this._options=i.e({},m),this._collectResourceTiming=m.collectResourceTiming,m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;let S=i.N/this.tileSize;this.workerOptions=i.e({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*S,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*S,extent:i.N,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?m.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:i.N,radius:(m.clusterRadius||50)*S,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=c.clusterRadius),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},m),this}getClusterChildren(c,m){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},m),this}getClusterLeaves(c,m,x,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:m,offset:x},v),this}_updateWorkerData(c){let m=i.e({},this.workerOptions);c?m.dataDiff=c:typeof this._data=="string"?(m.request=this.map._requestManager.transformRequest(i.h.resolveURL(this._data),k.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new i.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,m,(x,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new i.k("dataabort",{dataType:"source"}));let S=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(S=v.resourceTiming[this.id].slice(0)),x)return void this.fire(new i.j(x));let L={dataType:"source"};this._collectResourceTiming&&S&&S.length>0&&i.e(L,{resourceTiming:S}),this.fire(new i.k("data",Object.assign(Object.assign({},L),{sourceDataType:"metadata"}))),this.fire(new i.k("data",Object.assign(Object.assign({},L),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(c,m){let x=c.actor?"reloadTile":"loadTile";c.actor=this.actor;let v={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.request=this.actor.send(x,v,(S,L)=>(delete c.request,c.unloadVectorData(),c.aborted?m(null):S?m(S):(c.loadVectorData(L,this.map.painter,x==="reloadTile"),m(null))))}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ir=i.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Br extends i.E{constructor(c,m,x,v){super(),this.load=(S,L)=>{this._loaded=!1,this.fire(new i.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=E.getImage(this.map._requestManager.transformRequest(this.url,k.Image),(F,Y)=>{this._request=null,this._loaded=!0,F?this.fire(new i.j(F)):Y&&(this.image=Y,S&&(this.coordinates=S),L&&L(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let S=this.map.painter.context,L=S.gl;this.boundsBuffer||(this.boundsBuffer=S.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=i.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new fe(S,this.image,L.RGBA),this.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE));let F=!1;for(let Y in this.tiles){let re=this.tiles[Y];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture,F=!0)}F&&this.fire(new i.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=c,this.dispatcher=x,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=m}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=c.url,this.load(c.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new i.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(c){this.coordinates=c;let m=c.map(i.U.fromLngLat);this.tileID=function(v){let S=1/0,L=1/0,F=-1/0,Y=-1/0;for(let xe of v)S=Math.min(S,xe.x),L=Math.min(L,xe.y),F=Math.max(F,xe.x),Y=Math.max(Y,xe.y);let re=Math.max(F-S,Y-L),se=Math.max(0,Math.floor(-Math.log(re)/Math.LN2)),le=Math.pow(2,se);return new i.W(se,Math.floor((S+F)/2*le),Math.floor((L+Y)/2*le))}(m),this.minzoom=this.maxzoom=this.tileID.z;let x=m.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new i.V,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,i.N,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,i.N),this._boundsArray.emplaceBack(x[2].x,x[2].y,i.N,i.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new i.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(c,m){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},m(null)):(c.state="errored",m(null))}hasTransition(){return!1}}class qt extends Br{constructor(c,m,x,v){super(c,m,x,v),this.load=()=>{this._loaded=!1;let S=this.options;this.urls=[];for(let L of S.urls)this.urls.push(this.map._requestManager.transformRequest(L,k.Source).url);i.X(this.urls,(L,F)=>{this._loaded=!0,L?this.fire(new i.j(L)):F&&(this.video=F,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let S=this.map.painter.context,L=S.gl;this.boundsBuffer||(this.boundsBuffer=S.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=i.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.texSubImage2D(L.TEXTURE_2D,0,0,0,L.RGBA,L.UNSIGNED_BYTE,this.video)):(this.texture=new fe(S,this.video,L.RGBA),this.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE));let F=!1;for(let Y in this.tiles){let re=this.tiles[Y];re.state!=="loaded"&&(re.state="loaded",re.texture=this.texture,F=!0)}F&&this.fire(new i.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=m}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){let m=this.video.seekable;c<m.start(0)||c>m.end(0)?this.fire(new i.j(new i.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${m.start(0)} and ${m.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Lr extends Br{constructor(c,m,x,v){super(c,m,x,v),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let S=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,S=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,S=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let L=this.map.painter.context,F=L.gl;this.boundsBuffer||(this.boundsBuffer=L.createVertexBuffer(this._boundsArray,Ir.members)),this.boundsSegments||(this.boundsSegments=i.S.simpleSegment(0,0,4,2)),this.texture?(S||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new fe(L,this.canvas,F.RGBA,{premultiply:!0});let Y=!1;for(let re in this.tiles){let se=this.tiles[re];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture,Y=!0)}Y&&this.fire(new i.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(L=>typeof L!="number"))||this.fire(new i.j(new i.Y(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.j(new i.Y(`sources.${c}`,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new i.j(new i.Y(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof HTMLCanvasElement||this.fire(new i.j(new i.Y(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.j(new i.Y(`sources.${c}`,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}let Yr={},Rt=M=>{switch(M){case"geojson":return wr;case"image":return Br;case"raster":return tr;case"raster-dem":return vr;case"vector":return yt;case"video":return qt;case"canvas":return Lr}return Yr[M]};function bn(M,c){let m=i.Z();return i.$(m,m,[1,1,0]),i.a0(m,m,[.5*M.width,.5*M.height,1]),i.a1(m,m,M.calculatePosMatrix(c.toUnwrapped()))}function tn(M,c,m,x,v,S){let L=function(le,xe,Ne){if(le)for(let De of le){let Ze=xe[De];if(Ze&&Ze.source===Ne&&Ze.type==="fill-extrusion")return!0}else for(let De in xe){let Ze=xe[De];if(Ze.source===Ne&&Ze.type==="fill-extrusion")return!0}return!1}(v&&v.layers,c,M.id),F=S.maxPitchScaleFactor(),Y=M.tilesIn(x,F,L);Y.sort(sr);let re=[];for(let le of Y)re.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(c,m,M._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,v,S,F,bn(M.transform,le.tileID))});let se=function(le){let xe={},Ne={};for(let De of le){let Ze=De.queryResults,ze=De.wrappedTileID,nt=Ne[ze]=Ne[ze]||{};for(let _t in Ze){let $e=Ze[_t],st=nt[_t]=nt[_t]||{},wt=xe[_t]=xe[_t]||[];for(let Mt of $e)st[Mt.featureIndex]||(st[Mt.featureIndex]=!0,wt.push(Mt))}}return xe}(re);for(let le in se)se[le].forEach(xe=>{let Ne=xe.feature,De=M.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=De});return se}function sr(M,c){let m=M.tileID,x=c.tileID;return m.overscaledZ-x.overscaledZ||m.canonical.y-x.canonical.y||m.wrap-x.wrap||m.canonical.x-x.canonical.x}class Rn{constructor(c,m){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=i.a2(),this.uses=0,this.tileSize=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){let m=c+this.timeAdded;m<this.fadeEndTime||(this.fadeEndTime=m)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,m,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(v,S){let L={};if(!S)return L;for(let F of v){let Y=F.layerIds.map(re=>S.getLayer(re)).filter(Boolean);if(Y.length!==0){F.layers=Y,F.stateDependentLayerIds&&(F.stateDependentLayers=F.stateDependentLayerIds.map(re=>Y.filter(se=>se.id===re)[0]));for(let re of Y)L[re.id]=F}}return L}(c.buckets,m.style),this.hasSymbolBuckets=!1;for(let v in this.buckets){let S=this.buckets[v];if(S instanceof i.a4){if(this.hasSymbolBuckets=!0,!x)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let v in this.buckets){let S=this.buckets[v];if(S instanceof i.a4&&S.hasRTLText){this.hasRTLText=!0,i.a5();break}}this.queryPadding=0;for(let v in this.buckets){let S=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,m.style.getLayer(v).queryRadius(S))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new i.a3}unloadVectorData(){for(let c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(let x in this.buckets){let v=this.buckets[x];v.uploadPending()&&v.upload(c)}let m=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new fe(c,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new fe(c,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,m,x,v,S,L,F,Y,re,se){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:S,scale:L,tileSize:this.tileSize,pixelPosMatrix:se,transform:Y,params:F,queryPadding:this.queryPadding*re},c,m,x):{}}querySourceFeatures(c,m){let x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;let v=x.loadVTLayers(),S=m&&m.sourceLayer?m.sourceLayer:"",L=v._geojsonTileLayer||v[S];if(!L)return;let F=i.a6(m&&m.filter),{z:Y,x:re,y:se}=this.tileID.canonical,le={z:Y,x:re,y:se};for(let xe=0;xe<L.length;xe++){let Ne=L.feature(xe);if(F.needGeometry){let ze=i.a7(Ne,!0);if(!F.filter(new i.a8(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!F.filter(new i.a8(this.tileID.overscaledZ),Ne))continue;let De=x.getId(Ne,S),Ze=new i.a9(Ne,Y,re,se,De);Ze.tile=le,c.push(Ze)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){let m=this.expirationTime;if(c.cacheControl){let x=i.aa(c.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){let x=Date.now(),v=!1;if(this.expirationTime>x)v=!1;else if(m)if(this.expirationTime<m)v=!0;else{let S=this.expirationTime-m;S?this.expirationTime=x+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,m){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;let x=this.latestFeatureIndex.loadVTLayers();for(let v in this.buckets){if(!m.style.hasLayer(v))continue;let S=this.buckets[v],L=S.layers[0].sourceLayer||"_geojsonTileLayer",F=x[L],Y=c[L];if(!F||!Y||Object.keys(Y).length===0)continue;S.update(Y,F,this.imageAtlas&&this.imageAtlas.patternPositions||{});let re=m&&m.style&&m.style.getLayer(v);re&&(this.queryPadding=Math.max(this.queryPadding,re.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=i.h.now()+c}setDependencies(c,m){let x={};for(let v of m)x[v]=!0;this.dependencies[c]=x}hasDependency(c,m){for(let x of c){let v=this.dependencies[x];if(v){for(let S of m)if(v[S])return!0}}return!1}}class dr{constructor(c,m){this.max=c,this.onRemove=m,this.reset()}reset(){for(let c in this.data)for(let m of this.data[c])m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value);return this.data={},this.order=[],this}add(c,m,x){let v=c.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);let S={value:m,timeout:void 0};if(x!==void 0&&(S.timeout=setTimeout(()=>{this.remove(c,S)},x)),this.data[v].push(S),this.order.push(v),this.order.length>this.max){let L=this._getAndRemoveByKey(this.order[0]);L&&this.onRemove(L)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){let m=this.data[c].shift();return m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),m.value}getByKey(c){let m=this.data[c];return m?m[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,m){if(!this.has(c))return this;let x=c.wrapped().key,v=m===void 0?0:this.data[x].indexOf(m),S=this.data[x][v];return this.data[x].splice(v,1),S.timeout&&clearTimeout(S.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(S.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){let m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}filter(c){let m=[];for(let x in this.data)for(let v of this.data[x])c(v.value)||m.push(v);for(let x of m)this.remove(x.value.tileID,x)}}class xt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,m,x){let v=String(m);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][v]=this.stateChanges[c][v]||{},i.e(this.stateChanges[c][v],x),this.deletedStates[c]===null){this.deletedStates[c]={};for(let S in this.state[c])S!==v&&(this.deletedStates[c][S]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][v]===null){this.deletedStates[c][v]={};for(let S in this.state[c][v])x[S]||(this.deletedStates[c][v][S]=null)}else for(let S in x)this.deletedStates[c]&&this.deletedStates[c][v]&&this.deletedStates[c][v][S]===null&&delete this.deletedStates[c][v][S]}removeFeatureState(c,m,x){if(this.deletedStates[c]===null)return;let v=String(m);if(this.deletedStates[c]=this.deletedStates[c]||{},x&&m!==void 0)this.deletedStates[c][v]!==null&&(this.deletedStates[c][v]=this.deletedStates[c][v]||{},this.deletedStates[c][v][x]=null);else if(m!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][v])for(x in this.deletedStates[c][v]={},this.stateChanges[c][v])this.deletedStates[c][v][x]=null;else this.deletedStates[c][v]=null;else this.deletedStates[c]=null}getState(c,m){let x=String(m),v=i.e({},(this.state[c]||{})[x],(this.stateChanges[c]||{})[x]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){let S=this.deletedStates[c][m];if(S===null)return{};for(let L in S)delete v[L]}return v}initializeTileState(c,m){c.setFeatureState(this.state,m)}coalesceChanges(c,m){let x={};for(let v in this.stateChanges){this.state[v]=this.state[v]||{};let S={};for(let L in this.stateChanges[v])this.state[v][L]||(this.state[v][L]={}),i.e(this.state[v][L],this.stateChanges[v][L]),S[L]=this.state[v][L];x[v]=S}for(let v in this.deletedStates){this.state[v]=this.state[v]||{};let S={};if(this.deletedStates[v]===null)for(let L in this.state[v])S[L]={},this.state[v][L]={};else for(let L in this.deletedStates[v]){if(this.deletedStates[v][L]===null)this.state[v][L]={};else for(let F of Object.keys(this.deletedStates[v][L]))delete this.state[v][L][F];S[L]=this.state[v][L]}x[v]=x[v]||{},i.e(x[v],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(let v in c)c[v].setFeatureState(x,m)}}class ei extends i.E{constructor(c,m,x){super(),this.id=c,this.dispatcher=x,this.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,S,L,F)=>{let Y=new(Rt(S.type))(v,S,L,F);if(Y.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${Y.id}`);return Y})(c,m,x,this),this._tiles={},this._cache=new dr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new xt,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let c in this._tiles){let m=this._tiles[c];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,m){return this._source.loadTile(c,m)}_unloadTile(c){if(this._source.unloadTile)return this._source.unloadTile(c,()=>{})}_abortTile(c){this._source.abortTile&&this._source.abortTile(c,()=>{}),this._source.fire(new i.k("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let m in this._tiles){let x=this._tiles[m];x.upload(c),x.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(Hr).map(c=>c.key)}getRenderableIds(c){let m=[];for(let x in this._tiles)this._isIdRenderable(x,c)&&m.push(this._tiles[x]);return c?m.sort((x,v)=>{let S=x.tileID,L=v.tileID,F=new i.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),Y=new i.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-L.overscaledZ||Y.y-F.y||Y.x-F.x}).map(x=>x.tileID.key):m.map(x=>x.tileID).sort(Hr).map(x=>x.key)}hasRenderableParent(c){let m=this.findLoadedParent(c,0);return!!m&&this._isIdRenderable(m.tileID.key)}_isIdRenderable(c,m){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(m||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(c,m){let x=this._tiles[c];x&&(x.state!=="loading"&&(x.state=m),this._loadTile(x,this._tileLoaded.bind(this,x,c,m)))}_tileLoaded(c,m,x,v){if(v)return c.state="errored",void(v.status!==404?this._source.fire(new i.j(v,{tile:c})):this.update(this.transform,this.terrain));c.timeAdded=i.h.now(),x==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(m,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new i.k("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){let m=this.getRenderableIds();for(let v=0;v<m.length;v++){let S=m[v];if(c.neighboringTiles&&c.neighboringTiles[S]){let L=this.getTileByID(S);x(c,L),x(L,c)}}function x(v,S){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let L=S.tileID.canonical.x-v.tileID.canonical.x,F=S.tileID.canonical.y-v.tileID.canonical.y,Y=Math.pow(2,v.tileID.canonical.z),re=S.tileID.key;L===0&&F===0||Math.abs(F)>1||(Math.abs(L)>1&&(Math.abs(L+Y)===1?L+=Y:Math.abs(L-Y)===1&&(L-=Y)),S.dem&&v.dem&&(v.dem.backfillBorder(S.dem,L,F),v.neighboringTiles&&v.neighboringTiles[re]&&(v.neighboringTiles[re].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,m,x,v){for(let S in this._tiles){let L=this._tiles[S];if(v[S]||!L.hasData()||L.tileID.overscaledZ<=m||L.tileID.overscaledZ>x)continue;let F=L.tileID;for(;L&&L.tileID.overscaledZ>m+1;){let re=L.tileID.scaledTo(L.tileID.overscaledZ-1);L=this._tiles[re.key],L&&L.hasData()&&(F=re)}let Y=F;for(;Y.overscaledZ>m;)if(Y=Y.scaledTo(Y.overscaledZ-1),c[Y.key]){v[F.key]=F;break}}}findLoadedParent(c,m){if(c.key in this._loadedParentTiles){let x=this._loadedParentTiles[c.key];return x&&x.tileID.overscaledZ>=m?x:null}for(let x=c.overscaledZ-1;x>=m;x--){let v=c.scaledTo(x),S=this._getLoadedTile(v);if(S)return S}}_getLoadedTile(c){let m=this._tiles[c.key];return m&&m.hasData()?m:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){let m=Math.ceil(c.width/this._source.tileSize)+1,x=Math.ceil(c.height/this._source.tileSize)+1,v=Math.floor(m*x*(this._maxTileCacheZoomLevels===null?i.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(c){let m=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,m){let x={};for(let v in this._tiles){let S=this._tiles[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+m),x[S.tileID.key]=S}this._tiles=x;for(let v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(let v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(c,m){if(this.transform=c,this.terrain=m,!this._sourceLoaded||this._paused)return;let x;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?x=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(se=>new i.O(se.canonical.z,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y)):(x=c.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:m}),this._source.hasTile&&(x=x.filter(se=>this._source.hasTile(se)))):x=[];let v=c.coveringZoomLevel(this._source),S=Math.max(v-ei.maxOverzooming,this._source.minzoom),L=Math.max(v+ei.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let se={};for(let le of x)if(le.canonical.z>this._source.minzoom){let xe=le.scaledTo(le.canonical.z-1);se[xe.key]=xe;let Ne=le.scaledTo(Math.max(this._source.minzoom,Math.min(le.canonical.z,5)));se[Ne.key]=Ne}x=x.concat(Object.values(se))}let F=x.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,F&&this.fire(new i.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let Y=this._updateRetainedTiles(x,v);if(Pn(this._source.type)){let se={},le={},xe=Object.keys(Y),Ne=i.h.now();for(let De of xe){let Ze=Y[De],ze=this._tiles[De];if(!ze||ze.fadeEndTime!==0&&ze.fadeEndTime<=Ne)continue;let nt=this.findLoadedParent(Ze,S);nt&&(this._addTile(nt.tileID),se[nt.tileID.key]=nt.tileID),le[De]=Ze}this._retainLoadedChildren(le,v,L,Y);for(let De in se)Y[De]||(this._coveredTiles[De]=!0,Y[De]=se[De]);if(m){let De={},Ze={};for(let ze of x)this._tiles[ze.key].hasData()?De[ze.key]=ze:Ze[ze.key]=ze;for(let ze in Ze){let nt=Ze[ze].children(this._source.maxzoom);this._tiles[nt[0].key]&&this._tiles[nt[1].key]&&this._tiles[nt[2].key]&&this._tiles[nt[3].key]&&(De[nt[0].key]=Y[nt[0].key]=nt[0],De[nt[1].key]=Y[nt[1].key]=nt[1],De[nt[2].key]=Y[nt[2].key]=nt[2],De[nt[3].key]=Y[nt[3].key]=nt[3],delete Ze[ze])}for(let ze in Ze){let nt=this.findLoadedParent(Ze[ze],this._source.minzoom);if(nt){De[nt.tileID.key]=Y[nt.tileID.key]=nt.tileID;for(let _t in De)De[_t].isChildOf(nt.tileID)&&delete De[_t]}}for(let ze in this._tiles)De[ze]||(this._coveredTiles[ze]=!0)}}for(let se in Y)this._tiles[se].clearFadeHold();let re=i.ab(this._tiles,Y);for(let se of re){let le=this._tiles[se];le.hasSymbolBuckets&&!le.holdingForFade()?le.setHoldDuration(this.map._fadeDuration):le.hasSymbolBuckets&&!le.symbolFadeFinished()||this._removeTile(se)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,m){let x={},v={},S=Math.max(m-ei.maxOverzooming,this._source.minzoom),L=Math.max(m+ei.maxUnderzooming,this._source.minzoom),F={};for(let Y of c){let re=this._addTile(Y);x[Y.key]=Y,re.hasData()||m<this._source.maxzoom&&(F[Y.key]=Y)}this._retainLoadedChildren(F,m,L,x);for(let Y of c){let re=this._tiles[Y.key];if(re.hasData())continue;if(m+1>this._source.maxzoom){let le=Y.children(this._source.maxzoom)[0],xe=this.getTile(le);if(xe&&xe.hasData()){x[le.key]=le;continue}}else{let le=Y.children(this._source.maxzoom);if(x[le[0].key]&&x[le[1].key]&&x[le[2].key]&&x[le[3].key])continue}let se=re.wasRequested();for(let le=Y.overscaledZ-1;le>=S;--le){let xe=Y.scaledTo(le);if(v[xe.key])break;if(v[xe.key]=!0,re=this.getTile(xe),!re&&se&&(re=this._addTile(xe)),re){let Ne=re.hasData();if((se||Ne)&&(x[xe.key]=xe),se=re.wasRequested(),Ne)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let c in this._tiles){let m=[],x,v=this._tiles[c].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){x=this._loadedParentTiles[v.key];break}m.push(v.key);let S=v.scaledTo(v.overscaledZ-1);if(x=this._getLoadedTile(S),x)break;v=S}for(let S of m)this._loadedParentTiles[S]=x}}_addTile(c){let m=this._tiles[c.key];if(m)return m;m=this._cache.getAndRemove(c),m&&(this._setTileReloadTimer(c.key,m),m.tileID=c,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,m)));let x=m;return m||(m=new Rn(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,c.key,m.state))),m.uses++,this._tiles[c.key]=m,x||this._source.fire(new i.k("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m}_setTileReloadTimer(c,m){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);let x=m.getExpiryTimeout();x&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},x))}_removeTile(c){let m=this._tiles[c];m&&(m.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,m,x){let v=[],S=this.transform;if(!S)return v;let L=x?S.getCameraQueryGeometry(c):c,F=c.map(De=>S.pointCoordinate(De,this.terrain)),Y=L.map(De=>S.pointCoordinate(De,this.terrain)),re=this.getIds(),se=1/0,le=1/0,xe=-1/0,Ne=-1/0;for(let De of Y)se=Math.min(se,De.x),le=Math.min(le,De.y),xe=Math.max(xe,De.x),Ne=Math.max(Ne,De.y);for(let De=0;De<re.length;De++){let Ze=this._tiles[re[De]];if(Ze.holdingForFade())continue;let ze=Ze.tileID,nt=Math.pow(2,S.zoom-Ze.tileID.overscaledZ),_t=m*Ze.queryPadding*i.N/Ze.tileSize/nt,$e=[ze.getTilePoint(new i.U(se,le)),ze.getTilePoint(new i.U(xe,Ne))];if($e[0].x-_t<i.N&&$e[0].y-_t<i.N&&$e[1].x+_t>=0&&$e[1].y+_t>=0){let st=F.map(Mt=>ze.getTilePoint(Mt)),wt=Y.map(Mt=>ze.getTilePoint(Mt));v.push({tile:Ze,tileID:ze,queryGeometry:st,cameraQueryGeometry:wt,scale:nt})}}return v}getVisibleCoordinates(c){let m=this.getRenderableIds(c).map(x=>this._tiles[x].tileID);for(let x of m)x.posMatrix=this.transform.calculatePosMatrix(x.toUnwrapped());return m}hasTransition(){if(this._source.hasTransition())return!0;if(Pn(this._source.type)){let c=i.h.now();for(let m in this._tiles)if(this._tiles[m].fadeEndTime>=c)return!0}return!1}setFeatureState(c,m,x){this._state.updateState(c=c||"_geojsonTileLayer",m,x)}removeFeatureState(c,m,x){this._state.removeFeatureState(c=c||"_geojsonTileLayer",m,x)}getFeatureState(c,m){return this._state.getState(c=c||"_geojsonTileLayer",m)}setDependencies(c,m,x){let v=this._tiles[c];v&&v.setDependencies(m,x)}reloadTilesForDependencies(c,m){for(let x in this._tiles)this._tiles[x].hasDependency(c,m)&&this._reloadTile(x,"reloading");this._cache.filter(x=>!x.hasDependency(c,m))}}function Hr(M,c){let m=Math.abs(2*M.wrap)-+(M.wrap<0),x=Math.abs(2*c.wrap)-+(c.wrap<0);return M.overscaledZ-c.overscaledZ||x-m||c.canonical.y-M.canonical.y||c.canonical.x-M.canonical.x}function Pn(M){return M==="raster"||M==="image"||M==="video"}ei.maxOverzooming=10,ei.maxUnderzooming=3;let gn="mapboxgl_preloaded_worker_pool";class No{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<No.workerCount;)this.workers.push(new Worker(i.c.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(m=>{m.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[gn]}numActive(){return Object.keys(this.active).length}}let bs=Math.floor(i.h.hardwareConcurrency/2),qo;function ba(){return qo||(qo=new No),qo}No.workerCount=i.ac(globalThis)?Math.max(Math.min(bs,3),1):1;class vs{constructor(c,m){this.reset(c,m)}reset(c,m){this.points=c||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=i.ad(c,0,1);let m=1,x=this._distances[m],v=c*this.paddedLength+this.padding;for(;x<v&&m<this._distances.length;)x=this._distances[++m];let S=m-1,L=this._distances[S],F=x-L,Y=F>0?(v-L)/F:0;return this.points[S].mult(1-Y).add(this.points[m].mult(Y))}}function zo(M,c){let m=!0;return M==="always"||M!=="never"&&c!=="never"||(m=!1),m}class Do{constructor(c,m,x){let v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/x),this.yCellCount=Math.ceil(m/x);for(let L=0;L<this.xCellCount*this.yCellCount;L++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=m,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,m,x,v,S){this._forEachCell(m,x,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(c,m,x,v){this._forEachCell(m-v,x-v,m+v,x+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(m),this.circles.push(x),this.circles.push(v)}_insertBoxCell(c,m,x,v,S,L){this.boxCells[S].push(L)}_insertCircleCell(c,m,x,v,S,L){this.circleCells[S].push(L)}_query(c,m,x,v,S,L,F){if(x<0||c>this.width||v<0||m>this.height)return[];let Y=[];if(c<=0&&m<=0&&this.width<=x&&this.height<=v){if(S)return[{key:null,x1:c,y1:m,x2:x,y2:v}];for(let re=0;re<this.boxKeys.length;re++)Y.push({key:this.boxKeys[re],x1:this.bboxes[4*re],y1:this.bboxes[4*re+1],x2:this.bboxes[4*re+2],y2:this.bboxes[4*re+3]});for(let re=0;re<this.circleKeys.length;re++){let se=this.circles[3*re],le=this.circles[3*re+1],xe=this.circles[3*re+2];Y.push({key:this.circleKeys[re],x1:se-xe,y1:le-xe,x2:se+xe,y2:le+xe})}}else this._forEachCell(c,m,x,v,this._queryCell,Y,{hitTest:S,overlapMode:L,seenUids:{box:{},circle:{}}},F);return Y}query(c,m,x,v){return this._query(c,m,x,v,!1,null)}hitTest(c,m,x,v,S,L){return this._query(c,m,x,v,!0,S,L).length>0}hitTestCircle(c,m,x,v,S){let L=c-x,F=c+x,Y=m-x,re=m+x;if(F<0||L>this.width||re<0||Y>this.height)return!1;let se=[];return this._forEachCell(L,Y,F,re,this._queryCellCircle,se,{hitTest:!0,overlapMode:v,circle:{x:c,y:m,radius:x},seenUids:{box:{},circle:{}}},S),se.length>0}_queryCell(c,m,x,v,S,L,F,Y){let{seenUids:re,hitTest:se,overlapMode:le}=F,xe=this.boxCells[S];if(xe!==null){let De=this.bboxes;for(let Ze of xe)if(!re.box[Ze]){re.box[Ze]=!0;let ze=4*Ze,nt=this.boxKeys[Ze];if(c<=De[ze+2]&&m<=De[ze+3]&&x>=De[ze+0]&&v>=De[ze+1]&&(!Y||Y(nt))&&(!se||!zo(le,nt.overlapMode))&&(L.push({key:nt,x1:De[ze],y1:De[ze+1],x2:De[ze+2],y2:De[ze+3]}),se))return!0}}let Ne=this.circleCells[S];if(Ne!==null){let De=this.circles;for(let Ze of Ne)if(!re.circle[Ze]){re.circle[Ze]=!0;let ze=3*Ze,nt=this.circleKeys[Ze];if(this._circleAndRectCollide(De[ze],De[ze+1],De[ze+2],c,m,x,v)&&(!Y||Y(nt))&&(!se||!zo(le,nt.overlapMode))){let _t=De[ze],$e=De[ze+1],st=De[ze+2];if(L.push({key:nt,x1:_t-st,y1:$e-st,x2:_t+st,y2:$e+st}),se)return!0}}}return!1}_queryCellCircle(c,m,x,v,S,L,F,Y){let{circle:re,seenUids:se,overlapMode:le}=F,xe=this.boxCells[S];if(xe!==null){let De=this.bboxes;for(let Ze of xe)if(!se.box[Ze]){se.box[Ze]=!0;let ze=4*Ze,nt=this.boxKeys[Ze];if(this._circleAndRectCollide(re.x,re.y,re.radius,De[ze+0],De[ze+1],De[ze+2],De[ze+3])&&(!Y||Y(nt))&&!zo(le,nt.overlapMode))return L.push(!0),!0}}let Ne=this.circleCells[S];if(Ne!==null){let De=this.circles;for(let Ze of Ne)if(!se.circle[Ze]){se.circle[Ze]=!0;let ze=3*Ze,nt=this.circleKeys[Ze];if(this._circlesCollide(De[ze],De[ze+1],De[ze+2],re.x,re.y,re.radius)&&(!Y||Y(nt))&&!zo(le,nt.overlapMode))return L.push(!0),!0}}}_forEachCell(c,m,x,v,S,L,F,Y){let re=this._convertToXCellCoord(c),se=this._convertToYCellCoord(m),le=this._convertToXCellCoord(x),xe=this._convertToYCellCoord(v);for(let Ne=re;Ne<=le;Ne++)for(let De=se;De<=xe;De++)if(S.call(this,c,m,x,v,this.xCellCount*De+Ne,L,F,Y))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,m,x,v,S,L){let F=v-c,Y=S-m,re=x+L;return re*re>F*F+Y*Y}_circleAndRectCollide(c,m,x,v,S,L,F){let Y=(L-v)/2,re=Math.abs(c-(v+Y));if(re>Y+x)return!1;let se=(F-S)/2,le=Math.abs(m-(S+se));if(le>se+x)return!1;if(re<=Y||le<=se)return!0;let xe=re-Y,Ne=le-se;return xe*xe+Ne*Ne<=x*x}}function Zt(M,c,m,x,v){let S=i.Z();return c?(i.a0(S,S,[1/v,1/v,1]),m||i.ae(S,S,x.angle)):i.a1(S,x.labelPlaneMatrix,M),S}function eo(M,c,m,x,v){if(c){let S=i.af(M);return i.a0(S,S,[v,v,1]),m||i.ae(S,S,-x.angle),S}return x.glCoordMatrix}function Xn(M,c,m){let x;m?(x=[M.x,M.y,m(M.x,M.y),1],i.ag(x,x,c)):(x=[M.x,M.y,0,1],Ve(x,x,c));let v=x[3];return{point:new i.P(x[0]/v,x[1]/v),signedDistanceFromCamera:v}}function ws(M,c){return .5+M/c*.5}function wo(M,c){let m=M[0]/M[3],x=M[1]/M[3];return m>=-c[0]&&m<=c[0]&&x>=-c[1]&&x<=c[1]}function Ht(M,c,m,x,v,S,L,F,Y,re){let se=x?M.textSizeData:M.iconSizeData,le=i.ah(se,m.transform.zoom),xe=[256/m.width*2+1,256/m.height*2+1],Ne=x?M.text.dynamicLayoutVertexArray:M.icon.dynamicLayoutVertexArray;Ne.clear();let De=M.lineVertexArray,Ze=x?M.text.placedSymbolArray:M.icon.placedSymbolArray,ze=m.transform.width/m.transform.height,nt=!1;for(let _t=0;_t<Ze.length;_t++){let $e=Ze.get(_t);if($e.hidden||$e.writingMode===i.ai.vertical&&!nt){ke($e.numGlyphs,Ne);continue}let st;if(nt=!1,re?(st=[$e.anchorX,$e.anchorY,re($e.anchorX,$e.anchorY),1],i.ag(st,st,c)):(st=[$e.anchorX,$e.anchorY,0,1],Ve(st,st,c)),!wo(st,xe)){ke($e.numGlyphs,Ne);continue}let wt=ws(m.transform.cameraToCenterDistance,st[3]),Mt=i.aj(se,le,$e),Pt=L?Mt/wt:Mt*wt,Vt=new i.P($e.anchorX,$e.anchorY),zt=Xn(Vt,v,re).point,Gt={projections:{},offsets:{}},Er=ji($e,Pt,!1,F,c,v,S,M.glyphOffsetArray,De,Ne,zt,Vt,Gt,ze,Y,re);nt=Er.useVertical,(Er.notEnoughRoom||nt||Er.needsFlipping&&ji($e,Pt,!0,F,c,v,S,M.glyphOffsetArray,De,Ne,zt,Vt,Gt,ze,Y,re).notEnoughRoom)&&ke($e.numGlyphs,Ne)}x?M.text.dynamicLayoutVertexBuffer.updateData(Ne):M.icon.dynamicLayoutVertexBuffer.updateData(Ne)}function $r(M,c,m,x,v,S,L,F,Y,re,se,le,xe){let Ne=F.glyphStartIndex+F.numGlyphs,De=F.lineStartIndex,Ze=F.lineStartIndex+F.lineLength,ze=c.getoffsetX(F.glyphStartIndex),nt=c.getoffsetX(Ne-1),_t=ue(M*ze,m,x,v,S,L,F.segment,De,Ze,Y,re,se,le,xe);if(!_t)return null;let $e=ue(M*nt,m,x,v,S,L,F.segment,De,Ze,Y,re,se,le,xe);return $e?{first:_t,last:$e}:null}function cr(M,c,m,x){return M===i.ai.horizontal&&Math.abs(m.y-c.y)>Math.abs(m.x-c.x)*x?{useVertical:!0}:(M===i.ai.vertical?c.y<m.y:c.x>m.x)?{needsFlipping:!0}:null}function ji(M,c,m,x,v,S,L,F,Y,re,se,le,xe,Ne,De,Ze){let ze=c/24,nt=M.lineOffsetX*ze,_t=M.lineOffsetY*ze,$e;if(M.numGlyphs>1){let st=M.glyphStartIndex+M.numGlyphs,wt=M.lineStartIndex,Mt=M.lineStartIndex+M.lineLength,Pt=$r(ze,F,nt,_t,m,se,le,M,Y,S,xe,De,Ze);if(!Pt)return{notEnoughRoom:!0};let Vt=Xn(Pt.first.point,L,Ze).point,zt=Xn(Pt.last.point,L,Ze).point;if(x&&!m){let Gt=cr(M.writingMode,Vt,zt,Ne);if(Gt)return Gt}$e=[Pt.first];for(let Gt=M.glyphStartIndex+1;Gt<st-1;Gt++)$e.push(ue(ze*F.getoffsetX(Gt),nt,_t,m,se,le,M.segment,wt,Mt,Y,S,xe,De,Ze));$e.push(Pt.last)}else{if(x&&!m){let wt=Xn(le,v,Ze).point,Mt=M.lineStartIndex+M.segment+1,Pt=new i.P(Y.getx(Mt),Y.gety(Mt)),Vt=Xn(Pt,v,Ze),zt=Vt.signedDistanceFromCamera>0?Vt.point:to(le,Pt,wt,1,v,Ze),Gt=cr(M.writingMode,wt,zt,Ne);if(Gt)return Gt}let st=ue(ze*F.getoffsetX(M.glyphStartIndex),nt,_t,m,se,le,M.segment,M.lineStartIndex,M.lineStartIndex+M.lineLength,Y,S,xe,De,Ze);if(!st)return{notEnoughRoom:!0};$e=[st]}for(let st of $e)i.ak(re,st.point,st.angle);return{}}function to(M,c,m,x,v,S){let L=Xn(M.add(M.sub(c)._unit()),v,S).point,F=m.sub(L);return m.add(F._mult(x/F.mag()))}function zr(M,c){let{projectionCache:m,lineVertexArray:x,labelPlaneMatrix:v,tileAnchorPoint:S,distanceFromAnchor:L,getElevation:F,previousVertex:Y,direction:re,absOffsetX:se}=c;if(m.projections[M])return m.projections[M];let le=new i.P(x.getx(M),x.gety(M)),xe=Xn(le,v,F);if(xe.signedDistanceFromCamera>0)return m.projections[M]=xe.point,xe.point;let Ne=M-re;return to(L===0?S:new i.P(x.getx(Ne),x.gety(Ne)),le,Y,se-L+1,v,F)}function Ao(M,c,m){return M._unit()._perp()._mult(c*m)}function Oe(M,c,m,x,v,S,L,F){let{projectionCache:Y,direction:re}=F;if(Y.offsets[M])return Y.offsets[M];let se=m.add(c);if(M+re<x||M+re>=v)return Y.offsets[M]=se,se;let le=zr(M+re,F),xe=Ao(le.sub(m),L,re),Ne=m.add(xe),De=le.add(xe);return Y.offsets[M]=i.al(S,se,Ne,De)||se,Y.offsets[M]}function ue(M,c,m,x,v,S,L,F,Y,re,se,le,xe,Ne){let De=x?M-c:M+c,Ze=De>0?1:-1,ze=0;x&&(Ze*=-1,ze=Math.PI),Ze<0&&(ze+=Math.PI);let nt,_t,$e=Ze>0?F+L:F+L+1,st=v,wt=v,Mt=0,Pt=0,Vt=Math.abs(De),zt=[],Gt;for(;Mt+Pt<=Vt;){if($e+=Ze,$e<F||$e>=Y)return null;Mt+=Pt,wt=st,_t=nt;let er={projectionCache:le,lineVertexArray:re,labelPlaneMatrix:se,tileAnchorPoint:S,distanceFromAnchor:Mt,getElevation:Ne,previousVertex:wt,direction:Ze,absOffsetX:Vt};if(st=zr($e,er),m===0)zt.push(wt),Gt=st.sub(wt);else{let I,O=st.sub(wt);I=O.mag()===0?Ao(zr($e+Ze,er).sub(st),m,Ze):Ao(O,m,Ze),_t||(_t=wt.add(I)),nt=Oe($e,I,st,F,Y,_t,m,er),zt.push(_t),Gt=nt.sub(_t)}Pt=Gt.mag()}let Er=Gt._mult((Vt-Mt)/Pt)._add(_t||wt),pn=ze+Math.atan2(st.y-wt.y,st.x-wt.x);return zt.push(Er),{point:Er,angle:xe?pn:0,path:zt}}let ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ke(M,c){for(let m=0;m<M;m++){let x=c.length;c.resize(x+4),c.float32.set(ge,3*x)}}function Ve(M,c,m){let x=c[0],v=c[1];return M[0]=m[0]*x+m[4]*v+m[12],M[1]=m[1]*x+m[5]*v+m[13],M[3]=m[3]*x+m[7]*v+m[15],M}let We=100;class G{constructor(c,m=new Do(c.width+200,c.height+200,25),x=new Do(c.width+200,c.height+200,25)){this.transform=c,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+We,this.screenBottomBoundary=c.height+We,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,m,x,v,S,L){let F=this.projectAndGetPerspectiveRatio(v,c.anchorPointX,c.anchorPointY,L),Y=x*F.perspectiveRatio,re=c.x1*Y+F.point.x,se=c.y1*Y+F.point.y,le=c.x2*Y+F.point.x,xe=c.y2*Y+F.point.y;return!this.isInsideGrid(re,se,le,xe)||m!=="always"&&this.grid.hitTest(re,se,le,xe,m,S)||F.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[re,se,le,xe],offscreen:this.isOffscreen(re,se,le,xe)}}placeCollisionCircles(c,m,x,v,S,L,F,Y,re,se,le,xe,Ne,De){let Ze=[],ze=new i.P(m.anchorX,m.anchorY),nt=Xn(ze,L,De),_t=ws(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),$e=(se?S/_t:S*_t)/i.ap,st=Xn(ze,F,De).point,wt=$r($e,v,m.lineOffsetX*$e,m.lineOffsetY*$e,!1,st,ze,m,x,F,{projections:{},offsets:{}},!1,De),Mt=!1,Pt=!1,Vt=!0;if(wt){let zt=.5*xe*_t+Ne,Gt=new i.P(-100,-100),Er=new i.P(this.screenRightBoundary,this.screenBottomBoundary),pn=new vs,er=wt.first,I=wt.last,O=[];for(let H=er.path.length-1;H>=1;H--)O.push(er.path[H]);for(let H=1;H<I.path.length;H++)O.push(I.path[H]);let z=2.5*zt;if(Y){let H=O.map(K=>Xn(K,Y,De));O=H.some(K=>K.signedDistanceFromCamera<=0)?[]:H.map(K=>K.point)}let Z=[];if(O.length>0){let H=O[0].clone(),K=O[0].clone();for(let B=1;B<O.length;B++)H.x=Math.min(H.x,O[B].x),H.y=Math.min(H.y,O[B].y),K.x=Math.max(K.x,O[B].x),K.y=Math.max(K.y,O[B].y);Z=H.x>=Gt.x&&K.x<=Er.x&&H.y>=Gt.y&&K.y<=Er.y?[O]:K.x<Gt.x||H.x>Er.x||K.y<Gt.y||H.y>Er.y?[]:i.am([O],Gt.x,Gt.y,Er.x,Er.y)}for(let H of Z){pn.reset(H,.25*zt);let K=0;K=pn.length<=.5*zt?1:Math.ceil(pn.paddedLength/z)+1;for(let B=0;B<K;B++){let q=B/Math.max(K-1,1),X=pn.lerp(q),ee=X.x+We,oe=X.y+We;Ze.push(ee,oe,zt,0);let pe=ee-zt,_e=oe-zt,Ce=ee+zt,Be=oe+zt;if(Vt=Vt&&this.isOffscreen(pe,_e,Ce,Be),Pt=Pt||this.isInsideGrid(pe,_e,Ce,Be),c!=="always"&&this.grid.hitTestCircle(ee,oe,zt,c,le)&&(Mt=!0,!re))return{circles:[],offscreen:!1,collisionDetected:Mt}}}}return{circles:!re&&Mt||!Pt||_t<this.perspectiveRatioCutoff?[]:Ze,offscreen:Vt,collisionDetected:Mt}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let m=[],x=1/0,v=1/0,S=-1/0,L=-1/0;for(let se of c){let le=new i.P(se.x+We,se.y+We);x=Math.min(x,le.x),v=Math.min(v,le.y),S=Math.max(S,le.x),L=Math.max(L,le.y),m.push(le)}let F=this.grid.query(x,v,S,L).concat(this.ignoredGrid.query(x,v,S,L)),Y={},re={};for(let se of F){let le=se.key;if(Y[le.bucketInstanceId]===void 0&&(Y[le.bucketInstanceId]={}),Y[le.bucketInstanceId][le.featureIndex])continue;let xe=[new i.P(se.x1,se.y1),new i.P(se.x2,se.y1),new i.P(se.x2,se.y2),new i.P(se.x1,se.y2)];i.an(m,xe)&&(Y[le.bucketInstanceId][le.featureIndex]=!0,re[le.bucketInstanceId]===void 0&&(re[le.bucketInstanceId]=[]),re[le.bucketInstanceId].push(le.featureIndex))}return re}insertCollisionBox(c,m,x,v,S,L){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:L,overlapMode:m},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,m,x,v,S,L){let F=x?this.ignoredGrid:this.grid,Y={bucketInstanceId:v,featureIndex:S,collisionGroupID:L,overlapMode:m};for(let re=0;re<c.length;re+=4)F.insertCircle(Y,c[re],c[re+1],c[re+2])}projectAndGetPerspectiveRatio(c,m,x,v){let S;return v?(S=[m,x,v(m,x),1],i.ag(S,S,c)):(S=[m,x,0,1],Ve(S,S,c)),{point:new i.P((S[0]/S[3]+1)/2*this.transform.width+We,(-S[1]/S[3]+1)/2*this.transform.height+We),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S[3]*.5}}isOffscreen(c,m,x,v){return x<We||c>=this.screenRightBoundary||v<We||m>this.screenBottomBoundary}isInsideGrid(c,m,x,v){return x>=0&&c<this.gridRightBoundary&&v>=0&&m<this.gridBottomBoundary}getViewportMatrix(){let c=i.ao([]);return i.$(c,c,[-100,-100,0]),c}}function te(M,c,m){return c*(i.N/(M.tileSize*Math.pow(2,m-M.tileID.overscaledZ)))}class Q{constructor(c,m,x,v){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?m:-m))):v&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class ae{constructor(c,m,x,v,S){this.text=new Q(c?c.text:null,m,x,S),this.icon=new Q(c?c.icon:null,m,v,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class he{constructor(c,m,x){this.text=c,this.icon=m,this.skipFade=x}}class we{constructor(){this.invProjMatrix=i.Z(),this.viewportMatrix=i.Z(),this.circles=[]}}class Ee{constructor(c,m,x,v,S){this.bucketInstanceId=c,this.featureIndex=m,this.sourceLayerIndex=x,this.bucketIndex=v,this.tileID=S}}class Xe{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){let m=++this.maxGroupID;this.collisionGroups[c]={ID:m,predicate:x=>x.collisionGroupID===m}}return this.collisionGroups[c]}}function ut(M,c,m,x,v){let{horizontalAlign:S,verticalAlign:L}=i.au(M);return new i.P(-(S-.5)*c+x[0]*v,-(L-.5)*m+x[1]*v)}function mt(M,c,m,x,v,S){let{x1:L,x2:F,y1:Y,y2:re,anchorPointX:se,anchorPointY:le}=M,xe=new i.P(c,m);return x&&xe._rotate(v?S:-S),{x1:L+xe.x,y1:Y+xe.y,x2:F+xe.x,y2:re+xe.y,anchorPointX:se,anchorPointY:le}}class Tt{constructor(c,m,x,v,S){this.transform=c.clone(),this.terrain=m,this.collisionIndex=new G(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new Xe(v),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,m,x,v){let S=x.getBucket(m),L=x.latestFeatureIndex;if(!S||!L||m.id!==S.layerIds[0])return;let F=x.collisionBoxArray,Y=S.layers[0].layout,re=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),se=x.tileSize/i.N,le=this.transform.calculatePosMatrix(x.tileID.toUnwrapped()),xe=Y.get("text-pitch-alignment")==="map",Ne=Y.get("text-rotation-alignment")==="map",De=te(x,1,this.transform.zoom),Ze=Zt(le,xe,Ne,this.transform,De),ze=null;if(xe){let _t=eo(le,xe,Ne,this.transform,De);ze=i.a1([],this.transform.labelPlaneMatrix,_t)}this.retainedQueryData[S.bucketInstanceId]=new Ee(S.bucketInstanceId,L,S.sourceLayerIndex,S.index,x.tileID);let nt={bucket:S,layout:Y,posMatrix:le,textLabelPlaneMatrix:Ze,labelToScreenMatrix:ze,scale:re,textPixelRatio:se,holdingForFade:x.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:i.ah(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(v)for(let _t of S.sortKeyRanges){let{sortKey:$e,symbolInstanceStart:st,symbolInstanceEnd:wt}=_t;c.push({sortKey:$e,symbolInstanceStart:st,symbolInstanceEnd:wt,parameters:nt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:nt})}attemptAnchorPlacement(c,m,x,v,S,L,F,Y,re,se,le,xe,Ne,De,Ze,ze){let nt=i.aq[c.textAnchor],_t=[c.textOffset0,c.textOffset1],$e=ut(nt,x,v,_t,S),st=this.collisionIndex.placeCollisionBox(mt(m,$e.x,$e.y,L,F,this.transform.angle),le,Y,re,se.predicate,ze);if((!Ze||this.collisionIndex.placeCollisionBox(mt(Ze,$e.x,$e.y,L,F,this.transform.angle),le,Y,re,se.predicate,ze).box.length!==0)&&st.box.length>0){let wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID]&&this.prevPlacement.placements[xe.crossTileID].text&&(wt=this.prevPlacement.variableOffsets[xe.crossTileID].anchor),xe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[xe.crossTileID]={textOffset:_t,width:x,height:v,anchor:nt,textBoxScale:S,prevAnchor:wt},this.markUsedJustification(Ne,nt,xe,De),Ne.allowVerticalPlacement&&(this.markUsedOrientation(Ne,De,xe),this.placedOrientations[xe.crossTileID]=De),{shift:$e,placedGlyphBoxes:st}}}placeLayerBucketPart(c,m,x){let{bucket:v,layout:S,posMatrix:L,textLabelPlaneMatrix:F,labelToScreenMatrix:Y,textPixelRatio:re,holdingForFade:se,collisionBoxArray:le,partiallyEvaluatedTextSize:xe,collisionGroup:Ne}=c.parameters,De=S.get("text-optional"),Ze=S.get("icon-optional"),ze=i.ar(S,"text-overlap","text-allow-overlap"),nt=ze==="always",_t=i.ar(S,"icon-overlap","icon-allow-overlap"),$e=_t==="always",st=S.get("text-rotation-alignment")==="map",wt=S.get("text-pitch-alignment")==="map",Mt=S.get("icon-text-fit")!=="none",Pt=S.get("symbol-z-order")==="viewport-y",Vt=nt&&($e||!v.hasIconData()||Ze),zt=$e&&(nt||!v.hasTextData()||De);!v.collisionArrays&&le&&v.deserializeCollisionBoxes(le);let Gt=this.retainedQueryData[v.bucketInstanceId].tileID,Er=this.terrain?(er,I)=>this.terrain.getElevation(Gt,er,I):null,pn=(er,I)=>{var O,z;if(m[er.crossTileID])return;if(se)return void(this.placements[er.crossTileID]=new he(!1,!1,!1));let Z=!1,H=!1,K=!0,B=null,q={box:null,offscreen:null},X={box:null,offscreen:null},ee=null,oe=null,pe=null,_e=0,Ce=0,Be=0;I.textFeatureIndex?_e=I.textFeatureIndex:er.useRuntimeCollisionCircles&&(_e=er.featureIndex),I.verticalTextFeatureIndex&&(Ce=I.verticalTextFeatureIndex);let Fe=I.textBox;if(Fe){let at=or=>{let br=i.ai.horizontal;if(v.allowVerticalPlacement&&!or&&this.prevPlacement){let yr=this.prevPlacement.placedOrientations[er.crossTileID];yr&&(this.placedOrientations[er.crossTileID]=yr,br=yr,this.markUsedOrientation(v,br,er))}return br},ot=(or,br)=>{if(v.allowVerticalPlacement&&er.numVerticalGlyphVertices>0&&I.verticalTextBox){for(let yr of v.writingModes)if(yr===i.ai.vertical?(q=br(),X=q):q=or(),q&&q.box&&q.box.length)break}else q=or()},dt=er.textAnchorOffsetStartIndex,Nt=er.textAnchorOffsetEndIndex;if(Nt===dt){let or=(br,yr)=>{let Zr=this.collisionIndex.placeCollisionBox(br,ze,re,L,Ne.predicate,Er);return Zr&&Zr.box&&Zr.box.length&&(this.markUsedOrientation(v,yr,er),this.placedOrientations[er.crossTileID]=yr),Zr};ot(()=>or(Fe,i.ai.horizontal),()=>{let br=I.verticalTextBox;return v.allowVerticalPlacement&&er.numVerticalGlyphVertices>0&&br?or(br,i.ai.vertical):{box:null,offscreen:null}}),at(q&&q.box&&q.box.length)}else{let or=i.aq[(z=(O=this.prevPlacement)===null||O===void 0?void 0:O.variableOffsets[er.crossTileID])===null||z===void 0?void 0:z.anchor],br=(Zr,Ti,So)=>{let Ks=Zr.x2-Zr.x1,tu=Zr.y2-Zr.y1,mm=er.textBoxScale,Ya=Mt&&_t==="never"?Ti:null,dn={box:[],offscreen:!1},Cs=ze==="never"?1:2,fi="never";or&&Cs++;for(let Di=0;Di<Cs;Di++){for(let co=dt;co<Nt;co++){let Vi=v.textAnchorOffsets.get(co);if(or&&Vi.textAnchor!==or)continue;let ro=this.attemptAnchorPlacement(Vi,Zr,Ks,tu,mm,st,wt,re,L,Ne,fi,er,v,So,Ya,Er);if(ro&&(dn=ro.placedGlyphBoxes,dn&&dn.box&&dn.box.length))return Z=!0,B=ro.shift,dn}or?or=null:fi=ze}return dn};ot(()=>br(Fe,I.iconBox,i.ai.horizontal),()=>{let Zr=I.verticalTextBox;return v.allowVerticalPlacement&&!(q&&q.box&&q.box.length)&&er.numVerticalGlyphVertices>0&&Zr?br(Zr,I.verticalIconBox,i.ai.vertical):{box:null,offscreen:null}}),q&&(Z=q.box,K=q.offscreen);let yr=at(q&&q.box);if(!Z&&this.prevPlacement){let Zr=this.prevPlacement.variableOffsets[er.crossTileID];Zr&&(this.variableOffsets[er.crossTileID]=Zr,this.markUsedJustification(v,Zr.anchor,er,yr))}}}if(ee=q,Z=ee&&ee.box&&ee.box.length>0,K=ee&&ee.offscreen,er.useRuntimeCollisionCircles){let at=v.text.placedSymbolArray.get(er.centerJustifiedTextSymbolIndex),ot=i.aj(v.textSizeData,xe,at),dt=S.get("text-padding");oe=this.collisionIndex.placeCollisionCircles(ze,at,v.lineVertexArray,v.glyphOffsetArray,ot,L,F,Y,x,wt,Ne.predicate,er.collisionCircleDiameter,dt,Er),oe.circles.length&&oe.collisionDetected&&!x&&i.w("Collisions detected, but collision boxes are not shown"),Z=nt||oe.circles.length>0&&!oe.collisionDetected,K=K&&oe.offscreen}if(I.iconFeatureIndex&&(Be=I.iconFeatureIndex),I.iconBox){let at=ot=>{let dt=Mt&&B?mt(ot,B.x,B.y,st,wt,this.transform.angle):ot;return this.collisionIndex.placeCollisionBox(dt,_t,re,L,Ne.predicate,Er)};X&&X.box&&X.box.length&&I.verticalIconBox?(pe=at(I.verticalIconBox),H=pe.box.length>0):(pe=at(I.iconBox),H=pe.box.length>0),K=K&&pe.offscreen}let Ge=De||er.numHorizontalGlyphVertices===0&&er.numVerticalGlyphVertices===0,it=Ze||er.numIconVertices===0;if(Ge||it?it?Ge||(H=H&&Z):Z=H&&Z:H=Z=H&&Z,Z&&ee&&ee.box&&this.collisionIndex.insertCollisionBox(ee.box,ze,S.get("text-ignore-placement"),v.bucketInstanceId,X&&X.box&&Ce?Ce:_e,Ne.ID),H&&pe&&this.collisionIndex.insertCollisionBox(pe.box,_t,S.get("icon-ignore-placement"),v.bucketInstanceId,Be,Ne.ID),oe&&(Z&&this.collisionIndex.insertCollisionCircles(oe.circles,ze,S.get("text-ignore-placement"),v.bucketInstanceId,_e,Ne.ID),x)){let at=v.bucketInstanceId,ot=this.collisionCircleArrays[at];ot===void 0&&(ot=this.collisionCircleArrays[at]=new we);for(let dt=0;dt<oe.circles.length;dt+=4)ot.circles.push(oe.circles[dt+0]),ot.circles.push(oe.circles[dt+1]),ot.circles.push(oe.circles[dt+2]),ot.circles.push(oe.collisionDetected?1:0)}if(er.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[er.crossTileID]=new he(Z||Vt,H||zt,K||v.justReloaded),m[er.crossTileID]=!0};if(Pt){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let er=v.getSortedSymbolIndexes(this.transform.angle);for(let I=er.length-1;I>=0;--I){let O=er[I];pn(v.symbolInstances.get(O),v.collisionArrays[O])}}else for(let er=c.symbolInstanceStart;er<c.symbolInstanceEnd;er++)pn(v.symbolInstances.get(er),v.collisionArrays[er]);if(x&&v.bucketInstanceId in this.collisionCircleArrays){let er=this.collisionCircleArrays[v.bucketInstanceId];i.as(er.invProjMatrix,L),er.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(c,m,x,v){let S;S=v===i.ai.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[i.at(m)];let L=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(let F of L)F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=S>=0&&F!==S?0:x.crossTileID)}markUsedOrientation(c,m,x){let v=m===i.ai.horizontal||m===i.ai.horizontalOnly?m:0,S=m===i.ai.vertical?m:0,L=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(let F of L)c.text.placedSymbolArray.get(F).placedOrientation=v;x.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;let m=this.prevPlacement,x=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;let v=m?m.symbolFadeChange(c):1,S=m?m.opacities:{},L=m?m.variableOffsets:{},F=m?m.placedOrientations:{};for(let Y in this.placements){let re=this.placements[Y],se=S[Y];se?(this.opacities[Y]=new ae(se,v,re.text,re.icon),x=x||re.text!==se.text.placed||re.icon!==se.icon.placed):(this.opacities[Y]=new ae(null,v,re.text,re.icon,re.skipFade),x=x||re.text||re.icon)}for(let Y in S){let re=S[Y];if(!this.opacities[Y]){let se=new ae(re,v,!1,!1);se.isHidden()||(this.opacities[Y]=se,x=x||re.text.placed||re.icon.placed)}}for(let Y in L)this.variableOffsets[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.variableOffsets[Y]=L[Y]);for(let Y in F)this.placedOrientations[Y]||!this.opacities[Y]||this.opacities[Y].isHidden()||(this.placedOrientations[Y]=F[Y]);if(m&&m.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");x?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:c)}updateLayerOpacities(c,m){let x={};for(let v of m){let S=v.getBucket(c);S&&v.latestFeatureIndex&&c.id===S.layerIds[0]&&this.updateBucketOpacities(S,x,v.collisionBoxArray)}}updateBucketOpacities(c,m,x){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();let v=c.layers[0],S=v.layout,L=new ae(null,0,!1,!1,!0),F=S.get("text-allow-overlap"),Y=S.get("icon-allow-overlap"),re=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),se=S.get("text-rotation-alignment")==="map",le=S.get("text-pitch-alignment")==="map",xe=S.get("icon-text-fit")!=="none",Ne=new ae(null,0,F&&(Y||!c.hasIconData()||S.get("icon-optional")),Y&&(F||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&x&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(x);let De=(Ze,ze,nt)=>{for(let _t=0;_t<ze/4;_t++)Ze.opacityVertexArray.emplaceBack(nt);Ze.hasVisibleVertices=Ze.hasVisibleVertices||nt!==un};for(let Ze=0;Ze<c.symbolInstances.length;Ze++){let ze=c.symbolInstances.get(Ze),{numHorizontalGlyphVertices:nt,numVerticalGlyphVertices:_t,crossTileID:$e}=ze,st=this.opacities[$e];m[$e]?st=L:st||(st=Ne,this.opacities[$e]=st),m[$e]=!0;let wt=ze.numIconVertices>0,Mt=this.placedOrientations[ze.crossTileID],Pt=Mt===i.ai.vertical,Vt=Mt===i.ai.horizontal||Mt===i.ai.horizontalOnly;if(nt>0||_t>0){let zt=pr(st.text);De(c.text,nt,Pt?un:zt),De(c.text,_t,Vt?un:zt);let Gt=st.text.isHidden();[ze.rightJustifiedTextSymbolIndex,ze.centerJustifiedTextSymbolIndex,ze.leftJustifiedTextSymbolIndex].forEach(er=>{er>=0&&(c.text.placedSymbolArray.get(er).hidden=Gt||Pt?1:0)}),ze.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(ze.verticalPlacedTextSymbolIndex).hidden=Gt||Vt?1:0);let Er=this.variableOffsets[ze.crossTileID];Er&&this.markUsedJustification(c,Er.anchor,ze,Mt);let pn=this.placedOrientations[ze.crossTileID];pn&&(this.markUsedJustification(c,"left",ze,pn),this.markUsedOrientation(c,pn,ze))}if(wt){let zt=pr(st.icon),Gt=!(xe&&ze.verticalPlacedIconSymbolIndex&&Pt);ze.placedIconSymbolIndex>=0&&(De(c.icon,ze.numIconVertices,Gt?zt:un),c.icon.placedSymbolArray.get(ze.placedIconSymbolIndex).hidden=st.icon.isHidden()),ze.verticalPlacedIconSymbolIndex>=0&&(De(c.icon,ze.numVerticalIconVertices,Gt?un:zt),c.icon.placedSymbolArray.get(ze.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){let zt=c.collisionArrays[Ze];if(zt){let Gt=new i.P(0,0);if(zt.textBox||zt.verticalTextBox){let pn=!0;if(re){let er=this.variableOffsets[$e];er?(Gt=ut(er.anchor,er.width,er.height,er.textOffset,er.textBoxScale),se&&Gt._rotate(le?this.transform.angle:-this.transform.angle)):pn=!1}zt.textBox&&jt(c.textCollisionBox.collisionVertexArray,st.text.placed,!pn||Pt,Gt.x,Gt.y),zt.verticalTextBox&&jt(c.textCollisionBox.collisionVertexArray,st.text.placed,!pn||Vt,Gt.x,Gt.y)}let Er=!!(!Vt&&zt.verticalIconBox);zt.iconBox&&jt(c.iconCollisionBox.collisionVertexArray,st.icon.placed,Er,xe?Gt.x:0,xe?Gt.y:0),zt.verticalIconBox&&jt(c.iconCollisionBox.collisionVertexArray,st.icon.placed,!Er,xe?Gt.x:0,xe?Gt.y:0)}}}if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);if(c.bucketInstanceId in this.collisionCircleArrays){let Ze=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Ze.invProjMatrix,c.placementViewportMatrix=Ze.viewportMatrix,c.collisionCircleArray=Ze.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,m){let x=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*x>c}setStale(){this.stale=!0}}function jt(M,c,m,x,v){M.emplaceBack(c?1:0,m?1:0,x||0,v||0),M.emplaceBack(c?1:0,m?1:0,x||0,v||0),M.emplaceBack(c?1:0,m?1:0,x||0,v||0),M.emplaceBack(c?1:0,m?1:0,x||0,v||0)}let Et=Math.pow(2,25),Ct=Math.pow(2,24),Dt=Math.pow(2,17),Lt=Math.pow(2,16),xr=Math.pow(2,9),Sr=Math.pow(2,8),ln=Math.pow(2,1);function pr(M){if(M.opacity===0&&!M.placed)return 0;if(M.opacity===1&&M.placed)return 4294967295;let c=M.placed?1:0,m=Math.floor(127*M.opacity);return m*Et+c*Ct+m*Dt+c*Lt+m*xr+c*Sr+m*ln+c}let un=0;class rn{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,m,x,v,S){let L=this._bucketParts;for(;this._currentTileIndex<c.length;)if(m.getBucketParts(L,v,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((F,Y)=>F.sortKey-Y.sortKey));this._currentPartIndex<L.length;)if(m.placeLayerBucketPart(L[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,S())return!0;return!1}}class en{constructor(c,m,x,v,S,L,F,Y){this.placement=new Tt(c,m,L,F,Y),this._currentPlacementIndex=x.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(c,m,x){let v=i.h.now(),S=()=>!this._forceFullPlacement&&i.h.now()-v>2;for(;this._currentPlacementIndex>=0;){let L=m[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=F)&&(!L.maxzoom||L.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new rn(L)),this._inProgressLayer.continuePlacement(x[L.source],this.placement,this._showCollisionBoxes,L,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}let Xr=512/i.N/2;class di{constructor(c,m,x){this.tileID=c,this.bucketInstanceId=x,this._symbolsByKey={};let v=new Map;for(let S=0;S<m.length;S++){let L=m.get(S),F=L.key,Y=v.get(F);Y?Y.push(L):v.set(F,[L])}for(let[S,L]of v){let F={positions:L.map(Y=>({x:Math.floor(Y.anchorX*Xr),y:Math.floor(Y.anchorY*Xr)})),crossTileIDs:L.map(Y=>Y.crossTileID)};if(F.positions.length>128){let Y=new i.av(F.positions.length,16,Uint16Array);for(let{x:re,y:se}of F.positions)Y.add(re,se);Y.finish(),delete F.positions,F.index=Y}this._symbolsByKey[S]=F}}getScaledCoordinates(c,m){let{x,y:v,z:S}=this.tileID.canonical,{x:L,y:F,z:Y}=m.canonical,re=Xr/Math.pow(2,Y-S),se=(F*i.N+c.anchorY)*re,le=v*i.N*Xr;return{x:Math.floor((L*i.N+c.anchorX)*re-x*i.N*Xr),y:Math.floor(se-le)}}findMatches(c,m,x){let v=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z);for(let S=0;S<c.length;S++){let L=c.get(S);if(L.crossTileID)continue;let F=this._symbolsByKey[L.key];if(!F)continue;let Y=this.getScaledCoordinates(L,m);if(F.index){let re=F.index.range(Y.x-v,Y.y-v,Y.x+v,Y.y+v).sort();for(let se of re){let le=F.crossTileIDs[se];if(!x[le]){x[le]=!0,L.crossTileID=le;break}}}else if(F.positions)for(let re=0;re<F.positions.length;re++){let se=F.positions[re],le=F.crossTileIDs[re];if(Math.abs(se.x-Y.x)<=v&&Math.abs(se.y-Y.y)<=v&&!x[le]){x[le]=!0,L.crossTileID=le;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:c})=>c)}}class It{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){let m=Math.round((c-this.lng)/360);if(m!==0)for(let x in this.indexes){let v=this.indexes[x],S={};for(let L in v){let F=v[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+m),S[F.tileID.key]=F}this.indexes[x]=S}this.lng=c}addBucket(c,m,x){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<m.symbolInstances.length;S++)m.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});let v=this.usedCrossTileIDs[c.overscaledZ];for(let S in this.indexes){let L=this.indexes[S];if(Number(S)>c.overscaledZ)for(let F in L){let Y=L[F];Y.tileID.isChildOf(c)&&Y.findMatches(m.symbolInstances,c,v)}else{let F=L[c.scaledTo(Number(S)).key];F&&F.findMatches(m.symbolInstances,c,v)}}for(let S=0;S<m.symbolInstances.length;S++){let L=m.symbolInstances.get(S);L.crossTileID||(L.crossTileID=x.generate(),v[L.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new di(c,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(c,m){for(let x of m.getCrossTileIDsLists())for(let v of x)delete this.usedCrossTileIDs[c][v]}removeStaleBuckets(c){let m=!1;for(let x in this.indexes){let v=this.indexes[x];for(let S in v)c[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,v[S]),delete v[S],m=!0)}return m}}class Ur{constructor(){this.layerIndexes={},this.crossTileIDs=new It,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,m,x){let v=this.layerIndexes[c.id];v===void 0&&(v=this.layerIndexes[c.id]=new fr);let S=!1,L={};v.handleWrapJump(x);for(let F of m){let Y=F.getBucket(c);Y&&c.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(F.tileID,Y,this.crossTileIDs)&&(S=!0),L[Y.bucketInstanceId]=!0)}return v.removeStaleBuckets(L)&&(S=!0),S}pruneUnusedLayers(c){let m={};c.forEach(x=>{m[x]=!0});for(let x in this.layerIndexes)m[x]||delete this.layerIndexes[x]}}let kr=(M,c)=>i.x(M,c&&c.filter(m=>m.identifier!=="source.canvas")),Pr=i.F(i.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),xn=i.F(i.ax,["setCenter","setZoom","setBearing","setPitch"]),on=i.aw();class qr extends i.E{constructor(c,m={}){super(),this.map=c,this.dispatcher=new rt(ba(),this,c._getMapId()),this.imageManager=new ve,this.imageManager.setEventedParent(this),this.glyphManager=new Se(c._requestManager,m.localIdeographFontFamily),this.lineAtlas=new gt(256,512),this.crossTileSymbolIndex=new Ur,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new i.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",i.az());let x=this;this._rtlTextPluginCallback=qr.registerForPluginStateChange(v=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(S,L)=>{if(i.aA(S),L&&L.every(F=>F))for(let F in x.sourceCaches){let Y=x.sourceCaches[F].getSource().type;Y!=="vector"&&Y!=="geojson"||x.sourceCaches[F].reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let S=this.sourceCaches[v.sourceId];if(!S)return;let L=S.getSource();if(L&&L.vectorLayerIds)for(let F in this._layers){let Y=this._layers[F];Y.source===L.id&&this._validateLayer(Y)}})}loadURL(c,m={},x){this.fire(new i.k("dataloading",{dataType:"style"})),m.validate=typeof m.validate!="boolean"||m.validate;let v=this.map._requestManager.transformRequest(c,k.Style);this._request=i.f(v,(S,L)=>{this._request=null,S?this.fire(new i.j(S)):L&&this._load(L,m,x)})}loadJSON(c,m={},x){this.fire(new i.k("dataloading",{dataType:"style"})),this._request=i.h.frame(()=>{this._request=null,m.validate=m.validate!==!1,this._load(c,m,x)})}loadEmpty(){this.fire(new i.k("dataloading",{dataType:"style"})),this._load(on,{validate:!1})}_load(c,m,x){var v;let S=m.transformStyle?m.transformStyle(x,c):c;if(!m.validate||!kr(this,i.y(S))){this._loaded=!0,this.stylesheet=S;for(let L in S.sources)this.addSource(L,S.sources[L],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Je(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new i.k("data",{dataType:"style"})),this.fire(new i.k("style.load"))}}_createLayers(){let c=i.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",c),this._order=c.map(m=>m.id),this._layers={},this._serializedLayers=null;for(let m of c){let x=i.aC(m);x.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=x}}_loadSprite(c,m=!1,x=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(v,S,L,F){let Y=ne(v),re=Y.length,se=L>1?"@2x":"",le={},xe={},Ne={};for(let{id:De,url:Ze}of Y){let ze=S.transformRequest(S.normalizeSpriteURL(Ze,se,".json"),k.SpriteJSON),nt=`${De}_${ze.url}`;le[nt]=i.f(ze,(st,wt)=>{delete le[nt],xe[De]=wt,de(F,xe,Ne,st,re)});let _t=S.transformRequest(S.normalizeSpriteURL(Ze,se,".png"),k.SpriteImage),$e=`${De}_${_t.url}`;le[$e]=E.getImage(_t,(st,wt)=>{delete le[$e],Ne[De]=wt,de(F,xe,Ne,st,re)})}return{cancel(){for(let De of Object.values(le))De.cancel()}}}(c,this.map._requestManager,this.map.getPixelRatio(),(v,S)=>{if(this._spriteRequest=null,v)this.fire(new i.j(v));else if(S)for(let L in S){this._spritesImagesIds[L]=[];let F=this._spritesImagesIds[L]?this._spritesImagesIds[L].filter(Y=>!(Y in S)):[];for(let Y of F)this.imageManager.removeImage(Y),this._changedImages[Y]=!0;for(let Y in S[L]){let re=L==="default"?Y:`${L}:${Y}`;this._spritesImagesIds[L].push(re),re in this.imageManager.images?this.imageManager.updateImage(re,S[L][Y],!1):this.imageManager.addImage(re,S[L][Y]),m&&(this._changedImages[re]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),m&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.k("data",{dataType:"style"})),x&&x(v)})}_unloadSprite(){for(let c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.k("data",{dataType:"style"}))}_validateLayer(c){let m=this.sourceCaches[c.source];if(!m)return;let x=c.sourceLayer;if(!x)return;let v=m.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(x)===-1)&&this.fire(new i.j(new Error(`Source layer "${x}" does not exist on source "${v.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c){let m=this._serializedAllLayers();if(!c||c.length===0)return Object.values(m);let x=[];for(let v of c)m[v]&&x.push(m[v]);return x}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};let m=Object.keys(this._layers);for(let x of m){let v=this._layers[x];v.type!=="custom"&&(c[x]=v.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(let c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;let m=this._changed;if(this._changed){let v=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(v.length||S.length)&&this._updateWorkerLayers(v,S);for(let L in this._updatedSources){let F=this._updatedSources[L];if(F==="reload")this._reloadSource(L);else{if(F!=="clear")throw new Error(`Invalid action ${F}`);this._clearSource(L)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let L in this._updatedPaintProps)this._layers[L].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}let x={};for(let v in this.sourceCaches){let S=this.sourceCaches[v];x[v]=S.used,S.used=!1}for(let v of this._order){let S=this._layers[v];S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(let v in x){let S=this.sourceCaches[v];x[v]!==S.used&&S.fire(new i.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(c),this.z=c.zoom,m&&this.fire(new i.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let c=Object.keys(this._changedImages);if(c.length){for(let m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(c),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c,m={}){this._checkLoaded();let x=this.serialize();if(c=m.transformStyle?m.transformStyle(x,c):c,kr(this,i.y(c)))return!1;(c=i.aD(c)).layers=i.aB(c.layers);let v=i.aE(x,c).filter(L=>!(L.command in xn));if(v.length===0)return!1;let S=v.filter(L=>!(L.command in Pr));if(S.length>0)throw new Error(`Unimplemented: ${S.map(L=>L.command).join(", ")}.`);for(let L of v)L.command!=="setTransition"&&this[L.command].apply(this,L.args);return this.stylesheet=c,this._serializedLayers=null,!0}addImage(c,m){if(this.getImage(c))return this.fire(new i.j(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,m),this._afterImageUpdated(c)}updateImage(c,m){this.imageManager.updateImage(c,m)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new i.j(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,m,x={}){if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(i.y.source,`sources.${c}`,m,null,x))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);let v=this.sourceCaches[c]=new ei(c,m,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:c})),v.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(let x in this._layers)if(this._layers[x].source===c)return this.fire(new i.j(new Error(`Source "${c}" cannot be removed while layer "${x}" is using it.`)));let m=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],m.fire(new i.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),m.setEventedParent(null),m.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,m){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);let x=this.sourceCaches[c].getSource();if(x.type!=="geojson")throw new Error(`geojsonSource.type is ${x.type}, which is !== 'geojson`);x.setData(m),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,m,x={}){this._checkLoaded();let v=c.id;if(this.getLayer(v))return void this.fire(new i.j(new Error(`Layer "${v}" already exists on this map.`)));let S;if(c.type==="custom"){if(kr(this,i.aF(c)))return;S=i.aC(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(v,c.source),c=i.aD(c),c=i.e(c,{source:v})),this._validate(i.y.layer,`layers.${v}`,c,{arrayIndex:-1},x))return;S=i.aC(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}let L=m?this._order.indexOf(m):this._order.length;if(m&&L===-1)this.fire(new i.j(new Error(`Cannot add layer "${v}" before non-existing layer "${m}".`)));else{if(this._order.splice(L,0,v),this._layerOrderChanged=!0,this._layers[v]=S,this._removedLayers[v]&&S.source&&S.type!=="custom"){let F=this._removedLayers[v];delete this._removedLayers[v],F.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(c,m){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new i.j(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===m)return;let x=this._order.indexOf(c);this._order.splice(x,1);let v=m?this._order.indexOf(m):this._order.length;m&&v===-1?this.fire(new i.j(new Error(`Cannot move layer "${c}" before non-existing layer "${m}".`))):(this._order.splice(v,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();let m=this._layers[c];if(!m)return void this.fire(new i.j(new Error(`Cannot remove non-existing layer "${c}".`)));m.setEventedParent(null);let x=this._order.indexOf(c);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=m,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],m.onRemove&&m.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,m,x){this._checkLoaded();let v=this.getLayer(c);v?v.minzoom===m&&v.maxzoom===x||(m!=null&&(v.minzoom=m),x!=null&&(v.maxzoom=x),this._updateLayer(v)):this.fire(new i.j(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,m,x={}){this._checkLoaded();let v=this.getLayer(c);if(v){if(!i.aG(v.filter,m))return m==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(i.y.filter,`layers.${v.id}.filter`,m,null,x)||(v.filter=i.aD(m),this._updateLayer(v)))}else this.fire(new i.j(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return i.aD(this.getLayer(c).filter)}setLayoutProperty(c,m,x,v={}){this._checkLoaded();let S=this.getLayer(c);S?i.aG(S.getLayoutProperty(m),x)||(S.setLayoutProperty(m,x,v),this._updateLayer(S)):this.fire(new i.j(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,m){let x=this.getLayer(c);if(x)return x.getLayoutProperty(m);this.fire(new i.j(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,m,x,v={}){this._checkLoaded();let S=this.getLayer(c);S?i.aG(S.getPaintProperty(m),x)||(S.setPaintProperty(m,x,v)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new i.j(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,m){return this.getLayer(c).getPaintProperty(m)}setFeatureState(c,m){this._checkLoaded();let x=c.source,v=c.sourceLayer,S=this.sourceCaches[x];if(S===void 0)return void this.fire(new i.j(new Error(`The source '${x}' does not exist in the map's style.`)));let L=S.getSource().type;L==="geojson"&&v?this.fire(new i.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||v?(c.id===void 0&&this.fire(new i.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(v,c.id,m)):this.fire(new i.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,m){this._checkLoaded();let x=c.source,v=this.sourceCaches[x];if(v===void 0)return void this.fire(new i.j(new Error(`The source '${x}' does not exist in the map's style.`)));let S=v.getSource().type,L=S==="vector"?c.sourceLayer:void 0;S!=="vector"||L?m&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new i.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(L,c.id,m):this.fire(new i.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();let m=c.source,x=c.sourceLayer,v=this.sourceCaches[m];if(v!==void 0)return v.getSource().type!=="vector"||x?(c.id===void 0&&this.fire(new i.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(x,c.id)):void this.fire(new i.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new i.j(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return i.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let c=i.aH(this.sourceCaches,S=>S.serialize()),m=this._serializeByIds(this._order),x=this.map.getTerrain()||void 0,v=this.stylesheet;return i.aI({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:c,layers:m,terrain:x},S=>S!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){let m=L=>this._layers[L].type==="fill-extrusion",x={},v=[];for(let L=this._order.length-1;L>=0;L--){let F=this._order[L];if(m(F)){x[F]=L;for(let Y of c){let re=Y[F];if(re)for(let se of re)v.push(se)}}}v.sort((L,F)=>F.intersectionZ-L.intersectionZ);let S=[];for(let L=this._order.length-1;L>=0;L--){let F=this._order[L];if(m(F))for(let Y=v.length-1;Y>=0;Y--){let re=v[Y].feature;if(x[re.layer.id]<L)break;S.push(re),v.pop()}else for(let Y of c){let re=Y[F];if(re)for(let se of re)S.push(se.feature)}}return S}queryRenderedFeatures(c,m,x){m&&m.filter&&this._validate(i.y.filter,"queryRenderedFeatures.filter",m.filter,null,m);let v={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new i.j(new Error("parameters.layers must be an Array."))),[];for(let F of m.layers){let Y=this._layers[F];if(!Y)return this.fire(new i.j(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];v[Y.source]=!0}}let S=[];m.availableImages=this._availableImages;let L=this._serializedAllLayers();for(let F in this.sourceCaches)m.layers&&!v[F]||S.push(tn(this.sourceCaches[F],this._layers,L,c,m,x));return this.placement&&S.push(function(F,Y,re,se,le,xe,Ne){let De={},Ze=xe.queryRenderedSymbols(se),ze=[];for(let nt of Object.keys(Ze).map(Number))ze.push(Ne[nt]);ze.sort(sr);for(let nt of ze){let _t=nt.featureIndex.lookupSymbolFeatures(Ze[nt.bucketInstanceId],Y,nt.bucketIndex,nt.sourceLayerIndex,le.filter,le.layers,le.availableImages,F);for(let $e in _t){let st=De[$e]=De[$e]||[],wt=_t[$e];wt.sort((Mt,Pt)=>{let Vt=nt.featureSortOrder;if(Vt){let zt=Vt.indexOf(Mt.featureIndex);return Vt.indexOf(Pt.featureIndex)-zt}return Pt.featureIndex-Mt.featureIndex});for(let Mt of wt)st.push(Mt)}}for(let nt in De)De[nt].forEach(_t=>{let $e=_t.feature,st=re[F[nt].source].getFeatureState($e.layer["source-layer"],$e.id);$e.source=$e.layer.source,$e.layer["source-layer"]&&($e.sourceLayer=$e.layer["source-layer"]),$e.state=st});return De}(this._layers,L,this.sourceCaches,c,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,m){m&&m.filter&&this._validate(i.y.filter,"querySourceFeatures.filter",m.filter,null,m);let x=this.sourceCaches[c];return x?function(v,S){let L=v.getRenderableIds().map(re=>v.getTileByID(re)),F=[],Y={};for(let re=0;re<L.length;re++){let se=L[re],le=se.tileID.canonical.key;Y[le]||(Y[le]=!0,se.querySourceFeatures(F,S))}return F}(x,m):[]}addSourceType(c,m,x){return Rt(c)?x(new Error(`A source type called "${c}" already exists.`)):(((v,S)=>{Yr[v]=S})(c,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:m.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(c,m={}){this._checkLoaded();let x=this.light.getLight(),v=!1;for(let L in c)if(!i.aG(c[L],x[L])){v=!0;break}if(!v)return;let S={now:i.h.now(),transition:i.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,m),this.light.updateTransitions(S)}_validate(c,m,x,v,S={}){return(!S||S.validate!==!1)&&kr(this,c.call(i.y,i.e({key:m,style:this.serialize(),value:x,styleSpec:i.v},v)))}_remove(c=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(let m in this._layers)this._layers[m].setEventedParent(null);for(let m in this.sourceCaches){let x=this.sourceCaches[m];x.setEventedParent(null),x.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(let m in this.sourceCaches)this.sourceCaches[m].update(c,this.map.terrain)}_generateCollisionBoxes(){for(let c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,m,x,v,S=!1){let L=!1,F=!1,Y={};for(let re of this._order){let se=this._layers[re];if(se.type!=="symbol")continue;if(!Y[se.source]){let xe=this.sourceCaches[se.source];Y[se.source]=xe.getRenderableIds(!0).map(Ne=>xe.getTileByID(Ne)).sort((Ne,De)=>De.tileID.overscaledZ-Ne.tileID.overscaledZ||(Ne.tileID.isLessThan(De.tileID)?-1:1))}let le=this.crossTileSymbolIndex.addLayer(se,Y[se.source],c.center.lng);L=L||le}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.h.now(),c.zoom))&&(this.pauseablePlacement=new en(c,this.map.terrain,this._order,S,m,x,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.h.now()),F=!0),L&&this.pauseablePlacement.placement.setStale()),F||L)for(let re of this._order){let se=this._layers[re];se.type==="symbol"&&this.placement.updateLayerOpacities(se,Y[se.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.h.now())}_releaseSymbolFadeTiles(){for(let c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,m,x){this.imageManager.getImages(m.icons,x),this._updateTilesForChangedImages();let v=this.sourceCaches[m.source];v&&v.setDependencies(m.tileID.key,m.type,m.icons)}getGlyphs(c,m,x){this.glyphManager.getGlyphs(m.stacks,x);let v=this.sourceCaches[m.source];v&&v.setDependencies(m.tileID.key,m.type,[""])}getResource(c,m,x){return i.m(m,x)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c,m={}){this._checkLoaded(),c&&this._validate(i.y.glyphs,"glyphs",c,null,m)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,m,x={},v){this._checkLoaded();let S=[{id:c,url:m}],L=[...ne(this.stylesheet.sprite),...S];this._validate(i.y.sprite,"sprite",L,null,x)||(this.stylesheet.sprite=L,this._loadSprite(S,!0,v))}removeSprite(c){this._checkLoaded();let m=ne(this.stylesheet.sprite);if(m.find(x=>x.id===c)){if(this._spritesImagesIds[c])for(let x of this._spritesImagesIds[c])this.imageManager.removeImage(x),this._changedImages[x]=!0;m.splice(m.findIndex(x=>x.id===c),1),this.stylesheet.sprite=m.length>0?m:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new i.k("data",{dataType:"style"}))}else this.fire(new i.j(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return ne(this.stylesheet.sprite)}setSprite(c,m={},x){this._checkLoaded(),c&&this._validate(i.y.sprite,"sprite",c,null,m)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,x):(this._unloadSprite(),x&&x(null)))}}qr.registerForPluginStateChange=i.aK;var Nn=i.Q([{name:"a_pos",type:"Int16",components:2}]),sn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let fn={prelude:Kr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Kr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Kr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Kr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Kr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Kr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Kr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Kr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Kr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",sn),terrainDepth:Kr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",sn),terrainCoords:Kr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",sn)};function Kr(M,c){let m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=c.match(/attribute ([\w]+) ([\w]+)/g),v=M.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=S?S.concat(v):v,F={};return{fragmentSource:M=M.replace(m,(Y,re,se,le,xe)=>(F[xe]=!0,re==="define"?`
#ifndef HAS_UNIFORM_u_${xe}
varying ${se} ${le} ${xe};
#else
uniform ${se} ${le} u_${xe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${xe}
    ${se} ${le} ${xe} = u_${xe};
#endif
`)),vertexSource:c=c.replace(m,(Y,re,se,le,xe)=>{let Ne=le==="float"?"vec2":"vec4",De=xe.match(/color/)?"color":Ne;return F[xe]?re==="define"?`
#ifndef HAS_UNIFORM_u_${xe}
uniform lowp float u_${xe}_t;
attribute ${se} ${Ne} a_${xe};
varying ${se} ${le} ${xe};
#else
uniform ${se} ${le} u_${xe};
#endif
`:De==="vec4"?`
#ifndef HAS_UNIFORM_u_${xe}
    ${xe} = a_${xe};
#else
    ${se} ${le} ${xe} = u_${xe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${xe}
    ${xe} = unpack_mix_${De}(a_${xe}, u_${xe}_t);
#else
    ${se} ${le} ${xe} = u_${xe};
#endif
`:re==="define"?`
#ifndef HAS_UNIFORM_u_${xe}
uniform lowp float u_${xe}_t;
attribute ${se} ${Ne} a_${xe};
#else
uniform ${se} ${le} u_${xe};
#endif
`:De==="vec4"?`
#ifndef HAS_UNIFORM_u_${xe}
    ${se} ${le} ${xe} = a_${xe};
#else
    ${se} ${le} ${xe} = u_${xe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${xe}
    ${se} ${le} ${xe} = unpack_mix_${De}(a_${xe}, u_${xe}_t);
#else
    ${se} ${le} ${xe} = u_${xe};
#endif
`}),staticAttributes:x,staticUniforms:L}}class lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,m,x,v,S,L,F,Y,re){this.context=c;let se=this.boundPaintVertexBuffers.length!==v.length;for(let le=0;!se&&le<v.length;le++)this.boundPaintVertexBuffers[le]!==v[le]&&(se=!0);!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==x||se||this.boundIndexBuffer!==S||this.boundVertexOffset!==L||this.boundDynamicVertexBuffer!==F||this.boundDynamicVertexBuffer2!==Y||this.boundDynamicVertexBuffer3!==re?this.freshBind(m,x,v,S,L,F,Y,re):(c.bindVertexArray.set(this.vao),F&&F.bind(),S&&S.dynamicDraw&&S.bind(),Y&&Y.bind(),re&&re.bind())}freshBind(c,m,x,v,S,L,F,Y){let re=c.numAttributes,se=this.context,le=se.gl;this.vao&&this.destroy(),this.vao=se.createVertexArray(),se.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=L,this.boundDynamicVertexBuffer2=F,this.boundDynamicVertexBuffer3=Y,m.enableAttributes(le,c);for(let xe of x)xe.enableAttributes(le,c);L&&L.enableAttributes(le,c),F&&F.enableAttributes(le,c),Y&&Y.enableAttributes(le,c),m.bind(),m.setVertexAttribPointers(le,c,S);for(let xe of x)xe.bind(),xe.setVertexAttribPointers(le,c,S);L&&(L.bind(),L.setVertexAttribPointers(le,c,S)),v&&v.bind(),F&&(F.bind(),F.setVertexAttribPointers(le,c,S)),Y&&(Y.bind(),Y.setVertexAttribPointers(le,c,S)),se.currentNumAttributes=re}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Bn(M){let c=[];for(let m=0;m<M.length;m++){if(M[m]===null)continue;let x=M[m].split(" ");c.push(x.pop())}return c}class vn{constructor(c,m,x,v,S,L){let F=c.gl;this.program=F.createProgram();let Y=Bn(m.staticAttributes),re=x?x.getBinderAttributes():[],se=Y.concat(re),le=fn.prelude.staticUniforms?Bn(fn.prelude.staticUniforms):[],xe=m.staticUniforms?Bn(m.staticUniforms):[],Ne=x?x.getBinderUniforms():[],De=le.concat(xe).concat(Ne),Ze=[];for(let Mt of De)Ze.indexOf(Mt)<0&&Ze.push(Mt);let ze=x?x.defines():[];S&&ze.push("#define OVERDRAW_INSPECTOR;"),L&&ze.push("#define TERRAIN3D;");let nt=ze.concat(fn.prelude.fragmentSource,m.fragmentSource).join(`
`),_t=ze.concat(fn.prelude.vertexSource,m.vertexSource).join(`
`),$e=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource($e,nt),F.compileShader($e),!F.getShaderParameter($e,F.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${F.getShaderInfoLog($e)}`);F.attachShader(this.program,$e);let st=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(st,_t),F.compileShader(st),!F.getShaderParameter(st,F.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${F.getShaderInfoLog(st)}`);F.attachShader(this.program,st),this.attributes={};let wt={};this.numAttributes=se.length;for(let Mt=0;Mt<this.numAttributes;Mt++)se[Mt]&&(F.bindAttribLocation(this.program,Mt,se[Mt]),this.attributes[se[Mt]]=Mt);if(F.linkProgram(this.program),!F.getProgramParameter(this.program,F.LINK_STATUS))throw new Error(`Program failed to link: ${F.getProgramInfoLog(this.program)}`);F.deleteShader(st),F.deleteShader($e);for(let Mt=0;Mt<Ze.length;Mt++){let Pt=Ze[Mt];if(Pt&&!wt[Pt]){let Vt=F.getUniformLocation(this.program,Pt);Vt&&(wt[Pt]=Vt)}}this.fixedUniforms=v(c,wt),this.terrainUniforms=((Mt,Pt)=>({u_depth:new i.aL(Mt,Pt.u_depth),u_terrain:new i.aL(Mt,Pt.u_terrain),u_terrain_dim:new i.aM(Mt,Pt.u_terrain_dim),u_terrain_matrix:new i.aN(Mt,Pt.u_terrain_matrix),u_terrain_unpack:new i.aO(Mt,Pt.u_terrain_unpack),u_terrain_exaggeration:new i.aM(Mt,Pt.u_terrain_exaggeration)}))(c,wt),this.binderUniforms=x?x.getUniforms(c,wt):[]}draw(c,m,x,v,S,L,F,Y,re,se,le,xe,Ne,De,Ze,ze,nt,_t){let $e=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(x),c.setStencilMode(v),c.setColorMode(S),c.setCullFace(L),Y){c.activeTexture.set($e.TEXTURE2),$e.bindTexture($e.TEXTURE_2D,Y.depthTexture),c.activeTexture.set($e.TEXTURE3),$e.bindTexture($e.TEXTURE_2D,Y.texture);for(let wt in this.terrainUniforms)this.terrainUniforms[wt].set(Y[wt])}for(let wt in this.fixedUniforms)this.fixedUniforms[wt].set(F[wt]);Ze&&Ze.setUniforms(c,this.binderUniforms,Ne,{zoom:De});let st=0;switch(m){case $e.LINES:st=2;break;case $e.TRIANGLES:st=3;break;case $e.LINE_STRIP:st=1}for(let wt of xe.get()){let Mt=wt.vaos||(wt.vaos={});(Mt[re]||(Mt[re]=new lo)).bind(c,this,se,Ze?Ze.getPaintVertexBuffers():[],le,wt.vertexOffset,ze,nt,_t),$e.drawElements(m,wt.primitiveLength*st,$e.UNSIGNED_SHORT,wt.primitiveOffset*st*2)}}}function Vn(M,c,m){let x=1/te(m,1,c.transform.tileZoom),v=Math.pow(2,m.tileID.overscaledZ),S=m.tileSize*Math.pow(2,c.transform.tileZoom)/v,L=S*(m.tileID.canonical.x+m.tileID.wrap*v),F=S*m.tileID.canonical.y;return{u_image:0,u_texsize:m.imageAtlasTexture.size,u_scale:[x,M.fromScale,M.toScale],u_fade:M.t,u_pixel_coord_upper:[L>>16,F>>16],u_pixel_coord_lower:[65535&L,65535&F]}}let Lo=(M,c,m,x)=>{let v=c.style.light,S=v.properties.get("position"),L=[S.x,S.y,S.z],F=function(){var re=new i.A(9);return i.A!=Float32Array&&(re[1]=0,re[2]=0,re[3]=0,re[5]=0,re[6]=0,re[7]=0),re[0]=1,re[4]=1,re[8]=1,re}();v.properties.get("anchor")==="viewport"&&function(re,se){var le=Math.sin(se),xe=Math.cos(se);re[0]=xe,re[1]=le,re[2]=0,re[3]=-le,re[4]=xe,re[5]=0,re[6]=0,re[7]=0,re[8]=1}(F,-c.transform.angle),function(re,se,le){var xe=se[0],Ne=se[1],De=se[2];re[0]=xe*le[0]+Ne*le[3]+De*le[6],re[1]=xe*le[1]+Ne*le[4]+De*le[7],re[2]=xe*le[2]+Ne*le[5]+De*le[8]}(L,L,F);let Y=v.properties.get("color");return{u_matrix:M,u_lightpos:L,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+m,u_opacity:x}},Ai=(M,c,m,x,v,S,L)=>i.e(Lo(M,c,m,x),Vn(S,c,L),{u_height_factor:-Math.pow(2,v.overscaledZ)/L.tileSize/8}),Ui=M=>({u_matrix:M}),As=(M,c,m,x)=>i.e(Ui(M),Vn(m,c,x)),Ms=(M,c)=>({u_matrix:M,u_world:c}),Ss=(M,c,m,x,v)=>i.e(As(M,c,m,x),{u_world:v}),Me=(M,c,m,x)=>{let v=M.transform,S,L;if(x.paint.get("circle-pitch-alignment")==="map"){let F=te(m,1,v.zoom);S=!0,L=[F,F]}else S=!1,L=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:M.translatePosMatrix(c.posMatrix,m,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:M.pixelRatio,u_extrude_scale:L}},Pe=(M,c,m)=>{let x=te(m,1,c.zoom),v=Math.pow(2,c.zoom-m.tileID.overscaledZ),S=m.tileID.overscaleFactor();return{u_matrix:M,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[c.pixelsToGLUnits[0]/(x*v),c.pixelsToGLUnits[1]/(x*v)],u_overscale_factor:S}},Ke=(M,c,m=1)=>({u_matrix:M,u_color:c,u_overlay:0,u_overlay_scale:m}),bt=M=>({u_matrix:M}),Ft=(M,c,m,x)=>({u_matrix:M,u_extrude_scale:te(c,1,m),u_intensity:x});function Xt(M,c){let m=Math.pow(2,c.canonical.z),x=c.canonical.y;return[new i.U(0,x/m).toLngLat().lat,new i.U(0,(x+1)/m).toLngLat().lat]}let hn=(M,c,m,x)=>{let v=M.transform;return{u_matrix:Mi(M,c,m,x),u_ratio:1/te(c,1,v.zoom),u_device_pixel_ratio:M.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},_n=(M,c,m,x,v)=>i.e(hn(M,c,m,v),{u_image:0,u_image_height:x}),Wn=(M,c,m,x,v)=>{let S=M.transform,L=Qr(c,S);return{u_matrix:Mi(M,c,m,v),u_texsize:c.imageAtlasTexture.size,u_ratio:1/te(c,1,S.zoom),u_device_pixel_ratio:M.pixelRatio,u_image:0,u_scale:[L,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Kn=(M,c,m,x,v,S)=>{let L=M.lineAtlas,F=Qr(c,M.transform),Y=m.layout.get("line-cap")==="round",re=L.getDash(x.from,Y),se=L.getDash(x.to,Y),le=re.width*v.fromScale,xe=se.width*v.toScale;return i.e(hn(M,c,m,S),{u_patternscale_a:[F/le,-re.height/2],u_patternscale_b:[F/xe,-se.height/2],u_sdfgamma:L.width/(256*Math.min(le,xe)*M.pixelRatio)/2,u_image:0,u_tex_y_a:re.y,u_tex_y_b:se.y,u_mix:v.t})};function Qr(M,c){return 1/te(M,1,c.tileZoom)}function Mi(M,c,m,x){return M.translatePosMatrix(x?x.posMatrix:c.tileID.posMatrix,c,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}let qi=(M,c,m,x,v)=>{return{u_matrix:M,u_tl_parent:c,u_scale_parent:m,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(L=v.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(S=v.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Ql(v.paint.get("raster-hue-rotate"))};var S,L};function Ql(M){M*=Math.PI/180;let c=Math.sin(M),m=Math.cos(M);return[(2*m+1)/3,(-Math.sqrt(3)*c-m+1)/3,(Math.sqrt(3)*c-m+1)/3]}let Ah=(M,c,m,x,v,S,L,F,Y,re)=>{let se=v.transform;return{u_is_size_zoom_constant:+(M==="constant"||M==="source"),u_is_size_feature_constant:+(M==="constant"||M==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_pitch:se.pitch/360*2*Math.PI,u_rotate_symbol:+m,u_aspect_ratio:se.width/se.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:L,u_coord_matrix:F,u_is_text:+Y,u_pitch_with_map:+x,u_texsize:re,u_texture:0}},Mh=(M,c,m,x,v,S,L,F,Y,re,se)=>{let le=v.transform;return i.e(Ah(M,c,m,x,v,S,L,F,Y,re),{u_gamma_scale:x?Math.cos(le._pitch)*le.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+se})},ul=(M,c,m,x,v,S,L,F,Y,re)=>i.e(Mh(M,c,m,x,v,S,L,F,!0,Y,!0),{u_texsize_icon:re,u_texture_icon:1}),$u=(M,c,m)=>({u_matrix:M,u_opacity:c,u_color:m}),cs=(M,c,m,x,v,S)=>i.e(function(L,F,Y,re){let se=Y.imageManager.getPattern(L.from.toString()),le=Y.imageManager.getPattern(L.to.toString()),{width:xe,height:Ne}=Y.imageManager.getPixelSize(),De=Math.pow(2,re.tileID.overscaledZ),Ze=re.tileSize*Math.pow(2,Y.transform.tileZoom)/De,ze=Ze*(re.tileID.canonical.x+re.tileID.wrap*De),nt=Ze*re.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:se.tl,u_pattern_br_a:se.br,u_pattern_tl_b:le.tl,u_pattern_br_b:le.br,u_texsize:[xe,Ne],u_mix:F.t,u_pattern_size_a:se.displaySize,u_pattern_size_b:le.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/te(re,1,Y.transform.tileZoom),u_pixel_coord_upper:[ze>>16,nt>>16],u_pixel_coord_lower:[65535&ze,65535&nt]}}(x,S,m,v),{u_matrix:M,u_opacity:c}),Qu={fillExtrusion:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_lightpos:new i.aP(M,c.u_lightpos),u_lightintensity:new i.aM(M,c.u_lightintensity),u_lightcolor:new i.aP(M,c.u_lightcolor),u_vertical_gradient:new i.aM(M,c.u_vertical_gradient),u_opacity:new i.aM(M,c.u_opacity)}),fillExtrusionPattern:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_lightpos:new i.aP(M,c.u_lightpos),u_lightintensity:new i.aM(M,c.u_lightintensity),u_lightcolor:new i.aP(M,c.u_lightcolor),u_vertical_gradient:new i.aM(M,c.u_vertical_gradient),u_height_factor:new i.aM(M,c.u_height_factor),u_image:new i.aL(M,c.u_image),u_texsize:new i.aQ(M,c.u_texsize),u_pixel_coord_upper:new i.aQ(M,c.u_pixel_coord_upper),u_pixel_coord_lower:new i.aQ(M,c.u_pixel_coord_lower),u_scale:new i.aP(M,c.u_scale),u_fade:new i.aM(M,c.u_fade),u_opacity:new i.aM(M,c.u_opacity)}),fill:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix)}),fillPattern:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_image:new i.aL(M,c.u_image),u_texsize:new i.aQ(M,c.u_texsize),u_pixel_coord_upper:new i.aQ(M,c.u_pixel_coord_upper),u_pixel_coord_lower:new i.aQ(M,c.u_pixel_coord_lower),u_scale:new i.aP(M,c.u_scale),u_fade:new i.aM(M,c.u_fade)}),fillOutline:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_world:new i.aQ(M,c.u_world)}),fillOutlinePattern:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_world:new i.aQ(M,c.u_world),u_image:new i.aL(M,c.u_image),u_texsize:new i.aQ(M,c.u_texsize),u_pixel_coord_upper:new i.aQ(M,c.u_pixel_coord_upper),u_pixel_coord_lower:new i.aQ(M,c.u_pixel_coord_lower),u_scale:new i.aP(M,c.u_scale),u_fade:new i.aM(M,c.u_fade)}),circle:(M,c)=>({u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_scale_with_map:new i.aL(M,c.u_scale_with_map),u_pitch_with_map:new i.aL(M,c.u_pitch_with_map),u_extrude_scale:new i.aQ(M,c.u_extrude_scale),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_matrix:new i.aN(M,c.u_matrix)}),collisionBox:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_pixels_to_tile_units:new i.aM(M,c.u_pixels_to_tile_units),u_extrude_scale:new i.aQ(M,c.u_extrude_scale),u_overscale_factor:new i.aM(M,c.u_overscale_factor)}),collisionCircle:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_inv_matrix:new i.aN(M,c.u_inv_matrix),u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_viewport_size:new i.aQ(M,c.u_viewport_size)}),debug:(M,c)=>({u_color:new i.aR(M,c.u_color),u_matrix:new i.aN(M,c.u_matrix),u_overlay:new i.aL(M,c.u_overlay),u_overlay_scale:new i.aM(M,c.u_overlay_scale)}),clippingMask:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix)}),heatmap:(M,c)=>({u_extrude_scale:new i.aM(M,c.u_extrude_scale),u_intensity:new i.aM(M,c.u_intensity),u_matrix:new i.aN(M,c.u_matrix)}),heatmapTexture:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_world:new i.aQ(M,c.u_world),u_image:new i.aL(M,c.u_image),u_color_ramp:new i.aL(M,c.u_color_ramp),u_opacity:new i.aM(M,c.u_opacity)}),hillshade:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_image:new i.aL(M,c.u_image),u_latrange:new i.aQ(M,c.u_latrange),u_light:new i.aQ(M,c.u_light),u_shadow:new i.aR(M,c.u_shadow),u_highlight:new i.aR(M,c.u_highlight),u_accent:new i.aR(M,c.u_accent)}),hillshadePrepare:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_image:new i.aL(M,c.u_image),u_dimension:new i.aQ(M,c.u_dimension),u_zoom:new i.aM(M,c.u_zoom),u_unpack:new i.aO(M,c.u_unpack)}),line:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_ratio:new i.aM(M,c.u_ratio),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_units_to_pixels:new i.aQ(M,c.u_units_to_pixels)}),lineGradient:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_ratio:new i.aM(M,c.u_ratio),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_units_to_pixels:new i.aQ(M,c.u_units_to_pixels),u_image:new i.aL(M,c.u_image),u_image_height:new i.aM(M,c.u_image_height)}),linePattern:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_texsize:new i.aQ(M,c.u_texsize),u_ratio:new i.aM(M,c.u_ratio),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_image:new i.aL(M,c.u_image),u_units_to_pixels:new i.aQ(M,c.u_units_to_pixels),u_scale:new i.aP(M,c.u_scale),u_fade:new i.aM(M,c.u_fade)}),lineSDF:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_ratio:new i.aM(M,c.u_ratio),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_units_to_pixels:new i.aQ(M,c.u_units_to_pixels),u_patternscale_a:new i.aQ(M,c.u_patternscale_a),u_patternscale_b:new i.aQ(M,c.u_patternscale_b),u_sdfgamma:new i.aM(M,c.u_sdfgamma),u_image:new i.aL(M,c.u_image),u_tex_y_a:new i.aM(M,c.u_tex_y_a),u_tex_y_b:new i.aM(M,c.u_tex_y_b),u_mix:new i.aM(M,c.u_mix)}),raster:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_tl_parent:new i.aQ(M,c.u_tl_parent),u_scale_parent:new i.aM(M,c.u_scale_parent),u_buffer_scale:new i.aM(M,c.u_buffer_scale),u_fade_t:new i.aM(M,c.u_fade_t),u_opacity:new i.aM(M,c.u_opacity),u_image0:new i.aL(M,c.u_image0),u_image1:new i.aL(M,c.u_image1),u_brightness_low:new i.aM(M,c.u_brightness_low),u_brightness_high:new i.aM(M,c.u_brightness_high),u_saturation_factor:new i.aM(M,c.u_saturation_factor),u_contrast_factor:new i.aM(M,c.u_contrast_factor),u_spin_weights:new i.aP(M,c.u_spin_weights)}),symbolIcon:(M,c)=>({u_is_size_zoom_constant:new i.aL(M,c.u_is_size_zoom_constant),u_is_size_feature_constant:new i.aL(M,c.u_is_size_feature_constant),u_size_t:new i.aM(M,c.u_size_t),u_size:new i.aM(M,c.u_size),u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_pitch:new i.aM(M,c.u_pitch),u_rotate_symbol:new i.aL(M,c.u_rotate_symbol),u_aspect_ratio:new i.aM(M,c.u_aspect_ratio),u_fade_change:new i.aM(M,c.u_fade_change),u_matrix:new i.aN(M,c.u_matrix),u_label_plane_matrix:new i.aN(M,c.u_label_plane_matrix),u_coord_matrix:new i.aN(M,c.u_coord_matrix),u_is_text:new i.aL(M,c.u_is_text),u_pitch_with_map:new i.aL(M,c.u_pitch_with_map),u_texsize:new i.aQ(M,c.u_texsize),u_texture:new i.aL(M,c.u_texture)}),symbolSDF:(M,c)=>({u_is_size_zoom_constant:new i.aL(M,c.u_is_size_zoom_constant),u_is_size_feature_constant:new i.aL(M,c.u_is_size_feature_constant),u_size_t:new i.aM(M,c.u_size_t),u_size:new i.aM(M,c.u_size),u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_pitch:new i.aM(M,c.u_pitch),u_rotate_symbol:new i.aL(M,c.u_rotate_symbol),u_aspect_ratio:new i.aM(M,c.u_aspect_ratio),u_fade_change:new i.aM(M,c.u_fade_change),u_matrix:new i.aN(M,c.u_matrix),u_label_plane_matrix:new i.aN(M,c.u_label_plane_matrix),u_coord_matrix:new i.aN(M,c.u_coord_matrix),u_is_text:new i.aL(M,c.u_is_text),u_pitch_with_map:new i.aL(M,c.u_pitch_with_map),u_texsize:new i.aQ(M,c.u_texsize),u_texture:new i.aL(M,c.u_texture),u_gamma_scale:new i.aM(M,c.u_gamma_scale),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_is_halo:new i.aL(M,c.u_is_halo)}),symbolTextAndIcon:(M,c)=>({u_is_size_zoom_constant:new i.aL(M,c.u_is_size_zoom_constant),u_is_size_feature_constant:new i.aL(M,c.u_is_size_feature_constant),u_size_t:new i.aM(M,c.u_size_t),u_size:new i.aM(M,c.u_size),u_camera_to_center_distance:new i.aM(M,c.u_camera_to_center_distance),u_pitch:new i.aM(M,c.u_pitch),u_rotate_symbol:new i.aL(M,c.u_rotate_symbol),u_aspect_ratio:new i.aM(M,c.u_aspect_ratio),u_fade_change:new i.aM(M,c.u_fade_change),u_matrix:new i.aN(M,c.u_matrix),u_label_plane_matrix:new i.aN(M,c.u_label_plane_matrix),u_coord_matrix:new i.aN(M,c.u_coord_matrix),u_is_text:new i.aL(M,c.u_is_text),u_pitch_with_map:new i.aL(M,c.u_pitch_with_map),u_texsize:new i.aQ(M,c.u_texsize),u_texsize_icon:new i.aQ(M,c.u_texsize_icon),u_texture:new i.aL(M,c.u_texture),u_texture_icon:new i.aL(M,c.u_texture_icon),u_gamma_scale:new i.aM(M,c.u_gamma_scale),u_device_pixel_ratio:new i.aM(M,c.u_device_pixel_ratio),u_is_halo:new i.aL(M,c.u_is_halo)}),background:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_opacity:new i.aM(M,c.u_opacity),u_color:new i.aR(M,c.u_color)}),backgroundPattern:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_opacity:new i.aM(M,c.u_opacity),u_image:new i.aL(M,c.u_image),u_pattern_tl_a:new i.aQ(M,c.u_pattern_tl_a),u_pattern_br_a:new i.aQ(M,c.u_pattern_br_a),u_pattern_tl_b:new i.aQ(M,c.u_pattern_tl_b),u_pattern_br_b:new i.aQ(M,c.u_pattern_br_b),u_texsize:new i.aQ(M,c.u_texsize),u_mix:new i.aM(M,c.u_mix),u_pattern_size_a:new i.aQ(M,c.u_pattern_size_a),u_pattern_size_b:new i.aQ(M,c.u_pattern_size_b),u_scale_a:new i.aM(M,c.u_scale_a),u_scale_b:new i.aM(M,c.u_scale_b),u_pixel_coord_upper:new i.aQ(M,c.u_pixel_coord_upper),u_pixel_coord_lower:new i.aQ(M,c.u_pixel_coord_lower),u_tile_units_to_pixels:new i.aM(M,c.u_tile_units_to_pixels)}),terrain:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_texture:new i.aL(M,c.u_texture),u_ele_delta:new i.aM(M,c.u_ele_delta)}),terrainDepth:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_ele_delta:new i.aM(M,c.u_ele_delta)}),terrainCoords:(M,c)=>({u_matrix:new i.aN(M,c.u_matrix),u_texture:new i.aL(M,c.u_texture),u_terrain_coords_id:new i.aM(M,c.u_terrain_coords_id),u_ele_delta:new i.aM(M,c.u_ele_delta)})};class Ju{constructor(c,m,x){this.context=c;let v=c.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){let m=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Vc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ef{constructor(c,m,x,v){this.length=m.length,this.attributes=x,this.itemSize=m.bytesPerElement,this.dynamicDraw=v,this.context=c;let S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);let m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,m){for(let x=0;x<this.attributes.length;x++){let v=m.attributes[this.attributes[x].name];v!==void 0&&c.enableVertexAttribArray(v)}}setVertexAttribPointers(c,m,x){for(let v=0;v<this.attributes.length;v++){let S=this.attributes[v],L=m.attributes[S.name];L!==void 0&&c.vertexAttribPointer(L,S.components,c[Vc[S.type]],!1,this.itemSize,S.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Jl=new WeakMap;function Fa(M){var c;if(Jl.has(M))return Jl.get(M);{let m=(c=M.getParameter(M.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return Jl.set(M,m),m}}class Sn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tf extends Sn{getDefault(){return i.aT.transparent}set(c){let m=this.current;(c.r!==m.r||c.g!==m.g||c.b!==m.b||c.a!==m.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Go extends Sn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ho extends Sn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Sh extends Sn{getDefault(){return[!0,!0,!0,!0]}set(c){let m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||c[3]!==m[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class rf extends Sn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class nf extends Sn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Th extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){let m=this.current;(c.func!==m.func||c.ref!==m.ref||c.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Eh extends Sn{getDefault(){let c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){let m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class of extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;c?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=c,this.dirty=!1}}class Ih extends Sn{getDefault(){return[0,1]}set(c){let m=this.current;(c[0]!==m[0]||c[1]!==m[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class Ch extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;c?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=c,this.dirty=!1}}class sf extends Sn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Up extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;c?m.enable(m.BLEND):m.disable(m.BLEND),this.current=c,this.dirty=!1}}class Vp extends Sn{getDefault(){let c=this.gl;return[c.ONE,c.ZERO]}set(c){let m=this.current;(c[0]!==m[0]||c[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class ec extends Sn{getDefault(){return i.aT.transparent}set(c){let m=this.current;(c.r!==m.r||c.g!==m.g||c.b!==m.b||c.a!==m.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class g_ extends Sn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class __ extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;c?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=c,this.dirty=!1}}class Ox extends Sn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Ln extends Sn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class Wp extends Sn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class y_ extends Sn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Wc extends Sn{getDefault(){let c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){let m=this.current;(c[0]!==m[0]||c[1]!==m[1]||c[2]!==m[2]||c[3]!==m[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class kh extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Ph extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class yn extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.bindTexture(m.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Gr extends Sn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Zp extends Sn{getDefault(){return null}set(c){let m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Yp extends Sn{getDefault(){return null}set(c){var m;if(c===this.current&&!this.dirty)return;let x=this.gl;Fa(x)?x.bindVertexArray(c):(m=x.getExtension("OES_vertex_array_object"))===null||m===void 0||m.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class Oh extends Sn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Gs extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class fl extends Sn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;let m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Ba extends Sn{constructor(c,m){super(c),this.context=c,this.parent=m}getDefault(){return null}}class Zc extends Ba{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class qp extends Ba{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Gp extends Ba{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Fn{constructor(c,m,x,v,S){this.context=c,this.width=m,this.height=x;let L=c.gl,F=this.framebuffer=L.createFramebuffer();if(this.colorAttachment=new Zc(c,F),v)this.depthAttachment=S?new Gp(c,F):new qp(c,F);else if(S)throw new Error("Stencil cannot be setted without depth");if(L.checkFramebufferStatus(L.FRAMEBUFFER)!==L.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let c=this.context.gl,m=this.colorAttachment.get();if(m&&c.deleteTexture(m),this.depthAttachment){let x=this.depthAttachment.get();x&&c.deleteRenderbuffer(x)}c.deleteFramebuffer(this.framebuffer)}}class pi{constructor(c,m,x){this.blendFunction=c,this.blendColor=m,this.mask=x}}pi.Replace=[1,0],pi.disabled=new pi(pi.Replace,i.aT.transparent,[!1,!1,!1,!1]),pi.unblended=new pi(pi.Replace,i.aT.transparent,[!0,!0,!0,!0]),pi.alphaBlended=new pi([1,771],i.aT.transparent,[!0,!0,!0,!0]);class x_{constructor(c){var m,x;if(this.gl=c,this.clearColor=new tf(this),this.clearDepth=new Go(this),this.clearStencil=new Ho(this),this.colorMask=new Sh(this),this.depthMask=new rf(this),this.stencilMask=new nf(this),this.stencilFunc=new Th(this),this.stencilOp=new Eh(this),this.stencilTest=new of(this),this.depthRange=new Ih(this),this.depthTest=new Ch(this),this.depthFunc=new sf(this),this.blend=new Up(this),this.blendFunc=new Vp(this),this.blendColor=new ec(this),this.blendEquation=new g_(this),this.cullFace=new __(this),this.cullFaceSide=new Ox(this),this.frontFace=new Ln(this),this.program=new Wp(this),this.activeTexture=new y_(this),this.viewport=new Wc(this),this.bindFramebuffer=new kh(this),this.bindRenderbuffer=new Ph(this),this.bindTexture=new yn(this),this.bindVertexBuffer=new Gr(this),this.bindElementBuffer=new Zp(this),this.bindVertexArray=new Yp(this),this.pixelStoreUnpack=new Oh(this),this.pixelStoreUnpackPremultiplyAlpha=new Gs(this),this.pixelStoreUnpackFlipY=new fl(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),Fa(c)){this.HALF_FLOAT=c.HALF_FLOAT;let v=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(m=c.RGBA16F)!==null&&m!==void 0?m:v?.RGBA16F_EXT,this.RGB16F=(x=c.RGB16F)!==null&&x!==void 0?x:v?.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");let v=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,m){return new Ju(this,c,m)}createVertexBuffer(c,m,x){return new ef(this,c,m,x)}createRenderbuffer(c,m,x){let v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,c,m,x),this.bindRenderbuffer.set(null),S}createFramebuffer(c,m,x,v){return new Fn(this,c,m,x,v)}clear({color:c,depth:m,stencil:x}){let v=this.gl,S=0;c&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),x!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),v.clear(S)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){i.aG(c.blendFunction,pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return Fa(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var m;return Fa(this.gl)?this.gl.deleteVertexArray(c):(m=this.gl.getExtension("OES_vertex_array_object"))===null||m===void 0?void 0:m.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}class Tn{constructor(c,m,x){this.func=c,this.mask=m,this.range=x}}Tn.ReadOnly=!1,Tn.ReadWrite=!0,Tn.disabled=new Tn(519,Tn.ReadOnly,[0,1]);let hl=7680;class mi{constructor(c,m,x,v,S,L){this.test=c,this.ref=m,this.mask=x,this.fail=v,this.depthFail=S,this.pass=L}}mi.disabled=new mi({func:519,mask:0},0,0,hl,hl,hl);class li{constructor(c,m,x){this.enable=c,this.mode=m,this.frontFace=x}}let Ts;function af(M,c,m,x,v,S,L){let F=M.context,Y=F.gl,re=M.useProgram("collisionBox"),se=[],le=0,xe=0;for(let $e=0;$e<x.length;$e++){let st=x[$e],wt=c.getTile(st),Mt=wt.getBucket(m);if(!Mt)continue;let Pt=st.posMatrix;v[0]===0&&v[1]===0||(Pt=M.translatePosMatrix(st.posMatrix,wt,v,S));let Vt=L?Mt.textCollisionBox:Mt.iconCollisionBox,zt=Mt.collisionCircleArray;if(zt.length>0){let Gt=i.Z(),Er=Pt;i.aU(Gt,Mt.placementInvProjMatrix,M.transform.glCoordMatrix),i.aU(Gt,Gt,Mt.placementViewportMatrix),se.push({circleArray:zt,circleOffset:xe,transform:Er,invTransform:Gt,coord:st}),le+=zt.length/4,xe=le}Vt&&re.draw(F,Y.LINES,Tn.disabled,mi.disabled,M.colorModeForRenderPass(),li.disabled,Pe(Pt,M.transform,wt),M.style.map.terrain&&M.style.map.terrain.getTerrainData(st),m.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,M.transform.zoom,null,null,Vt.collisionVertexBuffer)}if(!L||!se.length)return;let Ne=M.useProgram("collisionCircle"),De=new i.aV;De.resize(4*le),De._trim();let Ze=0;for(let $e of se)for(let st=0;st<$e.circleArray.length/4;st++){let wt=4*st,Mt=$e.circleArray[wt+0],Pt=$e.circleArray[wt+1],Vt=$e.circleArray[wt+2],zt=$e.circleArray[wt+3];De.emplace(Ze++,Mt,Pt,Vt,zt,0),De.emplace(Ze++,Mt,Pt,Vt,zt,1),De.emplace(Ze++,Mt,Pt,Vt,zt,2),De.emplace(Ze++,Mt,Pt,Vt,zt,3)}(!Ts||Ts.length<2*le)&&(Ts=function($e){let st=2*$e,wt=new i.aX;wt.resize(st),wt._trim();for(let Mt=0;Mt<st;Mt++){let Pt=6*Mt;wt.uint16[Pt+0]=4*Mt+0,wt.uint16[Pt+1]=4*Mt+1,wt.uint16[Pt+2]=4*Mt+2,wt.uint16[Pt+3]=4*Mt+2,wt.uint16[Pt+4]=4*Mt+3,wt.uint16[Pt+5]=4*Mt+0}return wt}(le));let ze=F.createIndexBuffer(Ts,!0),nt=F.createVertexBuffer(De,i.aW.members,!0);for(let $e of se){let st={u_matrix:$e.transform,u_inv_matrix:$e.invTransform,u_camera_to_center_distance:(_t=M.transform).cameraToCenterDistance,u_viewport_size:[_t.width,_t.height]};Ne.draw(F,Y.TRIANGLES,Tn.disabled,mi.disabled,M.colorModeForRenderPass(),li.disabled,st,M.style.map.terrain&&M.style.map.terrain.getTerrainData($e.coord),m.id,nt,ze,i.S.simpleSegment(0,2*$e.circleOffset,$e.circleArray.length,$e.circleArray.length/2),null,M.transform.zoom,null,null,null)}var _t;nt.destroy(),ze.destroy()}li.disabled=new li(!1,1029,2305),li.backCCW=new li(!0,1029,2305);let Rh=i.ao(new Float32Array(16));function lf(M,c,m,x,v,S){let{horizontalAlign:L,verticalAlign:F}=i.au(M);return new i.P((-(L-.5)*c/v+x[0])*S,(-(F-.5)*m/v+x[1])*S)}function Nh(M,c,m,x,v,S,L,F,Y,re,se){let le=M.text.placedSymbolArray,xe=M.text.dynamicLayoutVertexArray,Ne=M.icon.dynamicLayoutVertexArray,De={};xe.clear();for(let Ze=0;Ze<le.length;Ze++){let ze=le.get(Ze),nt=ze.hidden||!ze.crossTileID||M.allowVerticalPlacement&&!ze.placedOrientation?null:x[ze.crossTileID];if(nt){let _t=new i.P(ze.anchorX,ze.anchorY),$e=Xn(_t,m?L:S,se),st=ws(v.cameraToCenterDistance,$e.signedDistanceFromCamera),wt=i.aj(M.textSizeData,Y,ze)*st/i.ap;m&&(wt*=M.tilePixelRatio/F);let{width:Mt,height:Pt,anchor:Vt,textOffset:zt,textBoxScale:Gt}=nt,Er=lf(Vt,Mt,Pt,zt,Gt,wt),pn=m?Xn(_t.add(Er),S,se).point:$e.point.add(c?Er.rotate(-v.angle):Er),er=M.allowVerticalPlacement&&ze.placedOrientation===i.ai.vertical?Math.PI/2:0;for(let I=0;I<ze.numGlyphs;I++)i.ak(xe,pn,er);re&&ze.associatedIconIndex>=0&&(De[ze.associatedIconIndex]={shiftedAnchor:pn,angle:er})}else ke(ze.numGlyphs,xe)}if(re){Ne.clear();let Ze=M.icon.placedSymbolArray;for(let ze=0;ze<Ze.length;ze++){let nt=Ze.get(ze);if(nt.hidden)ke(nt.numGlyphs,Ne);else{let _t=De[ze];if(_t)for(let $e=0;$e<nt.numGlyphs;$e++)i.ak(Ne,_t.shiftedAnchor,_t.angle);else ke(nt.numGlyphs,Ne)}}M.icon.dynamicLayoutVertexBuffer.updateData(Ne)}M.text.dynamicLayoutVertexBuffer.updateData(xe)}function Hp(M,c,m){return m.iconsInText&&c?"symbolTextAndIcon":M?"symbolSDF":"symbolIcon"}function zh(M,c,m,x,v,S,L,F,Y,re,se,le){let xe=M.context,Ne=xe.gl,De=M.transform,Ze=F==="map",ze=Y==="map",nt=F!=="viewport"&&m.layout.get("symbol-placement")!=="point",_t=Ze&&!ze&&!nt,$e=!m.layout.get("symbol-sort-key").isConstant(),st=!1,wt=M.depthModeForSublayer(0,Tn.ReadOnly),Mt=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Pt=[];for(let Vt of x){let zt=c.getTile(Vt),Gt=zt.getBucket(m);if(!Gt)continue;let Er=v?Gt.text:Gt.icon;if(!Er||!Er.segments.get().length||!Er.hasVisibleVertices)continue;let pn=Er.programConfigurations.get(m.id),er=v||Gt.sdfIcons,I=v?Gt.textSizeData:Gt.iconSizeData,O=ze||De.pitch!==0,z=M.useProgram(Hp(er,v,Gt),pn),Z=i.ah(I,De.zoom),H=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Vt),K,B,q,X,ee=[0,0],oe=null;if(v)B=zt.glyphAtlasTexture,q=Ne.LINEAR,K=zt.glyphAtlasTexture.size,Gt.iconsInText&&(ee=zt.imageAtlasTexture.size,oe=zt.imageAtlasTexture,X=O||M.options.rotating||M.options.zooming||I.kind==="composite"||I.kind==="camera"?Ne.LINEAR:Ne.NEAREST);else{let or=m.layout.get("icon-size").constantOr(0)!==1||Gt.iconsNeedLinear;B=zt.imageAtlasTexture,q=er||M.options.rotating||M.options.zooming||or||O?Ne.LINEAR:Ne.NEAREST,K=zt.imageAtlasTexture.size}let pe=te(zt,1,M.transform.zoom),_e=Zt(Vt.posMatrix,ze,Ze,M.transform,pe),Ce=eo(Vt.posMatrix,ze,Ze,M.transform,pe),Be=Mt&&Gt.hasTextData(),Fe=m.layout.get("icon-text-fit")!=="none"&&Be&&Gt.hasIconData();if(nt){let or=M.style.map.terrain?(yr,Zr)=>M.style.map.terrain.getElevation(Vt,yr,Zr):null,br=m.layout.get("text-rotation-alignment")==="map";Ht(Gt,Vt.posMatrix,M,v,_e,Ce,ze,re,br,or)}let Ge=M.translatePosMatrix(Vt.posMatrix,zt,S,L),it=nt||v&&Mt||Fe?Rh:_e,at=M.translatePosMatrix(Ce,zt,S,L,!0),ot=er&&m.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,dt;dt=er?Gt.iconsInText?ul(I.kind,Z,_t,ze,M,Ge,it,at,K,ee):Mh(I.kind,Z,_t,ze,M,Ge,it,at,v,K,!0):Ah(I.kind,Z,_t,ze,M,Ge,it,at,v,K);let Nt={program:z,buffers:Er,uniformValues:dt,atlasTexture:B,atlasTextureIcon:oe,atlasInterpolation:q,atlasInterpolationIcon:X,isSDF:er,hasHalo:ot};if($e&&Gt.canOverlap){st=!0;let or=Er.segments.get();for(let br of or)Pt.push({segments:new i.S([br]),sortKey:br.sortKey,state:Nt,terrainData:H})}else Pt.push({segments:Er.segments,sortKey:0,state:Nt,terrainData:H})}st&&Pt.sort((Vt,zt)=>Vt.sortKey-zt.sortKey);for(let Vt of Pt){let zt=Vt.state;if(xe.activeTexture.set(Ne.TEXTURE0),zt.atlasTexture.bind(zt.atlasInterpolation,Ne.CLAMP_TO_EDGE),zt.atlasTextureIcon&&(xe.activeTexture.set(Ne.TEXTURE1),zt.atlasTextureIcon&&zt.atlasTextureIcon.bind(zt.atlasInterpolationIcon,Ne.CLAMP_TO_EDGE)),zt.isSDF){let Gt=zt.uniformValues;zt.hasHalo&&(Gt.u_is_halo=1,Xp(zt.buffers,Vt.segments,m,M,zt.program,wt,se,le,Gt,Vt.terrainData)),Gt.u_is_halo=0}Xp(zt.buffers,Vt.segments,m,M,zt.program,wt,se,le,zt.uniformValues,Vt.terrainData)}}function Xp(M,c,m,x,v,S,L,F,Y,re){let se=x.context;v.draw(se,se.gl.TRIANGLES,S,L,F,li.disabled,Y,re,m.id,M.layoutVertexBuffer,M.indexBuffer,c,m.paint,x.transform.zoom,M.programConfigurations.get(m.id),M.dynamicLayoutVertexBuffer,M.opacityVertexBuffer)}function tc(M,c,m,x,v){if(!m||!x||!x.imageAtlas)return;let S=x.imageAtlas.patternPositions,L=S[m.to.toString()],F=S[m.from.toString()];if(!L&&F&&(L=F),!F&&L&&(F=L),!L||!F){let Y=v.getPaintProperty(c);L=S[Y],F=S[Y]}L&&F&&M.setConstantPatternPositions(L,F)}function cf(M,c,m,x,v,S,L){let F=M.context.gl,Y="fill-pattern",re=m.paint.get(Y),se=re&&re.constantOr(1),le=m.getCrossfadeParameters(),xe,Ne,De,Ze,ze;L?(Ne=se&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",xe=F.LINES):(Ne=se?"fillPattern":"fill",xe=F.TRIANGLES);let nt=re.constantOr(null);for(let _t of x){let $e=c.getTile(_t);if(se&&!$e.patternsLoaded())continue;let st=$e.getBucket(m);if(!st)continue;let wt=st.programConfigurations.get(m.id),Mt=M.useProgram(Ne,wt),Pt=M.style.map.terrain&&M.style.map.terrain.getTerrainData(_t);se&&(M.context.activeTexture.set(F.TEXTURE0),$e.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),wt.updatePaintBuffers(le)),tc(wt,Y,nt,$e,m);let Vt=Pt?_t:null,zt=M.translatePosMatrix(Vt?Vt.posMatrix:_t.posMatrix,$e,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));if(L){Ze=st.indexBuffer2,ze=st.segments2;let Gt=[F.drawingBufferWidth,F.drawingBufferHeight];De=Ne==="fillOutlinePattern"&&se?Ss(zt,M,le,$e,Gt):Ms(zt,Gt)}else Ze=st.indexBuffer,ze=st.segments,De=se?As(zt,M,le,$e):Ui(zt);Mt.draw(M.context,xe,v,M.stencilModeForClipping(_t),S,li.disabled,De,Pt,m.id,st.layoutVertexBuffer,Ze,ze,m.paint,M.transform.zoom,wt)}}function Yc(M,c,m,x,v,S,L){let F=M.context,Y=F.gl,re="fill-extrusion-pattern",se=m.paint.get(re),le=se.constantOr(1),xe=m.getCrossfadeParameters(),Ne=m.paint.get("fill-extrusion-opacity"),De=se.constantOr(null);for(let Ze of x){let ze=c.getTile(Ze),nt=ze.getBucket(m);if(!nt)continue;let _t=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Ze),$e=nt.programConfigurations.get(m.id),st=M.useProgram(le?"fillExtrusionPattern":"fillExtrusion",$e);le&&(M.context.activeTexture.set(Y.TEXTURE0),ze.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),$e.updatePaintBuffers(xe)),tc($e,re,De,ze,m);let wt=M.translatePosMatrix(Ze.posMatrix,ze,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),Mt=m.paint.get("fill-extrusion-vertical-gradient"),Pt=le?Ai(wt,M,Mt,Ne,Ze,xe,ze):Lo(wt,M,Mt,Ne);st.draw(F,F.gl.TRIANGLES,v,S,L,li.backCCW,Pt,_t,m.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,m.paint,M.transform.zoom,$e,M.style.map.terrain&&nt.centroidVertexBuffer)}}function dl(M,c,m,x,v,S,L){let F=M.context,Y=F.gl,re=m.fbo;if(!re)return;let se=M.useProgram("hillshade"),le=M.style.map.terrain&&M.style.map.terrain.getTerrainData(c);F.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,re.colorAttachment.get()),se.draw(F,Y.TRIANGLES,v,S,L,li.disabled,((xe,Ne,De,Ze)=>{let ze=De.paint.get("hillshade-shadow-color"),nt=De.paint.get("hillshade-highlight-color"),_t=De.paint.get("hillshade-accent-color"),$e=De.paint.get("hillshade-illumination-direction")*(Math.PI/180);De.paint.get("hillshade-illumination-anchor")==="viewport"&&($e-=xe.transform.angle);let st=!xe.options.moving;return{u_matrix:Ze?Ze.posMatrix:xe.transform.calculatePosMatrix(Ne.tileID.toUnwrapped(),st),u_image:0,u_latrange:Xt(0,Ne.tileID),u_light:[De.paint.get("hillshade-exaggeration"),$e],u_shadow:ze,u_highlight:nt,u_accent:_t}})(M,m,x,le?c:null),le,x.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments)}function Kp(M,c,m,x,v,S){let L=M.context,F=L.gl,Y=c.dem;if(Y&&Y.data){let re=Y.dim,se=Y.stride,le=Y.getPixels();if(L.activeTexture.set(F.TEXTURE1),L.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||M.getTileTexture(se),c.demTexture){let Ne=c.demTexture;Ne.update(le,{premultiply:!1}),Ne.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else c.demTexture=new fe(L,le,F.RGBA,{premultiply:!1}),c.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);L.activeTexture.set(F.TEXTURE0);let xe=c.fbo;if(!xe){let Ne=new fe(L,{width:re,height:re,data:null},F.RGBA);Ne.bind(F.LINEAR,F.CLAMP_TO_EDGE),xe=c.fbo=L.createFramebuffer(re,re,!0,!1),xe.colorAttachment.set(Ne.texture)}L.bindFramebuffer.set(xe.framebuffer),L.viewport.set([0,0,re,re]),M.useProgram("hillshadePrepare").draw(L,F.TRIANGLES,x,v,S,li.disabled,((Ne,De)=>{let Ze=De.stride,ze=i.Z();return i.aS(ze,0,i.N,-i.N,0,0,1),i.$(ze,ze,[0,-i.N,0]),{u_matrix:ze,u_image:1,u_dimension:[Ze,Ze],u_zoom:Ne.overscaledZ,u_unpack:De.getUnpackVector()}})(c.tileID,Y),null,m.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function Rx(M,c,m,x,v,S){let L=x.paint.get("raster-fade-duration");if(!S&&L>0){let F=i.h.now(),Y=(F-M.timeAdded)/L,re=c?(F-c.timeAdded)/L:-1,se=m.getSource(),le=v.coveringZoomLevel({tileSize:se.tileSize,roundZoom:se.roundZoom}),xe=!c||Math.abs(c.tileID.overscaledZ-le)>Math.abs(M.tileID.overscaledZ-le),Ne=xe&&M.refreshedUponExpiration?1:i.ad(xe?Y:1-re,0,1);return M.refreshedUponExpiration&&Y>=1&&(M.refreshedUponExpiration=!1),c?{opacity:1,mix:1-Ne}:{opacity:Ne,mix:0}}return{opacity:1,mix:0}}let b_=new i.aT(1,0,0,1),Dh=new i.aT(0,1,0,1),$p=new i.aT(0,0,1,1),v_=new i.aT(1,0,1,1),Qp=new i.aT(0,1,1,1);function qc(M,c,m,x){Fh(M,0,c+m/2,M.transform.width,m,x)}function Lh(M,c,m,x){Fh(M,c-m/2,0,m,M.transform.height,x)}function Fh(M,c,m,x,v,S){let L=M.context,F=L.gl;F.enable(F.SCISSOR_TEST),F.scissor(c*M.pixelRatio,m*M.pixelRatio,x*M.pixelRatio,v*M.pixelRatio),L.clear({color:S}),F.disable(F.SCISSOR_TEST)}function Jp(M,c,m){let x=M.context,v=x.gl,S=m.posMatrix,L=M.useProgram("debug"),F=Tn.disabled,Y=mi.disabled,re=M.colorModeForRenderPass(),se="$debug",le=M.style.map.terrain&&M.style.map.terrain.getTerrainData(m);x.activeTexture.set(v.TEXTURE0);let xe=c.getTileByID(m.key).latestRawTileData,Ne=Math.floor((xe&&xe.byteLength||0)/1024),De=c.getTile(m).tileSize,Ze=512/Math.min(De,512)*(m.overscaledZ/M.transform.zoom)*.5,ze=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(ze+=` => ${m.overscaledZ}`),function(nt,_t){nt.initDebugOverlayCanvas();let $e=nt.debugOverlayCanvas,st=nt.context.gl,wt=nt.debugOverlayCanvas.getContext("2d");wt.clearRect(0,0,$e.width,$e.height),wt.shadowColor="white",wt.shadowBlur=2,wt.lineWidth=1.5,wt.strokeStyle="white",wt.textBaseline="top",wt.font="bold 36px Open Sans, sans-serif",wt.fillText(_t,5,5),wt.strokeText(_t,5,5),nt.debugOverlayTexture.update($e),nt.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(M,`${ze} ${Ne}kB`),L.draw(x,v.TRIANGLES,F,Y,pi.alphaBlended,li.disabled,Ke(S,i.aT.transparent,Ze),null,se,M.debugBuffer,M.quadTriangleIndexBuffer,M.debugSegments),L.draw(x,v.LINE_STRIP,F,Y,re,li.disabled,Ke(S,i.aT.red),le,se,M.debugBuffer,M.tileBorderIndexBuffer,M.debugSegments)}function gi(M,c,m){let x=M.context,v=x.gl,S=M.colorModeForRenderPass(),L=new Tn(v.LEQUAL,Tn.ReadWrite,M.depthRangeFor3D),F=M.useProgram("terrain"),Y=c.getTerrainMesh();x.bindFramebuffer.set(null),x.viewport.set([0,0,M.width,M.height]);for(let re of m){let se=M.renderToTexture.getTexture(re),le=c.getTerrainData(re.tileID);x.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,se.texture);let xe={u_matrix:M.transform.calculatePosMatrix(re.tileID.toUnwrapped()),u_texture:0,u_ele_delta:c.getMeshFrameDelta(M.transform.zoom)};F.draw(x,v.TRIANGLES,L,mi.disabled,S,li.backCCW,xe,le,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}class pl{constructor(c,m){this.context=new x_(c),this.transform=m,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:i.Z(),renderTime:0},this.setup(),this.numSublayers=ei.maxUnderzooming+ei.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ur}resize(c,m,x){if(this.width=Math.floor(c*x),this.height=Math.floor(m*x),this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let v of this.style._order)this.style._layers[v].resize()}setup(){let c=this.context,m=new i.a_;m.emplaceBack(0,0),m.emplaceBack(i.N,0),m.emplaceBack(0,i.N),m.emplaceBack(i.N,i.N),this.tileExtentBuffer=c.createVertexBuffer(m,Nn.members),this.tileExtentSegments=i.S.simpleSegment(0,0,4,2);let x=new i.a_;x.emplaceBack(0,0),x.emplaceBack(i.N,0),x.emplaceBack(0,i.N),x.emplaceBack(i.N,i.N),this.debugBuffer=c.createVertexBuffer(x,Nn.members),this.debugSegments=i.S.simpleSegment(0,0,4,5);let v=new i.V;v.emplaceBack(0,0,0,0),v.emplaceBack(i.N,0,i.N,0),v.emplaceBack(0,i.N,0,i.N),v.emplaceBack(i.N,i.N,i.N,i.N),this.rasterBoundsBuffer=c.createVertexBuffer(v,Ir.members),this.rasterBoundsSegments=i.S.simpleSegment(0,0,4,2);let S=new i.a_;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,Nn.members),this.viewportSegments=i.S.simpleSegment(0,0,4,2);let L=new i.a$;L.emplaceBack(0),L.emplaceBack(1),L.emplaceBack(3),L.emplaceBack(2),L.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(L);let F=new i.b0;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(F);let Y=this.context.gl;this.stencilClearMode=new mi({func:Y.ALWAYS,mask:0},0,255,Y.ZERO,Y.ZERO,Y.ZERO)}clearStencil(){let c=this.context,m=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let x=i.Z();i.aS(x,0,this.width,this.height,0,0,1),i.a0(x,x,[m.drawingBufferWidth,m.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,m.TRIANGLES,Tn.disabled,this.stencilClearMode,pi.disabled,li.disabled,bt(x),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,m){if(this.currentStencilSource===c.source||!c.isTileClipped()||!m||!m.length)return;this.currentStencilSource=c.source;let x=this.context,v=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(pi.disabled),x.setDepthMode(Tn.disabled);let S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let L of m){let F=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,Y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(L);S.draw(x,v.TRIANGLES,Tn.disabled,new mi({func:v.ALWAYS,mask:0},F,255,v.KEEP,v.KEEP,v.REPLACE),pi.disabled,li.disabled,bt(L.posMatrix),Y,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let c=this.nextStencilID++,m=this.context.gl;return new mi({func:m.NOTEQUAL,mask:255},c,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(c){let m=this.context.gl;return new mi({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,m.KEEP,m.KEEP,m.REPLACE)}stencilConfigForOverlap(c){let m=this.context.gl,x=c.sort((L,F)=>F.overscaledZ-L.overscaledZ),v=x[x.length-1].overscaledZ,S=x[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();let L={};for(let F=0;F<S;F++)L[F+v]=new mi({func:m.GEQUAL,mask:255},F+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=S,[L,x]}return[{[v]:mi.disabled},x]}colorModeForRenderPass(){let c=this.context.gl;return this._showOverdrawInspector?new pi([c.CONSTANT_COLOR,c.ONE],new i.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pi.unblended:pi.alphaBlended}depthModeForSublayer(c,m,x){if(!this.opaquePassEnabledForLayer())return Tn.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Tn(x||this.context.gl.LEQUAL,m,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,m){this.style=c,this.options=m,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(i.h.now()),this.imageManager.beginFrame();let x=this.style._order,v=this.style.sourceCaches,S={},L={},F={};for(let Y in v){let re=v[Y];re.used&&re.prepare(this.context),S[Y]=re.getVisibleCoordinates(),L[Y]=S[Y].slice().reverse(),F[Y]=re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Y=0;Y<x.length;Y++)if(this.style._layers[x[Y]].is3D()){this.opaquePassCutoff=Y;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let Y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!i.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||Y.length)&&(i.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(re,se){let le=re.context,xe=le.gl,Ne=pi.unblended,De=new Tn(xe.LEQUAL,Tn.ReadWrite,[0,1]),Ze=se.getTerrainMesh(),ze=se.sourceCache.getRenderableTiles(),nt=re.useProgram("terrainDepth");le.bindFramebuffer.set(se.getFramebuffer("depth").framebuffer),le.viewport.set([0,0,re.width/devicePixelRatio,re.height/devicePixelRatio]),le.clear({color:i.aT.transparent,depth:1});for(let _t of ze){let $e=se.getTerrainData(_t.tileID),st={u_matrix:re.transform.calculatePosMatrix(_t.tileID.toUnwrapped()),u_ele_delta:se.getMeshFrameDelta(re.transform.zoom)};nt.draw(le,xe.TRIANGLES,De,mi.disabled,Ne,li.backCCW,st,$e,"terrain",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}le.bindFramebuffer.set(null),le.viewport.set([0,0,re.width,re.height])}(this,this.style.map.terrain),function(re,se){let le=re.context,xe=le.gl,Ne=pi.unblended,De=new Tn(xe.LEQUAL,Tn.ReadWrite,[0,1]),Ze=se.getTerrainMesh(),ze=se.getCoordsTexture(),nt=se.sourceCache.getRenderableTiles(),_t=re.useProgram("terrainCoords");le.bindFramebuffer.set(se.getFramebuffer("coords").framebuffer),le.viewport.set([0,0,re.width/devicePixelRatio,re.height/devicePixelRatio]),le.clear({color:i.aT.transparent,depth:1}),se.coordsIndex=[];for(let $e of nt){let st=se.getTerrainData($e.tileID);le.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,ze.texture);let wt={u_matrix:re.transform.calculatePosMatrix($e.tileID.toUnwrapped()),u_terrain_coords_id:(255-se.coordsIndex.length)/255,u_texture:0,u_ele_delta:se.getMeshFrameDelta(re.transform.zoom)};_t.draw(le,xe.TRIANGLES,De,mi.disabled,Ne,li.backCCW,wt,st,"terrain",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments),se.coordsIndex.push($e.tileID.key)}le.bindFramebuffer.set(null),le.viewport.set([0,0,re.width,re.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(let Y of x){let re=this.style._layers[Y];if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;let se=L[re.source];(re.type==="custom"||se.length)&&this.renderLayer(this,v[re.source],re,se)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:m.showOverdrawInspector?i.aT.black:i.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=m.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){let Y=this.style._layers[x[this.currentLayer]],re=v[Y.source],se=S[Y.source];this._renderTileClippingMasks(Y,se),this.renderLayer(this,re,Y,se)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){let Y=this.style._layers[x[this.currentLayer]],re=v[Y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Y))continue;let se=(Y.type==="symbol"?F:L)[Y.source];this._renderTileClippingMasks(Y,S[Y.source]),this.renderLayer(this,re,Y,se)}if(this.options.showTileBoundaries){let Y=function(re,se){let le=null,xe=Object.values(re._layers).flatMap(ze=>ze.source&&!ze.isHidden(se)?[re.sourceCaches[ze.source]]:[]),Ne=xe.filter(ze=>ze.getSource().type==="vector"),De=xe.filter(ze=>ze.getSource().type!=="vector"),Ze=ze=>{(!le||le.getSource().maxzoom<ze.getSource().maxzoom)&&(le=ze)};return Ne.forEach(ze=>Ze(ze)),le||De.forEach(ze=>Ze(ze)),le}(this.style,this.transform.zoom);Y&&function(re,se,le){for(let xe=0;xe<le.length;xe++)Jp(re,se,le[xe])}(this,Y,Y.getVisibleCoordinates())}this.options.showPadding&&function(Y){let re=Y.transform.padding;qc(Y,Y.transform.height-(re.top||0),3,b_),qc(Y,re.bottom||0,3,Dh),Lh(Y,re.left||0,3,$p),Lh(Y,Y.transform.width-(re.right||0),3,v_);let se=Y.transform.centerPoint;(function(le,xe,Ne,De){Fh(le,xe-1,Ne-10,2,20,De),Fh(le,xe-10,Ne-1,20,2,De)})(Y,se.x,Y.transform.height-se.y,Qp)}(this),this.context.setDefault()}renderLayer(c,m,x,v){if(!x.isHidden(this.transform.zoom)&&(x.type==="background"||x.type==="custom"||(v||[]).length))switch(this.id=x.id,x.type){case"symbol":(function(S,L,F,Y,re){if(S.renderPass!=="translucent")return;let se=mi.disabled,le=S.colorModeForRenderPass();(F._unevaluatedLayout.hasValue("text-variable-anchor")||F._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(xe,Ne,De,Ze,ze,nt,_t){let $e=Ne.transform,st=ze==="map",wt=nt==="map";for(let Mt of xe){let Pt=Ze.getTile(Mt),Vt=Pt.getBucket(De);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;let zt=i.ah(Vt.textSizeData,$e.zoom),Gt=te(Pt,1,Ne.transform.zoom),Er=Zt(Mt.posMatrix,wt,st,Ne.transform,Gt),pn=De.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(zt){let er=Math.pow(2,$e.zoom-Pt.tileID.overscaledZ);Nh(Vt,st,wt,_t,$e,Er,Mt.posMatrix,er,zt,pn,Ne.style.map.terrain?(I,O)=>Ne.style.map.terrain.getElevation(Mt,I,O):null)}}}(Y,S,F,L,F.layout.get("text-rotation-alignment"),F.layout.get("text-pitch-alignment"),re),F.paint.get("icon-opacity").constantOr(1)!==0&&zh(S,L,F,Y,!1,F.paint.get("icon-translate"),F.paint.get("icon-translate-anchor"),F.layout.get("icon-rotation-alignment"),F.layout.get("icon-pitch-alignment"),F.layout.get("icon-keep-upright"),se,le),F.paint.get("text-opacity").constantOr(1)!==0&&zh(S,L,F,Y,!0,F.paint.get("text-translate"),F.paint.get("text-translate-anchor"),F.layout.get("text-rotation-alignment"),F.layout.get("text-pitch-alignment"),F.layout.get("text-keep-upright"),se,le),L.map.showCollisionBoxes&&(af(S,L,F,Y,F.paint.get("text-translate"),F.paint.get("text-translate-anchor"),!0),af(S,L,F,Y,F.paint.get("icon-translate"),F.paint.get("icon-translate-anchor"),!1))})(c,m,x,v,this.style.placement.variableOffsets);break;case"circle":(function(S,L,F,Y){if(S.renderPass!=="translucent")return;let re=F.paint.get("circle-opacity"),se=F.paint.get("circle-stroke-width"),le=F.paint.get("circle-stroke-opacity"),xe=!F.layout.get("circle-sort-key").isConstant();if(re.constantOr(1)===0&&(se.constantOr(1)===0||le.constantOr(1)===0))return;let Ne=S.context,De=Ne.gl,Ze=S.depthModeForSublayer(0,Tn.ReadOnly),ze=mi.disabled,nt=S.colorModeForRenderPass(),_t=[];for(let $e=0;$e<Y.length;$e++){let st=Y[$e],wt=L.getTile(st),Mt=wt.getBucket(F);if(!Mt)continue;let Pt=Mt.programConfigurations.get(F.id),Vt=S.useProgram("circle",Pt),zt=Mt.layoutVertexBuffer,Gt=Mt.indexBuffer,Er=S.style.map.terrain&&S.style.map.terrain.getTerrainData(st),pn={programConfiguration:Pt,program:Vt,layoutVertexBuffer:zt,indexBuffer:Gt,uniformValues:Me(S,st,wt,F),terrainData:Er};if(xe){let er=Mt.segments.get();for(let I of er)_t.push({segments:new i.S([I]),sortKey:I.sortKey,state:pn})}else _t.push({segments:Mt.segments,sortKey:0,state:pn})}xe&&_t.sort(($e,st)=>$e.sortKey-st.sortKey);for(let $e of _t){let{programConfiguration:st,program:wt,layoutVertexBuffer:Mt,indexBuffer:Pt,uniformValues:Vt,terrainData:zt}=$e.state;wt.draw(Ne,De.TRIANGLES,Ze,ze,nt,li.disabled,Vt,zt,F.id,Mt,Pt,$e.segments,F.paint,S.transform.zoom,st)}})(c,m,x,v);break;case"heatmap":(function(S,L,F,Y){if(F.paint.get("heatmap-opacity")!==0)if(S.renderPass==="offscreen"){let re=S.context,se=re.gl,le=mi.disabled,xe=new pi([se.ONE,se.ONE],i.aT.transparent,[!0,!0,!0,!0]);(function(Ne,De,Ze){let ze=Ne.gl;Ne.activeTexture.set(ze.TEXTURE1),Ne.viewport.set([0,0,De.width/4,De.height/4]);let nt=Ze.heatmapFbo;if(nt)ze.bindTexture(ze.TEXTURE_2D,nt.colorAttachment.get()),Ne.bindFramebuffer.set(nt.framebuffer);else{let _t=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,_t),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),nt=Ze.heatmapFbo=Ne.createFramebuffer(De.width/4,De.height/4,!1,!1),function($e,st,wt,Mt){var Pt,Vt;let zt=$e.gl,Gt=(Pt=$e.HALF_FLOAT)!==null&&Pt!==void 0?Pt:zt.UNSIGNED_BYTE,Er=(Vt=$e.RGBA16F)!==null&&Vt!==void 0?Vt:zt.RGBA;zt.texImage2D(zt.TEXTURE_2D,0,Er,st.width/4,st.height/4,0,zt.RGBA,Gt,null),Mt.colorAttachment.set(wt)}(Ne,De,_t,nt)}})(re,S,F),re.clear({color:i.aT.transparent});for(let Ne=0;Ne<Y.length;Ne++){let De=Y[Ne];if(L.hasRenderableParent(De))continue;let Ze=L.getTile(De),ze=Ze.getBucket(F);if(!ze)continue;let nt=ze.programConfigurations.get(F.id),_t=S.useProgram("heatmap",nt),{zoom:$e}=S.transform;_t.draw(re,se.TRIANGLES,Tn.disabled,le,xe,li.disabled,Ft(De.posMatrix,Ze,$e,F.paint.get("heatmap-intensity")),null,F.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,F.paint,S.transform.zoom,nt)}re.viewport.set([0,0,S.width,S.height])}else S.renderPass==="translucent"&&(S.context.setColorMode(S.colorModeForRenderPass()),function(re,se){let le=re.context,xe=le.gl,Ne=se.heatmapFbo;if(!Ne)return;le.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,Ne.colorAttachment.get()),le.activeTexture.set(xe.TEXTURE1);let De=se.colorRampTexture;De||(De=se.colorRampTexture=new fe(le,se.colorRamp,xe.RGBA)),De.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),re.useProgram("heatmapTexture").draw(le,xe.TRIANGLES,Tn.disabled,mi.disabled,re.colorModeForRenderPass(),li.disabled,((Ze,ze,nt,_t)=>{let $e=i.Z();i.aS($e,0,Ze.width,Ze.height,0,0,1);let st=Ze.context.gl;return{u_matrix:$e,u_world:[st.drawingBufferWidth,st.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ze.paint.get("heatmap-opacity")}})(re,se),null,se.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments,se.paint,re.transform.zoom)}(S,F))})(c,m,x,v);break;case"line":(function(S,L,F,Y){if(S.renderPass!=="translucent")return;let re=F.paint.get("line-opacity"),se=F.paint.get("line-width");if(re.constantOr(1)===0||se.constantOr(1)===0)return;let le=S.depthModeForSublayer(0,Tn.ReadOnly),xe=S.colorModeForRenderPass(),Ne=F.paint.get("line-dasharray"),De=F.paint.get("line-pattern"),Ze=De.constantOr(1),ze=F.paint.get("line-gradient"),nt=F.getCrossfadeParameters(),_t=Ze?"linePattern":Ne?"lineSDF":ze?"lineGradient":"line",$e=S.context,st=$e.gl,wt=!0;for(let Mt of Y){let Pt=L.getTile(Mt);if(Ze&&!Pt.patternsLoaded())continue;let Vt=Pt.getBucket(F);if(!Vt)continue;let zt=Vt.programConfigurations.get(F.id),Gt=S.context.program.get(),Er=S.useProgram(_t,zt),pn=wt||Er.program!==Gt,er=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Mt),I=De.constantOr(null);if(I&&Pt.imageAtlas){let Z=Pt.imageAtlas,H=Z.patternPositions[I.to.toString()],K=Z.patternPositions[I.from.toString()];H&&K&&zt.setConstantPatternPositions(H,K)}let O=er?Mt:null,z=Ze?Wn(S,Pt,F,nt,O):Ne?Kn(S,Pt,F,Ne,nt,O):ze?_n(S,Pt,F,Vt.lineClipsArray.length,O):hn(S,Pt,F,O);if(Ze)$e.activeTexture.set(st.TEXTURE0),Pt.imageAtlasTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE),zt.updatePaintBuffers(nt);else if(Ne&&(pn||S.lineAtlas.dirty))$e.activeTexture.set(st.TEXTURE0),S.lineAtlas.bind($e);else if(ze){let Z=Vt.gradients[F.id],H=Z.texture;if(F.gradientVersion!==Z.version){let K=256;if(F.stepInterpolant){let B=L.getSource().maxzoom,q=Mt.canonical.z===B?Math.ceil(1<<S.transform.maxZoom-Mt.canonical.z):1;K=i.ad(i.aY(Vt.maxLineLength/i.N*1024*q),256,$e.maxTextureSize)}Z.gradient=i.aZ({expression:F.gradientExpression(),evaluationKey:"lineProgress",resolution:K,image:Z.gradient||void 0,clips:Vt.lineClipsArray}),Z.texture?Z.texture.update(Z.gradient):Z.texture=new fe($e,Z.gradient,st.RGBA),Z.version=F.gradientVersion,H=Z.texture}$e.activeTexture.set(st.TEXTURE0),H.bind(F.stepInterpolant?st.NEAREST:st.LINEAR,st.CLAMP_TO_EDGE)}Er.draw($e,st.TRIANGLES,le,S.stencilModeForClipping(Mt),xe,li.disabled,z,er,F.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,F.paint,S.transform.zoom,zt,Vt.layoutVertexBuffer2),wt=!1}})(c,m,x,v);break;case"fill":(function(S,L,F,Y){let re=F.paint.get("fill-color"),se=F.paint.get("fill-opacity");if(se.constantOr(1)===0)return;let le=S.colorModeForRenderPass(),xe=F.paint.get("fill-pattern"),Ne=S.opaquePassEnabledForLayer()&&!xe.constantOr(1)&&re.constantOr(i.aT.transparent).a===1&&se.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===Ne){let De=S.depthModeForSublayer(1,S.renderPass==="opaque"?Tn.ReadWrite:Tn.ReadOnly);cf(S,L,F,Y,De,le,!1)}if(S.renderPass==="translucent"&&F.paint.get("fill-antialias")){let De=S.depthModeForSublayer(F.getPaintProperty("fill-outline-color")?2:0,Tn.ReadOnly);cf(S,L,F,Y,De,le,!0)}})(c,m,x,v);break;case"fill-extrusion":(function(S,L,F,Y){let re=F.paint.get("fill-extrusion-opacity");if(re!==0&&S.renderPass==="translucent"){let se=new Tn(S.context.gl.LEQUAL,Tn.ReadWrite,S.depthRangeFor3D);if(re!==1||F.paint.get("fill-extrusion-pattern").constantOr(1))Yc(S,L,F,Y,se,mi.disabled,pi.disabled),Yc(S,L,F,Y,se,S.stencilModeFor3D(),S.colorModeForRenderPass());else{let le=S.colorModeForRenderPass();Yc(S,L,F,Y,se,mi.disabled,le)}}})(c,m,x,v);break;case"hillshade":(function(S,L,F,Y){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;let re=S.context,se=S.depthModeForSublayer(0,Tn.ReadOnly),le=S.colorModeForRenderPass(),[xe,Ne]=S.renderPass==="translucent"?S.stencilConfigForOverlap(Y):[{},Y];for(let De of Ne){let Ze=L.getTile(De);Ze.needsHillshadePrepare!==void 0&&Ze.needsHillshadePrepare&&S.renderPass==="offscreen"?Kp(S,Ze,F,se,mi.disabled,le):S.renderPass==="translucent"&&dl(S,De,Ze,F,se,xe[De.overscaledZ],le)}re.viewport.set([0,0,S.width,S.height])})(c,m,x,v);break;case"raster":(function(S,L,F,Y){if(S.renderPass!=="translucent"||F.paint.get("raster-opacity")===0||!Y.length)return;let re=S.context,se=re.gl,le=L.getSource(),xe=S.useProgram("raster"),Ne=S.colorModeForRenderPass(),[De,Ze]=le instanceof Br?[{},Y]:S.stencilConfigForOverlap(Y),ze=Ze[Ze.length-1].overscaledZ,nt=!S.options.moving;for(let _t of Ze){let $e=S.depthModeForSublayer(_t.overscaledZ-ze,F.paint.get("raster-opacity")===1?Tn.ReadWrite:Tn.ReadOnly,se.LESS),st=L.getTile(_t);st.registerFadeDuration(F.paint.get("raster-fade-duration"));let wt=L.findLoadedParent(_t,0),Mt=Rx(st,wt,L,F,S.transform,S.style.map.terrain),Pt,Vt,zt=F.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR;re.activeTexture.set(se.TEXTURE0),st.texture.bind(zt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),re.activeTexture.set(se.TEXTURE1),wt?(wt.texture.bind(zt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,wt.tileID.overscaledZ-st.tileID.overscaledZ),Vt=[st.tileID.canonical.x*Pt%1,st.tileID.canonical.y*Pt%1]):st.texture.bind(zt,se.CLAMP_TO_EDGE,se.LINEAR_MIPMAP_NEAREST);let Gt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(_t),Er=Gt?_t:null,pn=Er?Er.posMatrix:S.transform.calculatePosMatrix(_t.toUnwrapped(),nt),er=qi(pn,Vt||[0,0],Pt||1,Mt,F);le instanceof Br?xe.draw(re,se.TRIANGLES,$e,mi.disabled,Ne,li.disabled,er,Gt,F.id,le.boundsBuffer,S.quadTriangleIndexBuffer,le.boundsSegments):xe.draw(re,se.TRIANGLES,$e,De[_t.overscaledZ],Ne,li.disabled,er,Gt,F.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}})(c,m,x,v);break;case"background":(function(S,L,F,Y){let re=F.paint.get("background-color"),se=F.paint.get("background-opacity");if(se===0)return;let le=S.context,xe=le.gl,Ne=S.transform,De=Ne.tileSize,Ze=F.paint.get("background-pattern");if(S.isPatternMissing(Ze))return;let ze=!Ze&&re.a===1&&se===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==ze)return;let nt=mi.disabled,_t=S.depthModeForSublayer(0,ze==="opaque"?Tn.ReadWrite:Tn.ReadOnly),$e=S.colorModeForRenderPass(),st=S.useProgram(Ze?"backgroundPattern":"background"),wt=Y||Ne.coveringTiles({tileSize:De,terrain:S.style.map.terrain});Ze&&(le.activeTexture.set(xe.TEXTURE0),S.imageManager.bind(S.context));let Mt=F.getCrossfadeParameters();for(let Pt of wt){let Vt=Y?Pt.posMatrix:S.transform.calculatePosMatrix(Pt.toUnwrapped()),zt=Ze?cs(Vt,se,S,Ze,{tileID:Pt,tileSize:De},Mt):$u(Vt,se,re),Gt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Pt);st.draw(le,xe.TRIANGLES,_t,nt,$e,li.disabled,zt,Gt,F.id,S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}})(c,0,x,v);break;case"custom":(function(S,L,F){let Y=S.context,re=F.implementation;if(S.renderPass==="offscreen"){let se=re.prerender;se&&(S.setCustomLayerDefaults(),Y.setColorMode(S.colorModeForRenderPass()),se.call(re,Y.gl,S.transform.customLayerMatrix()),Y.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),Y.setColorMode(S.colorModeForRenderPass()),Y.setStencilMode(mi.disabled);let se=re.renderingMode==="3d"?new Tn(S.context.gl.LEQUAL,Tn.ReadWrite,S.depthRangeFor3D):S.depthModeForSublayer(0,Tn.ReadOnly);Y.setDepthMode(se),re.render(Y.gl,S.transform.customLayerMatrix()),Y.setDirty(),S.setBaseState(),Y.bindFramebuffer.set(null)}})(c,0,x)}}translatePosMatrix(c,m,x,v,S){if(!x[0]&&!x[1])return c;let L=S?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(L){let re=Math.sin(L),se=Math.cos(L);x=[x[0]*se-x[1]*re,x[0]*re+x[1]*se]}let F=[S?x[0]:te(m,x[0],this.transform.zoom),S?x[1]:te(m,x[1],this.transform.zoom),0],Y=new Float32Array(16);return i.$(Y,c,F),Y}saveTileTexture(c){let m=this._tileTextures[c.size[0]];m?m.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){let m=this._tileTextures[c];return m&&m.length>0?m.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;let m=this.imageManager.getPattern(c.from.toString()),x=this.imageManager.getPattern(c.to.toString());return!m||!x}useProgram(c,m){this.cache=this.cache||{};let x=c+(m?m.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[x]||(this.cache[x]=new vn(this.context,fn[c],m,Qu[c],this._showOverdrawInspector,this.style.map.terrain)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:c,drawingBufferHeight:m}=this.context.gl;return this.width!==c||this.height!==m}}class Xo{constructor(c,m){this.points=c,this.planes=m}static fromInvProjectionMatrix(c,m,x){let v=Math.pow(2,x),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(F=>{let Y=1/(F=i.ag([],F,c))[3]/m*v;return i.b3(F,F,[Y,Y,1/F[3],Y])}),L=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(F=>{let Y=function(xe,Ne){var De=Ne[0],Ze=Ne[1],ze=Ne[2],nt=De*De+Ze*Ze+ze*ze;return nt>0&&(nt=1/Math.sqrt(nt)),xe[0]=Ne[0]*nt,xe[1]=Ne[1]*nt,xe[2]=Ne[2]*nt,xe}([],function(xe,Ne,De){var Ze=Ne[0],ze=Ne[1],nt=Ne[2],_t=De[0],$e=De[1],st=De[2];return xe[0]=ze*st-nt*$e,xe[1]=nt*_t-Ze*st,xe[2]=Ze*$e-ze*_t,xe}([],j([],S[F[0]],S[F[1]]),j([],S[F[2]],S[F[1]]))),re=-((se=Y)[0]*(le=S[F[1]])[0]+se[1]*le[1]+se[2]*le[2]);var se,le;return Y.concat(re)});return new Xo(S,L)}}class Gc{constructor(c,m){this.min=c,this.max=m,this.center=function(x,v,S){return x[0]=.5*v[0],x[1]=.5*v[1],x[2]=.5*v[2],x}([],function(x,v,S){return x[0]=v[0]+S[0],x[1]=v[1]+S[1],x[2]=v[2]+S[2],x}([],this.min,this.max))}quadrant(c){let m=[c%2==0,c<2],x=V(this.min),v=V(this.max);for(let S=0;S<m.length;S++)x[S]=m[S]?this.min[S]:this.center[S],v[S]=m[S]?this.center[S]:this.max[S];return v[2]=this.max[2],new Gc(x,v)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersects(c){let m=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],x=!0;for(let v=0;v<c.planes.length;v++){let S=c.planes[v],L=0;for(let F=0;F<m.length;F++)i.b4(S,m[F])>=0&&L++;if(L===0)return 0;L!==m.length&&(x=!1)}if(x)return 2;for(let v=0;v<3;v++){let S=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(let F=0;F<c.points.length;F++){let Y=c.points[F][v]-this.min[v];S=Math.min(S,Y),L=Math.max(L,Y)}if(L<0||S>this.max[v]-this.min[v])return 0}return 1}}class uf{constructor(c=0,m=0,x=0,v=0){if(isNaN(c)||c<0||isNaN(m)||m<0||isNaN(x)||x<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=m,this.left=x,this.right=v}interpolate(c,m,x){return m.top!=null&&c.top!=null&&(this.top=i.B.number(c.top,m.top,x)),m.bottom!=null&&c.bottom!=null&&(this.bottom=i.B.number(c.bottom,m.bottom,x)),m.left!=null&&c.left!=null&&(this.left=i.B.number(c.left,m.left,x)),m.right!=null&&c.right!=null&&(this.right=i.B.number(c.right,m.right,x)),this}getCenter(c,m){let x=i.ad((this.left+c-this.right)/2,0,c),v=i.ad((this.top+m-this.bottom)/2,0,m);return new i.P(x,v)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new uf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Bh{constructor(c,m,x,v,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||!!S,this._minZoom=c||0,this._maxZoom=m||22,this._minPitch=x??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new i.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new uf,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let c=new Bh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.apply(this),c}apply(c){this.tileSize=c.tileSize,this.latRange=c.latRange,this.width=c.width,this.height=c.height,this._center=c._center,this._elevation=c._elevation,this._minEleveationForCurrentTile=c._minEleveationForCurrentTile,this.zoom=c.zoom,this.angle=c.angle,this._fov=c._fov,this._pitch=c._pitch,this._unmodified=c._unmodified,this._edgeInsets=c._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(c){let m=-i.b5(c,-180,180)*Math.PI/180;this.angle!==m&&(this._unmodified=!1,this.angle=m,this._calcMatrices(),this.rotationMatrix=function(){var x=new i.A(4);return i.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}(),function(x,v,S){var L=v[0],F=v[1],Y=v[2],re=v[3],se=Math.sin(S),le=Math.cos(S);x[0]=L*le+Y*se,x[1]=F*le+re*se,x[2]=L*-se+Y*le,x[3]=F*-se+re*le}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){let m=i.ad(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==m&&(this._unmodified=!1,this._pitch=m,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(c){let m=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==m&&(this._unmodified=!1,this._zoom=m,this.tileZoom=Math.max(0,Math.floor(m)),this.scale=this.zoomScale(m),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,m,x){this._unmodified=!1,this._edgeInsets.interpolate(c,m,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){let m=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,m)}getVisibleUnwrappedCoordinates(c){let m=[new i.b6(0,c)];if(this._renderWorldCopies){let x=this.pointCoordinate(new i.P(0,0)),v=this.pointCoordinate(new i.P(this.width,0)),S=this.pointCoordinate(new i.P(this.width,this.height)),L=this.pointCoordinate(new i.P(0,this.height)),F=Math.floor(Math.min(x.x,v.x,S.x,L.x)),Y=Math.floor(Math.max(x.x,v.x,S.x,L.x)),re=1;for(let se=F-re;se<=Y+re;se++)se!==0&&m.push(new i.b6(se,c))}return m}coveringTiles(c){var m,x;let v=this.coveringZoomLevel(c),S=v;if(c.minzoom!==void 0&&v<c.minzoom)return[];c.maxzoom!==void 0&&v>c.maxzoom&&(v=c.maxzoom);let L=this.pointCoordinate(this.getCameraPoint()),F=i.U.fromLngLat(this.center),Y=Math.pow(2,v),re=[Y*L.x,Y*L.y,0],se=[Y*F.x,Y*F.y,0],le=Xo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),xe=c.minzoom||0;!c.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(xe=v);let Ne=c.terrain?2/Math.min(this.tileSize,c.tileSize)*this.tileSize:3,De=$e=>({aabb:new Gc([$e*Y,0,0],[($e+1)*Y,Y,0]),zoom:0,x:0,y:0,wrap:$e,fullyVisible:!1}),Ze=[],ze=[],nt=v,_t=c.reparseOverscaled?S:v;if(this._renderWorldCopies)for(let $e=1;$e<=3;$e++)Ze.push(De(-$e)),Ze.push(De($e));for(Ze.push(De(0));Ze.length>0;){let $e=Ze.pop(),st=$e.x,wt=$e.y,Mt=$e.fullyVisible;if(!Mt){let Er=$e.aabb.intersects(le);if(Er===0)continue;Mt=Er===2}let Pt=c.terrain?re:se,Vt=$e.aabb.distanceX(Pt),zt=$e.aabb.distanceY(Pt),Gt=Math.max(Math.abs(Vt),Math.abs(zt));if($e.zoom===nt||Gt>Ne+(1<<nt-$e.zoom)-2&&$e.zoom>=xe){let Er=nt-$e.zoom,pn=re[0]-.5-(st<<Er),er=re[1]-.5-(wt<<Er);ze.push({tileID:new i.O($e.zoom===nt?_t:$e.zoom,$e.wrap,$e.zoom,st,wt),distanceSq:J([se[0]-.5-st,se[1]-.5-wt]),tileDistanceToCamera:Math.sqrt(pn*pn+er*er)})}else for(let Er=0;Er<4;Er++){let pn=(st<<1)+Er%2,er=(wt<<1)+(Er>>1),I=$e.zoom+1,O=$e.aabb.quadrant(Er);if(c.terrain){let z=new i.O(I,$e.wrap,I,pn,er),Z=c.terrain.getMinMaxElevation(z),H=(m=Z.minElevation)!==null&&m!==void 0?m:this.elevation,K=(x=Z.maxElevation)!==null&&x!==void 0?x:this.elevation;O=new Gc([O.min[0],O.min[1],H],[O.max[0],O.max[1],K])}Ze.push({aabb:O,zoom:I,x:pn,y:er,wrap:$e.wrap,fullyVisible:Mt})}}return ze.sort(($e,st)=>$e.distanceSq-st.distanceSq).map($e=>$e.tileID)}resize(c,m){this.width=c,this.height=m,this.pixelsToGLUnits=[2/c,-2/m],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){let m=i.ad(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new i.P(i.G(c.lng)*this.worldSize,i.H(m)*this.worldSize)}unproject(c){return new i.U(c.x/this.worldSize,c.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(c){let m=this.pointLocation(this.centerPoint,c),x=c.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-x))return;let v=this.getCameraPosition(),S=i.U.fromLngLat(v.lngLat,v.altitude),L=i.U.fromLngLat(m,x),F=S.x-L.x,Y=S.y-L.y,re=S.z-L.z,se=Math.sqrt(F*F+Y*Y+re*re),le=this.scaleZoom(this.cameraToCenterDistance/se/this.tileSize);this._elevation=x,this._center=m,this.zoom=le}setLocationAtPoint(c,m){let x=this.pointCoordinate(m),v=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),L=new i.U(S.x-(x.x-v.x),S.y-(x.y-v.y));this.center=this.coordinateLocation(L),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(c,m){return m?this.coordinatePoint(this.locationCoordinate(c),m.getElevationForLngLatZoom(c,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(c))}pointLocation(c,m){return this.coordinateLocation(this.pointCoordinate(c,m))}locationCoordinate(c){return i.U.fromLngLat(c)}coordinateLocation(c){return c&&c.toLngLat()}pointCoordinate(c,m){if(m){let xe=m.pointCoordinate(c);if(xe!=null)return xe}let x=[c.x,c.y,0,1],v=[c.x,c.y,1,1];i.ag(x,x,this.pixelMatrixInverse),i.ag(v,v,this.pixelMatrixInverse);let S=x[3],L=v[3],F=x[1]/S,Y=v[1]/L,re=x[2]/S,se=v[2]/L,le=re===se?0:(0-re)/(se-re);return new i.U(i.B.number(x[0]/S,v[0]/L,le)/this.worldSize,i.B.number(F,Y,le)/this.worldSize)}coordinatePoint(c,m=0,x=this.pixelMatrix){let v=[c.x*this.worldSize,c.y*this.worldSize,m,1];return i.ag(v,v,x),new i.P(v[0]/v[3],v[1]/v[3])}getBounds(){let c=Math.max(0,this.height/2-this.getHorizon());return new St().extend(this.pointLocation(new i.P(0,c))).extend(this.pointLocation(new i.P(this.width,c))).extend(this.pointLocation(new i.P(this.width,this.height))).extend(this.pointLocation(new i.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new St([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(c,m=!1){let x=c.key,v=m?this._alignedPosMatrixCache:this._posMatrixCache;if(v[x])return v[x];let S=c.canonical,L=this.worldSize/this.zoomScale(S.z),F=S.x+Math.pow(2,S.z)*c.wrap,Y=i.ao(new Float64Array(16));return i.$(Y,Y,[F*L,S.y*L,0]),i.a0(Y,Y,[L/i.N,L/i.N,1]),i.a1(Y,m?this.alignedProjMatrix:this.projMatrix,Y),v[x]=new Float32Array(Y),v[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let c,m,x,v,S=-90,L=90,F=-180,Y=180,re=this.size,se=this._unmodified;if(this.latRange){let Ne=this.latRange;S=i.H(Ne[1])*this.worldSize,L=i.H(Ne[0])*this.worldSize,c=L-S<re.y?re.y/(L-S):0}if(this.lngRange){let Ne=this.lngRange;F=i.b5(i.G(Ne[0])*this.worldSize,0,this.worldSize),Y=i.b5(i.G(Ne[1])*this.worldSize,0,this.worldSize),Y<F&&(Y+=this.worldSize),m=Y-F<re.x?re.x/(Y-F):0}let le=this.point,xe=Math.max(m||0,c||0);if(xe)return this.center=this.unproject(new i.P(m?(Y+F)/2:le.x,c?(L+S)/2:le.y)),this.zoom+=this.scaleZoom(xe),this._unmodified=se,void(this._constraining=!1);if(this.latRange){let Ne=le.y,De=re.y/2;Ne-De<S&&(v=S+De),Ne+De>L&&(v=L-De)}if(this.lngRange){let Ne=(F+Y)/2,De=i.b5(le.x,Ne-this.worldSize/2,Ne+this.worldSize/2),Ze=re.x/2;De-Ze<F&&(x=F+Ze),De+Ze>Y&&(x=Y-Ze)}x===void 0&&v===void 0||(this.center=this.unproject(new i.P(x!==void 0?x:le.x,v!==void 0?v:le.y)).wrap()),this._unmodified=se,this._constraining=!1}_calcMatrices(){if(!this.height)return;let c=this.centerOffset,m=this.point.x,x=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=i.b7(1,this.center.lat)*this.worldSize;let v=i.ao(new Float64Array(16));i.a0(v,v,[this.width/2,-this.height/2,1]),i.$(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=i.ao(new Float64Array(16)),i.a0(v,v,[1,-1,1]),i.$(v,v,[-1,-1,0]),i.a0(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;let S=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),L=Math.min(this.elevation,this._minEleveationForCurrentTile),F=S-L*this._pixelPerMeter/Math.cos(this._pitch),Y=L<0?F:S,re=Math.PI/2+this._pitch,se=this._fov*(.5+c.y/this.height),le=Math.sin(se)*Y/Math.sin(i.ad(Math.PI-re-se,.01,Math.PI-.01)),xe=this.getHorizon(),Ne=2*Math.atan(xe/this.cameraToCenterDistance)*(.5+c.y/(2*xe)),De=Math.sin(Ne)*Y/Math.sin(i.ad(Math.PI-re-Ne,.01,Math.PI-.01)),Ze=Math.min(le,De),ze=1.01*(Math.cos(Math.PI/2-this._pitch)*Ze+Y),nt=this.height/50;v=new Float64Array(16),i.b8(v,this._fov,this.width/this.height,nt,ze),v[8]=2*-c.x/this.width,v[9]=2*c.y/this.height,i.a0(v,v,[1,-1,1]),i.$(v,v,[0,0,-this.cameraToCenterDistance]),i.b9(v,v,this._pitch),i.ae(v,v,this.angle),i.$(v,v,[-m,-x,0]),this.mercatorMatrix=i.a0([],v,[this.worldSize,this.worldSize,this.worldSize]),i.a0(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=i.a1(new Float64Array(16),this.labelPlaneMatrix,v),i.$(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=i.as([],v),this.pixelMatrix3D=i.a1(new Float64Array(16),this.labelPlaneMatrix,v);let _t=this.width%2/2,$e=this.height%2/2,st=Math.cos(this.angle),wt=Math.sin(this.angle),Mt=m-Math.round(m)+st*_t+wt*$e,Pt=x-Math.round(x)+st*$e+wt*_t,Vt=new Float64Array(v);if(i.$(Vt,Vt,[Mt>.5?Mt-1:Mt,Pt>.5?Pt-1:Pt,0]),this.alignedProjMatrix=Vt,v=i.as(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let c=this.pointCoordinate(new i.P(0,0)),m=[c.x*this.worldSize,c.y*this.worldSize,0,1];return i.ag(m,m,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,c))}getCameraQueryGeometry(c){let m=this.getCameraPoint();if(c.length===1)return[c[0],m];{let x=m.x,v=m.y,S=m.x,L=m.y;for(let F of c)x=Math.min(x,F.x),v=Math.min(v,F.y),S=Math.max(S,F.x),L=Math.max(L,F.y);return[new i.P(x,v),new i.P(S,v),new i.P(S,L),new i.P(x,L),new i.P(x,v)]}}}function ja(M,c){let m,x=!1,v=null,S=null,L=()=>{v=null,x&&(M.apply(S,m),v=setTimeout(L,c),x=!1)};return(...F)=>(x=!0,S=this,m=F,v||L(),v)}class ff{constructor(c){this._getCurrentHash=()=>{let m=window.location.hash.replace("#","");if(this._hashName){let x;return m.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(x=v)}),(x&&x[1]||"").split("/")}return m.split("/")},this._onHashChange=()=>{let m=this._getCurrentHash();if(m.length>=3&&!m.some(x=>isNaN(x))){let x=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:x,pitch:+(m[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let m=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,m)}catch{}},this._updateHash=ja(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(c){let m=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,v=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),L=Math.round(m.lng*S)/S,F=Math.round(m.lat*S)/S,Y=this._map.getBearing(),re=this._map.getPitch(),se="";if(se+=c?`/${L}/${F}/${x}`:`${x}/${F}/${L}`,(Y||re)&&(se+="/"+Math.round(10*Y)/10),re&&(se+=`/${Math.round(re)}`),this._hashName){let le=this._hashName,xe=!1,Ne=window.location.hash.slice(1).split("&").map(De=>{let Ze=De.split("=")[0];return Ze===le?(xe=!0,`${Ze}=${se}`):De}).filter(De=>De);return xe||Ne.push(`${le}=${se}`),`#${Ne.join("&")}`}return`#${se}`}}let Hc={linearity:.3,easing:i.ba(0,0,.3,1)},w_=i.e({deceleration:2500,maxSpeed:1400},Hc),A_=i.e({deceleration:20,maxSpeed:1400},Hc),M_=i.e({deceleration:1e3,maxSpeed:360},Hc),S_=i.e({deceleration:1e3,maxSpeed:90},Hc);class jh{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.h.now(),settings:c})}_drainInertiaBuffer(){let c=this._inertiaBuffer,m=i.h.now();for(;c.length>0&&m-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let m={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:S}of this._inertiaBuffer)m.zoom+=S.zoomDelta||0,m.bearing+=S.bearingDelta||0,m.pitch+=S.pitchDelta||0,S.panDelta&&m.pan._add(S.panDelta),S.around&&(m.around=S.around),S.pinchAround&&(m.pinchAround=S.pinchAround);let x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(m.pan.mag()){let S=hf(m.pan.mag(),x,i.e({},w_,c||{}));v.offset=m.pan.mult(S.amount/m.pan.mag()),v.center=this._map.transform.center,Hs(v,S)}if(m.zoom){let S=hf(m.zoom,x,A_);v.zoom=this._map.transform.zoom+S.amount,Hs(v,S)}if(m.bearing){let S=hf(m.bearing,x,M_);v.bearing=this._map.transform.bearing+i.ad(S.amount,-179,179),Hs(v,S)}if(m.pitch){let S=hf(m.pitch,x,S_);v.pitch=this._map.transform.pitch+S.amount,Hs(v,S)}if(v.zoom||v.bearing){let S=m.pinchAround===void 0?m.around:m.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),i.e(v,{noMoveStart:!0})}}function Hs(M,c){(!M.duration||M.duration<c.duration)&&(M.duration=c.duration,M.easing=c.easing)}function hf(M,c,m){let{maxSpeed:x,linearity:v,deceleration:S}=m,L=i.ad(M*v/(c/1e3),-x,x),F=Math.abs(L)/(S*v);return{easing:m.easing,duration:1e3*F,amount:L*(F/2)}}class Ko extends i.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,x,v={}){let S=a.mousePos(m.getCanvasContainer(),x),L=m.unproject(S);super(c,i.e({point:S,lngLat:L,originalEvent:x},v)),this._defaultPrevented=!1,this.target=m}}class df extends i.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,x){let v=c==="touchend"?x.changedTouches:x.touches,S=a.touchPos(m.getCanvasContainer(),v),L=S.map(Y=>m.unproject(Y)),F=S.reduce((Y,re,se,le)=>Y.add(re.div(le.length)),new i.P(0,0));super(c,{points:S,point:F,lngLats:L,lngLat:m.unproject(F),originalEvent:x}),this._defaultPrevented=!1}}class em extends i.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,m,x){super(c,{originalEvent:x}),this._defaultPrevented=!1}}class T_{constructor(c,m){this._map=c,this._clickTolerance=m.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new em(c.type,this._map,c))}mousedown(c,m){return this._mousedownPos=m,this._firePreventable(new Ko(c.type,this._map,c))}mouseup(c){this._map.fire(new Ko(c.type,this._map,c))}click(c,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||this._map.fire(new Ko(c.type,this._map,c))}dblclick(c){return this._firePreventable(new Ko(c.type,this._map,c))}mouseover(c){this._map.fire(new Ko(c.type,this._map,c))}mouseout(c){this._map.fire(new Ko(c.type,this._map,c))}touchstart(c){return this._firePreventable(new df(c.type,this._map,c))}touchmove(c){this._map.fire(new df(c.type,this._map,c))}touchend(c){this._map.fire(new df(c.type,this._map,c))}touchcancel(c){this._map.fire(new df(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new Ko(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new Ko(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ua{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.pointLocation(i.P.convert(c),this._map.terrain)}}class E_{constructor(c,m){this._map=c,this._tr=new Ua(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,m){this.isEnabled()&&c.shiftKey&&c.button===0&&(a.disableDrag(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(c,m){if(!this._active)return;let x=m;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;let v=this._startPos;this._lastPos=x,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));let S=Math.min(v.x,x.x),L=Math.max(v.x,x.x),F=Math.min(v.y,x.y),Y=Math.max(v.y,x.y);a.setTransform(this._box,`translate(${S}px,${F}px)`),this._box.style.width=L-S+"px",this._box.style.height=Y-F+"px"}mouseupWindow(c,m){if(!this._active||c.button!==0)return;let x=this._startPos,v=m;if(this.reset(),a.suppressClick(),x.x!==v.x||x.y!==v.y)return this._map.fire(new i.k("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(x,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,m){return this._map.fire(new i.k(c,{originalEvent:m}))}}function Es(M,c){if(M.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${M.length}, points ${c.length}`);let m={};for(let x=0;x<M.length;x++)m[M[x].identifier]=c[x];return m}class Va{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,m,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),x.length===this.numTouches&&(this.centroid=function(v){let S=new i.P(0,0);for(let L of v)S._add(L);return S.div(v.length)}(m),this.touches=Es(x,m)))}touchmove(c,m,x){if(this.aborted||!this.centroid)return;let v=Es(x,m);for(let S in this.touches){let L=v[S];(!L||L.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,m,x){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Vh{constructor(c){this.singleTap=new Va(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,m,x){this.singleTap.touchstart(c,m,x)}touchmove(c,m,x){this.singleTap.touchmove(c,m,x)}touchend(c,m,x){let v=this.singleTap.touchend(c,m,x);if(v){let S=c.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(v)<30;if(S&&L||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Wa{constructor(c){this._tr=new Ua(c),this._zoomIn=new Vh({numTouches:1,numTaps:2}),this._zoomOut=new Vh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,m,x){this._zoomIn.touchstart(c,m,x),this._zoomOut.touchstart(c,m,x)}touchmove(c,m,x){this._zoomIn.touchmove(c,m,x),this._zoomOut.touchmove(c,m,x)}touchend(c,m,x){let v=this._zoomIn.touchend(c,m,x),S=this._zoomOut.touchend(c,m,x),L=this._tr;return v?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:L.zoom+1,around:L.unproject(v)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:L.zoom-1,around:L.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xs{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(...c){let m=this._moveFunction(...c);if(m.bearingDelta||m.pitchDelta||m.around||m.panDelta)return this._active=!0,m}dragStart(c,m){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=m.length?m[0]:m,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,m){if(!this.isEnabled())return;let x=this._lastPoint;if(!x)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);let v=m.length?m[0]:m;return!this._moved&&v.dist(x)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(x,v))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&a.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let tm={0:1,2:2};class pf{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){let m=a.mouseButton(c);this._eventButton=m}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(m,x){let v=tm[x];return m.buttons===void 0||(m.buttons&v)!==v}(c,this._eventButton)}isValidEndEvent(c){return a.mouseButton(c)===this._eventButton}}class rm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}let mf=M=>{M.mousedown=M.dragStart,M.mousemoveWindow=M.dragMove,M.mouseup=M.dragEnd,M.contextmenu=function(c){c.preventDefault()}},Xc=({enable:M,clickTolerance:c,bearingDegreesPerPixelMoved:m=.8})=>{let x=new pf({checkCorrectEvent:v=>a.mouseButton(v)===0&&v.ctrlKey||a.mouseButton(v)===2});return new Xs({clickTolerance:c,move:(v,S)=>({bearingDelta:(S.x-v.x)*m}),moveStateManager:x,enable:M,assignEvents:mf})},Za=({enable:M,clickTolerance:c,pitchDegreesPerPixelMoved:m=-.5})=>{let x=new pf({checkCorrectEvent:v=>a.mouseButton(v)===0&&v.ctrlKey||a.mouseButton(v)===2});return new Xs({clickTolerance:c,move:(v,S)=>({pitchDelta:(S.y-v.y)*m}),moveStateManager:x,enable:M,assignEvents:mf})};class _r{constructor(c,m){this._minTouches=c.cooperativeGestures?2:1,this._clickTolerance=c.clickTolerance||1,this._map=m,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(c,m,x){return this._calculateTransform(c,m,x)}touchmove(c,m,x){if(this._map._cooperativeGestures&&(this._minTouches===2&&x.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(c,!1,x.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(x.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,m,x)}touchend(c,m,x){this._calculateTransform(c,m,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,m,x){x.length>0&&(this._active=!0);let v=Es(x,m),S=new i.P(0,0),L=new i.P(0,0),F=0;for(let re in v){let se=v[re],le=this._touches[re];le&&(S._add(se),L._add(se.sub(le)),F++,v[re]=se)}if(this._touches=v,F<this._minTouches||!L.mag())return;let Y=L.div(F);return this._sum._add(Y),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(F),panDelta:Y}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,m,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([m[0],m[1]]))}touchmove(c,m,x){if(!this._firstTwoTouches)return;c.preventDefault();let[v,S]=this._firstTwoTouches,L=ml(x,m,v),F=ml(x,m,S);if(!L||!F)return;let Y=this._aroundCenter?null:L.add(F).div(2);return this._move([L,F],Y,c)}touchend(c,m,x){if(!this._firstTwoTouches)return;let[v,S]=this._firstTwoTouches,L=ml(x,m,v),F=ml(x,m,S);L&&F||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ml(M,c,m){for(let x=0;x<M.length;x++)if(M[x].identifier===m)return c[x]}function Kc(M,c){return Math.log(M/c)/Math.LN2}class I_ extends Wh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,m){let x=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,x),pinchAround:m}}}function ir(M,c){return 180*M.angleWith(c)/Math.PI}class nm extends Wh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,m){let x=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ir(this._vector,x),pinchAround:m}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());let m=25/(Math.PI*this._minDiameter)*360,x=ir(c,this._startVector);return Math.abs(x)<m}}function im(M){return Math.abs(M.y)>Math.abs(M.x)}class gl extends Wh{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,m,x){super.touchstart(c,m,x),this._currentTouchCount=x.length}_start(c){this._lastPoints=c,im(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,m,x){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let v=c[0].sub(this._lastPoints[0]),S=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,S,x.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(c,m,x){if(this._valid!==void 0)return this._valid;let v=c.mag()>=2,S=m.mag()>=2;if(!v&&!S)return;if(!v||!S)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;let L=c.y>0==m.y>0;return im(c)&&im(m)&&L}}let om={panStep:100,bearingStep:15,pitchStep:10};class C_{constructor(c){this._tr=new Ua(c);let m=om;this._panStep=m.panStep,this._bearingStep=m.bearingStep,this._pitchStep=m.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let m=0,x=0,v=0,S=0,L=0;switch(c.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:c.shiftKey?x=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?x=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?v=1:(c.preventDefault(),L=-1);break;case 40:c.shiftKey?v=-1:(c.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(x=0,v=0),{cameraAnimation:F=>{let Y=this._tr;F.easeTo({duration:300,easeId:"keyboardHandler",easing:Zh,zoom:m?Math.round(Y.zoom)+m*(c.shiftKey?2:1):Y.zoom,bearing:Y.bearing+x*this._bearingStep,pitch:Y.pitch+v*this._pitchStep,offset:[-S*this._panStep,-L*this._panStep],center:Y.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zh(M){return M*(2-M)}let k_=4.000244140625;class sm{constructor(c,m){this._onTimeout=x=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(x)},this._map=c,this._tr=new Ua(c),this._el=c.getCanvasContainer(),this._triggerRenderFrame=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!c[this._map._metaKey])return;c.preventDefault()}let m=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,x=i.h.now(),v=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,m!==0&&m%k_==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(v*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),c.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=c,this._delta-=m,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let m=a.mousePos(this._el,c),x=this._tr;this._around=i.L.convert(this._aroundCenter?x.center:x.unproject(m)),this._aroundPoint=x.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let c=this._tr.transform;if(this._delta!==0){let F=this._type==="wheel"&&Math.abs(this._delta)>k_?this._wheelZoomRate:this._defaultZoomRate,Y=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&Y!==0&&(Y=1/Y);let re=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(re*Y))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let m=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,x=this._startZoom,v=this._easing,S,L=!1;if(this._type==="wheel"&&x&&v){let F=Math.min((i.h.now()-this._lastWheelEventTime)/200,1),Y=v(F);S=i.B.number(x,m,Y),F<1?this._frameId||(this._frameId=!0):L=!0}else S=m,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:S-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let m=i.bb;if(this._prevEase){let x=this._prevEase,v=(i.h.now()-x.start)/x.duration,S=x.easing(v+.01)-x.easing(v),L=.27/Math.sqrt(S*S+1e-4)*.01,F=Math.sqrt(.0729-L*L);m=i.ba(L,F,.25,1)}return this._prevEase={start:i.h.now(),duration:c,easing:m},m}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class am{constructor(c,m){this._clickZoom=c,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $c{constructor(c){this._tr=new Ua(c),this.reset()}reset(){this._active=!1}dblclick(c,m){return c.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(m)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yh{constructor(){this._tap=new Vh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,m,x){if(!this._swipePoint)if(this._tapTime){let v=m[0],S=c.timeStamp-this._tapTime<500,L=this._tapPoint.dist(v)<30;S&&L?x.length>0&&(this._swipePoint=v,this._swipeTouch=x[0].identifier):this.reset()}else this._tap.touchstart(c,m,x)}touchmove(c,m,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;let v=m[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,m,x)}touchend(c,m,x){if(this._tapTime)this._swipePoint&&x.length===0&&this.reset();else{let v=this._tap.touchend(c,m,x);v&&(this._tapTime=c.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lm{constructor(c,m,x){this._el=c,this._mousePan=m,this._touchPan=x}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $o{constructor(c,m,x){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=m,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _l{constructor(c,m,x,v){this._el=c,this._touchZoom=m,this._touchRotate=x,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Qc=M=>M.zoom||M.drag||M.pitch||M.rotate;class qh extends i.k{}function Jc(M){return M.panDelta&&M.panDelta.mag()||M.zoomDelta||M.bearingDelta||M.pitchDelta}class cm{constructor(c,m){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,S)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let L=v.type==="renderFrame"?void 0:v,F={needsRenderFrame:!1},Y={},re={},se=v.touches,le=se?this._getMapTouches(se):void 0,xe=le?a.touchPos(this._el,le):a.mousePos(this._el,v);for(let{handlerName:Ze,handler:ze,allowed:nt}of this._handlers){if(!ze.isEnabled())continue;let _t;this._blockedByActive(re,nt,Ze)?ze.reset():ze[S||v.type]&&(_t=ze[S||v.type](v,xe,le),this.mergeHandlerResult(F,Y,_t,Ze,L),_t&&_t.needsRenderFrame&&this._triggerRenderFrame()),(_t||ze.isActive())&&(re[Ze]=ze)}let Ne={};for(let Ze in this._previousActiveHandlers)re[Ze]||(Ne[Ze]=L);this._previousActiveHandlers=re,(Object.keys(Ne).length||Jc(F))&&(this._changes.push([F,Y,Ne]),this._triggerRenderFrame()),(Object.keys(re).length||Jc(F))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:De}=F;De&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],De(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jh(c),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(m);let x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,S,L]of this._listeners)a.addEventListener(v,S,v===document?this.handleWindowEvent:this.handleEvent,L)}destroy(){for(let[c,m,x]of this._listeners)a.removeEventListener(c,m,c===document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(c){let m=this._map,x=m.getCanvasContainer();this._add("mapEvent",new T_(m,c));let v=m.boxZoom=new E_(m,c);this._add("boxZoom",v),c.interactive&&c.boxZoom&&v.enable();let S=new Wa(m),L=new $c(m);m.doubleClickZoom=new am(L,S),this._add("tapZoom",S),this._add("clickZoom",L),c.interactive&&c.doubleClickZoom&&m.doubleClickZoom.enable();let F=new Yh;this._add("tapDragZoom",F);let Y=m.touchPitch=new gl(m);this._add("touchPitch",Y),c.interactive&&c.touchPitch&&m.touchPitch.enable(c.touchPitch);let re=Xc(c),se=Za(c);m.dragRotate=new $o(c,re,se),this._add("mouseRotate",re,["mousePitch"]),this._add("mousePitch",se,["mouseRotate"]),c.interactive&&c.dragRotate&&m.dragRotate.enable();let le=(({enable:nt,clickTolerance:_t})=>{let $e=new pf({checkCorrectEvent:st=>a.mouseButton(st)===0&&!st.ctrlKey});return new Xs({clickTolerance:_t,move:(st,wt)=>({around:wt,panDelta:wt.sub(st)}),activateOnStart:!0,moveStateManager:$e,enable:nt,assignEvents:mf})})(c),xe=new _r(c,m);m.dragPan=new lm(x,le,xe),this._add("mousePan",le),this._add("touchPan",xe,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&m.dragPan.enable(c.dragPan);let Ne=new nm,De=new I_;m.touchZoomRotate=new _l(x,De,Ne,F),this._add("touchRotate",Ne,["touchPan","touchZoom"]),this._add("touchZoom",De,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&m.touchZoomRotate.enable(c.touchZoomRotate);let Ze=m.scrollZoom=new sm(m,()=>this._triggerRenderFrame());this._add("scrollZoom",Ze,["mousePan"]),c.interactive&&c.scrollZoom&&m.scrollZoom.enable(c.scrollZoom);let ze=m.keyboard=new C_(m);this._add("keyboard",ze),c.interactive&&c.keyboard&&m.keyboard.enable(),this._add("blockableMapEvent",new Uh(m))}_add(c,m,x){this._handlers.push({handlerName:c,handler:m,allowed:x}),this._handlersById[c]=m}stop(c){if(!this._updatingCamera){for(let{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(let{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qc(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,m,x){for(let v in c)if(v!==x&&(!m||m.indexOf(v)<0))return!0;return!1}_getMapTouches(c){let m=[];for(let x of c)this._el.contains(x.target)&&m.push(x);return m}mergeHandlerResult(c,m,x,v,S){if(!x)return;i.e(c,x);let L={handlerName:v,originalEvent:x.originalEvent||S};x.zoomDelta!==void 0&&(m.zoom=L),x.panDelta!==void 0&&(m.drag=L),x.pitchDelta!==void 0&&(m.pitch=L),x.bearingDelta!==void 0&&(m.rotate=L)}_applyChanges(){let c={},m={},x={};for(let[v,S,L]of this._changes)v.panDelta&&(c.panDelta=(c.panDelta||new i.P(0,0))._add(v.panDelta)),v.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(c.around=v.around),v.pinchAround!==void 0&&(c.pinchAround=v.pinchAround),v.noInertia&&(c.noInertia=v.noInertia),i.e(m,S),i.e(x,L);this._updateMapTransform(c,m,x),this._changes=[]}_updateMapTransform(c,m,x){let v=this._map,S=v._getTransformForUpdate(),L=v.terrain;if(!(Jc(c)||L&&this._terrainMovement))return this._fireEvents(m,x,!0);let{panDelta:F,zoomDelta:Y,bearingDelta:re,pitchDelta:se,around:le,pinchAround:xe}=c;xe!==void 0&&(le=xe),v._stop(!0),le=le||v.transform.centerPoint;let Ne=S.pointLocation(F?le.sub(F):le);re&&(S.bearing+=re),se&&(S.pitch+=se),Y&&(S.zoom+=Y),L?this._terrainMovement||!m.drag&&!m.zoom?m.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(F)):S.setLocationAtPoint(Ne,le):(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(Ne,le),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,S.recalculateZoom(v.terrain)})):S.setLocationAtPoint(Ne,le),v._applyUpdatedTransform(S),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(m,x,!0)}_fireEvents(c,m,x){let v=Qc(this._eventsInProgress),S=Qc(c),L={};for(let se in c){let{originalEvent:le}=c[se];this._eventsInProgress[se]||(L[`${se}start`]=le),this._eventsInProgress[se]=c[se]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(let se in L)this._fireEvent(se,L[se]);S&&this._fireEvent("move",S.originalEvent);for(let se in c){let{originalEvent:le}=c[se];this._fireEvent(se,le)}let F={},Y;for(let se in this._eventsInProgress){let{handlerName:le,originalEvent:xe}=this._eventsInProgress[se];this._handlersById[le].isActive()||(delete this._eventsInProgress[se],Y=m[le]||xe,F[`${se}end`]=Y)}for(let se in F)this._fireEvent(se,F[se]);let re=Qc(this._eventsInProgress);if(x&&(v||S)&&!re){this._updatingCamera=!0;let se=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),le=xe=>xe!==0&&-this._bearingSnap<xe&&xe<this._bearingSnap;!se||!se.essential&&i.h.prefersReducedMotion?(this._map.fire(new i.k("moveend",{originalEvent:Y})),le(this._map.getBearing())&&this._map.resetNorth()):(le(se.bearing||this._map.getBearing())&&(se.bearing=0),se.freezeElevation=!0,this._map.easeTo(se,{originalEvent:Y})),this._updatingCamera=!1}}_fireEvent(c,m){this._map.fire(new i.k(c,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new qh("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class um extends i.E{constructor(c,m){super(),this._renderFrameCallback=()=>{let x=Math.min((i.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=m.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new i.L(this.transform.center.lng,this.transform.center.lat)}setCenter(c,m){return this.jumpTo({center:c},m)}panBy(c,m,x){return c=i.P.convert(c).mult(-1),this.panTo(this.transform.center,i.e({offset:c},m),x)}panTo(c,m,x){return this.easeTo(i.e({center:c},m),x)}getZoom(){return this.transform.zoom}setZoom(c,m){return this.jumpTo({zoom:c},m),this}zoomTo(c,m,x){return this.easeTo(i.e({zoom:c},m),x)}zoomIn(c,m){return this.zoomTo(this.getZoom()+1,c,m),this}zoomOut(c,m){return this.zoomTo(this.getZoom()-1,c,m),this}getBearing(){return this.transform.bearing}setBearing(c,m){return this.jumpTo({bearing:c},m),this}getPadding(){return this.transform.padding}setPadding(c,m){return this.jumpTo({padding:c},m),this}rotateTo(c,m,x){return this.easeTo(i.e({bearing:c},m),x)}resetNorth(c,m){return this.rotateTo(0,i.e({duration:1e3},c),m),this}resetNorthPitch(c,m){return this.easeTo(i.e({bearing:0,pitch:0,duration:1e3},c),m),this}snapToNorth(c,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,m):this}getPitch(){return this.transform.pitch}setPitch(c,m){return this.jumpTo({pitch:c},m),this}cameraForBounds(c,m){c=St.convert(c);let x=m&&m.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),x,m)}_cameraForBoxAndBearing(c,m,x,v){let S={top:0,bottom:0,right:0,left:0};if(typeof(v=i.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){let wt=v.padding;v.padding={top:wt,bottom:wt,right:wt,left:wt}}v.padding=i.e(S,v.padding);let L=this.transform,F=L.padding,Y=L.project(i.L.convert(c)),re=L.project(i.L.convert(m)),se=Y.rotate(-x*Math.PI/180),le=re.rotate(-x*Math.PI/180),xe=new i.P(Math.max(se.x,le.x),Math.max(se.y,le.y)),Ne=new i.P(Math.min(se.x,le.x),Math.min(se.y,le.y)),De=xe.sub(Ne),Ze=(L.width-(F.left+F.right+v.padding.left+v.padding.right))/De.x,ze=(L.height-(F.top+F.bottom+v.padding.top+v.padding.bottom))/De.y;if(ze<0||Ze<0)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let nt=Math.min(L.scaleZoom(L.scale*Math.min(Ze,ze)),v.maxZoom),_t=i.P.convert(v.offset),$e=new i.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(x*Math.PI/180),st=_t.add($e).mult(L.scale/L.zoomScale(nt));return{center:L.unproject(Y.add(re).div(2).sub(st)),zoom:nt,bearing:x}}fitBounds(c,m,x){return this._fitInternal(this.cameraForBounds(c,m),m,x)}fitScreenCoordinates(c,m,x,v,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(i.P.convert(c)),this.transform.pointLocation(i.P.convert(m)),x,v),v,S)}_fitInternal(c,m,x){return c?(delete(m=i.e(c,m)).padding,m.linear?this.easeTo(m,x):this.flyTo(m,x)):this}jumpTo(c,m){this.stop();let x=this._getTransformForUpdate(),v=!1,S=!1,L=!1;return"zoom"in c&&x.zoom!==+c.zoom&&(v=!0,x.zoom=+c.zoom),c.center!==void 0&&(x.center=i.L.convert(c.center)),"bearing"in c&&x.bearing!==+c.bearing&&(S=!0,x.bearing=+c.bearing),"pitch"in c&&x.pitch!==+c.pitch&&(L=!0,x.pitch=+c.pitch),c.padding==null||x.isPaddingEqual(c.padding)||(x.padding=c.padding),this._applyUpdatedTransform(x),this.fire(new i.k("movestart",m)).fire(new i.k("move",m)),v&&this.fire(new i.k("zoomstart",m)).fire(new i.k("zoom",m)).fire(new i.k("zoomend",m)),S&&this.fire(new i.k("rotatestart",m)).fire(new i.k("rotate",m)).fire(new i.k("rotateend",m)),L&&this.fire(new i.k("pitchstart",m)).fire(new i.k("pitch",m)).fire(new i.k("pitchend",m)),this.fire(new i.k("moveend",m))}calculateCameraOptionsFromTo(c,m,x,v=0){let S=i.U.fromLngLat(c,m),L=i.U.fromLngLat(x,v),F=L.x-S.x,Y=L.y-S.y,re=L.z-S.z,se=Math.hypot(F,Y,re);if(se===0)throw new Error("Can't calculate camera options with same From and To");let le=Math.hypot(F,Y),xe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/se/this.transform.tileSize),Ne=180*Math.atan2(F,-Y)/Math.PI,De=180*Math.acos(le/se)/Math.PI;return De=re<0?90-De:90+De,{center:L.toLngLat(),zoom:xe,pitch:De,bearing:Ne}}easeTo(c,m){this._stop(!1,c.easeId),((c=i.e({offset:[0,0],duration:500,easing:i.bb},c)).animate===!1||!c.essential&&i.h.prefersReducedMotion)&&(c.duration=0);let x=this._getTransformForUpdate(),v=this.getZoom(),S=this.getBearing(),L=this.getPitch(),F=this.getPadding(),Y="zoom"in c?+c.zoom:v,re="bearing"in c?this._normalizeBearing(c.bearing,S):S,se="pitch"in c?+c.pitch:L,le="padding"in c?c.padding:x.padding,xe=i.P.convert(c.offset),Ne=x.centerPoint.add(xe),De=x.pointLocation(Ne),Ze=i.L.convert(c.center||De);this._normalizeCenter(Ze);let ze=x.project(De),nt=x.project(Ze).sub(ze),_t=x.zoomScale(Y-v),$e,st;c.around&&($e=i.L.convert(c.around),st=x.locationPoint($e));let wt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Y!==v,this._rotating=this._rotating||S!==re,this._pitching=this._pitching||se!==L,this._padding=!x.isPaddingEqual(le),this._easeId=c.easeId,this._prepareEase(m,c.noMoveStart,wt),this.terrain&&this._prepareElevation(Ze),this._ease(Mt=>{if(this._zooming&&(x.zoom=i.B.number(v,Y,Mt)),this._rotating&&(x.bearing=i.B.number(S,re,Mt)),this._pitching&&(x.pitch=i.B.number(L,se,Mt)),this._padding&&(x.interpolatePadding(F,le,Mt),Ne=x.centerPoint.add(xe)),this.terrain&&!c.freezeElevation&&this._updateElevation(Mt),$e)x.setLocationAtPoint($e,st);else{let Pt=x.zoomScale(x.zoom-v),Vt=Y>v?Math.min(2,_t):Math.max(.5,_t),zt=Math.pow(Vt,1-Mt),Gt=x.unproject(ze.add(nt.mult(Mt*zt)).mult(Pt));x.setLocationAtPoint(x.renderWorldCopies?Gt.wrap():Gt,Ne)}this._applyUpdatedTransform(x),this._fireMoveEvents(m)},Mt=>{this.terrain&&this._finalizeElevation(),this._afterEase(m,Mt)},c),this}_prepareEase(c,m,x={}){this._moving=!0,m||x.moving||this.fire(new i.k("movestart",c)),this._zooming&&!x.zooming&&this.fire(new i.k("zoomstart",c)),this._rotating&&!x.rotating&&this.fire(new i.k("rotatestart",c)),this._pitching&&!x.pitching&&this.fire(new i.k("pitchstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let m=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&m!==this._elevationTarget){let x=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(x-(m-(x*c+this._elevationStart))/(1-c)),this._elevationTarget=m}this.transform.elevation=i.B.number(this._elevationStart,this._elevationTarget,c)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(c){if(!this.transformCameraUpdate)return;let m=c.clone(),{center:x,zoom:v,pitch:S,bearing:L,elevation:F}=this.transformCameraUpdate(m);x&&(m.center=x),v!==void 0&&(m.zoom=v),S!==void 0&&(m.pitch=S),L!==void 0&&(m.bearing=L),F!==void 0&&(m.elevation=F),this.transform.apply(m)}_fireMoveEvents(c){this.fire(new i.k("move",c)),this._zooming&&this.fire(new i.k("zoom",c)),this._rotating&&this.fire(new i.k("rotate",c)),this._pitching&&this.fire(new i.k("pitch",c))}_afterEase(c,m){if(this._easeId&&m&&this._easeId===m)return;delete this._easeId;let x=this._zooming,v=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new i.k("zoomend",c)),v&&this.fire(new i.k("rotateend",c)),S&&this.fire(new i.k("pitchend",c)),this.fire(new i.k("moveend",c))}flyTo(c,m){if(!c.essential&&i.h.prefersReducedMotion){let O=i.F(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(O,m)}this.stop(),c=i.e({offset:[0,0],speed:1.2,curve:1.42,easing:i.bb},c);let x=this._getTransformForUpdate(),v=this.getZoom(),S=this.getBearing(),L=this.getPitch(),F=this.getPadding(),Y="zoom"in c?i.ad(+c.zoom,x.minZoom,x.maxZoom):v,re="bearing"in c?this._normalizeBearing(c.bearing,S):S,se="pitch"in c?+c.pitch:L,le="padding"in c?c.padding:x.padding,xe=x.zoomScale(Y-v),Ne=i.P.convert(c.offset),De=x.centerPoint.add(Ne),Ze=x.pointLocation(De),ze=i.L.convert(c.center||Ze);this._normalizeCenter(ze);let nt=x.project(Ze),_t=x.project(ze).sub(nt),$e=c.curve,st=Math.max(x.width,x.height),wt=st/xe,Mt=_t.mag();if("minZoom"in c){let O=i.ad(Math.min(c.minZoom,v,Y),x.minZoom,x.maxZoom),z=st/x.zoomScale(O-v);$e=Math.sqrt(z/Mt*2)}let Pt=$e*$e;function Vt(O){let z=(wt*wt-st*st+(O?-1:1)*Pt*Pt*Mt*Mt)/(2*(O?wt:st)*Pt*Mt);return Math.log(Math.sqrt(z*z+1)-z)}function zt(O){return(Math.exp(O)-Math.exp(-O))/2}function Gt(O){return(Math.exp(O)+Math.exp(-O))/2}let Er=Vt(!1),pn=function(O){return Gt(Er)/Gt(Er+$e*O)},er=function(O){return st*((Gt(Er)*(zt(z=Er+$e*O)/Gt(z))-zt(Er))/Pt)/Mt;var z},I=(Vt(!0)-Er)/$e;if(Math.abs(Mt)<1e-6||!isFinite(I)){if(Math.abs(st-wt)<1e-6)return this.easeTo(c,m);let O=wt<st?-1:1;I=Math.abs(Math.log(wt/st))/$e,er=function(){return 0},pn=function(z){return Math.exp(O*$e*z)}}return c.duration="duration"in c?+c.duration:1e3*I/("screenSpeed"in c?+c.screenSpeed/$e:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=S!==re,this._pitching=se!==L,this._padding=!x.isPaddingEqual(le),this._prepareEase(m,!1),this.terrain&&this._prepareElevation(ze),this._ease(O=>{let z=O*I,Z=1/pn(z);x.zoom=O===1?Y:v+x.scaleZoom(Z),this._rotating&&(x.bearing=i.B.number(S,re,O)),this._pitching&&(x.pitch=i.B.number(L,se,O)),this._padding&&(x.interpolatePadding(F,le,O),De=x.centerPoint.add(Ne)),this.terrain&&!c.freezeElevation&&this._updateElevation(O);let H=O===1?ze:x.unproject(nt.add(_t.mult(er(z))).mult(Z));x.setLocationAtPoint(x.renderWorldCopies?H.wrap():H,De),this._applyUpdatedTransform(x),this._fireMoveEvents(m)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(m)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,m)}if(!c){let x=this.handlers;x&&x.stop(!1)}return this}_ease(c,m,x){x.animate===!1||x.duration===0?(c(1),m()):(this._easeStart=i.h.now(),this._easeOptions=x,this._onEaseFrame=c,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,m){c=i.b5(c,-180,180);let x=Math.abs(c-m);return Math.abs(c-360-m)<x&&(c-=360),Math.abs(c+360-m)<x&&(c+=360),c}_normalizeCenter(c){let m=this.transform;if(!m.renderWorldCopies||m.lngRange)return;let x=c.lng-m.center.lng;c.lng+=x>180?-360:x<-180?360:0}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(i.L.convert(c),this.transform.tileZoom)-this.transform.elevation:null}}class Mo{constructor(c={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=m=>{!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"&&m.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options&&this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,m){let x=this._map._getUIString(`AttributionControl.${m}`);c.title=x,c.setAttribute("aria-label",x)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let m=this._map.style.sourceCaches;for(let v in m){let S=m[v];if(S.used||S.usedForTerrain){let L=S.getSource();L.attribution&&c.indexOf(L.attribution)<0&&c.push(L.attribution)}}c=c.filter(v=>String(v).trim()),c.sort((v,S)=>v.length-S.length),c=c.filter((v,S)=>{for(let L=S+1;L<c.length;L++)if(c[L].indexOf(v)>=0)return!1;return!0});let x=c.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,c.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ii{constructor(c={}){this._updateCompact=()=>{let m=this._container.children;if(m.length){let x=m[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&x.classList.add("maplibregl-compact"):x.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");let m=a.create("a","maplibregl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://maplibre.org/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class gf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){let m=++this._id;return this._queue.push({callback:c,id:m,cancelled:!1}),m}remove(c){let m=this._currentlyRunning,x=m?this._queue.concat(m):this._queue;for(let v of x)if(v.id===c)return void(v.cancelled=!0)}run(c=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let m=this._currentlyRunning=this._queue;this._queue=[];for(let x of m)if(!x.cancelled&&(x.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let Gh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var fm=i.Q([{name:"a_pos3d",type:"Int16",components:3}]);class _f extends i.E{constructor(c){super(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,c.usedForTerrain=!0,c.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,m){this.sourceCache.update(c,m),this._renderableTilesKeys=[];let x={};for(let v of c.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:m}))x[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),i.aS(v.posMatrix,0,i.N,0,i.N,0,1),this._tiles[v.key]=new Rn(v,this.tileSize));for(let v in this._tiles)x[v]||delete this._tiles[v]}freeRtt(c){for(let m in this._tiles){let x=this._tiles[m];(!c||x.tileID.equals(c)||x.tileID.isChildOf(c)||c.isChildOf(x.tileID))&&(x.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c){let m={};for(let x of this._renderableTilesKeys){let v=this._tiles[x].tileID;if(v.canonical.equals(c.canonical)){let S=c.clone();S.posMatrix=new Float64Array(16),i.aS(S.posMatrix,0,i.N,0,i.N,0,1),m[x]=S}else if(v.canonical.isChildOf(c.canonical)){let S=c.clone();S.posMatrix=new Float64Array(16);let L=v.canonical.z-c.canonical.z,F=v.canonical.x-(v.canonical.x>>L<<L),Y=v.canonical.y-(v.canonical.y>>L<<L),re=i.N>>L;i.aS(S.posMatrix,0,re,0,re,0,1),i.$(S.posMatrix,S.posMatrix,[-F*re,-Y*re,0]),m[x]=S}else if(c.canonical.isChildOf(v.canonical)){let S=c.clone();S.posMatrix=new Float64Array(16);let L=c.canonical.z-v.canonical.z,F=c.canonical.x-(c.canonical.x>>L<<L),Y=c.canonical.y-(c.canonical.y>>L<<L),re=i.N>>L;i.aS(S.posMatrix,0,i.N,0,i.N,0,1),i.$(S.posMatrix,S.posMatrix,[F*re,Y*re,0]),i.a0(S.posMatrix,S.posMatrix,[1/2**L,1/2**L,0]),m[x]=S}}return m}getSourceTile(c,m){let x=this.sourceCache._source,v=c.overscaledZ-this.deltaZoom;if(v>x.maxzoom&&(v=x.maxzoom),v<x.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(v).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!S||!S.dem)&&m)for(;v>=x.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(c.scaledTo(v--).key);return S}tilesAfterTime(c=Date.now()){return Object.values(this._tiles).filter(m=>m.timeAdded>=c)}}class P_{constructor(c,m,x){this.painter=c,this.sourceCache=new _f(m),this.options=x,this.exaggeration=typeof x.exaggeration=="number"?x.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,m,x,v=i.N){var S;if(!(m>=0&&m<v&&x>=0&&x<v))return 0;let L=this.getTerrainData(c),F=(S=L.tile)===null||S===void 0?void 0:S.dem;if(!F)return 0;let Y=function(De,Ze,ze){var nt=Ze[0],_t=Ze[1];return De[0]=ze[0]*nt+ze[4]*_t+ze[12],De[1]=ze[1]*nt+ze[5]*_t+ze[13],De}([],[m/v*i.N,x/v*i.N],L.u_terrain_matrix),re=[Y[0]*F.dim,Y[1]*F.dim],se=Math.floor(re[0]),le=Math.floor(re[1]),xe=re[0]-se,Ne=re[1]-le;return F.get(se,le)*(1-xe)*(1-Ne)+F.get(se+1,le)*xe*(1-Ne)+F.get(se,le+1)*(1-xe)*Ne+F.get(se+1,le+1)*xe*Ne}getElevationForLngLatZoom(c,m){let{tileID:x,mercatorX:v,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(c,m);return this.getElevation(x,v%i.N,S%i.N,i.N)}getElevation(c,m,x,v=i.N){return this.getDEMElevation(c,m,x,v)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){let v=this.painter.context,S=new i.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new fe(v,S,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new fe(v,new i.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=i.ao([])}let m=this.sourceCache.getSourceTile(c,!0);if(m&&m.dem&&(!m.demTexture||m.needsTerrainPrepare)){let v=this.painter.context;m.demTexture=this.painter.getTileTexture(m.dem.stride),m.demTexture?m.demTexture.update(m.dem.getPixels(),{premultiply:!1}):m.demTexture=new fe(v,m.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),m.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),m.needsTerrainPrepare=!1}let x=m&&m+m.tileID.key+c.key;if(x&&!this._demMatrixCache[x]){let v=this.sourceCache.sourceCache._source.maxzoom,S=c.canonical.z-m.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=v?S=c.canonical.z-v:i.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let L=c.canonical.x-(c.canonical.x>>S<<S),F=c.canonical.y-(c.canonical.y>>S<<S),Y=i.bc(new Float64Array(16),[1/(i.N<<S),1/(i.N<<S),0]);i.$(Y,Y,[L*i.N,F*i.N,0]),this._demMatrixCache[c.key]={matrix:Y,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:m&&m.dem&&m.dem.dim||1,u_terrain_matrix:x?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:m&&m.dem&&m.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(m&&m.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:m}}getFramebuffer(c){let m=this.painter,x=m.width/devicePixelRatio,v=m.height/devicePixelRatio;return!this._fbo||this._fbo.width===x&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new fe(m.context,{width:x,height:v,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new fe(m.context,{width:x,height:v,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=m.context.createFramebuffer(x,v,!0,!1),this._fbo.depthAttachment.set(m.context.createRenderbuffer(m.context.gl.DEPTH_COMPONENT16,x,v))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let m=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,L=0;S<this._coordsTextureSize;S++)for(let F=0;F<this._coordsTextureSize;F++,L+=4)m[L+0]=255&F,m[L+1]=255&S,m[L+2]=F>>8<<4|S>>8,m[L+3]=0;let x=new i.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(m.buffer)),v=new fe(c,x,c.gl.RGBA,{premultiply:!1});return v.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(c){let m=new Uint8Array(4),x=this.painter.context,v=x.gl;x.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,m),x.bindFramebuffer.set(null);let S=m[0]+(m[2]>>4<<8),L=m[1]+((15&m[2])<<8),F=this.coordsIndex[255-m[3]],Y=F&&this.sourceCache.getTileByID(F);if(!Y)return null;let re=this._coordsTextureSize,se=(1<<Y.tileID.canonical.z)*re;return new i.U(this._allowMercatorOverflow(c,(Y.tileID.canonical.x*re+S)/se),(Y.tileID.canonical.y*re+L)/se,this.getElevation(Y.tileID,S,L,re))}getTerrainMesh(){if(this._mesh)return this._mesh;let c=this.painter.context,m=new i.bd,x=new i.b0,v=this.meshSize,S=i.N/v,L=v*v;for(let le=0;le<=v;le++)for(let xe=0;xe<=v;xe++)m.emplaceBack(xe*S,le*S,0);for(let le=0;le<L;le+=v+1)for(let xe=0;xe<v;xe++)x.emplaceBack(xe+le,v+xe+le+1,v+xe+le+2),x.emplaceBack(xe+le,v+xe+le+2,xe+le+1);let F=m.length,Y=F+2*(v+1);for(let le of[0,1])for(let xe=0;xe<=v;xe++)for(let Ne of[0,1])m.emplaceBack(xe*S,le*i.N,Ne);for(let le=0;le<2*v;le+=2)x.emplaceBack(Y+le,Y+le+1,Y+le+3),x.emplaceBack(Y+le,Y+le+3,Y+le+2),x.emplaceBack(F+le,F+le+3,F+le+1),x.emplaceBack(F+le,F+le+2,F+le+3);let re=m.length,se=re+2*(v+1);for(let le of[0,1])for(let xe=0;xe<=v;xe++)for(let Ne of[0,1])m.emplaceBack(le*i.N,xe*S,Ne);for(let le=0;le<2*v;le+=2)x.emplaceBack(re+le,re+le+1,re+le+3),x.emplaceBack(re+le,re+le+3,re+le+2),x.emplaceBack(se+le,se+le+3,se+le+1),x.emplaceBack(se+le,se+le+2,se+le+3);return this._mesh={indexBuffer:c.createIndexBuffer(x),vertexBuffer:c.createVertexBuffer(m,fm.members),segments:i.S.simpleSegment(0,0,m.length,x.length)},this._mesh}getMeshFrameDelta(c){return 2*Math.PI*i.be/Math.pow(2,c)/5}getMinTileElevationForLngLatZoom(c,m){var x;let{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(c,m);return(x=this.getMinMaxElevation(v).minElevation)!==null&&x!==void 0?x:0}getMinMaxElevation(c){let m=this.getTerrainData(c).tile,x={minElevation:null,maxElevation:null};return m&&m.dem&&(x.minElevation=m.dem.min*this.exaggeration,x.maxElevation=m.dem.max*this.exaggeration),x}_getOverscaledTileIDFromLngLatZoom(c,m){let x=i.U.fromLngLat(c.wrap()),v=(1<<m)*i.N,S=x.x*v,L=x.y*v,F=Math.floor(S/i.N),Y=Math.floor(L/i.N);return{tileID:new i.O(m,0,m,F,Y),mercatorX:S,mercatorY:L}}_allowMercatorOverflow(c,m){let x=c.x<this.painter.width/2,v=i.bf(m),S=this.painter.transform.center.lng;return x&&Math.sign(v)>0&&Math.sign(S)<0||!x&&Math.sign(v)<0&&Math.sign(S)>0?(v=360*Math.sign(S)+v,i.G(v)):m}}class Nx{constructor(c,m,x){this._context=c,this._size=m,this._tileSize=x,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){let m=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),x=new fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return x.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),m.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),m.colorAttachment.set(x.texture),{id:c,fbo:m,texture:x,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(m=>c.id!==m),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(let m of this._recentlyUsed)if(!this._objects[m].inUse)return this._objects[m];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(let c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}let Fo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Hh{constructor(c,m){this.painter=c,this.terrain=m,this.pool=new Nx(c.context,30,m.sourceCache.tileSize*m.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,m){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(x=>!c._layers[x].isHidden(m)),this._coordsDescendingInv={};for(let x in c.sourceCaches){this._coordsDescendingInv[x]={};let v=c.sourceCaches[x].getVisibleCoordinates();for(let S of v){let L=this.terrain.sourceCache.getTerrainCoords(S);for(let F in L)this._coordsDescendingInv[x][F]||(this._coordsDescendingInv[x][F]=[]),this._coordsDescendingInv[x][F].push(L[F])}}this._coordsDescendingInvStr={};for(let x of c._order){let v=c._layers[x],S=v.source;if(Fo[v.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(let L in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][L]=this._coordsDescendingInv[S][L].map(F=>F.key).sort().join()}}for(let x of this._renderableTiles)for(let v in this._coordsDescendingInvStr){let S=this._coordsDescendingInvStr[v][x.tileID.key];S&&S!==x.rttCoords[v]&&(x.rtt=[])}}renderLayer(c){if(c.isHidden(this.painter.transform.zoom))return!1;let m=c.type,x=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(Fo[m]&&(this._prevType&&Fo[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(c.id),!v))return!0;if(Fo[this._prevType]||Fo[m]&&v){this._prevType=m;let S=this._stacks.length-1,L=this._stacks[S]||[];for(let F of this._renderableTiles){if(this.pool.isFull()&&(gi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[S]){let re=this.pool.getObjectForId(F.rtt[S].id);if(re.stamp===F.rtt[S].stamp){this.pool.useObject(re);continue}}let Y=this.pool.getOrCreateFreeObject();this.pool.useObject(Y),this.pool.stampObject(Y),F.rtt[S]={id:Y.id,stamp:Y.stamp},x.context.bindFramebuffer.set(Y.fbo.framebuffer),x.context.clear({color:i.aT.transparent,stencil:0}),x.currentStencilSource=void 0;for(let re=0;re<L.length;re++){let se=x.style._layers[L[re]],le=se.source?this._coordsDescendingInv[se.source][F.tileID.key]:[F.tileID];x.context.viewport.set([0,0,Y.fbo.width,Y.fbo.height]),x._renderTileClippingMasks(se,le),x.renderLayer(x,x.style.sourceCaches[se.source],se,le),se.source&&(F.rttCoords[se.source]=this._coordsDescendingInvStr[se.source][F.tileID.key])}}return gi(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fo[m]}return!1}}let Rr=s,Wr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:i.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},yf=M=>{M.touchstart=M.dragStart,M.touchmoveWindow=M.dragMove,M.touchend=M.dragEnd},xf={showCompass:!0,showZoom:!0,visualizePitch:!1};class rc{constructor(c,m,x=!1){this.mousedown=L=>{this.startMouse(i.e({},L,{ctrlKey:!0,preventDefault:()=>L.preventDefault()}),a.mousePos(this.element,L)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=L=>{this.moveMouse(L,a.mousePos(this.element,L))},this.mouseup=L=>{this.mouseRotate.dragEnd(L),this.mousePitch&&this.mousePitch.dragEnd(L),this.offTemp()},this.touchstart=L=>{L.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,L.targetTouches)[0],this.startTouch(L,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=L=>{L.targetTouches.length!==1?this.reset():(this._lastPos=a.touchPos(this.element,L.targetTouches)[0],this.moveTouch(L,this._lastPos))},this.touchend=L=>{L.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let v=c.dragRotate._mouseRotate.getClickTolerance(),S=c.dragRotate._mousePitch.getClickTolerance();this.element=m,this.mouseRotate=Xc({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:L,clickTolerance:F,bearingDegreesPerPixelMoved:Y=.8})=>{let re=new rm;return new Xs({clickTolerance:F,move:(se,le)=>({bearingDelta:(le.x-se.x)*Y}),moveStateManager:re,enable:L,assignEvents:yf})})({clickTolerance:v,enable:!0}),this.map=c,x&&(this.mousePitch=Za({clickTolerance:S,enable:!0}),this.touchPitch=(({enable:L,clickTolerance:F,pitchDegreesPerPixelMoved:Y=-.5})=>{let re=new rm;return new Xs({clickTolerance:F,move:(se,le)=>({pitchDelta:(le.y-se.y)*Y}),moveStateManager:re,enable:L,assignEvents:yf})})({clickTolerance:S,enable:!0})),a.addEventListener(m,"mousedown",this.mousedown),a.addEventListener(m,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(m,"touchcancel",this.reset)}startMouse(c,m){this.mouseRotate.dragStart(c,m),this.mousePitch&&this.mousePitch.dragStart(c,m),a.disableDrag()}startTouch(c,m){this.touchRotate.dragStart(c,m),this.touchPitch&&this.touchPitch.dragStart(c,m),a.disableDrag()}moveMouse(c,m){let x=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(c,m)||{};if(v&&x.setBearing(x.getBearing()+v),this.mousePitch){let{pitchDelta:S}=this.mousePitch.dragMove(c,m)||{};S&&x.setPitch(x.getPitch()+S)}}moveTouch(c,m){let x=this.map,{bearingDelta:v}=this.touchRotate.dragMove(c,m)||{};if(v&&x.setBearing(x.getBearing()+v),this.touchPitch){let{pitchDelta:S}=this.touchPitch.dragMove(c,m)||{};S&&x.setPitch(x.getPitch()+S)}}off(){let c=this.element;a.removeEventListener(c,"mousedown",this.mousedown),a.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let Ni;function hm(M,c,m){if(M=new i.L(M.lng,M.lat),c){let x=new i.L(M.lng-360,M.lat),v=new i.L(M.lng+360,M.lat),S=m.locationPoint(M).distSqr(c);m.locationPoint(x).distSqr(c)<S?M=x:m.locationPoint(v).distSqr(c)<S&&(M=v)}for(;Math.abs(M.lng-m.center.lng)>180;){let x=m.locationPoint(M);if(x.x>=0&&x.y>=0&&x.x<=m.width&&x.y<=m.height)break;M.lng>m.center.lng?M.lng-=360:M.lng+=360}return M}let Is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function O_(M,c,m){let x=M.classList;for(let v in Is)x.remove(`maplibregl-${m}-anchor-${v}`);x.add(`maplibregl-${m}-anchor-${c}`)}class nc extends i.E{constructor(c){if(super(),this._onKeyPress=m=>{let x=m.code,v=m.charCode||m.keyCode;x!=="Space"&&x!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=m=>{let x=m.originalEvent.target,v=this._element;this._popup&&(x===v||v.contains(x))&&this.togglePopup()},this._update=m=>{if(!this._map)return;let x=this._map.loaded()&&!this._map.isMoving();(m?.type==="terrain"||m?.type==="render"&&!x)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=hm(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),m&&m.type!=="moveend"||(this._pos=this._pos.round()),a.setTransform(this._element,`${Is[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${v}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let L=this._map.unproject(this._pos),F=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=L.distanceTo(this._lngLat)>20*F?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=m=>{if(!this._isDragging){let x=this._clickTolerance||this._map._clickTolerance;this._isDragging=m.point.dist(this._pointerdownPos)>=x}this._isDragging&&(this._pos=m.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.k("dragstart"))),this.fire(new i.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new i.k("dragend")),this._state="inactive"},this._addDragHandler=m=>{this._element.contains(m.originalEvent.target)&&(m.preventDefault(),this._positionDelta=m.point.sub(this._pos).add(this._offset),this._pointerdownPos=m.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=i.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div"),this._element.setAttribute("aria-label","Map marker");let m=a.createNS("http://www.w3.org/2000/svg","svg"),x=41,v=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${x}px`),m.setAttributeNS(null,"width",`${v}px`),m.setAttributeNS(null,"viewBox",`0 0 ${v} ${x}`);let S=a.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");let L=a.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"fill-rule","nonzero");let F=a.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");let Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let nt of Y){let _t=a.createNS("http://www.w3.org/2000/svg","ellipse");_t.setAttributeNS(null,"opacity","0.04"),_t.setAttributeNS(null,"cx","10.5"),_t.setAttributeNS(null,"cy","5.80029008"),_t.setAttributeNS(null,"rx",nt.rx),_t.setAttributeNS(null,"ry",nt.ry),F.appendChild(_t)}let re=a.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"fill",this._color);let se=a.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),re.appendChild(se);let le=a.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"fill","#000000");let xe=a.createNS("http://www.w3.org/2000/svg","path");xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),le.appendChild(xe);let Ne=a.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");let De=a.createNS("http://www.w3.org/2000/svg","g");De.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Ze=a.createNS("http://www.w3.org/2000/svg","circle");Ze.setAttributeNS(null,"fill","#000000"),Ze.setAttributeNS(null,"opacity","0.25"),Ze.setAttributeNS(null,"cx","5.5"),Ze.setAttributeNS(null,"cy","5.5"),Ze.setAttributeNS(null,"r","5.4999962");let ze=a.createNS("http://www.w3.org/2000/svg","circle");ze.setAttributeNS(null,"fill","#FFFFFF"),ze.setAttributeNS(null,"cx","5.5"),ze.setAttributeNS(null,"cy","5.5"),ze.setAttributeNS(null,"r","5.4999962"),De.appendChild(Ze),De.appendChild(ze),L.appendChild(F),L.appendChild(re),L.appendChild(le),L.appendChild(Ne),L.appendChild(De),m.appendChild(L),m.setAttributeNS(null,"height",x*this._scale+"px"),m.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(m),this._offset=i.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()}),O_(this._element,this._anchor,"marker"),c&&c.className)for(let m of c.className.split(" "))this._element.classList.add(m);this._popup=null}addTo(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=i.L.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){let v=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(c){return this._offset=i.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let Si={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},_i=0,ic=!1,bf={maxWidth:100,unit:"metric"};function vf(M,c,m){let x=m&&m.maxWidth||100,v=M._container.clientHeight/2,S=M.unproject([0,v]),L=M.unproject([x,v]),F=S.distanceTo(L);if(m&&m.unit==="imperial"){let Y=3.2808*F;Y>5280?yl(c,x,Y/5280,M._getUIString("ScaleControl.Miles")):yl(c,x,Y,M._getUIString("ScaleControl.Feet"))}else m&&m.unit==="nautical"?yl(c,x,F/1852,M._getUIString("ScaleControl.NauticalMiles")):F>=1e3?yl(c,x,F/1e3,M._getUIString("ScaleControl.Kilometers")):yl(c,x,F,M._getUIString("ScaleControl.Meters"))}function yl(M,c,m,x){let v=function(S){let L=Math.pow(10,`${Math.floor(S)}`.length-1),F=S/L;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(Y){let re=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*re)/re}(F),L*F}(m);M.style.width=c*(v/m)+"px",M.innerHTML=`${v}&nbsp;${x}`}let wf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},dm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eu(M){if(M){if(typeof M=="number"){let c=Math.round(Math.abs(M)/Math.SQRT2);return{center:new i.P(0,0),top:new i.P(0,M),"top-left":new i.P(c,c),"top-right":new i.P(-c,c),bottom:new i.P(0,-M),"bottom-left":new i.P(c,-c),"bottom-right":new i.P(-c,-c),left:new i.P(M,0),right:new i.P(-M,0)}}if(M instanceof i.P||Array.isArray(M)){let c=i.P.convert(M);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:i.P.convert(M.center||[0,0]),top:i.P.convert(M.top||[0,0]),"top-left":i.P.convert(M["top-left"]||[0,0]),"top-right":i.P.convert(M["top-right"]||[0,0]),bottom:i.P.convert(M.bottom||[0,0]),"bottom-left":i.P.convert(M["bottom-left"]||[0,0]),"bottom-right":i.P.convert(M["bottom-right"]||[0,0]),left:i.P.convert(M.left||[0,0]),right:i.P.convert(M.right||[0,0])}}return eu(new i.P(0,0))}let Xh={extend:(M,...c)=>i.e(M,...c),run(M){M()},logToElement(M,c=!1,m="log"){let x=window.document.getElementById(m);x&&(c&&(x.innerHTML=""),x.innerHTML+=`<br>${M}`)}},pm=s;class zn{static get version(){return pm}static get workerCount(){return No.workerCount}static set workerCount(c){No.workerCount=c}static get maxParallelImageRequests(){return i.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(c){i.c.MAX_PARALLEL_IMAGE_REQUESTS=c}static get workerUrl(){return i.c.WORKER_URL}static set workerUrl(c){i.c.WORKER_URL=c}static addProtocol(c,m){i.c.REGISTERED_PROTOCOLS[c]=m}static removeProtocol(c){delete i.c.REGISTERED_PROTOCOLS[c]}}return zn.Map=class extends um{constructor(M){if(i.bg.mark(i.bh.create),(M=i.e({},Wr,M)).minZoom!=null&&M.maxZoom!=null&&M.minZoom>M.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(M.minPitch!=null&&M.maxPitch!=null&&M.minPitch>M.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(M.minPitch!=null&&M.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(M.maxPitch!=null&&M.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Bh(M.minZoom,M.maxZoom,M.minPitch,M.maxPitch,M.renderWorldCopies),{bearingSnap:M.bearingSnap}),this._cooperativeGesturesOnWheel=c=>{this._onCooperativeGesture(c,c[this._metaKey],1)},this._contextLost=c=>{c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.k("webglcontextlost",{originalEvent:c}))},this._contextRestored=c=>{this._setupPainter(),this.resize(),this._update(),this.fire(new i.k("webglcontextrestored",{originalEvent:c}))},this._onMapScroll=c=>{if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=M.interactive,this._cooperativeGestures=M.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=M.maxTileCacheSize,this._maxTileCacheZoomLevels=M.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=M.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=M.preserveDrawingBuffer,this._antialias=M.antialias,this._trackResize=M.trackResize,this._bearingSnap=M.bearingSnap,this._refreshExpiredTiles=M.refreshExpiredTiles,this._fadeDuration=M.fadeDuration,this._crossSourceCollisions=M.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=M.collectResourceTiming,this._renderTaskQueue=new gf,this._controls=[],this._mapId=i.a2(),this._locale=i.e({},Gh,M.locale),this._clickTolerance=M.clickTolerance,this._overridePixelRatio=M.pixelRatio,this._maxCanvasSize=M.maxCanvasSize,this.transformCameraUpdate=M.transformCameraUpdate,this._imageQueueHandle=E.addThrottleControl(()=>this.isMoving()),this._requestManager=new P(M.transformRequest),typeof M.container=="string"){if(this._container=document.getElementById(M.container),!this._container)throw new Error(`Container '${M.container}' not found.`)}else{if(!(M.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=M.container}if(M.maxBounds&&this.setMaxBounds(M.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1,m=ja(x=>{this._trackResize&&!this._removed&&this.resize(x)._update()},50);this._resizeObserver=new ResizeObserver(x=>{c?m(x):c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new cm(this,M),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=M.hash&&new ff(typeof M.hash=="string"&&M.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch}),M.bounds&&(this.resize(),this.fitBounds(M.bounds,i.e({},M.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=M.localIdeographFontFamily,this._validateStyle=M.validateStyle,M.style&&this.setStyle(M.style,{localIdeographFontFamily:M.localIdeographFontFamily}),M.attributionControl&&this.addControl(new Mo({customAttribution:M.customAttribution})),M.maplibreLogo&&this.addControl(new ii,M.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.k(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.k(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new i.k("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(M,c){if(c===void 0&&(c=M.getDefaultPosition?M.getDefaultPosition():"top-right"),!M||!M.onAdd)return this.fire(new i.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let m=M.onAdd(this);this._controls.push(M);let x=this._controlPositions[c];return c.indexOf("bottom")!==-1?x.insertBefore(m,x.firstChild):x.appendChild(m),this}removeControl(M){if(!M||!M.onRemove)return this.fire(new i.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let c=this._controls.indexOf(M);return c>-1&&this._controls.splice(c,1),M.onRemove(this),this}hasControl(M){return this._controls.indexOf(M)>-1}calculateCameraOptionsFromTo(M,c,m,x){return x==null&&this.terrain&&(x=this.terrain.getElevationForLngLatZoom(m,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(M,c,m,x)}resize(M){var c;let m=this._containerDimensions(),x=m[0],v=m[1],S=this._getClampedPixelRatio(x,v);if(this._resizeCanvas(x,v,S),this.painter.resize(x,v,S),this.painter.overLimit()){let F=this.painter.context.gl;this._maxCanvasSize=[F.drawingBufferWidth,F.drawingBufferHeight];let Y=this._getClampedPixelRatio(x,v);this._resizeCanvas(x,v,Y),this.painter.resize(x,v,Y)}this.transform.resize(x,v),(c=this._requestedCameraState)===null||c===void 0||c.resize(x,v);let L=!this._moving;return L&&(this.stop(),this.fire(new i.k("movestart",M)).fire(new i.k("move",M))),this.fire(new i.k("resize",M)),L&&this.fire(new i.k("moveend",M)),this}_getClampedPixelRatio(M,c){let{0:m,1:x}=this._maxCanvasSize,v=this.getPixelRatio(),S=M*v,L=c*v;return Math.min(S>m?m/S:1,L>x?x/L:1)*v}getPixelRatio(){var M;return(M=this._overridePixelRatio)!==null&&M!==void 0?M:devicePixelRatio}setPixelRatio(M){this._overridePixelRatio=M,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(M){return this.transform.setMaxBounds(St.convert(M)),this._update()}setMinZoom(M){if((M=M??-2)>=-2&&M<=this.transform.maxZoom)return this.transform.minZoom=M,this._update(),this.getZoom()<M&&this.setZoom(M),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(M){if((M=M??22)>=this.transform.minZoom)return this.transform.maxZoom=M,this._update(),this.getZoom()>M&&this.setZoom(M),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(M){if((M=M??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(M>=0&&M<=this.transform.maxPitch)return this.transform.minPitch=M,this._update(),this.getPitch()<M&&this.setPitch(M),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(M){if((M=M??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(M>=this.transform.minPitch)return this.transform.maxPitch=M,this._update(),this.getPitch()>M&&this.setPitch(M),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(M){return this.transform.renderWorldCopies=M,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(M){return this._cooperativeGestures=M,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(M){return this.transform.locationPoint(i.L.convert(M),this.style&&this.terrain)}unproject(M){return this.transform.pointLocation(i.P.convert(M),this.terrain)}isMoving(){var M;return this._moving||((M=this.handlers)===null||M===void 0?void 0:M.isMoving())}isZooming(){var M;return this._zooming||((M=this.handlers)===null||M===void 0?void 0:M.isZooming())}isRotating(){var M;return this._rotating||((M=this.handlers)===null||M===void 0?void 0:M.isRotating())}_createDelegatedListener(M,c,m){if(M==="mouseenter"||M==="mouseover"){let x=!1;return{layer:c,listener:m,delegates:{mousemove:S=>{let L=this.getLayer(c)?this.queryRenderedFeatures(S.point,{layers:[c]}):[];L.length?x||(x=!0,m.call(this,new Ko(M,this,S.originalEvent,{features:L}))):x=!1},mouseout:()=>{x=!1}}}}if(M==="mouseleave"||M==="mouseout"){let x=!1;return{layer:c,listener:m,delegates:{mousemove:L=>{(this.getLayer(c)?this.queryRenderedFeatures(L.point,{layers:[c]}):[]).length?x=!0:x&&(x=!1,m.call(this,new Ko(M,this,L.originalEvent)))},mouseout:L=>{x&&(x=!1,m.call(this,new Ko(M,this,L.originalEvent)))}}}}{let x=v=>{let S=this.getLayer(c)?this.queryRenderedFeatures(v.point,{layers:[c]}):[];S.length&&(v.features=S,m.call(this,v),delete v.features)};return{layer:c,listener:m,delegates:{[M]:x}}}}on(M,c,m){if(m===void 0)return super.on(M,c);let x=this._createDelegatedListener(M,c,m);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[M]=this._delegatedListeners[M]||[],this._delegatedListeners[M].push(x);for(let v in x.delegates)this.on(v,x.delegates[v]);return this}once(M,c,m){if(m===void 0)return super.once(M,c);let x=this._createDelegatedListener(M,c,m);for(let v in x.delegates)this.once(v,x.delegates[v]);return this}off(M,c,m){return m===void 0?super.off(M,c):(this._delegatedListeners&&this._delegatedListeners[M]&&(x=>{let v=this._delegatedListeners[M];for(let S=0;S<v.length;S++){let L=v[S];if(L.layer===c&&L.listener===m){for(let F in L.delegates)this.off(F,L.delegates[F]);return v.splice(S,1),this}}})(),this)}queryRenderedFeatures(M,c){if(!this.style)return[];let m,x=M instanceof i.P||Array.isArray(M),v=x?M:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(x?{}:M)||{},v instanceof i.P||typeof v[0]=="number")m=[i.P.convert(v)];else{let S=i.P.convert(v[0]),L=i.P.convert(v[1]);m=[S,new i.P(L.x,S.y),L,new i.P(S.x,L.y),S]}return this.style.queryRenderedFeatures(m,c,this.transform)}querySourceFeatures(M,c){return this.style.querySourceFeatures(M,c)}setStyle(M,c){return(c=i.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&M?(this._diffStyle(M,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(M,c))}setTransformRequest(M){return this._requestManager.setTransformRequest(M),this}_getUIString(M){let c=this._locale[M];if(c==null)throw new Error(`Missing UI string '${M}'`);return c}_updateStyle(M,c){if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(M,c));let m=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!M)),M?(this.style=new qr(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof M=="string"?this.style.loadURL(M,c,m):this.style.loadJSON(M,c,m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(M,c){if(typeof M=="string"){let m=this._requestManager.transformRequest(M,k.Style);i.f(m,(x,v)=>{x?this.fire(new i.j(x)):v&&this._updateDiff(v,c)})}else typeof M=="object"&&this._updateDiff(M,c)}_updateDiff(M,c){try{this.style.setState(M,c)&&this._update(!0)}catch(m){i.w(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(M,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():i.w("There is no style added to the map.")}addSource(M,c){return this._lazyInitEmptyStyle(),this.style.addSource(M,c),this._update(!0)}isSourceLoaded(M){let c=this.style&&this.style.sourceCaches[M];if(c!==void 0)return c.loaded();this.fire(new i.j(new Error(`There is no source with ID '${M}'`)))}setTerrain(M){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),M){let c=this.style.sourceCaches[M.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${M.source}`);for(let m in this.style._layers){let x=this.style._layers[m];x.type==="hillshade"&&x.source===M.source&&i.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new P_(this.painter,c,M),this.painter.renderToTexture=new Hh(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=m=>{m.dataType==="style"?this.terrain.sourceCache.freeRtt():m.dataType==="source"&&m.tile&&(m.sourceId!==M.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(m.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new i.k("terrain",{terrain:M})),this}getTerrain(){var M,c;return(c=(M=this.terrain)===null||M===void 0?void 0:M.options)!==null&&c!==void 0?c:null}areTilesLoaded(){let M=this.style&&this.style.sourceCaches;for(let c in M){let m=M[c]._tiles;for(let x in m){let v=m[x];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(M,c,m){return this._lazyInitEmptyStyle(),this.style.addSourceType(M,c,m)}removeSource(M){return this.style.removeSource(M),this._update(!0)}getSource(M){return this.style.getSource(M)}addImage(M,c,m={}){let{pixelRatio:x=1,sdf:v=!1,stretchX:S,stretchY:L,content:F}=m;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||i.a(c))){if(c.width===void 0||c.height===void 0)return this.fire(new i.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:Y,height:re,data:se}=c,le=c;return this.style.addImage(M,{data:new i.R({width:Y,height:re},new Uint8Array(se)),pixelRatio:x,stretchX:S,stretchY:L,content:F,sdf:v,version:0,userImage:le}),le.onAdd&&le.onAdd(this,M),this}}{let{width:Y,height:re,data:se}=i.h.getImageData(c);this.style.addImage(M,{data:new i.R({width:Y,height:re},se),pixelRatio:x,stretchX:S,stretchY:L,content:F,sdf:v,version:0})}}updateImage(M,c){let m=this.style.getImage(M);if(!m)return this.fire(new i.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let x=c instanceof HTMLImageElement||i.a(c)?i.h.getImageData(c):c,{width:v,height:S,data:L}=x;if(v===void 0||S===void 0)return this.fire(new i.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==m.data.width||S!==m.data.height)return this.fire(new i.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let F=!(c instanceof HTMLImageElement||i.a(c));return m.data.replace(L,F),this.style.updateImage(M,m),this}getImage(M){return this.style.getImage(M)}hasImage(M){return M?!!this.style.getImage(M):(this.fire(new i.j(new Error("Missing required image id"))),!1)}removeImage(M){this.style.removeImage(M)}loadImage(M,c){E.getImage(this._requestManager.transformRequest(M,k.Image),c)}listImages(){return this.style.listImages()}addLayer(M,c){return this._lazyInitEmptyStyle(),this.style.addLayer(M,c),this._update(!0)}moveLayer(M,c){return this.style.moveLayer(M,c),this._update(!0)}removeLayer(M){return this.style.removeLayer(M),this._update(!0)}getLayer(M){return this.style.getLayer(M)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(M,c,m){return this.style.setLayerZoomRange(M,c,m),this._update(!0)}setFilter(M,c,m={}){return this.style.setFilter(M,c,m),this._update(!0)}getFilter(M){return this.style.getFilter(M)}setPaintProperty(M,c,m,x={}){return this.style.setPaintProperty(M,c,m,x),this._update(!0)}getPaintProperty(M,c){return this.style.getPaintProperty(M,c)}setLayoutProperty(M,c,m,x={}){return this.style.setLayoutProperty(M,c,m,x),this._update(!0)}getLayoutProperty(M,c){return this.style.getLayoutProperty(M,c)}setGlyphs(M,c={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(M,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(M,c,m={}){return this._lazyInitEmptyStyle(),this.style.addSprite(M,c,m,x=>{x||this._update(!0)}),this}removeSprite(M){return this._lazyInitEmptyStyle(),this.style.removeSprite(M),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(M,c={}){return this._lazyInitEmptyStyle(),this.style.setSprite(M,c,m=>{m||this._update(!0)}),this}setLight(M,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(M,c),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(M,c){return this.style.setFeatureState(M,c),this._update()}removeFeatureState(M,c){return this.style.removeFeatureState(M,c),this._update()}getFeatureState(M){return this.style.getFeatureState(M)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let M=0,c=0;return this._container&&(M=this._container.clientWidth||400,c=this._container.clientHeight||300),[M,c]}_setupContainer(){let M=this._container;M.classList.add("maplibregl-map");let c=this._canvasContainer=a.create("div","maplibregl-canvas-container",M);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let m=this._containerDimensions(),x=this._getClampedPixelRatio(m[0],m[1]);this._resizeCanvas(m[0],m[1],x);let v=this._controlContainer=a.create("div","maplibregl-control-container",M),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(L=>{S[L]=a.create("div",`maplibregl-ctrl-${L} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=a.create("div","maplibregl-cooperative-gesture-screen",this._container);let M=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(M=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${M}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){a.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(M,c,m){this._canvas.width=Math.floor(m*M),this._canvas.height=Math.floor(m*c),this._canvas.style.width=`${M}px`,this._canvas.style.height=`${c}px`}_setupPainter(){let M={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},c=null;this._canvas.addEventListener("webglcontextcreationerror",x=>{c={requestedAttributes:M},x&&(c.statusMessage=x.statusMessage,c.type=x.type)},{once:!0});let m=this._canvas.getContext("webgl2",M)||this._canvas.getContext("webgl",M);if(!m){let x="Failed to initialize WebGL";throw c?(c.message=x,new Error(JSON.stringify(c))):new Error(x)}this.painter=new pl(m,this.transform),u.testSupport(m)}_onCooperativeGesture(M,c,m){return!c&&m<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(M){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||M,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(M){return this._update(),this._renderTaskQueue.add(M)}_cancelRenderFrame(M){this._renderTaskQueue.remove(M)}_render(M){let c=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(M),this._removed)return;let m=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let v=this.transform.zoom,S=i.h.now();this.style.zoomHistory.update(v,S);let L=new i.a8(v,{now:S,fadeDuration:c,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=L.crossFadingFactor();F===1&&F===this._crossFadingFactor||(m=!0,this._crossFadingFactor=F),this.style.update(L)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,showPadding:this.showPadding}),this.fire(new i.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,i.bg.mark(i.bh.load),this.fire(new i.k("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new i.k("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,i.bg.mark(i.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var M;this._hash&&this._hash.remove();for(let m of this._controls)m.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),E.removeThrottleControl(this._imageQueueHandle),(M=this._resizeObserver)===null||M===void 0||M.disconnect();let c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),i.bg.clearMetrics(),this._removed=!0,this.fire(new i.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=i.h.frame(M=>{i.bg.frame(M),this._frame=null,this._render(M)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(M){this._showTileBoundaries!==M&&(this._showTileBoundaries=M,this._update())}get showPadding(){return!!this._showPadding}set showPadding(M){this._showPadding!==M&&(this._showPadding=M,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(M){this._showCollisionBoxes!==M&&(this._showCollisionBoxes=M,M?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(M){this._showOverdrawInspector!==M&&(this._showOverdrawInspector=M,this._update())}get repaint(){return!!this._repaint}set repaint(M){this._repaint!==M&&(this._repaint=M,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(M){this._vertices=M,this._update()}get version(){return Rr}getCameraTargetElevation(){return this.transform.elevation}},zn.NavigationControl=class{constructor(M){this._updateZoomButtons=()=>{let c=this._map.getZoom(),m=c===this._map.getMaxZoom(),x=c===this._map.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())},this._rotateCompassArrow=()=>{let c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c},this._setButtonTitle=(c,m)=>{let x=this._map._getUIString(`NavigationControl.${m}`);c.title=x,c.setAttribute("aria-label",x)},this.options=i.e({},xf,M),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(M){return this._map=M,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(M,c){let m=a.create("button",M,this._container);return m.type="button",m.addEventListener("click",c),m}},zn.GeolocateControl=class extends i.E{constructor(M){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new i.k("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new i.k("geolocate",c)),this._finish()}},this._updateCamera=c=>{let m=new i.L(c.coords.longitude,c.coords.latitude),x=c.coords.accuracy,v=this._map.getBearing(),S=i.e({bearing:v},this.options.fitBoundsOptions),L=St.fromLngLat(m,x);this._map.fitBounds(L,S,{geolocateSource:!0})},this._updateMarker=c=>{if(c){let m=new i.L(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&ic)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new i.k("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=c=>{if(this._map){if(this._container.addEventListener("contextmenu",m=>m.preventDefault()),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");let m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}else{let m=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nc({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",m=>{m.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m.originalEvent&&m.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new i.k("trackuserlocationend")))})}},this.options=i.e({},Si,M)}onAdd(M){return this._map=M,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(c,m=!1){Ni===void 0||m?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(x=>{Ni=x.state!=="denied",c(Ni)}).catch(()=>{Ni=!!window.navigator.geolocation,c(Ni)}):(Ni=!!window.navigator.geolocation,c(Ni)):c(Ni)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_i=0,ic=!1}_isOutOfMapMaxBounds(M){let c=this._map.getMaxBounds(),m=M.coords;return c&&(m.longitude<c.getWest()||m.longitude>c.getEast()||m.latitude<c.getSouth()||m.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let M=this._map.getBounds(),c=M.getSouthEast(),m=M.getNorthEast(),x=c.distanceTo(m),v=Math.ceil(this._accuracy/(x/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_i--,ic=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new i.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let M;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_i++,_i>1?(M={maximumAge:6e5,timeout:0},ic=!0):(M=this.options.positionOptions,ic=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,M)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},zn.AttributionControl=Mo,zn.LogoControl=ii,zn.ScaleControl=class{constructor(M){this._onMove=()=>{vf(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,vf(this._map,this._container,this.options)},this.options=i.e({},bf,M)}getDefaultPosition(){return"bottom-left"}onAdd(M){return this._map=M,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",M.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},zn.FullscreenControl=class extends i.E{constructor(M={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,M&&M.container&&(M.container instanceof HTMLElement?this._container=M.container:i.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(M){return this._map=M,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let M=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",M).setAttribute("aria-hidden","true"),M.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let M=this._getTitle();this._fullscreenButton.setAttribute("aria-label",M),this._fullscreenButton.title=M}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new i.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new i.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},zn.TerrainControl=class{constructor(M){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=M}onAdd(M){return this._map=M,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},zn.Popup=class extends i.E{constructor(M){super(),this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new i.k("close")),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let L of this.options.className.split(" "))this._container.classList.add(L);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hm(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!c)return;let m=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),x=this.options.anchor,v=eu(this.options.offset);if(!x){let L=this._container.offsetWidth,F=this._container.offsetHeight,Y;Y=m.y+v.bottom.y<F?["top"]:m.y>this._map.transform.height-F?["bottom"]:[],m.x<L/2?Y.push("left"):m.x>this._map.transform.width-L/2&&Y.push("right"),x=Y.length===0?"bottom":Y.join("-")}let S=m.add(v[x]).round();a.setTransform(this._container,`${Is[x]} translate(${S.x}px,${S.y}px)`),O_(this._container,x,"popup")},this._onClose=()=>{this.remove()},this.options=i.e(Object.create(wf),M)}addTo(M){return this._map&&this.remove(),this._map=M,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new i.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(M){return this._lngLat=i.L.convert(M),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(M){return this.setDOMContent(document.createTextNode(M))}setHTML(M){let c=document.createDocumentFragment(),m=document.createElement("body"),x;for(m.innerHTML=M;x=m.firstChild,x;)c.appendChild(x);return this.setDOMContent(c)}getMaxWidth(){var M;return(M=this._container)===null||M===void 0?void 0:M.style.maxWidth}setMaxWidth(M){return this.options.maxWidth=M,this._update(),this}setDOMContent(M){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(M),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(M){this._container&&this._container.classList.add(M)}removeClassName(M){this._container&&this._container.classList.remove(M)}setOffset(M){return this.options.offset=M,this._update(),this}toggleClassName(M){if(this._container)return this._container.classList.toggle(M)}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let M=this._container.querySelector(dm);M&&M.focus()}},zn.Marker=nc,zn.Style=qr,zn.LngLat=i.L,zn.LngLatBounds=St,zn.Point=i.P,zn.MercatorCoordinate=i.U,zn.Evented=i.E,zn.AJAXError=i.bi,zn.config=i.c,zn.CanvasSource=Lr,zn.GeoJSONSource=wr,zn.ImageSource=Br,zn.RasterDEMTileSource=vr,zn.RasterTileSource=tr,zn.VectorTileSource=yt,zn.VideoSource=qt,zn.setRTLTextPlugin=i.bj,zn.getRTLTextPluginStatus=i.bk,zn.prewarm=function(){ba().acquire(gn)},zn.clearPrewarmedResources=function(){let M=qo;M&&(M.isPreloaded()&&M.numActive()===1?(M.release(gn),qo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Xh.extend(zn,{isSafari:i.ac,getPerformanceMetrics:i.bg.getPerformanceMetrics}),zn});var o=r;return o})});function Un(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}var xc=W(()=>{});function Z0(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}var UR=W(()=>{});function qf(e){let t,r,n;e.length!==2?(t=Un,r=(a,u)=>Un(e(a),u),n=(a,u)=>e(a)-u):(t=e===Un||e===Z0?e:oIe,r=e,n=e);function o(a,u,h=0,p=a.length){if(h<p){if(t(u,u)!==0)return p;do{let _=h+p>>>1;r(a[_],u)<0?h=_+1:p=_}while(h<p)}return h}function i(a,u,h=0,p=a.length){if(h<p){if(t(u,u)!==0)return p;do{let _=h+p>>>1;r(a[_],u)<=0?h=_+1:p=_}while(h<p)}return h}function s(a,u,h=0,p=a.length){let _=o(a,u,h,p-1);return _>h&&n(a[_-1],u)>-n(a[_],u)?_-1:_}return{left:o,center:s,right:i}}function oIe(){return 0}var VR=W(()=>{xc();UR()});function sg(e){return e===null?NaN:+e}function*JX(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}var WR=W(()=>{});var eK,LT,ZR,YR,sa,qR=W(()=>{xc();VR();WR();eK=qf(Un),LT=eK.right,ZR=eK.left,YR=qf(sg).center,sa=LT});function GR(e,t){if(!((t=+t)>=0))throw new RangeError("invalid r");let r=e.length;if(!((r=Math.floor(r))>=0))throw new RangeError("invalid length");if(!r||!t)return e;let n=XR(t),o=e.slice();return n(e,o,0,r,1),n(o,e,0,r,1),n(e,o,0,r,1),e}function tK(e){return function(t,r,n=r){if(!((r=+r)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:o,width:i,height:s}=t;if(!((i=Math.floor(i))>=0))throw new RangeError("invalid width");if(!((s=Math.floor(s!==void 0?s:o.length/i))>=0))throw new RangeError("invalid height");if(!i||!s||!r&&!n)return t;let a=r&&e(r),u=n&&e(n),h=o.slice();return a&&u?(Y0(a,h,o,i,s),Y0(a,o,h,i,s),Y0(a,h,o,i,s),q0(u,o,h,i,s),q0(u,h,o,i,s),q0(u,o,h,i,s)):a?(Y0(a,o,h,i,s),Y0(a,h,o,i,s),Y0(a,o,h,i,s)):u&&(q0(u,o,h,i,s),q0(u,h,o,i,s),q0(u,o,h,i,s)),t}}function Y0(e,t,r,n,o){for(let i=0,s=n*o;i<s;)e(t,r,i,i+=n,1)}function q0(e,t,r,n,o){for(let i=0,s=n*o;i<n;++i)e(t,r,i,i+s,n)}function sIe(e){let t=XR(e);return(r,n,o,i,s)=>{o<<=2,i<<=2,s<<=2,t(r,n,o+0,i+0,s),t(r,n,o+1,i+1,s),t(r,n,o+2,i+2,s),t(r,n,o+3,i+3,s)}}function XR(e){let t=Math.floor(e);if(t===e)return aIe(e);let r=e-t,n=2*e+1;return(o,i,s,a,u)=>{if(!((a-=u)>=s))return;let h=t*i[s],p=u*t,_=p+u;for(let y=s,A=s+p;y<A;y+=u)h+=i[Math.min(a,y)];for(let y=s,A=a;y<=A;y+=u)h+=i[Math.min(a,y+p)],o[y]=(h+r*(i[Math.max(s,y-_)]+i[Math.min(a,y+_)]))/n,h-=i[Math.max(s,y-p)]}}function aIe(e){let t=2*e+1;return(r,n,o,i,s)=>{if(!((i-=s)>=o))return;let a=e*n[o],u=s*e;for(let h=o,p=o+u;h<p;h+=s)a+=n[Math.min(i,h)];for(let h=o,p=i;h<=p;h+=s)a+=n[Math.min(i,h+u)],r[h]=a/t,a-=n[Math.max(o,h-u)]}}var v1,HR,rK=W(()=>{v1=tK(XR),HR=tK(sIe)});function wu(e,t){let r=0;if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&++r;else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&(o=+o)>=o&&++r}return r}var w1=W(()=>{});function lIe(e){return e.length|0}function cIe(e){return!(e>0)}function uIe(e){return typeof e!="object"||"length"in e?e:Array.from(e)}function fIe(e){return t=>e(...t)}function FT(...e){let t=typeof e[e.length-1]=="function"&&fIe(e.pop());e=e.map(uIe);let r=e.map(lIe),n=e.length-1,o=new Array(n+1).fill(0),i=[];if(n<0||r.some(cIe))return i;for(;;){i.push(o.map((a,u)=>e[u][a]));let s=n;for(;++o[s]===r[s];){if(s===0)return t?i.map(t):i;o[s--]=0}}}var nK=W(()=>{});function BT(e,t){var r=0,n=0;return Float64Array.from(e,t===void 0?o=>r+=+o||0:o=>r+=+t(o,n++,e)||0)}var iK=W(()=>{});function G0(e,t){let r=0,n,o=0,i=0;if(t===void 0)for(let s of e)s!=null&&(s=+s)>=s&&(n=s-o,o+=n/++r,i+=n*(s-o));else{let s=-1;for(let a of e)(a=t(a,++s,e))!=null&&(a=+a)>=a&&(n=a-o,o+=n/++r,i+=n*(a-o))}if(r>1)return i/(r-1)}var KR=W(()=>{});function H0(e,t){let r=G0(e,t);return r&&Math.sqrt(r)}var $R=W(()=>{KR()});function Au(e,t){let r,n;if(t===void 0)for(let o of e)o!=null&&(r===void 0?o>=o&&(r=n=o):(r>o&&(r=o),n<o&&(n=o)));else{let o=-1;for(let i of e)(i=t(i,++o,e))!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)))}return[r,n]}var QR=W(()=>{});function JR(e,t){let r=new ci;if(t===void 0)for(let n of e)(n=+n)&&r.add(n);else{let n=-1;for(let o of e)(o=+t(o,++n,e))&&r.add(o)}return+r}function eN(e,t){let r=new ci,n=-1;return Float64Array.from(e,t===void 0?o=>r.add(+o||0):o=>r.add(+t(o,++n,e)||0))}var ci,oK=W(()=>{ci=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){let r=this._partials,n=0;for(let o=0;o<this._n&&o<32;o++){let i=r[o],s=t+i,a=Math.abs(t)<Math.abs(i)?t-(s-i):i-(s-t);a&&(r[n++]=a),t=s}return r[n]=t,this._n=n+1,this}valueOf(){let t=this._partials,r=this._n,n,o,i,s=0;if(r>0){for(s=t[--r];r>0&&(n=s,o=t[--r],s=n+o,i=o-(s-n),!i););r>0&&(i<0&&t[r-1]<0||i>0&&t[r-1]>0)&&(o=i*2,n=s+o,o==n-s&&(s=n))}return s}}});function tN({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):r}function sK({_intern:e,_key:t},r){let n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function aK({_intern:e,_key:t},r){let n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function lK(e){return e!==null&&typeof e=="object"?e.valueOf():e}var Rl,aa,Cd=W(()=>{Rl=class extends Map{constructor(t,r=lK){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let[n,o]of t)this.set(n,o)}get(t){return super.get(tN(this,t))}has(t){return super.has(tN(this,t))}set(t,r){return super.set(sK(this,t),r)}delete(t){return super.delete(aK(this,t))}},aa=class extends Set{constructor(t,r=lK){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(let n of t)this.add(n)}has(t){return super.has(tN(this,t))}add(t){return super.add(sK(this,t))}delete(t){return super.delete(aK(this,t))}}});function Gf(e){return e}var rN=W(()=>{});function X0(e,...t){return K0(e,Gf,Gf,t)}function jT(e,...t){return K0(e,Array.from,Gf,t)}function cK(e,t){for(let r=1,n=t.length;r<n;++r)e=e.flatMap(o=>o.pop().map(([i,s])=>[...o,i,s]));return e}function nN(e,...t){return cK(jT(e,...t),t)}function iN(e,t,...r){return cK(UT(e,t,...r),r)}function A1(e,t,...r){return K0(e,Gf,t,r)}function UT(e,t,...r){return K0(e,Array.from,t,r)}function oN(e,...t){return K0(e,Gf,uK,t)}function sN(e,...t){return K0(e,Array.from,uK,t)}function uK(e){if(e.length!==1)throw new Error("duplicate key");return e[0]}function K0(e,t,r,n){return function o(i,s){if(s>=n.length)return r(i);let a=new Rl,u=n[s++],h=-1;for(let p of i){let _=u(p,++h,i),y=a.get(_);y?y.push(p):a.set(_,[p])}for(let[p,_]of a)a.set(p,o(_,s));return t(a)}(e,0)}var aN=W(()=>{Cd();rN()});function $0(e,t){return Array.from(t,r=>e[r])}var lN=W(()=>{});function ag(e,...t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");e=Array.from(e);let[r]=t;if(r&&r.length!==2||t.length>1){let n=Uint32Array.from(e,(o,i)=>i);return t.length>1?(t=t.map(o=>e.map(o)),n.sort((o,i)=>{for(let s of t){let a=Hf(s[o],s[i]);if(a)return a}})):(r=e.map(r),n.sort((o,i)=>Hf(r[o],r[i]))),$0(e,n)}return e.sort(M1(r))}function M1(e=Un){if(e===Un)return Hf;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{let n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Hf(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}var Q0=W(()=>{xc();lN()});function VT(e,t,r){return(t.length!==2?ag(A1(e,t,r),([n,o],[i,s])=>Un(o,s)||Un(n,i)):ag(X0(e,r),([n,o],[i,s])=>t(o,s)||Un(n,i))).map(([n])=>n)}var fK=W(()=>{xc();aN();Q0()});var hK,dK,Llt,pK=W(()=>{hK=Array.prototype,dK=hK.slice,Llt=hK.map});function S1(e){return()=>e}var mK=W(()=>{});function WT(e,t,r){let n=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(n)),i=n/Math.pow(10,o),s=i>=hIe?10:i>=dIe?5:i>=pIe?2:1,a,u,h;return o<0?(h=Math.pow(10,-o)/s,a=Math.round(e*h),u=Math.round(t*h),a/h<e&&++a,u/h>t&&--u,h=-h):(h=Math.pow(10,o)*s,a=Math.round(e/h),u=Math.round(t/h),a*h<e&&++a,u*h>t&&--u),u<a&&.5<=r&&r<2?WT(e,t,r*2):[a,u,h]}function la(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];let n=t<e,[o,i,s]=n?WT(t,e,r):WT(e,t,r);if(!(i>=o))return[];let a=i-o+1,u=new Array(a);if(n)if(s<0)for(let h=0;h<a;++h)u[h]=(i-h)/-s;else for(let h=0;h<a;++h)u[h]=(i-h)*s;else if(s<0)for(let h=0;h<a;++h)u[h]=(o+h)/-s;else for(let h=0;h<a;++h)u[h]=(o+h)*s;return u}function Nl(e,t,r){return t=+t,e=+e,r=+r,WT(e,t,r)[2]}function kd(e,t,r){t=+t,e=+e,r=+r;let n=t<e,o=n?Nl(t,e,r):Nl(e,t,r);return(n?-1:1)*(o<0?1/-o:o)}var hIe,dIe,pIe,ZT=W(()=>{hIe=Math.sqrt(50),dIe=Math.sqrt(10),pIe=Math.sqrt(2)});function Pd(e,t,r){let n;for(;;){let o=Nl(e,t,r);if(o===n||o===0||!isFinite(o))return[e,t];o>0?(e=Math.floor(e/o)*o,t=Math.ceil(t/o)*o):o<0&&(e=Math.ceil(e*o)/o,t=Math.floor(t*o)/o),n=o}}var cN=W(()=>{ZT()});function Od(e){return Math.max(1,Math.ceil(Math.log(wu(e))/Math.LN2)+1)}var uN=W(()=>{w1()});function T1(){var e=Gf,t=Au,r=Od;function n(o){Array.isArray(o)||(o=Array.from(o));var i,s=o.length,a,u,h=new Array(s);for(i=0;i<s;++i)h[i]=e(o[i],i,o);var p=t(h),_=p[0],y=p[1],A=r(h,_,y);if(!Array.isArray(A)){let N=y,j=+A;if(t===Au&&([_,y]=Pd(_,y,j)),A=la(_,y,j),A[0]<=_&&(u=Nl(_,y,j)),A[A.length-1]>=y)if(N>=y&&t===Au){let J=Nl(_,y,j);isFinite(J)&&(J>0?y=(Math.floor(y/J)+1)*J:J<0&&(y=(Math.ceil(y*-J)+1)/-J))}else A.pop()}for(var E=A.length,k=0,P=E;A[k]<=_;)++k;for(;A[P-1]>y;)--P;(k||P<E)&&(A=A.slice(k,P),E=P-k);var R=new Array(E+1),V;for(i=0;i<=E;++i)V=R[i]=[],V.x0=i>0?A[i-1]:_,V.x1=i<E?A[i]:y;if(isFinite(u)){if(u>0)for(i=0;i<s;++i)(a=h[i])!=null&&_<=a&&a<=y&&R[Math.min(E,Math.floor((a-_)/u))].push(o[i]);else if(u<0){for(i=0;i<s;++i)if((a=h[i])!=null&&_<=a&&a<=y){let N=Math.floor((_-a)*u);R[Math.min(E,N+(A[N]<=a))].push(o[i])}}}else for(i=0;i<s;++i)(a=h[i])!=null&&_<=a&&a<=y&&R[sa(A,a,0,E)].push(o[i]);return R}return n.value=function(o){return arguments.length?(e=typeof o=="function"?o:S1(o),n):e},n.domain=function(o){return arguments.length?(t=typeof o=="function"?o:S1([o[0],o[1]]),n):t},n.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:S1(Array.isArray(o)?dK.call(o):o),n):r},n}var gK=W(()=>{pK();qR();mK();QR();rN();cN();ZT();uN()});function za(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&(r<o||r===void 0&&o>=o)&&(r=o)}return r}var fN=W(()=>{});function Rd(e,t){let r,n=-1,o=-1;if(t===void 0)for(let i of e)++o,i!=null&&(r<i||r===void 0&&i>=i)&&(r=i,n=o);else for(let i of e)(i=t(i,++o,e))!=null&&(r<i||r===void 0&&i>=i)&&(r=i,n=o);return n}var YT=W(()=>{});function tl(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o)}return r}var qT=W(()=>{});function Nd(e,t){let r,n=-1,o=-1;if(t===void 0)for(let i of e)++o,i!=null&&(r>i||r===void 0&&i>=i)&&(r=i,n=o);else for(let i of e)(i=t(i,++o,e))!=null&&(r>i||r===void 0&&i>=i)&&(r=i,n=o);return n}var GT=W(()=>{});function zd(e,t,r=0,n=1/0,o){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(o=o===void 0?Hf:M1(o);n>r;){if(n-r>600){let u=n-r+1,h=t-r+1,p=Math.log(u),_=.5*Math.exp(2*p/3),y=.5*Math.sqrt(p*_*(u-_)/u)*(h-u/2<0?-1:1),A=Math.max(r,Math.floor(t-h*_/u+y)),E=Math.min(n,Math.floor(t+(u-h)*_/u+y));zd(e,t,A,E,o)}let i=e[t],s=r,a=n;for(E1(e,r,t),o(e[n],i)>0&&E1(e,r,n);s<a;){for(E1(e,s,a),++s,--a;o(e[s],i)<0;)++s;for(;o(e[a],i)>0;)--a}o(e[r],i)===0?E1(e,r,a):(++a,E1(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}return e}function E1(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}var hN=W(()=>{Q0()});function J0(e,t=Un){let r,n=!1;if(t.length===1){let o;for(let i of e){let s=t(i);(n?Un(s,o)>0:Un(s,s)===0)&&(r=i,o=s,n=!0)}}else for(let o of e)(n?t(o,r)>0:t(o,o)===0)&&(r=o,n=!0);return r}var dN=W(()=>{xc()});function bc(e,t,r){if(e=Float64Array.from(JX(e,r)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return tl(e);if(t>=1)return za(e);var n,o=(n-1)*t,i=Math.floor(o),s=za(zd(e,i).subarray(0,i+1)),a=tl(e.subarray(i+1));return s+(a-s)*(o-i)}}function I1(e,t,r=sg){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*t,i=Math.floor(o),s=+r(e[i],i,e),a=+r(e[i+1],i+1,e);return s+(a-s)*(o-i)}}function C1(e,t,r=sg){if(!isNaN(t=+t)){if(n=Float64Array.from(e,(a,u)=>sg(r(e[u],u,e))),t<=0)return Nd(n);if(t>=1)return Rd(n);var n,o=Uint32Array.from(e,(a,u)=>u),i=n.length-1,s=Math.floor(i*t);return zd(o,s,0,i,(a,u)=>Hf(n[a],n[u])),s=J0(o.subarray(0,s+1),a=>n[a]),s>=0?s:-1}}var HT=W(()=>{fN();YT();qT();GT();hN();WR();Q0();dN()});function XT(e,t,r){let n=wu(e),o=bc(e,.75)-bc(e,.25);return n&&o?Math.ceil((r-t)/(2*o*Math.pow(n,-1/3))):1}var _K=W(()=>{w1();HT()});function KT(e,t,r){let n=wu(e),o=H0(e);return n&&o?Math.ceil((r-t)*Math.cbrt(n)/(3.49*o)):1}var yK=W(()=>{w1();$R()});function $T(e,t){let r=0,n=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(++r,n+=o);else{let o=-1;for(let i of e)(i=t(i,++o,e))!=null&&(i=+i)>=i&&(++r,n+=i)}if(r)return n/r}var xK=W(()=>{});function QT(e,t){return bc(e,.5,t)}function pN(e,t){return C1(e,.5,t)}var bK=W(()=>{HT()});function*mIe(e){for(let t of e)yield*t}function Dd(e){return Array.from(mIe(e))}var vK=W(()=>{});function JT(e,t){let r=new Rl;if(t===void 0)for(let i of e)i!=null&&i>=i&&r.set(i,(r.get(i)||0)+1);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&s>=s&&r.set(s,(r.get(s)||0)+1)}let n,o=0;for(let[i,s]of r)s>o&&(o=s,n=i);return n}var wK=W(()=>{Cd()});function e3(e,t=gIe){let r=[],n,o=!1;for(let i of e)o&&r.push(t(n,i)),n=i,o=!0;return r}function gIe(e,t){return[e,t]}var AK=W(()=>{});function ca(e,t,r){e=+e,t=+t,r=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+r;for(var n=-1,o=Math.max(0,Math.ceil((t-e)/r))|0,i=new Array(o);++n<o;)i[n]=e+n*r;return i}var MK=W(()=>{});function t3(e,t=Un){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");let r=Array.from(e),n=new Float64Array(r.length);t.length!==2&&(r=r.map(t),t=Un);let o=(a,u)=>t(r[a],r[u]),i,s;return e=Uint32Array.from(r,(a,u)=>u),e.sort(t===Un?(a,u)=>Hf(r[a],r[u]):M1(o)),e.forEach((a,u)=>{let h=o(a,i===void 0?a:i);h>=0?((i===void 0||h>0)&&(i=a,s=u),n[a]=s):n[a]=NaN}),n}var SK=W(()=>{xc();Q0()});function r3(e,t=Un){let r,n=!1;if(t.length===1){let o;for(let i of e){let s=t(i);(n?Un(s,o)<0:Un(s,s)===0)&&(r=i,o=s,n=!0)}}else for(let o of e)(n?t(o,r)<0:t(o,o)===0)&&(r=o,n=!0);return r}var TK=W(()=>{xc()});function ey(e,t=Un){if(t.length===1)return Nd(e,t);let r,n=-1,o=-1;for(let i of e)++o,(n<0?t(i,i)===0:t(i,r)<0)&&(r=i,n=o);return n}var mN=W(()=>{xc();GT()});function n3(e,t=Un){if(t.length===1)return Rd(e,t);let r,n=-1,o=-1;for(let i of e)++o,(n<0?t(i,i)===0:t(i,r)>0)&&(r=i,n=o);return n}var EK=W(()=>{xc();YT()});function i3(e,t){let r=ey(e,t);return r<0?void 0:r}var IK=W(()=>{mN()});function o3(e){return function(r,n=0,o=r.length){let i=o-(n=+n);for(;i;){let s=e()*i--|0,a=r[i+n];r[i+n]=r[s+n],r[s+n]=a}return r}}var gN,CK=W(()=>{gN=o3(Math.random)});function s3(e,t){let r=0;if(t===void 0)for(let n of e)(n=+n)&&(r+=n);else{let n=-1;for(let o of e)(o=+t(o,++n,e))&&(r+=o)}return r}var kK=W(()=>{});function ty(e){if(!(i=e.length))return[];for(var t=-1,r=tl(e,_Ie),n=new Array(r);++t<r;)for(var o=-1,i,s=n[t]=new Array(i);++o<i;)s[o]=e[o][t];return n}function _Ie(e){return e.length}var _N=W(()=>{qT()});function a3(){return ty(arguments)}var PK=W(()=>{_N()});function l3(e,t){if(typeof t!="function")throw new TypeError("test is not a function");let r=-1;for(let n of e)if(!t(n,++r,e))return!1;return!0}var OK=W(()=>{});function c3(e,t){if(typeof t!="function")throw new TypeError("test is not a function");let r=-1;for(let n of e)if(t(n,++r,e))return!0;return!1}var RK=W(()=>{});function u3(e,t){if(typeof t!="function")throw new TypeError("test is not a function");let r=[],n=-1;for(let o of e)t(o,++n,e)&&r.push(o);return r}var NK=W(()=>{});function f3(e,t){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");if(typeof t!="function")throw new TypeError("mapper is not a function");return Array.from(e,(r,n)=>t(r,n,e))}var zK=W(()=>{});function h3(e,t,r){if(typeof t!="function")throw new TypeError("reducer is not a function");let n=e[Symbol.iterator](),o,i,s=-1;if(arguments.length<3){if({done:o,value:r}=n.next(),o)return;++s}for(;{done:o,value:i}=n.next(),!o;)r=t(r,i,++s,e);return r}var DK=W(()=>{});function p3(e){if(typeof e[Symbol.iterator]!="function")throw new TypeError("values is not iterable");return Array.from(e).reverse()}var LK=W(()=>{});function m3(e,...t){e=new aa(e);for(let r of t)for(let n of r)e.delete(n);return e}var FK=W(()=>{Cd()});function g3(e,t){let r=t[Symbol.iterator](),n=new aa;for(let o of e){if(n.has(o))return!1;let i,s;for(;({value:i,done:s}=r.next())&&!s;){if(Object.is(o,i))return!1;n.add(i)}}return!0}var BK=W(()=>{Cd()});function _3(e,...t){e=new aa(e),t=t.map(yIe);e:for(let r of e)for(let n of t)if(!n.has(r)){e.delete(r);continue e}return e}function yIe(e){return e instanceof aa?e:new aa(e)}var jK=W(()=>{Cd()});function ry(e,t){let r=e[Symbol.iterator](),n=new Set;for(let o of t){let i=UK(o);if(n.has(i))continue;let s,a;for(;{value:s,done:a}=r.next();){if(a)return!1;let u=UK(s);if(n.add(u),Object.is(i,u))break}}return!0}function UK(e){return e!==null&&typeof e=="object"?e.valueOf():e}var yN=W(()=>{});function y3(e,t){return ry(t,e)}var VK=W(()=>{yN()});function x3(...e){let t=new aa;for(let r of e)for(let n of r)t.add(n);return t}var WK=W(()=>{Cd()});var xN={};io(xN,{Adder:()=>ci,InternMap:()=>Rl,InternSet:()=>aa,ascending:()=>Un,bin:()=>T1,bisect:()=>sa,bisectCenter:()=>YR,bisectLeft:()=>ZR,bisectRight:()=>LT,bisector:()=>qf,blur:()=>GR,blur2:()=>v1,blurImage:()=>HR,count:()=>wu,cross:()=>FT,cumsum:()=>BT,descending:()=>Z0,deviation:()=>H0,difference:()=>m3,disjoint:()=>g3,every:()=>l3,extent:()=>Au,fcumsum:()=>eN,filter:()=>u3,flatGroup:()=>nN,flatRollup:()=>iN,fsum:()=>JR,greatest:()=>J0,greatestIndex:()=>n3,group:()=>X0,groupSort:()=>VT,groups:()=>jT,histogram:()=>T1,index:()=>oN,indexes:()=>sN,intersection:()=>_3,least:()=>r3,leastIndex:()=>ey,map:()=>f3,max:()=>za,maxIndex:()=>Rd,mean:()=>$T,median:()=>QT,medianIndex:()=>pN,merge:()=>Dd,min:()=>tl,minIndex:()=>Nd,mode:()=>JT,nice:()=>Pd,pairs:()=>e3,permute:()=>$0,quantile:()=>bc,quantileIndex:()=>C1,quantileSorted:()=>I1,quickselect:()=>zd,range:()=>ca,rank:()=>t3,reduce:()=>h3,reverse:()=>p3,rollup:()=>A1,rollups:()=>UT,scan:()=>i3,shuffle:()=>gN,shuffler:()=>o3,some:()=>c3,sort:()=>ag,subset:()=>y3,sum:()=>s3,superset:()=>ry,thresholdFreedmanDiaconis:()=>XT,thresholdScott:()=>KT,thresholdSturges:()=>Od,tickIncrement:()=>Nl,tickStep:()=>kd,ticks:()=>la,transpose:()=>ty,union:()=>x3,variance:()=>G0,zip:()=>a3});var ki=W(()=>{qR();xc();VR();rK();w1();nK();iK();UR();$R();QR();oK();aN();fK();gK();_K();yK();uN();fN();YT();xK();bK();vK();qT();GT();wK();cN();AK();lN();HT();hN();MK();SK();TK();mN();dN();EK();IK();CK();kK();ZT();_N();KR();PK();OK();RK();NK();zK();DK();LK();Q0();FK();BK();jK();VK();yN();WK();Cd()});function ZK(e){return e}var YK=W(()=>{});function xIe(e){return"translate("+e+",0)"}function bIe(e){return"translate(0,"+e+")"}function vIe(e){return t=>+e(t)}function wIe(e,t){return t=Math.max(0,e.bandwidth()-t*2)/2,e.round()&&(t=Math.round(t)),r=>+e(r)+t}function AIe(){return!this.__axis}function w3(e,t){var r=[],n=null,o=null,i=6,s=6,a=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,h=e===b3||e===k1?-1:1,p=e===k1||e===v3?"x":"y",_=e===b3||e===bN?xIe:bIe;function y(A){var E=n??(t.ticks?t.ticks.apply(t,r):t.domain()),k=o??(t.tickFormat?t.tickFormat.apply(t,r):ZK),P=Math.max(i,0)+a,R=t.range(),V=+R[0]+u,N=+R[R.length-1]+u,j=(t.bandwidth?wIe:vIe)(t.copy(),u),J=A.selection?A.selection():A,ne=J.selectAll(".domain").data([null]),de=J.selectAll(".tick").data(E,t).order(),fe=de.exit(),ye=de.enter().append("g").attr("class","tick"),ve=de.select("line"),be=de.select("text");ne=ne.merge(ne.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),de=de.merge(ye),ve=ve.merge(ye.append("line").attr("stroke","currentColor").attr(p+"2",h*i)),be=be.merge(ye.append("text").attr("fill","currentColor").attr(p,h*P).attr("dy",e===b3?"0em":e===bN?"0.71em":"0.32em")),A!==J&&(ne=ne.transition(A),de=de.transition(A),ve=ve.transition(A),be=be.transition(A),fe=fe.transition(A).attr("opacity",qK).attr("transform",function(je){return isFinite(je=j(je))?_(je+u):this.getAttribute("transform")}),ye.attr("opacity",qK).attr("transform",function(je){var Re=this.parentNode.__axis;return _((Re&&isFinite(Re=Re(je))?Re:j(je))+u)})),fe.remove(),ne.attr("d",e===k1||e===v3?s?"M"+h*s+","+V+"H"+u+"V"+N+"H"+h*s:"M"+u+","+V+"V"+N:s?"M"+V+","+h*s+"V"+u+"H"+N+"V"+h*s:"M"+V+","+u+"H"+N),de.attr("opacity",1).attr("transform",function(je){return _(j(je)+u)}),ve.attr(p+"2",h*i),be.attr(p,h*P).text(k),J.filter(AIe).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",e===v3?"start":e===k1?"end":"middle"),J.each(function(){this.__axis=j})}return y.scale=function(A){return arguments.length?(t=A,y):t},y.ticks=function(){return r=Array.from(arguments),y},y.tickArguments=function(A){return arguments.length?(r=A==null?[]:Array.from(A),y):r.slice()},y.tickValues=function(A){return arguments.length?(n=A==null?null:Array.from(A),y):n&&n.slice()},y.tickFormat=function(A){return arguments.length?(o=A,y):o},y.tickSize=function(A){return arguments.length?(i=s=+A,y):i},y.tickSizeInner=function(A){return arguments.length?(i=+A,y):i},y.tickSizeOuter=function(A){return arguments.length?(s=+A,y):s},y.tickPadding=function(A){return arguments.length?(a=+A,y):a},y.offset=function(A){return arguments.length?(u=+A,y):u},y}function GK(e){return w3(b3,e)}function HK(e){return w3(v3,e)}function XK(e){return w3(bN,e)}function KK(e){return w3(k1,e)}var b3,v3,bN,k1,qK,$K=W(()=>{YK();b3=1,v3=2,bN=3,k1=4,qK=1e-6});var QK=W(()=>{$K()});function e$(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r||/[\s.]/.test(n))throw new Error("illegal type: "+n);r[n]=[]}return new A3(r)}function A3(e){this._=e}function SIe(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",o=r.indexOf(".");if(o>=0&&(n=r.slice(o+1),r=r.slice(0,o)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function TIe(e,t){for(var r=0,n=e.length,o;r<n;++r)if((o=e[r]).name===t)return o.value}function JK(e,t,r){for(var n=0,o=e.length;n<o;++n)if(e[n].name===t){e[n]=MIe,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var MIe,rl,t$=W(()=>{MIe={value:()=>{}};A3.prototype=e$.prototype={constructor:A3,on:function(e,t){var r=this._,n=SIe(e+"",r),o,i=-1,s=n.length;if(arguments.length<2){for(;++i<s;)if((o=(e=n[i]).type)&&(o=TIe(r[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(e=n[i]).type)r[o]=JK(r[o],e.name,t);else if(t==null)for(o in r)r[o]=JK(r[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new A3(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var r=new Array(o),n=0,o,i;n<o;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],n=0,o=i.length;n<o;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],o=0,i=n.length;o<i;++o)n[o].value.apply(t,r)}};rl=e$});var r$={};io(r$,{dispatch:()=>rl});var Ld=W(()=>{t$()});var M3,ny,S3=W(()=>{M3="http://www.w3.org/1999/xhtml",ny={svg:"http://www.w3.org/2000/svg",xhtml:M3,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function vc(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),ny.hasOwnProperty(t)?{space:ny[t],local:e}:e}var T3=W(()=>{S3()});function EIe(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===M3&&t.documentElement.namespaceURI===M3?t.createElement(e):t.createElementNS(r,e)}}function IIe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Xf(e){var t=vc(e);return(t.local?IIe:EIe)(t)}var P1=W(()=>{T3();S3()});function CIe(){}function Kf(e){return e==null?CIe:function(){return this.querySelector(e)}}var E3=W(()=>{});function n$(e){typeof e!="function"&&(e=Kf(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var i=t[o],s=i.length,a=n[o]=new Array(s),u,h,p=0;p<s;++p)(u=i[p])&&(h=e.call(u,u.__data__,p,i))&&("__data__"in u&&(h.__data__=u.__data__),a[p]=h);return new Fi(n,this._parents)}var i$=W(()=>{zl();E3()});function O1(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}var vN=W(()=>{});function kIe(){return[]}function lg(e){return e==null?kIe:function(){return this.querySelectorAll(e)}}var wN=W(()=>{});function PIe(e){return function(){return O1(e.apply(this,arguments))}}function o$(e){typeof e=="function"?e=PIe(e):e=lg(e);for(var t=this._groups,r=t.length,n=[],o=[],i=0;i<r;++i)for(var s=t[i],a=s.length,u,h=0;h<a;++h)(u=s[h])&&(n.push(e.call(u,u.__data__,h,s)),o.push(u));return new Fi(n,o)}var s$=W(()=>{zl();vN();wN()});function cg(e){return function(){return this.matches(e)}}function I3(e){return function(t){return t.matches(e)}}var R1=W(()=>{});function RIe(e){return function(){return OIe.call(this.children,e)}}function NIe(){return this.firstElementChild}function a$(e){return this.select(e==null?NIe:RIe(typeof e=="function"?e:I3(e)))}var OIe,l$=W(()=>{R1();OIe=Array.prototype.find});function DIe(){return Array.from(this.children)}function LIe(e){return function(){return zIe.call(this.children,e)}}function c$(e){return this.selectAll(e==null?DIe:LIe(typeof e=="function"?e:I3(e)))}var zIe,u$=W(()=>{R1();zIe=Array.prototype.filter});function f$(e){typeof e!="function"&&(e=cg(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var i=t[o],s=i.length,a=n[o]=[],u,h=0;h<s;++h)(u=i[h])&&e.call(u,u.__data__,h,i)&&a.push(u);return new Fi(n,this._parents)}var h$=W(()=>{zl();R1()});function C3(e){return new Array(e.length)}var AN=W(()=>{});function d$(){return new Fi(this._enter||this._groups.map(C3),this._parents)}function N1(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}var MN=W(()=>{AN();zl();N1.prototype={constructor:N1,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}}});function p$(e){return function(){return e}}var m$=W(()=>{});function FIe(e,t,r,n,o,i){for(var s=0,a,u=t.length,h=i.length;s<h;++s)(a=t[s])?(a.__data__=i[s],n[s]=a):r[s]=new N1(e,i[s]);for(;s<u;++s)(a=t[s])&&(o[s]=a)}function BIe(e,t,r,n,o,i,s){var a,u,h=new Map,p=t.length,_=i.length,y=new Array(p),A;for(a=0;a<p;++a)(u=t[a])&&(y[a]=A=s.call(u,u.__data__,a,t)+"",h.has(A)?o[a]=u:h.set(A,u));for(a=0;a<_;++a)A=s.call(e,i[a],a,i)+"",(u=h.get(A))?(n[a]=u,u.__data__=i[a],h.delete(A)):r[a]=new N1(e,i[a]);for(a=0;a<p;++a)(u=t[a])&&h.get(y[a])===u&&(o[a]=u)}function jIe(e){return e.__data__}function g$(e,t){if(!arguments.length)return Array.from(this,jIe);var r=t?BIe:FIe,n=this._parents,o=this._groups;typeof e!="function"&&(e=p$(e));for(var i=o.length,s=new Array(i),a=new Array(i),u=new Array(i),h=0;h<i;++h){var p=n[h],_=o[h],y=_.length,A=UIe(e.call(p,p&&p.__data__,h,n)),E=A.length,k=a[h]=new Array(E),P=s[h]=new Array(E),R=u[h]=new Array(y);r(p,_,k,P,R,A,t);for(var V=0,N=0,j,J;V<E;++V)if(j=k[V]){for(V>=N&&(N=V+1);!(J=P[N])&&++N<E;);j._next=J||null}}return s=new Fi(s,n),s._enter=a,s._exit=u,s}function UIe(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}var _$=W(()=>{zl();MN();m$()});function y$(){return new Fi(this._exit||this._groups.map(C3),this._parents)}var x$=W(()=>{AN();zl()});function b$(e,t,r){var n=this.enter(),o=this,i=this.exit();return typeof e=="function"?(n=e(n),n&&(n=n.selection())):n=n.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),r==null?i.remove():r(i),n&&o?n.merge(o).order():o}var v$=W(()=>{});function w$(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,o=r.length,i=n.length,s=Math.min(o,i),a=new Array(o),u=0;u<s;++u)for(var h=r[u],p=n[u],_=h.length,y=a[u]=new Array(_),A,E=0;E<_;++E)(A=h[E]||p[E])&&(y[E]=A);for(;u<o;++u)a[u]=r[u];return new Fi(a,this._parents)}var A$=W(()=>{zl()});function M$(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],o=n.length-1,i=n[o],s;--o>=0;)(s=n[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}var S$=W(()=>{});function T$(e){e||(e=VIe);function t(_,y){return _&&y?e(_.__data__,y.__data__):!_-!y}for(var r=this._groups,n=r.length,o=new Array(n),i=0;i<n;++i){for(var s=r[i],a=s.length,u=o[i]=new Array(a),h,p=0;p<a;++p)(h=s[p])&&(u[p]=h);u.sort(t)}return new Fi(o,this._parents).order()}function VIe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var E$=W(()=>{zl()});function I$(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}var C$=W(()=>{});function k$(){return Array.from(this)}var P$=W(()=>{});function O$(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],o=0,i=n.length;o<i;++o){var s=n[o];if(s)return s}return null}var R$=W(()=>{});function N$(){let e=0;for(let t of this)++e;return e}var z$=W(()=>{});function D$(){return!this.node()}var L$=W(()=>{});function F$(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var o=t[r],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}var B$=W(()=>{});function WIe(e){return function(){this.removeAttribute(e)}}function ZIe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function YIe(e,t){return function(){this.setAttribute(e,t)}}function qIe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function GIe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function HIe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function j$(e,t){var r=vc(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?ZIe:WIe:typeof t=="function"?r.local?HIe:GIe:r.local?qIe:YIe)(r,t))}var U$=W(()=>{T3()});function ug(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}var k3=W(()=>{});function XIe(e){return function(){this.style.removeProperty(e)}}function KIe(e,t,r){return function(){this.style.setProperty(e,t,r)}}function $Ie(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function V$(e,t,r){return arguments.length>1?this.each((t==null?XIe:typeof t=="function"?$Ie:KIe)(e,t,r??"")):Mu(this.node(),e)}function Mu(e,t){return e.style.getPropertyValue(t)||ug(e).getComputedStyle(e,null).getPropertyValue(t)}var SN=W(()=>{k3()});function QIe(e){return function(){delete this[e]}}function JIe(e,t){return function(){this[e]=t}}function eCe(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function W$(e,t){return arguments.length>1?this.each((t==null?QIe:typeof t=="function"?eCe:JIe)(e,t)):this.node()[e]}var Z$=W(()=>{});function Y$(e){return e.trim().split(/^|\s+/)}function TN(e){return e.classList||new q$(e)}function q$(e){this._node=e,this._names=Y$(e.getAttribute("class")||"")}function G$(e,t){for(var r=TN(e),n=-1,o=t.length;++n<o;)r.add(t[n])}function H$(e,t){for(var r=TN(e),n=-1,o=t.length;++n<o;)r.remove(t[n])}function tCe(e){return function(){G$(this,e)}}function rCe(e){return function(){H$(this,e)}}function nCe(e,t){return function(){(t.apply(this,arguments)?G$:H$)(this,e)}}function X$(e,t){var r=Y$(e+"");if(arguments.length<2){for(var n=TN(this.node()),o=-1,i=r.length;++o<i;)if(!n.contains(r[o]))return!1;return!0}return this.each((typeof t=="function"?nCe:t?tCe:rCe)(r,t))}var K$=W(()=>{q$.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}}});function iCe(){this.textContent=""}function oCe(e){return function(){this.textContent=e}}function sCe(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function $$(e){return arguments.length?this.each(e==null?iCe:(typeof e=="function"?sCe:oCe)(e)):this.node().textContent}var Q$=W(()=>{});function aCe(){this.innerHTML=""}function lCe(e){return function(){this.innerHTML=e}}function cCe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function J$(e){return arguments.length?this.each(e==null?aCe:(typeof e=="function"?cCe:lCe)(e)):this.node().innerHTML}var eQ=W(()=>{});function uCe(){this.nextSibling&&this.parentNode.appendChild(this)}function tQ(){return this.each(uCe)}var rQ=W(()=>{});function fCe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function nQ(){return this.each(fCe)}var iQ=W(()=>{});function oQ(e){var t=typeof e=="function"?e:Xf(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}var sQ=W(()=>{P1()});function hCe(){return null}function aQ(e,t){var r=typeof e=="function"?e:Xf(e),n=t==null?hCe:typeof t=="function"?t:Kf(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var lQ=W(()=>{P1();E3()});function dCe(){var e=this.parentNode;e&&e.removeChild(this)}function cQ(){return this.each(dCe)}var uQ=W(()=>{});function pCe(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function mCe(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fQ(e){return this.select(e?mCe:pCe)}var hQ=W(()=>{});function dQ(e){return arguments.length?this.property("__data__",e):this.node().__data__}var pQ=W(()=>{});function gCe(e){return function(t){e.call(this,t,this.__data__)}}function _Ce(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function yCe(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,o=t.length,i;r<o;++r)i=t[r],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++n]=i;++n?t.length=n:delete this.__on}}}function xCe(e,t,r){return function(){var n=this.__on,o,i=gCe(t);if(n){for(var s=0,a=n.length;s<a;++s)if((o=n[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=r),o.value=t;return}}this.addEventListener(e.type,i,r),o={type:e.type,name:e.name,value:t,listener:i,options:r},n?n.push(o):this.__on=[o]}}function mQ(e,t,r){var n=_Ce(e+""),o,i=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,h=a.length,p;u<h;++u)for(o=0,p=a[u];o<i;++o)if((s=n[o]).type===p.type&&s.name===p.name)return p.value}return}for(a=t?xCe:yCe,o=0;o<i;++o)this.each(a(n[o],t,r));return this}var gQ=W(()=>{});function _Q(e,t,r){var n=ug(e),o=n.CustomEvent;typeof o=="function"?o=new o(t,r):(o=n.document.createEvent("Event"),r?(o.initEvent(t,r.bubbles,r.cancelable),o.detail=r.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function bCe(e,t){return function(){return _Q(this,e,t)}}function vCe(e,t){return function(){return _Q(this,e,t.apply(this,arguments))}}function yQ(e,t){return this.each((typeof t=="function"?vCe:bCe)(e,t))}var xQ=W(()=>{k3()});function*bQ(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],o=0,i=n.length,s;o<i;++o)(s=n[o])&&(yield s)}var vQ=W(()=>{});function Fi(e,t){this._groups=e,this._parents=t}function wQ(){return new Fi([[document.documentElement]],z1)}function wCe(){return this}var z1,wc,zl=W(()=>{i$();s$();l$();u$();h$();_$();MN();x$();v$();A$();S$();E$();C$();P$();R$();z$();L$();B$();U$();SN();Z$();K$();Q$();eQ();rQ();iQ();sQ();lQ();uQ();hQ();pQ();gQ();xQ();vQ();z1=[null];Fi.prototype=wQ.prototype={constructor:Fi,select:n$,selectAll:o$,selectChild:a$,selectChildren:c$,filter:f$,data:g$,enter:d$,exit:y$,join:b$,merge:w$,selection:wCe,order:M$,sort:T$,call:I$,nodes:k$,node:O$,size:N$,empty:D$,each:F$,attr:j$,style:V$,property:W$,classed:X$,text:$$,html:J$,raise:tQ,lower:nQ,append:oQ,insert:aQ,remove:cQ,clone:fQ,datum:dQ,on:mQ,dispatch:yQ,[Symbol.iterator]:bQ};wc=wQ});function $t(e){return typeof e=="string"?new Fi([[document.querySelector(e)]],[document.documentElement]):new Fi([[e]],z1)}var EN=W(()=>{zl()});function IN(e){return $t(Xf(e).call(document.documentElement))}var AQ=W(()=>{P1();EN()});function D1(){return new CN}function CN(){this._="@"+(++ACe).toString(36)}var ACe,MQ=W(()=>{ACe=0;CN.prototype=D1.prototype={constructor:CN,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}}});function P3(e){let t;for(;t=e.sourceEvent;)e=t;return e}var kN=W(()=>{});function Uo(e,t){if(e=P3(e),t===void 0&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,n=n.matrixTransform(t.getScreenCTM().inverse()),[n.x,n.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}var PN=W(()=>{kN()});function ON(e,t){return e.target&&(e=P3(e),t===void 0&&(t=e.currentTarget),e=e.touches||[e]),Array.from(e,r=>Uo(r,t))}var SQ=W(()=>{PN();kN()});function L1(e){return typeof e=="string"?new Fi([document.querySelectorAll(e)],[document.documentElement]):new Fi([O1(e)],z1)}var TQ=W(()=>{vN();zl()});var EQ={};io(EQ,{create:()=>IN,creator:()=>Xf,local:()=>D1,matcher:()=>cg,namespace:()=>vc,namespaces:()=>ny,pointer:()=>Uo,pointers:()=>ON,select:()=>$t,selectAll:()=>L1,selection:()=>wc,selector:()=>Kf,selectorAll:()=>lg,style:()=>Mu,window:()=>ug});var Fs=W(()=>{AQ();P1();MQ();R1();T3();S3();PN();SQ();EN();TQ();zl();E3();wN();SN();k3()});function O3(e){e.stopImmediatePropagation()}function Fd(e){e.preventDefault(),e.stopImmediatePropagation()}var IQ,fg,RN=W(()=>{IQ={passive:!1},fg={capture:!0,passive:!1}});function Bd(e){var t=e.document.documentElement,r=$t(e).on("dragstart.drag",Fd,fg);"onselectstart"in t?r.on("selectstart.drag",Fd,fg):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function jd(e,t){var r=e.document.documentElement,n=$t(e).on("dragstart.drag",null);t&&(n.on("click.drag",Fd,fg),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var NN=W(()=>{Fs();RN()});var F1,CQ=W(()=>{F1=e=>()=>e});function B1(e,{sourceEvent:t,subject:r,target:n,identifier:o,active:i,x:s,y:a,dx:u,dy:h,dispatch:p}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:o,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:u,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:p}})}var kQ=W(()=>{B1.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e}});function MCe(e){return!e.ctrlKey&&!e.button}function SCe(){return this.parentNode}function TCe(e,t){return t??{x:e.x,y:e.y}}function ECe(){return navigator.maxTouchPoints||"ontouchstart"in this}function hg(){var e=MCe,t=SCe,r=TCe,n=ECe,o={},i=rl("start","drag","end"),s=0,a,u,h,p,_=0;function y(j){j.on("mousedown.drag",A).filter(n).on("touchstart.drag",P).on("touchmove.drag",R,IQ).on("touchend.drag touchcancel.drag",V).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function A(j,J){if(!(p||!e.call(this,j,J))){var ne=N(this,t.call(this,j,J),j,J,"mouse");ne&&($t(j.view).on("mousemove.drag",E,fg).on("mouseup.drag",k,fg),Bd(j.view),O3(j),h=!1,a=j.clientX,u=j.clientY,ne("start",j))}}function E(j){if(Fd(j),!h){var J=j.clientX-a,ne=j.clientY-u;h=J*J+ne*ne>_}o.mouse("drag",j)}function k(j){$t(j.view).on("mousemove.drag mouseup.drag",null),jd(j.view,h),Fd(j),o.mouse("end",j)}function P(j,J){if(e.call(this,j,J)){var ne=j.changedTouches,de=t.call(this,j,J),fe=ne.length,ye,ve;for(ye=0;ye<fe;++ye)(ve=N(this,de,j,J,ne[ye].identifier,ne[ye]))&&(O3(j),ve("start",j,ne[ye]))}}function R(j){var J=j.changedTouches,ne=J.length,de,fe;for(de=0;de<ne;++de)(fe=o[J[de].identifier])&&(Fd(j),fe("drag",j,J[de]))}function V(j){var J=j.changedTouches,ne=J.length,de,fe;for(p&&clearTimeout(p),p=setTimeout(function(){p=null},500),de=0;de<ne;++de)(fe=o[J[de].identifier])&&(O3(j),fe("end",j,J[de]))}function N(j,J,ne,de,fe,ye){var ve=i.copy(),be=Uo(ye||ne,J),je,Re,Se;if((Se=r.call(j,new B1("beforestart",{sourceEvent:ne,target:y,identifier:fe,active:s,x:be[0],y:be[1],dx:0,dy:0,dispatch:ve}),de))!=null)return je=Se.x-be[0]||0,Re=Se.y-be[1]||0,function Ue(qe,Je,gt){var rt=be,At;switch(qe){case"start":o[fe]=Ue,At=s++;break;case"end":delete o[fe],--s;case"drag":be=Uo(gt||Je,J),At=s;break}ve.call(qe,j,new B1(qe,{sourceEvent:Je,subject:Se,target:y,identifier:fe,active:At,x:be[0]+je,y:be[1]+Re,dx:be[0]-rt[0],dy:be[1]-rt[1],dispatch:ve}),de)}}return y.filter=function(j){return arguments.length?(e=typeof j=="function"?j:F1(!!j),y):e},y.container=function(j){return arguments.length?(t=typeof j=="function"?j:F1(j),y):t},y.subject=function(j){return arguments.length?(r=typeof j=="function"?j:F1(j),y):r},y.touchable=function(j){return arguments.length?(n=typeof j=="function"?j:F1(!!j),y):n},y.on=function(){var j=i.on.apply(i,arguments);return j===i?y:j},y.clickDistance=function(j){return arguments.length?(_=(j=+j)*j,y):Math.sqrt(_)},y}var PQ=W(()=>{Ld();Fs();NN();RN();CQ();kQ()});var R3=W(()=>{PQ();NN()});function $f(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Ud(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}var N3=W(()=>{});function Tu(){}function RQ(){return this.rgb().formatHex()}function zCe(){return this.rgb().formatHex8()}function DCe(){return jQ(this).formatHsl()}function NQ(){return this.rgb().formatRgb()}function Vo(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=ICe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?zQ(t):r===3?new Po(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?z3(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?z3(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=CCe.exec(e))?new Po(t[1],t[2],t[3],1):(t=kCe.exec(e))?new Po(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=PCe.exec(e))?z3(t[1],t[2],t[3],t[4]):(t=OCe.exec(e))?z3(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=RCe.exec(e))?FQ(t[1],t[2]/100,t[3]/100,1):(t=NCe.exec(e))?FQ(t[1],t[2]/100,t[3]/100,t[4]):OQ.hasOwnProperty(e)?zQ(OQ[e]):e==="transparent"?new Po(NaN,NaN,NaN,0):null}function zQ(e){return new Po(e>>16&255,e>>8&255,e&255,1)}function z3(e,t,r,n){return n<=0&&(e=t=r=NaN),new Po(e,t,r,n)}function U1(e){return e instanceof Tu||(e=Vo(e)),e?(e=e.rgb(),new Po(e.r,e.g,e.b,e.opacity)):new Po}function Qf(e,t,r,n){return arguments.length===1?U1(e):new Po(e,t,r,n??1)}function Po(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function DQ(){return`#${dg(this.r)}${dg(this.g)}${dg(this.b)}`}function LCe(){return`#${dg(this.r)}${dg(this.g)}${dg(this.b)}${dg((isNaN(this.opacity)?1:this.opacity)*255)}`}function LQ(){let e=L3(this.opacity);return`${e===1?"rgb(":"rgba("}${pg(this.r)}, ${pg(this.g)}, ${pg(this.b)}${e===1?")":`, ${e})`}`}function L3(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function pg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function dg(e){return e=pg(e),(e<16?"0":"")+e.toString(16)}function FQ(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ac(e,t,r,n)}function jQ(e){if(e instanceof Ac)return new Ac(e.h,e.s,e.l,e.opacity);if(e instanceof Tu||(e=Vo(e)),!e)return new Ac;if(e instanceof Ac)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,o=Math.min(t,r,n),i=Math.max(t,r,n),s=NaN,a=i-o,u=(i+o)/2;return a?(t===i?s=(r-n)/a+(r<n)*6:r===i?s=(n-t)/a+2:s=(t-r)/a+4,a/=u<.5?i+o:2-i-o,s*=60):a=u>0&&u<1?0:s,new Ac(s,a,u,e.opacity)}function oy(e,t,r,n){return arguments.length===1?jQ(e):new Ac(e,t,r,n??1)}function Ac(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function BQ(e){return e=(e||0)%360,e<0?e+360:e}function D3(e){return Math.max(0,Math.min(1,e||0))}function zN(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var Vd,mg,iy,j1,Su,ICe,CCe,kCe,PCe,OCe,RCe,NCe,OQ,F3=W(()=>{N3();Vd=.7,mg=1/Vd,iy="\\s*([+-]?\\d+)\\s*",j1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Su="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ICe=/^#([0-9a-f]{3,8})$/,CCe=new RegExp(`^rgb\\(${iy},${iy},${iy}\\)$`),kCe=new RegExp(`^rgb\\(${Su},${Su},${Su}\\)$`),PCe=new RegExp(`^rgba\\(${iy},${iy},${iy},${j1}\\)$`),OCe=new RegExp(`^rgba\\(${Su},${Su},${Su},${j1}\\)$`),RCe=new RegExp(`^hsl\\(${j1},${Su},${Su}\\)$`),NCe=new RegExp(`^hsla\\(${j1},${Su},${Su},${j1}\\)$`),OQ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$f(Tu,Vo,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:RQ,formatHex:RQ,formatHex8:zCe,formatHsl:DCe,formatRgb:NQ,toString:NQ});$f(Po,Qf,Ud(Tu,{brighter(e){return e=e==null?mg:Math.pow(mg,e),new Po(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Vd:Math.pow(Vd,e),new Po(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Po(pg(this.r),pg(this.g),pg(this.b),L3(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:DQ,formatHex:DQ,formatHex8:LCe,formatRgb:LQ,toString:LQ}));$f(Ac,oy,Ud(Tu,{brighter(e){return e=e==null?mg:Math.pow(mg,e),new Ac(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Vd:Math.pow(Vd,e),new Ac(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,o=2*r-n;return new Po(zN(e>=240?e-240:e+120,o,n),zN(e,o,n),zN(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new Ac(BQ(this.h),D3(this.s),D3(this.l),L3(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=L3(this.opacity);return`${e===1?"hsl(":"hsla("}${BQ(this.h)}, ${D3(this.s)*100}%, ${D3(this.l)*100}%${e===1?")":`, ${e})`}`}}))});var B3,j3,DN=W(()=>{B3=Math.PI/180,j3=180/Math.PI});function qQ(e){if(e instanceof Mc)return new Mc(e.l,e.a,e.b,e.opacity);if(e instanceof Eu)return KQ(e);e instanceof Po||(e=U1(e));var t=jN(e.r),r=jN(e.g),n=jN(e.b),o=LN((.2225045*t+.7168786*r+.0606169*n)/VQ),i,s;return t===r&&r===n?i=s=o:(i=LN((.4360747*t+.3850649*r+.1430804*n)/UQ),s=LN((.0139322*t+.0971045*r+.7141733*n)/WQ)),new Mc(116*o-16,500*(i-o),200*(o-s),e.opacity)}function GQ(e,t){return new Mc(e,0,0,t??1)}function gg(e,t,r,n){return arguments.length===1?qQ(e):new Mc(e,t,r,n??1)}function Mc(e,t,r,n){this.l=+e,this.a=+t,this.b=+r,this.opacity=+n}function LN(e){return e>FCe?Math.pow(e,1/3):e/YQ+ZQ}function FN(e){return e>sy?e*e*e:YQ*(e-ZQ)}function BN(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function jN(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function HQ(e){if(e instanceof Eu)return new Eu(e.h,e.c,e.l,e.opacity);if(e instanceof Mc||(e=qQ(e)),e.a===0&&e.b===0)return new Eu(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*j3;return new Eu(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function XQ(e,t,r,n){return arguments.length===1?HQ(e):new Eu(r,t,e,n??1)}function ay(e,t,r,n){return arguments.length===1?HQ(e):new Eu(e,t,r,n??1)}function Eu(e,t,r,n){this.h=+e,this.c=+t,this.l=+r,this.opacity=+n}function KQ(e){if(isNaN(e.h))return new Mc(e.l,0,0,e.opacity);var t=e.h*B3;return new Mc(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}var U3,UQ,VQ,WQ,ZQ,sy,YQ,FCe,$Q=W(()=>{N3();F3();DN();U3=18,UQ=.96422,VQ=1,WQ=.82521,ZQ=4/29,sy=6/29,YQ=3*sy*sy,FCe=sy*sy*sy;$f(Mc,gg,Ud(Tu,{brighter(e){return new Mc(this.l+U3*(e??1),this.a,this.b,this.opacity)},darker(e){return new Mc(this.l-U3*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,r=isNaN(this.b)?e:e-this.b/200;return t=UQ*FN(t),e=VQ*FN(e),r=WQ*FN(r),new Po(BN(3.1338561*t-1.6168667*e-.4906146*r),BN(-.9787684*t+1.9161415*e+.033454*r),BN(.0719453*t-.2289914*e+1.4052427*r),this.opacity)}}));$f(Eu,ay,Ud(Tu,{brighter(e){return new Eu(this.h,this.c,this.l+U3*(e??1),this.opacity)},darker(e){return new Eu(this.h,this.c,this.l-U3*(e??1),this.opacity)},rgb(){return KQ(this).rgb()}}))});function BCe(e){if(e instanceof _g)return new _g(e.h,e.s,e.l,e.opacity);e instanceof Po||(e=U1(e));var t=e.r/255,r=e.g/255,n=e.b/255,o=(eJ*n+QQ*t-JQ*r)/(eJ+QQ-JQ),i=n-o,s=(V1*(r-o)-VN*i)/V3,a=Math.sqrt(s*s+i*i)/(V1*o*(1-o)),u=a?Math.atan2(s,i)*j3-120:NaN;return new _g(u<0?u+360:u,a,o,e.opacity)}function Bs(e,t,r,n){return arguments.length===1?BCe(e):new _g(e,t,r,n??1)}function _g(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}var tJ,UN,VN,V3,V1,QQ,JQ,eJ,rJ=W(()=>{N3();F3();DN();tJ=-.14861,UN=1.78277,VN=-.29227,V3=-.90649,V1=1.97294,QQ=V1*V3,JQ=V1*UN,eJ=UN*VN-V3*tJ;$f(_g,Bs,Ud(Tu,{brighter(e){return e=e==null?mg:Math.pow(mg,e),new _g(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Vd:Math.pow(Vd,e),new _g(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*B3,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),o=Math.sin(e);return new Po(255*(t+r*(tJ*n+UN*o)),255*(t+r*(VN*n+V3*o)),255*(t+r*(V1*n)),this.opacity)}}))});var Dl=W(()=>{F3();$Q();rJ()});function WN(e,t,r,n,o){var i=e*e,s=i*e;return((1-3*e+3*i-s)*t+(4-6*i+3*s)*r+(1+3*e+3*i-3*s)*n+s*o)/6}function W3(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),o=e[n],i=e[n+1],s=n>0?e[n-1]:2*o-i,a=n<t-1?e[n+2]:2*i-o;return WN((r-n/t)*t,s,o,i,a)}}var Z3=W(()=>{});function Y3(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),o=e[(n+t-1)%t],i=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return WN((r-n/t)*t,o,i,s,a)}}var ZN=W(()=>{Z3()});var ly,YN=W(()=>{ly=e=>()=>e});function nJ(e,t){return function(r){return e+r*t}}function jCe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Wd(e,t){var r=t-e;return r?nJ(e,r>180||r<-180?r-360*Math.round(r/360):r):ly(isNaN(e)?t:e)}function iJ(e){return(e=+e)==1?Zi:function(t,r){return r-t?jCe(t,r,e):ly(isNaN(t)?r:t)}}function Zi(e,t){var r=t-e;return r?nJ(e,r):ly(isNaN(e)?t:e)}var yg=W(()=>{YN()});function oJ(e){return function(t){var r=t.length,n=new Array(r),o=new Array(r),i=new Array(r),s,a;for(s=0;s<r;++s)a=Qf(t[s]),n[s]=a.r||0,o[s]=a.g||0,i[s]=a.b||0;return n=e(n),o=e(o),i=e(i),a.opacity=1,function(u){return a.r=n(u),a.g=o(u),a.b=i(u),a+""}}}var Zd,q3,sJ,qN=W(()=>{Dl();Z3();ZN();yg();Zd=function e(t){var r=iJ(t);function n(o,i){var s=r((o=Qf(o)).r,(i=Qf(i)).r),a=r(o.g,i.g),u=r(o.b,i.b),h=Zi(o.opacity,i.opacity);return function(p){return o.r=s(p),o.g=a(p),o.b=u(p),o.opacity=h(p),o+""}}return n.gamma=e,n}(1);q3=oJ(W3),sJ=oJ(Y3)});function cy(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),o;return function(i){for(o=0;o<r;++o)n[o]=e[o]*(1-i)+t[o]*i;return n}}function G3(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var H3=W(()=>{});function aJ(e,t){return(G3(t)?cy:GN)(e,t)}function GN(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,o=new Array(n),i=new Array(r),s;for(s=0;s<n;++s)o[s]=$i(e[s],t[s]);for(;s<r;++s)i[s]=t[s];return function(a){for(s=0;s<n;++s)i[s]=o[s](a);return i}}var HN=W(()=>{W1();H3()});function X3(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}var XN=W(()=>{});function ns(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var Z1=W(()=>{});function K3(e,t){var r={},n={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?r[o]=$i(e[o],t[o]):n[o]=t[o];return function(i){for(o in r)n[o]=r[o](i);return n}}var KN=W(()=>{W1()});function UCe(e){return function(){return e}}function VCe(e){return function(t){return e(t)+""}}function uy(e,t){var r=QN.lastIndex=$N.lastIndex=0,n,o,i,s=-1,a=[],u=[];for(e=e+"",t=t+"";(n=QN.exec(e))&&(o=$N.exec(t));)(i=o.index)>r&&(i=t.slice(r,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,u.push({i:s,x:ns(n,o)})),r=$N.lastIndex;return r<t.length&&(i=t.slice(r),a[s]?a[s]+=i:a[++s]=i),a.length<2?u[0]?VCe(u[0].x):UCe(t):(t=u.length,function(h){for(var p=0,_;p<t;++p)a[(_=u[p]).i]=_.x(h);return a.join("")})}var QN,$N,JN=W(()=>{Z1();QN=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$N=new RegExp(QN.source,"g")});function $i(e,t){var r=typeof t,n;return t==null||r==="boolean"?ly(t):(r==="number"?ns:r==="string"?(n=Vo(t))?(t=n,Zd):uy:t instanceof Vo?Zd:t instanceof Date?X3:G3(t)?cy:Array.isArray(t)?GN:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?K3:ns)(e,t)}var W1=W(()=>{Dl();qN();HN();XN();Z1();KN();JN();YN();H3()});function lJ(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var cJ=W(()=>{});function uJ(e,t){var r=Wd(+e,+t);return function(n){var o=r(n);return o-360*Math.floor(o/360)}}var fJ=W(()=>{yg()});function Yd(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var hJ=W(()=>{});function ez(e,t,r,n,o,i){var s,a,u;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(u=e*r+t*n)&&(r-=e*u,n-=t*u),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,u/=a),e*n<t*r&&(e=-e,t=-t,u=-u,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*dJ,skewX:Math.atan(u)*dJ,scaleX:s,scaleY:a}}var dJ,$3,pJ=W(()=>{dJ=180/Math.PI,$3={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1}});function mJ(e){let t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?$3:ez(t.a,t.b,t.c,t.d,t.e,t.f)}function gJ(e){return e==null?$3:(Q3||(Q3=document.createElementNS("http://www.w3.org/2000/svg","g")),Q3.setAttribute("transform",e),(e=Q3.transform.baseVal.consolidate())?(e=e.matrix,ez(e.a,e.b,e.c,e.d,e.e,e.f)):$3)}var Q3,_J=W(()=>{pJ()});function yJ(e,t,r,n){function o(h){return h.length?h.pop()+" ":""}function i(h,p,_,y,A,E){if(h!==_||p!==y){var k=A.push("translate(",null,t,null,r);E.push({i:k-4,x:ns(h,_)},{i:k-2,x:ns(p,y)})}else(_||y)&&A.push("translate("+_+t+y+r)}function s(h,p,_,y){h!==p?(h-p>180?p+=360:p-h>180&&(h+=360),y.push({i:_.push(o(_)+"rotate(",null,n)-2,x:ns(h,p)})):p&&_.push(o(_)+"rotate("+p+n)}function a(h,p,_,y){h!==p?y.push({i:_.push(o(_)+"skewX(",null,n)-2,x:ns(h,p)}):p&&_.push(o(_)+"skewX("+p+n)}function u(h,p,_,y,A,E){if(h!==_||p!==y){var k=A.push(o(A)+"scale(",null,",",null,")");E.push({i:k-4,x:ns(h,_)},{i:k-2,x:ns(p,y)})}else(_!==1||y!==1)&&A.push(o(A)+"scale("+_+","+y+")")}return function(h,p){var _=[],y=[];return h=e(h),p=e(p),i(h.translateX,h.translateY,p.translateX,p.translateY,_,y),s(h.rotate,p.rotate,_,y),a(h.skewX,p.skewX,_,y),u(h.scaleX,h.scaleY,p.scaleX,p.scaleY,_,y),h=p=null,function(A){for(var E=-1,k=y.length,P;++E<k;)_[(P=y[E]).i]=P.x(A);return _.join("")}}}var J3,eE,xJ=W(()=>{Z1();_J();J3=yJ(mJ,"px, ","px)","deg)"),eE=yJ(gJ,", ",")",")")});function bJ(e){return((e=Math.exp(e))+1/e)/2}function ZCe(e){return((e=Math.exp(e))-1/e)/2}function YCe(e){return((e=Math.exp(2*e))-1)/(e+1)}var WCe,tE,vJ=W(()=>{WCe=1e-12;tE=function e(t,r,n){function o(i,s){var a=i[0],u=i[1],h=i[2],p=s[0],_=s[1],y=s[2],A=p-a,E=_-u,k=A*A+E*E,P,R;if(k<WCe)R=Math.log(y/h)/t,P=function(de){return[a+de*A,u+de*E,h*Math.exp(t*de*R)]};else{var V=Math.sqrt(k),N=(y*y-h*h+n*k)/(2*h*r*V),j=(y*y-h*h-n*k)/(2*y*r*V),J=Math.log(Math.sqrt(N*N+1)-N),ne=Math.log(Math.sqrt(j*j+1)-j);R=(ne-J)/t,P=function(de){var fe=de*R,ye=bJ(J),ve=h/(r*V)*(ye*YCe(t*fe+J)-ZCe(J));return[a+ve*A,u+ve*E,h*ye/bJ(t*fe+J)]}}return P.duration=R*1e3*t/Math.SQRT2,P}return o.rho=function(i){var s=Math.max(.001,+i),a=s*s,u=a*a;return e(s,a,u)},o}(Math.SQRT2,2,4)});function wJ(e){return function(t,r){var n=e((t=oy(t)).h,(r=oy(r)).h),o=Zi(t.s,r.s),i=Zi(t.l,r.l),s=Zi(t.opacity,r.opacity);return function(a){return t.h=n(a),t.s=o(a),t.l=i(a),t.opacity=s(a),t+""}}}var AJ,MJ,SJ=W(()=>{Dl();yg();AJ=wJ(Wd),MJ=wJ(Zi)});function tz(e,t){var r=Zi((e=gg(e)).l,(t=gg(t)).l),n=Zi(e.a,t.a),o=Zi(e.b,t.b),i=Zi(e.opacity,t.opacity);return function(s){return e.l=r(s),e.a=n(s),e.b=o(s),e.opacity=i(s),e+""}}var TJ=W(()=>{Dl();yg()});function EJ(e){return function(t,r){var n=e((t=ay(t)).h,(r=ay(r)).h),o=Zi(t.c,r.c),i=Zi(t.l,r.l),s=Zi(t.opacity,r.opacity);return function(a){return t.h=n(a),t.c=o(a),t.l=i(a),t.opacity=s(a),t+""}}}var IJ,CJ,kJ=W(()=>{Dl();yg();IJ=EJ(Wd),CJ=EJ(Zi)});function PJ(e){return function t(r){r=+r;function n(o,i){var s=e((o=Bs(o)).h,(i=Bs(i)).h),a=Zi(o.s,i.s),u=Zi(o.l,i.l),h=Zi(o.opacity,i.opacity);return function(p){return o.h=s(p),o.s=a(p),o.l=u(Math.pow(p,r)),o.opacity=h(p),o+""}}return n.gamma=t,n}(1)}var OJ,xg,RJ=W(()=>{Dl();yg();OJ=PJ(Wd),xg=PJ(Zi)});function Y1(e,t){t===void 0&&(t=e,e=$i);for(var r=0,n=t.length-1,o=t[0],i=new Array(n<0?0:n);r<n;)i[r]=e(o,o=t[++r]);return function(s){var a=Math.max(0,Math.min(n-1,Math.floor(s*=n)));return i[a](s-a)}}var NJ=W(()=>{W1()});function zJ(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e(n/(t-1));return r}var DJ=W(()=>{});var nl=W(()=>{W1();HN();Z3();ZN();XN();cJ();fJ();Z1();H3();KN();hJ();JN();xJ();vJ();qN();SJ();TJ();kJ();RJ();NJ();DJ()});function qd(){return bg||(BJ(qCe),bg=X1.now()+iE)}function qCe(){bg=0}function vg(){this._call=this._time=this._next=null}function wg(e,t,r){var n=new vg;return n.restart(e,t,r),n}function nz(){qd(),++fy;for(var e=rE,t;e;)(t=bg-e._time)>=0&&e._call.call(void 0,t),e=e._next;--fy}function LJ(){bg=(nE=X1.now())+iE,fy=G1=0;try{nz()}finally{fy=0,HCe(),bg=0}}function GCe(){var e=X1.now(),t=e-nE;t>FJ&&(iE-=t,nE=e)}function HCe(){for(var e,t=rE,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:rE=r);H1=e,rz(n)}function rz(e){if(!fy){G1&&(G1=clearTimeout(G1));var t=e-bg;t>24?(e<1/0&&(G1=setTimeout(LJ,e-X1.now()-iE)),q1&&(q1=clearInterval(q1))):(q1||(nE=X1.now(),q1=setInterval(GCe,FJ)),fy=1,BJ(LJ))}}var fy,G1,q1,FJ,rE,H1,nE,bg,iE,X1,BJ,oE=W(()=>{fy=0,G1=0,q1=0,FJ=1e3,nE=0,bg=0,iE=0,X1=typeof performance=="object"&&performance.now?performance:Date,BJ=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};vg.prototype=wg.prototype={constructor:vg,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?qd():+r)+(t==null?0:+t),!this._next&&H1!==this&&(H1?H1._next=this:rE=this,H1=this),this._call=e,this._time=r,rz()},stop:function(){this._call&&(this._call=null,this._time=1/0,rz())}}});function K1(e,t,r){var n=new vg;return t=t==null?0:+t,n.restart(o=>{n.stop(),e(o+t)},t,r),n}var jJ=W(()=>{oE()});function UJ(e,t,r){var n=new vg,o=t;return t==null?(n.restart(e,t,r),n):(n._restart=n.restart,n.restart=function(i,s,a){s=+s,a=a==null?qd():+a,n._restart(function u(h){h+=o,n._restart(u,o+=s,a),i(h)},s,a)},n.restart(e,t,r),n)}var VJ=W(()=>{oE()});var $1=W(()=>{oE();jJ();VJ()});function Gd(e,t,r,n,o,i){var s=e.__transition;if(!s)e.__transition={};else if(r in s)return;$Ce(e,r,{name:t,index:n,group:o,on:XCe,tween:KCe,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:ZJ})}function J1(e,t){var r=Wo(e,t);if(r.state>ZJ)throw new Error("too late; already scheduled");return r}function ms(e,t){var r=Wo(e,t);if(r.state>sE)throw new Error("too late; already running");return r}function Wo(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function $Ce(e,t,r){var n=e.__transition,o;n[t]=r,r.timer=wg(i,0,r.time);function i(h){r.state=aE,r.timer.restart(s,r.delay,r.time),r.delay<=h&&s(h-r.delay)}function s(h){var p,_,y,A;if(r.state!==aE)return u();for(p in n)if(A=n[p],A.name===r.name){if(A.state===sE)return K1(s);A.state===WJ?(A.state=Q1,A.timer.stop(),A.on.call("interrupt",e,e.__data__,A.index,A.group),delete n[p]):+p<t&&(A.state=Q1,A.timer.stop(),A.on.call("cancel",e,e.__data__,A.index,A.group),delete n[p])}if(K1(function(){r.state===sE&&(r.state=WJ,r.timer.restart(a,r.delay,r.time),a(h))}),r.state=lE,r.on.call("start",e,e.__data__,r.index,r.group),r.state===lE){for(r.state=sE,o=new Array(y=r.tween.length),p=0,_=-1;p<y;++p)(A=r.tween[p].value.call(e,e.__data__,r.index,r.group))&&(o[++_]=A);o.length=_+1}}function a(h){for(var p=h<r.duration?r.ease.call(null,h/r.duration):(r.timer.restart(u),r.state=cE,1),_=-1,y=o.length;++_<y;)o[_].call(e,p);r.state===cE&&(r.on.call("end",e,e.__data__,r.index,r.group),u())}function u(){r.state=Q1,r.timer.stop(),delete n[t];for(var h in n)return;delete e.__transition}}var XCe,KCe,ZJ,aE,lE,sE,WJ,cE,Q1,ua=W(()=>{Ld();$1();XCe=rl("start","end","cancel","interrupt"),KCe=[],ZJ=0,aE=1,lE=2,sE=3,WJ=4,cE=5,Q1=6});function Sc(e,t){var r=e.__transition,n,o,i=!0,s;if(r){t=t==null?null:t+"";for(s in r){if((n=r[s]).name!==t){i=!1;continue}o=n.state>lE&&n.state<cE,n.state=Q1,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[s]}i&&delete e.__transition}}var iz=W(()=>{ua()});function YJ(e){return this.each(function(){Sc(this,e)})}var qJ=W(()=>{iz()});function QCe(e,t){var r,n;return function(){var o=ms(this,e),i=o.tween;if(i!==r){n=r=i;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){n=n.slice(),n.splice(s,1);break}}o.tween=n}}function JCe(e,t,r){var n,o;if(typeof r!="function")throw new Error;return function(){var i=ms(this,e),s=i.tween;if(s!==n){o=(n=s).slice();for(var a={name:t,value:r},u=0,h=o.length;u<h;++u)if(o[u].name===t){o[u]=a;break}u===h&&o.push(a)}i.tween=o}}function GJ(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n=Wo(this.node(),r).tween,o=0,i=n.length,s;o<i;++o)if((s=n[o]).name===e)return s.value;return null}return this.each((t==null?QCe:JCe)(r,e,t))}function hy(e,t,r){var n=e._id;return e.each(function(){var o=ms(this,n);(o.value||(o.value={}))[t]=r.apply(this,arguments)}),function(o){return Wo(o,n).value[t]}}var ew=W(()=>{ua()});function uE(e,t){var r;return(typeof t=="number"?ns:t instanceof Vo?Zd:(r=Vo(t))?(t=r,Zd):uy)(e,t)}var oz=W(()=>{Dl();nl()});function eke(e){return function(){this.removeAttribute(e)}}function tke(e){return function(){this.removeAttributeNS(e.space,e.local)}}function rke(e,t,r){var n,o=r+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===n?i:i=t(n=s,r)}}function nke(e,t,r){var n,o=r+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===n?i:i=t(n=s,r)}}function ike(e,t,r){var n,o,i;return function(){var s,a=r(this),u;return a==null?void this.removeAttribute(e):(s=this.getAttribute(e),u=a+"",s===u?null:s===n&&u===o?i:(o=u,i=t(n=s,a)))}}function oke(e,t,r){var n,o,i;return function(){var s,a=r(this),u;return a==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),u=a+"",s===u?null:s===n&&u===o?i:(o=u,i=t(n=s,a)))}}function HJ(e,t){var r=vc(e),n=r==="transform"?eE:uE;return this.attrTween(e,typeof t=="function"?(r.local?oke:ike)(r,n,hy(this,"attr."+e,t)):t==null?(r.local?tke:eke)(r):(r.local?nke:rke)(r,n,t))}var XJ=W(()=>{nl();Fs();ew();oz()});function ske(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}function ake(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}function lke(e,t){var r,n;function o(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&ake(e,i)),r}return o._value=t,o}function cke(e,t){var r,n;function o(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&ske(e,i)),r}return o._value=t,o}function KJ(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;var n=vc(e);return this.tween(r,(n.local?lke:cke)(n,t))}var $J=W(()=>{Fs()});function uke(e,t){return function(){J1(this,e).delay=+t.apply(this,arguments)}}function fke(e,t){return t=+t,function(){J1(this,e).delay=t}}function QJ(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?uke:fke)(t,e)):Wo(this.node(),t).delay}var JJ=W(()=>{ua()});function hke(e,t){return function(){ms(this,e).duration=+t.apply(this,arguments)}}function dke(e,t){return t=+t,function(){ms(this,e).duration=t}}function eee(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hke:dke)(t,e)):Wo(this.node(),t).duration}var tee=W(()=>{ua()});function pke(e,t){if(typeof t!="function")throw new Error;return function(){ms(this,e).ease=t}}function ree(e){var t=this._id;return arguments.length?this.each(pke(t,e)):Wo(this.node(),t).ease}var nee=W(()=>{ua()});function mke(e,t){return function(){var r=t.apply(this,arguments);if(typeof r!="function")throw new Error;ms(this,e).ease=r}}function iee(e){if(typeof e!="function")throw new Error;return this.each(mke(this._id,e))}var oee=W(()=>{ua()});function see(e){typeof e!="function"&&(e=cg(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var i=t[o],s=i.length,a=n[o]=[],u,h=0;h<s;++h)(u=i[h])&&e.call(u,u.__data__,h,i)&&a.push(u);return new gs(n,this._parents,this._name,this._id)}var aee=W(()=>{Fs();Jf()});function lee(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,n=t.length,o=r.length,i=Math.min(n,o),s=new Array(n),a=0;a<i;++a)for(var u=t[a],h=r[a],p=u.length,_=s[a]=new Array(p),y,A=0;A<p;++A)(y=u[A]||h[A])&&(_[A]=y);for(;a<n;++a)s[a]=t[a];return new gs(s,this._parents,this._name,this._id)}var cee=W(()=>{Jf()});function gke(e){return(e+"").trim().split(/^|\s+/).every(function(t){var r=t.indexOf(".");return r>=0&&(t=t.slice(0,r)),!t||t==="start"})}function _ke(e,t,r){var n,o,i=gke(t)?J1:ms;return function(){var s=i(this,e),a=s.on;a!==n&&(o=(n=a).copy()).on(t,r),s.on=o}}function uee(e,t){var r=this._id;return arguments.length<2?Wo(this.node(),r).on.on(e):this.each(_ke(r,e,t))}var fee=W(()=>{ua()});function yke(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}function hee(){return this.on("end.remove",yke(this._id))}var dee=W(()=>{});function pee(e){var t=this._name,r=this._id;typeof e!="function"&&(e=Kf(e));for(var n=this._groups,o=n.length,i=new Array(o),s=0;s<o;++s)for(var a=n[s],u=a.length,h=i[s]=new Array(u),p,_,y=0;y<u;++y)(p=a[y])&&(_=e.call(p,p.__data__,y,a))&&("__data__"in p&&(_.__data__=p.__data__),h[y]=_,Gd(h[y],t,r,y,h,Wo(p,r)));return new gs(i,this._parents,t,r)}var mee=W(()=>{Fs();Jf();ua()});function gee(e){var t=this._name,r=this._id;typeof e!="function"&&(e=lg(e));for(var n=this._groups,o=n.length,i=[],s=[],a=0;a<o;++a)for(var u=n[a],h=u.length,p,_=0;_<h;++_)if(p=u[_]){for(var y=e.call(p,p.__data__,_,u),A,E=Wo(p,r),k=0,P=y.length;k<P;++k)(A=y[k])&&Gd(A,t,r,k,y,E);i.push(y),s.push(p)}return new gs(i,s,t,r)}var _ee=W(()=>{Fs();Jf();ua()});function yee(){return new xke(this._groups,this._parents)}var xke,xee=W(()=>{Fs();xke=wc.prototype.constructor});function bke(e,t){var r,n,o;return function(){var i=Mu(this,e),s=(this.style.removeProperty(e),Mu(this,e));return i===s?null:i===r&&s===n?o:o=t(r=i,n=s)}}function bee(e){return function(){this.style.removeProperty(e)}}function vke(e,t,r){var n,o=r+"",i;return function(){var s=Mu(this,e);return s===o?null:s===n?i:i=t(n=s,r)}}function wke(e,t,r){var n,o,i;return function(){var s=Mu(this,e),a=r(this),u=a+"";return a==null&&(u=a=(this.style.removeProperty(e),Mu(this,e))),s===u?null:s===n&&u===o?i:(o=u,i=t(n=s,a))}}function Ake(e,t){var r,n,o,i="style."+t,s="end."+i,a;return function(){var u=ms(this,e),h=u.on,p=u.value[i]==null?a||(a=bee(t)):void 0;(h!==r||o!==p)&&(n=(r=h).copy()).on(s,o=p),u.on=n}}function vee(e,t,r){var n=(e+="")=="transform"?J3:uE;return t==null?this.styleTween(e,bke(e,n)).on("end.style."+e,bee(e)):typeof t=="function"?this.styleTween(e,wke(e,n,hy(this,"style."+e,t))).each(Ake(this._id,e)):this.styleTween(e,vke(e,n,t),r).on("end.style."+e,null)}var wee=W(()=>{nl();Fs();ua();ew();oz()});function Mke(e,t,r){return function(n){this.style.setProperty(e,t.call(this,n),r)}}function Ske(e,t,r){var n,o;function i(){var s=t.apply(this,arguments);return s!==o&&(n=(o=s)&&Mke(e,s,r)),n}return i._value=t,i}function Aee(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,Ske(e,t,r??""))}var Mee=W(()=>{});function Tke(e){return function(){this.textContent=e}}function Eke(e){return function(){var t=e(this);this.textContent=t??""}}function See(e){return this.tween("text",typeof e=="function"?Eke(hy(this,"text",e)):Tke(e==null?"":e+""))}var Tee=W(()=>{ew()});function Ike(e){return function(t){this.textContent=e.call(this,t)}}function Cke(e){var t,r;function n(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&Ike(o)),t}return n._value=e,n}function Eee(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Cke(e))}var Iee=W(()=>{});function Cee(){for(var e=this._name,t=this._id,r=fE(),n=this._groups,o=n.length,i=0;i<o;++i)for(var s=n[i],a=s.length,u,h=0;h<a;++h)if(u=s[h]){var p=Wo(u,t);Gd(u,e,r,h,s,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new gs(n,this._parents,e,r)}var kee=W(()=>{Jf();ua()});function Pee(){var e,t,r=this,n=r._id,o=r.size();return new Promise(function(i,s){var a={value:s},u={value:function(){--o===0&&i()}};r.each(function(){var h=ms(this,n),p=h.on;p!==e&&(t=(e=p).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(u)),h.on=t}),o===0&&i()})}var Oee=W(()=>{ua()});function gs(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}function hE(e){return wc().transition(e)}function fE(){return++kke}var kke,eh,Jf=W(()=>{Fs();XJ();$J();JJ();tee();nee();oee();aee();cee();fee();dee();mee();_ee();xee();wee();Mee();Tee();Iee();kee();ew();Oee();kke=0;eh=wc.prototype;gs.prototype=hE.prototype={constructor:gs,select:pee,selectAll:gee,selectChild:eh.selectChild,selectChildren:eh.selectChildren,filter:see,merge:lee,selection:yee,transition:Cee,call:eh.call,nodes:eh.nodes,node:eh.node,size:eh.size,empty:eh.empty,each:eh.each,on:uee,attr:HJ,attrTween:KJ,style:vee,styleTween:Aee,text:See,textTween:Eee,remove:hee,tween:GJ,delay:QJ,duration:eee,ease:ree,easeVarying:iee,end:Pee,[Symbol.iterator]:eh[Symbol.iterator]}});var Ree,Nee=W(()=>{Ree=e=>+e});function zee(e){return e*e}function Dee(e){return e*(2-e)}function sz(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}var Lee=W(()=>{});function Fee(e){return e*e*e}function tw(e){return--e*e*e+1}function rw(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Bee=W(()=>{});var az,jee,Uee,lz,Vee=W(()=>{az=3,jee=function e(t){t=+t;function r(n){return Math.pow(n,t)}return r.exponent=e,r}(az),Uee=function e(t){t=+t;function r(n){return 1-Math.pow(1-n,t)}return r.exponent=e,r}(az),lz=function e(t){t=+t;function r(n){return((n*=2)<=1?Math.pow(n,t):2-Math.pow(2-n,t))/2}return r.exponent=e,r}(az)});function Yee(e){return+e==1?1:1-Math.cos(e*Zee)}function qee(e){return Math.sin(e*Zee)}function cz(e){return(1-Math.cos(Wee*e))/2}var Wee,Zee,Gee=W(()=>{Wee=Math.PI,Zee=Wee/2});function Iu(e){return(Math.pow(2,-10*e)-.0009765625)*1.0009775171065494}var uz=W(()=>{});function Hee(e){return Iu(1-+e)}function Xee(e){return 1-Iu(e)}function fz(e){return((e*=2)<=1?Iu(1-e):2-Iu(e-1))/2}var Kee=W(()=>{uz()});function $ee(e){return 1-Math.sqrt(1-e*e)}function Qee(e){return Math.sqrt(1- --e*e)}function hz(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}var Jee=W(()=>{});function ete(e){return 1-dy(1-e)}function dy(e){return(e=+e)<dz?dE*e*e:e<Oke?dE*(e-=Pke)*e+Rke:e<zke?dE*(e-=Nke)*e+Dke:dE*(e-=Lke)*e+Fke}function tte(e){return((e*=2)<=1?1-dy(1-e):dy(e-1)+1)/2}var dz,Pke,Oke,Rke,Nke,zke,Dke,Lke,Fke,dE,rte=W(()=>{dz=.36363636363636365,Pke=6/11,Oke=8/11,Rke=3/4,Nke=9/11,zke=10/11,Dke=15/16,Lke=21/22,Fke=63/64,dE=1/dz/dz});var pz,nte,ite,mz,ote=W(()=>{pz=1.70158,nte=function e(t){t=+t;function r(n){return(n=+n)*n*(t*(n-1)+n)}return r.overshoot=e,r}(pz),ite=function e(t){t=+t;function r(n){return--n*n*((n+1)*t+n)+1}return r.overshoot=e,r}(pz),mz=function e(t){t=+t;function r(n){return((n*=2)<1?n*n*((t+1)*n-t):(n-=2)*n*((t+1)*n+t)+2)/2}return r.overshoot=e,r}(pz)});var py,gz,_z,ste,yz,ate,lte=W(()=>{uz();py=2*Math.PI,gz=1,_z=.3,ste=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=py);function o(i){return t*Iu(- --i)*Math.sin((n-i)/r)}return o.amplitude=function(i){return e(i,r*py)},o.period=function(i){return e(t,i)},o}(gz,_z),yz=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=py);function o(i){return 1-t*Iu(i=+i)*Math.sin((i+n)/r)}return o.amplitude=function(i){return e(i,r*py)},o.period=function(i){return e(t,i)},o}(gz,_z),ate=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=py);function o(i){return((i=i*2-1)<0?t*Iu(-i)*Math.sin((n-i)/r):2-t*Iu(i)*Math.sin((n+i)/r))/2}return o.amplitude=function(i){return e(i,r*py)},o.period=function(i){return e(t,i)},o}(gz,_z)});var xz=W(()=>{Nee();Lee();Bee();Vee();Gee();Kee();Jee();rte();ote();lte()});function jke(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}function cte(e){var t,r;e instanceof gs?(t=e._id,e=e._name):(t=fE(),(r=Bke).time=qd(),e=e==null?null:e+"");for(var n=this._groups,o=n.length,i=0;i<o;++i)for(var s=n[i],a=s.length,u,h=0;h<a;++h)(u=s[h])&&Gd(u,e,t,h,s,r||jke(u,t));return new gs(n,this._parents,e,t)}var Bke,ute=W(()=>{Jf();ua();xz();$1();Bke={time:null,delay:0,duration:250,ease:rw}});var fte=W(()=>{Fs();qJ();ute();wc.prototype.interrupt=YJ;wc.prototype.transition=cte});function hte(e,t){var r=e.__transition,n,o;if(r){t=t==null?null:t+"";for(o in r)if((n=r[o]).state>aE&&n.name===t)return new gs([[e]],Uke,t,+o)}return null}var Uke,dte=W(()=>{Jf();ua();Uke=[null]});var pE=W(()=>{fte();Jf();dte();iz()});var mE,pte=W(()=>{mE=e=>()=>e});function bz(e,{sourceEvent:t,target:r,selection:n,mode:o,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},selection:{value:n,enumerable:!0,configurable:!0},mode:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}var mte=W(()=>{});function gte(e){e.stopImmediatePropagation()}function gE(e){e.preventDefault(),e.stopImmediatePropagation()}var _te=W(()=>{});function bte(e){return[+e[0],+e[1]]}function Az(e){return[bte(e[0]),bte(e[1])]}function nw(e){return{type:e}}function Yke(e){return!e.ctrlKey&&!e.button}function qke(){var e=this.ownerSVGElement||this;return e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]}function Gke(){return navigator.maxTouchPoints||"ontouchstart"in this}function wz(e){for(;!e.__brush;)if(!(e=e.parentNode))return;return e.__brush}function Hke(e){return e[0][0]===e[1][0]||e[0][1]===e[1][1]}function Mz(e){var t=e.__brush;return t?t.dim.output(t.selection):null}function Sz(){return Iz(_E)}function Tz(){return Iz(yE)}function Ez(){return Iz(Vke)}function Iz(e){var t=qke,r=Yke,n=Gke,o=!0,i=rl("start","brush","end"),s=6,a;function u(P){var R=P.property("__brush",k).selectAll(".overlay").data([nw("overlay")]);R.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",th.overlay).merge(R).each(function(){var N=wz(this).extent;$t(this).attr("x",N[0][0]).attr("y",N[0][1]).attr("width",N[1][0]-N[0][0]).attr("height",N[1][1]-N[0][1])}),P.selectAll(".selection").data([nw("selection")]).enter().append("rect").attr("class","selection").attr("cursor",th.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var V=P.selectAll(".handle").data(e.handles,function(N){return N.type});V.exit().remove(),V.enter().append("rect").attr("class",function(N){return"handle handle--"+N.type}).attr("cursor",function(N){return th[N.type]}),P.each(h).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",y).filter(n).on("touchstart.brush",y).on("touchmove.brush",A).on("touchend.brush touchcancel.brush",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(P,R,V){P.tween?P.on("start.brush",function(N){p(this,arguments).beforestart().start(N)}).on("interrupt.brush end.brush",function(N){p(this,arguments).end(N)}).tween("brush",function(){var N=this,j=N.__brush,J=p(N,arguments),ne=j.selection,de=e.input(typeof R=="function"?R.apply(this,arguments):R,j.extent),fe=$i(ne,de);function ye(ve){j.selection=ve===1&&de===null?null:fe(ve),h.call(N),J.brush()}return ne!==null&&de!==null?ye:ye(1)}):P.each(function(){var N=this,j=arguments,J=N.__brush,ne=e.input(typeof R=="function"?R.apply(N,j):R,J.extent),de=p(N,j).beforestart();Sc(N),J.selection=ne===null?null:ne,h.call(N),de.start(V).brush(V).end(V)})},u.clear=function(P,R){u.move(P,null,R)};function h(){var P=$t(this),R=wz(this).selection;R?(P.selectAll(".selection").style("display",null).attr("x",R[0][0]).attr("y",R[0][1]).attr("width",R[1][0]-R[0][0]).attr("height",R[1][1]-R[0][1]),P.selectAll(".handle").style("display",null).attr("x",function(V){return V.type[V.type.length-1]==="e"?R[1][0]-s/2:R[0][0]-s/2}).attr("y",function(V){return V.type[0]==="s"?R[1][1]-s/2:R[0][1]-s/2}).attr("width",function(V){return V.type==="n"||V.type==="s"?R[1][0]-R[0][0]+s:s}).attr("height",function(V){return V.type==="e"||V.type==="w"?R[1][1]-R[0][1]+s:s})):P.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function p(P,R,V){var N=P.__brush.emitter;return N&&(!V||!N.clean)?N:new _(P,R,V)}function _(P,R,V){this.that=P,this.args=R,this.state=P.__brush,this.active=0,this.clean=V}_.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(P,R){return this.starting?(this.starting=!1,this.emit("start",P,R)):this.emit("brush",P),this},brush:function(P,R){return this.emit("brush",P,R),this},end:function(P,R){return--this.active===0&&(delete this.state.emitter,this.emit("end",P,R)),this},emit:function(P,R,V){var N=$t(this.that).datum();i.call(P,this.that,new bz(P,{sourceEvent:R,target:u,selection:e.output(this.state.selection),mode:V,dispatch:i}),N)}};function y(P){if(a&&!P.touches||!r.apply(this,arguments))return;var R=this,V=P.target.__data__.type,N=(o&&P.metaKey?V="overlay":V)==="selection"?yte:o&&P.altKey?gy:my,j=e===yE?null:Wke[V],J=e===_E?null:Zke[V],ne=wz(R),de=ne.extent,fe=ne.selection,ye=de[0][0],ve,be,je=de[0][1],Re,Se,Ue=de[1][0],qe,Je,gt=de[1][1],rt,At,St=0,kt=0,yt,tr=j&&J&&o&&P.shiftKey,vr,wr,Ir=Array.from(P.touches||[P],dr=>{let xt=dr.identifier;return dr=Uo(dr,R),dr.point0=dr.slice(),dr.identifier=xt,dr});Sc(R);var Br=p(R,arguments,!0).beforestart();if(V==="overlay"){fe&&(yt=!0);let dr=[Ir[0],Ir[1]||Ir[0]];ne.selection=fe=[[ve=e===yE?ye:Us(dr[0][0],dr[1][0]),Re=e===_E?je:Us(dr[0][1],dr[1][1])],[qe=e===yE?Ue:js(dr[0][0],dr[1][0]),rt=e===_E?gt:js(dr[0][1],dr[1][1])]],Ir.length>1&&bn(P)}else ve=fe[0][0],Re=fe[0][1],qe=fe[1][0],rt=fe[1][1];be=ve,Se=Re,Je=qe,At=rt;var qt=$t(R).attr("pointer-events","none"),Lr=qt.selectAll(".overlay").attr("cursor",th[V]);if(P.touches)Br.moved=Rt,Br.ended=tn;else{var Yr=$t(P.view).on("mousemove.brush",Rt,!0).on("mouseup.brush",tn,!0);o&&Yr.on("keydown.brush",sr,!0).on("keyup.brush",Rn,!0),Bd(P.view)}h.call(R),Br.start(P,N.name);function Rt(dr){for(let xt of dr.changedTouches||[dr])for(let ei of Ir)ei.identifier===xt.identifier&&(ei.cur=Uo(xt,R));if(tr&&!vr&&!wr&&Ir.length===1){let xt=Ir[0];xte(xt.cur[0]-xt[0])>xte(xt.cur[1]-xt[1])?wr=!0:vr=!0}for(let xt of Ir)xt.cur&&(xt[0]=xt.cur[0],xt[1]=xt.cur[1]);yt=!0,gE(dr),bn(dr)}function bn(dr){let xt=Ir[0],ei=xt.point0;var Hr;switch(St=xt[0]-ei[0],kt=xt[1]-ei[1],N){case vz:case yte:{j&&(St=js(ye-ve,Us(Ue-qe,St)),be=ve+St,Je=qe+St),J&&(kt=js(je-Re,Us(gt-rt,kt)),Se=Re+kt,At=rt+kt);break}case my:{Ir[1]?(j&&(be=js(ye,Us(Ue,Ir[0][0])),Je=js(ye,Us(Ue,Ir[1][0])),j=1),J&&(Se=js(je,Us(gt,Ir[0][1])),At=js(je,Us(gt,Ir[1][1])),J=1)):(j<0?(St=js(ye-ve,Us(Ue-ve,St)),be=ve+St,Je=qe):j>0&&(St=js(ye-qe,Us(Ue-qe,St)),be=ve,Je=qe+St),J<0?(kt=js(je-Re,Us(gt-Re,kt)),Se=Re+kt,At=rt):J>0&&(kt=js(je-rt,Us(gt-rt,kt)),Se=Re,At=rt+kt));break}case gy:{j&&(be=js(ye,Us(Ue,ve-St*j)),Je=js(ye,Us(Ue,qe+St*j))),J&&(Se=js(je,Us(gt,Re-kt*J)),At=js(je,Us(gt,rt+kt*J)));break}}Je<be&&(j*=-1,Hr=ve,ve=qe,qe=Hr,Hr=be,be=Je,Je=Hr,V in vte&&Lr.attr("cursor",th[V=vte[V]])),At<Se&&(J*=-1,Hr=Re,Re=rt,rt=Hr,Hr=Se,Se=At,At=Hr,V in wte&&Lr.attr("cursor",th[V=wte[V]])),ne.selection&&(fe=ne.selection),vr&&(be=fe[0][0],Je=fe[1][0]),wr&&(Se=fe[0][1],At=fe[1][1]),(fe[0][0]!==be||fe[0][1]!==Se||fe[1][0]!==Je||fe[1][1]!==At)&&(ne.selection=[[be,Se],[Je,At]],h.call(R),Br.brush(dr,N.name))}function tn(dr){if(gte(dr),dr.touches){if(dr.touches.length)return;a&&clearTimeout(a),a=setTimeout(function(){a=null},500)}else jd(dr.view,yt),Yr.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);qt.attr("pointer-events","all"),Lr.attr("cursor",th.overlay),ne.selection&&(fe=ne.selection),Hke(fe)&&(ne.selection=null,h.call(R)),Br.end(dr,N.name)}function sr(dr){switch(dr.keyCode){case 16:{tr=j&&J;break}case 18:{N===my&&(j&&(qe=Je-St*j,ve=be+St*j),J&&(rt=At-kt*J,Re=Se+kt*J),N=gy,bn(dr));break}case 32:{(N===my||N===gy)&&(j<0?qe=Je-St:j>0&&(ve=be-St),J<0?rt=At-kt:J>0&&(Re=Se-kt),N=vz,Lr.attr("cursor",th.selection),bn(dr));break}default:return}gE(dr)}function Rn(dr){switch(dr.keyCode){case 16:{tr&&(vr=wr=tr=!1,bn(dr));break}case 18:{N===gy&&(j<0?qe=Je:j>0&&(ve=be),J<0?rt=At:J>0&&(Re=Se),N=my,bn(dr));break}case 32:{N===vz&&(dr.altKey?(j&&(qe=Je-St*j,ve=be+St*j),J&&(rt=At-kt*J,Re=Se+kt*J),N=gy):(j<0?qe=Je:j>0&&(ve=be),J<0?rt=At:J>0&&(Re=Se),N=my),Lr.attr("cursor",th[V]),bn(dr));break}default:return}gE(dr)}}function A(P){p(this,arguments).moved(P)}function E(P){p(this,arguments).ended(P)}function k(){var P=this.__brush||{selection:null};return P.extent=Az(t.apply(this,arguments)),P.dim=e,P}return u.extent=function(P){return arguments.length?(t=typeof P=="function"?P:mE(Az(P)),u):t},u.filter=function(P){return arguments.length?(r=typeof P=="function"?P:mE(!!P),u):r},u.touchable=function(P){return arguments.length?(n=typeof P=="function"?P:mE(!!P),u):n},u.handleSize=function(P){return arguments.length?(s=+P,u):s},u.keyModifiers=function(P){return arguments.length?(o=!!P,u):o},u.on=function(){var P=i.on.apply(i,arguments);return P===i?u:P},u}var yte,vz,my,gy,xte,js,Us,_E,yE,Vke,th,vte,wte,Wke,Zke,Ate=W(()=>{Ld();R3();nl();Fs();pE();pte();mte();_te();yte={name:"drag"},vz={name:"space"},my={name:"handle"},gy={name:"center"},{abs:xte,max:js,min:Us}=Math;_E={name:"x",handles:["w","e"].map(nw),input:function(e,t){return e==null?null:[[+e[0],t[0][1]],[+e[1],t[1][1]]]},output:function(e){return e&&[e[0][0],e[1][0]]}},yE={name:"y",handles:["n","s"].map(nw),input:function(e,t){return e==null?null:[[t[0][0],+e[0]],[t[1][0],+e[1]]]},output:function(e){return e&&[e[0][1],e[1][1]]}},Vke={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(nw),input:function(e){return e==null?null:Az(e)},output:function(e){return e}},th={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},vte={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},wte={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},Wke={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},Zke={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1}});var Mte={};io(Mte,{brush:()=>Ez,brushSelection:()=>Mz,brushX:()=>Sz,brushY:()=>Tz});var Cz=W(()=>{Ate()});var kz,Ag,Mg,Ste,iw,Pz,Oz,xE,Rz=W(()=>{kz=Math.abs,Ag=Math.cos,Mg=Math.sin,Ste=Math.PI,iw=Ste/2,Pz=Ste*2,Oz=Math.max,xE=1e-12});function Nz(e,t){return Array.from({length:t-e},(r,n)=>e+n)}function Xke(e){return function(t,r){return e(t.source.value+t.target.value,r.source.value+r.target.value)}}function Tte(){return zz(!1,!1)}function Ete(){return zz(!1,!0)}function Ite(){return zz(!0,!1)}function zz(e,t){var r=0,n=null,o=null,i=null;function s(a){var u=a.length,h=new Array(u),p=Nz(0,u),_=new Array(u*u),y=new Array(u),A=0,E;a=Float64Array.from({length:u*u},t?(k,P)=>a[P%u][P/u|0]:(k,P)=>a[P/u|0][P%u]);for(let k=0;k<u;++k){let P=0;for(let R=0;R<u;++R)P+=a[k*u+R]+e*a[R*u+k];A+=h[k]=P}A=Oz(0,Pz-r*u)/A,E=A?r:Pz/u;{let k=0;n&&p.sort((P,R)=>n(h[P],h[R]));for(let P of p){let R=k;if(e){let V=Nz(~u+1,u).filter(N=>N<0?a[~N*u+P]:a[P*u+N]);o&&V.sort((N,j)=>o(N<0?-a[~N*u+P]:a[P*u+N],j<0?-a[~j*u+P]:a[P*u+j]));for(let N of V)if(N<0){let j=_[~N*u+P]||(_[~N*u+P]={source:null,target:null});j.target={index:P,startAngle:k,endAngle:k+=a[~N*u+P]*A,value:a[~N*u+P]}}else{let j=_[P*u+N]||(_[P*u+N]={source:null,target:null});j.source={index:P,startAngle:k,endAngle:k+=a[P*u+N]*A,value:a[P*u+N]}}y[P]={index:P,startAngle:R,endAngle:k,value:h[P]}}else{let V=Nz(0,u).filter(N=>a[P*u+N]||a[N*u+P]);o&&V.sort((N,j)=>o(a[P*u+N],a[P*u+j]));for(let N of V){let j;if(P<N?(j=_[P*u+N]||(_[P*u+N]={source:null,target:null}),j.source={index:P,startAngle:k,endAngle:k+=a[P*u+N]*A,value:a[P*u+N]}):(j=_[N*u+P]||(_[N*u+P]={source:null,target:null}),j.target={index:P,startAngle:k,endAngle:k+=a[P*u+N]*A,value:a[P*u+N]},P===N&&(j.source=j.target)),j.source&&j.target&&j.source.value<j.target.value){let J=j.source;j.source=j.target,j.target=J}}y[P]={index:P,startAngle:R,endAngle:k,value:h[P]}}k+=E}}return _=Object.values(_),_.groups=y,i?_.sort(i):_}return s.padAngle=function(a){return arguments.length?(r=Oz(0,a),s):r},s.sortGroups=function(a){return arguments.length?(n=a,s):n},s.sortSubgroups=function(a){return arguments.length?(o=a,s):o},s.sortChords=function(a){return arguments.length?(a==null?i=null:(i=Xke(a))._=a,s):i&&i._},s}var Cte=W(()=>{Rz()});function kte(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function $ke(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return kte;let r=10**t;return function(n){this._+=n[0];for(let o=1,i=n.length;o<i;++o)this._+=Math.round(arguments[o]*r)/r+n[o]}}function _y(){return new Cu}function Fz(e=3){return new Cu(+e)}var Dz,Lz,Sg,Kke,Cu,Pte=W(()=>{Dz=Math.PI,Lz=2*Dz,Sg=1e-6,Kke=Lz-Sg;Cu=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?kte:$ke(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,o){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+o}`}bezierCurveTo(t,r,n,o,i,s){this._append`C${+t},${+r},${+n},${+o},${this._x1=+i},${this._y1=+s}`}arcTo(t,r,n,o,i){if(t=+t,r=+r,n=+n,o=+o,i=+i,i<0)throw new Error(`negative radius: ${i}`);let s=this._x1,a=this._y1,u=n-t,h=o-r,p=s-t,_=a-r,y=p*p+_*_;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(y>Sg)if(!(Math.abs(_*u-h*p)>Sg)||!i)this._append`L${this._x1=t},${this._y1=r}`;else{let A=n-s,E=o-a,k=u*u+h*h,P=A*A+E*E,R=Math.sqrt(k),V=Math.sqrt(y),N=i*Math.tan((Dz-Math.acos((k+y-P)/(2*R*V)))/2),j=N/V,J=N/R;Math.abs(j-1)>Sg&&this._append`L${t+j*p},${r+j*_}`,this._append`A${i},${i},0,0,${+(_*A>p*E)},${this._x1=t+J*u},${this._y1=r+J*h}`}}arc(t,r,n,o,i,s){if(t=+t,r=+r,n=+n,s=!!s,n<0)throw new Error(`negative radius: ${n}`);let a=n*Math.cos(o),u=n*Math.sin(o),h=t+a,p=r+u,_=1^s,y=s?o-i:i-o;this._x1===null?this._append`M${h},${p}`:(Math.abs(this._x1-h)>Sg||Math.abs(this._y1-p)>Sg)&&this._append`L${h},${p}`,n&&(y<0&&(y=y%Lz+Lz),y>Kke?this._append`A${n},${n},0,1,${_},${t-a},${r-u}A${n},${n},0,1,${_},${this._x1=h},${this._y1=p}`:y>Sg&&this._append`A${n},${n},0,${+(y>=Dz)},${_},${this._x1=t+n*Math.cos(i)},${this._y1=r+n*Math.sin(i)}`)}rect(t,r,n,o){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+o}h${-n}Z`}toString(){return this._}};_y.prototype=Cu.prototype});var Ote={};io(Ote,{Path:()=>Cu,path:()=>_y,pathRound:()=>Fz});var ow=W(()=>{Pte()});var Rte,Nte=W(()=>{Rte=Array.prototype.slice});function Hd(e){return function(){return e}}var zte=W(()=>{});function Qke(e){return e.source}function Jke(e){return e.target}function Dte(e){return e.radius}function e4e(e){return e.startAngle}function t4e(e){return e.endAngle}function r4e(){return 0}function n4e(){return 10}function Lte(e){var t=Qke,r=Jke,n=Dte,o=Dte,i=e4e,s=t4e,a=r4e,u=null;function h(){var p,_=t.apply(this,arguments),y=r.apply(this,arguments),A=a.apply(this,arguments)/2,E=Rte.call(arguments),k=+n.apply(this,(E[0]=_,E)),P=i.apply(this,E)-iw,R=s.apply(this,E)-iw,V=+o.apply(this,(E[0]=y,E)),N=i.apply(this,E)-iw,j=s.apply(this,E)-iw;if(u||(u=p=_y()),A>xE&&(kz(R-P)>A*2+xE?R>P?(P+=A,R-=A):(P-=A,R+=A):P=R=(P+R)/2,kz(j-N)>A*2+xE?j>N?(N+=A,j-=A):(N-=A,j+=A):N=j=(N+j)/2),u.moveTo(k*Ag(P),k*Mg(P)),u.arc(0,0,k,P,R),P!==N||R!==j)if(e){var J=+e.apply(this,arguments),ne=V-J,de=(N+j)/2;u.quadraticCurveTo(0,0,ne*Ag(N),ne*Mg(N)),u.lineTo(V*Ag(de),V*Mg(de)),u.lineTo(ne*Ag(j),ne*Mg(j))}else u.quadraticCurveTo(0,0,V*Ag(N),V*Mg(N)),u.arc(0,0,V,N,j);if(u.quadraticCurveTo(0,0,k*Ag(P),k*Mg(P)),u.closePath(),p)return u=null,p+""||null}return e&&(h.headRadius=function(p){return arguments.length?(e=typeof p=="function"?p:Hd(+p),h):e}),h.radius=function(p){return arguments.length?(n=o=typeof p=="function"?p:Hd(+p),h):n},h.sourceRadius=function(p){return arguments.length?(n=typeof p=="function"?p:Hd(+p),h):n},h.targetRadius=function(p){return arguments.length?(o=typeof p=="function"?p:Hd(+p),h):o},h.startAngle=function(p){return arguments.length?(i=typeof p=="function"?p:Hd(+p),h):i},h.endAngle=function(p){return arguments.length?(s=typeof p=="function"?p:Hd(+p),h):s},h.padAngle=function(p){return arguments.length?(a=typeof p=="function"?p:Hd(+p),h):a},h.source=function(p){return arguments.length?(t=p,h):t},h.target=function(p){return arguments.length?(r=p,h):r},h.context=function(p){return arguments.length?(u=p??null,h):u},h}function Fte(){return Lte()}function Bte(){return Lte(n4e)}var jte=W(()=>{ow();Nte();zte();Rz()});var Ute=W(()=>{Cte();jte()});var i4e,bE,Bz=W(()=>{i4e=Array.prototype,bE=i4e.slice});function Vte(e,t){return e-t}var Wte=W(()=>{});function Zte(e){for(var t=0,r=e.length,n=e[r-1][1]*e[0][0]-e[r-1][0]*e[0][1];++t<r;)n+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return n}var Yte=W(()=>{});var ku,jz=W(()=>{ku=e=>()=>e});function qte(e,t){for(var r=-1,n=t.length,o;++r<n;)if(o=o4e(e,t[r]))return o;return 0}function o4e(e,t){for(var r=t[0],n=t[1],o=-1,i=0,s=e.length,a=s-1;i<s;a=i++){var u=e[i],h=u[0],p=u[1],_=e[a],y=_[0],A=_[1];if(s4e(u,_,t))return 0;p>n!=A>n&&r<(y-h)*(n-p)/(A-p)+h&&(o=-o)}return o}function s4e(e,t,r){var n;return a4e(e,t,r)&&l4e(e[n=+(e[0]===t[0])],r[n],t[n])}function a4e(e,t,r){return(t[0]-e[0])*(r[1]-e[1])===(r[0]-e[0])*(t[1]-e[1])}function l4e(e,t,r){return e<=t&&t<=r||r<=t&&t<=e}var Gte=W(()=>{});function Hte(){}var Xte=W(()=>{});function sw(){var e=1,t=1,r=Od,n=u;function o(h){var p=r(h);if(Array.isArray(p))p=p.slice().sort(Vte);else{let _=Au(h,c4e);for(p=la(...Pd(_[0],_[1],p),p);p[p.length-1]>=_[1];)p.pop();for(;p[1]<_[0];)p.shift()}return p.map(_=>i(h,_))}function i(h,p){let _=p==null?NaN:+p;if(isNaN(_))throw new Error(`invalid value: ${p}`);var y=[],A=[];return s(h,_,function(E){n(E,h,_),Zte(E)>0?y.push([E]):A.push(E)}),A.forEach(function(E){for(var k=0,P=y.length,R;k<P;++k)if(qte((R=y[k])[0],E)!==-1){R.push(E);return}}),{type:"MultiPolygon",value:p,coordinates:y}}function s(h,p,_){var y=new Array,A=new Array,E,k,P,R,V,N;for(E=k=-1,R=Tg(h[0],p),rh[R<<1].forEach(j);++E<e-1;)P=R,R=Tg(h[E+1],p),rh[P|R<<1].forEach(j);for(rh[R<<0].forEach(j);++k<t-1;){for(E=-1,R=Tg(h[k*e+e],p),V=Tg(h[k*e],p),rh[R<<1|V<<2].forEach(j);++E<e-1;)P=R,R=Tg(h[k*e+e+E+1],p),N=V,V=Tg(h[k*e+E+1],p),rh[P|R<<1|V<<2|N<<3].forEach(j);rh[R|V<<3].forEach(j)}for(E=-1,V=h[k*e]>=p,rh[V<<2].forEach(j);++E<e-1;)N=V,V=Tg(h[k*e+E+1],p),rh[V<<2|N<<3].forEach(j);rh[V<<3].forEach(j);function j(J){var ne=[J[0][0]+E,J[0][1]+k],de=[J[1][0]+E,J[1][1]+k],fe=a(ne),ye=a(de),ve,be;(ve=A[fe])?(be=y[ye])?(delete A[ve.end],delete y[be.start],ve===be?(ve.ring.push(de),_(ve.ring)):y[ve.start]=A[be.end]={start:ve.start,end:be.end,ring:ve.ring.concat(be.ring)}):(delete A[ve.end],ve.ring.push(de),A[ve.end=ye]=ve):(ve=y[ye])?(be=A[fe])?(delete y[ve.start],delete A[be.end],ve===be?(ve.ring.push(de),_(ve.ring)):y[be.start]=A[ve.end]={start:be.start,end:ve.end,ring:be.ring.concat(ve.ring)}):(delete y[ve.start],ve.ring.unshift(ne),y[ve.start=fe]=ve):y[fe]=A[ye]={start:fe,end:ye,ring:[ne,de]}}}function a(h){return h[0]*2+h[1]*(e+1)*4}function u(h,p,_){h.forEach(function(y){var A=y[0],E=y[1],k=A|0,P=E|0,R=Uz(p[P*e+k]);A>0&&A<e&&k===A&&(y[0]=Kte(A,Uz(p[P*e+k-1]),R,_)),E>0&&E<t&&P===E&&(y[1]=Kte(E,Uz(p[(P-1)*e+k]),R,_))})}return o.contour=i,o.size=function(h){if(!arguments.length)return[e,t];var p=Math.floor(h[0]),_=Math.floor(h[1]);if(!(p>=0&&_>=0))throw new Error("invalid size");return e=p,t=_,o},o.thresholds=function(h){return arguments.length?(r=typeof h=="function"?h:Array.isArray(h)?ku(bE.call(h)):ku(h),o):r},o.smooth=function(h){return arguments.length?(n=h?u:Hte,o):n===u},o}function c4e(e){return isFinite(e)?e:NaN}function Tg(e,t){return e==null?!1:+e>=t}function Uz(e){return e==null||isNaN(e=+e)?-1/0:e}function Kte(e,t,r,n){let o=n-t,i=r-t,s=isFinite(o)||isFinite(i)?o/i:Math.sign(o)/Math.sign(i);return isNaN(s)?e:e+s-.5}var rh,Vz=W(()=>{ki();Bz();Wte();Yte();jz();Gte();Xte();rh=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]]});function u4e(e){return e[0]}function f4e(e){return e[1]}function h4e(){return 1}function $te(){var e=u4e,t=f4e,r=h4e,n=960,o=500,i=20,s=2,a=i*3,u=n+a*2>>s,h=o+a*2>>s,p=ku(20);function _(V){var N=new Float32Array(u*h),j=Math.pow(2,-s),J=-1;for(let Re of V){var ne=(e(Re,++J,V)+a)*j,de=(t(Re,J,V)+a)*j,fe=+r(Re,J,V);if(fe&&ne>=0&&ne<u&&de>=0&&de<h){var ye=Math.floor(ne),ve=Math.floor(de),be=ne-ye-.5,je=de-ve-.5;N[ye+ve*u]+=(1-be)*(1-je)*fe,N[ye+1+ve*u]+=be*(1-je)*fe,N[ye+1+(ve+1)*u]+=be*je*fe,N[ye+(ve+1)*u]+=(1-be)*je*fe}}return v1({data:N,width:u,height:h},i*j),N}function y(V){var N=_(V),j=p(N),J=Math.pow(2,2*s);return Array.isArray(j)||(j=la(Number.MIN_VALUE,za(N)/J,j)),sw().size([u,h]).thresholds(j.map(ne=>ne*J))(N).map((ne,de)=>(ne.value=+j[de],A(ne)))}y.contours=function(V){var N=_(V),j=sw().size([u,h]),J=Math.pow(2,2*s),ne=de=>{de=+de;var fe=A(j.contour(N,de*J));return fe.value=de,fe};return Object.defineProperty(ne,"max",{get:()=>za(N)/J}),ne};function A(V){return V.coordinates.forEach(E),V}function E(V){V.forEach(k)}function k(V){V.forEach(P)}function P(V){V[0]=V[0]*Math.pow(2,s)-a,V[1]=V[1]*Math.pow(2,s)-a}function R(){return a=i*3,u=n+a*2>>s,h=o+a*2>>s,y}return y.x=function(V){return arguments.length?(e=typeof V=="function"?V:ku(+V),y):e},y.y=function(V){return arguments.length?(t=typeof V=="function"?V:ku(+V),y):t},y.weight=function(V){return arguments.length?(r=typeof V=="function"?V:ku(+V),y):r},y.size=function(V){if(!arguments.length)return[n,o];var N=+V[0],j=+V[1];if(!(N>=0&&j>=0))throw new Error("invalid size");return n=N,o=j,R()},y.cellSize=function(V){if(!arguments.length)return 1<<s;if(!((V=+V)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(V)/Math.LN2),R()},y.thresholds=function(V){return arguments.length?(p=typeof V=="function"?V:Array.isArray(V)?ku(bE.call(V)):ku(V),y):p},y.bandwidth=function(V){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((V=+V)>=0))throw new Error("invalid bandwidth");return i=(Math.sqrt(4*V*V+1)-1)/2,R()},y}var Qte=W(()=>{ki();Bz();jz();Vz()});var Jte=W(()=>{Vz();Qte()});function Eg(e,t,r,n,o){let i,s,a,u,h=t[0],p=n[0],_=0,y=0;p>h==p>-h?(i=h,h=t[++_]):(i=p,p=n[++y]);let A=0;if(_<e&&y<r)for(p>h==p>-h?(s=h+i,a=i-(s-h),h=t[++_]):(s=p+i,a=i-(s-p),p=n[++y]),i=s,a!==0&&(o[A++]=a);_<e&&y<r;)p>h==p>-h?(s=i+h,u=s-i,a=i-(s-u)+(h-u),h=t[++_]):(s=i+p,u=s-i,a=i-(s-u)+(p-u),p=n[++y]),i=s,a!==0&&(o[A++]=a);for(;_<e;)s=i+h,u=s-i,a=i-(s-u)+(h-u),h=t[++_],i=s,a!==0&&(o[A++]=a);for(;y<r;)s=i+p,u=s-i,a=i-(s-u)+(p-u),p=n[++y],i=s,a!==0&&(o[A++]=a);return(i!==0||A===0)&&(o[A++]=i),A}function lw(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}function Yt(e){return new Float64Array(e)}var Gn,Oo,aw,cw=W(()=>{Gn=11102230246251565e-32,Oo=134217729,aw=(3+8*Gn)*Gn});function g4e(e,t,r,n,o,i,s){let a,u,h,p,_,y,A,E,k,P,R,V,N,j,J,ne,de,fe,ye=e-o,ve=r-o,be=t-i,je=n-i;j=ye*je,y=Oo*ye,A=y-(y-ye),E=ye-A,y=Oo*je,k=y-(y-je),P=je-k,J=E*P-(j-A*k-E*k-A*P),ne=be*ve,y=Oo*be,A=y-(y-be),E=be-A,y=Oo*ve,k=y-(y-ve),P=ve-k,de=E*P-(ne-A*k-E*k-A*P),R=J-de,_=J-R,yy[0]=J-(R+_)+(_-de),V=j+R,_=V-j,N=j-(V-_)+(R-_),R=N-ne,_=N-R,yy[1]=N-(R+_)+(_-ne),fe=V+R,_=fe-V,yy[2]=V-(fe-_)+(R-_),yy[3]=fe;let Re=lw(4,yy),Se=p4e*s;if(Re>=Se||-Re>=Se||(_=e-ye,a=e-(ye+_)+(_-o),_=r-ve,h=r-(ve+_)+(_-o),_=t-be,u=t-(be+_)+(_-i),_=n-je,p=n-(je+_)+(_-i),a===0&&u===0&&h===0&&p===0)||(Se=m4e*s+aw*Math.abs(Re),Re+=ye*p+je*a-(be*h+ve*u),Re>=Se||-Re>=Se))return Re;j=a*je,y=Oo*a,A=y-(y-a),E=a-A,y=Oo*je,k=y-(y-je),P=je-k,J=E*P-(j-A*k-E*k-A*P),ne=u*ve,y=Oo*u,A=y-(y-u),E=u-A,y=Oo*ve,k=y-(y-ve),P=ve-k,de=E*P-(ne-A*k-E*k-A*P),R=J-de,_=J-R,fa[0]=J-(R+_)+(_-de),V=j+R,_=V-j,N=j-(V-_)+(R-_),R=N-ne,_=N-R,fa[1]=N-(R+_)+(_-ne),fe=V+R,_=fe-V,fa[2]=V-(fe-_)+(R-_),fa[3]=fe;let Ue=Eg(4,yy,4,fa,ere);j=ye*p,y=Oo*ye,A=y-(y-ye),E=ye-A,y=Oo*p,k=y-(y-p),P=p-k,J=E*P-(j-A*k-E*k-A*P),ne=be*h,y=Oo*be,A=y-(y-be),E=be-A,y=Oo*h,k=y-(y-h),P=h-k,de=E*P-(ne-A*k-E*k-A*P),R=J-de,_=J-R,fa[0]=J-(R+_)+(_-de),V=j+R,_=V-j,N=j-(V-_)+(R-_),R=N-ne,_=N-R,fa[1]=N-(R+_)+(_-ne),fe=V+R,_=fe-V,fa[2]=V-(fe-_)+(R-_),fa[3]=fe;let qe=Eg(Ue,ere,4,fa,tre);j=a*p,y=Oo*a,A=y-(y-a),E=a-A,y=Oo*p,k=y-(y-p),P=p-k,J=E*P-(j-A*k-E*k-A*P),ne=u*h,y=Oo*u,A=y-(y-u),E=u-A,y=Oo*h,k=y-(y-h),P=h-k,de=E*P-(ne-A*k-E*k-A*P),R=J-de,_=J-R,fa[0]=J-(R+_)+(_-de),V=j+R,_=V-j,N=j-(V-_)+(R-_),R=N-ne,_=N-R,fa[1]=N-(R+_)+(_-ne),fe=V+R,_=fe-V,fa[2]=V-(fe-_)+(R-_),fa[3]=fe;let Je=Eg(qe,tre,4,fa,rre);return rre[Je-1]}function xy(e,t,r,n,o,i){let s=(t-i)*(r-o),a=(e-o)*(n-i),u=s-a,h=Math.abs(s+a);return Math.abs(u)>=d4e*h?u:-g4e(e,t,r,n,o,i,h)}var d4e,p4e,m4e,yy,ere,tre,rre,fa,nre=W(()=>{cw();d4e=(3+16*Gn)*Gn,p4e=(2+12*Gn)*Gn,m4e=(9+64*Gn)*Gn*Gn,yy=Yt(4),ere=Yt(8),tre=Yt(12),rre=Yt(16),fa=Yt(4)});var Ayt,Myt,Syt,Tyt,Eyt,Iyt,Cyt,kyt,Pyt,Oyt,Ryt,Nyt,zyt,Dyt,Lyt,Fyt,Byt,jyt,Uyt,Vyt,Wyt,Zyt,ore=W(()=>{cw();Ayt=(7+56*Gn)*Gn,Myt=(3+28*Gn)*Gn,Syt=(26+288*Gn)*Gn*Gn,Tyt=Yt(4),Eyt=Yt(4),Iyt=Yt(4),Cyt=Yt(4),kyt=Yt(4),Pyt=Yt(4),Oyt=Yt(4),Ryt=Yt(4),Nyt=Yt(4),zyt=Yt(8),Dyt=Yt(8),Lyt=Yt(8),Fyt=Yt(4),Byt=Yt(8),jyt=Yt(8),Uyt=Yt(8),Vyt=Yt(12),Wyt=Yt(192),Zyt=Yt(192)});var Gyt,Hyt,Xyt,Kyt,$yt,Qyt,Jyt,ext,txt,rxt,nxt,ixt,oxt,sxt,axt,lxt,cxt,uxt,fxt,hxt,dxt,pxt,mxt,gxt,_xt,yxt,xxt,bxt,vxt,wxt,Axt,Mxt,Sxt,sre=W(()=>{cw();Gyt=(10+96*Gn)*Gn,Hyt=(4+48*Gn)*Gn,Xyt=(44+576*Gn)*Gn*Gn,Kyt=Yt(4),$yt=Yt(4),Qyt=Yt(4),Jyt=Yt(4),ext=Yt(4),txt=Yt(4),rxt=Yt(4),nxt=Yt(4),ixt=Yt(8),oxt=Yt(8),sxt=Yt(8),axt=Yt(8),lxt=Yt(8),cxt=Yt(8),uxt=Yt(8),fxt=Yt(8),hxt=Yt(8),dxt=Yt(4),pxt=Yt(4),mxt=Yt(4),gxt=Yt(8),_xt=Yt(16),yxt=Yt(16),xxt=Yt(16),bxt=Yt(32),vxt=Yt(32),wxt=Yt(48),Axt=Yt(64),Mxt=Yt(1152),Sxt=Yt(1152)});var Cxt,kxt,Pxt,Oxt,Rxt,Nxt,zxt,Dxt,Lxt,Fxt,Bxt,jxt,Uxt,Vxt,Wxt,Zxt,Yxt,qxt,Gxt,Hxt,Xxt,Kxt,$xt,Qxt,Jxt,ebt,tbt,rbt,nbt,ibt,obt,sbt,abt,lbt,cbt,ubt,fbt,hbt,dbt,pbt,mbt,gbt,_bt,ybt,xbt,bbt,vbt,wbt,Abt,are=W(()=>{cw();Cxt=(16+224*Gn)*Gn,kxt=(5+72*Gn)*Gn,Pxt=(71+1408*Gn)*Gn*Gn,Oxt=Yt(4),Rxt=Yt(4),Nxt=Yt(4),zxt=Yt(4),Dxt=Yt(4),Lxt=Yt(4),Fxt=Yt(4),Bxt=Yt(4),jxt=Yt(4),Uxt=Yt(4),Vxt=Yt(24),Wxt=Yt(24),Zxt=Yt(24),Yxt=Yt(24),qxt=Yt(24),Gxt=Yt(24),Hxt=Yt(24),Xxt=Yt(24),Kxt=Yt(24),$xt=Yt(24),Qxt=Yt(1152),Jxt=Yt(1152),ebt=Yt(1152),tbt=Yt(1152),rbt=Yt(1152),nbt=Yt(2304),ibt=Yt(2304),obt=Yt(3456),sbt=Yt(5760),abt=Yt(8),lbt=Yt(8),cbt=Yt(8),ubt=Yt(16),fbt=Yt(24),hbt=Yt(48),dbt=Yt(48),pbt=Yt(96),mbt=Yt(192),gbt=Yt(384),_bt=Yt(384),ybt=Yt(384),xbt=Yt(768),bbt=Yt(96),vbt=Yt(96),wbt=Yt(96),Abt=Yt(1152)});var lre=W(()=>{nre();ore();sre();are()});function y4e(e,t){let r=e/(Math.abs(e)+Math.abs(t));return(t>0?3-r:1+r)/4}function Wz(e,t,r,n){let o=e-r,i=t-n;return o*o+i*i}function x4e(e,t,r,n,o,i,s,a){let u=e-s,h=t-a,p=r-s,_=n-a,y=o-s,A=i-a,E=u*u+h*h,k=p*p+_*_,P=y*y+A*A;return u*(_*P-k*A)-h*(p*P-k*y)+E*(p*A-_*y)<0}function b4e(e,t,r,n,o,i){let s=r-e,a=n-t,u=o-e,h=i-t,p=s*s+a*a,_=u*u+h*h,y=.5/(s*h-a*u),A=(h*p-a*_)*y,E=(s*_-u*p)*y;return A*A+E*E}function v4e(e,t,r,n,o,i){let s=r-e,a=n-t,u=o-e,h=i-t,p=s*s+a*a,_=u*u+h*h,y=.5/(s*h-a*u),A=e+(h*p-a*_)*y,E=t+(s*_-u*p)*y;return{x:A,y:E}}function by(e,t,r,n){if(n-r<=20)for(let o=r+1;o<=n;o++){let i=e[o],s=t[i],a=o-1;for(;a>=r&&t[e[a]]>s;)e[a+1]=e[a--];e[a+1]=i}else{let o=r+n>>1,i=r+1,s=n;uw(e,o,i),t[e[r]]>t[e[n]]&&uw(e,r,n),t[e[i]]>t[e[n]]&&uw(e,i,n),t[e[r]]>t[e[i]]&&uw(e,r,i);let a=e[i],u=t[a];for(;;){do i++;while(t[e[i]]<u);do s--;while(t[e[s]]>u);if(s<i)break;uw(e,i,s)}e[r+1]=e[s],e[s]=a,n-i+1>=s-r?(by(e,t,i,n),by(e,t,r,s-1)):(by(e,t,r,s-1),by(e,t,i,n))}}function uw(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function w4e(e){return e[0]}function A4e(e){return e[1]}var cre,vE,vy,ure=W(()=>{lre();cre=Math.pow(2,-52),vE=new Uint32Array(512),vy=class e{static from(t,r=w4e,n=A4e){let o=t.length,i=new Float64Array(o*2);for(let s=0;s<o;s++){let a=t[s];i[2*s]=r(a),i[2*s+1]=n(a)}return new e(i)}constructor(t){let r=t.length>>1;if(r>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;let n=Math.max(2*r-5,0);this._triangles=new Uint32Array(n*3),this._halfedges=new Int32Array(n*3),this._hashSize=Math.ceil(Math.sqrt(r)),this._hullPrev=new Uint32Array(r),this._hullNext=new Uint32Array(r),this._hullTri=new Uint32Array(r),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(r),this._dists=new Float64Array(r),this.update()}update(){let{coords:t,_hullPrev:r,_hullNext:n,_hullTri:o,_hullHash:i}=this,s=t.length>>1,a=1/0,u=1/0,h=-1/0,p=-1/0;for(let ye=0;ye<s;ye++){let ve=t[2*ye],be=t[2*ye+1];ve<a&&(a=ve),be<u&&(u=be),ve>h&&(h=ve),be>p&&(p=be),this._ids[ye]=ye}let _=(a+h)/2,y=(u+p)/2,A,E,k;for(let ye=0,ve=1/0;ye<s;ye++){let be=Wz(_,y,t[2*ye],t[2*ye+1]);be<ve&&(A=ye,ve=be)}let P=t[2*A],R=t[2*A+1];for(let ye=0,ve=1/0;ye<s;ye++){if(ye===A)continue;let be=Wz(P,R,t[2*ye],t[2*ye+1]);be<ve&&be>0&&(E=ye,ve=be)}let V=t[2*E],N=t[2*E+1],j=1/0;for(let ye=0;ye<s;ye++){if(ye===A||ye===E)continue;let ve=b4e(P,R,V,N,t[2*ye],t[2*ye+1]);ve<j&&(k=ye,j=ve)}let J=t[2*k],ne=t[2*k+1];if(j===1/0){for(let be=0;be<s;be++)this._dists[be]=t[2*be]-t[0]||t[2*be+1]-t[1];by(this._ids,this._dists,0,s-1);let ye=new Uint32Array(s),ve=0;for(let be=0,je=-1/0;be<s;be++){let Re=this._ids[be],Se=this._dists[Re];Se>je&&(ye[ve++]=Re,je=Se)}this.hull=ye.subarray(0,ve),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(xy(P,R,V,N,J,ne)<0){let ye=E,ve=V,be=N;E=k,V=J,N=ne,k=ye,J=ve,ne=be}let de=v4e(P,R,V,N,J,ne);this._cx=de.x,this._cy=de.y;for(let ye=0;ye<s;ye++)this._dists[ye]=Wz(t[2*ye],t[2*ye+1],de.x,de.y);by(this._ids,this._dists,0,s-1),this._hullStart=A;let fe=3;n[A]=r[k]=E,n[E]=r[A]=k,n[k]=r[E]=A,o[A]=0,o[E]=1,o[k]=2,i.fill(-1),i[this._hashKey(P,R)]=A,i[this._hashKey(V,N)]=E,i[this._hashKey(J,ne)]=k,this.trianglesLen=0,this._addTriangle(A,E,k,-1,-1,-1);for(let ye=0,ve,be;ye<this._ids.length;ye++){let je=this._ids[ye],Re=t[2*je],Se=t[2*je+1];if(ye>0&&Math.abs(Re-ve)<=cre&&Math.abs(Se-be)<=cre||(ve=Re,be=Se,je===A||je===E||je===k))continue;let Ue=0;for(let At=0,St=this._hashKey(Re,Se);At<this._hashSize&&(Ue=i[(St+At)%this._hashSize],!(Ue!==-1&&Ue!==n[Ue]));At++);Ue=r[Ue];let qe=Ue,Je;for(;Je=n[qe],xy(Re,Se,t[2*qe],t[2*qe+1],t[2*Je],t[2*Je+1])>=0;)if(qe=Je,qe===Ue){qe=-1;break}if(qe===-1)continue;let gt=this._addTriangle(qe,je,n[qe],-1,-1,o[qe]);o[je]=this._legalize(gt+2),o[qe]=gt,fe++;let rt=n[qe];for(;Je=n[rt],xy(Re,Se,t[2*rt],t[2*rt+1],t[2*Je],t[2*Je+1])<0;)gt=this._addTriangle(rt,je,Je,o[je],-1,o[rt]),o[je]=this._legalize(gt+2),n[rt]=rt,fe--,rt=Je;if(qe===Ue)for(;Je=r[qe],xy(Re,Se,t[2*Je],t[2*Je+1],t[2*qe],t[2*qe+1])<0;)gt=this._addTriangle(Je,je,qe,-1,o[qe],o[Je]),this._legalize(gt+2),o[Je]=gt,n[qe]=qe,fe--,qe=Je;this._hullStart=r[je]=qe,n[qe]=r[rt]=je,n[je]=rt,i[this._hashKey(Re,Se)]=je,i[this._hashKey(t[2*qe],t[2*qe+1])]=qe}this.hull=new Uint32Array(fe);for(let ye=0,ve=this._hullStart;ye<fe;ye++)this.hull[ye]=ve,ve=n[ve];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,r){return Math.floor(y4e(t-this._cx,r-this._cy)*this._hashSize)%this._hashSize}_legalize(t){let{_triangles:r,_halfedges:n,coords:o}=this,i=0,s=0;for(;;){let a=n[t],u=t-t%3;if(s=u+(t+2)%3,a===-1){if(i===0)break;t=vE[--i];continue}let h=a-a%3,p=u+(t+1)%3,_=h+(a+2)%3,y=r[s],A=r[t],E=r[p],k=r[_];if(x4e(o[2*y],o[2*y+1],o[2*A],o[2*A+1],o[2*E],o[2*E+1],o[2*k],o[2*k+1])){r[t]=k,r[a]=y;let R=n[_];if(R===-1){let N=this._hullStart;do{if(this._hullTri[N]===_){this._hullTri[N]=t;break}N=this._hullPrev[N]}while(N!==this._hullStart)}this._link(t,R),this._link(a,n[s]),this._link(s,_);let V=h+(a+1)%3;i<vE.length&&(vE[i++]=V)}else{if(i===0)break;t=vE[--i]}}return s}_link(t,r){this._halfedges[t]=r,r!==-1&&(this._halfedges[r]=t)}_addTriangle(t,r,n,o,i,s){let a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=r,this._triangles[a+2]=n,this._link(a,o),this._link(a+1,i),this._link(a+2,s),this.trianglesLen+=3,a}}});var Ll,Zz=W(()=>{Ll=class{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,r){this._+=`L${this._x1=+t},${this._y1=+r}`}arc(t,r,n){t=+t,r=+r,n=+n;let o=t+n,i=r;if(n<0)throw new Error("negative radius");this._x1===null?this._+=`M${o},${i}`:(Math.abs(this._x1-o)>1e-6||Math.abs(this._y1-i)>1e-6)&&(this._+="L"+o+","+i),n&&(this._+=`A${n},${n},0,1,1,${t-n},${r}A${n},${n},0,1,1,${this._x1=o},${this._y1=i}`)}rect(t,r,n,o){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${+n}v${+o}h${-n}Z`}value(){return this._||null}}});var Xd,Yz=W(()=>{Xd=class{constructor(){this._=[]}moveTo(t,r){this._.push([t,r])}closePath(){this._.push(this._[0].slice())}lineTo(t,r){this._.push([t,r])}value(){return this._.length?this._:null}}});var Ig,qz=W(()=>{Zz();Yz();Ig=class{constructor(t,[r,n,o,i]=[0,0,960,500]){if(!((o=+o)>=(r=+r))||!((i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=o,this.xmin=r,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){let{delaunay:{points:t,hull:r,triangles:n},vectors:o}=this,i,s,a=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let k=0,P=0,R=n.length,V,N;k<R;k+=3,P+=2){let j=n[k]*2,J=n[k+1]*2,ne=n[k+2]*2,de=t[j],fe=t[j+1],ye=t[J],ve=t[J+1],be=t[ne],je=t[ne+1],Re=ye-de,Se=ve-fe,Ue=be-de,qe=je-fe,Je=(Re*qe-Se*Ue)*2;if(Math.abs(Je)<1e-9){if(i===void 0){i=s=0;for(let rt of r)i+=t[rt*2],s+=t[rt*2+1];i/=r.length,s/=r.length}let gt=1e9*Math.sign((i-de)*qe-(s-fe)*Ue);V=(de+be)/2-gt*qe,N=(fe+je)/2+gt*Ue}else{let gt=1/Je,rt=Re*Re+Se*Se,At=Ue*Ue+qe*qe;V=de+(qe*rt-Se*At)*gt,N=fe+(Re*At-Ue*rt)*gt}a[P]=V,a[P+1]=N}let u=r[r.length-1],h,p=u*4,_,y=t[2*u],A,E=t[2*u+1];o.fill(0);for(let k=0;k<r.length;++k)u=r[k],h=p,_=y,A=E,p=u*4,y=t[2*u],E=t[2*u+1],o[h+2]=o[p]=A-E,o[h+3]=o[p+1]=y-_}render(t){let r=t==null?t=new Ll:void 0,{delaunay:{halfedges:n,inedges:o,hull:i},circumcenters:s,vectors:a}=this;if(i.length<=1)return null;for(let p=0,_=n.length;p<_;++p){let y=n[p];if(y<p)continue;let A=Math.floor(p/3)*2,E=Math.floor(y/3)*2,k=s[A],P=s[A+1],R=s[E],V=s[E+1];this._renderSegment(k,P,R,V,t)}let u,h=i[i.length-1];for(let p=0;p<i.length;++p){u=h,h=i[p];let _=Math.floor(o[h]/3)*2,y=s[_],A=s[_+1],E=u*4,k=this._project(y,A,a[E+2],a[E+3]);k&&this._renderSegment(y,A,k[0],k[1],t)}return r&&r.value()}renderBounds(t){let r=t==null?t=new Ll:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),r&&r.value()}renderCell(t,r){let n=r==null?r=new Ll:void 0,o=this._clip(t);if(o===null||!o.length)return;r.moveTo(o[0],o[1]);let i=o.length;for(;o[0]===o[i-2]&&o[1]===o[i-1]&&i>1;)i-=2;for(let s=2;s<i;s+=2)(o[s]!==o[s-2]||o[s+1]!==o[s-1])&&r.lineTo(o[s],o[s+1]);return r.closePath(),n&&n.value()}*cellPolygons(){let{delaunay:{points:t}}=this;for(let r=0,n=t.length/2;r<n;++r){let o=this.cellPolygon(r);o&&(o.index=r,yield o)}}cellPolygon(t){let r=new Xd;return this.renderCell(t,r),r.value()}_renderSegment(t,r,n,o,i){let s,a=this._regioncode(t,r),u=this._regioncode(n,o);a===0&&u===0?(i.moveTo(t,r),i.lineTo(n,o)):(s=this._clipSegment(t,r,n,o,a,u))&&(i.moveTo(s[0],s[1]),i.lineTo(s[2],s[3]))}contains(t,r,n){return r=+r,r!==r||(n=+n,n!==n)?!1:this.delaunay._step(t,r,n)===t}*neighbors(t){let r=this._clip(t);if(r)for(let n of this.delaunay.neighbors(t)){let o=this._clip(n);if(o){e:for(let i=0,s=r.length;i<s;i+=2)for(let a=0,u=o.length;a<u;a+=2)if(r[i]===o[a]&&r[i+1]===o[a+1]&&r[(i+2)%s]===o[(a+u-2)%u]&&r[(i+3)%s]===o[(a+u-1)%u]){yield n;break e}}}}_cell(t){let{circumcenters:r,delaunay:{inedges:n,halfedges:o,triangles:i}}=this,s=n[t];if(s===-1)return null;let a=[],u=s;do{let h=Math.floor(u/3);if(a.push(r[h*2],r[h*2+1]),u=u%3===2?u-2:u+1,i[u]!==t)break;u=o[u]}while(u!==s&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let r=this._cell(t);if(r===null)return null;let{vectors:n}=this,o=t*4;return this._simplify(n[o]||n[o+1]?this._clipInfinite(t,r,n[o],n[o+1],n[o+2],n[o+3]):this._clipFinite(t,r))}_clipFinite(t,r){let n=r.length,o=null,i,s,a=r[n-2],u=r[n-1],h,p=this._regioncode(a,u),_,y=0;for(let A=0;A<n;A+=2)if(i=a,s=u,a=r[A],u=r[A+1],h=p,p=this._regioncode(a,u),h===0&&p===0)_=y,y=0,o?o.push(a,u):o=[a,u];else{let E,k,P,R,V;if(h===0){if((E=this._clipSegment(i,s,a,u,h,p))===null)continue;[k,P,R,V]=E}else{if((E=this._clipSegment(a,u,i,s,p,h))===null)continue;[R,V,k,P]=E,_=y,y=this._edgecode(k,P),_&&y&&this._edge(t,_,y,o,o.length),o?o.push(k,P):o=[k,P]}_=y,y=this._edgecode(R,V),_&&y&&this._edge(t,_,y,o,o.length),o?o.push(R,V):o=[R,V]}if(o)_=y,y=this._edgecode(o[0],o[1]),_&&y&&this._edge(t,_,y,o,o.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return o}_clipSegment(t,r,n,o,i,s){let a=i<s;for(a&&([t,r,n,o,i,s]=[n,o,t,r,s,i]);;){if(i===0&&s===0)return a?[n,o,t,r]:[t,r,n,o];if(i&s)return null;let u,h,p=i||s;p&8?(u=t+(n-t)*(this.ymax-r)/(o-r),h=this.ymax):p&4?(u=t+(n-t)*(this.ymin-r)/(o-r),h=this.ymin):p&2?(h=r+(o-r)*(this.xmax-t)/(n-t),u=this.xmax):(h=r+(o-r)*(this.xmin-t)/(n-t),u=this.xmin),i?(t=u,r=h,i=this._regioncode(t,r)):(n=u,o=h,s=this._regioncode(n,o))}}_clipInfinite(t,r,n,o,i,s){let a=Array.from(r),u;if((u=this._project(a[0],a[1],n,o))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],i,s))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let h=0,p=a.length,_,y=this._edgecode(a[p-2],a[p-1]);h<p;h+=2)_=y,y=this._edgecode(a[h],a[h+1]),_&&y&&(h=this._edge(t,_,y,a,h),p=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,r,n,o,i){for(;r!==n;){let s,a;switch(r){case 5:r=4;continue;case 4:r=6,s=this.xmax,a=this.ymin;break;case 6:r=2;continue;case 2:r=10,s=this.xmax,a=this.ymax;break;case 10:r=8;continue;case 8:r=9,s=this.xmin,a=this.ymax;break;case 9:r=1;continue;case 1:r=5,s=this.xmin,a=this.ymin;break}(o[i]!==s||o[i+1]!==a)&&this.contains(t,s,a)&&(o.splice(i,0,s,a),i+=2)}return i}_project(t,r,n,o){let i=1/0,s,a,u;if(o<0){if(r<=this.ymin)return null;(s=(this.ymin-r)/o)<i&&(u=this.ymin,a=t+(i=s)*n)}else if(o>0){if(r>=this.ymax)return null;(s=(this.ymax-r)/o)<i&&(u=this.ymax,a=t+(i=s)*n)}if(n>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/n)<i&&(a=this.xmax,u=r+(i=s)*o)}else if(n<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/n)<i&&(a=this.xmin,u=r+(i=s)*o)}return[a,u]}_edgecode(t,r){return(t===this.xmin?1:t===this.xmax?2:0)|(r===this.ymin?4:r===this.ymax?8:0)}_regioncode(t,r){return(t<this.xmin?1:t>this.xmax?2:0)|(r<this.ymin?4:r>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let r=0;r<t.length;r+=2){let n=(r+2)%t.length,o=(r+4)%t.length;(t[r]===t[n]&&t[n]===t[o]||t[r+1]===t[n+1]&&t[n+1]===t[o+1])&&(t.splice(n,2),r-=2)}t.length||(t=null)}return t}}});function S4e(e){return e[0]}function T4e(e){return e[1]}function E4e(e){let{triangles:t,coords:r}=e;for(let n=0;n<t.length;n+=3){let o=2*t[n],i=2*t[n+1],s=2*t[n+2];if((r[s]-r[o])*(r[i+1]-r[o+1])-(r[i]-r[o])*(r[s+1]-r[o+1])>1e-10)return!1}return!0}function I4e(e,t,r){return[e+Math.sin(e+t)*r,t+Math.cos(e-t)*r]}function C4e(e,t,r,n){let o=e.length,i=new Float64Array(o*2);for(let s=0;s<o;++s){let a=e[s];i[s*2]=t.call(n,a,s,e),i[s*2+1]=r.call(n,a,s,e)}return i}function*k4e(e,t,r,n){let o=0;for(let i of e)yield t.call(n,i,o,e),yield r.call(n,i,o,e),++o}var M4e,wy,fw,fre=W(()=>{ure();Zz();Yz();qz();M4e=2*Math.PI,wy=Math.pow;fw=class e{static from(t,r=S4e,n=T4e,o){return new e("length"in t?C4e(t,r,n,o):Float64Array.from(k4e(t,r,n,o)))}constructor(t){this._delaunator=new vy(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){let t=this._delaunator,r=this.points;if(t.hull&&t.hull.length>2&&E4e(t)){this.collinear=Int32Array.from({length:r.length/2},(y,A)=>A).sort((y,A)=>r[2*y]-r[2*A]||r[2*y+1]-r[2*A+1]);let u=this.collinear[0],h=this.collinear[this.collinear.length-1],p=[r[2*u],r[2*u+1],r[2*h],r[2*h+1]],_=1e-8*Math.hypot(p[3]-p[1],p[2]-p[0]);for(let y=0,A=r.length/2;y<A;++y){let E=I4e(r[2*y],r[2*y+1],_);r[2*y]=E[0],r[2*y+1]=E[1]}this._delaunator=new vy(r)}else delete this.collinear;let n=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,h=n.length;u<h;++u){let p=i[u%3===2?u-2:u+1];(n[u]===-1||s[p]===-1)&&(s[p]=u)}for(let u=0,h=o.length;u<h;++u)a[o[u]]=u;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],s[o[0]]=1,o.length===2&&(s[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(t){return new Ig(this,t)}*neighbors(t){let{inedges:r,hull:n,_hullIndex:o,halfedges:i,triangles:s,collinear:a}=this;if(a){let _=a.indexOf(t);_>0&&(yield a[_-1]),_<a.length-1&&(yield a[_+1]);return}let u=r[t];if(u===-1)return;let h=u,p=-1;do{if(yield p=s[h],h=h%3===2?h-2:h+1,s[h]!==t)return;if(h=i[h],h===-1){let _=n[(o[t]+1)%n.length];_!==p&&(yield _);return}}while(h!==u)}find(t,r,n=0){if(t=+t,t!==t||(r=+r,r!==r))return-1;let o=n,i;for(;(i=this._step(n,t,r))>=0&&i!==n&&i!==o;)n=i;return i}_step(t,r,n){let{inedges:o,hull:i,_hullIndex:s,halfedges:a,triangles:u,points:h}=this;if(o[t]===-1||!h.length)return(t+1)%(h.length>>1);let p=t,_=wy(r-h[t*2],2)+wy(n-h[t*2+1],2),y=o[t],A=y;do{let E=u[A],k=wy(r-h[E*2],2)+wy(n-h[E*2+1],2);if(k<_&&(_=k,p=E),A=A%3===2?A-2:A+1,u[A]!==t)break;if(A=a[A],A===-1){if(A=i[(s[t]+1)%i.length],A!==E&&wy(r-h[A*2],2)+wy(n-h[A*2+1],2)<_)return A;break}}while(A!==y);return p}render(t){let r=t==null?t=new Ll:void 0,{points:n,halfedges:o,triangles:i}=this;for(let s=0,a=o.length;s<a;++s){let u=o[s];if(u<s)continue;let h=i[s]*2,p=i[u]*2;t.moveTo(n[h],n[h+1]),t.lineTo(n[p],n[p+1])}return this.renderHull(t),r&&r.value()}renderPoints(t,r){r===void 0&&(!t||typeof t.moveTo!="function")&&(r=t,t=null),r=r==null?2:+r;let n=t==null?t=new Ll:void 0,{points:o}=this;for(let i=0,s=o.length;i<s;i+=2){let a=o[i],u=o[i+1];t.moveTo(a+r,u),t.arc(a,u,r,0,M4e)}return n&&n.value()}renderHull(t){let r=t==null?t=new Ll:void 0,{hull:n,points:o}=this,i=n[0]*2,s=n.length;t.moveTo(o[i],o[i+1]);for(let a=1;a<s;++a){let u=2*n[a];t.lineTo(o[u],o[u+1])}return t.closePath(),r&&r.value()}hullPolygon(){let t=new Xd;return this.renderHull(t),t.value()}renderTriangle(t,r){let n=r==null?r=new Ll:void 0,{points:o,triangles:i}=this,s=i[t*=3]*2,a=i[t+1]*2,u=i[t+2]*2;return r.moveTo(o[s],o[s+1]),r.lineTo(o[a],o[a+1]),r.lineTo(o[u],o[u+1]),r.closePath(),n&&n.value()}*trianglePolygons(){let{triangles:t}=this;for(let r=0,n=t.length/3;r<n;++r)yield this.trianglePolygon(r)}trianglePolygon(t){let r=new Xd;return this.renderTriangle(t,r),r.value()}}});var hre=W(()=>{fre();qz()});function P4e(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.blob()}function Gz(e,t){return fetch(e,t).then(P4e)}var dre=W(()=>{});function O4e(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.arrayBuffer()}function Hz(e,t){return fetch(e,t).then(O4e)}var pre=W(()=>{});function R4e(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function Kd(e,t){return fetch(e,t).then(R4e)}var wE=W(()=>{});function mre(e){return function(t,r,n){return arguments.length===2&&typeof r=="function"&&(n=r,r=void 0),Kd(t,r).then(function(o){return e(o,n)})}}function AE(e,t,r,n){arguments.length===3&&typeof r=="function"&&(n=r,r=void 0);var o=Id(e);return Kd(t,r).then(function(i){return o.parse(i,n)})}var Xz,Kz,gre=W(()=>{FR();wE();Xz=mre(zT),Kz=mre(DT)});function $z(e,t){return new Promise(function(r,n){var o=new Image;for(var i in t)o[i]=t[i];o.onerror=n,o.onload=function(){r(o)},o.src=e})}var _re=W(()=>{});function N4e(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);if(!(e.status===204||e.status===205))return e.json()}function Qz(e,t){return fetch(e,t).then(N4e)}var yre=W(()=>{});function Jz(e){return(t,r)=>Kd(t,r).then(n=>new DOMParser().parseFromString(n,e))}var eD,tD,rD,xre=W(()=>{wE();eD=Jz("application/xml"),tD=Jz("text/html"),rD=Jz("image/svg+xml")});var bre={};io(bre,{blob:()=>Gz,buffer:()=>Hz,csv:()=>Xz,dsv:()=>AE,html:()=>tD,image:()=>$z,json:()=>Qz,svg:()=>rD,text:()=>Kd,tsv:()=>Kz,xml:()=>eD});var nD=W(()=>{dre();pre();gre();_re();yre();wE();xre()});function vre(e,t){var r,n=1;e==null&&(e=0),t==null&&(t=0);function o(){var i,s=r.length,a,u=0,h=0;for(i=0;i<s;++i)a=r[i],u+=a.x,h+=a.y;for(u=(u/s-e)*n,h=(h/s-t)*n,i=0;i<s;++i)a=r[i],a.x-=u,a.y-=h}return o.initialize=function(i){r=i},o.x=function(i){return arguments.length?(e=+i,o):e},o.y=function(i){return arguments.length?(t=+i,o):t},o.strength=function(i){return arguments.length?(n=+i,o):n},o}var wre=W(()=>{});function Are(e){let t=+this._x.call(null,e),r=+this._y.call(null,e);return Mre(this.cover(t,r),t,r,e)}function Mre(e,t,r,n){if(isNaN(t)||isNaN(r))return e;var o,i=e._root,s={data:n},a=e._x0,u=e._y0,h=e._x1,p=e._y1,_,y,A,E,k,P,R,V;if(!i)return e._root=s,e;for(;i.length;)if((k=t>=(_=(a+h)/2))?a=_:h=_,(P=r>=(y=(u+p)/2))?u=y:p=y,o=i,!(i=i[R=P<<1|k]))return o[R]=s,e;if(A=+e._x.call(null,i.data),E=+e._y.call(null,i.data),t===A&&r===E)return s.next=i,o?o[R]=s:e._root=s,e;do o=o?o[R]=new Array(4):e._root=new Array(4),(k=t>=(_=(a+h)/2))?a=_:h=_,(P=r>=(y=(u+p)/2))?u=y:p=y;while((R=P<<1|k)===(V=(E>=y)<<1|A>=_));return o[V]=i,o[R]=s,e}function Sre(e){var t,r,n=e.length,o,i,s=new Array(n),a=new Array(n),u=1/0,h=1/0,p=-1/0,_=-1/0;for(r=0;r<n;++r)isNaN(o=+this._x.call(null,t=e[r]))||isNaN(i=+this._y.call(null,t))||(s[r]=o,a[r]=i,o<u&&(u=o),o>p&&(p=o),i<h&&(h=i),i>_&&(_=i));if(u>p||h>_)return this;for(this.cover(u,h).cover(p,_),r=0;r<n;++r)Mre(this,s[r],a[r],e[r]);return this}var Tre=W(()=>{});function Ere(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,n=this._y0,o=this._x1,i=this._y1;if(isNaN(r))o=(r=Math.floor(e))+1,i=(n=Math.floor(t))+1;else{for(var s=o-r||1,a=this._root,u,h;r>e||e>=o||n>t||t>=i;)switch(h=(t<n)<<1|e<r,u=new Array(4),u[h]=a,a=u,s*=2,h){case 0:o=r+s,i=n+s;break;case 1:r=o-s,i=n+s;break;case 2:o=r+s,n=i-s;break;case 3:r=o-s,n=i-s;break}this._root&&this._root.length&&(this._root=a)}return this._x0=r,this._y0=n,this._x1=o,this._y1=i,this}var Ire=W(()=>{});function Cre(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}var kre=W(()=>{});function Pre(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}var Ore=W(()=>{});function is(e,t,r,n,o){this.node=e,this.x0=t,this.y0=r,this.x1=n,this.y1=o}var ME=W(()=>{});function Rre(e,t,r){var n,o=this._x0,i=this._y0,s,a,u,h,p=this._x1,_=this._y1,y=[],A=this._root,E,k;for(A&&y.push(new is(A,o,i,p,_)),r==null?r=1/0:(o=e-r,i=t-r,p=e+r,_=t+r,r*=r);E=y.pop();)if(!(!(A=E.node)||(s=E.x0)>p||(a=E.y0)>_||(u=E.x1)<o||(h=E.y1)<i))if(A.length){var P=(s+u)/2,R=(a+h)/2;y.push(new is(A[3],P,R,u,h),new is(A[2],s,R,P,h),new is(A[1],P,a,u,R),new is(A[0],s,a,P,R)),(k=(t>=R)<<1|e>=P)&&(E=y[y.length-1],y[y.length-1]=y[y.length-1-k],y[y.length-1-k]=E)}else{var V=e-+this._x.call(null,A.data),N=t-+this._y.call(null,A.data),j=V*V+N*N;if(j<r){var J=Math.sqrt(r=j);o=e-J,i=t-J,p=e+J,_=t+J,n=A.data}}return n}var Nre=W(()=>{ME()});function zre(e){if(isNaN(p=+this._x.call(null,e))||isNaN(_=+this._y.call(null,e)))return this;var t,r=this._root,n,o,i,s=this._x0,a=this._y0,u=this._x1,h=this._y1,p,_,y,A,E,k,P,R;if(!r)return this;if(r.length)for(;;){if((E=p>=(y=(s+u)/2))?s=y:u=y,(k=_>=(A=(a+h)/2))?a=A:h=A,t=r,!(r=r[P=k<<1|E]))return this;if(!r.length)break;(t[P+1&3]||t[P+2&3]||t[P+3&3])&&(n=t,R=P)}for(;r.data!==e;)if(o=r,!(r=r.next))return this;return(i=r.next)&&delete r.next,o?(i?o.next=i:delete o.next,this):t?(i?t[P]=i:delete t[P],(r=t[0]||t[1]||t[2]||t[3])&&r===(t[3]||t[2]||t[1]||t[0])&&!r.length&&(n?n[R]=r:this._root=r),this):(this._root=i,this)}function Dre(e){for(var t=0,r=e.length;t<r;++t)this.remove(e[t]);return this}var Lre=W(()=>{});function Fre(){return this._root}var Bre=W(()=>{});function jre(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}var Ure=W(()=>{});function Vre(e){var t=[],r,n=this._root,o,i,s,a,u;for(n&&t.push(new is(n,this._x0,this._y0,this._x1,this._y1));r=t.pop();)if(!e(n=r.node,i=r.x0,s=r.y0,a=r.x1,u=r.y1)&&n.length){var h=(i+a)/2,p=(s+u)/2;(o=n[3])&&t.push(new is(o,h,p,a,u)),(o=n[2])&&t.push(new is(o,i,p,h,u)),(o=n[1])&&t.push(new is(o,h,s,a,p)),(o=n[0])&&t.push(new is(o,i,s,h,p))}return this}var Wre=W(()=>{ME()});function Zre(e){var t=[],r=[],n;for(this._root&&t.push(new is(this._root,this._x0,this._y0,this._x1,this._y1));n=t.pop();){var o=n.node;if(o.length){var i,s=n.x0,a=n.y0,u=n.x1,h=n.y1,p=(s+u)/2,_=(a+h)/2;(i=o[0])&&t.push(new is(i,s,a,p,_)),(i=o[1])&&t.push(new is(i,p,a,u,_)),(i=o[2])&&t.push(new is(i,s,_,p,h)),(i=o[3])&&t.push(new is(i,p,_,u,h))}r.push(n)}for(;n=r.pop();)e(n.node,n.x0,n.y0,n.x1,n.y1);return this}var Yre=W(()=>{ME()});function qre(e){return e[0]}function Gre(e){return arguments.length?(this._x=e,this):this._x}var Hre=W(()=>{});function Xre(e){return e[1]}function Kre(e){return arguments.length?(this._y=e,this):this._y}var $re=W(()=>{});function $d(e,t,r){var n=new iD(t??qre,r??Xre,NaN,NaN,NaN,NaN);return e==null?n:n.addAll(e)}function iD(e,t,r,n,o,i){this._x=e,this._y=t,this._x0=r,this._y0=n,this._x1=o,this._y1=i,this._root=void 0}function Qre(e){for(var t={data:e.data},r=t;e=e.next;)r=r.next={data:e.data};return t}var ha,Jre=W(()=>{Tre();Ire();kre();Ore();Nre();Lre();Bre();Ure();Wre();Yre();Hre();$re();ha=$d.prototype=iD.prototype;ha.copy=function(){var e=new iD(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,r,n;if(!t)return e;if(!t.length)return e._root=Qre(t),e;for(r=[{source:t,target:e._root=new Array(4)}];t=r.pop();)for(var o=0;o<4;++o)(n=t.source[o])&&(n.length?r.push({source:n,target:t.target[o]=new Array(4)}):t.target[o]=Qre(n));return e};ha.add=Are;ha.addAll=Sre;ha.cover=Ere;ha.data=Cre;ha.extent=Pre;ha.find=Rre;ha.remove=zre;ha.removeAll=Dre;ha.root=Fre;ha.size=jre;ha.visit=Vre;ha.visitAfter=Zre;ha.x=Gre;ha.y=Kre});var SE=W(()=>{Jre()});function Bi(e){return function(){return e}}var Cg=W(()=>{});function Tc(e){return(e()-.5)*1e-6}var TE=W(()=>{});function z4e(e){return e.x+e.vx}function D4e(e){return e.y+e.vy}function ene(e){var t,r,n,o=1,i=1;typeof e!="function"&&(e=Bi(e==null?1:+e));function s(){for(var h,p=t.length,_,y,A,E,k,P,R=0;R<i;++R)for(_=$d(t,z4e,D4e).visitAfter(a),h=0;h<p;++h)y=t[h],k=r[y.index],P=k*k,A=y.x+y.vx,E=y.y+y.vy,_.visit(V);function V(N,j,J,ne,de){var fe=N.data,ye=N.r,ve=k+ye;if(fe){if(fe.index>y.index){var be=A-fe.x-fe.vx,je=E-fe.y-fe.vy,Re=be*be+je*je;Re<ve*ve&&(be===0&&(be=Tc(n),Re+=be*be),je===0&&(je=Tc(n),Re+=je*je),Re=(ve-(Re=Math.sqrt(Re)))/Re*o,y.vx+=(be*=Re)*(ve=(ye*=ye)/(P+ye)),y.vy+=(je*=Re)*ve,fe.vx-=be*(ve=1-ve),fe.vy-=je*ve)}return}return j>A+ve||ne<A-ve||J>E+ve||de<E-ve}}function a(h){if(h.data)return h.r=r[h.data.index];for(var p=h.r=0;p<4;++p)h[p]&&h[p].r>h.r&&(h.r=h[p].r)}function u(){if(t){var h,p=t.length,_;for(r=new Array(p),h=0;h<p;++h)_=t[h],r[_.index]=+e(_,h,t)}}return s.initialize=function(h,p){t=h,n=p,u()},s.iterations=function(h){return arguments.length?(i=+h,s):i},s.strength=function(h){return arguments.length?(o=+h,s):o},s.radius=function(h){return arguments.length?(e=typeof h=="function"?h:Bi(+h),u(),s):e},s}var tne=W(()=>{SE();Cg();TE()});function L4e(e){return e.index}function rne(e,t){var r=e.get(t);if(!r)throw new Error("node not found: "+t);return r}function nne(e){var t=L4e,r=_,n,o=Bi(30),i,s,a,u,h,p=1;e==null&&(e=[]);function _(P){return 1/Math.min(a[P.source.index],a[P.target.index])}function y(P){for(var R=0,V=e.length;R<p;++R)for(var N=0,j,J,ne,de,fe,ye,ve;N<V;++N)j=e[N],J=j.source,ne=j.target,de=ne.x+ne.vx-J.x-J.vx||Tc(h),fe=ne.y+ne.vy-J.y-J.vy||Tc(h),ye=Math.sqrt(de*de+fe*fe),ye=(ye-i[N])/ye*P*n[N],de*=ye,fe*=ye,ne.vx-=de*(ve=u[N]),ne.vy-=fe*ve,J.vx+=de*(ve=1-ve),J.vy+=fe*ve}function A(){if(s){var P,R=s.length,V=e.length,N=new Map(s.map((J,ne)=>[t(J,ne,s),J])),j;for(P=0,a=new Array(R);P<V;++P)j=e[P],j.index=P,typeof j.source!="object"&&(j.source=rne(N,j.source)),typeof j.target!="object"&&(j.target=rne(N,j.target)),a[j.source.index]=(a[j.source.index]||0)+1,a[j.target.index]=(a[j.target.index]||0)+1;for(P=0,u=new Array(V);P<V;++P)j=e[P],u[P]=a[j.source.index]/(a[j.source.index]+a[j.target.index]);n=new Array(V),E(),i=new Array(V),k()}}function E(){if(s)for(var P=0,R=e.length;P<R;++P)n[P]=+r(e[P],P,e)}function k(){if(s)for(var P=0,R=e.length;P<R;++P)i[P]=+o(e[P],P,e)}return y.initialize=function(P,R){s=P,h=R,A()},y.links=function(P){return arguments.length?(e=P,A(),y):e},y.id=function(P){return arguments.length?(t=P,y):t},y.iterations=function(P){return arguments.length?(p=+P,y):p},y.strength=function(P){return arguments.length?(r=typeof P=="function"?P:Bi(+P),E(),y):r},y.distance=function(P){return arguments.length?(o=typeof P=="function"?P:Bi(+P),k(),y):o},y}var ine=W(()=>{Cg();TE()});function one(){let e=1;return()=>(e=(1664525*e+1013904223)%4294967296)/4294967296}var sne=W(()=>{});function ane(e){return e.x}function lne(e){return e.y}function cne(e){var t,r=1,n=.001,o=1-Math.pow(n,1/300),i=0,s=.6,a=new Map,u=wg(_),h=rl("tick","end"),p=one();e==null&&(e=[]);function _(){y(),h.call("tick",t),r<n&&(u.stop(),h.call("end",t))}function y(k){var P,R=e.length,V;k===void 0&&(k=1);for(var N=0;N<k;++N)for(r+=(i-r)*o,a.forEach(function(j){j(r)}),P=0;P<R;++P)V=e[P],V.fx==null?V.x+=V.vx*=s:(V.x=V.fx,V.vx=0),V.fy==null?V.y+=V.vy*=s:(V.y=V.fy,V.vy=0);return t}function A(){for(var k=0,P=e.length,R;k<P;++k){if(R=e[k],R.index=k,R.fx!=null&&(R.x=R.fx),R.fy!=null&&(R.y=R.fy),isNaN(R.x)||isNaN(R.y)){var V=F4e*Math.sqrt(.5+k),N=k*B4e;R.x=V*Math.cos(N),R.y=V*Math.sin(N)}(isNaN(R.vx)||isNaN(R.vy))&&(R.vx=R.vy=0)}}function E(k){return k.initialize&&k.initialize(e,p),k}return A(),t={tick:y,restart:function(){return u.restart(_),t},stop:function(){return u.stop(),t},nodes:function(k){return arguments.length?(e=k,A(),a.forEach(E),t):e},alpha:function(k){return arguments.length?(r=+k,t):r},alphaMin:function(k){return arguments.length?(n=+k,t):n},alphaDecay:function(k){return arguments.length?(o=+k,t):+o},alphaTarget:function(k){return arguments.length?(i=+k,t):i},velocityDecay:function(k){return arguments.length?(s=1-k,t):1-s},randomSource:function(k){return arguments.length?(p=k,a.forEach(E),t):p},force:function(k,P){return arguments.length>1?(P==null?a.delete(k):a.set(k,E(P)),t):a.get(k)},find:function(k,P,R){var V=0,N=e.length,j,J,ne,de,fe;for(R==null?R=1/0:R*=R,V=0;V<N;++V)de=e[V],j=k-de.x,J=P-de.y,ne=j*j+J*J,ne<R&&(fe=de,R=ne);return fe},on:function(k,P){return arguments.length>1?(h.on(k,P),t):h.on(k)}}}var F4e,B4e,oD=W(()=>{Ld();$1();sne();F4e=10,B4e=Math.PI*(3-Math.sqrt(5))});function une(){var e,t,r,n,o=Bi(-30),i,s=1,a=1/0,u=.81;function h(A){var E,k=e.length,P=$d(e,ane,lne).visitAfter(_);for(n=A,E=0;E<k;++E)t=e[E],P.visit(y)}function p(){if(e){var A,E=e.length,k;for(i=new Array(E),A=0;A<E;++A)k=e[A],i[k.index]=+o(k,A,e)}}function _(A){var E=0,k,P,R=0,V,N,j;if(A.length){for(V=N=j=0;j<4;++j)(k=A[j])&&(P=Math.abs(k.value))&&(E+=k.value,R+=P,V+=P*k.x,N+=P*k.y);A.x=V/R,A.y=N/R}else{k=A,k.x=k.data.x,k.y=k.data.y;do E+=i[k.data.index];while(k=k.next)}A.value=E}function y(A,E,k,P){if(!A.value)return!0;var R=A.x-t.x,V=A.y-t.y,N=P-E,j=R*R+V*V;if(N*N/u<j)return j<a&&(R===0&&(R=Tc(r),j+=R*R),V===0&&(V=Tc(r),j+=V*V),j<s&&(j=Math.sqrt(s*j)),t.vx+=R*A.value*n/j,t.vy+=V*A.value*n/j),!0;if(A.length||j>=a)return;(A.data!==t||A.next)&&(R===0&&(R=Tc(r),j+=R*R),V===0&&(V=Tc(r),j+=V*V),j<s&&(j=Math.sqrt(s*j)));do A.data!==t&&(N=i[A.data.index]*n/j,t.vx+=R*N,t.vy+=V*N);while(A=A.next)}return h.initialize=function(A,E){e=A,r=E,p()},h.strength=function(A){return arguments.length?(o=typeof A=="function"?A:Bi(+A),p(),h):o},h.distanceMin=function(A){return arguments.length?(s=A*A,h):Math.sqrt(s)},h.distanceMax=function(A){return arguments.length?(a=A*A,h):Math.sqrt(a)},h.theta=function(A){return arguments.length?(u=A*A,h):Math.sqrt(u)},h}var fne=W(()=>{SE();Cg();TE();oD()});function hne(e,t,r){var n,o=Bi(.1),i,s;typeof e!="function"&&(e=Bi(+e)),t==null&&(t=0),r==null&&(r=0);function a(h){for(var p=0,_=n.length;p<_;++p){var y=n[p],A=y.x-t||1e-6,E=y.y-r||1e-6,k=Math.sqrt(A*A+E*E),P=(s[p]-k)*i[p]*h/k;y.vx+=A*P,y.vy+=E*P}}function u(){if(n){var h,p=n.length;for(i=new Array(p),s=new Array(p),h=0;h<p;++h)s[h]=+e(n[h],h,n),i[h]=isNaN(s[h])?0:+o(n[h],h,n)}}return a.initialize=function(h){n=h,u()},a.strength=function(h){return arguments.length?(o=typeof h=="function"?h:Bi(+h),u(),a):o},a.radius=function(h){return arguments.length?(e=typeof h=="function"?h:Bi(+h),u(),a):e},a.x=function(h){return arguments.length?(t=+h,a):t},a.y=function(h){return arguments.length?(r=+h,a):r},a}var dne=W(()=>{Cg()});function pne(e){var t=Bi(.1),r,n,o;typeof e!="function"&&(e=Bi(e==null?0:+e));function i(a){for(var u=0,h=r.length,p;u<h;++u)p=r[u],p.vx+=(o[u]-p.x)*n[u]*a}function s(){if(r){var a,u=r.length;for(n=new Array(u),o=new Array(u),a=0;a<u;++a)n[a]=isNaN(o[a]=+e(r[a],a,r))?0:+t(r[a],a,r)}}return i.initialize=function(a){r=a,s()},i.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Bi(+a),s(),i):t},i.x=function(a){return arguments.length?(e=typeof a=="function"?a:Bi(+a),s(),i):e},i}var mne=W(()=>{Cg()});function gne(e){var t=Bi(.1),r,n,o;typeof e!="function"&&(e=Bi(e==null?0:+e));function i(a){for(var u=0,h=r.length,p;u<h;++u)p=r[u],p.vy+=(o[u]-p.y)*n[u]*a}function s(){if(r){var a,u=r.length;for(n=new Array(u),o=new Array(u),a=0;a<u;++a)n[a]=isNaN(o[a]=+e(r[a],a,r))?0:+t(r[a],a,r)}}return i.initialize=function(a){r=a,s()},i.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Bi(+a),s(),i):t},i.y=function(a){return arguments.length?(e=typeof a=="function"?a:Bi(+a),s(),i):e},i}var _ne=W(()=>{Cg()});var yne=W(()=>{wre();tne();ine();fne();dne();oD();mne();_ne()});function xne(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function kg(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}var hw=W(()=>{});function Pu(e){return e=kg(Math.abs(e)),e?e[1]:NaN}var dw=W(()=>{hw()});function bne(e,t){return function(r,n){for(var o=r.length,i=[],s=0,a=e[0],u=0;o>0&&a>0&&(u+a+1>n&&(a=Math.max(1,n-u)),i.push(r.substring(o-=a,o+a)),!((u+=a+1)>n));)a=e[s=(s+1)%e.length];return i.reverse().join(t)}}var vne=W(()=>{});function wne(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Ane=W(()=>{});function Ec(e){if(!(t=j4e.exec(e)))throw new Error("invalid format: "+e);var t;return new pw({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function pw(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}var j4e,sD=W(()=>{j4e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;Ec.prototype=pw.prototype;pw.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function Mne(e){e:for(var t=e.length,r=1,n=-1,o;r<t;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var Sne=W(()=>{});function Tne(e,t){var r=kg(e,t);if(!r)return e+"";var n=r[0],o=r[1],i=o-(aD=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=n.length;return i===s?n:i>s?n+new Array(i-s+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+kg(e,Math.max(0,t+i-1))[0]}var aD,lD=W(()=>{hw()});function cD(e,t){var r=kg(e,t);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var Ene=W(()=>{hw()});var uD,Ine=W(()=>{hw();lD();Ene();uD={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:xne,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>cD(e*100,t),r:cD,s:Tne,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)}});function fD(e){return e}var Cne=W(()=>{});function EE(e){var t=e.grouping===void 0||e.thousands===void 0?fD:bne(kne.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?fD:wne(kne.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function h(_){_=Ec(_);var y=_.fill,A=_.align,E=_.sign,k=_.symbol,P=_.zero,R=_.width,V=_.comma,N=_.precision,j=_.trim,J=_.type;J==="n"?(V=!0,J="g"):uD[J]||(N===void 0&&(N=12),j=!0,J="g"),(P||y==="0"&&A==="=")&&(P=!0,y="0",A="=");var ne=k==="$"?r:k==="#"&&/[boxX]/.test(J)?"0"+J.toLowerCase():"",de=k==="$"?n:/[%p]/.test(J)?s:"",fe=uD[J],ye=/[defgprs%]/.test(J);N=N===void 0?6:/[gprs]/.test(J)?Math.max(1,Math.min(21,N)):Math.max(0,Math.min(20,N));function ve(be){var je=ne,Re=de,Se,Ue,qe;if(J==="c")Re=fe(be)+Re,be="";else{be=+be;var Je=be<0||1/be<0;if(be=isNaN(be)?u:fe(Math.abs(be),N),j&&(be=Mne(be)),Je&&+be==0&&E!=="+"&&(Je=!1),je=(Je?E==="("?E:a:E==="-"||E==="("?"":E)+je,Re=(J==="s"?Pne[8+aD/3]:"")+Re+(Je&&E==="("?")":""),ye){for(Se=-1,Ue=be.length;++Se<Ue;)if(qe=be.charCodeAt(Se),48>qe||qe>57){Re=(qe===46?o+be.slice(Se+1):be.slice(Se))+Re,be=be.slice(0,Se);break}}}V&&!P&&(be=t(be,1/0));var gt=je.length+be.length+Re.length,rt=gt<R?new Array(R-gt+1).join(y):"";switch(V&&P&&(be=t(rt+be,rt.length?R-Re.length:1/0),rt=""),A){case"<":be=je+be+Re+rt;break;case"=":be=je+rt+be+Re;break;case"^":be=rt.slice(0,gt=rt.length>>1)+je+be+Re+rt.slice(gt);break;default:be=rt+je+be+Re;break}return i(be)}return ve.toString=function(){return _+""},ve}function p(_,y){var A=h((_=Ec(_),_.type="f",_)),E=Math.max(-8,Math.min(8,Math.floor(Pu(y)/3)))*3,k=Math.pow(10,-E),P=Pne[8+E/3];return function(R){return A(k*R)+P}}return{format:h,formatPrefix:p}}var kne,Pne,hD=W(()=>{dw();vne();Ane();sD();Sne();Ine();lD();Cne();kne=Array.prototype.map,Pne=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function CE(e){return IE=EE(e),Ic=IE.format,mw=IE.formatPrefix,IE}var IE,Ic,mw,One=W(()=>{hD();CE({thousands:",",grouping:[3],currency:["$",""]})});function kE(e){return Math.max(0,-Pu(Math.abs(e)))}var Rne=W(()=>{dw()});function PE(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Pu(t)/3)))*3-Pu(Math.abs(e)))}var Nne=W(()=>{dw()});function OE(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Pu(t)-Pu(e))+1}var zne=W(()=>{dw()});var RE=W(()=>{One();hD();sD();Rne();Nne();zne()});function LE(e){return e>1?0:e<-1?mn:Math.acos(e)}function Oi(e){return e>1?vi:e<-1?-vi:Math.asin(e)}function dD(e){return(e=nr(e/2))*e}var Cr,nh,mn,vi,Ay,bo,Yn,Fr,an,Fl,Pi,hr,gw,NE,zE,Pg,DE,nr,Vs,$n,My,kn=W(()=>{Cr=1e-6,nh=1e-12,mn=Math.PI,vi=mn/2,Ay=mn/4,bo=mn*2,Yn=180/mn,Fr=mn/180,an=Math.abs,Fl=Math.atan,Pi=Math.atan2,hr=Math.cos,gw=Math.ceil,NE=Math.exp,zE=Math.hypot,Pg=Math.log,DE=Math.pow,nr=Math.sin,Vs=Math.sign||function(e){return e>0?1:e<0?-1:0},$n=Math.sqrt,My=Math.tan});function ri(){}var ih=W(()=>{});function FE(e,t){e&&Lne.hasOwnProperty(e.type)&&Lne[e.type](e,t)}function pD(e,t,r){var n=-1,o=e.length-r,i;for(t.lineStart();++n<o;)i=e[n],t.point(i[0],i[1],i[2]);t.lineEnd()}function Fne(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)pD(e[r],t,1);t.polygonEnd()}function os(e,t){e&&Dne.hasOwnProperty(e.type)?Dne[e.type](e,t):FE(e,t)}var Dne,Lne,Qd=W(()=>{Dne={Feature:function(e,t){FE(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,o=r.length;++n<o;)FE(r[n].geometry,t)}},Lne={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){pD(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)pD(r[n],t,0)},Polygon:function(e,t){Fne(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)Fne(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,o=r.length;++n<o;)FE(r[n],t)}}});function U4e(){Cc.point=W4e}function V4e(){Une(Bne,jne)}function W4e(e,t){Cc.point=Une,Bne=e,jne=t,e*=Fr,t*=Fr,mD=e,gD=hr(t=t/2+Ay),_D=nr(t)}function Une(e,t){e*=Fr,t*=Fr,t=t/2+Ay;var r=e-mD,n=r>=0?1:-1,o=n*r,i=hr(t),s=nr(t),a=_D*s,u=gD*i+a*hr(o),h=a*n*nr(o);_w.add(Pi(h,u)),mD=e,gD=i,_D=s}function Vne(e){return BE=new ci,os(e,Cc),BE*2}var _w,BE,Bne,jne,mD,gD,_D,Cc,yD=W(()=>{ki();kn();ih();Qd();_w=new ci,BE=new ci,Cc={point:ri,lineStart:ri,lineEnd:ri,polygonStart:function(){_w=new ci,Cc.lineStart=U4e,Cc.lineEnd=V4e},polygonEnd:function(){var e=+_w;BE.add(e<0?bo+e:e),this.lineStart=this.lineEnd=this.point=ri},sphere:function(){BE.add(bo)}}});function Og(e){return[Pi(e[1],e[0]),Oi(e[2])]}function Bl(e){var t=e[0],r=e[1],n=hr(r);return[n*hr(t),n*nr(t),nr(r)]}function yw(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function oh(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function jE(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function xw(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Rg(e){var t=$n(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Sy=W(()=>{kn()});function xD(e,t){Jd.push(ah=[Qi=e,ao=e]),t<Da&&(Da=t),t>ol&&(ol=t)}function Hne(e,t){var r=Bl([e*Fr,t*Fr]);if(Ty){var n=oh(Ty,r),o=[n[1],-n[0],0],i=oh(o,n);Rg(i),i=Og(i);var s=e-Ng,a=s>0?1:-1,u=i[0]*Yn*a,h,p=an(s)>180;p^(a*Ng<u&&u<a*e)?(h=i[1]*Yn,h>ol&&(ol=h)):(u=(u+360)%360-180,p^(a*Ng<u&&u<a*e)?(h=-i[1]*Yn,h<Da&&(Da=h)):(t<Da&&(Da=t),t>ol&&(ol=t))),p?e<Ng?il(Qi,e)>il(Qi,ao)&&(ao=e):il(e,ao)>il(Qi,ao)&&(Qi=e):ao>=Qi?(e<Qi&&(Qi=e),e>ao&&(ao=e)):e>Ng?il(Qi,e)>il(Qi,ao)&&(ao=e):il(e,ao)>il(Qi,ao)&&(Qi=e)}else Jd.push(ah=[Qi=e,ao=e]);t<Da&&(Da=t),t>ol&&(ol=t),Ty=r,Ng=e}function Wne(){sh.point=Hne}function Zne(){ah[0]=Qi,ah[1]=ao,sh.point=xD,Ty=null}function Xne(e,t){if(Ty){var r=e-Ng;bw.add(an(r)>180?r+(r>0?360:-360):r)}else qne=e,Gne=t;Cc.point(e,t),Hne(e,t)}function Z4e(){Cc.lineStart()}function Y4e(){Xne(qne,Gne),Cc.lineEnd(),an(bw)>Cr&&(Qi=-(ao=180)),ah[0]=Qi,ah[1]=ao,Ty=null}function il(e,t){return(t-=e)<0?t+360:t}function q4e(e,t){return e[0]-t[0]}function Yne(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function Kne(e){var t,r,n,o,i,s,a;if(ol=ao=-(Qi=Da=1/0),Jd=[],os(e,sh),r=Jd.length){for(Jd.sort(q4e),t=1,n=Jd[0],i=[n];t<r;++t)o=Jd[t],Yne(n,o[0])||Yne(n,o[1])?(il(n[0],o[1])>il(n[0],n[1])&&(n[1]=o[1]),il(o[0],n[1])>il(n[0],n[1])&&(n[0]=o[0])):i.push(n=o);for(s=-1/0,r=i.length-1,t=0,n=i[r];t<=r;n=o,++t)o=i[t],(a=il(n[1],o[0]))>s&&(s=a,Qi=o[0],ao=n[1])}return Jd=ah=null,Qi===1/0||Da===1/0?[[NaN,NaN],[NaN,NaN]]:[[Qi,Da],[ao,ol]]}var Qi,Da,ao,ol,Ng,qne,Gne,Ty,bw,Jd,ah,sh,$ne=W(()=>{ki();yD();Sy();kn();Qd();sh={point:xD,lineStart:Wne,lineEnd:Zne,polygonStart:function(){sh.point=Xne,sh.lineStart=Z4e,sh.lineEnd=Y4e,bw=new ci,Cc.polygonStart()},polygonEnd:function(){Cc.polygonEnd(),sh.point=xD,sh.lineStart=Wne,sh.lineEnd=Zne,_w<0?(Qi=-(ao=180),Da=-(ol=90)):bw>Cr?ol=90:bw<-Cr&&(Da=-90),ah[0]=Qi,ah[1]=ao},sphere:function(){Qi=-(ao=180),Da=-(ol=90)}}});function AD(e,t){e*=Fr,t*=Fr;var r=hr(t);ww(r*hr(e),r*nr(e),nr(t))}function ww(e,t,r){++vw,VE+=(e-VE)/vw,WE+=(t-WE)/vw,ZE+=(r-ZE)/vw}function Qne(){kc.point=G4e}function G4e(e,t){e*=Fr,t*=Fr;var r=hr(t);da=r*hr(e),pa=r*nr(e),ma=nr(t),kc.point=H4e,ww(da,pa,ma)}function H4e(e,t){e*=Fr,t*=Fr;var r=hr(t),n=r*hr(e),o=r*nr(e),i=nr(t),s=Pi($n((s=pa*i-ma*o)*s+(s=ma*n-da*i)*s+(s=da*o-pa*n)*s),da*n+pa*o+ma*i);UE+=s,YE+=s*(da+(da=n)),qE+=s*(pa+(pa=o)),GE+=s*(ma+(ma=i)),ww(da,pa,ma)}function Jne(){kc.point=AD}function X4e(){kc.point=$4e}function K4e(){rie(eie,tie),kc.point=AD}function $4e(e,t){eie=e,tie=t,e*=Fr,t*=Fr,kc.point=rie;var r=hr(t);da=r*hr(e),pa=r*nr(e),ma=nr(t),ww(da,pa,ma)}function rie(e,t){e*=Fr,t*=Fr;var r=hr(t),n=r*hr(e),o=r*nr(e),i=nr(t),s=pa*i-ma*o,a=ma*n-da*i,u=da*o-pa*n,h=zE(s,a,u),p=Oi(h),_=h&&-p/h;bD.add(_*s),vD.add(_*a),wD.add(_*u),UE+=p,YE+=p*(da+(da=n)),qE+=p*(pa+(pa=o)),GE+=p*(ma+(ma=i)),ww(da,pa,ma)}function nie(e){vw=UE=VE=WE=ZE=YE=qE=GE=0,bD=new ci,vD=new ci,wD=new ci,os(e,kc);var t=+bD,r=+vD,n=+wD,o=zE(t,r,n);return o<nh&&(t=YE,r=qE,n=GE,UE<Cr&&(t=VE,r=WE,n=ZE),o=zE(t,r,n),o<nh)?[NaN,NaN]:[Pi(r,t)*Yn,Oi(n/o)*Yn]}var vw,UE,VE,WE,ZE,YE,qE,GE,bD,vD,wD,eie,tie,da,pa,ma,kc,iie=W(()=>{ki();kn();ih();Qd();kc={sphere:ri,point:AD,lineStart:Qne,lineEnd:Jne,polygonStart:function(){kc.lineStart=X4e,kc.lineEnd=K4e},polygonEnd:function(){kc.lineStart=Qne,kc.lineEnd=Jne}}});function zg(e){return function(){return e}}var oie=W(()=>{});function Aw(e,t){function r(n,o){return n=e(n,o),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,o){return n=t.invert(n,o),n&&e.invert(n[0],n[1])}),r}var MD=W(()=>{});function SD(e,t){return an(e)>mn&&(e-=Math.round(e/bo)*bo),[e,t]}function Mw(e,t,r){return(e%=bo)?t||r?Aw(aie(e),lie(t,r)):aie(e):t||r?lie(t,r):SD}function sie(e){return function(t,r){return t+=e,an(t)>mn&&(t-=Math.round(t/bo)*bo),[t,r]}}function aie(e){var t=sie(e);return t.invert=sie(-e),t}function lie(e,t){var r=hr(e),n=nr(e),o=hr(t),i=nr(t);function s(a,u){var h=hr(u),p=hr(a)*h,_=nr(a)*h,y=nr(u),A=y*r+p*n;return[Pi(_*o-A*i,p*r-y*n),Oi(A*o+_*i)]}return s.invert=function(a,u){var h=hr(u),p=hr(a)*h,_=nr(a)*h,y=nr(u),A=y*o-_*i;return[Pi(_*o+y*i,p*r+A*n),Oi(A*r-p*n)]},s}function HE(e){e=Mw(e[0]*Fr,e[1]*Fr,e.length>2?e[2]*Fr:0);function t(r){return r=e(r[0]*Fr,r[1]*Fr),r[0]*=Yn,r[1]*=Yn,r}return t.invert=function(r){return r=e.invert(r[0]*Fr,r[1]*Fr),r[0]*=Yn,r[1]*=Yn,r},t}var Sw=W(()=>{MD();kn();SD.invert=SD});function TD(e,t,r,n,o,i){if(r){var s=hr(t),a=nr(t),u=n*r;o==null?(o=t+n*bo,i=t-u/2):(o=cie(s,o),i=cie(s,i),(n>0?o<i:o>i)&&(o+=n*bo));for(var h,p=o;n>0?p>i:p<i;p-=u)h=Og([s,-a*hr(p),-a*nr(p)]),e.point(h[0],h[1])}}function cie(e,t){t=Bl(t),t[0]-=e,Rg(t);var r=LE(-t[1]);return((-t[2]<0?-r:r)+bo-Cr)%bo}function uie(){var e=zg([0,0]),t=zg(90),r=zg(2),n,o,i={point:s};function s(u,h){n.push(u=o(u,h)),u[0]*=Yn,u[1]*=Yn}function a(){var u=e.apply(this,arguments),h=t.apply(this,arguments)*Fr,p=r.apply(this,arguments)*Fr;return n=[],o=Mw(-u[0]*Fr,-u[1]*Fr,0).invert,TD(i,h,p,1),u={type:"Polygon",coordinates:[n]},n=o=null,u}return a.center=function(u){return arguments.length?(e=typeof u=="function"?u:zg([+u[0],+u[1]]),a):e},a.radius=function(u){return arguments.length?(t=typeof u=="function"?u:zg(+u),a):t},a.precision=function(u){return arguments.length?(r=typeof u=="function"?u:zg(+u),a):r},a}var ED=W(()=>{Sy();oie();kn();Sw()});function XE(){var e=[],t;return{point:function(r,n,o){t.push([r,n,o])},lineStart:function(){e.push(t=[])},lineEnd:ri,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}var ID=W(()=>{ih()});function Ey(e,t){return an(e[0]-t[0])<Cr&&an(e[1]-t[1])<Cr}var CD=W(()=>{kn()});function KE(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function $E(e,t,r,n,o){var i=[],s=[],a,u;if(e.forEach(function(E){if(!((k=E.length-1)<=0)){var k,P=E[0],R=E[k],V;if(Ey(P,R)){if(!P[2]&&!R[2]){for(o.lineStart(),a=0;a<k;++a)o.point((P=E[a])[0],P[1]);o.lineEnd();return}R[0]+=2*Cr}i.push(V=new KE(P,E,null,!0)),s.push(V.o=new KE(P,null,V,!1)),i.push(V=new KE(R,E,null,!1)),s.push(V.o=new KE(R,null,V,!0))}}),!!i.length){for(s.sort(t),fie(i),fie(s),a=0,u=s.length;a<u;++a)s[a].e=r=!r;for(var h=i[0],p,_;;){for(var y=h,A=!0;y.v;)if((y=y.n)===h)return;p=y.z,o.lineStart();do{if(y.v=y.o.v=!0,y.e){if(A)for(a=0,u=p.length;a<u;++a)o.point((_=p[a])[0],_[1]);else n(y.x,y.n.x,1,o);y=y.n}else{if(A)for(p=y.p.z,a=p.length-1;a>=0;--a)o.point((_=p[a])[0],_[1]);else n(y.x,y.p.x,-1,o);y=y.p}y=y.o,p=y.z,A=!A}while(!y.v);o.lineEnd()}}}function fie(e){if(t=e.length){for(var t,r=0,n=e[0],o;++r<t;)n.n=o=e[r],o.p=n,n=o;n.n=o=e[0],o.p=n}}var kD=W(()=>{CD();kn()});function PD(e){return an(e[0])<=mn?e[0]:Vs(e[0])*((an(e[0])+mn)%bo-mn)}function QE(e,t){var r=PD(t),n=t[1],o=nr(n),i=[nr(r),-hr(r),0],s=0,a=0,u=new ci;o===1?n=vi+Cr:o===-1&&(n=-vi-Cr);for(var h=0,p=e.length;h<p;++h)if(y=(_=e[h]).length)for(var _,y,A=_[y-1],E=PD(A),k=A[1]/2+Ay,P=nr(k),R=hr(k),V=0;V<y;++V,E=j,P=ne,R=de,A=N){var N=_[V],j=PD(N),J=N[1]/2+Ay,ne=nr(J),de=hr(J),fe=j-E,ye=fe>=0?1:-1,ve=ye*fe,be=ve>mn,je=P*ne;if(u.add(Pi(je*ye*nr(ve),R*de+je*hr(ve))),s+=be?fe+ye*bo:fe,be^E>=r^j>=r){var Re=oh(Bl(A),Bl(N));Rg(Re);var Se=oh(i,Re);Rg(Se);var Ue=(be^fe>=0?-1:1)*Oi(Se[2]);(n>Ue||n===Ue&&(Re[0]||Re[1]))&&(a+=be^fe>=0?1:-1)}}return(s<-Cr||s<Cr&&u<-nh)^a&1}var OD=W(()=>{ki();Sy();kn()});function JE(e,t,r,n){return function(o){var i=t(o),s=XE(),a=t(s),u=!1,h,p,_,y={point:A,lineStart:k,lineEnd:P,polygonStart:function(){y.point=R,y.lineStart=V,y.lineEnd=N,p=[],h=[]},polygonEnd:function(){y.point=A,y.lineStart=k,y.lineEnd=P,p=Dd(p);var j=QE(h,n);p.length?(u||(o.polygonStart(),u=!0),$E(p,J4e,j,r,o)):j&&(u||(o.polygonStart(),u=!0),o.lineStart(),r(null,null,1,o),o.lineEnd()),u&&(o.polygonEnd(),u=!1),p=h=null},sphere:function(){o.polygonStart(),o.lineStart(),r(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function A(j,J){e(j,J)&&o.point(j,J)}function E(j,J){i.point(j,J)}function k(){y.point=E,i.lineStart()}function P(){y.point=A,i.lineEnd()}function R(j,J){_.push([j,J]),a.point(j,J)}function V(){a.lineStart(),_=[]}function N(){R(_[0][0],_[0][1]),a.lineEnd();var j=a.clean(),J=s.result(),ne,de=J.length,fe,ye,ve;if(_.pop(),h.push(_),_=null,!!de){if(j&1){if(ye=J[0],(fe=ye.length-1)>0){for(u||(o.polygonStart(),u=!0),o.lineStart(),ne=0;ne<fe;++ne)o.point((ve=ye[ne])[0],ve[1]);o.lineEnd()}return}de>1&&j&2&&J.push(J.pop().concat(J.shift())),p.push(J.filter(Q4e))}}return y}}function Q4e(e){return e.length>1}function J4e(e,t){return((e=e.x)[0]<0?e[1]-vi-Cr:vi-e[1])-((t=t.x)[0]<0?t[1]-vi-Cr:vi-t[1])}var RD=W(()=>{ID();kD();kn();OD();ki()});function e5e(e){var t=NaN,r=NaN,n=NaN,o;return{lineStart:function(){e.lineStart(),o=1},point:function(i,s){var a=i>0?mn:-mn,u=an(i-t);an(u-mn)<Cr?(e.point(t,r=(r+s)/2>0?vi:-vi),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(i,r),o=0):n!==a&&u>=mn&&(an(t-n)<Cr&&(t-=n*Cr),an(i-a)<Cr&&(i-=a*Cr),r=t5e(t,r,i,s),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),o=0),e.point(t=i,r=s),n=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-o}}}function t5e(e,t,r,n){var o,i,s=nr(e-r);return an(s)>Cr?Fl((nr(t)*(i=hr(n))*nr(r)-nr(n)*(o=hr(t))*nr(e))/(o*i*s)):(t+n)/2}function r5e(e,t,r,n){var o;if(e==null)o=r*vi,n.point(-mn,o),n.point(0,o),n.point(mn,o),n.point(mn,0),n.point(mn,-o),n.point(0,-o),n.point(-mn,-o),n.point(-mn,0),n.point(-mn,o);else if(an(e[0]-t[0])>Cr){var i=e[0]<t[0]?mn:-mn;o=r*i/2,n.point(-i,o),n.point(0,o),n.point(i,o)}else n.point(t[0],t[1])}var Tw,ND=W(()=>{RD();kn();Tw=JE(function(){return!0},e5e,r5e,[-mn,-vi])});function eI(e){var t=hr(e),r=2*Fr,n=t>0,o=an(t)>Cr;function i(p,_,y,A){TD(A,e,r,y,p,_)}function s(p,_){return hr(p)*hr(_)>t}function a(p){var _,y,A,E,k;return{lineStart:function(){E=A=!1,k=1},point:function(P,R){var V=[P,R],N,j=s(P,R),J=n?j?0:h(P,R):j?h(P+(P<0?mn:-mn),R):0;if(!_&&(E=A=j)&&p.lineStart(),j!==A&&(N=u(_,V),(!N||Ey(_,N)||Ey(V,N))&&(V[2]=1)),j!==A)k=0,j?(p.lineStart(),N=u(V,_),p.point(N[0],N[1])):(N=u(_,V),p.point(N[0],N[1],2),p.lineEnd()),_=N;else if(o&&_&&n^j){var ne;!(J&y)&&(ne=u(V,_,!0))&&(k=0,n?(p.lineStart(),p.point(ne[0][0],ne[0][1]),p.point(ne[1][0],ne[1][1]),p.lineEnd()):(p.point(ne[1][0],ne[1][1]),p.lineEnd(),p.lineStart(),p.point(ne[0][0],ne[0][1],3)))}j&&(!_||!Ey(_,V))&&p.point(V[0],V[1]),_=V,A=j,y=J},lineEnd:function(){A&&p.lineEnd(),_=null},clean:function(){return k|(E&&A)<<1}}}function u(p,_,y){var A=Bl(p),E=Bl(_),k=[1,0,0],P=oh(A,E),R=yw(P,P),V=P[0],N=R-V*V;if(!N)return!y&&p;var j=t*R/N,J=-t*V/N,ne=oh(k,P),de=xw(k,j),fe=xw(P,J);jE(de,fe);var ye=ne,ve=yw(de,ye),be=yw(ye,ye),je=ve*ve-be*(yw(de,de)-1);if(!(je<0)){var Re=$n(je),Se=xw(ye,(-ve-Re)/be);if(jE(Se,de),Se=Og(Se),!y)return Se;var Ue=p[0],qe=_[0],Je=p[1],gt=_[1],rt;qe<Ue&&(rt=Ue,Ue=qe,qe=rt);var At=qe-Ue,St=an(At-mn)<Cr,kt=St||At<Cr;if(!St&&gt<Je&&(rt=Je,Je=gt,gt=rt),kt?St?Je+gt>0^Se[1]<(an(Se[0]-Ue)<Cr?Je:gt):Je<=Se[1]&&Se[1]<=gt:At>mn^(Ue<=Se[0]&&Se[0]<=qe)){var yt=xw(ye,(-ve+Re)/be);return jE(yt,de),[Se,Og(yt)]}}}function h(p,_){var y=n?e:mn-e,A=0;return p<-y?A|=1:p>y&&(A|=2),_<-y?A|=4:_>y&&(A|=8),A}return JE(s,a,i,n?[0,-e]:[-mn,e-mn])}var zD=W(()=>{Sy();ED();kn();CD();RD()});function hie(e,t,r,n,o,i){var s=e[0],a=e[1],u=t[0],h=t[1],p=0,_=1,y=u-s,A=h-a,E;if(E=r-s,!(!y&&E>0)){if(E/=y,y<0){if(E<p)return;E<_&&(_=E)}else if(y>0){if(E>_)return;E>p&&(p=E)}if(E=o-s,!(!y&&E<0)){if(E/=y,y<0){if(E>_)return;E>p&&(p=E)}else if(y>0){if(E<p)return;E<_&&(_=E)}if(E=n-a,!(!A&&E>0)){if(E/=A,A<0){if(E<p)return;E<_&&(_=E)}else if(A>0){if(E>_)return;E>p&&(p=E)}if(E=i-a,!(!A&&E<0)){if(E/=A,A<0){if(E>_)return;E>p&&(p=E)}else if(A>0){if(E<p)return;E<_&&(_=E)}return p>0&&(e[0]=s+p*y,e[1]=a+p*A),_<1&&(t[0]=s+_*y,t[1]=a+_*A),!0}}}}}var die=W(()=>{});function lh(e,t,r,n){function o(h,p){return e<=h&&h<=r&&t<=p&&p<=n}function i(h,p,_,y){var A=0,E=0;if(h==null||(A=s(h,_))!==(E=s(p,_))||u(h,p)<0^_>0)do y.point(A===0||A===3?e:r,A>1?n:t);while((A=(A+_+4)%4)!==E);else y.point(p[0],p[1])}function s(h,p){return an(h[0]-e)<Cr?p>0?0:3:an(h[0]-r)<Cr?p>0?2:1:an(h[1]-t)<Cr?p>0?1:0:p>0?3:2}function a(h,p){return u(h.x,p.x)}function u(h,p){var _=s(h,1),y=s(p,1);return _!==y?_-y:_===0?p[1]-h[1]:_===1?h[0]-p[0]:_===2?h[1]-p[1]:p[0]-h[0]}return function(h){var p=h,_=XE(),y,A,E,k,P,R,V,N,j,J,ne,de={point:fe,lineStart:je,lineEnd:Re,polygonStart:ve,polygonEnd:be};function fe(Ue,qe){o(Ue,qe)&&p.point(Ue,qe)}function ye(){for(var Ue=0,qe=0,Je=A.length;qe<Je;++qe)for(var gt=A[qe],rt=1,At=gt.length,St=gt[0],kt,yt,tr=St[0],vr=St[1];rt<At;++rt)kt=tr,yt=vr,St=gt[rt],tr=St[0],vr=St[1],yt<=n?vr>n&&(tr-kt)*(n-yt)>(vr-yt)*(e-kt)&&++Ue:vr<=n&&(tr-kt)*(n-yt)<(vr-yt)*(e-kt)&&--Ue;return Ue}function ve(){p=_,y=[],A=[],ne=!0}function be(){var Ue=ye(),qe=ne&&Ue,Je=(y=Dd(y)).length;(qe||Je)&&(h.polygonStart(),qe&&(h.lineStart(),i(null,null,1,h),h.lineEnd()),Je&&$E(y,a,Ue,i,h),h.polygonEnd()),p=h,y=A=E=null}function je(){de.point=Se,A&&A.push(E=[]),J=!0,j=!1,V=N=NaN}function Re(){y&&(Se(k,P),R&&j&&_.rejoin(),y.push(_.result())),de.point=fe,j&&p.lineEnd()}function Se(Ue,qe){var Je=o(Ue,qe);if(A&&E.push([Ue,qe]),J)k=Ue,P=qe,R=Je,J=!1,Je&&(p.lineStart(),p.point(Ue,qe));else if(Je&&j)p.point(Ue,qe);else{var gt=[V=Math.max(tI,Math.min(Ew,V)),N=Math.max(tI,Math.min(Ew,N))],rt=[Ue=Math.max(tI,Math.min(Ew,Ue)),qe=Math.max(tI,Math.min(Ew,qe))];hie(gt,rt,e,t,r,n)?(j||(p.lineStart(),p.point(gt[0],gt[1])),p.point(rt[0],rt[1]),Je||p.lineEnd(),ne=!1):Je&&(p.lineStart(),p.point(Ue,qe),ne=!1)}V=Ue,N=qe,j=Je}return de}}var Ew,tI,Iw=W(()=>{kn();ID();die();kD();ki();Ew=1e9,tI=-Ew});function pie(){var e=0,t=0,r=960,n=500,o,i,s;return s={stream:function(a){return o&&i===a?o:o=lh(e,t,r,n)(i=a)},extent:function(a){return arguments.length?(e=+a[0][0],t=+a[0][1],r=+a[1][0],n=+a[1][1],o=i=null,s):[[e,t],[r,n]]}}}var mie=W(()=>{Iw()});function n5e(){Iy.point=o5e,Iy.lineEnd=i5e}function i5e(){Iy.point=Iy.lineEnd=ri}function o5e(e,t){e*=Fr,t*=Fr,LD=e,rI=nr(t),nI=hr(t),Iy.point=s5e}function s5e(e,t){e*=Fr,t*=Fr;var r=nr(t),n=hr(t),o=an(e-LD),i=hr(o),s=nr(o),a=n*s,u=nI*r-rI*n*i,h=rI*r+nI*n*i;DD.add(Pi($n(a*a+u*u),h)),LD=e,rI=r,nI=n}function iI(e){return DD=new ci,os(e,Iy),+DD}var DD,LD,rI,nI,Iy,FD=W(()=>{ki();kn();ih();Qd();Iy={sphere:ri,point:ri,lineStart:n5e,lineEnd:ri,polygonStart:ri,polygonEnd:ri}});function Cy(e,t){return BD[0]=e,BD[1]=t,iI(a5e)}var BD,a5e,jD=W(()=>{FD();BD=[null,null],a5e={type:"LineString",coordinates:BD}});function oI(e,t){return e&&_ie.hasOwnProperty(e.type)?_ie[e.type](e,t):!1}function yie(e,t){return Cy(e,t)===0}function xie(e,t){for(var r,n,o,i=0,s=e.length;i<s;i++){if(n=Cy(e[i],t),n===0||i>0&&(o=Cy(e[i],e[i-1]),o>0&&r<=o&&n<=o&&(r+n-o)*(1-Math.pow((r-n)/o,2))<nh*o))return!0;r=n}return!1}function bie(e,t){return!!QE(e.map(l5e),vie(t))}function l5e(e){return e=e.map(vie),e.pop(),e}function vie(e){return[e[0]*Fr,e[1]*Fr]}function wie(e,t){return(e&&gie.hasOwnProperty(e.type)?gie[e.type]:oI)(e,t)}var gie,_ie,Aie=W(()=>{OD();jD();kn();gie={Feature:function(e,t){return oI(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,o=r.length;++n<o;)if(oI(r[n].geometry,t))return!0;return!1}},_ie={Sphere:function(){return!0},Point:function(e,t){return yie(e.coordinates,t)},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)if(yie(r[n],t))return!0;return!1},LineString:function(e,t){return xie(e.coordinates,t)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)if(xie(r[n],t))return!0;return!1},Polygon:function(e,t){return bie(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,o=r.length;++n<o;)if(bie(r[n],t))return!0;return!1},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,o=r.length;++n<o;)if(oI(r[n],t))return!0;return!1}}});function Mie(e,t,r){var n=ca(e,t-Cr,r).concat(t);return function(o){return n.map(function(i){return[o,i]})}}function Sie(e,t,r){var n=ca(e,t-Cr,r).concat(t);return function(o){return n.map(function(i){return[i,o]})}}function sI(){var e,t,r,n,o,i,s,a,u=10,h=u,p=90,_=360,y,A,E,k,P=2.5;function R(){return{type:"MultiLineString",coordinates:V()}}function V(){return ca(gw(n/p)*p,r,p).map(E).concat(ca(gw(a/_)*_,s,_).map(k)).concat(ca(gw(t/u)*u,e,u).filter(function(N){return an(N%p)>Cr}).map(y)).concat(ca(gw(i/h)*h,o,h).filter(function(N){return an(N%_)>Cr}).map(A))}return R.lines=function(){return V().map(function(N){return{type:"LineString",coordinates:N}})},R.outline=function(){return{type:"Polygon",coordinates:[E(n).concat(k(s).slice(1),E(r).reverse().slice(1),k(a).reverse().slice(1))]}},R.extent=function(N){return arguments.length?R.extentMajor(N).extentMinor(N):R.extentMinor()},R.extentMajor=function(N){return arguments.length?(n=+N[0][0],r=+N[1][0],a=+N[0][1],s=+N[1][1],n>r&&(N=n,n=r,r=N),a>s&&(N=a,a=s,s=N),R.precision(P)):[[n,a],[r,s]]},R.extentMinor=function(N){return arguments.length?(t=+N[0][0],e=+N[1][0],i=+N[0][1],o=+N[1][1],t>e&&(N=t,t=e,e=N),i>o&&(N=i,i=o,o=N),R.precision(P)):[[t,i],[e,o]]},R.step=function(N){return arguments.length?R.stepMajor(N).stepMinor(N):R.stepMinor()},R.stepMajor=function(N){return arguments.length?(p=+N[0],_=+N[1],R):[p,_]},R.stepMinor=function(N){return arguments.length?(u=+N[0],h=+N[1],R):[u,h]},R.precision=function(N){return arguments.length?(P=+N,y=Mie(i,o,90),A=Sie(t,e,P),E=Mie(a,s,90),k=Sie(n,r,P),R):P},R.extentMajor([[-180,-90+Cr],[180,90-Cr]]).extentMinor([[-180,-80-Cr],[180,80+Cr]])}function Tie(){return sI()()}var Eie=W(()=>{ki();kn()});function Iie(e,t){var r=e[0]*Fr,n=e[1]*Fr,o=t[0]*Fr,i=t[1]*Fr,s=hr(n),a=nr(n),u=hr(i),h=nr(i),p=s*hr(r),_=s*nr(r),y=u*hr(o),A=u*nr(o),E=2*Oi($n(dD(i-n)+s*u*dD(o-r))),k=nr(E),P=E?function(R){var V=nr(R*=E)/k,N=nr(E-R)/k,j=N*p+V*y,J=N*_+V*A,ne=N*a+V*h;return[Pi(J,j)*Yn,Pi(ne,$n(j*j+J*J))*Yn]}:function(){return[r*Yn,n*Yn]};return P.distance=E,P}var Cie=W(()=>{kn()});var ep,aI=W(()=>{ep=e=>e});function c5e(){tp.point=u5e}function u5e(e,t){tp.point=Oie,kie=WD=e,Pie=ZD=t}function Oie(e,t){VD.add(ZD*e-WD*t),WD=e,ZD=t}function f5e(){Oie(kie,Pie)}var UD,VD,kie,Pie,WD,ZD,tp,YD,Rie=W(()=>{ki();kn();ih();UD=new ci,VD=new ci,tp={point:ri,lineStart:ri,lineEnd:ri,polygonStart:function(){tp.lineStart=c5e,tp.lineEnd=f5e},polygonEnd:function(){tp.lineStart=tp.lineEnd=tp.point=ri,UD.add(an(VD)),VD=new ci},result:function(){var e=UD/2;return UD=new ci,e}};YD=tp});function d5e(e,t){e<ky&&(ky=e),e>Cw&&(Cw=e),t<lI&&(lI=t),t>cI&&(cI=t)}var ky,lI,Cw,cI,h5e,Py,qD=W(()=>{ih();ky=1/0,lI=ky,Cw=-ky,cI=Cw,h5e={point:d5e,lineStart:ri,lineEnd:ri,polygonStart:ri,polygonEnd:ri,result:function(){var e=[[ky,lI],[Cw,cI]];return Cw=cI=-(lI=ky=1/0),e}};Py=h5e});function Dg(e,t){GD+=e,HD+=t,++kw}function Nie(){Pc.point=p5e}function p5e(e,t){Pc.point=m5e,Dg(Ou=e,Ru=t)}function m5e(e,t){var r=e-Ou,n=t-Ru,o=$n(r*r+n*n);uI+=o*(Ou+e)/2,fI+=o*(Ru+t)/2,Oy+=o,Dg(Ou=e,Ru=t)}function zie(){Pc.point=Dg}function g5e(){Pc.point=y5e}function _5e(){Fie(Die,Lie)}function y5e(e,t){Pc.point=Fie,Dg(Die=Ou=e,Lie=Ru=t)}function Fie(e,t){var r=e-Ou,n=t-Ru,o=$n(r*r+n*n);uI+=o*(Ou+e)/2,fI+=o*(Ru+t)/2,Oy+=o,o=Ru*e-Ou*t,XD+=o*(Ou+e),KD+=o*(Ru+t),Pw+=o*3,Dg(Ou=e,Ru=t)}var GD,HD,kw,uI,fI,Oy,XD,KD,Pw,Die,Lie,Ou,Ru,Pc,$D,Bie=W(()=>{kn();GD=0,HD=0,kw=0,uI=0,fI=0,Oy=0,XD=0,KD=0,Pw=0,Pc={point:Dg,lineStart:Nie,lineEnd:zie,polygonStart:function(){Pc.lineStart=g5e,Pc.lineEnd=_5e},polygonEnd:function(){Pc.point=Dg,Pc.lineStart=Nie,Pc.lineEnd=zie},result:function(){var e=Pw?[XD/Pw,KD/Pw]:Oy?[uI/Oy,fI/Oy]:kw?[GD/kw,HD/kw]:[NaN,NaN];return GD=HD=kw=uI=fI=Oy=XD=KD=Pw=0,e}};$D=Pc});function hI(e){this._context=e}var jie=W(()=>{kn();ih();hI.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,bo);break}}},result:ri}});function x5e(e,t){dI.point=Wie,Uie=Ow=e,Vie=Rw=t}function Wie(e,t){Ow-=e,Rw-=t,JD.add($n(Ow*Ow+Rw*Rw)),Ow=e,Rw=t}var JD,QD,Uie,Vie,Ow,Rw,dI,eL,Zie=W(()=>{ki();kn();ih();JD=new ci,dI={point:ri,lineStart:function(){dI.point=x5e},lineEnd:function(){QD&&Wie(Uie,Vie),dI.point=ri},polygonStart:function(){QD=!0},polygonEnd:function(){QD=null},result:function(){var e=+JD;return JD=new ci,e}};eL=dI});function Hie(e){let t=1;this._+=e[0];for(let r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function b5e(e){let t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return Hie;if(t!==Yie){let r=10**t;Yie=t,pI=function(o){let i=1;this._+=o[0];for(let s=o.length;i<s;++i)this._+=Math.round(arguments[i]*r)/r+o[i]}}return pI}var Yie,pI,qie,Gie,Ry,Xie=W(()=>{Ry=class{constructor(t){this._append=t==null?Hie:b5e(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,r){switch(this._point){case 0:{this._append`M${t},${r}`,this._point=1;break}case 1:{this._append`L${t},${r}`;break}default:{if(this._append`M${t},${r}`,this._radius!==qie||this._append!==pI){let n=this._radius,o=this._;this._="",this._append`m0,${n}a${n},${n} 0 1,1 0,${-2*n}a${n},${n} 0 1,1 0,${2*n}z`,qie=n,pI=this._append,Gie=this._,this._=o}this._+=Gie;break}}}result(){let t=this._;return this._="",t.length?t:null}}});function Kie(e,t){let r=3,n=4.5,o,i;function s(a){return a&&(typeof n=="function"&&i.pointRadius(+n.apply(this,arguments)),os(a,o(i))),i.result()}return s.area=function(a){return os(a,o(YD)),YD.result()},s.measure=function(a){return os(a,o(eL)),eL.result()},s.bounds=function(a){return os(a,o(Py)),Py.result()},s.centroid=function(a){return os(a,o($D)),$D.result()},s.projection=function(a){return arguments.length?(o=a==null?(e=null,ep):(e=a).stream,s):e},s.context=function(a){return arguments.length?(i=a==null?(t=null,new Ry(r)):new hI(t=a),typeof n!="function"&&i.pointRadius(n),s):t},s.pointRadius=function(a){return arguments.length?(n=typeof a=="function"?a:(i.pointRadius(+a),+a),s):n},s.digits=function(a){if(!arguments.length)return r;if(a==null)r=null;else{let u=Math.floor(a);if(!(u>=0))throw new RangeError(`invalid digits: ${a}`);r=u}return t===null&&(i=new Ry(r)),s},s.projection(e).digits(r).context(t)}var $ie=W(()=>{aI();Qd();Rie();qD();Bie();jie();Zie();Xie()});function Qie(e){return{stream:rp(e)}}function rp(e){return function(t){var r=new tL;for(var n in e)r[n]=e[n];return r.stream=t,r}}function tL(){}var Nw=W(()=>{tL.prototype={constructor:tL,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}}});function rL(e,t,r){var n=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),n!=null&&e.clipExtent(null),os(r,e.stream(Py)),t(Py.result()),n!=null&&e.clipExtent(n),e}function Lg(e,t,r){return rL(e,function(n){var o=t[1][0]-t[0][0],i=t[1][1]-t[0][1],s=Math.min(o/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),a=+t[0][0]+(o-s*(n[1][0]+n[0][0]))/2,u=+t[0][1]+(i-s*(n[1][1]+n[0][1]))/2;e.scale(150*s).translate([a,u])},r)}function Ny(e,t,r){return Lg(e,[[0,0],t],r)}function zy(e,t,r){return rL(e,function(n){var o=+t,i=o/(n[1][0]-n[0][0]),s=(o-i*(n[1][0]+n[0][0]))/2,a=-i*n[0][1];e.scale(150*i).translate([s,a])},r)}function Dy(e,t,r){return rL(e,function(n){var o=+t,i=o/(n[1][1]-n[0][1]),s=-i*n[0][0],a=(o-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([s,a])},r)}var mI=W(()=>{Qd();qD()});function nL(e,t){return+t?A5e(e,t):w5e(e)}function w5e(e){return rp({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function A5e(e,t){function r(n,o,i,s,a,u,h,p,_,y,A,E,k,P){var R=h-n,V=p-o,N=R*R+V*V;if(N>4*t&&k--){var j=s+y,J=a+A,ne=u+E,de=$n(j*j+J*J+ne*ne),fe=Oi(ne/=de),ye=an(an(ne)-1)<Cr||an(i-_)<Cr?(i+_)/2:Pi(J,j),ve=e(ye,fe),be=ve[0],je=ve[1],Re=be-n,Se=je-o,Ue=V*Re-R*Se;(Ue*Ue/N>t||an((R*Re+V*Se)/N-.5)>.3||s*y+a*A+u*E<v5e)&&(r(n,o,i,s,a,u,be,je,ye,j/=de,J/=de,ne,k,P),P.point(be,je),r(be,je,ye,j,J,ne,h,p,_,y,A,E,k,P))}}return function(n){var o,i,s,a,u,h,p,_,y,A,E,k,P={point:R,lineStart:V,lineEnd:j,polygonStart:function(){n.polygonStart(),P.lineStart=J},polygonEnd:function(){n.polygonEnd(),P.lineStart=V}};function R(fe,ye){fe=e(fe,ye),n.point(fe[0],fe[1])}function V(){_=NaN,P.point=N,n.lineStart()}function N(fe,ye){var ve=Bl([fe,ye]),be=e(fe,ye);r(_,y,p,A,E,k,_=be[0],y=be[1],p=fe,A=ve[0],E=ve[1],k=ve[2],Jie,n),n.point(_,y)}function j(){P.point=R,n.lineEnd()}function J(){V(),P.point=ne,P.lineEnd=de}function ne(fe,ye){N(o=fe,ye),i=_,s=y,a=A,u=E,h=k,P.point=N}function de(){r(_,y,p,A,E,k,i,s,o,a,u,h,Jie,n),P.lineEnd=j,j()}return P}}var Jie,v5e,eoe=W(()=>{Sy();kn();Nw();Jie=16,v5e=hr(30*Fr)});function S5e(e){return rp({point:function(t,r){var n=e(t,r);return this.stream.point(n[0],n[1])}})}function T5e(e,t,r,n,o){function i(s,a){return s*=n,a*=o,[t+e*s,r-e*a]}return i.invert=function(s,a){return[(s-t)/e*n,(r-a)/e*o]},i}function toe(e,t,r,n,o,i){if(!i)return T5e(e,t,r,n,o);var s=hr(i),a=nr(i),u=s*e,h=a*e,p=s/e,_=a/e,y=(a*r-s*t)/e,A=(a*t+s*r)/e;function E(k,P){return k*=n,P*=o,[u*k-h*P+t,r-h*k-u*P]}return E.invert=function(k,P){return[n*(p*k-_*P+y),o*(A-_*k-p*P)]},E}function vo(e){return zw(function(){return e})()}function zw(e){var t,r=150,n=480,o=250,i=0,s=0,a=0,u=0,h=0,p,_=0,y=1,A=1,E=null,k=Tw,P=null,R,V,N,j=ep,J=.5,ne,de,fe,ye,ve;function be(Ue){return fe(Ue[0]*Fr,Ue[1]*Fr)}function je(Ue){return Ue=fe.invert(Ue[0],Ue[1]),Ue&&[Ue[0]*Yn,Ue[1]*Yn]}be.stream=function(Ue){return ye&&ve===Ue?ye:ye=M5e(S5e(p)(k(ne(j(ve=Ue)))))},be.preclip=function(Ue){return arguments.length?(k=Ue,E=void 0,Se()):k},be.postclip=function(Ue){return arguments.length?(j=Ue,P=R=V=N=null,Se()):j},be.clipAngle=function(Ue){return arguments.length?(k=+Ue?eI(E=Ue*Fr):(E=null,Tw),Se()):E*Yn},be.clipExtent=function(Ue){return arguments.length?(j=Ue==null?(P=R=V=N=null,ep):lh(P=+Ue[0][0],R=+Ue[0][1],V=+Ue[1][0],N=+Ue[1][1]),Se()):P==null?null:[[P,R],[V,N]]},be.scale=function(Ue){return arguments.length?(r=+Ue,Re()):r},be.translate=function(Ue){return arguments.length?(n=+Ue[0],o=+Ue[1],Re()):[n,o]},be.center=function(Ue){return arguments.length?(i=Ue[0]%360*Fr,s=Ue[1]%360*Fr,Re()):[i*Yn,s*Yn]},be.rotate=function(Ue){return arguments.length?(a=Ue[0]%360*Fr,u=Ue[1]%360*Fr,h=Ue.length>2?Ue[2]%360*Fr:0,Re()):[a*Yn,u*Yn,h*Yn]},be.angle=function(Ue){return arguments.length?(_=Ue%360*Fr,Re()):_*Yn},be.reflectX=function(Ue){return arguments.length?(y=Ue?-1:1,Re()):y<0},be.reflectY=function(Ue){return arguments.length?(A=Ue?-1:1,Re()):A<0},be.precision=function(Ue){return arguments.length?(ne=nL(de,J=Ue*Ue),Se()):$n(J)},be.fitExtent=function(Ue,qe){return Lg(be,Ue,qe)},be.fitSize=function(Ue,qe){return Ny(be,Ue,qe)},be.fitWidth=function(Ue,qe){return zy(be,Ue,qe)},be.fitHeight=function(Ue,qe){return Dy(be,Ue,qe)};function Re(){var Ue=toe(r,0,0,y,A,_).apply(null,t(i,s)),qe=toe(r,n-Ue[0],o-Ue[1],y,A,_);return p=Mw(a,u,h),de=Aw(t,qe),fe=Aw(p,de),ne=nL(de,J),Se()}function Se(){return ye=ve=null,be}return function(){return t=e.apply(this,arguments),be.invert=t.invert&&je,Re()}}var M5e,jl=W(()=>{ND();zD();Iw();MD();aI();kn();Sw();Nw();mI();eoe();M5e=rp({point:function(e,t){this.stream.point(e*Fr,t*Fr)}})});function Ly(e){var t=0,r=mn/3,n=zw(e),o=n(t,r);return o.parallels=function(i){return arguments.length?n(t=i[0]*Fr,r=i[1]*Fr):[t*Yn,r*Yn]},o}var gI=W(()=>{kn();jl()});function roe(e){var t=hr(e);function r(n,o){return[n*t,nr(o)/t]}return r.invert=function(n,o){return[n/t,Oi(o*t)]},r}var noe=W(()=>{kn()});function iL(e,t){var r=nr(e),n=(r+nr(t))/2;if(an(n)<Cr)return roe(e);var o=1+r*(2*n-r),i=$n(o)/n;function s(a,u){var h=$n(o-2*n*nr(u))/n;return[h*nr(a*=n),i-h*hr(a)]}return s.invert=function(a,u){var h=i-u,p=Pi(a,an(h))*Vs(h);return h*n<0&&(p-=mn*Vs(a)*Vs(h)),[p/n,Oi((o-(a*a+h*h)*n*n)/(2*n))]},s}function Fg(){return Ly(iL).scale(155.424).center([0,33.6442])}var _I=W(()=>{kn();gI();noe()});function yI(){return Fg().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}var oL=W(()=>{_I()});function E5e(e){var t=e.length;return{point:function(r,n){for(var o=-1;++o<t;)e[o].point(r,n)},sphere:function(){for(var r=-1;++r<t;)e[r].sphere()},lineStart:function(){for(var r=-1;++r<t;)e[r].lineStart()},lineEnd:function(){for(var r=-1;++r<t;)e[r].lineEnd()},polygonStart:function(){for(var r=-1;++r<t;)e[r].polygonStart()},polygonEnd:function(){for(var r=-1;++r<t;)e[r].polygonEnd()}}}function ioe(){var e,t,r=yI(),n,o=Fg().rotate([154,0]).center([-2,58.5]).parallels([55,65]),i,s=Fg().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,h={point:function(y,A){u=[y,A]}};function p(y){var A=y[0],E=y[1];return u=null,n.point(A,E),u||(i.point(A,E),u)||(a.point(A,E),u)}p.invert=function(y){var A=r.scale(),E=r.translate(),k=(y[0]-E[0])/A,P=(y[1]-E[1])/A;return(P>=.12&&P<.234&&k>=-.425&&k<-.214?o:P>=.166&&P<.234&&k>=-.214&&k<-.115?s:r).invert(y)},p.stream=function(y){return e&&t===y?e:e=E5e([r.stream(t=y),o.stream(y),s.stream(y)])},p.precision=function(y){return arguments.length?(r.precision(y),o.precision(y),s.precision(y),_()):r.precision()},p.scale=function(y){return arguments.length?(r.scale(y),o.scale(y*.35),s.scale(y),p.translate(r.translate())):r.scale()},p.translate=function(y){if(!arguments.length)return r.translate();var A=r.scale(),E=+y[0],k=+y[1];return n=r.translate(y).clipExtent([[E-.455*A,k-.238*A],[E+.455*A,k+.238*A]]).stream(h),i=o.translate([E-.307*A,k+.201*A]).clipExtent([[E-.425*A+Cr,k+.12*A+Cr],[E-.214*A-Cr,k+.234*A-Cr]]).stream(h),a=s.translate([E-.205*A,k+.212*A]).clipExtent([[E-.214*A+Cr,k+.166*A+Cr],[E-.115*A-Cr,k+.234*A-Cr]]).stream(h),_()},p.fitExtent=function(y,A){return Lg(p,y,A)},p.fitSize=function(y,A){return Ny(p,y,A)},p.fitWidth=function(y,A){return zy(p,y,A)},p.fitHeight=function(y,A){return Dy(p,y,A)};function _(){return e=t=null,p}return p.scale(1070)}var ooe=W(()=>{kn();oL();_I();mI()});function xI(e){return function(t,r){var n=hr(t),o=hr(r),i=e(n*o);return i===1/0?[2,0]:[i*o*nr(t),i*nr(r)]}}function Nu(e){return function(t,r){var n=$n(t*t+r*r),o=e(n),i=nr(o),s=hr(o);return[Pi(t*i,n*s),Oi(n&&r*i/n)]}}var Fy=W(()=>{kn()});function soe(){return vo(bI).scale(124.75).clipAngle(180-.001)}var bI,aoe=W(()=>{kn();Fy();jl();bI=xI(function(e){return $n(2/(1+e))});bI.invert=Nu(function(e){return 2*Oi(e/2)})});function loe(){return vo(vI).scale(79.4188).clipAngle(180-.001)}var vI,coe=W(()=>{kn();Fy();jl();vI=xI(function(e){return(e=LE(e))&&e/nr(e)});vI.invert=Nu(function(e){return e})});function Bg(e,t){return[e,Pg(My((vi+t)/2))]}function uoe(){return sL(Bg).scale(961/bo)}function sL(e){var t=vo(e),r=t.center,n=t.scale,o=t.translate,i=t.clipExtent,s=null,a,u,h;t.scale=function(_){return arguments.length?(n(_),p()):n()},t.translate=function(_){return arguments.length?(o(_),p()):o()},t.center=function(_){return arguments.length?(r(_),p()):r()},t.clipExtent=function(_){return arguments.length?(_==null?s=a=u=h=null:(s=+_[0][0],a=+_[0][1],u=+_[1][0],h=+_[1][1]),p()):s==null?null:[[s,a],[u,h]]};function p(){var _=mn*n(),y=t(HE(t.rotate()).invert([0,0]));return i(s==null?[[y[0]-_,y[1]-_],[y[0]+_,y[1]+_]]:e===Bg?[[Math.max(y[0]-_,s),a],[Math.min(y[0]+_,u),h]]:[[s,Math.max(y[1]-_,a)],[u,Math.min(y[1]+_,h)]])}return p()}var wI=W(()=>{kn();Sw();jl();Bg.invert=function(e,t){return[e,2*Fl(NE(t))-vi]}});function AI(e){return My((vi+e)/2)}function aL(e,t){var r=hr(e),n=e===t?nr(e):Pg(r/hr(t))/Pg(AI(t)/AI(e)),o=r*DE(AI(e),n)/n;if(!n)return Bg;function i(s,a){o>0?a<-vi+Cr&&(a=-vi+Cr):a>vi-Cr&&(a=vi-Cr);var u=o/DE(AI(a),n);return[u*nr(n*s),o-u*hr(n*s)]}return i.invert=function(s,a){var u=o-a,h=Vs(n)*$n(s*s+u*u),p=Pi(s,an(u))*Vs(u);return u*n<0&&(p-=mn*Vs(s)*Vs(u)),[p/n,2*Fl(DE(o/h,1/n))-vi]},i}function foe(){return Ly(aL).scale(109.5).parallels([30,30])}var hoe=W(()=>{kn();gI();wI()});function jg(e,t){return[e,t]}function doe(){return vo(jg).scale(152.63)}var lL=W(()=>{jl();jg.invert=jg});function cL(e,t){var r=hr(e),n=e===t?nr(e):(r-hr(t))/(t-e),o=r/n+e;if(an(n)<Cr)return jg;function i(s,a){var u=o-a,h=n*s;return[u*nr(h),o-u*hr(h)]}return i.invert=function(s,a){var u=o-a,h=Pi(s,an(u))*Vs(u);return u*n<0&&(h-=mn*Vs(s)*Vs(u)),[h/n,o-Vs(n)*$n(s*s+u*u)]},i}function poe(){return Ly(cL).scale(131.154).center([0,13.9389])}var moe=W(()=>{kn();gI();lL()});function SI(e,t){var r=Oi(MI*nr(t)),n=r*r,o=n*n*n;return[e*hr(r)/(MI*(Dw+3*Lw*n+o*(7*Fw+9*Bw*n))),r*(Dw+Lw*n+o*(Fw+Bw*n))]}function goe(){return vo(SI).scale(177.158)}var Dw,Lw,Fw,Bw,MI,I5e,_oe=W(()=>{jl();kn();Dw=1.340264,Lw=-.081106,Fw=893e-6,Bw=.003796,MI=$n(3)/2,I5e=12;SI.invert=function(e,t){for(var r=t,n=r*r,o=n*n*n,i=0,s,a,u;i<I5e&&(a=r*(Dw+Lw*n+o*(Fw+Bw*n))-t,u=Dw+3*Lw*n+o*(7*Fw+9*Bw*n),r-=s=a/u,n=r*r,o=n*n*n,!(an(s)<nh));++i);return[MI*e*(Dw+3*Lw*n+o*(7*Fw+9*Bw*n))/hr(r),Oi(nr(r)/MI)]}});function TI(e,t){var r=hr(t),n=hr(e)*r;return[r*nr(e)/n,nr(t)/n]}function yoe(){return vo(TI).scale(144.049).clipAngle(60)}var xoe=W(()=>{kn();Fy();jl();TI.invert=Nu(Fl)});function boe(){var e=1,t=0,r=0,n=1,o=1,i=0,s,a,u=null,h,p,_,y=1,A=1,E=rp({point:function(j,J){var ne=N([j,J]);this.stream.point(ne[0],ne[1])}}),k=ep,P,R;function V(){return y=e*n,A=e*o,P=R=null,N}function N(j){var J=j[0]*y,ne=j[1]*A;if(i){var de=ne*s-J*a;J=J*s+ne*a,ne=de}return[J+t,ne+r]}return N.invert=function(j){var J=j[0]-t,ne=j[1]-r;if(i){var de=ne*s+J*a;J=J*s-ne*a,ne=de}return[J/y,ne/A]},N.stream=function(j){return P&&R===j?P:P=E(k(R=j))},N.postclip=function(j){return arguments.length?(k=j,u=h=p=_=null,V()):k},N.clipExtent=function(j){return arguments.length?(k=j==null?(u=h=p=_=null,ep):lh(u=+j[0][0],h=+j[0][1],p=+j[1][0],_=+j[1][1]),V()):u==null?null:[[u,h],[p,_]]},N.scale=function(j){return arguments.length?(e=+j,V()):e},N.translate=function(j){return arguments.length?(t=+j[0],r=+j[1],V()):[t,r]},N.angle=function(j){return arguments.length?(i=j%360*Fr,a=nr(i),s=hr(i),V()):i*Yn},N.reflectX=function(j){return arguments.length?(n=j?-1:1,V()):n<0},N.reflectY=function(j){return arguments.length?(o=j?-1:1,V()):o<0},N.fitExtent=function(j,J){return Lg(N,j,J)},N.fitSize=function(j,J){return Ny(N,j,J)},N.fitWidth=function(j,J){return zy(N,j,J)},N.fitHeight=function(j,J){return Dy(N,j,J)},N}var voe=W(()=>{Iw();aI();Nw();mI();kn()});function EI(e,t){var r=t*t,n=r*r;return[e*(.8707-.131979*r+n*(-.013791+n*(.003971*r-.001529*n))),t*(1.007226+r*(.015085+n*(-.044475+.028874*r-.005916*n)))]}function woe(){return vo(EI).scale(175.295)}var Aoe=W(()=>{jl();kn();EI.invert=function(e,t){var r=t,n=25,o;do{var i=r*r,s=i*i;r-=o=(r*(1.007226+i*(.015085+s*(-.044475+.028874*i-.005916*s)))-t)/(1.007226+i*(.015085*3+s*(-.044475*7+.028874*9*i-.005916*11*s)))}while(an(o)>Cr&&--n>0);return[e/(.8707+(i=r*r)*(-.131979+i*(-.013791+i*i*i*(.003971-.001529*i)))),r]}});function II(e,t){return[hr(t)*nr(e),nr(t)]}function Moe(){return vo(II).scale(249.5).clipAngle(90+Cr)}var Soe=W(()=>{kn();Fy();jl();II.invert=Nu(Oi)});function CI(e,t){var r=hr(t),n=1+hr(e)*r;return[r*nr(e)/n,nr(t)/n]}function Toe(){return vo(CI).scale(250).clipAngle(142)}var Eoe=W(()=>{kn();Fy();jl();CI.invert=Nu(function(e){return 2*Fl(e)})});function kI(e,t){return[Pg(My((vi+t)/2)),-e]}function Ioe(){var e=sL(kI),t=e.center,r=e.rotate;return e.center=function(n){return arguments.length?t([-n[1],n[0]]):(n=t(),[n[1],-n[0]])},e.rotate=function(n){return arguments.length?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},r([0,0,90]).scale(159.155)}var Coe=W(()=>{kn();wI();kI.invert=function(e,t){return[-t,2*Fl(NE(e))-vi]}});var koe=W(()=>{yD();$ne();iie();ED();ND();zD();mie();Iw();Aie();jD();Eie();Cie();FD();$ie();oL();ooe();aoe();coe();hoe();_I();moe();_oe();lL();xoe();voe();jl();wI();Aoe();Soe();Eoe();Coe();Sw();Qd();Nw()});function C5e(e,t){return e.parent===t.parent?1:2}function k5e(e){return e.reduce(P5e,0)/e.length}function P5e(e,t){return e+t.x}function O5e(e){return 1+e.reduce(R5e,0)}function R5e(e,t){return Math.max(e,t.y)}function N5e(e){for(var t;t=e.children;)e=t[0];return e}function z5e(e){for(var t;t=e.children;)e=t[t.length-1];return e}function Poe(){var e=C5e,t=1,r=1,n=!1;function o(i){var s,a=0;i.eachAfter(function(y){var A=y.children;A?(y.x=k5e(A),y.y=O5e(A)):(y.x=s?a+=e(y,s):0,y.y=0,s=y)});var u=N5e(i),h=z5e(i),p=u.x-e(u,h)/2,_=h.x+e(h,u)/2;return i.eachAfter(n?function(y){y.x=(y.x-i.x)*t,y.y=(i.y-y.y)*r}:function(y){y.x=(y.x-p)/(_-p)*t,y.y=(1-(i.y?y.y/i.y:1))*r})}return o.separation=function(i){return arguments.length?(e=i,o):e},o.size=function(i){return arguments.length?(n=!1,t=+i[0],r=+i[1],o):n?null:[t,r]},o.nodeSize=function(i){return arguments.length?(n=!0,t=+i[0],r=+i[1],o):n?[t,r]:null},o}var Ooe=W(()=>{});function D5e(e){var t=0,r=e.children,n=r&&r.length;if(!n)t=1;else for(;--n>=0;)t+=r[n].value;e.value=t}function Roe(){return this.eachAfter(D5e)}var Noe=W(()=>{});function zoe(e,t){let r=-1;for(let n of this)e.call(t,n,++r,this);return this}var Doe=W(()=>{});function Loe(e,t){for(var r=this,n=[r],o,i,s=-1;r=n.pop();)if(e.call(t,r,++s,this),o=r.children)for(i=o.length-1;i>=0;--i)n.push(o[i]);return this}var Foe=W(()=>{});function Boe(e,t){for(var r=this,n=[r],o=[],i,s,a,u=-1;r=n.pop();)if(o.push(r),i=r.children)for(s=0,a=i.length;s<a;++s)n.push(i[s]);for(;r=o.pop();)e.call(t,r,++u,this);return this}var joe=W(()=>{});function Uoe(e,t){let r=-1;for(let n of this)if(e.call(t,n,++r,this))return n}var Voe=W(()=>{});function Woe(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,o=n&&n.length;--o>=0;)r+=n[o].value;t.value=r})}var Zoe=W(()=>{});function Yoe(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}var qoe=W(()=>{});function Goe(e){for(var t=this,r=L5e(t,e),n=[t];t!==r;)t=t.parent,n.push(t);for(var o=n.length;e!==r;)n.splice(o,0,e),e=e.parent;return n}function L5e(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),o=null;for(e=r.pop(),t=n.pop();e===t;)o=e,e=r.pop(),t=n.pop();return o}var Hoe=W(()=>{});function Xoe(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}var Koe=W(()=>{});function $oe(){return Array.from(this)}var Qoe=W(()=>{});function Joe(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}var ese=W(()=>{});function tse(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}var rse=W(()=>{});function*nse(){var e=this,t,r=[e],n,o,i;do for(t=r.reverse(),r=[];e=t.pop();)if(yield e,n=e.children)for(o=0,i=n.length;o<i;++o)r.push(n[o]);while(r.length)}var ise=W(()=>{});function ch(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=j5e)):t===void 0&&(t=B5e);for(var r=new zu(e),n,o=[r],i,s,a,u;n=o.pop();)if((s=t(n.data))&&(u=(s=Array.from(s)).length))for(n.children=s,a=u-1;a>=0;--a)o.push(i=s[a]=new zu(s[a])),i.parent=n,i.depth=n.depth+1;return r.eachBefore(uL)}function F5e(){return ch(this).eachBefore(U5e)}function B5e(e){return e.children}function j5e(e){return Array.isArray(e)?e[1]:null}function U5e(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function uL(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function zu(e){this.data=e,this.depth=this.height=0,this.parent=null}var PI=W(()=>{Noe();Doe();Foe();joe();Voe();Zoe();qoe();Hoe();Koe();Qoe();ese();rse();ise();zu.prototype=ch.prototype={constructor:zu,count:Roe,each:zoe,eachAfter:Boe,eachBefore:Loe,find:Uoe,sum:Woe,sort:Yoe,path:Goe,ancestors:Xoe,descendants:$oe,leaves:Joe,links:tse,copy:F5e,[Symbol.iterator]:nse}});function By(e){return e==null?null:fL(e)}function fL(e){if(typeof e!="function")throw new Error;return e}var OI=W(()=>{});function uh(){return 0}function np(e){return function(){return e}}var hL=W(()=>{});function jy(){let e=1;return()=>(e=(1664525*e+1013904223)%4294967296)/4294967296}var RI=W(()=>{});function ose(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function sse(e,t){let r=e.length,n,o;for(;r;)o=t()*r--|0,n=e[r],e[r]=e[o],e[o]=n;return e}var dL=W(()=>{});function ase(e){return mL(e,jy())}function mL(e,t){for(var r=0,n=(e=sse(Array.from(e),t)).length,o=[],i,s;r<n;)i=e[r],s&&lse(s,i)?++r:(s=W5e(o=V5e(o,i)),r=0);return s}function V5e(e,t){var r,n;if(pL(t,e))return[t];for(r=0;r<e.length;++r)if(NI(t,e[r])&&pL(jw(e[r],t),e))return[e[r],t];for(r=0;r<e.length-1;++r)for(n=r+1;n<e.length;++n)if(NI(jw(e[r],e[n]),t)&&NI(jw(e[r],t),e[n])&&NI(jw(e[n],t),e[r])&&pL(cse(e[r],e[n],t),e))return[e[r],e[n],t];throw new Error}function NI(e,t){var r=e.r-t.r,n=t.x-e.x,o=t.y-e.y;return r<0||r*r<n*n+o*o}function lse(e,t){var r=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,n=t.x-e.x,o=t.y-e.y;return r>0&&r*r>n*n+o*o}function pL(e,t){for(var r=0;r<t.length;++r)if(!lse(e,t[r]))return!1;return!0}function W5e(e){switch(e.length){case 1:return Z5e(e[0]);case 2:return jw(e[0],e[1]);case 3:return cse(e[0],e[1],e[2])}}function Z5e(e){return{x:e.x,y:e.y,r:e.r}}function jw(e,t){var r=e.x,n=e.y,o=e.r,i=t.x,s=t.y,a=t.r,u=i-r,h=s-n,p=a-o,_=Math.sqrt(u*u+h*h);return{x:(r+i+u/_*p)/2,y:(n+s+h/_*p)/2,r:(_+o+a)/2}}function cse(e,t,r){var n=e.x,o=e.y,i=e.r,s=t.x,a=t.y,u=t.r,h=r.x,p=r.y,_=r.r,y=n-s,A=n-h,E=o-a,k=o-p,P=u-i,R=_-i,V=n*n+o*o-i*i,N=V-s*s-a*a+u*u,j=V-h*h-p*p+_*_,J=A*E-y*k,ne=(E*j-k*N)/(J*2)-n,de=(k*P-E*R)/J,fe=(A*N-y*j)/(J*2)-o,ye=(y*R-A*P)/J,ve=de*de+ye*ye-1,be=2*(i+ne*de+fe*ye),je=ne*ne+fe*fe-i*i,Re=-(Math.abs(ve)>1e-6?(be+Math.sqrt(be*be-4*ve*je))/(2*ve):je/be);return{x:n+ne+de*Re,y:o+fe+ye*Re,r:Re}}var gL=W(()=>{dL();RI()});function use(e,t,r){var n=e.x-t.x,o,i,s=e.y-t.y,a,u,h=n*n+s*s;h?(i=t.r+r.r,i*=i,u=e.r+r.r,u*=u,i>u?(o=(h+u-i)/(2*h),a=Math.sqrt(Math.max(0,u/h-o*o)),r.x=e.x-o*n-a*s,r.y=e.y-o*s+a*n):(o=(h+i-u)/(2*h),a=Math.sqrt(Math.max(0,i/h-o*o)),r.x=t.x+o*n-a*s,r.y=t.y+o*s+a*n)):(r.x=t.x+r.r,r.y=t.y)}function fse(e,t){var r=e.r+t.r-1e-6,n=t.x-e.x,o=t.y-e.y;return r>0&&r*r>n*n+o*o}function hse(e){var t=e._,r=e.next._,n=t.r+r.r,o=(t.x*r.r+r.x*t.r)/n,i=(t.y*r.r+r.y*t.r)/n;return o*o+i*i}function zI(e){this._=e,this.next=null,this.previous=null}function _L(e,t){if(!(i=(e=ose(e)).length))return 0;var r,n,o,i,s,a,u,h,p,_,y;if(r=e[0],r.x=0,r.y=0,!(i>1))return r.r;if(n=e[1],r.x=-n.r,n.x=r.r,n.y=0,!(i>2))return r.r+n.r;use(n,r,o=e[2]),r=new zI(r),n=new zI(n),o=new zI(o),r.next=o.previous=n,n.next=r.previous=o,o.next=n.previous=r;e:for(u=3;u<i;++u){use(r._,n._,o=e[u]),o=new zI(o),h=n.next,p=r.previous,_=n._.r,y=r._.r;do if(_<=y){if(fse(h._,o._)){n=h,r.next=n,n.previous=r,--u;continue e}_+=h._.r,h=h.next}else{if(fse(p._,o._)){r=p,r.next=n,n.previous=r,--u;continue e}y+=p._.r,p=p.previous}while(h!==p.next);for(o.previous=r,o.next=n,r.next=n.previous=n=o,s=hse(r);(o=o.next)!==n;)(a=hse(o))<s&&(r=o,s=a);n=r.next}for(r=[n._],o=n;(o=o.next)!==n;)r.push(o._);for(o=mL(r,t),u=0;u<i;++u)r=e[u],r.x-=o.x,r.y-=o.y;return o.r}function dse(e){return _L(e,jy()),e}var yL=W(()=>{dL();RI();gL()});function Y5e(e){return Math.sqrt(e.value)}function gse(){var e=null,t=1,r=1,n=uh;function o(i){let s=jy();return i.x=t/2,i.y=r/2,e?i.eachBefore(pse(e)).eachAfter(xL(n,.5,s)).eachBefore(mse(1)):i.eachBefore(pse(Y5e)).eachAfter(xL(uh,1,s)).eachAfter(xL(n,i.r/Math.min(t,r),s)).eachBefore(mse(Math.min(t,r)/(2*i.r))),i}return o.radius=function(i){return arguments.length?(e=By(i),o):e},o.size=function(i){return arguments.length?(t=+i[0],r=+i[1],o):[t,r]},o.padding=function(i){return arguments.length?(n=typeof i=="function"?i:np(+i),o):n},o}function pse(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function xL(e,t,r){return function(n){if(o=n.children){var o,i,s=o.length,a=e(n)*t||0,u;if(a)for(i=0;i<s;++i)o[i].r+=a;if(u=_L(o,r),a)for(i=0;i<s;++i)o[i].r-=a;n.r=u+a}}}function mse(e){return function(t){var r=t.parent;t.r*=e,r&&(t.x=r.x+e*t.x,t.y=r.y+e*t.y)}}var _se=W(()=>{OI();hL();RI();yL()});function DI(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}var bL=W(()=>{});function Du(e,t,r,n,o){for(var i=e.children,s,a=-1,u=i.length,h=e.value&&(n-t)/e.value;++a<u;)s=i[a],s.y0=r,s.y1=o,s.x0=t,s.x1=t+=s.value*h}var Uy=W(()=>{});function LI(){var e=1,t=1,r=0,n=!1;function o(s){var a=s.height+1;return s.x0=s.y0=r,s.x1=e,s.y1=t/a,s.eachBefore(i(t,a)),n&&s.eachBefore(DI),s}function i(s,a){return function(u){u.children&&Du(u,u.x0,s*(u.depth+1)/a,u.x1,s*(u.depth+2)/a);var h=u.x0,p=u.y0,_=u.x1-r,y=u.y1-r;_<h&&(h=_=(h+_)/2),y<p&&(p=y=(p+y)/2),u.x0=h,u.y0=p,u.x1=_,u.y1=y}}return o.round=function(s){return arguments.length?(n=!!s,o):n},o.size=function(s){return arguments.length?(e=+s[0],t=+s[1],o):[e,t]},o.padding=function(s){return arguments.length?(r=+s,o):r},o}var yse=W(()=>{bL();Uy()});function G5e(e){return e.id}function H5e(e){return e.parentId}function vse(){var e=G5e,t=H5e,r;function n(o){var i=Array.from(o),s=e,a=t,u,h,p,_,y,A,E,k,P=new Map;if(r!=null){let R=i.map((j,J)=>X5e(r(j,J,o))),V=R.map(bse),N=new Set(R).add("");for(let j of V)N.has(j)||(N.add(j),R.push(j),V.push(bse(j)),i.push(vL));s=(j,J)=>R[J],a=(j,J)=>V[J]}for(p=0,u=i.length;p<u;++p)h=i[p],A=i[p]=new zu(h),(E=s(h,p,o))!=null&&(E+="")&&(k=A.id=E,P.set(k,P.has(k)?xse:A)),(E=a(h,p,o))!=null&&(E+="")&&(A.parent=E);for(p=0;p<u;++p)if(A=i[p],E=A.parent){if(y=P.get(E),!y)throw new Error("missing: "+E);if(y===xse)throw new Error("ambiguous: "+E);y.children?y.children.push(A):y.children=[A],A.parent=y}else{if(_)throw new Error("multiple roots");_=A}if(!_)throw new Error("no root");if(r!=null){for(;_.data===vL&&_.children.length===1;)_=_.children[0],--u;for(let R=i.length-1;R>=0&&(A=i[R],A.data===vL);--R)A.data=null}if(_.parent=q5e,_.eachBefore(function(R){R.depth=R.parent.depth+1,--u}).eachBefore(uL),_.parent=null,u>0)throw new Error("cycle");return _}return n.id=function(o){return arguments.length?(e=By(o),n):e},n.parentId=function(o){return arguments.length?(t=By(o),n):t},n.path=function(o){return arguments.length?(r=By(o),n):r},n}function X5e(e){e=`${e}`;let t=e.length;return wL(e,t-1)&&!wL(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function bse(e){let t=e.length;if(t<2)return"";for(;--t>1&&!wL(e,t););return e.slice(0,t)}function wL(e,t){if(e[t]==="/"){let r=0;for(;t>0&&e[--t]==="\\";)++r;if(!(r&1))return!0}return!1}var q5e,xse,vL,wse=W(()=>{OI();PI();q5e={depth:-1},xse={},vL={}});function K5e(e,t){return e.parent===t.parent?1:2}function AL(e){var t=e.children;return t?t[0]:e.t}function ML(e){var t=e.children;return t?t[t.length-1]:e.t}function $5e(e,t,r){var n=r/(t.i-e.i);t.c-=n,t.s+=r,e.c+=n,t.z+=r,t.m+=r}function Q5e(e){for(var t=0,r=0,n=e.children,o=n.length,i;--o>=0;)i=n[o],i.z+=t,i.m+=t,t+=i.s+(r+=i.c)}function J5e(e,t,r){return e.a.parent===t.parent?e.a:r}function FI(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function ePe(e){for(var t=new FI(e,0),r,n=[t],o,i,s,a;r=n.pop();)if(i=r._.children)for(r.children=new Array(a=i.length),s=a-1;s>=0;--s)n.push(o=r.children[s]=new FI(i[s],s)),o.parent=r;return(t.parent=new FI(null,0)).children=[t],t}function Ase(){var e=K5e,t=1,r=1,n=null;function o(h){var p=ePe(h);if(p.eachAfter(i),p.parent.m=-p.z,p.eachBefore(s),n)h.eachBefore(u);else{var _=h,y=h,A=h;h.eachBefore(function(V){V.x<_.x&&(_=V),V.x>y.x&&(y=V),V.depth>A.depth&&(A=V)});var E=_===y?1:e(_,y)/2,k=E-_.x,P=t/(y.x+E+k),R=r/(A.depth||1);h.eachBefore(function(V){V.x=(V.x+k)*P,V.y=V.depth*R})}return h}function i(h){var p=h.children,_=h.parent.children,y=h.i?_[h.i-1]:null;if(p){Q5e(h);var A=(p[0].z+p[p.length-1].z)/2;y?(h.z=y.z+e(h._,y._),h.m=h.z-A):h.z=A}else y&&(h.z=y.z+e(h._,y._));h.parent.A=a(h,y,h.parent.A||_[0])}function s(h){h._.x=h.z+h.parent.m,h.m+=h.parent.m}function a(h,p,_){if(p){for(var y=h,A=h,E=p,k=y.parent.children[0],P=y.m,R=A.m,V=E.m,N=k.m,j;E=ML(E),y=AL(y),E&&y;)k=AL(k),A=ML(A),A.a=h,j=E.z+V-y.z-P+e(E._,y._),j>0&&($5e(J5e(E,h,_),h,j),P+=j,R+=j),V+=E.m,P+=y.m,N+=k.m,R+=A.m;E&&!ML(A)&&(A.t=E,A.m+=V-R),y&&!AL(k)&&(k.t=y,k.m+=P-N,_=h)}return _}function u(h){h.x*=t,h.y=h.depth*r}return o.separation=function(h){return arguments.length?(e=h,o):e},o.size=function(h){return arguments.length?(n=!1,t=+h[0],r=+h[1],o):n?null:[t,r]},o.nodeSize=function(h){return arguments.length?(n=!0,t=+h[0],r=+h[1],o):n?[t,r]:null},o}var Mse=W(()=>{PI();FI.prototype=Object.create(zu.prototype)});function ip(e,t,r,n,o){for(var i=e.children,s,a=-1,u=i.length,h=e.value&&(o-r)/e.value;++a<u;)s=i[a],s.x0=t,s.x1=n,s.y0=r,s.y1=r+=s.value*h}var Uw=W(()=>{});function TL(e,t,r,n,o,i){for(var s=[],a=t.children,u,h,p=0,_=0,y=a.length,A,E,k=t.value,P,R,V,N,j,J,ne;p<y;){A=o-r,E=i-n;do P=a[_++].value;while(!P&&_<y);for(R=V=P,J=Math.max(E/A,A/E)/(k*e),ne=P*P*J,j=Math.max(V/ne,ne/R);_<y;++_){if(P+=h=a[_].value,h<R&&(R=h),h>V&&(V=h),ne=P*P*J,N=Math.max(V/ne,ne/R),N>j){P-=h;break}j=N}s.push(u={value:P,dice:A<E,children:a.slice(p,_)}),u.dice?Du(u,r,n,o,k?n+=E*P/k:i):ip(u,r,n,k?r+=A*P/k:o,i),k-=P,p=_}return s}var SL,BI,jI=W(()=>{Uy();Uw();SL=(1+Math.sqrt(5))/2;BI=function e(t){function r(n,o,i,s,a){TL(t,n,o,i,s,a)}return r.ratio=function(n){return e((n=+n)>1?n:1)},r}(SL)});function UI(){var e=BI,t=!1,r=1,n=1,o=[0],i=uh,s=uh,a=uh,u=uh,h=uh;function p(y){return y.x0=y.y0=0,y.x1=r,y.y1=n,y.eachBefore(_),o=[0],t&&y.eachBefore(DI),y}function _(y){var A=o[y.depth],E=y.x0+A,k=y.y0+A,P=y.x1-A,R=y.y1-A;P<E&&(E=P=(E+P)/2),R<k&&(k=R=(k+R)/2),y.x0=E,y.y0=k,y.x1=P,y.y1=R,y.children&&(A=o[y.depth+1]=i(y)/2,E+=h(y)-A,k+=s(y)-A,P-=a(y)-A,R-=u(y)-A,P<E&&(E=P=(E+P)/2),R<k&&(k=R=(k+R)/2),e(y,E,k,P,R))}return p.round=function(y){return arguments.length?(t=!!y,p):t},p.size=function(y){return arguments.length?(r=+y[0],n=+y[1],p):[r,n]},p.tile=function(y){return arguments.length?(e=fL(y),p):e},p.padding=function(y){return arguments.length?p.paddingInner(y).paddingOuter(y):p.paddingInner()},p.paddingInner=function(y){return arguments.length?(i=typeof y=="function"?y:np(+y),p):i},p.paddingOuter=function(y){return arguments.length?p.paddingTop(y).paddingRight(y).paddingBottom(y).paddingLeft(y):p.paddingTop()},p.paddingTop=function(y){return arguments.length?(s=typeof y=="function"?y:np(+y),p):s},p.paddingRight=function(y){return arguments.length?(a=typeof y=="function"?y:np(+y),p):a},p.paddingBottom=function(y){return arguments.length?(u=typeof y=="function"?y:np(+y),p):u},p.paddingLeft=function(y){return arguments.length?(h=typeof y=="function"?y:np(+y),p):h},p}var Sse=W(()=>{bL();jI();OI();hL()});function VI(e,t,r,n,o){var i=e.children,s,a=i.length,u,h=new Array(a+1);for(h[0]=u=s=0;s<a;++s)h[s+1]=u+=i[s].value;p(0,a,e.value,t,r,n,o);function p(_,y,A,E,k,P,R){if(_>=y-1){var V=i[_];V.x0=E,V.y0=k,V.x1=P,V.y1=R;return}for(var N=h[_],j=A/2+N,J=_+1,ne=y-1;J<ne;){var de=J+ne>>>1;h[de]<j?J=de+1:ne=de}j-h[J-1]<h[J]-j&&_+1<J&&--J;var fe=h[J]-N,ye=A-fe;if(P-E>R-k){var ve=A?(E*ye+P*fe)/A:P;p(_,J,fe,E,k,ve,R),p(J,y,ye,ve,k,P,R)}else{var be=A?(k*ye+R*fe)/A:R;p(_,J,fe,E,k,P,be),p(J,y,ye,E,be,P,R)}}}var Tse=W(()=>{});function Ese(e,t,r,n,o){(e.depth&1?ip:Du)(e,t,r,n,o)}var Ise=W(()=>{Uy();Uw()});var Cse,kse=W(()=>{Uy();Uw();jI();Cse=function e(t){function r(n,o,i,s,a){if((u=n._squarify)&&u.ratio===t)for(var u,h,p,_,y=-1,A,E=u.length,k=n.value;++y<E;){for(h=u[y],p=h.children,_=h.value=0,A=p.length;_<A;++_)h.value+=p[_].value;h.dice?Du(h,o,i,s,k?i+=(a-i)*h.value/k:a):ip(h,o,i,k?o+=(s-o)*h.value/k:s,a),k-=h.value}else n._squarify=u=TL(t,n,o,i,s,a),u.ratio=t}return r.ratio=function(n){return e((n=+n)>1?n:1)},r}(SL)});var Pse=W(()=>{Ooe();PI();_se();yL();gL();yse();wse();Mse();Sse();Tse();Uy();Uw();Ise();jI();kse()});function Ose(e){for(var t=-1,r=e.length,n,o=e[r-1],i=0;++t<r;)n=o,o=e[t],i+=n[1]*o[0]-n[0]*o[1];return i/2}var Rse=W(()=>{});function Nse(e){for(var t=-1,r=e.length,n=0,o=0,i,s=e[r-1],a,u=0;++t<r;)i=s,s=e[t],u+=a=i[0]*s[1]-s[0]*i[1],n+=(i[0]+s[0])*a,o+=(i[1]+s[1])*a;return u*=3,[n/u,o/u]}var zse=W(()=>{});function Dse(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}var Lse=W(()=>{});function tPe(e,t){return e[0]-t[0]||e[1]-t[1]}function Fse(e){let t=e.length,r=[0,1],n=2,o;for(o=2;o<t;++o){for(;n>1&&Dse(e[r[n-2]],e[r[n-1]],e[o])<=0;)--n;r[n++]=o}return r.slice(0,n)}function Bse(e){if((r=e.length)<3)return null;var t,r,n=new Array(r),o=new Array(r);for(t=0;t<r;++t)n[t]=[+e[t][0],+e[t][1],t];for(n.sort(tPe),t=0;t<r;++t)o[t]=[n[t][0],-n[t][1]];var i=Fse(n),s=Fse(o),a=s[0]===i[0],u=s[s.length-1]===i[i.length-1],h=[];for(t=i.length-1;t>=0;--t)h.push(e[n[i[t]][2]]);for(t=+a;t<s.length-u;++t)h.push(e[n[s[t]][2]]);return h}var jse=W(()=>{Lse()});function Use(e,t){for(var r=e.length,n=e[r-1],o=t[0],i=t[1],s=n[0],a=n[1],u,h,p=!1,_=0;_<r;++_)n=e[_],u=n[0],h=n[1],h>i!=a>i&&o<(s-u)*(i-h)/(a-h)+u&&(p=!p),s=u,a=h;return p}var Vse=W(()=>{});function Wse(e){for(var t=-1,r=e.length,n=e[r-1],o,i,s=n[0],a=n[1],u=0;++t<r;)o=s,i=a,n=e[t],s=n[0],a=n[1],o-=s,i-=a,u+=Math.hypot(o,i);return u}var Zse=W(()=>{});var Yse=W(()=>{Rse();zse();jse();Vse();Zse()});var Hn,ss=W(()=>{Hn=Math.random});var EL,qse=W(()=>{ss();EL=function e(t){function r(n,o){return n=n==null?0:+n,o=o==null?1:+o,arguments.length===1?(o=n,n=0):o-=n,function(){return t()*o+n}}return r.source=e,r}(Hn)});var IL,Gse=W(()=>{ss();IL=function e(t){function r(n,o){return arguments.length<2&&(o=n,n=0),n=Math.floor(n),o=Math.floor(o)-n,function(){return Math.floor(t()*o+n)}}return r.source=e,r}(Hn)});var Ug,WI=W(()=>{ss();Ug=function e(t){function r(n,o){var i,s;return n=n==null?0:+n,o=o==null?1:+o,function(){var a;if(i!=null)a=i,i=null;else do i=t()*2-1,a=t()*2-1,s=i*i+a*a;while(!s||s>1);return n+o*a*Math.sqrt(-2*Math.log(s)/s)}}return r.source=e,r}(Hn)});var CL,Hse=W(()=>{ss();WI();CL=function e(t){var r=Ug.source(t);function n(){var o=r.apply(this,arguments);return function(){return Math.exp(o())}}return n.source=e,n}(Hn)});var Vw,kL=W(()=>{ss();Vw=function e(t){function r(n){return(n=+n)<=0?()=>0:function(){for(var o=0,i=n;i>1;--i)o+=t();return o+i*t()}}return r.source=e,r}(Hn)});var PL,Xse=W(()=>{ss();kL();PL=function e(t){var r=Vw.source(t);function n(o){if((o=+o)==0)return t;var i=r(o);return function(){return i()/o}}return n.source=e,n}(Hn)});var OL,Kse=W(()=>{ss();OL=function e(t){function r(n){return function(){return-Math.log1p(-t())/n}}return r.source=e,r}(Hn)});var RL,$se=W(()=>{ss();RL=function e(t){function r(n){if((n=+n)<0)throw new RangeError("invalid alpha");return n=1/-n,function(){return Math.pow(1-t(),n)}}return r.source=e,r}(Hn)});var NL,Qse=W(()=>{ss();NL=function e(t){function r(n){if((n=+n)<0||n>1)throw new RangeError("invalid p");return function(){return Math.floor(t()+n)}}return r.source=e,r}(Hn)});var Ww,zL=W(()=>{ss();Ww=function e(t){function r(n){if((n=+n)<0||n>1)throw new RangeError("invalid p");return n===0?()=>1/0:n===1?()=>1:(n=Math.log1p(-n),function(){return 1+Math.floor(Math.log1p(-t())/n)})}return r.source=e,r}(Hn)});var Vg,ZI=W(()=>{ss();WI();Vg=function e(t){var r=Ug.source(t)();function n(o,i){if((o=+o)<0)throw new RangeError("invalid k");if(o===0)return()=>0;if(i=i==null?1:+i,o===1)return()=>-Math.log1p(-t())*i;var s=(o<1?o+1:o)-1/3,a=1/(3*Math.sqrt(s)),u=o<1?()=>Math.pow(t(),1/o):()=>1;return function(){do{do var h=r(),p=1+a*h;while(p<=0);p*=p*p;var _=1-t()}while(_>=1-.0331*h*h*h*h&&Math.log(_)>=.5*h*h+s*(1-p+Math.log(p)));return s*p*u()*i}}return n.source=e,n}(Hn)});var Zw,DL=W(()=>{ss();ZI();Zw=function e(t){var r=Vg.source(t);function n(o,i){var s=r(o),a=r(i);return function(){var u=s();return u===0?0:u/(u+a())}}return n.source=e,n}(Hn)});var Yw,LL=W(()=>{ss();DL();zL();Yw=function e(t){var r=Ww.source(t),n=Zw.source(t);function o(i,s){return i=+i,(s=+s)>=1?()=>i:s<=0?()=>0:function(){for(var a=0,u=i,h=s;u*h>16&&u*(1-h)>16;){var p=Math.floor((u+1)*h),_=n(p,u-p+1)();_<=h?(a+=p,u-=p,h=(h-_)/(1-_)):(u=p-1,h/=_)}for(var y=h<.5,A=y?h:1-h,E=r(A),k=E(),P=0;k<=u;++P)k+=E();return a+(y?P:u-P)}}return o.source=e,o}(Hn)});var FL,Jse=W(()=>{ss();FL=function e(t){function r(n,o,i){var s;return(n=+n)==0?s=a=>-Math.log(a):(n=1/n,s=a=>Math.pow(a,n)),o=o==null?0:+o,i=i==null?1:+i,function(){return o+i*s(-Math.log1p(-t()))}}return r.source=e,r}(Hn)});var BL,eae=W(()=>{ss();BL=function e(t){function r(n,o){return n=n==null?0:+n,o=o==null?1:+o,function(){return n+o*Math.tan(Math.PI*t())}}return r.source=e,r}(Hn)});var jL,tae=W(()=>{ss();jL=function e(t){function r(n,o){return n=n==null?0:+n,o=o==null?1:+o,function(){var i=t();return n+o*Math.log(i/(1-i))}}return r.source=e,r}(Hn)});var UL,rae=W(()=>{ss();LL();ZI();UL=function e(t){var r=Vg.source(t),n=Yw.source(t);function o(i){return function(){for(var s=0,a=i;a>16;){var u=Math.floor(.875*a),h=r(u)();if(h>a)return s+n(u-1,a/h)();s+=u,a-=h}for(var p=-Math.log1p(-t()),_=0;p<=a;++_)p-=Math.log1p(-t());return s+_}}return o.source=e,o}(Hn)});function YI(e=Math.random()){let t=(0<=e&&e<1?e/nae:Math.abs(e))|0;return()=>(t=1664525*t+1013904223|0,nae*(t>>>0))}var nae,iae=W(()=>{nae=23283064365386963e-26});var oae={};io(oae,{randomBates:()=>PL,randomBernoulli:()=>NL,randomBeta:()=>Zw,randomBinomial:()=>Yw,randomCauchy:()=>BL,randomExponential:()=>OL,randomGamma:()=>Vg,randomGeometric:()=>Ww,randomInt:()=>IL,randomIrwinHall:()=>Vw,randomLcg:()=>YI,randomLogNormal:()=>CL,randomLogistic:()=>jL,randomNormal:()=>Ug,randomPareto:()=>RL,randomPoisson:()=>UL,randomUniform:()=>EL,randomWeibull:()=>FL});var VL=W(()=>{qse();Gse();WI();Hse();Xse();kL();Kse();$se();Qse();zL();LL();ZI();DL();Jse();eae();tae();rae();iae()});function Yi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ul(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}var Ws=W(()=>{});function sl(){var e=new Rl,t=[],r=[],n=qw;function o(i){let s=e.get(i);if(s===void 0){if(n!==qw)return n;e.set(i,s=t.push(i)-1)}return r[s%r.length]}return o.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new Rl;for(let s of i)e.has(s)||e.set(s,t.push(s)-1);return o},o.range=function(i){return arguments.length?(r=Array.from(i),o):r.slice()},o.unknown=function(i){return arguments.length?(n=i,o):n},o.copy=function(){return sl(t,r).unknown(n)},Yi.apply(o,arguments),o}var qw,WL=W(()=>{ki();Ws();qw=Symbol("implicit")});function Vl(){var e=sl().unknown(void 0),t=e.domain,r=e.range,n=0,o=1,i,s,a=!1,u=0,h=0,p=.5;delete e.unknown;function _(){var y=t().length,A=o<n,E=A?o:n,k=A?n:o;i=(k-E)/Math.max(1,y-u+h*2),a&&(i=Math.floor(i)),E+=(k-E-i*(y-u))*p,s=i*(1-u),a&&(E=Math.round(E),s=Math.round(s));var P=ca(y).map(function(R){return E+i*R});return r(A?P.reverse():P)}return e.domain=function(y){return arguments.length?(t(y),_()):t()},e.range=function(y){return arguments.length?([n,o]=y,n=+n,o=+o,_()):[n,o]},e.rangeRound=function(y){return[n,o]=y,n=+n,o=+o,a=!0,_()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(y){return arguments.length?(a=!!y,_()):a},e.padding=function(y){return arguments.length?(u=Math.min(1,h=+y),_()):u},e.paddingInner=function(y){return arguments.length?(u=Math.min(1,y),_()):u},e.paddingOuter=function(y){return arguments.length?(h=+y,_()):h},e.align=function(y){return arguments.length?(p=Math.max(0,Math.min(1,y)),_()):p},e.copy=function(){return Vl(t(),[n,o]).round(a).paddingInner(u).paddingOuter(h).align(p)},Yi.apply(_(),arguments)}function sae(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return sae(t())},e}function ZL(){return sae(Vl.apply(null,arguments).paddingInner(1))}var aae=W(()=>{ki();Ws();WL()});function YL(e){return function(){return e}}var lae=W(()=>{});function op(e){return+e}var qI=W(()=>{});function Zo(e){return e}function qL(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:YL(isNaN(t)?NaN:.5)}function rPe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function nPe(e,t,r){var n=e[0],o=e[1],i=t[0],s=t[1];return o<n?(n=qL(o,n),i=r(s,i)):(n=qL(n,o),i=r(i,s)),function(a){return i(n(a))}}function iPe(e,t,r){var n=Math.min(e.length,t.length)-1,o=new Array(n),i=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)o[s]=qL(e[s],e[s+1]),i[s]=r(t[s],t[s+1]);return function(a){var u=sa(e,a,1,n)-1;return i[u](o[u](a))}}function Lu(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Wg(){var e=cae,t=cae,r=$i,n,o,i,s=Zo,a,u,h;function p(){var y=Math.min(e.length,t.length);return s!==Zo&&(s=rPe(e[0],e[y-1])),a=y>2?iPe:nPe,u=h=null,_}function _(y){return y==null||isNaN(y=+y)?i:(u||(u=a(e.map(n),t,r)))(n(s(y)))}return _.invert=function(y){return s(o((h||(h=a(t,e.map(n),ns)))(y)))},_.domain=function(y){return arguments.length?(e=Array.from(y,op),p()):e.slice()},_.range=function(y){return arguments.length?(t=Array.from(y),p()):t.slice()},_.rangeRound=function(y){return t=Array.from(y),r=Yd,p()},_.clamp=function(y){return arguments.length?(s=y?!0:Zo,p()):s!==Zo},_.interpolate=function(y){return arguments.length?(r=y,p()):r},_.unknown=function(y){return arguments.length?(i=y,_):i},function(y,A){return n=y,o=A,p()}}function Zg(){return Wg()(Zo,Zo)}var cae,Fu=W(()=>{ki();nl();lae();qI();cae=[0,1]});function Vy(e,t,r,n){var o=kd(e,t,r),i;switch(n=Ec(n??",f"),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(i=PE(o,s))&&(n.precision=i),mw(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=OE(o,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=kE(o))&&(n.precision=i-(n.type==="%")*2);break}}return Ic(n)}var GL=W(()=>{ki();RE()});function ga(e){var t=e.domain;return e.ticks=function(r){var n=t();return la(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var o=t();return Vy(o[0],o[o.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),o=0,i=n.length-1,s=n[o],a=n[i],u,h,p=10;for(a<s&&(h=s,s=a,a=h,h=o,o=i,i=h);p-- >0;){if(h=Nl(s,a,r),h===u)return n[o]=s,n[i]=a,t(n);if(h>0)s=Math.floor(s/h)*h,a=Math.ceil(a/h)*h;else if(h<0)s=Math.ceil(s*h)/h,a=Math.floor(a*h)/h;else break;u=h}return e},e}function Oc(){var e=Zg();return e.copy=function(){return Lu(e,Oc())},Yi.apply(e,arguments),ga(e)}var fh=W(()=>{ki();Fu();Ws();GL()});function Gw(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,op),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return Gw(e).unknown(t)},e=arguments.length?Array.from(e,op):[0,1],ga(r)}var uae=W(()=>{fh();qI()});function Hw(e,t){e=e.slice();var r=0,n=e.length-1,o=e[r],i=e[n],s;return i<o&&(s=r,r=n,n=s,s=o,o=i,i=s),e[r]=t.floor(o),e[n]=t.ceil(i),e}var HL=W(()=>{});function fae(e){return Math.log(e)}function hae(e){return Math.exp(e)}function oPe(e){return-Math.log(-e)}function sPe(e){return-Math.exp(-e)}function aPe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function lPe(e){return e===10?aPe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function cPe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function dae(e){return(t,r)=>-e(-t,r)}function Xw(e){let t=e(fae,hae),r=t.domain,n=10,o,i;function s(){return o=cPe(n),i=lPe(n),r()[0]<0?(o=dae(o),i=dae(i),e(oPe,sPe)):e(fae,hae),t}return t.base=function(a){return arguments.length?(n=+a,s()):n},t.domain=function(a){return arguments.length?(r(a),s()):r()},t.ticks=a=>{let u=r(),h=u[0],p=u[u.length-1],_=p<h;_&&([h,p]=[p,h]);let y=o(h),A=o(p),E,k,P=a==null?10:+a,R=[];if(!(n%1)&&A-y<P){if(y=Math.floor(y),A=Math.ceil(A),h>0){for(;y<=A;++y)for(E=1;E<n;++E)if(k=y<0?E/i(-y):E*i(y),!(k<h)){if(k>p)break;R.push(k)}}else for(;y<=A;++y)for(E=n-1;E>=1;--E)if(k=y>0?E/i(-y):E*i(y),!(k<h)){if(k>p)break;R.push(k)}R.length*2<P&&(R=la(h,p,P))}else R=la(y,A,Math.min(A-y,P)).map(i);return _?R.reverse():R},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=n===10?"s":","),typeof u!="function"&&(!(n%1)&&(u=Ec(u)).precision==null&&(u.trim=!0),u=Ic(u)),a===1/0)return u;let h=Math.max(1,n*a/t.ticks().length);return p=>{let _=p/i(Math.round(o(p)));return _*n<n-.5&&(_*=n),_<=h?u(p):""}},t.nice=()=>r(Hw(r(),{floor:a=>i(Math.floor(o(a))),ceil:a=>i(Math.ceil(o(a)))})),t}function Kw(){let e=Xw(Wg()).domain([1,10]);return e.copy=()=>Lu(e,Kw()).base(e.base()),Yi.apply(e,arguments),e}var GI=W(()=>{ki();RE();HL();Fu();Ws()});function pae(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function mae(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function $w(e){var t=1,r=e(pae(t),mae(t));return r.constant=function(n){return arguments.length?e(pae(t=+n),mae(t)):t},ga(r)}function Qw(){var e=$w(Wg());return e.copy=function(){return Lu(e,Qw()).constant(e.constant())},Yi.apply(e,arguments)}var HI=W(()=>{fh();Fu();Ws()});function gae(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function uPe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function fPe(e){return e<0?-e*e:e*e}function Jw(e){var t=e(Zo,Zo),r=1;function n(){return r===1?e(Zo,Zo):r===.5?e(uPe,fPe):e(gae(r),gae(1/r))}return t.exponent=function(o){return arguments.length?(r=+o,n()):r},ga(t)}function Wy(){var e=Jw(Wg());return e.copy=function(){return Lu(e,Wy()).exponent(e.exponent())},Yi.apply(e,arguments),e}function XL(){return Wy.apply(null,arguments).exponent(.5)}var XI=W(()=>{fh();Fu();Ws()});function _ae(e){return Math.sign(e)*e*e}function hPe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function e2(){var e=Zg(),t=[0,1],r=!1,n;function o(i){var s=hPe(e(i));return isNaN(s)?n:r?Math.round(s):s}return o.invert=function(i){return e.invert(_ae(i))},o.domain=function(i){return arguments.length?(e.domain(i),o):e.domain()},o.range=function(i){return arguments.length?(e.range((t=Array.from(i,op)).map(_ae)),o):t.slice()},o.rangeRound=function(i){return o.range(i).round(!0)},o.round=function(i){return arguments.length?(r=!!i,o):r},o.clamp=function(i){return arguments.length?(e.clamp(i),o):e.clamp()},o.unknown=function(i){return arguments.length?(n=i,o):n},o.copy=function(){return e2(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Yi.apply(o,arguments),ga(o)}var yae=W(()=>{Fu();Ws();fh();qI()});function t2(){var e=[],t=[],r=[],n;function o(){var s=0,a=Math.max(1,t.length);for(r=new Array(a-1);++s<a;)r[s-1]=I1(e,s/a);return i}function i(s){return s==null||isNaN(s=+s)?n:t[sa(r,s)]}return i.invertExtent=function(s){var a=t.indexOf(s);return a<0?[NaN,NaN]:[a>0?r[a-1]:e[0],a<r.length?r[a]:e[e.length-1]]},i.domain=function(s){if(!arguments.length)return e.slice();e=[];for(let a of s)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Un),o()},i.range=function(s){return arguments.length?(t=Array.from(s),o()):t.slice()},i.unknown=function(s){return arguments.length?(n=s,i):n},i.quantiles=function(){return r.slice()},i.copy=function(){return t2().domain(e).range(t).unknown(n)},Yi.apply(i,arguments)}var xae=W(()=>{ki();Ws()});function r2(){var e=0,t=1,r=1,n=[.5],o=[0,1],i;function s(u){return u!=null&&u<=u?o[sa(n,u,0,r)]:i}function a(){var u=-1;for(n=new Array(r);++u<r;)n[u]=((u+1)*t-(u-r)*e)/(r+1);return s}return s.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},s.range=function(u){return arguments.length?(r=(o=Array.from(u)).length-1,a()):o.slice()},s.invertExtent=function(u){var h=o.indexOf(u);return h<0?[NaN,NaN]:h<1?[e,n[0]]:h>=r?[n[r-1],t]:[n[h-1],n[h]]},s.unknown=function(u){return arguments.length&&(i=u),s},s.thresholds=function(){return n.slice()},s.copy=function(){return r2().domain([e,t]).range(o).unknown(i)},Yi.apply(ga(s),arguments)}var bae=W(()=>{ki();fh();Ws()});function n2(){var e=[.5],t=[0,1],r,n=1;function o(i){return i!=null&&i<=i?t[sa(e,i,0,n)]:r}return o.domain=function(i){return arguments.length?(e=Array.from(i),n=Math.min(e.length,t.length-1),o):e.slice()},o.range=function(i){return arguments.length?(t=Array.from(i),n=Math.min(e.length,t.length-1),o):t.slice()},o.invertExtent=function(i){var s=t.indexOf(i);return[e[s-1],e[s]]},o.unknown=function(i){return arguments.length?(r=i,o):r},o.copy=function(){return n2().domain(e).range(t).unknown(r)},Yi.apply(o,arguments)}var vae=W(()=>{ki();Ws()});function ui(e,t,r,n){function o(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return o.floor=i=>(e(i=new Date(+i)),i),o.ceil=i=>(e(i=new Date(i-1)),t(i,1),e(i),i),o.round=i=>{let s=o(i),a=o.ceil(i);return i-s<a-i?s:a},o.offset=(i,s)=>(t(i=new Date(+i),s==null?1:Math.floor(s)),i),o.range=(i,s,a)=>{let u=[];if(i=o.ceil(i),a=a==null?1:Math.floor(a),!(i<s)||!(a>0))return u;let h;do u.push(h=new Date(+i)),t(i,a),e(i);while(h<i&&i<s);return u},o.filter=i=>ui(s=>{if(s>=s)for(;e(s),!i(s);)s.setTime(s-1)},(s,a)=>{if(s>=s)if(a<0)for(;++a<=0;)for(;t(s,-1),!i(s););else for(;--a>=0;)for(;t(s,1),!i(s););}),r&&(o.count=(i,s)=>(KL.setTime(+i),$L.setTime(+s),e(KL),e($L),Math.floor(r(KL,$L))),o.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?o.filter(n?s=>n(s)%i===0:s=>o.count(0,s)%i===0):o)),o}var KL,$L,Bu=W(()=>{KL=new Date,$L=new Date});var hh,KI,QL=W(()=>{Bu();hh=ui(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);hh.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ui(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):hh);KI=hh.range});var La,$I,JL=W(()=>{Bu();La=ui(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*1e3)},(e,t)=>(t-e)/1e3,e=>e.getUTCSeconds()),$I=La.range});var sp,eF,ap,tF,rF=W(()=>{Bu();sp=ui(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getMinutes()),eF=sp.range,ap=ui(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*6e4)},(e,t)=>(t-e)/6e4,e=>e.getUTCMinutes()),tF=ap.range});var lp,nF,cp,iF,oF=W(()=>{Bu();lp=ui(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*1e3-e.getMinutes()*6e4)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getHours()),nF=lp.range,cp=ui(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*36e5)},(e,t)=>(t-e)/36e5,e=>e.getUTCHours()),iF=cp.range});var Rc,sF,dh,aF,Zy,lF,cF=W(()=>{Bu();Rc=ui(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*6e4)/864e5,e=>e.getDate()-1),sF=Rc.range,dh=ui(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>e.getUTCDate()-1),aF=dh.range,Zy=ui(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/864e5,e=>Math.floor(e/864e5)),lF=Zy.range});function Gg(e){return ui(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}function Hg(e){return ui(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/6048e5)}var Nc,up,QI,JI,Uu,eC,tC,rC,uF,fF,hF,dF,pF,mF,zc,fp,nC,iC,Vu,oC,sC,aC,gF,_F,yF,xF,bF,vF,wF=W(()=>{Bu();Nc=Gg(0),up=Gg(1),QI=Gg(2),JI=Gg(3),Uu=Gg(4),eC=Gg(5),tC=Gg(6),rC=Nc.range,uF=up.range,fF=QI.range,hF=JI.range,dF=Uu.range,pF=eC.range,mF=tC.range;zc=Hg(0),fp=Hg(1),nC=Hg(2),iC=Hg(3),Vu=Hg(4),oC=Hg(5),sC=Hg(6),aC=zc.range,gF=fp.range,_F=nC.range,yF=iC.range,xF=Vu.range,bF=oC.range,vF=sC.range});var hp,AF,dp,MF,SF=W(()=>{Bu();hp=ui(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth()),AF=hp.range,dp=ui(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth()),MF=dp.range});var _a,TF,ya,EF,IF=W(()=>{Bu();_a=ui(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());_a.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ui(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});TF=_a.range,ya=ui(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());ya.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ui(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});EF=ya.range});function Mae(e,t,r,n,o,i){let s=[[La,1,1e3],[La,5,5*1e3],[La,15,15*1e3],[La,30,30*1e3],[i,1,6e4],[i,5,5*6e4],[i,15,15*6e4],[i,30,30*6e4],[o,1,36e5],[o,3,3*36e5],[o,6,6*36e5],[o,12,12*36e5],[n,1,864e5],[n,2,2*864e5],[r,1,6048e5],[t,1,2592e6],[t,3,3*2592e6],[e,1,31536e6]];function a(h,p,_){let y=p<h;y&&([h,p]=[p,h]);let A=_&&typeof _.range=="function"?_:u(h,p,_),E=A?A.range(h,+p+1):[];return y?E.reverse():E}function u(h,p,_){let y=Math.abs(p-h)/_,A=qf(([,,P])=>P).right(s,y);if(A===s.length)return e.every(kd(h/31536e6,p/31536e6,_));if(A===0)return hh.every(Math.max(kd(h,p,_),1));let[E,k]=s[y/s[A-1][2]<s[A][2]/y?A-1:A];return E.every(k)}return[a,u]}var o2,s2,a2,l2,Sae=W(()=>{ki();QL();JL();rF();oF();cF();wF();SF();IF();[o2,s2]=Mae(ya,dp,zc,Zy,cp,ap),[a2,l2]=Mae(_a,hp,Nc,Rc,lp,sp)});var Tae={};io(Tae,{timeDay:()=>Rc,timeDays:()=>sF,timeFriday:()=>eC,timeFridays:()=>pF,timeHour:()=>lp,timeHours:()=>nF,timeInterval:()=>ui,timeMillisecond:()=>hh,timeMilliseconds:()=>KI,timeMinute:()=>sp,timeMinutes:()=>eF,timeMonday:()=>up,timeMondays:()=>uF,timeMonth:()=>hp,timeMonths:()=>AF,timeSaturday:()=>tC,timeSaturdays:()=>mF,timeSecond:()=>La,timeSeconds:()=>$I,timeSunday:()=>Nc,timeSundays:()=>rC,timeThursday:()=>Uu,timeThursdays:()=>dF,timeTickInterval:()=>l2,timeTicks:()=>a2,timeTuesday:()=>QI,timeTuesdays:()=>fF,timeWednesday:()=>JI,timeWednesdays:()=>hF,timeWeek:()=>Nc,timeWeeks:()=>rC,timeYear:()=>_a,timeYears:()=>TF,unixDay:()=>Zy,unixDays:()=>lF,utcDay:()=>dh,utcDays:()=>aF,utcFriday:()=>oC,utcFridays:()=>bF,utcHour:()=>cp,utcHours:()=>iF,utcMillisecond:()=>hh,utcMilliseconds:()=>KI,utcMinute:()=>ap,utcMinutes:()=>tF,utcMonday:()=>fp,utcMondays:()=>gF,utcMonth:()=>dp,utcMonths:()=>MF,utcSaturday:()=>sC,utcSaturdays:()=>vF,utcSecond:()=>La,utcSeconds:()=>$I,utcSunday:()=>zc,utcSundays:()=>aC,utcThursday:()=>Vu,utcThursdays:()=>xF,utcTickInterval:()=>s2,utcTicks:()=>o2,utcTuesday:()=>nC,utcTuesdays:()=>_F,utcWednesday:()=>iC,utcWednesdays:()=>yF,utcWeek:()=>zc,utcWeeks:()=>aC,utcYear:()=>ya,utcYears:()=>EF});var Yy=W(()=>{Bu();QL();JL();rF();oF();cF();wF();SF();IF();Sae()});function CF(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function kF(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function c2(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function h2(e){var t=e.dateTime,r=e.date,n=e.time,o=e.periods,i=e.days,s=e.shortDays,a=e.months,u=e.shortMonths,h=u2(o),p=f2(o),_=u2(i),y=f2(i),A=u2(s),E=f2(s),k=u2(a),P=f2(a),R=u2(u),V=f2(u),N={a:Je,A:gt,b:rt,B:At,c:null,d:Oae,e:Oae,f:DPe,g:qPe,G:HPe,H:RPe,I:NPe,j:zPe,L:Lae,m:LPe,M:FPe,p:St,q:kt,Q:zae,s:Dae,S:BPe,u:jPe,U:UPe,V:VPe,w:WPe,W:ZPe,x:null,X:null,y:YPe,Y:GPe,Z:XPe,"%":Nae},j={a:yt,A:tr,b:vr,B:wr,c:null,d:Rae,e:Rae,f:JPe,g:cOe,G:fOe,H:KPe,I:$Pe,j:QPe,L:Bae,m:eOe,M:tOe,p:Ir,q:Br,Q:zae,s:Dae,S:rOe,u:nOe,U:iOe,V:oOe,w:sOe,W:aOe,x:null,X:null,y:lOe,Y:uOe,Z:hOe,"%":Nae},J={a:ve,A:be,b:je,B:Re,c:Se,d:kae,e:kae,f:CPe,g:Cae,G:Iae,H:Pae,I:Pae,j:SPe,L:IPe,m:MPe,M:TPe,p:ye,q:APe,Q:PPe,s:OPe,S:EPe,u:yPe,U:xPe,V:bPe,w:_Pe,W:vPe,x:Ue,X:qe,y:Cae,Y:Iae,Z:wPe,"%":kPe};N.x=ne(r,N),N.X=ne(n,N),N.c=ne(t,N),j.x=ne(r,j),j.X=ne(n,j),j.c=ne(t,j);function ne(qt,Lr){return function(Yr){var Rt=[],bn=-1,tn=0,sr=qt.length,Rn,dr,xt;for(Yr instanceof Date||(Yr=new Date(+Yr));++bn<sr;)qt.charCodeAt(bn)===37&&(Rt.push(qt.slice(tn,bn)),(dr=Eae[Rn=qt.charAt(++bn)])!=null?Rn=qt.charAt(++bn):dr=Rn==="e"?" ":"0",(xt=Lr[Rn])&&(Rn=xt(Yr,dr)),Rt.push(Rn),tn=bn+1);return Rt.push(qt.slice(tn,bn)),Rt.join("")}}function de(qt,Lr){return function(Yr){var Rt=c2(1900,void 0,1),bn=fe(Rt,qt,Yr+="",0),tn,sr;if(bn!=Yr.length)return null;if("Q"in Rt)return new Date(Rt.Q);if("s"in Rt)return new Date(Rt.s*1e3+("L"in Rt?Rt.L:0));if(Lr&&!("Z"in Rt)&&(Rt.Z=0),"p"in Rt&&(Rt.H=Rt.H%12+Rt.p*12),Rt.m===void 0&&(Rt.m="q"in Rt?Rt.q:0),"V"in Rt){if(Rt.V<1||Rt.V>53)return null;"w"in Rt||(Rt.w=1),"Z"in Rt?(tn=kF(c2(Rt.y,0,1)),sr=tn.getUTCDay(),tn=sr>4||sr===0?fp.ceil(tn):fp(tn),tn=dh.offset(tn,(Rt.V-1)*7),Rt.y=tn.getUTCFullYear(),Rt.m=tn.getUTCMonth(),Rt.d=tn.getUTCDate()+(Rt.w+6)%7):(tn=CF(c2(Rt.y,0,1)),sr=tn.getDay(),tn=sr>4||sr===0?up.ceil(tn):up(tn),tn=Rc.offset(tn,(Rt.V-1)*7),Rt.y=tn.getFullYear(),Rt.m=tn.getMonth(),Rt.d=tn.getDate()+(Rt.w+6)%7)}else("W"in Rt||"U"in Rt)&&("w"in Rt||(Rt.w="u"in Rt?Rt.u%7:"W"in Rt?1:0),sr="Z"in Rt?kF(c2(Rt.y,0,1)).getUTCDay():CF(c2(Rt.y,0,1)).getDay(),Rt.m=0,Rt.d="W"in Rt?(Rt.w+6)%7+Rt.W*7-(sr+5)%7:Rt.w+Rt.U*7-(sr+6)%7);return"Z"in Rt?(Rt.H+=Rt.Z/100|0,Rt.M+=Rt.Z%100,kF(Rt)):CF(Rt)}}function fe(qt,Lr,Yr,Rt){for(var bn=0,tn=Lr.length,sr=Yr.length,Rn,dr;bn<tn;){if(Rt>=sr)return-1;if(Rn=Lr.charCodeAt(bn++),Rn===37){if(Rn=Lr.charAt(bn++),dr=J[Rn in Eae?Lr.charAt(bn++):Rn],!dr||(Rt=dr(qt,Yr,Rt))<0)return-1}else if(Rn!=Yr.charCodeAt(Rt++))return-1}return Rt}function ye(qt,Lr,Yr){var Rt=h.exec(Lr.slice(Yr));return Rt?(qt.p=p.get(Rt[0].toLowerCase()),Yr+Rt[0].length):-1}function ve(qt,Lr,Yr){var Rt=A.exec(Lr.slice(Yr));return Rt?(qt.w=E.get(Rt[0].toLowerCase()),Yr+Rt[0].length):-1}function be(qt,Lr,Yr){var Rt=_.exec(Lr.slice(Yr));return Rt?(qt.w=y.get(Rt[0].toLowerCase()),Yr+Rt[0].length):-1}function je(qt,Lr,Yr){var Rt=R.exec(Lr.slice(Yr));return Rt?(qt.m=V.get(Rt[0].toLowerCase()),Yr+Rt[0].length):-1}function Re(qt,Lr,Yr){var Rt=k.exec(Lr.slice(Yr));return Rt?(qt.m=P.get(Rt[0].toLowerCase()),Yr+Rt[0].length):-1}function Se(qt,Lr,Yr){return fe(qt,t,Lr,Yr)}function Ue(qt,Lr,Yr){return fe(qt,r,Lr,Yr)}function qe(qt,Lr,Yr){return fe(qt,n,Lr,Yr)}function Je(qt){return s[qt.getDay()]}function gt(qt){return i[qt.getDay()]}function rt(qt){return u[qt.getMonth()]}function At(qt){return a[qt.getMonth()]}function St(qt){return o[+(qt.getHours()>=12)]}function kt(qt){return 1+~~(qt.getMonth()/3)}function yt(qt){return s[qt.getUTCDay()]}function tr(qt){return i[qt.getUTCDay()]}function vr(qt){return u[qt.getUTCMonth()]}function wr(qt){return a[qt.getUTCMonth()]}function Ir(qt){return o[+(qt.getUTCHours()>=12)]}function Br(qt){return 1+~~(qt.getUTCMonth()/3)}return{format:function(qt){var Lr=ne(qt+="",N);return Lr.toString=function(){return qt},Lr},parse:function(qt){var Lr=de(qt+="",!1);return Lr.toString=function(){return qt},Lr},utcFormat:function(qt){var Lr=ne(qt+="",j);return Lr.toString=function(){return qt},Lr},utcParse:function(qt){var Lr=de(qt+="",!0);return Lr.toString=function(){return qt},Lr}}}function ni(e,t,r){var n=e<0?"-":"",o=(n?-e:e)+"",i=o.length;return n+(i<r?new Array(r-i+1).join(t)+o:o)}function gPe(e){return e.replace(mPe,"\\$&")}function u2(e){return new RegExp("^(?:"+e.map(gPe).join("|")+")","i")}function f2(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function _Pe(e,t,r){var n=as.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function yPe(e,t,r){var n=as.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function xPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function bPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function vPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function Iae(e,t,r){var n=as.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function Cae(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function wPe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function APe(e,t,r){var n=as.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function MPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function kae(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function SPe(e,t,r){var n=as.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Pae(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function TPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function EPe(e,t,r){var n=as.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function IPe(e,t,r){var n=as.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function CPe(e,t,r){var n=as.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function kPe(e,t,r){var n=pPe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function PPe(e,t,r){var n=as.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function OPe(e,t,r){var n=as.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Oae(e,t){return ni(e.getDate(),t,2)}function RPe(e,t){return ni(e.getHours(),t,2)}function NPe(e,t){return ni(e.getHours()%12||12,t,2)}function zPe(e,t){return ni(1+Rc.count(_a(e),e),t,3)}function Lae(e,t){return ni(e.getMilliseconds(),t,3)}function DPe(e,t){return Lae(e,t)+"000"}function LPe(e,t){return ni(e.getMonth()+1,t,2)}function FPe(e,t){return ni(e.getMinutes(),t,2)}function BPe(e,t){return ni(e.getSeconds(),t,2)}function jPe(e){var t=e.getDay();return t===0?7:t}function UPe(e,t){return ni(Nc.count(_a(e)-1,e),t,2)}function Fae(e){var t=e.getDay();return t>=4||t===0?Uu(e):Uu.ceil(e)}function VPe(e,t){return e=Fae(e),ni(Uu.count(_a(e),e)+(_a(e).getDay()===4),t,2)}function WPe(e){return e.getDay()}function ZPe(e,t){return ni(up.count(_a(e)-1,e),t,2)}function YPe(e,t){return ni(e.getFullYear()%100,t,2)}function qPe(e,t){return e=Fae(e),ni(e.getFullYear()%100,t,2)}function GPe(e,t){return ni(e.getFullYear()%1e4,t,4)}function HPe(e,t){var r=e.getDay();return e=r>=4||r===0?Uu(e):Uu.ceil(e),ni(e.getFullYear()%1e4,t,4)}function XPe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ni(t/60|0,"0",2)+ni(t%60,"0",2)}function Rae(e,t){return ni(e.getUTCDate(),t,2)}function KPe(e,t){return ni(e.getUTCHours(),t,2)}function $Pe(e,t){return ni(e.getUTCHours()%12||12,t,2)}function QPe(e,t){return ni(1+dh.count(ya(e),e),t,3)}function Bae(e,t){return ni(e.getUTCMilliseconds(),t,3)}function JPe(e,t){return Bae(e,t)+"000"}function eOe(e,t){return ni(e.getUTCMonth()+1,t,2)}function tOe(e,t){return ni(e.getUTCMinutes(),t,2)}function rOe(e,t){return ni(e.getUTCSeconds(),t,2)}function nOe(e){var t=e.getUTCDay();return t===0?7:t}function iOe(e,t){return ni(zc.count(ya(e)-1,e),t,2)}function jae(e){var t=e.getUTCDay();return t>=4||t===0?Vu(e):Vu.ceil(e)}function oOe(e,t){return e=jae(e),ni(Vu.count(ya(e),e)+(ya(e).getUTCDay()===4),t,2)}function sOe(e){return e.getUTCDay()}function aOe(e,t){return ni(fp.count(ya(e)-1,e),t,2)}function lOe(e,t){return ni(e.getUTCFullYear()%100,t,2)}function cOe(e,t){return e=jae(e),ni(e.getUTCFullYear()%100,t,2)}function uOe(e,t){return ni(e.getUTCFullYear()%1e4,t,4)}function fOe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Vu(e):Vu.ceil(e),ni(e.getUTCFullYear()%1e4,t,4)}function hOe(){return"+0000"}function Nae(){return"%"}function zae(e){return+e}function Dae(e){return Math.floor(+e/1e3)}var Eae,as,pPe,mPe,PF=W(()=>{Yy();Eae={"-":"",_:" ",0:"0"},as=/^\s*\d+/,pPe=/^%/,mPe=/[\\^$*+?|[\]().{}]/g});function lC(e){return qy=h2(e),d2=qy.format,OF=qy.parse,Xg=qy.utcFormat,p2=qy.utcParse,qy}var qy,d2,OF,Xg,p2,cC=W(()=>{PF();lC({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})});function dOe(e){return e.toISOString()}var RF,pOe,Uae,NF=W(()=>{cC();RF="%Y-%m-%dT%H:%M:%S.%LZ";pOe=Date.prototype.toISOString?dOe:Xg(RF),Uae=pOe});function mOe(e){var t=new Date(e);return isNaN(t)?null:t}var gOe,Vae,Wae=W(()=>{NF();cC();gOe=+new Date("2000-01-01T00:00:00.000Z")?mOe:p2(RF),Vae=gOe});var uC=W(()=>{cC();PF();NF();Wae()});function _Oe(e){return new Date(e)}function yOe(e){return e instanceof Date?+e:+new Date(+e)}function fC(e,t,r,n,o,i,s,a,u,h){var p=Zg(),_=p.invert,y=p.domain,A=h(".%L"),E=h(":%S"),k=h("%I:%M"),P=h("%I %p"),R=h("%a %d"),V=h("%b %d"),N=h("%B"),j=h("%Y");function J(ne){return(u(ne)<ne?A:a(ne)<ne?E:s(ne)<ne?k:i(ne)<ne?P:n(ne)<ne?o(ne)<ne?R:V:r(ne)<ne?N:j)(ne)}return p.invert=function(ne){return new Date(_(ne))},p.domain=function(ne){return arguments.length?y(Array.from(ne,yOe)):y().map(_Oe)},p.ticks=function(ne){var de=y();return e(de[0],de[de.length-1],ne??10)},p.tickFormat=function(ne,de){return de==null?J:h(de)},p.nice=function(ne){var de=y();return(!ne||typeof ne.range!="function")&&(ne=t(de[0],de[de.length-1],ne??10)),ne?y(Hw(de,ne)):p},p.copy=function(){return Lu(p,fC(e,t,r,n,o,i,s,a,u,h))},p}function Gy(){return Yi.apply(fC(a2,l2,_a,hp,Nc,Rc,lp,sp,La,d2).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}var zF=W(()=>{Yy();uC();Fu();Ws();HL()});function hC(){return Yi.apply(fC(o2,s2,ya,dp,zc,dh,cp,ap,La,Xg).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}var Zae=W(()=>{Yy();uC();zF();Ws()});function dC(){var e=0,t=1,r,n,o,i,s=Zo,a=!1,u;function h(_){return _==null||isNaN(_=+_)?u:s(o===0?.5:(_=(i(_)-r)*o,a?Math.max(0,Math.min(1,_)):_))}h.domain=function(_){return arguments.length?([e,t]=_,r=i(e=+e),n=i(t=+t),o=r===n?0:1/(n-r),h):[e,t]},h.clamp=function(_){return arguments.length?(a=!!_,h):a},h.interpolator=function(_){return arguments.length?(s=_,h):s};function p(_){return function(y){var A,E;return arguments.length?([A,E]=y,s=_(A,E),h):[s(0),s(1)]}}return h.range=p($i),h.rangeRound=p(Yd),h.unknown=function(_){return arguments.length?(u=_,h):u},function(_){return i=_,r=_(e),n=_(t),o=r===n?0:1/(n-r),h}}function ph(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function mh(){var e=ga(dC()(Zo));return e.copy=function(){return ph(e,mh())},Ul.apply(e,arguments)}function pC(){var e=Xw(dC()).domain([1,10]);return e.copy=function(){return ph(e,pC()).base(e.base())},Ul.apply(e,arguments)}function mC(){var e=$w(dC());return e.copy=function(){return ph(e,mC()).constant(e.constant())},Ul.apply(e,arguments)}function m2(){var e=Jw(dC());return e.copy=function(){return ph(e,m2()).exponent(e.exponent())},Ul.apply(e,arguments)}function DF(){return m2.apply(null,arguments).exponent(.5)}var LF=W(()=>{nl();Fu();Ws();fh();GI();HI();XI()});function g2(){var e=[],t=Zo;function r(n){if(n!=null&&!isNaN(n=+n))return t((sa(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let o of n)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Un),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,o)=>t(o/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(o,i)=>bc(e,i/n))},r.copy=function(){return g2(t).domain(e)},Ul.apply(r,arguments)}var Yae=W(()=>{ki();Fu();Ws()});function gC(){var e=0,t=.5,r=1,n=1,o,i,s,a,u,h=Zo,p,_=!1,y;function A(k){return isNaN(k=+k)?y:(k=.5+((k=+p(k))-i)*(n*k<n*i?a:u),h(_?Math.max(0,Math.min(1,k)):k))}A.domain=function(k){return arguments.length?([e,t,r]=k,o=p(e=+e),i=p(t=+t),s=p(r=+r),a=o===i?0:.5/(i-o),u=i===s?0:.5/(s-i),n=i<o?-1:1,A):[e,t,r]},A.clamp=function(k){return arguments.length?(_=!!k,A):_},A.interpolator=function(k){return arguments.length?(h=k,A):h};function E(k){return function(P){var R,V,N;return arguments.length?([R,V,N]=P,h=Y1(k,[R,V,N]),A):[h(0),h(.5),h(1)]}}return A.range=E($i),A.rangeRound=E(Yd),A.unknown=function(k){return arguments.length?(y=k,A):y},function(k){return p=k,o=k(e),i=k(t),s=k(r),a=o===i?0:.5/(i-o),u=i===s?0:.5/(s-i),n=i<o?-1:1,A}}function _2(){var e=ga(gC()(Zo));return e.copy=function(){return ph(e,_2())},Ul.apply(e,arguments)}function _C(){var e=Xw(gC()).domain([.1,1,10]);return e.copy=function(){return ph(e,_C()).base(e.base())},Ul.apply(e,arguments)}function yC(){var e=$w(gC());return e.copy=function(){return ph(e,yC()).constant(e.constant())},Ul.apply(e,arguments)}function y2(){var e=Jw(gC());return e.copy=function(){return ph(e,y2()).exponent(e.exponent())},Ul.apply(e,arguments)}function FF(){return y2.apply(null,arguments).exponent(.5)}var qae=W(()=>{nl();Fu();Ws();fh();GI();LF();HI();XI()});var Gae={};io(Gae,{scaleBand:()=>Vl,scaleDiverging:()=>_2,scaleDivergingLog:()=>_C,scaleDivergingPow:()=>y2,scaleDivergingSqrt:()=>FF,scaleDivergingSymlog:()=>yC,scaleIdentity:()=>Gw,scaleImplicit:()=>qw,scaleLinear:()=>Oc,scaleLog:()=>Kw,scaleOrdinal:()=>sl,scalePoint:()=>ZL,scalePow:()=>Wy,scaleQuantile:()=>t2,scaleQuantize:()=>r2,scaleRadial:()=>e2,scaleSequential:()=>mh,scaleSequentialLog:()=>pC,scaleSequentialPow:()=>m2,scaleSequentialQuantile:()=>g2,scaleSequentialSqrt:()=>DF,scaleSequentialSymlog:()=>mC,scaleSqrt:()=>XL,scaleSymlog:()=>Qw,scaleThreshold:()=>n2,scaleTime:()=>Gy,scaleUtc:()=>hC,tickFormat:()=>Vy});var BF=W(()=>{aae();uae();fh();GI();HI();WL();XI();yae();xae();bae();vae();zF();Zae();LF();Yae();qae();GL()});function gr(e){for(var t=e.length/6|0,r=new Array(t),n=0;n<t;)r[n]="#"+e.slice(n*6,++n*6);return r}var On=W(()=>{});var jF,Hae=W(()=>{On();jF=gr("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf")});var UF,Xae=W(()=>{On();UF=gr("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666")});var VF,Kae=W(()=>{On();VF=gr("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666")});var WF,$ae=W(()=>{On();WF=gr("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0")});var ZF,Qae=W(()=>{On();ZF=gr("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928")});var YF,Jae=W(()=>{On();YF=gr("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2")});var qF,ele=W(()=>{On();qF=gr("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc")});var GF,tle=W(()=>{On();GF=gr("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999")});var HF,rle=W(()=>{On();HF=gr("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3")});var XF,nle=W(()=>{On();XF=gr("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f")});var KF,ile=W(()=>{On();KF=gr("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab")});var nn,wi=W(()=>{nl();nn=e=>q3(e[e.length-1])});var xC,$F,ole=W(()=>{On();wi();xC=new Array(3).concat("d8b365f5f5f55ab4ac","a6611adfc27d80cdc1018571","a6611adfc27df5f5f580cdc1018571","8c510ad8b365f6e8c3c7eae55ab4ac01665e","8c510ad8b365f6e8c3f5f5f5c7eae55ab4ac01665e","8c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e","8c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e","5430058c510abf812ddfc27df6e8c3c7eae580cdc135978f01665e003c30","5430058c510abf812ddfc27df6e8c3f5f5f5c7eae580cdc135978f01665e003c30").map(gr),$F=nn(xC)});var bC,QF,sle=W(()=>{On();wi();bC=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(gr),QF=nn(bC)});var vC,JF,ale=W(()=>{On();wi();vC=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(gr),JF=nn(vC)});var wC,e9,lle=W(()=>{On();wi();wC=new Array(3).concat("998ec3f7f7f7f1a340","5e3c99b2abd2fdb863e66101","5e3c99b2abd2f7f7f7fdb863e66101","542788998ec3d8daebfee0b6f1a340b35806","542788998ec3d8daebf7f7f7fee0b6f1a340b35806","5427888073acb2abd2d8daebfee0b6fdb863e08214b35806","5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b35806","2d004b5427888073acb2abd2d8daebfee0b6fdb863e08214b358067f3b08","2d004b5427888073acb2abd2d8daebf7f7f7fee0b6fdb863e08214b358067f3b08").map(gr),e9=nn(wC)});var AC,t9,cle=W(()=>{On();wi();AC=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(gr),t9=nn(AC)});var MC,r9,ule=W(()=>{On();wi();MC=new Array(3).concat("ef8a62ffffff999999","ca0020f4a582bababa404040","ca0020f4a582ffffffbababa404040","b2182bef8a62fddbc7e0e0e09999994d4d4d","b2182bef8a62fddbc7ffffffe0e0e09999994d4d4d","b2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d","b2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d","67001fb2182bd6604df4a582fddbc7e0e0e0bababa8787874d4d4d1a1a1a","67001fb2182bd6604df4a582fddbc7ffffffe0e0e0bababa8787874d4d4d1a1a1a").map(gr),r9=nn(MC)});var SC,n9,fle=W(()=>{On();wi();SC=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(gr),n9=nn(SC)});var TC,i9,hle=W(()=>{On();wi();TC=new Array(3).concat("fc8d59ffffbf91cf60","d7191cfdae61a6d96a1a9641","d7191cfdae61ffffbfa6d96a1a9641","d73027fc8d59fee08bd9ef8b91cf601a9850","d73027fc8d59fee08bffffbfd9ef8b91cf601a9850","d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850","d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850","a50026d73027f46d43fdae61fee08bd9ef8ba6d96a66bd631a9850006837","a50026d73027f46d43fdae61fee08bffffbfd9ef8ba6d96a66bd631a9850006837").map(gr),i9=nn(TC)});var EC,x2,dle=W(()=>{On();wi();EC=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(gr),x2=nn(EC)});var IC,o9,ple=W(()=>{On();wi();IC=new Array(3).concat("e5f5f999d8c92ca25f","edf8fbb2e2e266c2a4238b45","edf8fbb2e2e266c2a42ca25f006d2c","edf8fbccece699d8c966c2a42ca25f006d2c","edf8fbccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45005824","f7fcfde5f5f9ccece699d8c966c2a441ae76238b45006d2c00441b").map(gr),o9=nn(IC)});var CC,s9,mle=W(()=>{On();wi();CC=new Array(3).concat("e0ecf49ebcda8856a7","edf8fbb3cde38c96c688419d","edf8fbb3cde38c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68856a7810f7c","edf8fbbfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d6e016b","f7fcfde0ecf4bfd3e69ebcda8c96c68c6bb188419d810f7c4d004b").map(gr),s9=nn(CC)});var kC,a9,gle=W(()=>{On();wi();kC=new Array(3).concat("e0f3dba8ddb543a2ca","f0f9e8bae4bc7bccc42b8cbe","f0f9e8bae4bc7bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc443a2ca0868ac","f0f9e8ccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe08589e","f7fcf0e0f3dbccebc5a8ddb57bccc44eb3d32b8cbe0868ac084081").map(gr),a9=nn(kC)});var PC,l9,_le=W(()=>{On();wi();PC=new Array(3).concat("fee8c8fdbb84e34a33","fef0d9fdcc8afc8d59d7301f","fef0d9fdcc8afc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59e34a33b30000","fef0d9fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301f990000","fff7ecfee8c8fdd49efdbb84fc8d59ef6548d7301fb300007f0000").map(gr),l9=nn(PC)});var OC,c9,yle=W(()=>{On();wi();OC=new Array(3).concat("ece2f0a6bddb1c9099","f6eff7bdc9e167a9cf02818a","f6eff7bdc9e167a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf1c9099016c59","f6eff7d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016450","fff7fbece2f0d0d1e6a6bddb67a9cf3690c002818a016c59014636").map(gr),c9=nn(OC)});var RC,u9,xle=W(()=>{On();wi();RC=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(gr),u9=nn(RC)});var NC,f9,ble=W(()=>{On();wi();NC=new Array(3).concat("e7e1efc994c7dd1c77","f1eef6d7b5d8df65b0ce1256","f1eef6d7b5d8df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0dd1c77980043","f1eef6d4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125691003f","f7f4f9e7e1efd4b9dac994c7df65b0e7298ace125698004367001f").map(gr),f9=nn(NC)});var zC,h9,vle=W(()=>{On();wi();zC=new Array(3).concat("fde0ddfa9fb5c51b8a","feebe2fbb4b9f768a1ae017e","feebe2fbb4b9f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1c51b8a7a0177","feebe2fcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a0177","fff7f3fde0ddfcc5c0fa9fb5f768a1dd3497ae017e7a017749006a").map(gr),h9=nn(zC)});var DC,d9,wle=W(()=>{On();wi();DC=new Array(3).concat("edf8b17fcdbb2c7fb8","ffffcca1dab441b6c4225ea8","ffffcca1dab441b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c42c7fb8253494","ffffccc7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea80c2c84","ffffd9edf8b1c7e9b47fcdbb41b6c41d91c0225ea8253494081d58").map(gr),d9=nn(DC)});var LC,p9,Ale=W(()=>{On();wi();LC=new Array(3).concat("f7fcb9addd8e31a354","ffffccc2e69978c679238443","ffffccc2e69978c67931a354006837","ffffccd9f0a3addd8e78c67931a354006837","ffffccd9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443005a32","ffffe5f7fcb9d9f0a3addd8e78c67941ab5d238443006837004529").map(gr),p9=nn(LC)});var FC,m9,Mle=W(()=>{On();wi();FC=new Array(3).concat("fff7bcfec44fd95f0e","ffffd4fed98efe9929cc4c02","ffffd4fed98efe9929d95f0e993404","ffffd4fee391fec44ffe9929d95f0e993404","ffffd4fee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c028c2d04","ffffe5fff7bcfee391fec44ffe9929ec7014cc4c02993404662506").map(gr),m9=nn(FC)});var BC,g9,Sle=W(()=>{On();wi();BC=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(gr),g9=nn(BC)});var jC,_9,Tle=W(()=>{On();wi();jC=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(gr),_9=nn(jC)});var UC,y9,Ele=W(()=>{On();wi();UC=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(gr),y9=nn(UC)});var VC,x9,Ile=W(()=>{On();wi();VC=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(gr),x9=nn(VC)});var WC,b9,Cle=W(()=>{On();wi();WC=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(gr),b9=nn(WC)});var ZC,v9,kle=W(()=>{On();wi();ZC=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(gr),v9=nn(ZC)});var YC,w9,Ple=W(()=>{On();wi();YC=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(gr),w9=nn(YC)});function A9(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-e*(35.34-e*(2381.73-e*(6402.7-e*(7024.72-e*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+e*(170.73+e*(52.82-e*(131.46-e*(176.58-e*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+e*(442.36-e*(2482.43-e*(6167.24-e*(6614.94-e*2475.67)))))))+")"}var Ole=W(()=>{});var M9,Rle=W(()=>{Dl();nl();M9=xg(Bs(300,.5,0),Bs(-240,.5,1))});function E9(e){(e<0||e>1)&&(e-=Math.floor(e));var t=Math.abs(e-.5);return qC.h=360*e-100,qC.s=1.5-1.5*t,qC.l=.8-.9*t,qC+""}var S9,T9,qC,Nle=W(()=>{Dl();nl();S9=xg(Bs(-100,.75,.35),Bs(80,1.5,.8)),T9=xg(Bs(260,.75,.35),Bs(80,1.5,.8)),qC=Bs()});function I9(e){var t;return e=(.5-e)*Math.PI,GC.r=255*(t=Math.sin(e))*t,GC.g=255*(t=Math.sin(e+xOe))*t,GC.b=255*(t=Math.sin(e+bOe))*t,GC+""}var GC,xOe,bOe,zle=W(()=>{Dl();GC=Qf(),xOe=Math.PI/3,bOe=Math.PI*2/3});function C9(e){return e=Math.max(0,Math.min(1,e)),"rgb("+Math.max(0,Math.min(255,Math.round(34.61+e*(1172.33-e*(10793.56-e*(33300.12-e*(38394.49-e*14825.05)))))))+", "+Math.max(0,Math.min(255,Math.round(23.31+e*(557.33+e*(1225.33-e*(3574.96-e*(1073.77+e*707.56)))))))+", "+Math.max(0,Math.min(255,Math.round(27.2+e*(3211.1-e*(15327.97-e*(27814-e*(22569.18-e*6838.66)))))))+")"}var Dle=W(()=>{});function HC(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var k9,P9,O9,R9,Lle=W(()=>{On();k9=HC(gr("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),P9=HC(gr("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),O9=HC(gr("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),R9=HC(gr("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"))});var Fle={};io(Fle,{interpolateBlues:()=>_9,interpolateBrBG:()=>$F,interpolateBuGn:()=>o9,interpolateBuPu:()=>s9,interpolateCividis:()=>A9,interpolateCool:()=>T9,interpolateCubehelixDefault:()=>M9,interpolateGnBu:()=>a9,interpolateGreens:()=>y9,interpolateGreys:()=>x9,interpolateInferno:()=>O9,interpolateMagma:()=>P9,interpolateOrRd:()=>l9,interpolateOranges:()=>w9,interpolatePRGn:()=>QF,interpolatePiYG:()=>JF,interpolatePlasma:()=>R9,interpolatePuBu:()=>u9,interpolatePuBuGn:()=>c9,interpolatePuOr:()=>e9,interpolatePuRd:()=>f9,interpolatePurples:()=>b9,interpolateRainbow:()=>E9,interpolateRdBu:()=>t9,interpolateRdGy:()=>r9,interpolateRdPu:()=>h9,interpolateRdYlBu:()=>n9,interpolateRdYlGn:()=>i9,interpolateReds:()=>v9,interpolateSinebow:()=>I9,interpolateSpectral:()=>x2,interpolateTurbo:()=>C9,interpolateViridis:()=>k9,interpolateWarm:()=>S9,interpolateYlGn:()=>p9,interpolateYlGnBu:()=>d9,interpolateYlOrBr:()=>m9,interpolateYlOrRd:()=>g9,schemeAccent:()=>UF,schemeBlues:()=>jC,schemeBrBG:()=>xC,schemeBuGn:()=>IC,schemeBuPu:()=>CC,schemeCategory10:()=>jF,schemeDark2:()=>VF,schemeGnBu:()=>kC,schemeGreens:()=>UC,schemeGreys:()=>VC,schemeObservable10:()=>WF,schemeOrRd:()=>PC,schemeOranges:()=>YC,schemePRGn:()=>bC,schemePaired:()=>ZF,schemePastel1:()=>YF,schemePastel2:()=>qF,schemePiYG:()=>vC,schemePuBu:()=>RC,schemePuBuGn:()=>OC,schemePuOr:()=>wC,schemePuRd:()=>NC,schemePurples:()=>WC,schemeRdBu:()=>AC,schemeRdGy:()=>MC,schemeRdPu:()=>zC,schemeRdYlBu:()=>SC,schemeRdYlGn:()=>TC,schemeReds:()=>ZC,schemeSet1:()=>GF,schemeSet2:()=>HF,schemeSet3:()=>XF,schemeSpectral:()=>EC,schemeTableau10:()=>KF,schemeYlGn:()=>LC,schemeYlGnBu:()=>DC,schemeYlOrBr:()=>FC,schemeYlOrRd:()=>BC});var N9=W(()=>{Hae();Xae();Kae();$ae();Qae();Jae();ele();tle();rle();nle();ile();ole();sle();ale();lle();cle();ule();fle();hle();dle();ple();mle();gle();_le();yle();xle();ble();vle();wle();Ale();Mle();Sle();Tle();Ele();Ile();Cle();kle();Ple();Ole();Rle();Nle();zle();Dle();Lle()});function cn(e){return function(){return e}}var pp=W(()=>{});function jle(e){return e>1?0:e<-1?Lc:Math.acos(e)}function D9(e){return e>=1?b2:e<=-1?-b2:Math.asin(e)}var z9,_s,Dc,Ble,Wu,Zs,Dn,ls,Lc,b2,Wl,ys=W(()=>{z9=Math.abs,_s=Math.atan2,Dc=Math.cos,Ble=Math.max,Wu=Math.min,Zs=Math.sin,Dn=Math.sqrt,ls=1e-12,Lc=Math.PI,b2=Lc/2,Wl=2*Lc});function Zu(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{let n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new Cu(t)}var Hy=W(()=>{ow()});function vOe(e){return e.innerRadius}function wOe(e){return e.outerRadius}function AOe(e){return e.startAngle}function MOe(e){return e.endAngle}function SOe(e){return e&&e.padAngle}function TOe(e,t,r,n,o,i,s,a){var u=r-e,h=n-t,p=s-o,_=a-i,y=_*u-p*h;if(!(y*y<ls))return y=(p*(t-i)-_*(e-o))/y,[e+y*u,t+y*h]}function XC(e,t,r,n,o,i,s){var a=e-r,u=t-n,h=(s?i:-i)/Dn(a*a+u*u),p=h*u,_=-h*a,y=e+p,A=t+_,E=r+p,k=n+_,P=(y+E)/2,R=(A+k)/2,V=E-y,N=k-A,j=V*V+N*N,J=o-i,ne=y*k-E*A,de=(N<0?-1:1)*Dn(Ble(0,J*J*j-ne*ne)),fe=(ne*N-V*de)/j,ye=(-ne*V-N*de)/j,ve=(ne*N+V*de)/j,be=(-ne*V+N*de)/j,je=fe-P,Re=ye-R,Se=ve-P,Ue=be-R;return je*je+Re*Re>Se*Se+Ue*Ue&&(fe=ve,ye=be),{cx:fe,cy:ye,x01:-p,y01:-_,x11:fe*(o/J-1),y11:ye*(o/J-1)}}function v2(){var e=vOe,t=wOe,r=cn(0),n=null,o=AOe,i=MOe,s=SOe,a=null,u=Zu(h);function h(){var p,_,y=+e.apply(this,arguments),A=+t.apply(this,arguments),E=o.apply(this,arguments)-b2,k=i.apply(this,arguments)-b2,P=z9(k-E),R=k>E;if(a||(a=p=u()),A<y&&(_=A,A=y,y=_),!(A>ls))a.moveTo(0,0);else if(P>Wl-ls)a.moveTo(A*Dc(E),A*Zs(E)),a.arc(0,0,A,E,k,!R),y>ls&&(a.moveTo(y*Dc(k),y*Zs(k)),a.arc(0,0,y,k,E,R));else{var V=E,N=k,j=E,J=k,ne=P,de=P,fe=s.apply(this,arguments)/2,ye=fe>ls&&(n?+n.apply(this,arguments):Dn(y*y+A*A)),ve=Wu(z9(A-y)/2,+r.apply(this,arguments)),be=ve,je=ve,Re,Se;if(ye>ls){var Ue=D9(ye/y*Zs(fe)),qe=D9(ye/A*Zs(fe));(ne-=Ue*2)>ls?(Ue*=R?1:-1,j+=Ue,J-=Ue):(ne=0,j=J=(E+k)/2),(de-=qe*2)>ls?(qe*=R?1:-1,V+=qe,N-=qe):(de=0,V=N=(E+k)/2)}var Je=A*Dc(V),gt=A*Zs(V),rt=y*Dc(J),At=y*Zs(J);if(ve>ls){var St=A*Dc(N),kt=A*Zs(N),yt=y*Dc(j),tr=y*Zs(j),vr;if(P<Lc)if(vr=TOe(Je,gt,yt,tr,St,kt,rt,At)){var wr=Je-vr[0],Ir=gt-vr[1],Br=St-vr[0],qt=kt-vr[1],Lr=1/Zs(jle((wr*Br+Ir*qt)/(Dn(wr*wr+Ir*Ir)*Dn(Br*Br+qt*qt)))/2),Yr=Dn(vr[0]*vr[0]+vr[1]*vr[1]);be=Wu(ve,(y-Yr)/(Lr-1)),je=Wu(ve,(A-Yr)/(Lr+1))}else be=je=0}de>ls?je>ls?(Re=XC(yt,tr,Je,gt,A,je,R),Se=XC(St,kt,rt,At,A,je,R),a.moveTo(Re.cx+Re.x01,Re.cy+Re.y01),je<ve?a.arc(Re.cx,Re.cy,je,_s(Re.y01,Re.x01),_s(Se.y01,Se.x01),!R):(a.arc(Re.cx,Re.cy,je,_s(Re.y01,Re.x01),_s(Re.y11,Re.x11),!R),a.arc(0,0,A,_s(Re.cy+Re.y11,Re.cx+Re.x11),_s(Se.cy+Se.y11,Se.cx+Se.x11),!R),a.arc(Se.cx,Se.cy,je,_s(Se.y11,Se.x11),_s(Se.y01,Se.x01),!R))):(a.moveTo(Je,gt),a.arc(0,0,A,V,N,!R)):a.moveTo(Je,gt),!(y>ls)||!(ne>ls)?a.lineTo(rt,At):be>ls?(Re=XC(rt,At,St,kt,y,-be,R),Se=XC(Je,gt,yt,tr,y,-be,R),a.lineTo(Re.cx+Re.x01,Re.cy+Re.y01),be<ve?a.arc(Re.cx,Re.cy,be,_s(Re.y01,Re.x01),_s(Se.y01,Se.x01),!R):(a.arc(Re.cx,Re.cy,be,_s(Re.y01,Re.x01),_s(Re.y11,Re.x11),!R),a.arc(0,0,y,_s(Re.cy+Re.y11,Re.cx+Re.x11),_s(Se.cy+Se.y11,Se.cx+Se.x11),R),a.arc(Se.cx,Se.cy,be,_s(Se.y11,Se.x11),_s(Se.y01,Se.x01),!R))):a.arc(0,0,y,J,j,R)}if(a.closePath(),p)return a=null,p+""||null}return h.centroid=function(){var p=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,_=(+o.apply(this,arguments)+ +i.apply(this,arguments))/2-Lc/2;return[Dc(_)*p,Zs(_)*p]},h.innerRadius=function(p){return arguments.length?(e=typeof p=="function"?p:cn(+p),h):e},h.outerRadius=function(p){return arguments.length?(t=typeof p=="function"?p:cn(+p),h):t},h.cornerRadius=function(p){return arguments.length?(r=typeof p=="function"?p:cn(+p),h):r},h.padRadius=function(p){return arguments.length?(n=p==null?null:typeof p=="function"?p:cn(+p),h):n},h.startAngle=function(p){return arguments.length?(o=typeof p=="function"?p:cn(+p),h):o},h.endAngle=function(p){return arguments.length?(i=typeof p=="function"?p:cn(+p),h):i},h.padAngle=function(p){return arguments.length?(s=typeof p=="function"?p:cn(+p),h):s},h.context=function(p){return arguments.length?(a=p??null,h):a},h}var Ule=W(()=>{pp();ys();Hy()});function mp(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}var Vle,Xy=W(()=>{Vle=Array.prototype.slice});function Wle(e){this._context=e}function gh(e){return new Wle(e)}var w2=W(()=>{Wle.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}}});function Ky(e){return e[0]}function $y(e){return e[1]}var KC=W(()=>{});function _h(e,t){var r=cn(!0),n=null,o=gh,i=null,s=Zu(a);e=typeof e=="function"?e:e===void 0?Ky:cn(e),t=typeof t=="function"?t:t===void 0?$y:cn(t);function a(u){var h,p=(u=mp(u)).length,_,y=!1,A;for(n==null&&(i=o(A=s())),h=0;h<=p;++h)!(h<p&&r(_=u[h],h,u))===y&&((y=!y)?i.lineStart():i.lineEnd()),y&&i.point(+e(_,h,u),+t(_,h,u));if(A)return i=null,A+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:cn(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:cn(+u),a):t},a.defined=function(u){return arguments.length?(r=typeof u=="function"?u:cn(!!u),a):r},a.curve=function(u){return arguments.length?(o=u,n!=null&&(i=o(n)),a):o},a.context=function(u){return arguments.length?(u==null?n=i=null:i=o(n=u),a):n},a}var $C=W(()=>{Xy();pp();w2();Hy();KC()});function A2(e,t,r){var n=null,o=cn(!0),i=null,s=gh,a=null,u=Zu(h);e=typeof e=="function"?e:e===void 0?Ky:cn(+e),t=typeof t=="function"?t:t===void 0?cn(0):cn(+t),r=typeof r=="function"?r:r===void 0?$y:cn(+r);function h(_){var y,A,E,k=(_=mp(_)).length,P,R=!1,V,N=new Array(k),j=new Array(k);for(i==null&&(a=s(V=u())),y=0;y<=k;++y){if(!(y<k&&o(P=_[y],y,_))===R)if(R=!R)A=y,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),E=y-1;E>=A;--E)a.point(N[E],j[E]);a.lineEnd(),a.areaEnd()}R&&(N[y]=+e(P,y,_),j[y]=+t(P,y,_),a.point(n?+n(P,y,_):N[y],r?+r(P,y,_):j[y]))}if(V)return a=null,V+""||null}function p(){return _h().defined(o).curve(s).context(i)}return h.x=function(_){return arguments.length?(e=typeof _=="function"?_:cn(+_),n=null,h):e},h.x0=function(_){return arguments.length?(e=typeof _=="function"?_:cn(+_),h):e},h.x1=function(_){return arguments.length?(n=_==null?null:typeof _=="function"?_:cn(+_),h):n},h.y=function(_){return arguments.length?(t=typeof _=="function"?_:cn(+_),r=null,h):t},h.y0=function(_){return arguments.length?(t=typeof _=="function"?_:cn(+_),h):t},h.y1=function(_){return arguments.length?(r=_==null?null:typeof _=="function"?_:cn(+_),h):r},h.lineX0=h.lineY0=function(){return p().x(e).y(t)},h.lineY1=function(){return p().x(e).y(r)},h.lineX1=function(){return p().x(n).y(t)},h.defined=function(_){return arguments.length?(o=typeof _=="function"?_:cn(!!_),h):o},h.curve=function(_){return arguments.length?(s=_,i!=null&&(a=s(i)),h):s},h.context=function(_){return arguments.length?(_==null?i=a=null:a=s(i=_),h):i},h}var L9=W(()=>{Xy();pp();w2();$C();Hy();KC()});function Zle(e,t){return t<e?-1:t>e?1:t>=e?0:NaN}var Yle=W(()=>{});function qle(e){return e}var Gle=W(()=>{});function F9(){var e=qle,t=Zle,r=null,n=cn(0),o=cn(Wl),i=cn(0);function s(a){var u,h=(a=mp(a)).length,p,_,y=0,A=new Array(h),E=new Array(h),k=+n.apply(this,arguments),P=Math.min(Wl,Math.max(-Wl,o.apply(this,arguments)-k)),R,V=Math.min(Math.abs(P)/h,i.apply(this,arguments)),N=V*(P<0?-1:1),j;for(u=0;u<h;++u)(j=E[A[u]=u]=+e(a[u],u,a))>0&&(y+=j);for(t!=null?A.sort(function(J,ne){return t(E[J],E[ne])}):r!=null&&A.sort(function(J,ne){return r(a[J],a[ne])}),u=0,_=y?(P-h*N)/y:0;u<h;++u,k=R)p=A[u],j=E[p],R=k+(j>0?j*_:0)+N,E[p]={data:a[p],index:u,value:j,startAngle:k,endAngle:R,padAngle:V};return E}return s.value=function(a){return arguments.length?(e=typeof a=="function"?a:cn(+a),s):e},s.sortValues=function(a){return arguments.length?(t=a,r=null,s):t},s.sort=function(a){return arguments.length?(r=a,t=null,s):r},s.startAngle=function(a){return arguments.length?(n=typeof a=="function"?a:cn(+a),s):n},s.endAngle=function(a){return arguments.length?(o=typeof a=="function"?a:cn(+a),s):o},s.padAngle=function(a){return arguments.length?(i=typeof a=="function"?a:cn(+a),s):i},s}var Hle=W(()=>{Xy();pp();Yle();Gle();ys()});function Xle(e){this._curve=e}function Qy(e){function t(r){return new Xle(e(r))}return t._curve=e,t}var QC,B9=W(()=>{w2();QC=Qy(gh);Xle.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(e,t){this._curve.point(t*Math.sin(e),t*-Math.cos(e))}}});function Jy(e){var t=e.curve;return e.angle=e.x,delete e.x,e.radius=e.y,delete e.y,e.curve=function(r){return arguments.length?t(Qy(r)):t()._curve},e}function JC(){return Jy(_h().curve(QC))}var j9=W(()=>{B9();$C()});function ek(){var e=A2().curve(QC),t=e.curve,r=e.lineX0,n=e.lineX1,o=e.lineY0,i=e.lineY1;return e.angle=e.x,delete e.x,e.startAngle=e.x0,delete e.x0,e.endAngle=e.x1,delete e.x1,e.radius=e.y,delete e.y,e.innerRadius=e.y0,delete e.y0,e.outerRadius=e.y1,delete e.y1,e.lineStartAngle=function(){return Jy(r())},delete e.lineX0,e.lineEndAngle=function(){return Jy(n())},delete e.lineX1,e.lineInnerRadius=function(){return Jy(o())},delete e.lineY0,e.lineOuterRadius=function(){return Jy(i())},delete e.lineY1,e.curve=function(s){return arguments.length?t(Qy(s)):t()._curve},e}var Kle=W(()=>{B9();L9();j9()});function gp(e,t){return[(t=+t)*Math.cos(e-=Math.PI/2),t*Math.sin(e)]}var U9=W(()=>{});function M2(e){return new tk(e,!0)}function S2(e){return new tk(e,!1)}function $le(e){return new V9(e)}var tk,V9,W9=W(()=>{U9();tk=class{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}},V9=class{constructor(t){this._context=t}lineStart(){this._point=0}lineEnd(){}point(t,r){if(t=+t,r=+r,this._point===0)this._point=1;else{let n=gp(this._x0,this._y0),o=gp(this._x0,this._y0=(this._y0+r)/2),i=gp(t,this._y0),s=gp(t,r);this._context.moveTo(...n),this._context.bezierCurveTo(...o,...i,...s)}this._x0=t,this._y0=r}}});function EOe(e){return e.source}function IOe(e){return e.target}function ex(e){let t=EOe,r=IOe,n=Ky,o=$y,i=null,s=null,a=Zu(u);function u(){let h,p=Vle.call(arguments),_=t.apply(this,p),y=r.apply(this,p);if(i==null&&(s=e(h=a())),s.lineStart(),p[0]=_,s.point(+n.apply(this,p),+o.apply(this,p)),p[0]=y,s.point(+n.apply(this,p),+o.apply(this,p)),s.lineEnd(),h)return s=null,h+""||null}return u.source=function(h){return arguments.length?(t=h,u):t},u.target=function(h){return arguments.length?(r=h,u):r},u.x=function(h){return arguments.length?(n=typeof h=="function"?h:cn(+h),u):n},u.y=function(h){return arguments.length?(o=typeof h=="function"?h:cn(+h),u):o},u.context=function(h){return arguments.length?(h==null?i=s=null:s=e(i=h),u):i},u}function Z9(){return ex(M2)}function Y9(){return ex(S2)}function q9(){let e=ex($le);return e.angle=e.x,delete e.x,e.radius=e.y,delete e.y,e}var Qle=W(()=>{Xy();pp();W9();Hy();KC()});var COe,T2,G9=W(()=>{ys();COe=Dn(3),T2={draw(e,t){let r=Dn(t+Wu(t/28,.75))*.59436,n=r/2,o=n*COe;e.moveTo(0,r),e.lineTo(0,-r),e.moveTo(-o,-n),e.lineTo(o,n),e.moveTo(-o,n),e.lineTo(o,-n)}}});var Zl,H9=W(()=>{ys();Zl={draw(e,t){let r=Dn(t/Lc);e.moveTo(r,0),e.arc(0,0,r,0,Wl)}}});var _p,X9=W(()=>{ys();_p={draw(e,t){let r=Dn(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}}});var Jle,kOe,yp,K9=W(()=>{ys();Jle=Dn(1/3),kOe=Jle*2,yp={draw(e,t){let r=Dn(t/kOe),n=r*Jle;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}}});var E2,$9=W(()=>{ys();E2={draw(e,t){let r=Dn(t)*.62625;e.moveTo(0,-r),e.lineTo(r,0),e.lineTo(0,r),e.lineTo(-r,0),e.closePath()}}});var I2,Q9=W(()=>{ys();I2={draw(e,t){let r=Dn(t-Wu(t/7,2))*.87559;e.moveTo(-r,0),e.lineTo(r,0),e.moveTo(0,r),e.lineTo(0,-r)}}});var xp,J9=W(()=>{ys();xp={draw(e,t){let r=Dn(t),n=-r/2;e.rect(n,n,r,r)}}});var C2,e8=W(()=>{ys();C2={draw(e,t){let r=Dn(t)*.4431;e.moveTo(r,r),e.lineTo(r,-r),e.lineTo(-r,-r),e.lineTo(-r,r),e.closePath()}}});var POe,ece,OOe,ROe,bp,t8=W(()=>{ys();POe=.8908130915292852,ece=Zs(Lc/10)/Zs(7*Lc/10),OOe=Zs(Wl/10)*ece,ROe=-Dc(Wl/10)*ece,bp={draw(e,t){let r=Dn(t*POe),n=OOe*r,o=ROe*r;e.moveTo(0,-r),e.lineTo(n,o);for(let i=1;i<5;++i){let s=Wl*i/5,a=Dc(s),u=Zs(s);e.lineTo(u*r,-a*r),e.lineTo(a*n-u*o,u*n+a*o)}e.closePath()}}});var r8,vp,n8=W(()=>{ys();r8=Dn(3),vp={draw(e,t){let r=-Dn(t/(r8*3));e.moveTo(0,r*2),e.lineTo(-r8*r,-r),e.lineTo(r8*r,-r),e.closePath()}}});var NOe,k2,i8=W(()=>{ys();NOe=Dn(3),k2={draw(e,t){let r=Dn(t)*.6824,n=r/2,o=r*NOe/2;e.moveTo(0,-r),e.lineTo(o,n),e.lineTo(-o,n),e.closePath()}}});var Yl,ql,o8,zOe,wp,s8=W(()=>{ys();Yl=-.5,ql=Dn(3)/2,o8=1/Dn(12),zOe=(o8/2+1)*3,wp={draw(e,t){let r=Dn(t/zOe),n=r/2,o=r*o8,i=n,s=r*o8+r,a=-i,u=s;e.moveTo(n,o),e.lineTo(i,s),e.lineTo(a,u),e.lineTo(Yl*n-ql*o,ql*n+Yl*o),e.lineTo(Yl*i-ql*s,ql*i+Yl*s),e.lineTo(Yl*a-ql*u,ql*a+Yl*u),e.lineTo(Yl*n+ql*o,Yl*o-ql*n),e.lineTo(Yl*i+ql*s,Yl*s-ql*i),e.lineTo(Yl*a+ql*u,Yl*u-ql*a),e.closePath()}}});var tx,a8=W(()=>{ys();tx={draw(e,t){let r=Dn(t-Wu(t/6,1.7))*.6189;e.moveTo(-r,-r),e.lineTo(r,r),e.moveTo(-r,r),e.lineTo(r,-r)}}});function rx(e,t){let r=null,n=Zu(o);e=typeof e=="function"?e:cn(e||Zl),t=typeof t=="function"?t:cn(t===void 0?64:+t);function o(){let i;if(r||(r=i=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),i)return r=null,i+""||null}return o.type=function(i){return arguments.length?(e=typeof i=="function"?i:cn(i),o):e},o.size=function(i){return arguments.length?(t=typeof i=="function"?i:cn(+i),o):t},o.context=function(i){return arguments.length?(r=i??null,o):r},o}var rk,l8,tce=W(()=>{pp();Hy();G9();H9();X9();K9();$9();Q9();J9();e8();t8();n8();i8();s8();a8();rk=[Zl,_p,yp,xp,bp,vp,wp],l8=[Zl,I2,tx,k2,T2,C2,E2]});function Gl(){}var P2=W(()=>{});function nx(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function O2(e){this._context=e}function c8(e){return new O2(e)}var R2=W(()=>{O2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:nx(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:nx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}}});function rce(e){this._context=e}function u8(e){return new rce(e)}var nce=W(()=>{P2();R2();rce.prototype={areaStart:Gl,areaEnd:Gl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:nx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}}});function ice(e){this._context=e}function f8(e){return new ice(e)}var oce=W(()=>{R2();ice.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:nx(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}}});function sce(e,t){this._basis=new O2(e),this._beta=t}var h8,ace=W(()=>{R2();sce.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,r=e.length-1;if(r>0)for(var n=e[0],o=t[0],i=e[r]-n,s=t[r]-o,a=-1,u;++a<=r;)u=a/r,this._basis.point(this._beta*e[a]+(1-this._beta)*(n+u*i),this._beta*t[a]+(1-this._beta)*(o+u*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};h8=function e(t){function r(n){return t===1?new O2(n):new sce(n,t)}return r.beta=function(n){return e(+n)},r}(.85)});function ix(e,t,r){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-r),e._x2,e._y2)}function nk(e,t){this._context=e,this._k=(1-t)/6}var d8,N2=W(()=>{nk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:ix(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:ix(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};d8=function e(t){function r(n){return new nk(n,t)}return r.tension=function(n){return e(+n)},r}(0)});function ik(e,t){this._context=e,this._k=(1-t)/6}var p8,m8=W(()=>{P2();N2();ik.prototype={areaStart:Gl,areaEnd:Gl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:ix(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};p8=function e(t){function r(n){return new ik(n,t)}return r.tension=function(n){return e(+n)},r}(0)});function ok(e,t){this._context=e,this._k=(1-t)/6}var g8,_8=W(()=>{N2();ok.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:ix(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};g8=function e(t){function r(n){return new ok(n,t)}return r.tension=function(n){return e(+n)},r}(0)});function z2(e,t,r){var n=e._x1,o=e._y1,i=e._x2,s=e._y2;if(e._l01_a>ls){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);n=(n*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,o=(o*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>ls){var h=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,p=3*e._l23_a*(e._l23_a+e._l12_a);i=(i*h+e._x1*e._l23_2a-t*e._l12_2a)/p,s=(s*h+e._y1*e._l23_2a-r*e._l12_2a)/p}e._context.bezierCurveTo(n,o,i,s,e._x2,e._y2)}function lce(e,t){this._context=e,this._alpha=t}var y8,sk=W(()=>{ys();N2();lce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,n=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:z2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};y8=function e(t){function r(n){return t?new lce(n,t):new nk(n,0)}return r.alpha=function(n){return e(+n)},r}(.5)});function cce(e,t){this._context=e,this._alpha=t}var x8,uce=W(()=>{m8();P2();sk();cce.prototype={areaStart:Gl,areaEnd:Gl,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,n=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+n*n,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:z2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};x8=function e(t){function r(n){return t?new cce(n,t):new ik(n,0)}return r.alpha=function(n){return e(+n)},r}(.5)});function fce(e,t){this._context=e,this._alpha=t}var b8,hce=W(()=>{_8();sk();fce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var r=this._x2-e,n=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+n*n,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:z2(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};b8=function e(t){function r(n){return t?new fce(n,t):new ok(n,0)}return r.alpha=function(n){return e(+n)},r}(.5)});function dce(e){this._context=e}function v8(e){return new dce(e)}var pce=W(()=>{P2();dce.prototype={areaStart:Gl,areaEnd:Gl,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}}});function mce(e){return e<0?-1:1}function gce(e,t,r){var n=e._x1-e._x0,o=t-e._x1,i=(e._y1-e._y0)/(n||o<0&&-0),s=(r-e._y1)/(o||n<0&&-0),a=(i*o+s*n)/(n+o);return(mce(i)+mce(s))*Math.min(Math.abs(i),Math.abs(s),.5*Math.abs(a))||0}function _ce(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function w8(e,t,r){var n=e._x0,o=e._y0,i=e._x1,s=e._y1,a=(i-n)/3;e._context.bezierCurveTo(n+a,o+a*t,i-a,s-a*r,i,s)}function ak(e){this._context=e}function yce(e){this._context=new xce(e)}function xce(e){this._context=e}function A8(e){return new ak(e)}function M8(e){return new yce(e)}var bce=W(()=>{ak.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:w8(this,this._t0,_ce(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,w8(this,_ce(this,r=gce(this,e,t)),r);break;default:w8(this,this._t0,r=gce(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};(yce.prototype=Object.create(ak.prototype)).point=function(e,t){ak.prototype.point.call(this,t,e)};xce.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,o,i){this._context.bezierCurveTo(t,e,n,r,i,o)}}});function wce(e){this._context=e}function vce(e){var t,r=e.length-1,n,o=new Array(r),i=new Array(r),s=new Array(r);for(o[0]=0,i[0]=2,s[0]=e[0]+2*e[1],t=1;t<r-1;++t)o[t]=1,i[t]=4,s[t]=4*e[t]+2*e[t+1];for(o[r-1]=2,i[r-1]=7,s[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=o[t]/i[t-1],i[t]-=n,s[t]-=n*s[t-1];for(o[r-1]=s[r-1]/i[r-1],t=r-2;t>=0;--t)o[t]=(s[t]-o[t+1])/i[t];for(i[r-1]=(e[r]+o[r-1])/2,t=0;t<r-1;++t)i[t]=2*e[t+1]-o[t+1];return[o,i]}function S8(e){return new wce(e)}var Ace=W(()=>{wce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=vce(e),o=vce(t),i=0,s=1;s<r;++i,++s)this._context.bezierCurveTo(n[0][i],o[0][i],n[1][i],o[1][i],e[s],t[s]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}}});function lk(e,t){this._context=e,this._t=t}function T8(e){return new lk(e,.5)}function E8(e){return new lk(e,0)}function I8(e){return new lk(e,1)}var Mce=W(()=>{lk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}}});function Hl(e,t){if((s=e.length)>1)for(var r=1,n,o,i=e[t[0]],s,a=i.length;r<s;++r)for(o=i,i=e[t[r]],n=0;n<a;++n)i[n][1]+=i[n][0]=isNaN(o[n][1])?o[n][0]:o[n][1]}var ox=W(()=>{});function Xl(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}var sx=W(()=>{});function DOe(e,t){return e[t]}function LOe(e){let t=[];return t.key=e,t}function C8(){var e=cn([]),t=Xl,r=Hl,n=DOe;function o(i){var s=Array.from(e.apply(this,arguments),LOe),a,u=s.length,h=-1,p;for(let _ of i)for(a=0,++h;a<u;++a)(s[a][h]=[0,+n(_,s[a].key,h,i)]).data=_;for(a=0,p=mp(t(s));a<u;++a)s[p[a]].index=a;return r(s,p),s}return o.keys=function(i){return arguments.length?(e=typeof i=="function"?i:cn(Array.from(i)),o):e},o.value=function(i){return arguments.length?(n=typeof i=="function"?i:cn(+i),o):n},o.order=function(i){return arguments.length?(t=i==null?Xl:typeof i=="function"?i:cn(Array.from(i)),o):t},o.offset=function(i){return arguments.length?(r=i??Hl,o):r},o}var Sce=W(()=>{Xy();pp();ox();sx()});function k8(e,t){if((n=e.length)>0){for(var r,n,o=0,i=e[0].length,s;o<i;++o){for(s=r=0;r<n;++r)s+=e[r][o][1]||0;if(s)for(r=0;r<n;++r)e[r][o][1]/=s}Hl(e,t)}}var Tce=W(()=>{ox()});function P8(e,t){if((u=e.length)>0)for(var r,n=0,o,i,s,a,u,h=e[t[0]].length;n<h;++n)for(s=a=0,r=0;r<u;++r)(i=(o=e[t[r]][n])[1]-o[0])>0?(o[0]=s,o[1]=s+=i):i<0?(o[1]=a,o[0]=a+=i):(o[0]=0,o[1]=i)}var Ece=W(()=>{});function O8(e,t){if((o=e.length)>0){for(var r=0,n=e[t[0]],o,i=n.length;r<i;++r){for(var s=0,a=0;s<o;++s)a+=e[s][r][1]||0;n[r][1]+=n[r][0]=-a/2}Hl(e,t)}}var Ice=W(()=>{ox()});function R8(e,t){if(!(!((s=e.length)>0)||!((i=(o=e[t[0]]).length)>0))){for(var r=0,n=1,o,i,s;n<i;++n){for(var a=0,u=0,h=0;a<s;++a){for(var p=e[t[a]],_=p[n][1]||0,y=p[n-1][1]||0,A=(_-y)/2,E=0;E<a;++E){var k=e[t[E]],P=k[n][1]||0,R=k[n-1][1]||0;A+=P-R}u+=_,h+=A*_}o[n-1][1]+=o[n-1][0]=r,u&&(r-=h/u)}o[n-1][1]+=o[n-1][0]=r,Hl(e,t)}}var Cce=W(()=>{ox()});function D2(e){var t=e.map(FOe);return Xl(e).sort(function(r,n){return t[r]-t[n]})}function FOe(e){for(var t=-1,r=0,n=e.length,o,i=-1/0;++t<n;)(o=+e[t][1])>i&&(i=o,r=t);return r}var N8=W(()=>{sx()});function L2(e){var t=e.map(z8);return Xl(e).sort(function(r,n){return t[r]-t[n]})}function z8(e){for(var t=0,r=-1,n=e.length,o;++r<n;)(o=+e[r][1])&&(t+=o);return t}var ck=W(()=>{sx()});function D8(e){return L2(e).reverse()}var kce=W(()=>{ck()});function L8(e){var t=e.length,r,n,o=e.map(z8),i=D2(e),s=0,a=0,u=[],h=[];for(r=0;r<t;++r)n=i[r],s<a?(s+=o[n],u.push(n)):(a+=o[n],h.push(n));return h.reverse().concat(u)}var Pce=W(()=>{N8();ck()});function F8(e){return Xl(e).reverse()}var Oce=W(()=>{sx()});var Rce={};io(Rce,{arc:()=>v2,area:()=>A2,areaRadial:()=>ek,curveBasis:()=>c8,curveBasisClosed:()=>u8,curveBasisOpen:()=>f8,curveBumpX:()=>M2,curveBumpY:()=>S2,curveBundle:()=>h8,curveCardinal:()=>d8,curveCardinalClosed:()=>p8,curveCardinalOpen:()=>g8,curveCatmullRom:()=>y8,curveCatmullRomClosed:()=>x8,curveCatmullRomOpen:()=>b8,curveLinear:()=>gh,curveLinearClosed:()=>v8,curveMonotoneX:()=>A8,curveMonotoneY:()=>M8,curveNatural:()=>S8,curveStep:()=>T8,curveStepAfter:()=>I8,curveStepBefore:()=>E8,line:()=>_h,lineRadial:()=>JC,link:()=>ex,linkHorizontal:()=>Z9,linkRadial:()=>q9,linkVertical:()=>Y9,pie:()=>F9,pointRadial:()=>gp,radialArea:()=>ek,radialLine:()=>JC,stack:()=>C8,stackOffsetDiverging:()=>P8,stackOffsetExpand:()=>k8,stackOffsetNone:()=>Hl,stackOffsetSilhouette:()=>O8,stackOffsetWiggle:()=>R8,stackOrderAppearance:()=>D2,stackOrderAscending:()=>L2,stackOrderDescending:()=>D8,stackOrderInsideOut:()=>L8,stackOrderNone:()=>Xl,stackOrderReverse:()=>F8,symbol:()=>rx,symbolAsterisk:()=>T2,symbolCircle:()=>Zl,symbolCross:()=>_p,symbolDiamond:()=>yp,symbolDiamond2:()=>E2,symbolPlus:()=>I2,symbolSquare:()=>xp,symbolSquare2:()=>C2,symbolStar:()=>bp,symbolTimes:()=>tx,symbolTriangle:()=>vp,symbolTriangle2:()=>k2,symbolWye:()=>wp,symbolX:()=>tx,symbols:()=>rk,symbolsFill:()=>rk,symbolsStroke:()=>l8});var B8=W(()=>{Ule();L9();$C();Hle();Kle();j9();U9();Qle();tce();G9();H9();X9();K9();$9();Q9();J9();e8();t8();n8();i8();s8();a8();nce();oce();R2();W9();ace();m8();_8();N2();uce();hce();sk();pce();w2();bce();Ace();Mce();Sce();Tce();Ece();ox();Ice();Cce();N8();ck();kce();Pce();sx();Oce()});var F2,Nce=W(()=>{F2=e=>()=>e});function j8(e,{sourceEvent:t,target:r,transform:n,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:o}})}var zce=W(()=>{});function al(e,t,r){this.k=e,this.x=t,this.y=r}function B2(e){for(;!e.__zoom;)if(!(e=e.parentNode))return Fc;return e.__zoom}var Fc,U8=W(()=>{al.prototype={constructor:al,scale:function(e){return e===1?this:new al(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new al(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Fc=new al(1,0,0);B2.prototype=al.prototype});function uk(e){e.stopImmediatePropagation()}function ax(e){e.preventDefault(),e.stopImmediatePropagation()}var Dce=W(()=>{});function BOe(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function jOe(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Lce(){return this.__zoom||Fc}function UOe(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function VOe(){return navigator.maxTouchPoints||"ontouchstart"in this}function WOe(e,t,r){var n=e.invertX(t[0][0])-r[0][0],o=e.invertX(t[1][0])-r[1][0],i=e.invertY(t[0][1])-r[0][1],s=e.invertY(t[1][1])-r[1][1];return e.translate(o>n?(n+o)/2:Math.min(0,n)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function j2(){var e=BOe,t=jOe,r=WOe,n=UOe,o=VOe,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,u=tE,h=rl("start","zoom","end"),p,_,y,A=500,E=150,k=0,P=10;function R(Se){Se.property("__zoom",Lce).on("wheel.zoom",fe,{passive:!1}).on("mousedown.zoom",ye).on("dblclick.zoom",ve).filter(o).on("touchstart.zoom",be).on("touchmove.zoom",je).on("touchend.zoom touchcancel.zoom",Re).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}R.transform=function(Se,Ue,qe,Je){var gt=Se.selection?Se.selection():Se;gt.property("__zoom",Lce),Se!==gt?J(Se,Ue,qe,Je):gt.interrupt().each(function(){ne(this,arguments).event(Je).start().zoom(null,typeof Ue=="function"?Ue.apply(this,arguments):Ue).end()})},R.scaleBy=function(Se,Ue,qe,Je){R.scaleTo(Se,function(){var gt=this.__zoom.k,rt=typeof Ue=="function"?Ue.apply(this,arguments):Ue;return gt*rt},qe,Je)},R.scaleTo=function(Se,Ue,qe,Je){R.transform(Se,function(){var gt=t.apply(this,arguments),rt=this.__zoom,At=qe==null?j(gt):typeof qe=="function"?qe.apply(this,arguments):qe,St=rt.invert(At),kt=typeof Ue=="function"?Ue.apply(this,arguments):Ue;return r(N(V(rt,kt),At,St),gt,s)},qe,Je)},R.translateBy=function(Se,Ue,qe,Je){R.transform(Se,function(){return r(this.__zoom.translate(typeof Ue=="function"?Ue.apply(this,arguments):Ue,typeof qe=="function"?qe.apply(this,arguments):qe),t.apply(this,arguments),s)},null,Je)},R.translateTo=function(Se,Ue,qe,Je,gt){R.transform(Se,function(){var rt=t.apply(this,arguments),At=this.__zoom,St=Je==null?j(rt):typeof Je=="function"?Je.apply(this,arguments):Je;return r(Fc.translate(St[0],St[1]).scale(At.k).translate(typeof Ue=="function"?-Ue.apply(this,arguments):-Ue,typeof qe=="function"?-qe.apply(this,arguments):-qe),rt,s)},Je,gt)};function V(Se,Ue){return Ue=Math.max(i[0],Math.min(i[1],Ue)),Ue===Se.k?Se:new al(Ue,Se.x,Se.y)}function N(Se,Ue,qe){var Je=Ue[0]-qe[0]*Se.k,gt=Ue[1]-qe[1]*Se.k;return Je===Se.x&&gt===Se.y?Se:new al(Se.k,Je,gt)}function j(Se){return[(+Se[0][0]+ +Se[1][0])/2,(+Se[0][1]+ +Se[1][1])/2]}function J(Se,Ue,qe,Je){Se.on("start.zoom",function(){ne(this,arguments).event(Je).start()}).on("interrupt.zoom end.zoom",function(){ne(this,arguments).event(Je).end()}).tween("zoom",function(){var gt=this,rt=arguments,At=ne(gt,rt).event(Je),St=t.apply(gt,rt),kt=qe==null?j(St):typeof qe=="function"?qe.apply(gt,rt):qe,yt=Math.max(St[1][0]-St[0][0],St[1][1]-St[0][1]),tr=gt.__zoom,vr=typeof Ue=="function"?Ue.apply(gt,rt):Ue,wr=u(tr.invert(kt).concat(yt/tr.k),vr.invert(kt).concat(yt/vr.k));return function(Ir){if(Ir===1)Ir=vr;else{var Br=wr(Ir),qt=yt/Br[2];Ir=new al(qt,kt[0]-Br[0]*qt,kt[1]-Br[1]*qt)}At.zoom(null,Ir)}})}function ne(Se,Ue,qe){return!qe&&Se.__zooming||new de(Se,Ue)}function de(Se,Ue){this.that=Se,this.args=Ue,this.active=0,this.sourceEvent=null,this.extent=t.apply(Se,Ue),this.taps=0}de.prototype={event:function(Se){return Se&&(this.sourceEvent=Se),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(Se,Ue){return this.mouse&&Se!=="mouse"&&(this.mouse[1]=Ue.invert(this.mouse[0])),this.touch0&&Se!=="touch"&&(this.touch0[1]=Ue.invert(this.touch0[0])),this.touch1&&Se!=="touch"&&(this.touch1[1]=Ue.invert(this.touch1[0])),this.that.__zoom=Ue,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(Se){var Ue=$t(this.that).datum();h.call(Se,this.that,new j8(Se,{sourceEvent:this.sourceEvent,target:R,type:Se,transform:this.that.__zoom,dispatch:h}),Ue)}};function fe(Se,...Ue){if(!e.apply(this,arguments))return;var qe=ne(this,Ue).event(Se),Je=this.__zoom,gt=Math.max(i[0],Math.min(i[1],Je.k*Math.pow(2,n.apply(this,arguments)))),rt=Uo(Se);if(qe.wheel)(qe.mouse[0][0]!==rt[0]||qe.mouse[0][1]!==rt[1])&&(qe.mouse[1]=Je.invert(qe.mouse[0]=rt)),clearTimeout(qe.wheel);else{if(Je.k===gt)return;qe.mouse=[rt,Je.invert(rt)],Sc(this),qe.start()}ax(Se),qe.wheel=setTimeout(At,E),qe.zoom("mouse",r(N(V(Je,gt),qe.mouse[0],qe.mouse[1]),qe.extent,s));function At(){qe.wheel=null,qe.end()}}function ye(Se,...Ue){if(y||!e.apply(this,arguments))return;var qe=Se.currentTarget,Je=ne(this,Ue,!0).event(Se),gt=$t(Se.view).on("mousemove.zoom",kt,!0).on("mouseup.zoom",yt,!0),rt=Uo(Se,qe),At=Se.clientX,St=Se.clientY;Bd(Se.view),uk(Se),Je.mouse=[rt,this.__zoom.invert(rt)],Sc(this),Je.start();function kt(tr){if(ax(tr),!Je.moved){var vr=tr.clientX-At,wr=tr.clientY-St;Je.moved=vr*vr+wr*wr>k}Je.event(tr).zoom("mouse",r(N(Je.that.__zoom,Je.mouse[0]=Uo(tr,qe),Je.mouse[1]),Je.extent,s))}function yt(tr){gt.on("mousemove.zoom mouseup.zoom",null),jd(tr.view,Je.moved),ax(tr),Je.event(tr).end()}}function ve(Se,...Ue){if(e.apply(this,arguments)){var qe=this.__zoom,Je=Uo(Se.changedTouches?Se.changedTouches[0]:Se,this),gt=qe.invert(Je),rt=qe.k*(Se.shiftKey?.5:2),At=r(N(V(qe,rt),Je,gt),t.apply(this,Ue),s);ax(Se),a>0?$t(this).transition().duration(a).call(J,At,Je,Se):$t(this).call(R.transform,At,Je,Se)}}function be(Se,...Ue){if(e.apply(this,arguments)){var qe=Se.touches,Je=qe.length,gt=ne(this,Ue,Se.changedTouches.length===Je).event(Se),rt,At,St,kt;for(uk(Se),At=0;At<Je;++At)St=qe[At],kt=Uo(St,this),kt=[kt,this.__zoom.invert(kt),St.identifier],gt.touch0?!gt.touch1&&gt.touch0[2]!==kt[2]&&(gt.touch1=kt,gt.taps=0):(gt.touch0=kt,rt=!0,gt.taps=1+!!p);p&&(p=clearTimeout(p)),rt&&(gt.taps<2&&(_=kt[0],p=setTimeout(function(){p=null},A)),Sc(this),gt.start())}}function je(Se,...Ue){if(this.__zooming){var qe=ne(this,Ue).event(Se),Je=Se.changedTouches,gt=Je.length,rt,At,St,kt;for(ax(Se),rt=0;rt<gt;++rt)At=Je[rt],St=Uo(At,this),qe.touch0&&qe.touch0[2]===At.identifier?qe.touch0[0]=St:qe.touch1&&qe.touch1[2]===At.identifier&&(qe.touch1[0]=St);if(At=qe.that.__zoom,qe.touch1){var yt=qe.touch0[0],tr=qe.touch0[1],vr=qe.touch1[0],wr=qe.touch1[1],Ir=(Ir=vr[0]-yt[0])*Ir+(Ir=vr[1]-yt[1])*Ir,Br=(Br=wr[0]-tr[0])*Br+(Br=wr[1]-tr[1])*Br;At=V(At,Math.sqrt(Ir/Br)),St=[(yt[0]+vr[0])/2,(yt[1]+vr[1])/2],kt=[(tr[0]+wr[0])/2,(tr[1]+wr[1])/2]}else if(qe.touch0)St=qe.touch0[0],kt=qe.touch0[1];else return;qe.zoom("touch",r(N(At,St,kt),qe.extent,s))}}function Re(Se,...Ue){if(this.__zooming){var qe=ne(this,Ue).event(Se),Je=Se.changedTouches,gt=Je.length,rt,At;for(uk(Se),y&&clearTimeout(y),y=setTimeout(function(){y=null},A),rt=0;rt<gt;++rt)At=Je[rt],qe.touch0&&qe.touch0[2]===At.identifier?delete qe.touch0:qe.touch1&&qe.touch1[2]===At.identifier&&delete qe.touch1;if(qe.touch1&&!qe.touch0&&(qe.touch0=qe.touch1,delete qe.touch1),qe.touch0)qe.touch0[1]=this.__zoom.invert(qe.touch0[0]);else if(qe.end(),qe.taps===2&&(At=Uo(At,this),Math.hypot(_[0]-At[0],_[1]-At[1])<P)){var St=$t(this).on("dblclick.zoom");St&&St.apply(this,arguments)}}}return R.wheelDelta=function(Se){return arguments.length?(n=typeof Se=="function"?Se:F2(+Se),R):n},R.filter=function(Se){return arguments.length?(e=typeof Se=="function"?Se:F2(!!Se),R):e},R.touchable=function(Se){return arguments.length?(o=typeof Se=="function"?Se:F2(!!Se),R):o},R.extent=function(Se){return arguments.length?(t=typeof Se=="function"?Se:F2([[+Se[0][0],+Se[0][1]],[+Se[1][0],+Se[1][1]]]),R):t},R.scaleExtent=function(Se){return arguments.length?(i[0]=+Se[0],i[1]=+Se[1],R):[i[0],i[1]]},R.translateExtent=function(Se){return arguments.length?(s[0][0]=+Se[0][0],s[1][0]=+Se[1][0],s[0][1]=+Se[0][1],s[1][1]=+Se[1][1],R):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},R.constrain=function(Se){return arguments.length?(r=Se,R):r},R.duration=function(Se){return arguments.length?(a=+Se,R):a},R.interpolate=function(Se){return arguments.length?(u=Se,R):u},R.on=function(){var Se=h.on.apply(h,arguments);return Se===h?R:Se},R.clickDistance=function(Se){return arguments.length?(k=(Se=+Se)*Se,R):Math.sqrt(k)},R.tapDistance=function(Se){return arguments.length?(P=+Se,R):P},R}var Fce=W(()=>{Ld();R3();nl();Fs();pE();Nce();zce();U8();Dce()});var Bce={};io(Bce,{ZoomTransform:()=>al,zoom:()=>j2,zoomIdentity:()=>Fc,zoomTransform:()=>B2});var V8=W(()=>{Fce();U8()});var zi={};io(zi,{Adder:()=>ci,Delaunay:()=>fw,FormatSpecifier:()=>pw,InternMap:()=>Rl,InternSet:()=>aa,Node:()=>zu,Path:()=>Cu,Voronoi:()=>Ig,ZoomTransform:()=>al,active:()=>hte,arc:()=>v2,area:()=>A2,areaRadial:()=>ek,ascending:()=>Un,autoType:()=>LR,axisBottom:()=>XK,axisLeft:()=>KK,axisRight:()=>HK,axisTop:()=>GK,bin:()=>T1,bisect:()=>sa,bisectCenter:()=>YR,bisectLeft:()=>ZR,bisectRight:()=>LT,bisector:()=>qf,blob:()=>Gz,blur:()=>GR,blur2:()=>v1,blurImage:()=>HR,brush:()=>Ez,brushSelection:()=>Mz,brushX:()=>Sz,brushY:()=>Tz,buffer:()=>Hz,chord:()=>Tte,chordDirected:()=>Ite,chordTranspose:()=>Ete,cluster:()=>Poe,color:()=>Vo,contourDensity:()=>$te,contours:()=>sw,count:()=>wu,create:()=>IN,creator:()=>Xf,cross:()=>FT,csv:()=>Xz,csvFormat:()=>LX,csvFormatBody:()=>FX,csvFormatRow:()=>jX,csvFormatRows:()=>BX,csvFormatValue:()=>UX,csvParse:()=>zT,csvParseRows:()=>DX,cubehelix:()=>Bs,cumsum:()=>BT,curveBasis:()=>c8,curveBasisClosed:()=>u8,curveBasisOpen:()=>f8,curveBumpX:()=>M2,curveBumpY:()=>S2,curveBundle:()=>h8,curveCardinal:()=>d8,curveCardinalClosed:()=>p8,curveCardinalOpen:()=>g8,curveCatmullRom:()=>y8,curveCatmullRomClosed:()=>x8,curveCatmullRomOpen:()=>b8,curveLinear:()=>gh,curveLinearClosed:()=>v8,curveMonotoneX:()=>A8,curveMonotoneY:()=>M8,curveNatural:()=>S8,curveStep:()=>T8,curveStepAfter:()=>I8,curveStepBefore:()=>E8,descending:()=>Z0,deviation:()=>H0,difference:()=>m3,disjoint:()=>g3,dispatch:()=>rl,drag:()=>hg,dragDisable:()=>Bd,dragEnable:()=>jd,dsv:()=>AE,dsvFormat:()=>Id,easeBack:()=>mz,easeBackIn:()=>nte,easeBackInOut:()=>mz,easeBackOut:()=>ite,easeBounce:()=>dy,easeBounceIn:()=>ete,easeBounceInOut:()=>tte,easeBounceOut:()=>dy,easeCircle:()=>hz,easeCircleIn:()=>$ee,easeCircleInOut:()=>hz,easeCircleOut:()=>Qee,easeCubic:()=>rw,easeCubicIn:()=>Fee,easeCubicInOut:()=>rw,easeCubicOut:()=>tw,easeElastic:()=>yz,easeElasticIn:()=>ste,easeElasticInOut:()=>ate,easeElasticOut:()=>yz,easeExp:()=>fz,easeExpIn:()=>Hee,easeExpInOut:()=>fz,easeExpOut:()=>Xee,easeLinear:()=>Ree,easePoly:()=>lz,easePolyIn:()=>jee,easePolyInOut:()=>lz,easePolyOut:()=>Uee,easeQuad:()=>sz,easeQuadIn:()=>zee,easeQuadInOut:()=>sz,easeQuadOut:()=>Dee,easeSin:()=>cz,easeSinIn:()=>Yee,easeSinInOut:()=>cz,easeSinOut:()=>qee,every:()=>l3,extent:()=>Au,fcumsum:()=>eN,filter:()=>u3,flatGroup:()=>nN,flatRollup:()=>iN,forceCenter:()=>vre,forceCollide:()=>ene,forceLink:()=>nne,forceManyBody:()=>une,forceRadial:()=>hne,forceSimulation:()=>cne,forceX:()=>pne,forceY:()=>gne,format:()=>Ic,formatDefaultLocale:()=>CE,formatLocale:()=>EE,formatPrefix:()=>mw,formatSpecifier:()=>Ec,fsum:()=>JR,geoAlbers:()=>yI,geoAlbersUsa:()=>ioe,geoArea:()=>Vne,geoAzimuthalEqualArea:()=>soe,geoAzimuthalEqualAreaRaw:()=>bI,geoAzimuthalEquidistant:()=>loe,geoAzimuthalEquidistantRaw:()=>vI,geoBounds:()=>Kne,geoCentroid:()=>nie,geoCircle:()=>uie,geoClipAntimeridian:()=>Tw,geoClipCircle:()=>eI,geoClipExtent:()=>pie,geoClipRectangle:()=>lh,geoConicConformal:()=>foe,geoConicConformalRaw:()=>aL,geoConicEqualArea:()=>Fg,geoConicEqualAreaRaw:()=>iL,geoConicEquidistant:()=>poe,geoConicEquidistantRaw:()=>cL,geoContains:()=>wie,geoDistance:()=>Cy,geoEqualEarth:()=>goe,geoEqualEarthRaw:()=>SI,geoEquirectangular:()=>doe,geoEquirectangularRaw:()=>jg,geoGnomonic:()=>yoe,geoGnomonicRaw:()=>TI,geoGraticule:()=>sI,geoGraticule10:()=>Tie,geoIdentity:()=>boe,geoInterpolate:()=>Iie,geoLength:()=>iI,geoMercator:()=>uoe,geoMercatorRaw:()=>Bg,geoNaturalEarth1:()=>woe,geoNaturalEarth1Raw:()=>EI,geoOrthographic:()=>Moe,geoOrthographicRaw:()=>II,geoPath:()=>Kie,geoProjection:()=>vo,geoProjectionMutator:()=>zw,geoRotation:()=>HE,geoStereographic:()=>Toe,geoStereographicRaw:()=>CI,geoStream:()=>os,geoTransform:()=>Qie,geoTransverseMercator:()=>Ioe,geoTransverseMercatorRaw:()=>kI,gray:()=>GQ,greatest:()=>J0,greatestIndex:()=>n3,group:()=>X0,groupSort:()=>VT,groups:()=>jT,hcl:()=>ay,hierarchy:()=>ch,histogram:()=>T1,hsl:()=>oy,html:()=>tD,image:()=>$z,index:()=>oN,indexes:()=>sN,interpolate:()=>$i,interpolateArray:()=>aJ,interpolateBasis:()=>W3,interpolateBasisClosed:()=>Y3,interpolateBlues:()=>_9,interpolateBrBG:()=>$F,interpolateBuGn:()=>o9,interpolateBuPu:()=>s9,interpolateCividis:()=>A9,interpolateCool:()=>T9,interpolateCubehelix:()=>OJ,interpolateCubehelixDefault:()=>M9,interpolateCubehelixLong:()=>xg,interpolateDate:()=>X3,interpolateDiscrete:()=>lJ,interpolateGnBu:()=>a9,interpolateGreens:()=>y9,interpolateGreys:()=>x9,interpolateHcl:()=>IJ,interpolateHclLong:()=>CJ,interpolateHsl:()=>AJ,interpolateHslLong:()=>MJ,interpolateHue:()=>uJ,interpolateInferno:()=>O9,interpolateLab:()=>tz,interpolateMagma:()=>P9,interpolateNumber:()=>ns,interpolateNumberArray:()=>cy,interpolateObject:()=>K3,interpolateOrRd:()=>l9,interpolateOranges:()=>w9,interpolatePRGn:()=>QF,interpolatePiYG:()=>JF,interpolatePlasma:()=>R9,interpolatePuBu:()=>u9,interpolatePuBuGn:()=>c9,interpolatePuOr:()=>e9,interpolatePuRd:()=>f9,interpolatePurples:()=>b9,interpolateRainbow:()=>E9,interpolateRdBu:()=>t9,interpolateRdGy:()=>r9,interpolateRdPu:()=>h9,interpolateRdYlBu:()=>n9,interpolateRdYlGn:()=>i9,interpolateReds:()=>v9,interpolateRgb:()=>Zd,interpolateRgbBasis:()=>q3,interpolateRgbBasisClosed:()=>sJ,interpolateRound:()=>Yd,interpolateSinebow:()=>I9,interpolateSpectral:()=>x2,interpolateString:()=>uy,interpolateTransformCss:()=>J3,interpolateTransformSvg:()=>eE,interpolateTurbo:()=>C9,interpolateViridis:()=>k9,interpolateWarm:()=>S9,interpolateYlGn:()=>p9,interpolateYlGnBu:()=>d9,interpolateYlOrBr:()=>m9,interpolateYlOrRd:()=>g9,interpolateZoom:()=>tE,interrupt:()=>Sc,intersection:()=>_3,interval:()=>UJ,isoFormat:()=>Uae,isoParse:()=>Vae,json:()=>Qz,lab:()=>gg,lch:()=>XQ,least:()=>r3,leastIndex:()=>ey,line:()=>_h,lineRadial:()=>JC,link:()=>ex,linkHorizontal:()=>Z9,linkRadial:()=>q9,linkVertical:()=>Y9,local:()=>D1,map:()=>f3,matcher:()=>cg,max:()=>za,maxIndex:()=>Rd,mean:()=>$T,median:()=>QT,medianIndex:()=>pN,merge:()=>Dd,min:()=>tl,minIndex:()=>Nd,mode:()=>JT,namespace:()=>vc,namespaces:()=>ny,nice:()=>Pd,now:()=>qd,pack:()=>gse,packEnclose:()=>ase,packSiblings:()=>dse,pairs:()=>e3,partition:()=>LI,path:()=>_y,pathRound:()=>Fz,permute:()=>$0,pie:()=>F9,piecewise:()=>Y1,pointRadial:()=>gp,pointer:()=>Uo,pointers:()=>ON,polygonArea:()=>Ose,polygonCentroid:()=>Nse,polygonContains:()=>Use,polygonHull:()=>Bse,polygonLength:()=>Wse,precisionFixed:()=>kE,precisionPrefix:()=>PE,precisionRound:()=>OE,quadtree:()=>$d,quantile:()=>bc,quantileIndex:()=>C1,quantileSorted:()=>I1,quantize:()=>zJ,quickselect:()=>zd,radialArea:()=>ek,radialLine:()=>JC,randomBates:()=>PL,randomBernoulli:()=>NL,randomBeta:()=>Zw,randomBinomial:()=>Yw,randomCauchy:()=>BL,randomExponential:()=>OL,randomGamma:()=>Vg,randomGeometric:()=>Ww,randomInt:()=>IL,randomIrwinHall:()=>Vw,randomLcg:()=>YI,randomLogNormal:()=>CL,randomLogistic:()=>jL,randomNormal:()=>Ug,randomPareto:()=>RL,randomPoisson:()=>UL,randomUniform:()=>EL,randomWeibull:()=>FL,range:()=>ca,rank:()=>t3,reduce:()=>h3,reverse:()=>p3,rgb:()=>Qf,ribbon:()=>Fte,ribbonArrow:()=>Bte,rollup:()=>A1,rollups:()=>UT,scaleBand:()=>Vl,scaleDiverging:()=>_2,scaleDivergingLog:()=>_C,scaleDivergingPow:()=>y2,scaleDivergingSqrt:()=>FF,scaleDivergingSymlog:()=>yC,scaleIdentity:()=>Gw,scaleImplicit:()=>qw,scaleLinear:()=>Oc,scaleLog:()=>Kw,scaleOrdinal:()=>sl,scalePoint:()=>ZL,scalePow:()=>Wy,scaleQuantile:()=>t2,scaleQuantize:()=>r2,scaleRadial:()=>e2,scaleSequential:()=>mh,scaleSequentialLog:()=>pC,scaleSequentialPow:()=>m2,scaleSequentialQuantile:()=>g2,scaleSequentialSqrt:()=>DF,scaleSequentialSymlog:()=>mC,scaleSqrt:()=>XL,scaleSymlog:()=>Qw,scaleThreshold:()=>n2,scaleTime:()=>Gy,scaleUtc:()=>hC,scan:()=>i3,schemeAccent:()=>UF,schemeBlues:()=>jC,schemeBrBG:()=>xC,schemeBuGn:()=>IC,schemeBuPu:()=>CC,schemeCategory10:()=>jF,schemeDark2:()=>VF,schemeGnBu:()=>kC,schemeGreens:()=>UC,schemeGreys:()=>VC,schemeObservable10:()=>WF,schemeOrRd:()=>PC,schemeOranges:()=>YC,schemePRGn:()=>bC,schemePaired:()=>ZF,schemePastel1:()=>YF,schemePastel2:()=>qF,schemePiYG:()=>vC,schemePuBu:()=>RC,schemePuBuGn:()=>OC,schemePuOr:()=>wC,schemePuRd:()=>NC,schemePurples:()=>WC,schemeRdBu:()=>AC,schemeRdGy:()=>MC,schemeRdPu:()=>zC,schemeRdYlBu:()=>SC,schemeRdYlGn:()=>TC,schemeReds:()=>ZC,schemeSet1:()=>GF,schemeSet2:()=>HF,schemeSet3:()=>XF,schemeSpectral:()=>EC,schemeTableau10:()=>KF,schemeYlGn:()=>LC,schemeYlGnBu:()=>DC,schemeYlOrBr:()=>FC,schemeYlOrRd:()=>BC,select:()=>$t,selectAll:()=>L1,selection:()=>wc,selector:()=>Kf,selectorAll:()=>lg,shuffle:()=>gN,shuffler:()=>o3,some:()=>c3,sort:()=>ag,stack:()=>C8,stackOffsetDiverging:()=>P8,stackOffsetExpand:()=>k8,stackOffsetNone:()=>Hl,stackOffsetSilhouette:()=>O8,stackOffsetWiggle:()=>R8,stackOrderAppearance:()=>D2,stackOrderAscending:()=>L2,stackOrderDescending:()=>D8,stackOrderInsideOut:()=>L8,stackOrderNone:()=>Xl,stackOrderReverse:()=>F8,stratify:()=>vse,style:()=>Mu,subset:()=>y3,sum:()=>s3,superset:()=>ry,svg:()=>rD,symbol:()=>rx,symbolAsterisk:()=>T2,symbolCircle:()=>Zl,symbolCross:()=>_p,symbolDiamond:()=>yp,symbolDiamond2:()=>E2,symbolPlus:()=>I2,symbolSquare:()=>xp,symbolSquare2:()=>C2,symbolStar:()=>bp,symbolTimes:()=>tx,symbolTriangle:()=>vp,symbolTriangle2:()=>k2,symbolWye:()=>wp,symbolX:()=>tx,symbols:()=>rk,symbolsFill:()=>rk,symbolsStroke:()=>l8,text:()=>Kd,thresholdFreedmanDiaconis:()=>XT,thresholdScott:()=>KT,thresholdSturges:()=>Od,tickFormat:()=>Vy,tickIncrement:()=>Nl,tickStep:()=>kd,ticks:()=>la,timeDay:()=>Rc,timeDays:()=>sF,timeFormat:()=>d2,timeFormatDefaultLocale:()=>lC,timeFormatLocale:()=>h2,timeFriday:()=>eC,timeFridays:()=>pF,timeHour:()=>lp,timeHours:()=>nF,timeInterval:()=>ui,timeMillisecond:()=>hh,timeMilliseconds:()=>KI,timeMinute:()=>sp,timeMinutes:()=>eF,timeMonday:()=>up,timeMondays:()=>uF,timeMonth:()=>hp,timeMonths:()=>AF,timeParse:()=>OF,timeSaturday:()=>tC,timeSaturdays:()=>mF,timeSecond:()=>La,timeSeconds:()=>$I,timeSunday:()=>Nc,timeSundays:()=>rC,timeThursday:()=>Uu,timeThursdays:()=>dF,timeTickInterval:()=>l2,timeTicks:()=>a2,timeTuesday:()=>QI,timeTuesdays:()=>fF,timeWednesday:()=>JI,timeWednesdays:()=>hF,timeWeek:()=>Nc,timeWeeks:()=>rC,timeYear:()=>_a,timeYears:()=>TF,timeout:()=>K1,timer:()=>wg,timerFlush:()=>nz,transition:()=>hE,transpose:()=>ty,tree:()=>Ase,treemap:()=>UI,treemapBinary:()=>VI,treemapDice:()=>Du,treemapResquarify:()=>Cse,treemapSlice:()=>ip,treemapSliceDice:()=>Ese,treemapSquarify:()=>BI,tsv:()=>Kz,tsvFormat:()=>ZX,tsvFormatBody:()=>YX,tsvFormatRow:()=>GX,tsvFormatRows:()=>qX,tsvFormatValue:()=>HX,tsvParse:()=>DT,tsvParseRows:()=>WX,union:()=>x3,unixDay:()=>Zy,unixDays:()=>lF,utcDay:()=>dh,utcDays:()=>aF,utcFormat:()=>Xg,utcFriday:()=>oC,utcFridays:()=>bF,utcHour:()=>cp,utcHours:()=>iF,utcMillisecond:()=>hh,utcMilliseconds:()=>KI,utcMinute:()=>ap,utcMinutes:()=>tF,utcMonday:()=>fp,utcMondays:()=>gF,utcMonth:()=>dp,utcMonths:()=>MF,utcParse:()=>p2,utcSaturday:()=>sC,utcSaturdays:()=>vF,utcSecond:()=>La,utcSeconds:()=>$I,utcSunday:()=>zc,utcSundays:()=>aC,utcThursday:()=>Vu,utcThursdays:()=>xF,utcTickInterval:()=>s2,utcTicks:()=>o2,utcTuesday:()=>nC,utcTuesdays:()=>_F,utcWednesday:()=>iC,utcWednesdays:()=>yF,utcWeek:()=>zc,utcWeeks:()=>aC,utcYear:()=>ya,utcYears:()=>EF,variance:()=>G0,window:()=>ug,xml:()=>eD,zip:()=>a3,zoom:()=>j2,zoomIdentity:()=>Fc,zoomTransform:()=>B2});var Qn=W(()=>{ki();QK();Cz();Ute();Dl();Jte();hre();Ld();R3();FR();xz();nD();yne();RE();koe();Pse();nl();ow();Yse();SE();VL();BF();N9();Fs();B8();Yy();uC();$1();pE();V8()});var Uce,jce=W(()=>{Uce="./perspective-server-PVM27NVE.wasm"});function Vce(){return fetch(new URL("./perspective-server-PVM27NVE.wasm",import.meta.url))}var Wce=W(()=>{jce()});var Z8,Zce=W(()=>{Z8='(()=>{var Te=Object.defineProperty;var Ye=(o,p,_)=>p in o?Te(o,p,{enumerable:!0,configurable:!0,writable:!0,value:_}):o[p]=_;var F=(o,p,_)=>Ye(o,typeof p!="symbol"?p+"":p,_);var N=class{constructor(p){F(this,"clients");F(this,"id_gen");F(this,"server");F(this,"module");this.clients=new Map,this.id_gen=0,this.module=p,this.server=p._psp_new_server()}make_session(p){let _=this.module._psp_new_session(this.server);return this.clients.set(_,p),new X(this.module,this.server,_,this.clients)}delete(){this.module._psp_delete_server(this.server)}},X=class{constructor(p,_,n,l){this.mod=p;this.server=_;this.client_id=n;this.client_map=l}async handle_request(p){let _=await $e(this.mod,p,async n=>this.mod._psp_handle_request(this.server,this.client_id,n,p.byteLength));await Me(this.mod,_,async n=>{await this.client_map.get(n.client_id)(n.data)})}poll(){let p=this.mod._psp_poll(this.server);Me(this.mod,p,async _=>{await this.client_map.get(_.client_id)(_.data)})}close(){this.mod._psp_close_session(this.server,this.client_id)}};async function $e(o,p,_){let n=o._psp_alloc(p.byteLength);o.HEAPU8.set(p,n);let l=await _(n);return o._psp_free(n),l}function Je(o,p){let _=o.HEAPU32[p>>>2],n=o.HEAPU32[(p>>>2)+1];return new Uint32Array(o.HEAPU8.buffer,n,_*3)}async function Me(o,p,_){let n=Je(o,p);try{for(let l=0;l<n.length/3;l++){let g=n[l*3],H=n[l*3+1],S=n[l*3+2],h=new Uint8Array(o.HEAPU8.buffer,g,H);await _({client_id:S,data:h})}}finally{for(let l=0;l<n.length/3;l++){let g=n[l*3];o._psp_free(g)}o._psp_free(n.byteOffset),o._psp_free(p)}}var He={},Ge=(()=>{var o=He.url;return function(p={}){var _,n=Object.assign({},p),l,g,H=new Promise((e,t)=>{l=e,g=t});globalThis.window={};var S=Object.assign({},n),h="";typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),o&&(h=o),h.startsWith("blob:")?h="":h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1);var b=console.log.bind(console),U=console.error.bind(console);Object.assign(n,S),S=null;var ee,j=!1,T,x,d,w,te,re;function ne(){var e=ee.buffer;n.HEAP8=T=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=x=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=d=new Int32Array(e),n.HEAPU32=w=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=re=new Float64Array(e),n.HEAP64=te=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e)}var De=[],We=[],Fe=[],Re=[],se=!1,I=0,Y=null,k=null;function ae(e){throw e="Aborted("+e+")",U(e),j=!0,e+=". Build with -sASSERTIONS for more info.",se&&ge(),e=new WebAssembly.RuntimeError(e),g(e),e}var ie=e=>e.startsWith("data:application/octet-stream;base64,"),M;if(n.locateFile){if(M="perspective-server.wasm",!ie(M)){var oe=M;M=n.locateFile?n.locateFile(oe,h):h+oe}}else M=new URL("perspective-server.wasm",He.url).href;function pe(){throw"both async and sync fetching of the wasm failed"}function ze(e){return typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw`failed to load wasm binary file at \'${e}\'`;return t.arrayBuffer()}).catch(()=>pe()):Promise.resolve().then(()=>pe())}function _e(e,t,r){return ze(e).then(a=>WebAssembly.instantiate(a,t)).then(r,a=>{U(`failed to asynchronously prepare wasm: ${a}`),ae(a)})}function Ce(e,t){var r=M;return typeof WebAssembly.instantiateStreaming!="function"||ie(r)||typeof fetch!="function"?_e(r,e,t):fetch(r,{credentials:"same-origin"}).then(a=>WebAssembly.instantiateStreaming(a,e).then(t,function(s){return U(`wasm streaming compile failed: ${s}`),U("falling back to ArrayBuffer instantiation"),_e(r,e,t)}))}var Oe={962848:()=>typeof wasmOffsetConverter<"u"};function ce(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var R=e=>{for(;0<e.length;)e.shift()(n)},le=new TextDecoder("utf8"),z=e=>{if(e>>>=0,!e)return"";for(var t=e+NaN,r=e;!(r>=t)&&x[r>>>0];)++r;return le.decode(x.subarray(e>>>0,r>>>0))},ue=e=>{e=e.getArg(u.__cpp_exception,0);var t=Ee(e);e=we();var r=Z(4),a=Z(4);if(Pe(t,r,a),t=w[r>>>2>>>0],a=w[a>>>2>>>0],r=z(t),K(t),a){var s=z(a);K(a)}return Ae(e),[r,s]};n.getExceptionMessage=ue;var me;me=()=>performance.now();var $=[],J={},fe=()=>{if(!G){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"},t;for(t in J)J[t]===void 0?delete e[t]:e[t]=J[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);G=r}return G},G,Be=[null,[],[]],de=e=>{throw j=!0,new ce(e)},q=e=>e%4===0&&(e%100!==0||e%400===0),ye=(e,t)=>{for(var r=0,a=0;a<=t;r+=e[a++]);return r},C=[31,29,31,30,31,30,31,31,30,31,30,31],O=[31,28,31,30,31,30,31,31,30,31,30,31],B=(e,t)=>{for(e=new Date(e.getTime());0<t;){var r=e.getMonth(),a=(q(e.getFullYear())?C:O)[r];if(t>a-e.getDate())t-=a-e.getDate()+1,e.setDate(1),11>r?e.setMonth(r+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1));else{e.setDate(e.getDate()+t);break}}return e};function Le(e){for(var t=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);127>=a?t++:2047>=a?t+=2:55296<=a&&57343>=a?(t+=4,++r):t+=3}if(t=Array(t+1),a=t.length,r=0,0<a){a=r+a-1;for(var s=0;s<e.length;++s){var c=e.charCodeAt(s);if(55296<=c&&57343>=c){var D=e.charCodeAt(++s);c=65536+((c&1023)<<10)|D&1023}if(127>=c){if(r>=a)break;t[r++>>>0]=c}else{if(2047>=c){if(r+1>=a)break;t[r++>>>0]=192|c>>6}else{if(65535>=c){if(r+2>=a)break;t[r++>>>0]=224|c>>12}else{if(r+3>=a)break;t[r++>>>0]=240|c>>18,t[r++>>>0]=128|c>>12&63}t[r++>>>0]=128|c>>6&63}t[r++>>>0]=128|c&63}}t[r>>>0]=0}return t}var ve={HaveOffsetConverter:function(){return typeof wasmOffsetConverter<"u"},__syscall_ftruncate64:function(){},__syscall_getdents64:function(){},__throw_exception_with_stack_trace:e=>{throw e=new WebAssembly.Exception(u.__cpp_exception,[e],{traceStack:!0}),e.message=ue(e),e},clock_time_get:function(e,t,r){if(r>>>=0,e!=0&&e!=1&&e!=2&&e!=3)return 28;var a;return e===0?a=Date.now():a=me(),e=Math.round(1e6*a),d[r>>>2>>>0]=e>>>0,d[r+4>>>2>>>0]=e/Math.pow(2,32)>>>0,0},emscripten_asm_const_int:function(e,t,r){e>>>=0,t>>>=0,r>>>=0,$.length=0;for(var a;a=x[t++>>>0];){var s=a!=105;s&=a!=112,r+=s&&r%8?4:0,$.push(a==112?w[r>>>2>>>0]:a==106?te[r>>>3]:a==105?d[r>>>2>>>0]:re[r>>>3>>>0]),r+=s?8:4}return Oe[e](...$)},emscripten_notify_memory_growth:function(){ne()},environ_get:function(e,t){e>>>=0,t>>>=0;var r=0;return fe().forEach((a,s)=>{var c=t+r;for(s=w[e+4*s>>>2>>>0]=c,c=0;c<a.length;++c)T[s++>>>0]=a.charCodeAt(c);T[s>>>0]=0,r+=a.length+1}),0},environ_sizes_get:function(e,t){e>>>=0,t>>>=0;var r=fe();w[e>>>2>>>0]=r.length;var a=0;return r.forEach(s=>a+=s.length+1),w[t>>>2>>>0]=a,0},fd_close:()=>52,fd_read:function(){return 52},fd_seek:function(){return 70},fd_write:function(e,t,r,a){t>>>=0,r>>>=0,a>>>=0;for(var s=0,c=0;c<r;c++){var D=w[t>>>2>>>0],m=w[t+4>>>2>>>0];t+=8;for(var y=0;y<m;y++){var f=x[D+y>>>0],E=Be[e];if(f===0||f===10){f=0,f>>>=0;for(var W=f+NaN,i=f;E[i]&&!(i>=W);)++i;f=le.decode(E.buffer?E.subarray(f,i):new Uint8Array(E.slice(f,i))),(e===1?b:U)(f),E.length=0}else E.push(f)}s+=m}return w[a>>>2>>>0]=s,0},proc_exit:de,psp_heap_size:function(){ae("missing function: psp_heap_size")},strptime:function(e,t,r){function a(){function v(A,V,Ue){return typeof A!="number"||isNaN(A)?V:A>=V?A<=Ue?A:Ue:V}return{year:v(d[r+20>>>2>>>0]+1900,1970,9999),month:v(d[r+16>>>2>>>0],0,11),day:v(d[r+12>>>2>>>0],1,31),hour:v(d[r+8>>>2>>>0],0,23),min:v(d[r+4>>>2>>>0],0,59),i:v(d[r>>>2>>>0],0,59),g:0}}e>>>=0,r>>>=0,t=z(t>>>0);for(var s=0;25>s;++s)t=t.replace(new RegExp("\\\\"+"\\\\!@#$^&*()+=-[]/{}|:<>?,."[s],"g"),"\\\\"+"\\\\!@#$^&*()+=-[]/{}|:<>?,."[s]);var c={A:"%a",B:"%b",c:"%a %b %d %H:%M:%S %Y",D:"%m\\\\/%d\\\\/%y",e:"%d",F:"%Y-%m-%d",h:"%b",R:"%H\\\\:%M",r:"%I\\\\:%M\\\\:%S\\\\s%p",T:"%H\\\\:%M\\\\:%S",x:"%m\\\\/%d\\\\/(?:%y|%Y)",X:"%H\\\\:%M\\\\:%S"},D={a:"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)",b:"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)",C:"\\\\d\\\\d",d:"0[1-9]|[1-9](?!\\\\d)|1\\\\d|2\\\\d|30|31",H:"\\\\d(?!\\\\d)|[0,1]\\\\d|20|21|22|23",I:"\\\\d(?!\\\\d)|0\\\\d|10|11|12",j:"00[1-9]|0?[1-9](?!\\\\d)|0?[1-9]\\\\d(?!\\\\d)|[1,2]\\\\d\\\\d|3[0-6]\\\\d",m:"0[1-9]|[1-9](?!\\\\d)|10|11|12",M:"0\\\\d|\\\\d(?!\\\\d)|[1-5]\\\\d",n:" ",p:"AM|am|PM|pm|A\\\\.M\\\\.|a\\\\.m\\\\.|P\\\\.M\\\\.|p\\\\.m\\\\.",S:"0\\\\d|\\\\d(?!\\\\d)|[1-5]\\\\d|60",U:"0\\\\d|\\\\d(?!\\\\d)|[1-4]\\\\d|50|51|52|53",W:"0\\\\d|\\\\d(?!\\\\d)|[1-4]\\\\d|50|51|52|53",w:"[0-6]",y:"\\\\d\\\\d",Y:"\\\\d\\\\d\\\\d\\\\d",t:" ",z:"Z|(?:[\\\\+\\\\-]\\\\d\\\\d:?(?:\\\\d\\\\d)?)"},m={P:0,O:1,$:2,K:3,aa:4,Z:5,V:6,L:7,da:8,ca:9,ba:10,N:11},y={u:0,o:1,G:2,J:3,v:4,l:5,s:6},f={o:0,G:1,J:2,v:3,l:4,s:5,u:6},E=[];t=t.replace(/%(.)/g,(v,A)=>c[A]||v).replace(/%(.)/g,(v,A)=>(v=D[A])?(E.push(A),`(${v})`):A).replace(/\\s+/g,"\\\\s*");var W=new RegExp("^"+t,"i").exec(z(e));if(W){t=a();var i;if(s=v=>{if(v=E.indexOf(v),0<=v)return W[v+1]},(i=s("S"))&&(t.i=parseInt(i)),(i=s("M"))&&(t.min=parseInt(i)),i=s("H"))t.hour=parseInt(i);else if(i=s("I")){var P=parseInt(i);(i=s("p"))&&(P+=i.toUpperCase()[0]==="P"?12:0),t.hour=P}if((i=s("Y"))?t.year=parseInt(i):(i=s("y"))&&(P=parseInt(i),P=(i=s("C"))?P+100*parseInt(i):P+(69>P?2e3:1900),t.year=P),(i=s("m"))?t.month=parseInt(i)-1:(i=s("b"))&&(t.month=m[i.substring(0,3).toUpperCase()]||0),i=s("d"))t.day=parseInt(i);else if(i=s("j"))for(y=parseInt(i),f=q(t.year),m=0;12>m;++m)i=ye(f?C:O,m-1),y<=i+(f?C:O)[m]&&(t.day=y-i);else(i=s("a"))&&(m=i.substring(0,3).toUpperCase(),(i=s("U"))?(y=y[m],f=parseInt(i),m=new Date(t.year,0,1),y=m.getDay()===0?B(m,y+7*(f-1)):B(m,7-m.getDay()+y+7*(f-1)),t.day=y.getDate(),t.month=y.getMonth()):(i=s("W"))&&(y=f[m],f=parseInt(i),m=new Date(t.year,0,1),y=m.getDay()===1?B(m,y+7*(f-1)):B(m,7-m.getDay()+1+y+7*(f-1)),t.day=y.getDate(),t.month=y.getMonth()));return(i=s("z"))&&(i.toLowerCase()==="z"?t.g=0:(s=i.match(/^((?:\\-|\\+)\\d\\d):?(\\d\\d)?/),t.g=3600*s[1],s[2]&&(t.g+=0<t.g?60*s[2]:60*-s[2]))),s=new Date(t.year,t.month,t.day,t.hour,t.min,t.i,0),d[r>>>2>>>0]=s.getSeconds(),d[r+4>>>2>>>0]=s.getMinutes(),d[r+8>>>2>>>0]=s.getHours(),d[r+12>>>2>>>0]=s.getDate(),d[r+16>>>2>>>0]=s.getMonth(),d[r+20>>>2>>>0]=s.getFullYear()-1900,d[r+24>>>2>>>0]=s.getDay(),d[r+28>>>2>>>0]=ye(q(s.getFullYear())?C:O,s.getMonth()-1)+s.getDate()-1,d[r+32>>>2>>>0]=0,d[r+36>>>2>>>0]=t.g,e+Le(W[0]).length-1}return 0}},u=function(){function e(r){return u=r.exports,u=Ne(),ee=u.memory,ne(),I--,I==0&&(Y!==null&&(clearInterval(Y),Y=null),k&&(r=k,k=null,r())),u}var t={env:ve,wasi_snapshot_preview1:ve};if(I++,n.instantiateWasm)try{return n.instantiateWasm(t,e)}catch(r){U(`Module.instantiateWasm callback failed with error: ${r}`),g(r)}return Ce(t,function(r){e(r.instance)}).catch(g),{}}();n._psp_new_server=()=>(n._psp_new_server=u.psp_new_server)(),n._psp_handle_request=(e,t,r,a)=>(n._psp_handle_request=u.psp_handle_request)(e,t,r,a),n._psp_poll=e=>(n._psp_poll=u.psp_poll)(e),n._psp_new_session=e=>(n._psp_new_session=u.psp_new_session)(e),n._psp_close_session=(e,t)=>(n._psp_close_session=u.psp_close_session)(e,t),n._psp_alloc=e=>(n._psp_alloc=u.psp_alloc)(e),n._psp_free=e=>(n._psp_free=u.psp_free)(e);var K=e=>(K=u.free)(e);n._psp_delete_server=e=>(n._psp_delete_server=u.psp_delete_server)(e);var he=n.__initialize=()=>(he=n.__initialize=u._initialize)(),ge=()=>(ge=u.__trap)(),Ae=e=>(Ae=u._emscripten_stack_restore)(e),Z=e=>(Z=u._emscripten_stack_alloc)(e),we=()=>(we=u.emscripten_stack_get_current)(),Ee=e=>(Ee=u.__thrown_object_from_unwind_exception)(e),Pe=(e,t,r)=>(Pe=u.__get_exception_message)(e,t,r);n.___start_em_js=962905,n.___stop_em_js=962966;function Ne(){var e=u;return e=Object.assign({},e),e._emscripten_stack_alloc=(t=>r=>t(r)>>>0)(e._emscripten_stack_alloc),e.emscripten_stack_get_current=(t=>()=>t()>>>0)(e.emscripten_stack_get_current),e}var L;k=function e(){L||be(),L||(k=e)};function be(){if(!(0<I||(R(De),0<I||L||(L=!0,n.calledRun=!0,j)))){if(se=!0,R(We),R(Fe),l(n),je){var e=he;try{e(),de(0)}catch(t){if(!(t instanceof ce||t=="unwind"))throw t}}R(Re)}}var je=!0;return be(),_=H,_}})(),Se=Ge;if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");async function Ke(o){return o instanceof Function&&(o=await o()),o instanceof Response?await WebAssembly.instantiateStreaming(o):await WebAssembly.instantiate(o)}async function xe(o){let _=(await Ke(o)).instance.exports,n=_.size(),l=_.offset();return new Uint8Array(_.memory.buffer).slice(l,l+n)}async function Ie(o){let p=await Se({locateFile(_){return _},instantiateWasm:async(_,n)=>{let l=await xe(o);_.env={..._.env,psp_stack_trace(){let H=Error().stack||"",h=new TextEncoder().encode(H),b=p._psp_alloc(h.byteLength+1);return p.HEAPU8.set(h,b),p.HEAPU8[b+h.byteLength]=0,b},psp_heap_size(){return p.HEAP8.buffer.byteLength}};let g=await WebAssembly.instantiate(l,_);return n(g.instance),g.instance.exports}});return p}var ke,Q;self.addEventListener("message",async o=>{if(o.data.cmd==="init"){let p=o.data.id,_=await Ie(o.data.args[0]);ke=new N(_),Q=ke.make_session(async n=>{let l=n.slice().buffer;self.postMessage(l,{transfer:[l]})}),self.postMessage({id:p})}else Q.handle_request(new Uint8Array(o.data)),setTimeout(()=>Q.poll())});})();\n'});function Yce(e,t){function r(i,s){e.push(s)}function n(i){let s=e.indexOf(i);s>-1&&e.splice(s,1)}function o(i){for(let s of t)s({data:i})}return{addEventListener:r,removeEventListener:n,postMessage:o,location:{href:""}}}function XOe(e){console.error("Running perspective in single-threaded mode");let t=Function("const self = arguments[0];"+e),r=[],n=[];return t(Yce(r,n)),Yce(n,r)}var KOe,qce,Gce=W(()=>{Zce();KOe=async function(){try{if(window.location.protocol.startsWith("file"))return console.warn("file:// protocol does not support Web Workers"),XOe(Z8);{let e=new Blob([Z8],{type:"application/javascript"}),t=URL.createObjectURL(e);return new Worker(t,{type:"module"})}}catch(e){console.error("Error instantiating engine",e)}},qce=KOe});var $ce={};io($ce,{compile_perspective:()=>Y8,default:()=>e6e,websocket:()=>Xce,worker:()=>Kce});function Hce(){let e,t=new Promise(r=>{e=r});return[e,t]}async function $Oe(e,t){let[r,n]=Hce();e.addEventListener("message",function o(i){e.removeEventListener("message",o),r(null)}),e.postMessage({cmd:"init",args:[t]},{transfer:[t]}),await n}async function QOe(e){let[t,r]=await Promise.all([Vce().then(i=>i instanceof Response?i.arrayBuffer():i.slice(0)),qce()]),{Client:n}=await e,o=new n(i=>{let s=i.slice().buffer;r.postMessage(s,{transfer:[s]})},()=>{console.debug("Closing WebWorker"),r.terminate()});return await $Oe(r,t),r.addEventListener("message",i=>{o.handle_response(i.data)}),await o.init(),o}async function JOe(e,t){let r=new WebSocket(t),[n,o]=Hce();r.onopen=n,r.binaryType="arraybuffer",await o;let{Client:i}=await e,s=new i(a=>{let u=a.slice().buffer;r.send(u)},()=>{console.debug("Closing WebSocket"),r.close()});return r.onmessage=a=>{s.handle_response(a.data)},await s.init(),s}async function Y8(){let e=customElements.get("perspective-viewer");return e||(console.warn("No `<perspective-viewer>` Custom Element found, waiting"),await customElements.whenDefined("perspective-viewer"),e=customElements.get("perspective-viewer")),e.__wasm_module__}async function Xce(e){let t=Y8();return await JOe(t,e)}async function Kce(){let e=Y8();return await QOe(e)}var e6e,Qce=W(()=>{Wce();Gce();e6e={websocket:Xce,worker:Kce}});var eue,Jce=W(()=>{eue="./perspective-viewer-W3PX5VIL.wasm"});function tue(){return fetch(new URL("./perspective-viewer-W3PX5VIL.wasm",import.meta.url))}var rue=W(()=>{Jce()});async function r6e(e){return e instanceof Function&&(e=await e()),e instanceof Response?await WebAssembly.instantiateStreaming(e):await WebAssembly.instantiate(e)}async function nue(e){let r=(await r6e(e)).instance.exports,n=r.size(),o=r.offset();return new Uint8Array(r.memory.buffer).slice(o,o+n)}var iue=W(()=>{if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.")});var vue={};io(vue,{HTMLPerspectiveViewerPluginElement:()=>o6e});function c6e(e,t,r,n){let o=e[r],i=o.prototype;class s extends HTMLElement{constructor(){super(),this._instance=new o(this)}}let a=Object.getOwnPropertyNames(i);for(let u of a)"get"in Object.getOwnPropertyDescriptor(i,u)?Object.defineProperty(s.prototype,u,{get:function(){return this._instance[u]}}):Object.defineProperty(s.prototype,u,{value:function(...h){return this._instance[u].call(this._instance,...h)}});for(let u of n)Object.defineProperty(s,u,{value:function(...h){return e[u].call(e,...h)}});Object.defineProperty(s,"__wasm_module__",{get(){return e}}),customElements.define(t,s)}function Ie(e){return Bc[e]}function Mr(e){return e==null}function due(){return(V2===null||V2.byteLength===0)&&(V2=new Float64Array(et.memory.buffer)),V2}function ur(){return(W2===null||W2.byteLength===0)&&(W2=new Int32Array(et.memory.buffer)),W2}function hk(){return(Z2===null||Z2.byteLength===0)&&(Z2=new Uint8Array(et.memory.buffer)),Z2}function Ri(e,t,r){if(r===void 0){let a=dk.encode(e),u=t(a.length,1)>>>0;return hk().subarray(u,u+a.length).set(a),ai=a.length,u}let n=e.length,o=t(n,1)>>>0,i=hk(),s=0;for(;s<n;s++){let a=e.charCodeAt(s);if(a>127)break;i[o+s]=a}if(s!==n){s!==0&&(e=e.slice(s)),o=r(o,n,n=s+e.length*3,1)>>>0;let a=hk().subarray(o+s,o+n);s+=u6e(e,a).written,o=r(o,n,s,1)>>>0}return ai=s,o}function Jr(e,t){return e=e>>>0,pue.decode(hk().subarray(e,e+t))}function pt(e){G2===Bc.length&&Bc.push(Bc.length+1);let t=G2;return G2=Bc[t],Bc[t]=e,t}function f6e(e){e<132||(Bc[e]=G2,G2=e)}function Jt(e){let t=Ie(e);return f6e(e),t}function h6e(){return(Y2===null||Y2.byteLength===0)&&(Y2=new BigInt64Array(et.memory.buffer)),Y2}function G8(e){let t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){let o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){let o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){let o=e.length,i="[";o>0&&(i+=G8(e[0]));for(let s=1;s<o;s++)i+=", "+G8(e[s]);return i+="]",i}let r=/\[object ([^\]]+)\]/.exec(toString.call(e)),n;if(r.length>1)n=r[1];else return toString.call(e);if(n=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:n}function U2(e,t,r,n){let o={a:e,b:t,cnt:1,dtor:r},i=(...s)=>{o.cnt++;let a=o.a;o.a=0;try{return n(a,o.b,...s)}finally{--o.cnt===0?(et.__wbindgen_export_2.get(o.dtor)(a,o.b),mk.unregister(o)):o.a=a}};return i.original=o,mk.register(i,o,o),i}function d6e(e,t){try{let o=et.__wbindgen_add_to_stack_pointer(-16);et.__wbindgen_export_3(o,e,t);var r=ur()[o/4+0],n=ur()[o/4+1];if(n)throw Jt(r)}finally{et.__wbindgen_add_to_stack_pointer(16)}}function sue(e,t,r){et.__wbindgen_export_4(e,t,pt(r))}function q8(e,t,r,n){let o={a:e,b:t,cnt:1,dtor:r},i=(...s)=>{o.cnt++;try{return n(o.a,o.b,...s)}finally{--o.cnt===0&&(et.__wbindgen_export_2.get(o.dtor)(o.a,o.b),o.a=0,mk.unregister(o))}};return i.original=o,mk.register(i,o,o),i}function aue(e,t,r){et.__wbindgen_export_5(e,t,pt(r))}function p6e(e){if(pk==1)throw new Error("out of js stack");return Bc[--pk]=e,pk}function m6e(e,t,r){try{et.__wbindgen_export_6(e,t,p6e(r))}finally{Bc[pk++]=void 0}}function g6e(e,t){et.__wbindgen_export_7(e,t)}function _6e(e,t,r){et.__wbindgen_export_8(e,t,pt(r))}function lue(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`);return e.ptr}function mue(){return(q2===null||q2.byteLength===0)&&(q2=new Uint32Array(et.memory.buffer)),q2}function y6e(e,t){let r=t(e.length*4,4)>>>0,n=mue();for(let o=0;o<e.length;o++)n[r/4+o]=pt(e[o]);return ai=e.length,r}function Tr(e,t){try{return e.apply(this,t)}catch(r){et.__wbindgen_export_10(pt(r))}}function x6e(e){let t=Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai;et.registerPlugin(t,r)}function gue(){et.init()}function b6e(e,t){e=e>>>0;let r=mue().subarray(e/4,e/4+t),n=[];for(let o=0;o<r.length;o++)n.push(Jt(r[o]));return n}function v6e(e,t,r,n){et.__wbindgen_export_11(e,t,pt(r),pt(n))}async function D6e(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}let r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{let r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function _ue(){let e={};return e.wbg={},e.wbg.__wbindgen_is_undefined=function(t){return Ie(t)===void 0},e.wbg.__wbindgen_in=function(t,r){return Ie(t)in Ie(r)},e.wbg.__wbindgen_number_get=function(t,r){let n=Ie(r),o=typeof n=="number"?n:void 0;due()[t/8+1]=Mr(o)?0:o,ur()[t/4+0]=!Mr(o)},e.wbg.__wbindgen_boolean_get=function(t){let r=Ie(t);return typeof r=="boolean"?r?1:0:2},e.wbg.__wbindgen_string_get=function(t,r){let n=Ie(r),o=typeof n=="string"?n:void 0;var i=Mr(o)?0:Ri(o,et.__wbindgen_export_0,et.__wbindgen_export_1),s=ai;ur()[t/4+1]=s,ur()[t/4+0]=i},e.wbg.__wbindgen_is_object=function(t){let r=Ie(t);return typeof r=="object"&&r!==null},e.wbg.__wbindgen_is_string=function(t){return typeof Ie(t)=="string"},e.wbg.__wbindgen_error_new=function(t,r){let n=new Error(Jr(t,r));return pt(n)},e.wbg.__wbg_static_accessor_PSP_28f219c33fcb7343=function(){return pt(hue)},e.wbg.__wbindgen_object_clone_ref=function(t){let r=Ie(t);return pt(r)},e.wbg.__wbindgen_jsval_eq=function(t,r){return Ie(t)===Ie(r)},e.wbg.__wbindgen_string_new=function(t,r){let n=Jr(t,r);return pt(n)},e.wbg.__wbindgen_object_drop_ref=function(t){Jt(t)},e.wbg.__wbindgen_is_bigint=function(t){return typeof Ie(t)=="bigint"},e.wbg.__wbindgen_bigint_from_i64=function(t){return pt(t)},e.wbg.__wbindgen_bigint_from_u64=function(t){let r=BigInt.asUintN(64,t);return pt(r)},e.wbg.__wbindgen_cb_drop=function(t){let r=Jt(t).original;return r.cnt--==1?(r.a=0,!0):!1},e.wbg.__wbindgen_number_new=function(t){return pt(t)},e.wbg.__wbindgen_is_null=function(t){return Ie(t)===null},e.wbg.__wbg_draw_ec030ec79749074e=function(){return Tr(function(t,r,n,o,i,s,a){let u=Ie(t).draw(jc.__wrap(r),n===0?void 0:o>>>0,i===0?void 0:s>>>0,a!==0);return pt(u)},arguments)},e.wbg.__wbg_update_c0e5821b0213c055=function(){return Tr(function(t,r,n,o,i,s,a){let u=Ie(t).update(jc.__wrap(r),n===0?void 0:o>>>0,i===0?void 0:s>>>0,a!==0);return pt(u)},arguments)},e.wbg.__wbg_delete_f1602f0648d7b093=function(t){Ie(t).delete()},e.wbg.__wbg_setrenderwarning_5c487d92968ccd47=function(t,r){Ie(t).render_warning=r!==0},e.wbg.__wbg_supportedValuesOf_5e22d8a52f4365af=function(t){let r=Intl.supportedValuesOf(Ie(t));return pt(r)},e.wbg.__wbg_unsafegetmodel_fd67e2d4dae840bd=function(t){return Ie(t).unsafe_get_model()},e.wbg.__wbg_new_17c1fc910f4c824b=function(t){let r=new s6e(Ie(t));return pt(r)},e.wbg.__wbg_new_8204ffba8f007535=function(t){let r=new a6e(Ie(t));return pt(r)},e.wbg.__wbg_observe_9779ef9f9b42a57e=function(t,r){Ie(t).observe(Ie(r))},e.wbg.__wbg_unobserve_1176e8f412d64de8=function(t,r){Ie(t).unobserve(Ie(r))},e.wbg.__wbg_isIntersecting_f604911d7c080a3f=function(t){return Ie(t).isIntersecting},e.wbg.__wbg_name_fe8e645f5a21ce17=function(t,r){let n=Ie(r).name,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_category_d69916a5c408c079=function(t,r){let n=Ie(r).category;var o=Mr(n)?0:Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_maxcolumns_85fa699145fbfe99=function(t,r){let n=Ie(r).max_columns;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_maxcells_2d0e243c83c043a7=function(t,r){let n=Ie(r).max_cells;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_renderwarning_4800477b6fb6f67e=function(t){let r=Ie(t).render_warning;return Mr(r)?16777215:r?1:0},e.wbg.__wbg_selectmode_891827fa2ca29d9e=function(t){let r=Ie(t).select_mode;return pt(r)},e.wbg.__wbg_minconfigcolumns_2f4d4ec4de4571a9=function(t,r){let n=Ie(r).min_config_columns;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_configcolumnnames_2725a88025eeeb4e=function(t){let r=Ie(t).config_column_names;return Mr(r)?0:pt(r)},e.wbg.__wbg_priority_3ad85679ab9e9fd8=function(t,r){let n=Ie(r).priority;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_canrendercolumnstyles_3c4ef91e5525d6a8=function(){return Tr(function(t,r,n,o,i){return Ie(t).can_render_column_styles(Jr(r,n),o===0?void 0:Jr(o,i))},arguments)},e.wbg.__wbg_columnstylecontrols_5bf03e48ef307c3d=function(){return Tr(function(t,r,n,o,i){let s=Ie(t).column_style_controls(Jr(r,n),o===0?void 0:Jr(o,i));return pt(s)},arguments)},e.wbg.__wbg_save_02cf430a52569f41=function(){return Tr(function(t){let r=Ie(t).save();return pt(r)},arguments)},e.wbg.__wbg_restore_e82d6a5f9f1e7093=function(){return Tr(function(t,r,n){Ie(t).restore(Ie(r),Ie(n))},arguments)},e.wbg.__wbg_restyle_8e5b40bf8fa22d47=function(){return Tr(function(t,r){let n=Ie(t).restyle(jc.__wrap(r));return pt(n)},arguments)},e.wbg.__wbg_resize_9a5689a62577545f=function(){return Tr(function(t){let r=Ie(t).resize();return pt(r)},arguments)},e.wbg.__wbg_new_c647ae89fea0ec74=function(t){let r=new l6e(Ie(t));return pt(r)},e.wbg.__wbg_observe_4d10af0bedcc7b92=function(t,r){Ie(t).observe(Ie(r))},e.wbg.__wbg_unobserve_925167b8bdb93f51=function(t,r){Ie(t).unobserve(Ie(r))},e.wbg.__wbg_contentRect_a45e802a2609ec43=function(t){let r=Ie(t).contentRect;return pt(r)},e.wbg.__wbg_bootstrap_8b8a2e8182c5acff=function(t,r,n,o,i,s){let a=c6e(Ie(t),Jr(r,n),Jr(o,i),Jt(s));return pt(a)},e.wbg.__wbindgen_as_number=function(t){return+Ie(t)},e.wbg.__wbg_new_fa62b436c9d8b5a4=function(){let t=new oue;return pt(t)},e.wbg.__wbg_client_new=function(t){let r=H8.__wrap(t);return pt(r)},e.wbg.__wbg_table_new=function(t){let r=X8.__wrap(t);return pt(r)},e.wbg.__wbg_instanceof_PerspectiveViewNotFoundError_f832b26f120cfbf2=function(t){let r;try{r=Ie(t)instanceof oue}catch{r=!1}return r},e.wbg.__wbg_view_new=function(t){let r=jc.__wrap(t);return pt(r)},e.wbg.__wbg_view_unwrap=function(t){return jc.__unwrap(Jt(t))},e.wbg.__wbg_listenerid_6dcf1c62b7b7de58=function(t,r){let n=Ie(r).__yew_listener_id;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_setlistenerid_f2e783343fa0cec1=function(t,r){Ie(t).__yew_listener_id=r>>>0},e.wbg.__wbg_setsubtreeid_e1fab6b578c800cf=function(t,r){Ie(t).__yew_subtree_id=r>>>0},e.wbg.__wbg_setcachekey_75bcd45312087529=function(t,r){Ie(t).__yew_subtree_cache_key=r>>>0},e.wbg.__wbg_subtreeid_e80a1798fee782f9=function(t,r){let n=Ie(r).__yew_subtree_id;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_cachekey_b81c1aacc6a0645c=function(t,r){let n=Ie(r).__yew_subtree_cache_key;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){let t=new Error;return pt(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,r){let n=Ie(r).stack,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_error_f851667af71bcfc6=function(t,r){let n,o;try{n=t,o=r,console.error(Jr(t,r))}finally{et.__wbindgen_export_9(n,o,1)}},e.wbg.__wbindgen_jsval_loose_eq=function(t,r){return Ie(t)==Ie(r)},e.wbg.__wbg_queueMicrotask_3cbae2ec6b6cd3d6=function(t){let r=Ie(t).queueMicrotask;return pt(r)},e.wbg.__wbindgen_is_function=function(t){return typeof Ie(t)=="function"},e.wbg.__wbg_queueMicrotask_481971b0d87f3dd4=function(t){queueMicrotask(Ie(t))},e.wbg.__wbg_crypto_1d1f22824a6a080c=function(t){let r=Ie(t).crypto;return pt(r)},e.wbg.__wbg_process_4a72847cc503995b=function(t){let r=Ie(t).process;return pt(r)},e.wbg.__wbg_versions_f686565e586dd935=function(t){let r=Ie(t).versions;return pt(r)},e.wbg.__wbg_node_104a2ff8d6ea03a2=function(t){let r=Ie(t).node;return pt(r)},e.wbg.__wbg_require_cca90b1a94a0255b=function(){return Tr(function(){let t=module.require;return pt(t)},arguments)},e.wbg.__wbg_msCrypto_eb05e62b530a1508=function(t){let r=Ie(t).msCrypto;return pt(r)},e.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return Tr(function(t,r){Ie(t).randomFillSync(Jt(r))},arguments)},e.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return Tr(function(t,r){Ie(t).getRandomValues(Ie(r))},arguments)},e.wbg.__wbg_String_b9412f8799faab3e=function(t,r){let n=String(Ie(r)),o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(t,r){let n=Ie(t)[Ie(r)];return pt(n)},e.wbg.__wbg_set_f975102236d3c502=function(t,r,n){Ie(t)[Jt(r)]=Jt(n)},e.wbg.__wbg_error_a526fb08a0205972=function(t,r){var n=b6e(t,r).slice();et.__wbindgen_export_9(t,r*4,4),console.error(...n)},e.wbg.__wbg_newwithu8arraysequence_9d62f79f4425e877=function(){return Tr(function(t){let r=new Blob(Ie(t));return pt(r)},arguments)},e.wbg.__wbg_newwithstrsequenceandoptions_ce1f1ca2d522b8aa=function(){return Tr(function(t,r){let n=new Blob(Ie(t),Ie(r));return pt(n)},arguments)},e.wbg.__wbg_readText_66c79e0d0ba6e9e4=function(t){let r=Ie(t).readText();return pt(r)},e.wbg.__wbg_write_2615bfe7848298de=function(t,r){let n=Ie(t).write(Ie(r));return pt(n)},e.wbg.__wbg_length_475ff4a03dc28ed8=function(t){return Ie(t).length},e.wbg.__wbg_item_05cff1f1a6e60bf8=function(t,r){let n=Ie(t).item(r>>>0);return Mr(n)?0:pt(n)},e.wbg.__wbg_length_fa6ab66fe954ec16=function(t){return Ie(t).length},e.wbg.__wbg_getPropertyValue_fa32ee1811f224cb=function(){return Tr(function(t,r,n,o){let i=Ie(r).getPropertyValue(Jr(n,o)),s=Ri(i,et.__wbindgen_export_0,et.__wbindgen_export_1),a=ai;ur()[t/4+1]=a,ur()[t/4+0]=s},arguments)},e.wbg.__wbg_item_aac194e1fd9c07fe=function(t,r,n){let o=Ie(r).item(n>>>0),i=Ri(o,et.__wbindgen_export_0,et.__wbindgen_export_1),s=ai;ur()[t/4+1]=s,ur()[t/4+0]=i},e.wbg.__wbg_setProperty_ea7d15a2b591aa97=function(){return Tr(function(t,r,n,o,i){Ie(t).setProperty(Jr(r,n),Jr(o,i))},arguments)},e.wbg.__wbg_instanceof_CssStyleRule_19e37dd6d4cfee84=function(t){let r;try{r=Ie(t)instanceof CSSStyleRule}catch{r=!1}return r},e.wbg.__wbg_selectorText_db2a99568bb888ab=function(t,r){let n=Ie(r).selectorText,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_style_c8d59a2841ce7760=function(t){let r=Ie(t).style;return pt(r)},e.wbg.__wbg_cssRules_d6a2008df6b58846=function(){return Tr(function(t){let r=Ie(t).cssRules;return pt(r)},arguments)},e.wbg.__wbg_new_cf41696ada762ecd=function(){return Tr(function(t,r){let n=new CustomEvent(Jr(t,r));return pt(n)},arguments)},e.wbg.__wbg_newwitheventinitdict_df944b5b582e7ecf=function(){return Tr(function(t,r,n){let o=new CustomEvent(Jr(t,r),Ie(n));return pt(o)},arguments)},e.wbg.__wbg_setdropEffect_e2c739ce2685001a=function(t,r,n){Ie(t).dropEffect=Jr(r,n)},e.wbg.__wbg_setData_dfe68ac4309307b3=function(){return Tr(function(t,r,n,o,i){Ie(t).setData(Jr(r,n),Jr(o,i))},arguments)},e.wbg.__wbg_setDragImage_19bed6ebb775e5d5=function(t,r,n,o){Ie(t).setDragImage(Ie(r),n,o)},e.wbg.__wbg_readyState_c75bd00f79d7a852=function(t,r){let n=Ie(r).readyState,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_body_edb1908d3ceff3a1=function(t){let r=Ie(t).body;return Mr(r)?0:pt(r)},e.wbg.__wbg_activeElement_fa7feca08f5028c0=function(t){let r=Ie(t).activeElement;return Mr(r)?0:pt(r)},e.wbg.__wbg_styleSheets_862582920393b9aa=function(t){let r=Ie(t).styleSheets;return pt(r)},e.wbg.__wbg_fonts_907ba36d4dc746c3=function(t){let r=Ie(t).fonts;return pt(r)},e.wbg.__wbg_createElement_8bae7856a4bb7411=function(){return Tr(function(t,r,n){let o=Ie(t).createElement(Jr(r,n));return pt(o)},arguments)},e.wbg.__wbg_createElementNS_556a62fb298be5a2=function(){return Tr(function(t,r,n,o,i){let s=Ie(t).createElementNS(r===0?void 0:Jr(r,n),Jr(o,i));return pt(s)},arguments)},e.wbg.__wbg_createTextNode_0c38fd80a5b2284d=function(t,r,n){let o=Ie(t).createTextNode(Jr(r,n));return pt(o)},e.wbg.__wbg_width_b455dec2a8f76e45=function(t){return Ie(t).width},e.wbg.__wbg_height_424ebb12c15f2691=function(t){return Ie(t).height},e.wbg.__wbg_width_1e8430024cb82aba=function(t){return Ie(t).width},e.wbg.__wbg_height_0c1394f089d7bb71=function(t){return Ie(t).height},e.wbg.__wbg_top_c4e2234a035a3d25=function(t){return Ie(t).top},e.wbg.__wbg_left_fe0a839abdd508f4=function(t){return Ie(t).left},e.wbg.__wbg_get_2a1a5424f4996392=function(t,r,n,o){let i=Ie(r)[Jr(n,o)];var s=Mr(i)?0:Ri(i,et.__wbindgen_export_0,et.__wbindgen_export_1),a=ai;ur()[t/4+1]=a,ur()[t/4+0]=s},e.wbg.__wbg_set_5e34713fed5f48f2=function(){return Tr(function(t,r,n,o,i){Ie(t)[Jr(r,n)]=Jr(o,i)},arguments)},e.wbg.__wbg_delete_c093d4140e9d77ad=function(t,r,n){delete Ie(t)[Jr(r,n)]},e.wbg.__wbg_add_7a8b240850cb3c95=function(){return Tr(function(t,r){Ie(t).add(...Ie(r))},arguments)},e.wbg.__wbg_add_dcb05a8ba423bdac=function(){return Tr(function(t,r,n){Ie(t).add(Jr(r,n))},arguments)},e.wbg.__wbg_remove_3305bb0551072040=function(){return Tr(function(t,r){Ie(t).remove(...Ie(r))},arguments)},e.wbg.__wbg_remove_698118fb25ab8150=function(){return Tr(function(t,r,n){Ie(t).remove(Jr(r,n))},arguments)},e.wbg.__wbg_toggle_fa0cf8e8b6aeada9=function(){return Tr(function(t,r,n){return Ie(t).toggle(Jr(r,n))},arguments)},e.wbg.__wbg_dataTransfer_cef7816623bd8478=function(t){let r=Ie(t).dataTransfer;return Mr(r)?0:pt(r)},e.wbg.__wbg_instanceof_Element_6945fc210db80ea9=function(t){let r;try{r=Ie(t)instanceof Element}catch{r=!1}return r},e.wbg.__wbg_namespaceURI_5235ee79fd5f6781=function(t,r){let n=Ie(r).namespaceURI;var o=Mr(n)?0:Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_tagName_a98846fa0b63dd7f=function(t,r){let n=Ie(r).tagName,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_classList_1f0528ee002e56d4=function(t){let r=Ie(t).classList;return pt(r)},e.wbg.__wbg_scrollTop_f0411e9d5d88269b=function(t){return Ie(t).scrollTop},e.wbg.__wbg_scrollLeft_d34126a225a7a3dd=function(t){return Ie(t).scrollLeft},e.wbg.__wbg_setscrollLeft_1d74827a003cb259=function(t,r){Ie(t).scrollLeft=r},e.wbg.__wbg_clientWidth_7ea3915573b64350=function(t){return Ie(t).clientWidth},e.wbg.__wbg_clientHeight_d24efa25aa66e844=function(t){return Ie(t).clientHeight},e.wbg.__wbg_setinnerHTML_26d69b59e1af99c7=function(t,r,n){Ie(t).innerHTML=Jr(r,n)},e.wbg.__wbg_children_8904f20261f6442c=function(t){let r=Ie(t).children;return pt(r)},e.wbg.__wbg_attachShadow_0dc29a6e1ed0d233=function(){return Tr(function(t,r){let n=Ie(t).attachShadow(Ie(r));return pt(n)},arguments)},e.wbg.__wbg_getAttribute_99bddb29274b29b9=function(t,r,n,o){let i=Ie(r).getAttribute(Jr(n,o));var s=Mr(i)?0:Ri(i,et.__wbindgen_export_0,et.__wbindgen_export_1),a=ai;ur()[t/4+1]=a,ur()[t/4+0]=s},e.wbg.__wbg_getBoundingClientRect_91e6d57c4e65f745=function(t){let r=Ie(t).getBoundingClientRect();return pt(r)},e.wbg.__wbg_hasAttribute_8340e1a2a46f10f3=function(t,r,n){return Ie(t).hasAttribute(Jr(r,n))},e.wbg.__wbg_matches_fb52713cfe1d20c6=function(){return Tr(function(t,r,n){return Ie(t).matches(Jr(r,n))},arguments)},e.wbg.__wbg_releasePointerCapture_188077a2b7bc54b4=function(){return Tr(function(t,r){Ie(t).releasePointerCapture(r)},arguments)},e.wbg.__wbg_removeAttribute_1b10a06ae98ebbd1=function(){return Tr(function(t,r,n){Ie(t).removeAttribute(Jr(r,n))},arguments)},e.wbg.__wbg_setAttribute_3c9f6c303b696daa=function(){return Tr(function(t,r,n,o,i){Ie(t).setAttribute(Jr(r,n),Jr(o,i))},arguments)},e.wbg.__wbg_setPointerCapture_0fdaad7a916c8486=function(){return Tr(function(t,r){Ie(t).setPointerCapture(r)},arguments)},e.wbg.__wbg_toggleAttribute_0805601df53c2509=function(){return Tr(function(t,r,n,o){return Ie(t).toggleAttribute(Jr(r,n),o!==0)},arguments)},e.wbg.__wbg_target_2fc177e386c8b7b0=function(t){let r=Ie(t).target;return Mr(r)?0:pt(r)},e.wbg.__wbg_bubbles_abce839854481bc6=function(t){return Ie(t).bubbles},e.wbg.__wbg_cancelBubble_c0aa3172524eb03c=function(t){return Ie(t).cancelBubble},e.wbg.__wbg_composedPath_58473fd5ae55f2cd=function(t){let r=Ie(t).composedPath();return pt(r)},e.wbg.__wbg_preventDefault_b1a4aafc79409429=function(t){Ie(t).preventDefault()},e.wbg.__wbg_stopPropagation_fa5b666049c9fd02=function(t){Ie(t).stopPropagation()},e.wbg.__wbg_addEventListener_53b787075bd5e003=function(){return Tr(function(t,r,n,o){Ie(t).addEventListener(Jr(r,n),Ie(o))},arguments)},e.wbg.__wbg_addEventListener_4283b15b4f039eb5=function(){return Tr(function(t,r,n,o,i){Ie(t).addEventListener(Jr(r,n),Ie(o),Ie(i))},arguments)},e.wbg.__wbg_dispatchEvent_63c0c01600a98fd2=function(){return Tr(function(t,r){return Ie(t).dispatchEvent(Ie(r))},arguments)},e.wbg.__wbg_removeEventListener_92cb9b3943463338=function(){return Tr(function(t,r,n,o){Ie(t).removeEventListener(Jr(r,n),Ie(o))},arguments)},e.wbg.__wbg_instanceof_FontFace_50acbf02acb9cc9d=function(t){let r;try{r=Ie(t)instanceof FontFace}catch{r=!1}return r},e.wbg.__wbg_family_30fa389a36b623ec=function(t,r){let n=Ie(r).family,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_weight_e93c16279bcb332f=function(t,r){let n=Ie(r).weight,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_loaded_28a956ce0090e7b8=function(){return Tr(function(t){let r=Ie(t).loaded;return pt(r)},arguments)},e.wbg.__wbg_values_caf2d81d7eff170f=function(t){let r=Ie(t).values();return pt(r)},e.wbg.__wbg_next_914472975cd9ec13=function(){return Tr(function(t){let r=Ie(t).next();return pt(r)},arguments)},e.wbg.__wbg_item_4d089d561e1633ef=function(t,r){let n=Ie(t).item(r>>>0);return Mr(n)?0:pt(n)},e.wbg.__wbg_getwithindex_6f132a79d56e81ec=function(t,r){let n=Ie(t)[r>>>0];return Mr(n)?0:pt(n)},e.wbg.__wbg_scrollTop_323466d6f60b94d8=function(t){return Ie(t).scrollTop},e.wbg.__wbg_setscrollTop_c95597216b73321c=function(t,r){Ie(t).scrollTop=r},e.wbg.__wbg_dataset_2dc9c005573ba3b5=function(t){let r=Ie(t).dataset;return pt(r)},e.wbg.__wbg_style_c3fc3dd146182a2d=function(t){let r=Ie(t).style;return pt(r)},e.wbg.__wbg_offsetParent_49466f530b594f93=function(t){let r=Ie(t).offsetParent;return Mr(r)?0:pt(r)},e.wbg.__wbg_offsetWidth_f7da5da36bd7ebc2=function(t){return Ie(t).offsetWidth},e.wbg.__wbg_offsetHeight_6a4b02ccf09957d7=function(t){return Ie(t).offsetHeight},e.wbg.__wbg_blur_51f7b635f18a0eec=function(){return Tr(function(t){Ie(t).blur()},arguments)},e.wbg.__wbg_click_897b305b2e10b9cf=function(t){Ie(t).click()},e.wbg.__wbg_focus_39d4b8ba8ff9df14=function(){return Tr(function(t){Ie(t).focus()},arguments)},e.wbg.__wbg_checked_749a34774f2df2e3=function(t){return Ie(t).checked},e.wbg.__wbg_setchecked_931ff2ed2cd3ebfd=function(t,r){Ie(t).checked=r!==0},e.wbg.__wbg_value_47fe6384562f52ab=function(t,r){let n=Ie(r).value,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_setvalue_78cb4f1fef58ae98=function(t,r,n){Ie(t).value=Jr(r,n)},e.wbg.__wbg_valueAsNumber_b6456a4b05234115=function(t){return Ie(t).valueAsNumber},e.wbg.__wbg_selectedIndex_7020ea5563b9781c=function(t){return Ie(t).selectedIndex},e.wbg.__wbg_setvalue_7fcbb8726f0b0810=function(t,r,n){Ie(t).value=Jr(r,n)},e.wbg.__wbg_value_d7f5bfbd9302c14b=function(t,r){let n=Ie(r).value,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_setvalue_090972231f0a4f6f=function(t,r,n){Ie(t).value=Jr(r,n)},e.wbg.__wbg_selectionStart_df926430b4a02cb5=function(){return Tr(function(t,r){let n=Ie(r).selectionStart;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},arguments)},e.wbg.__wbg_setselectionStart_ef929691f19cc24d=function(){return Tr(function(t,r,n){Ie(t).selectionStart=r===0?void 0:n>>>0},arguments)},e.wbg.__wbg_selectionEnd_f223580362878477=function(){return Tr(function(t,r){let n=Ie(r).selectionEnd;ur()[t/4+1]=Mr(n)?0:n,ur()[t/4+0]=!Mr(n)},arguments)},e.wbg.__wbg_setselectionEnd_fba9092572255e1a=function(){return Tr(function(t,r,n){Ie(t).selectionEnd=r===0?void 0:n>>>0},arguments)},e.wbg.__wbg_setSelectionRange_681f814ff48ad6be=function(){return Tr(function(t,r,n){Ie(t).setSelectionRange(r>>>0,n>>>0)},arguments)},e.wbg.__wbg_new_fcb9b5d5a4fa92db=function(){return Tr(function(t,r){let n=new InputEvent(Jr(t,r));return pt(n)},arguments)},e.wbg.__wbg_keyCode_2af7775f99bf8e33=function(t){return Ie(t).keyCode},e.wbg.__wbg_shiftKey_5911baf439ab232b=function(t){return Ie(t).shiftKey},e.wbg.__wbg_key_dccf9e8aa1315a8e=function(t,r){let n=Ie(r).key,o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbg_clientX_fef6bf7a6bcf41b8=function(t){return Ie(t).clientX},e.wbg.__wbg_clientY_df42f8fceab3cef2=function(t){return Ie(t).clientY},e.wbg.__wbg_offsetX_1a40c03298c0d8b6=function(t){return Ie(t).offsetX},e.wbg.__wbg_offsetY_f75e8c25b9d9b679=function(t){return Ie(t).offsetY},e.wbg.__wbg_shiftKey_1e76dbfcdd36a4b4=function(t){return Ie(t).shiftKey},e.wbg.__wbg_button_367cdc7303e3cf9b=function(t){return Ie(t).button},e.wbg.__wbg_relatedTarget_04b0e3bac87ae0d9=function(t){let r=Ie(t).relatedTarget;return Mr(r)?0:pt(r)},e.wbg.__wbg_clipboard_45ef2514e9ece120=function(t){let r=Ie(t).clipboard;return Mr(r)?0:pt(r)},e.wbg.__wbg_languages_185a098934c0e22a=function(t){let r=Ie(t).languages;return pt(r)},e.wbg.__wbg_isConnected_c4633799857ee34f=function(t){return Ie(t).isConnected},e.wbg.__wbg_parentNode_6be3abff20e1a5fb=function(t){let r=Ie(t).parentNode;return Mr(r)?0:pt(r)},e.wbg.__wbg_parentElement_347524db59fc2976=function(t){let r=Ie(t).parentElement;return Mr(r)?0:pt(r)},e.wbg.__wbg_childNodes_118168e8b23bcb9b=function(t){let r=Ie(t).childNodes;return pt(r)},e.wbg.__wbg_lastChild_83efe6d5da370e1f=function(t){let r=Ie(t).lastChild;return Mr(r)?0:pt(r)},e.wbg.__wbg_nextSibling_709614fdb0fb7a66=function(t){let r=Ie(t).nextSibling;return Mr(r)?0:pt(r)},e.wbg.__wbg_setnodeValue_94b86af0cda24b90=function(t,r,n){Ie(t).nodeValue=r===0?void 0:Jr(r,n)},e.wbg.__wbg_settextContent_d271bab459cbb1ba=function(t,r,n){Ie(t).textContent=r===0?void 0:Jr(r,n)},e.wbg.__wbg_appendChild_580ccb11a660db68=function(){return Tr(function(t,r){let n=Ie(t).appendChild(Ie(r));return pt(n)},arguments)},e.wbg.__wbg_cloneNode_e19c313ea20d5d1d=function(){return Tr(function(t){let r=Ie(t).cloneNode();return pt(r)},arguments)},e.wbg.__wbg_cloneNode_4bc37fa355a53f27=function(){return Tr(function(t,r){let n=Ie(t).cloneNode(r!==0);return pt(n)},arguments)},e.wbg.__wbg_contains_fdfd1dc667f36695=function(t,r){return Ie(t).contains(Ie(r))},e.wbg.__wbg_getRootNode_6cead4e03b863260=function(t){let r=Ie(t).getRootNode();return pt(r)},e.wbg.__wbg_insertBefore_d2a001abf538c1f8=function(){return Tr(function(t,r,n){let o=Ie(t).insertBefore(Ie(r),Ie(n));return pt(o)},arguments)},e.wbg.__wbg_removeChild_96bbfefd2f5a0261=function(){return Tr(function(t,r){let n=Ie(t).removeChild(Ie(r));return pt(n)},arguments)},e.wbg.__wbg_getEntriesByName_4c1e740dd4ca4c04=function(t,r,n,o,i){let s=Ie(t).getEntriesByName(Jr(r,n),Jr(o,i));return pt(s)},e.wbg.__wbg_mark_c41e729617d1fc82=function(){return Tr(function(t,r,n){Ie(t).mark(Jr(r,n))},arguments)},e.wbg.__wbg_measure_229577a1511d1574=function(){return Tr(function(t,r,n,o,i){Ie(t).measure(Jr(r,n),Jr(o,i))},arguments)},e.wbg.__wbg_now_4e659b3d15f470d9=function(t){return Ie(t).now()},e.wbg.__wbg_startTime_ed8f03c7b801464c=function(t){return Ie(t).startTime},e.wbg.__wbg_pointerId_e030fa156647fedd=function(t){return Ie(t).pointerId},e.wbg.__wbg_instanceof_ShadowRoot_9db040264422e84a=function(t){let r;try{r=Ie(t)instanceof ShadowRoot}catch{r=!1}return r},e.wbg.__wbg_host_c667c7623404d6bf=function(t){let r=Ie(t).host;return pt(r)},e.wbg.__wbg_length_87844359f974d79c=function(t){return Ie(t).length},e.wbg.__wbg_item_bc5bd40ac525267d=function(t,r){let n=Ie(t).item(r>>>0);return Mr(n)?0:pt(n)},e.wbg.__wbg_which_9033fc696dc2c6b0=function(t){return Ie(t).which},e.wbg.__wbg_createObjectURL_ad8244759309f204=function(){return Tr(function(t,r){let n=URL.createObjectURL(Ie(r)),o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},arguments)},e.wbg.__wbg_instanceof_Window_f401953a2cf86220=function(t){let r;try{r=Ie(t)instanceof Window}catch{r=!1}return r},e.wbg.__wbg_document_5100775d18896c16=function(t){let r=Ie(t).document;return Mr(r)?0:pt(r)},e.wbg.__wbg_navigator_6c8fa55c5cc8796e=function(t){let r=Ie(t).navigator;return pt(r)},e.wbg.__wbg_innerWidth_758af301ca4baa3e=function(){return Tr(function(t){let r=Ie(t).innerWidth;return pt(r)},arguments)},e.wbg.__wbg_innerHeight_c1ef73925c3d3e9c=function(){return Tr(function(t){let r=Ie(t).innerHeight;return pt(r)},arguments)},e.wbg.__wbg_performance_3298a9628a5c8aa4=function(t){let r=Ie(t).performance;return Mr(r)?0:pt(r)},e.wbg.__wbg_getComputedStyle_078292ffe423aded=function(){return Tr(function(t,r){let n=Ie(t).getComputedStyle(Ie(r));return Mr(n)?0:pt(n)},arguments)},e.wbg.__wbg_get_d36d61640bbf4503=function(t,r,n){let o=Ie(t)[Jr(r,n)];return Mr(o)?0:pt(o)},e.wbg.__wbg_requestAnimationFrame_549258cfa66011f0=function(){return Tr(function(t,r){return Ie(t).requestAnimationFrame(Ie(r))},arguments)},e.wbg.__wbg_setTimeout_c172d5704ef82276=function(){return Tr(function(t,r,n){return Ie(t).setTimeout(Ie(r),n)},arguments)},e.wbg.__wbg_debug_5fb96680aecf5dc8=function(t){console.debug(Ie(t))},e.wbg.__wbg_debug_7d879afce6cf56cb=function(t,r,n,o){console.debug(Ie(t),Ie(r),Ie(n),Ie(o))},e.wbg.__wbg_error_8e3928cfb8a43e2b=function(t){console.error(Ie(t))},e.wbg.__wbg_error_6e987ee48d9fdf45=function(t,r){console.error(Ie(t),Ie(r))},e.wbg.__wbg_error_74e3211912fcadb6=function(t,r,n){console.error(Ie(t),Ie(r),Ie(n))},e.wbg.__wbg_error_696630710900ec44=function(t,r,n,o){console.error(Ie(t),Ie(r),Ie(n),Ie(o))},e.wbg.__wbg_info_530a29cb2e4e3304=function(t){console.info(Ie(t))},e.wbg.__wbg_info_80803d9a3f0aad16=function(t,r,n,o){console.info(Ie(t),Ie(r),Ie(n),Ie(o))},e.wbg.__wbg_trace_ecf8be024774a5e1=function(t){console.trace(Ie(t))},e.wbg.__wbg_trace_a3be6210345f4cd3=function(t,r,n,o){console.trace(Ie(t),Ie(r),Ie(n),Ie(o))},e.wbg.__wbg_warn_63bbae1730aead09=function(t){console.warn(Ie(t))},e.wbg.__wbg_warn_5d3f783b0bae8943=function(t,r,n,o){console.warn(Ie(t),Ie(r),Ie(n),Ie(o))},e.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return Tr(function(){let t=self.self;return pt(t)},arguments)},e.wbg.__wbg_window_c6fb939a7f436783=function(){return Tr(function(){let t=window.window;return pt(t)},arguments)},e.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return Tr(function(){let t=globalThis.globalThis;return pt(t)},arguments)},e.wbg.__wbg_global_207b558942527489=function(){return Tr(function(){let t=global.global;return pt(t)},arguments)},e.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(t,r){let n=new Function(Jr(t,r));return pt(n)},e.wbg.__wbg_length_cd7af8117672b8b8=function(t){return Ie(t).length},e.wbg.__wbg_new_16b304a2cfa7ff4a=function(){let t=new Array;return pt(t)},e.wbg.__wbg_new_d9bc3a0147634640=function(){return pt(new Map)},e.wbg.__wbg_next_40fc327bfc8770e6=function(t){let r=Ie(t).next;return pt(r)},e.wbg.__wbg_value_d93c65011f51a456=function(t){let r=Ie(t).value;return pt(r)},e.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return pt(Symbol.iterator)},e.wbg.__wbg_new_72fb9a18b5ae2624=function(){let t=new Object;return pt(t)},e.wbg.__wbg_new_d1e254633306c863=function(t,r){let n=new Intl.DateTimeFormat(Ie(t),Ie(r));return pt(n)},e.wbg.__wbg_new_9b92e4a30b8fb05f=function(t,r){let n=new Intl.NumberFormat(Ie(t),Ie(r));return pt(n)},e.wbg.__wbg_instanceof_Array_731699c9372cb461=function(t){let r;try{r=Ie(t)instanceof Array}catch{r=!1}return r},e.wbg.__wbg_at_c729a14f9fc27c62=function(t,r){let n=Ie(t).at(r);return pt(n)},e.wbg.__wbg_get_bd8e338fbd5f5cc8=function(t,r){let n=Ie(t)[r>>>0];return pt(n)},e.wbg.__wbg_set_d4638f722068f043=function(t,r,n){Ie(t)[r>>>0]=Jt(n)},e.wbg.__wbg_from_89e3fc3ba5e6fb48=function(t){let r=Array.from(Ie(t));return pt(r)},e.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(t){return Array.isArray(Ie(t))},e.wbg.__wbg_push_a5b05aedc7234f9f=function(t,r){return Ie(t).push(Ie(r))},e.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(t){let r;try{r=Ie(t)instanceof ArrayBuffer}catch{r=!1}return r},e.wbg.__wbg_slice_02488dcf81d2cd23=function(t,r,n){let o=Ie(t).slice(r>>>0,n>>>0);return pt(o)},e.wbg.__wbg_call_27c0f87801dedf93=function(){return Tr(function(t,r){let n=Ie(t).call(Ie(r));return pt(n)},arguments)},e.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return Tr(function(t,r,n){let o=Ie(t).call(Ie(r),Ie(n));return pt(o)},arguments)},e.wbg.__wbg_instanceof_Map_87917e0a7aaf4012=function(t){let r;try{r=Ie(t)instanceof Map}catch{r=!1}return r},e.wbg.__wbg_set_8417257aaedc936b=function(t,r,n){let o=Ie(t).set(Ie(r),Ie(n));return pt(o)},e.wbg.__wbg_next_196c84450b364254=function(){return Tr(function(t){let r=Ie(t).next();return pt(r)},arguments)},e.wbg.__wbg_done_298b57d23c0fc80c=function(t){return Ie(t).done},e.wbg.__wbg_isSafeInteger_f7b04ef02296c4d2=function(t){return Number.isSafeInteger(Ie(t))},e.wbg.__wbg_getTimezoneOffset_38257122e236c190=function(t){return Ie(t).getTimezoneOffset()},e.wbg.__wbg_new_cf3ec55744a78578=function(t){let r=new Date(Ie(t));return pt(r)},e.wbg.__wbg_instanceof_Object_71ca3c0a59266746=function(t){let r;try{r=Ie(t)instanceof Object}catch{r=!1}return r},e.wbg.__wbg_entries_95cc2c823b285a09=function(t){let r=Object.entries(Ie(t));return pt(r)},e.wbg.__wbg_is_010fdc0f4ab96916=function(t,r){return Object.is(Ie(t),Ie(r))},e.wbg.__wbg_keys_91e412b4b222659f=function(t){let r=Object.keys(Ie(t));return pt(r)},e.wbg.__wbg_values_9c75e6e2bfbdb70d=function(t){let r=Object.values(Ie(t));return pt(r)},e.wbg.__wbg_get_e3c254076557e348=function(){return Tr(function(t,r){let n=Reflect.get(Ie(t),Ie(r));return pt(n)},arguments)},e.wbg.__wbg_has_0af94d20077affa2=function(){return Tr(function(t,r){return Reflect.has(Ie(t),Ie(r))},arguments)},e.wbg.__wbg_set_1f9b04f170055d33=function(){return Tr(function(t,r,n){return Reflect.set(Ie(t),Ie(r),Ie(n))},arguments)},e.wbg.__wbg_buffer_12d079cc21e14bdb=function(t){let r=Ie(t).buffer;return pt(r)},e.wbg.__wbg_parse_66d1801634e099ac=function(){return Tr(function(t,r){let n=JSON.parse(Jr(t,r));return pt(n)},arguments)},e.wbg.__wbg_stringify_8887fe74e1c50d81=function(){return Tr(function(t){let r=JSON.stringify(Ie(t));return pt(r)},arguments)},e.wbg.__wbg_stringify_8bf3b8430afb6510=function(){return Tr(function(t,r,n){let o=JSON.stringify(Ie(t),Ie(r),Ie(n));return pt(o)},arguments)},e.wbg.__wbg_resolvedOptions_d9546e4eba6aff08=function(t){let r=Ie(t).resolvedOptions();return pt(r)},e.wbg.__wbg_format_0d1a43422b065409=function(t){let r=Ie(t).format;return pt(r)},e.wbg.__wbg_instanceof_Promise_b438ddea4cacc51f=function(t){let r;try{r=Ie(t)instanceof Promise}catch{r=!1}return r},e.wbg.__wbg_new_81740750da40724f=function(t,r){try{var n={a:t,b:r},o=(s,a)=>{let u=n.a;n.a=0;try{return v6e(u,n.b,s,a)}finally{n.a=u}};let i=new Promise(o);return pt(i)}finally{n.a=n.b=0}},e.wbg.__wbg_resolve_b0083a7967828ec8=function(t){let r=Promise.resolve(Ie(t));return pt(r)},e.wbg.__wbg_then_0c86a60e8fcfe9f6=function(t,r){let n=Ie(t).then(Ie(r));return pt(n)},e.wbg.__wbg_then_a73caa9a87991566=function(t,r,n){let o=Ie(t).then(Ie(r),Ie(n));return pt(o)},e.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(t,r,n){let o=new Uint8Array(Ie(t),r>>>0,n>>>0);return pt(o)},e.wbg.__wbg_new_63b92bc8671ed464=function(t){let r=new Uint8Array(Ie(t));return pt(r)},e.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(t){let r;try{r=Ie(t)instanceof Uint8Array}catch{r=!1}return r},e.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(t){let r=new Uint8Array(t>>>0);return pt(r)},e.wbg.__wbg_buffer_dd7f74bc60f1faab=function(t){let r=Ie(t).buffer;return pt(r)},e.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(t,r,n){let o=Ie(t).subarray(r>>>0,n>>>0);return pt(o)},e.wbg.__wbg_length_c20a40f15020d68a=function(t){return Ie(t).length},e.wbg.__wbg_byteLength_58f7b4fab1919d44=function(t){return Ie(t).byteLength},e.wbg.__wbg_byteOffset_81d60f7392524f62=function(t){return Ie(t).byteOffset},e.wbg.__wbg_set_a47bac70306a19a7=function(t,r,n){Ie(t).set(Ie(r),n>>>0)},e.wbg.__wbindgen_bigint_get_as_i64=function(t,r){let n=Ie(r),o=typeof n=="bigint"?n:void 0;h6e()[t/8+1]=Mr(o)?BigInt(0):o,ur()[t/4+0]=!Mr(o)},e.wbg.__wbindgen_debug_string=function(t,r){let n=G8(Ie(r)),o=Ri(n,et.__wbindgen_export_0,et.__wbindgen_export_1),i=ai;ur()[t/4+1]=i,ur()[t/4+0]=o},e.wbg.__wbindgen_throw=function(t,r){throw new Error(Jr(t,r))},e.wbg.__wbindgen_memory=function(){let t=et.memory;return pt(t)},e.wbg.__wbindgen_closure_wrapper5862=function(t,r,n){let o=U2(t,r,74,d6e);return pt(o)},e.wbg.__wbindgen_closure_wrapper5864=function(t,r,n){let o=U2(t,r,72,sue);return pt(o)},e.wbg.__wbindgen_closure_wrapper5866=function(t,r,n){let o=q8(t,r,72,aue);return pt(o)},e.wbg.__wbindgen_closure_wrapper5868=function(t,r,n){let o=q8(t,r,72,aue);return pt(o)},e.wbg.__wbindgen_closure_wrapper5870=function(t,r,n){let o=U2(t,r,72,sue);return pt(o)},e.wbg.__wbindgen_closure_wrapper16054=function(t,r,n){let o=q8(t,r,4044,m6e);return pt(o)},e.wbg.__wbindgen_closure_wrapper16956=function(t,r,n){let o=U2(t,r,4136,g6e);return pt(o)},e.wbg.__wbindgen_closure_wrapper16977=function(t,r,n){let o=U2(t,r,4141,_6e);return pt(o)},e}function yue(e,t){return et=e.exports,xue.__wbindgen_wasm_module=t,Y2=null,V2=null,W2=null,q2=null,Z2=null,et}function L6e(e){if(et!==void 0)return et;let t=_ue();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));let r=new WebAssembly.Instance(e,t);return yue(r,e)}async function xue(e){if(et!==void 0)return et;let t=_ue();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));let{instance:r,module:n}=await D6e(await e,t);return yue(r,n)}var n6e,i6e,o6e,hue,oue,s6e,a6e,l6e,et,Bc,V2,W2,ai,Z2,dk,u6e,pue,G2,Y2,mk,pk,q2,cue,H8,w6e,A6e,M6e,S6e,T6e,E6e,I6e,C6e,k6e,P6e,O6e,R6e,N6e,z6e,uue,X8,fue,jc,bue,F6e,wue=W(async()=>{rue();iue();n6e=Object.defineProperty,i6e=(e,t)=>{for(var r in t)n6e(e,r,{get:t[r],enumerable:!0})},o6e=class extends HTMLElement{constructor(){super()}get name(){return"Debug"}get select_mode(){return"select"}get min_config_columns(){}get config_column_names(){}get priority(){return 0}can_render_column_styles(){return!1}column_style_config(){}async update(e){return this.draw(e)}async draw(e){this.style.backgroundColor="#fff";let t=await e.to_csv(),r="margin:0;overflow:scroll;position:absolute;width:100%;height:100%";this.innerHTML=`<pre style='${r}'>${t}</pre>`}async clear(){this.innerHTML=""}async resize(){}async restyle(){}async save(){}async restore(){}async delete(){}},hue={};i6e(hue,{Client:()=>H8,ColumnDropDownElement:()=>A6e,CopyDropDownMenuElement:()=>S6e,ExportDropDownMenuElement:()=>E6e,FilterDropDownElement:()=>C6e,FunctionDropDownElement:()=>P6e,PerspectiveDebugPluginElement:()=>R6e,PerspectiveViewerElement:()=>z6e,Table:()=>X8,View:()=>jc,default:()=>bue,init:()=>gue,initSync:()=>L6e,registerPlugin:()=>x6e});oue=class extends Error{},s6e=window.ClipboardItem,a6e=window.IntersectionObserver,l6e=window.ResizeObserver;Bc=new Array(128).fill(void 0);Bc.push(void 0,null,!0,!1);V2=null;W2=null;ai=0,Z2=null;dk=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},u6e=typeof dk.encodeInto=="function"?function(e,t){return dk.encodeInto(e,t)}:function(e,t){let r=dk.encode(e);return t.set(r),{read:e.length,written:r.length}};pue=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&pue.decode();G2=Bc.length;Y2=null;mk=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>{et.__wbindgen_export_2.get(e.dtor)(e.a,e.b)});pk=128;q2=null;cue=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_client_free(e>>>0)),H8=class{static __wrap(e){e=e>>>0;let t=Object.create(H8.prototype);return t.__wbg_ptr=e,cue.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,cue.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_client_free(e)}constructor(e,t){let r=et.client_new(pt(e),Mr(t)?0:pt(t));return this.__wbg_ptr=r>>>0,this}init(){let e=et.client_init(this.__wbg_ptr);return Jt(e)}handle_response(e){let t=et.client_handle_response(this.__wbg_ptr,pt(e));return Jt(t)}table(e,t){let r=et.client_table(this.__wbg_ptr,pt(e),Mr(t)?0:pt(t));return Jt(r)}terminate(){try{let n=et.__wbindgen_add_to_stack_pointer(-16);et.client_terminate(n,this.__wbg_ptr);var e=ur()[n/4+0],t=ur()[n/4+1],r=ur()[n/4+2];if(r)throw Jt(t);return Jt(e)}finally{et.__wbindgen_add_to_stack_pointer(16)}}open_table(e){let t=Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai,n=et.client_open_table(this.__wbg_ptr,t,r);return Jt(n)}get_hosted_table_names(){let e=et.client_get_hosted_table_names(this.__wbg_ptr);return Jt(e)}system_info(){let e=et.client_system_info(this.__wbg_ptr);return Jt(e)}},w6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_columndropdownelement_free(e>>>0)),A6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,w6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_columndropdownelement_free(e)}},M6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_copydropdownmenuelement_free(e>>>0)),S6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,M6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_copydropdownmenuelement_free(e)}constructor(e){let t=et.copydropdownmenuelement_new(pt(e));return this.__wbg_ptr=t>>>0,this}open(e){et.copydropdownmenuelement_open(this.__wbg_ptr,pt(e))}hide(){try{let r=et.__wbindgen_add_to_stack_pointer(-16);et.copydropdownmenuelement_hide(r,this.__wbg_ptr);var e=ur()[r/4+0],t=ur()[r/4+1];if(t)throw Jt(e)}finally{et.__wbindgen_add_to_stack_pointer(16)}}unsafe_set_model(e){et.copydropdownmenuelement_unsafe_set_model(this.__wbg_ptr,e)}connected_callback(){et.copydropdownmenuelement_connected_callback(this.__wbg_ptr)}},T6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_exportdropdownmenuelement_free(e>>>0)),E6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,T6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_exportdropdownmenuelement_free(e)}constructor(e){let t=et.copydropdownmenuelement_new(pt(e));return this.__wbg_ptr=t>>>0,this}open(e){et.exportdropdownmenuelement_open(this.__wbg_ptr,pt(e))}hide(){try{let r=et.__wbindgen_add_to_stack_pointer(-16);et.exportdropdownmenuelement_hide(r,this.__wbg_ptr);var e=ur()[r/4+0],t=ur()[r/4+1];if(t)throw Jt(e)}finally{et.__wbindgen_add_to_stack_pointer(16)}}unsafe_set_model(e){et.exportdropdownmenuelement_unsafe_set_model(this.__wbg_ptr,e)}connected_callback(){et.copydropdownmenuelement_connected_callback(this.__wbg_ptr)}},I6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_filterdropdownelement_free(e>>>0)),C6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,I6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_filterdropdownelement_free(e)}},k6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_functiondropdownelement_free(e>>>0)),P6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,k6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_functiondropdownelement_free(e)}},O6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_perspectivedebugpluginelement_free(e>>>0)),R6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,O6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_perspectivedebugpluginelement_free(e)}constructor(e){let t=et.perspectivedebugpluginelement_new(pt(e));return this.__wbg_ptr=t>>>0,this}get name(){let e,t;try{let o=et.__wbindgen_add_to_stack_pointer(-16);et.perspectivedebugpluginelement_name(o,this.__wbg_ptr);var r=ur()[o/4+0],n=ur()[o/4+1];return e=r,t=n,Jr(r,n)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_export_9(e,t,1)}}get select_mode(){let e,t;try{let o=et.__wbindgen_add_to_stack_pointer(-16);et.perspectivedebugpluginelement_select_mode(o,this.__wbg_ptr);var r=ur()[o/4+0],n=ur()[o/4+1];return e=r,t=n,Jr(r,n)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_export_9(e,t,1)}}get min_config_columns(){let e=et.perspectivedebugpluginelement_config_column_names(this.__wbg_ptr);return Jt(e)}get config_column_names(){let e=et.perspectivedebugpluginelement_config_column_names(this.__wbg_ptr);return Jt(e)}update(e){lue(e,jc);let t=et.perspectivedebugpluginelement_draw(this.__wbg_ptr,e.__wbg_ptr);return Jt(t)}draw(e){lue(e,jc);let t=et.perspectivedebugpluginelement_draw(this.__wbg_ptr,e.__wbg_ptr);return Jt(t)}clear(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}resize(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}restyle(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}save(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}restore(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}delete(){let e=et.perspectivedebugpluginelement_clear(this.__wbg_ptr);return Jt(e)}connectedCallback(){et.copydropdownmenuelement_connected_callback(this.__wbg_ptr)}},N6e=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_perspectiveviewerelement_free(e>>>0)),z6e=class{__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,N6e.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_perspectiveviewerelement_free(e)}constructor(e){let t=et.perspectiveviewerelement_new(pt(e));return this.__wbg_ptr=t>>>0,this}connectedCallback(){et.copydropdownmenuelement_connected_callback(this.__wbg_ptr)}load(e){let t=et.perspectiveviewerelement_load(this.__wbg_ptr,pt(e));return Jt(t)}delete(){let e=et.perspectiveviewerelement_delete(this.__wbg_ptr);return Jt(e)}getView(){let e=et.perspectiveviewerelement_getView(this.__wbg_ptr);return Jt(e)}getTable(e){let t=et.perspectiveviewerelement_getTable(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}getRenderStats(){try{let n=et.__wbindgen_add_to_stack_pointer(-16);et.perspectiveviewerelement_getRenderStats(n,this.__wbg_ptr);var e=ur()[n/4+0],t=ur()[n/4+1],r=ur()[n/4+2];if(r)throw Jt(t);return Jt(e)}finally{et.__wbindgen_add_to_stack_pointer(16)}}flush(){let e=et.perspectiveviewerelement_flush(this.__wbg_ptr);return Jt(e)}restore(e){let t=et.perspectiveviewerelement_restore(this.__wbg_ptr,pt(e));return Jt(t)}save(e){var t=Mr(e)?0:Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai;let n=et.perspectiveviewerelement_save(this.__wbg_ptr,t,r);return Jt(n)}download(e){let t=et.perspectiveviewerelement_download(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}copy(e){let t=et.perspectiveviewerelement_copy(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}reset(e){let t=et.perspectiveviewerelement_reset(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}resize(e){let t=et.perspectiveviewerelement_resize(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}setAutoSize(e){et.perspectiveviewerelement_setAutoSize(this.__wbg_ptr,e)}setAutoPause(e){et.perspectiveviewerelement_setAutoPause(this.__wbg_ptr,e)}getSelection(){let e=et.perspectiveviewerelement_getSelection(this.__wbg_ptr);return Jt(e)}setSelection(e){try{let n=et.__wbindgen_add_to_stack_pointer(-16);et.perspectiveviewerelement_setSelection(n,this.__wbg_ptr,Mr(e)?0:pt(e));var t=ur()[n/4+0],r=ur()[n/4+1];if(r)throw Jt(t)}finally{et.__wbindgen_add_to_stack_pointer(16)}}getEditPort(){try{let n=et.__wbindgen_add_to_stack_pointer(-16);et.perspectiveviewerelement_getEditPort(n,this.__wbg_ptr);var e=due()[n/8+0],t=ur()[n/4+2],r=ur()[n/4+3];if(r)throw Jt(t);return e}finally{et.__wbindgen_add_to_stack_pointer(16)}}restyleElement(){let e=et.perspectiveviewerelement_restyleElement(this.__wbg_ptr);return Jt(e)}resetThemes(e){var t=Mr(e)?0:y6e(e,et.__wbindgen_export_0),r=ai;let n=et.perspectiveviewerelement_resetThemes(this.__wbg_ptr,t,r);return Jt(n)}setThrottle(e){et.perspectiveviewerelement_setThrottle(this.__wbg_ptr,!Mr(e),Mr(e)?0:e)}toggleConfig(e){let t=et.perspectiveviewerelement_toggleConfig(this.__wbg_ptr,Mr(e)?16777215:e?1:0);return Jt(t)}getAllPlugins(){let e=et.perspectiveviewerelement_getAllPlugins(this.__wbg_ptr);return Jt(e)}getPlugin(e){try{let s=et.__wbindgen_add_to_stack_pointer(-16);var t=Mr(e)?0:Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai;et.perspectiveviewerelement_getPlugin(s,this.__wbg_ptr,t,r);var n=ur()[s/4+0],o=ur()[s/4+1],i=ur()[s/4+2];if(i)throw Jt(o);return Jt(n)}finally{et.__wbindgen_add_to_stack_pointer(16)}}unsafe_get_model(){return et.perspectiveviewerelement_unsafe_get_model(this.__wbg_ptr)>>>0}toggleColumnSettings(e){let t=Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai,n=et.perspectiveviewerelement_toggleColumnSettings(this.__wbg_ptr,t,r);return Jt(n)}openColumnSettings(e,t){var r=Mr(e)?0:Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),n=ai;let o=et.perspectiveviewerelement_openColumnSettings(this.__wbg_ptr,r,n,Mr(t)?16777215:t?1:0);return Jt(o)}},uue=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_table_free(e>>>0)),X8=class{static __wrap(e){e=e>>>0;let t=Object.create(X8.prototype);return t.__wbg_ptr=e,uue.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,uue.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_table_free(e)}get_index(){let e=et.table_get_index(this.__wbg_ptr);return Jt(e)}get_client(){let e=et.table_get_client(this.__wbg_ptr);return Jt(e)}get_limit(){let e=et.table_get_limit(this.__wbg_ptr);return Jt(e)}clear(){let e=et.table_clear(this.__wbg_ptr);return Jt(e)}delete(){let e=et.table_delete(this.__wbg_ptr);return Jt(e)}size(){let e=et.table_size(this.__wbg_ptr);return Jt(e)}schema(){let e=et.table_schema(this.__wbg_ptr);return Jt(e)}columns(){let e=et.table_columns(this.__wbg_ptr);return Jt(e)}make_port(){let e=et.table_make_port(this.__wbg_ptr);return Jt(e)}on_delete(e){let t=et.table_on_delete(this.__wbg_ptr,pt(e));return Jt(t)}remove_delete(e){let t=et.table_remove_delete(this.__wbg_ptr,e);return Jt(t)}remove(e,t){let r=et.table_remove(this.__wbg_ptr,pt(e),Mr(t)?0:pt(t));return Jt(r)}replace(e,t){let r=et.table_replace(this.__wbg_ptr,pt(e),Mr(t)?0:pt(t));return Jt(r)}update(e,t){let r=et.table_update(this.__wbg_ptr,pt(e),Mr(t)?0:pt(t));return Jt(r)}view(e){let t=et.table_view(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}validate_expressions(e){let t=et.table_validate_expressions(this.__wbg_ptr,pt(e));return Jt(t)}unsafe_get_model(){return et.table_unsafe_get_model(this.__wbg_ptr)>>>0}},fue=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>et.__wbg_view_free(e>>>0)),jc=class{static __wrap(e){e=e>>>0;let t=Object.create(jc.prototype);return t.__wbg_ptr=e,fue.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof jc?e.__destroy_into_raw():0}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,fue.unregister(this),e}free(){let e=this.__destroy_into_raw();et.__wbg_view_free(e)}__get_model(){let e=et.view___get_model(this.__wbg_ptr);return jc.__wrap(e)}column_paths(){let e=et.view_column_paths(this.__wbg_ptr);return Jt(e)}delete(){let e=et.view_delete(this.__wbg_ptr);return Jt(e)}dimensions(){let e=et.view_dimensions(this.__wbg_ptr);return Jt(e)}expression_schema(){let e=et.view_expression_schema(this.__wbg_ptr);return Jt(e)}get_config(){let e=et.view_get_config(this.__wbg_ptr);return Jt(e)}get_min_max(e){let t=Ri(e,et.__wbindgen_export_0,et.__wbindgen_export_1),r=ai,n=et.view_get_min_max(this.__wbg_ptr,t,r);return Jt(n)}num_rows(){let e=et.view_num_rows(this.__wbg_ptr);return Jt(e)}schema(){let e=et.view_schema(this.__wbg_ptr);return Jt(e)}to_arrow(e){let t=et.view_to_arrow(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}to_columns_string(e){let t=et.view_to_columns_string(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}to_columns(e){let t=et.view_to_columns(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}to_json_string(e){let t=et.view_to_json_string(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}to_json(e){let t=et.view_to_json(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}to_csv(e){let t=et.view_to_csv(this.__wbg_ptr,Mr(e)?0:pt(e));return Jt(t)}on_update(e,t){let r=et.view_on_update(this.__wbg_ptr,pt(e),Mr(t)?0:pt(t));return Jt(r)}remove_update(e){let t=et.view_remove_update(this.__wbg_ptr,e);return Jt(t)}on_delete(e){let t=et.view_on_delete(this.__wbg_ptr,pt(e));return Jt(t)}num_columns(){let e=et.view_num_columns(this.__wbg_ptr);return Jt(e)}remove_delete(e){let t=et.view_remove_delete(this.__wbg_ptr,e);return Jt(t)}collapse(e){let t=et.view_collapse(this.__wbg_ptr,e);return Jt(t)}expand(e){let t=et.view_expand(this.__wbg_ptr,e);return Jt(t)}set_depth(e){let t=et.view_set_depth(this.__wbg_ptr,e);return Jt(t)}};bue=xue,F6e=await nue(tue);await bue(F6e);await gue()});function U6e(){let e=performance.now(),t=e-Mue,r=gk,n=lx*1e3/t,o=1e3/r,i=lx;return gk=0,lx=0,Mue=e,{avg:r,real_fps:n,virtual_fps:o,num_frames:i,elapsed:t}}function V6e(e){gk=(gk*lx+e)/(lx+1),lx+=1}async function Z6e(e){return await new Promise(requestAnimationFrame),await Ap.get(e)}async function Iue(e,t){if(Ap.has(e)&&(await Ap.get(e),Ap.has(e))){await Ap.get(e);return}Ap.set(e,W6e());try{return await t()}finally{let r=Ap.get(e);Ap.delete(e),r.resolve()}}async function Sue(e){let t=Aue&&performance.now(),{invalid_viewport:r=!0,preserve_width:n=!1}=e,{num_columns:o,num_rows:i,row_height:s}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(i),n||this._update_virtual_panel_width(r,o);let a=this._calculate_viewport(i,o),{invalid_row:u,invalid_column:h}=this._validate_viewport(a);if(this._invalid_schema||u||h||r){let p=[],_=!0;for await(let y of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,n,a,o)){y!==void 0&&(p=p.concat(y)),_&&(this.update_sub_cell_offset(a),_=!1),this._is_styling=!0;let A=this._style_callbacks;for(let E of A)await E({detail:this});if(this._is_styling=!1,!this._invalidated&&y!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(p,s),this.table_model.header.reset_header_cache(),n||this._update_virtual_panel_width(this._invalid_schema||h,o),this._invalid_schema=!1}else this.update_sub_cell_offset(a);Aue&&V6e(performance.now()-t)}var Kg,Aue,B6e,j6e,gk,lx,Mue,Eue,W6e,Ap,Y6e,q6e,G6e,H6e,X6e,K6e,Cue,$6e,Q6e,Tue,J6e,eRe,kue=W(()=>{Kg=new WeakMap,Aue=!0,B6e=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,j6e=B6e?5e6:1e7,gk=0,lx=0,Mue=performance.now();Eue=(e,...t)=>e.map((r,n)=>[r,t[n]]).flat().filter(r=>!!r).join(""),W6e=()=>{let e,t=new Promise(r=>{e=r});return t.resolve=e,t},Ap=new Map;Y6e=":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}",q6e=":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}",G6e=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});let e="<slot></slot>";this.shadowRoot.innerHTML=Eue`
            <style>
                ${Y6e}
            </style>
            <style>
                ${q6e}
            </style>
            <div class="rt-virtual-panel"></div>
            <div class="rt-scroll-table-clip">
                ${e}
            </div>
        `;let[,t,r,n]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=n,this._virtual_panel=r,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(e,t){let{start_row:r,end_row:n}=this._calculate_row_range(e),{start_col:o,end_col:i}=this._calculate_column_range(t);return this._nrows=e,{start_col:o,end_col:i,start_row:r,end_row:n}}_calculate_row_range(e){let{height:t}=this._container_size,r=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length,o=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),i=Math.max(Math.ceil(this.scrollTop),0)/o,s=t/r-n,a=Math.max(0,Math.ceil((e||0)-s))*i,u=Math.max(0,Math.min(a+s,e));return{start_row:a,end_row:u}}_calc_start_column(){let e=this._view_cache.config.row_pivots.length,t=0,r=0,n=0;for(;r<this.scrollLeft;){let o=this._column_sizes.indices[t+e];n=this.scrollLeft-r,t+=1,r+=o!==void 0?o:60}return t+=n/(this._column_sizes.indices[t+e-1]||60),Math.max(0,t-1)}_calculate_column_range(e){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let t=this._calc_start_column(),r=this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)),n=t+r+1;return{start_col:t,end_col:n}}}_max_scroll_column(e){let t=0;if(this._view_cache.config.row_pivots.length>0)for(let o of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=o;let r=this._view_cache.config.row_pivots.length,n=e;for(;t<this._container_size.width&&n>=0;)n--,t+=this._column_sizes.indices[n+r]||60;return Math.min(e-1,n+1)}_validate_viewport({start_col:e,end_col:t,start_row:r,end_row:n}){r=Math.floor(r),n=Math.ceil(n),e=Math.floor(e),t=Math.ceil(t);let o=this._start_col!==e,i=this._start_row!==r||this._end_row!==n||this._end_col!==t;return this._start_col=e,this._end_col=t,this._start_row=r,this._end_row=n,{invalid_column:o,invalid_row:i}}_calc_scrollable_column_width(e){let t=this._view_cache.config.row_pivots.length,r=this._max_scroll_column(e),n=t,o=0;for(;n<r+t;)o+=this._column_sizes.indices[n]||60,n++;return o}_update_virtual_panel_width(e,t){if(e)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((r,n)=>r+n,0)+"px";else{let r=this._calc_scrollable_column_width(t);if(r!==0){let n=this._container_size.width+r+2;this._virtual_panel.style.width=n+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(e){let{row_height:t=19}=this._column_sizes,r=this._view_cache.config.column_pivots.length*t,n;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")n=e*t+r;else{let o=this.clientHeight/(this._table_clip.offsetHeight-r);n=Math.min(j6e,e*t*o)}this._virtual_panel.style.height=`${n}px`}async draw(e={}){return typeof e.throttle<"u"&&!e.throttle?await Sue.call(this,e):await Iue(this,()=>Sue.call(this,e))}async _draw_flush(){await Z6e(this)}update_sub_cell_offset(e){let t=this._column_sizes.row_height*(e.start_row%1)||0,r=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(e.start_col)]*(e.start_col%1)||0,n=this._sub_cell_style.sheet?.cssRules[0].style;n&&(n.setProperty("--regular-table--clip-x",`${r}px`),n.setProperty("--regular-table--clip-y",`${t}px`),n.setProperty("--regular-table--transform-x",`-${r}px`),n.setProperty("--regular-table--transform-y",`-${t}px`))}};H6e=!1,X6e=class extends G6e{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this)),H6e&&(this.addEventListener("touchmove",this._on_touchmove.bind(this)),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!0}))}_on_mousewheel(e){if(!window.safari)return;let{clientWidth:t,clientHeight:r,scrollTop:n,scrollLeft:o}=this;e.preventDefault(),e.returnValue=!1;let i=Math.max(1,this._virtual_panel.offsetHeight-r),s=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.max(0,Math.min(i,n+e.deltaY)),this.scrollLeft=Math.max(0,Math.min(s,o+e.deltaX)),this._on_scroll(e)}_on_touchmove(e){e.stopPropagation(),e.preventDefault(),e.returnValue=!1;let{clientWidth:t,clientHeight:r}=this,n=Math.max(1,this._virtual_panel.offsetHeight-r),o=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(n,this._memo_scroll_top+(this._memo_touch_startY-e.touches[0].pageY)),this.scrollLeft=Math.min(o,this._memo_scroll_left+(this._memo_touch_startX-e.touches[0].pageX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].pageY,this._memo_touch_startX=e.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(e){let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let r=e.target.classList.contains("rt-column-resize"),n=Kg.get(t);if(r){e.stopImmediatePropagation(),t.style.minWidth="",t.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[n.size_key]=void 0,this._column_sizes.auto[n.size_key]=void 0,this._column_sizes.indices[n.size_key]=void 0);for(let o of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let i of e.shiftKey?o:[o[n._virtual_x]])i&&(i.style.minWidth="",i.style.maxWidth="",i.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(e.button!==0)return;let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let r=e.target.classList.contains("rt-column-resize"),n=Kg.get(t);r&&(this._on_resize_column(e,t,n),e.stopImmediatePropagation())}async _on_click_or_dblclick(e){let t=performance.now();this._last_clicked_time&&t-this._last_clicked_time<500?(this._last_clicked_time=t,await this._on_dblclick(e)):(this._last_clicked_time=t,await this._on_click(e))}_on_resize_column(e,t,r){let{_virtual_x:n,size_key:o}=r,i=e.pageX,s=n+t.colSpan-1,a=this.table_model.header.get_column_header(s),u=this._column_sizes.indices[o],h=_=>Iue(this,async()=>await this._on_resize_column_move(_,a,i,u,o,s)),p=()=>{document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",p);let _=this._column_sizes.override[o],y=this._column_sizes.indices[o]!==_;this._column_sizes.indices[o]=_,y&&this.draw()};document.addEventListener("mousemove",h),document.addEventListener("mouseup",p)}async _on_resize_column_move(e,t,r,n,o,i){await new Promise(requestAnimationFrame);let s=e.pageX-r,a=Math.max(1,n+s);if(this._column_sizes.override[o]=a,s<0)await this.draw({preserve_width:!0,throttle:!1});else{t.style.minWidth=a+"px",t.style.maxWidth=a+"px";let u=this._column_sizes.auto[o];for(let h of this.table_model.body.cells){let p=h[i];p&&(p.style.maxWidth=p.style.minWidth=a+"px",p.classList.toggle("rt-cell-clip",u>a))}}}},K6e=class{constructor(e){this._name=e,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}},Cue=class{constructor(e,t,r){this._column_sizes=e,this._container=t,this._span_factory=new K6e("span"),this.table=r,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,t){Kg.set(e,t)}_get_or_create_metadata(e){if(e===void 0)return{};if(Kg.has(e))return Kg.get(e);{let t={};return Kg.set(e,t),t}}_replace_cell(e,t){let{tr:r,row_container:n}=this._get_row(e),o=n[t];return o&&(r.removeChild(o),n.splice(t,1,void 0)),o}_fetch_cell(e,t){if(!(e<0||t<0))return this.cells[e]?.[t]}_get_row(e){let t=this.rows[e];t||(t=this.rows[e]=document.createElement("tr"),this.table.appendChild(t));let r=this.cells[e];return r||(r=this.cells[e]=[]),{tr:t,row_container:r}}_get_cell(e="TD",t,r){let{tr:n,row_container:o}=this._get_row(t),i=o[r];if(i||(r<o.length?(i=o[r]=document.createElement(e),n.insertBefore(i,o.slice(r+1).find(s=>s))):(i=o[r]=document.createElement(e),n.appendChild(i))),i.tagName!==e){let s=document.createElement(e);n.replaceChild(s,i),this.cells[t].splice(r,1,s),i=s}return i}_clean_columns(e){for(let t=0;t<this.rows.length;t++){let r=this.rows[t],n=this.cells[t];this.cells[t]=n.slice(0,e[t]||e);let o=this.cells[t].filter(i=>i!==void 0).length;for(;r.children[o];)r.removeChild(r.children[o])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}},$6e=class extends Cue{constructor(...e){super(...e),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(e,t,r){let n=this._get_cell("TH",t,e[t]||0);if(e[t]+=1,n.removeAttribute("colspan"),n.style.minWidth="0",n.textContent="",r instanceof HTMLElement)n.appendChild(r);else{let i=this._span_factory.get("span");i.textContent=r,n.appendChild(i)}let o=this._span_factory.get("span");return o.className="rt-column-resize",n.appendChild(o),n}_draw_group(e,t,r){let n=this._get_or_create_metadata(r);return n.column_header=e,n.value=t,n.value=t,n}_draw_th(e,t,r,n,o){let i=this._get_or_create_metadata(r);if(i.column_header=e,i.value=t,i.size_key=o.length?o[0]:o,!(o.length>1)){let s=this._column_sizes.override[i.size_key],a=this._column_sizes.auto[i.size_key];s?(r.classList.toggle("rt-cell-clip",a>s),r.style.minWidth=s+"px",r.style.maxWidth=s+"px"):a?(r.classList.remove("rt-cell-clip"),r.style.maxWidth="",r.style.minWidth=a+"px"):(r.style.maxWidth="",r.style.maxWidth="")}return i}get_column_header(e){return this._get_cell("TH",this.num_rows()-1,e)}draw(e,t,r,n,o,i,s,a,u){let h=t?.length;if(h===0)return;let p,_,y,A;a=typeof a>"u"?h-1:a;for(let E=0;E<h;E++){if(y=t[E]?t[E]:"",this._offset_cache[E]=this._offset_cache[E]||0,E<a)u&&this._group_header_cache?.[E]?.[0]?.value===y?(p=this._group_header_cache[E][1],this._group_header_cache[E][2]+=1,r===1&&(this._group_header_cache[E][0].row_header_x=o),p.setAttribute("colspan",this._group_header_cache[E][2])):(p=this._draw_group_th(this._offset_cache,E,y),_=this._draw_group(t,y,p),this._group_header_cache[E]=[_,p,1]);else{p=this._draw_group_th(this._offset_cache,E,y),_=this._draw_th(e||t,y,p,n,o),typeof A>"u"&&(A={th:p,metadata:_});for(let[k]of this._group_header_cache)k.size_key=_.size_key;p.removeAttribute("colspan")}this._get_row(E).tr.classList.toggle("rt-autosize",E===a),p.classList.toggle("rt-group-corner",n===void 0),_&&(_.x=typeof n>"u"?n:Math.floor(n),_.column_header_y=E,_.x0=Math.floor(i),_._virtual_x=s,r===1&&(_.row_header_x=o))}return this._clean_rows(this._offset_cache.length),A=A||{th:p,metadata:_},A}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Q6e=class extends Cue{_draw_td(e,t,r,n,{column_name:o},{ridx_offset:i},s){let a=this._get_cell(e,t,n),u=this._get_or_create_metadata(a);u.y=t+Math.floor(i),u.size_key=s,e==="TD"&&(u.column_header=o);let h=this._column_sizes.override[u.size_key];if(h){let p=this._column_sizes.auto[u.size_key];a.classList.toggle("rt-cell-clip",p>h),a.style.minWidth=h+"px",a.style.maxWidth=h+"px"}else a.classList.remove("rt-cell-clip"),a.style.minWidth="",a.style.maxWidth="";return u.value!==r&&(r instanceof HTMLElement?(a.textContent="",a.appendChild(r)):a.textContent=r),u.value=r,{td:a,metadata:u}}draw(e,t,r,n=!1,o,i,s,a){let{cidx:u,column_data:h,row_headers:p,column_data_listener_metadata:_}=t,{row_height:y}=r,A,E=[],k=[],P=0,R=[];for(let V=0;V<(n?r.row_headers_length:1);V++){P=0;for(let N of h){let j=p?.[P],J;if(n){let ne=N[V],de=this._fetch_cell(P-(E[V]||1),u+V),fe=this._get_or_create_metadata(de),ye=this._fetch_cell(P,u+V-(R[P]||1)),ve=this._get_or_create_metadata(ye);a&&ye&&(ve.value===ne||ne===void 0)&&!ye.hasAttribute("rowspan")?(R[P]=R[P]?R[P]+1:2,ye.setAttribute("colspan",R[P]),this._replace_cell(P,u+V)):a&&de&&fe.value===ne&&!de.hasAttribute("colspan")?(E[V]=E[V]?E[V]+1:2,de.setAttribute("rowspan",E[V]),this._replace_cell(P,u+V)):(J=this._draw_td("TH",P,ne,u+V,t,r,V),J.td.style.display="",J.td.removeAttribute("rowspan"),J.td.removeAttribute("colspan"),J.metadata.row_header=N,J.metadata.row_header_x=V,J.metadata.y0=Math.floor(r.ridx_offset),J.metadata.y1=Math.ceil(r.y1),J.metadata._virtual_x=V,typeof i<"u"&&(J.metadata.x0=Math.floor(i)),E[V]=1,R[P]=1,k[V]=J)}else J=this._draw_td("TD",P,N,u,t,r,s),_&&(J.metadata.user=_[P]),J.metadata.x=typeof o>"u"?o:Math.floor(o),J.metadata.x1=Math.ceil(r.x1),J.metadata.row_header=j||[],J.metadata.y0=Math.floor(r.ridx_offset),J.metadata.y1=Math.ceil(r.y1),J.metadata.dx=Math.floor(o-i),J.metadata.dy=J.metadata.y-Math.floor(J.metadata.y0),J.metadata._virtual_x=u,typeof i<"u"&&(J.metadata.x0=Math.floor(i)),k[0]=J;if(P++,A=J?J.metadata:A,y=y||J?.td.offsetHeight,P*y>e)break}}return this._clean_rows(P),{tds:k,ridx:P,metadata:A,row_height:y}}clean({ridx:e,cidx:t}){this._clean_rows(e),this._clean_columns(t)}},Tue=class{constructor(e,t,r){this.clear(r);let[n]=r.children,[o,i]=n.children;this.table=n,this._column_sizes=t,this.header=new $6e(t,e,o),this.body=new Q6e(t,e,i),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(e){e.innerHTML=Eue`
            <table cellspacing="0">
                <thead></thead>
                <tbody></tbody>
            </table>
        `}autosize_cells(e,t){for(;e.length>0;){let[r,n]=e.pop(),o=r.getBoundingClientRect();this._column_sizes.row_height=t||Math.max(10,Math.min(this._column_sizes.row_height||o.height,o.height)),this._column_sizes.indices[n.size_key]=o.width;let i=this._column_sizes.override[n.size_key]!==void 0;o.width&&!i&&(this._column_sizes.auto[n.size_key]=o.width),r.style.minWidth==="0px"&&(r.style.minWidth=`${o.width}px`)}}async*draw(e,t,r,n,o,i){let{width:s,height:a}=e,{view:u,config:h}=t,{data:p,row_headers:_,column_headers:y,metadata:A,column_header_merge_depth:E,merge_headers:k="both"}=await u(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row)),P=k==="both"||k==="row",R=k==="both"||k==="column",{start_row:V=0,start_col:N=0,end_col:j=0,end_row:J=0}=o;_&&(this._row_headers_length=_.reduce((je,Re)=>Math.max(je,Re.length),0),_=_.map(je=>(je.length=this._row_headers_length,je))),t.config.column_pivots=Array.from(Array(y?.[0]?.length||0).keys()),t.config.row_pivots=Array.from(Array(_?.[0]?.length||0).keys());let ne=this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(o.start_col)]||0,de={viewport_width:0,selected_id:r,ridx_offset:V,sub_cell_offset:ne,x0:N,x1:j,y1:J,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},fe,ye=0,ve=[],be=!0;if(_?.length>0){let je=h.row_pivots.join(","),Re={column_name:je,cidx:0,column_data:_,row_headers:_,first_col:be},Se=ye+Math.floor(N);fe=this.body.draw(a,Re,{...de,x0:0},!0,void 0,void 0,Se,P);let Ue=[];for(let qe=0;qe<t.config.row_pivots.length;qe++){let Je=this.header.draw(je,Array(t.config.column_pivots.length).fill(""),1,void 0,qe,N,qe,E,R);Je&&Ue.push(Je)}if(be=!1,de.viewport_width+=Ue.reduce((qe,{th:Je},gt)=>qe+(this._column_sizes.indices[gt]||Je.offsetWidth),0),de.row_height=de.row_height||fe.row_height,ye=_[0].length,!n)for(let qe=0;qe<t.config.row_pivots.length;qe++){let{td:Je,metadata:gt}=fe.tds[qe]||{},{th:rt,metadata:At}=Ue[qe]||{};(Je||rt)&&ve.push([rt||Je,At||gt])}}try{let je=0,Re=i-o.start_col;for(;je<Re;){if(!p[je]){let kt=Math.max(o.end_col,0);o.start_col=kt;let yt=0,tr=0;for(;this._column_sizes.indices.length>ye+N+yt+1&&tr+de.viewport_width<s;)yt++,tr+=this._column_sizes.indices[ye+N+yt];if(tr+de.viewport_width<s){let Ir=Math.min(i,kt+5);o.end_col=Math.max(1,Math.min(i,Ir))}else o.end_col=Math.max(1,Math.min(i,kt+yt));let vr=u(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row));yield void 0;let wr=await vr;if(typeof wr.column_header_merge_depth<"u"&&(E=wr.column_header_merge_depth),typeof wr.merge_headers<"u"&&(k=wr.merge_headers),wr.data.length===0){yield ve;return}o.end_col=o.start_col+wr.data.length;for(let Ir=0;Ir<wr.data.length;Ir++)p[je+Ir]=wr.data[Ir],wr.metadata&&(A[je+Ir]=wr.metadata[Ir]),y&&(y[je+Ir]=wr.column_headers?.[Ir])}let Se=y?.[je]||"",Ue=p[je],qe=A?.[je],Je={column_name:Se,cidx:ye,column_data:Ue,column_data_listener_metadata:qe,row_headers:_,first_col:be},gt=je+N,rt=ye+Math.floor(N),At=this.header.draw(void 0,Se,void 0,gt,rt,N,ye,E,R);if(fe=this.body.draw(a,Je,de,!1,gt,N,rt,P),be=!1,!n)for(let{td:kt,metadata:yt}of fe.tds)ve.push([At?.th||kt,At?.metadata||yt]);let St=this._column_sizes.indices[ye+Math.floor(N)];if(St?de.viewport_width+=St:de.viewport_width+=At?.th?.offsetWidth||fe.tds.reduce((kt,yt)=>kt+yt.td?.offsetWidth,0),de.row_height=de.row_height||fe.row_height,ye++,je++,de.viewport_width-de.sub_cell_offset>s){this.body.clean({ridx:fe?.ridx||0,cidx:ye}),this.header.clean(),yield ve,de.viewport_width=0;for(let[kt]of ve)de.viewport_width+=kt.offsetWidth;if(de.viewport_width-de.sub_cell_offset>s)return}}this.body.clean({ridx:fe?.ridx||0,cidx:ye}),this.header.clean(),yield ve}finally{this.body.clean({ridx:fe?.ridx||0,cidx:ye}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},J6e=["both","horizontal","vertical","none"],eRe=class extends X6e{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new Tue(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let e=0;e<this.table_model.header.num_columns();e++){let t=this.table_model.header.get_column_header(e);t.style.minWidth="",t.style.maxWidth=""}}clear(){this.table_model=new Tue(this._table_clip,this._column_sizes,this)}addStyleListener(e){this._style_callbacks=this._style_callbacks.concat(e);let t=!0;return()=>{if(!t)return;t=!1;let r=this._style_callbacks=this._style_callbacks.slice(),n=r.indexOf(e);r.splice(n,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(!(typeof e>"u")){if(e instanceof HTMLElement)return Kg.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){let t=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(t)}}else if(e.column_header_y>=0){if(e.column_header_y<this._view_cache.config.column_pivots.length){let t=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(t)}}else return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length))}}getDrawFPS(){return U6e()}async scrollToCell(e,t){if(!this._view_cache){console.warn("data listener not configured");return}let r=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length*r,o=(this._table_clip.offsetHeight-n)%r,i=(this._virtual_panel.offsetHeight-o)/this._nrows;this.scrollTop=Math.ceil(i*t);let s=0;for(;e>0;)e--,s+=this._column_sizes.indices[e+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(s),await new Promise(requestAnimationFrame),await this._draw_flush()}setDataListener(e,{virtual_mode:t="both"}={}){let r={},n={row_pivots:[],column_pivots:[]};console.assert(J6e.indexOf(t)>-1,`Unknown virtual_mode ${t};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=t,this._invalid_schema=!0,this._view_cache={view:e,config:n,schema:r},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",eRe)});var K2=rd((H2,X2)=>{(function(){var e,t,r,n,o,i,s,a,u,h,p,_,y,A,E,k,P,R,V,N,j,J,ne,de,fe,ye,ve,be,je,Re,Se,Ue,qe,Je,gt,rt,At,St,kt,yt,tr,vr,wr,Ir,Br,qt,Lr,Yr,Rt,bn,tn,sr,Rn,dr,xt,ei,Hr,Pn,gn,No,bs,qo,ba,vs,zo,Do,Zt,eo,Xn,ws,wo,Ht,$r,cr,ji,to,zr,Ao,Oe,ue,ge,ke,Ve,We=[].slice;Oe=function(){var G,te,Q,ae,he;for(G={},he="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),ae=0,te=he.length;ae<te;ae++)Q=he[ae],G["[object "+Q+"]"]=Q.toLowerCase();return function(we){var Ee;return Ee=Object.prototype.toString.call(we),G[Ee]||"object"}}(),Yr=function(G,te,Q){return te==null&&(te=0),Q==null&&(Q=1),G<te&&(G=te),G>Q&&(G=Q),G},ue=function(G){return G.length>=3?Array.prototype.slice.call(G):G[0]},j=function(G){var te,Q;for(G._clipped=!1,G._unclipped=G.slice(0),te=Q=0;Q<3;te=++Q)te<3?((G[te]<0||G[te]>255)&&(G._clipped=!0),G[te]<0&&(G[te]=0),G[te]>255&&(G[te]=255)):te===3&&(G[te]<0&&(G[te]=0),G[te]>1&&(G[te]=1));return G._clipped||delete G._unclipped,G},n=Math.PI,cr=Math.round,de=Math.cos,je=Math.floor,Hr=Math.pow,Rt=Math.log,to=Math.sin,zr=Math.sqrt,A=Math.atan2,sr=Math.max,y=Math.abs,s=n*2,o=n/3,t=n/180,i=180/n,N=function(){return arguments[0]instanceof e?arguments[0]:function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,arguments,function(){})},N.default=N,_=[],typeof X2<"u"&&X2!==null&&X2.exports!=null&&(X2.exports=N),typeof define=="function"&&define.amd?define([],function(){return N}):($r=typeof H2<"u"&&H2!==null?H2:this,$r.chroma=N),N.version="1.4.1",p={},u=[],h=!1,e=function(){function G(){var te,Q,ae,he,we,Ee,Xe,ut,mt;for(Ee=this,Q=[],ut=0,he=arguments.length;ut<he;ut++)te=arguments[ut],te!=null&&Q.push(te);if(Q.length>1&&(Xe=Q[Q.length-1]),p[Xe]!=null)Ee._rgb=j(p[Xe](ue(Q.slice(0,-1))));else{for(h||(u=u.sort(function(Tt,jt){return jt.p-Tt.p}),h=!0),mt=0,we=u.length;mt<we&&(ae=u[mt],Xe=ae.test.apply(ae,Q),!Xe);mt++);Xe&&(Ee._rgb=j(p[Xe].apply(p,Q)))}Ee._rgb==null&&console.warn("unknown format: "+Q),Ee._rgb==null&&(Ee._rgb=[0,0,0]),Ee._rgb.length===3&&Ee._rgb.push(1)}return G.prototype.toString=function(){return this.hex()},G}(),N._input=p;N.brewer=R={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var G,te;te=[];for(G in R)te.push(R[G.toLowerCase()]=R[G]);return te}(),ge={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},N.colors=ne=ge,wr=function(){var G,te,Q,ae,he,we,Ee,Xe,ut;return te=ue(arguments),he=te[0],G=te[1],Q=te[2],Xe=(he+16)/116,Ee=isNaN(G)?Xe:Xe+G/500,ut=isNaN(Q)?Xe:Xe-Q/200,Xe=r.Yn*Ir(Xe),Ee=r.Xn*Ir(Ee),ut=r.Zn*Ir(ut),we=Ve(3.2404542*Ee-1.5371385*Xe-.4985314*ut),ae=Ve(-.969266*Ee+1.8760108*Xe+.041556*ut),Q=Ve(.0556434*Ee-.2040259*Xe+1.0572252*ut),[we,ae,Q,te.length>3?te[3]:1]},Ve=function(G){return 255*(G<=.00304?12.92*G:1.055*Hr(G,1/2.4)-.055)},Ir=function(G){return G>r.t1?G*G*G:r.t2*(G-r.t0)},r={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},zo=function(){var G,te,Q,ae,he,we,Ee,Xe;return ae=ue(arguments),Q=ae[0],te=ae[1],G=ae[2],he=ws(Q,te,G),we=he[0],Ee=he[1],Xe=he[2],[116*Ee-16,500*(we-Ee),200*(Ee-Xe)]},wo=function(G){return(G/=255)<=.04045?G/12.92:Hr((G+.055)/1.055,2.4)},ke=function(G){return G>r.t3?Hr(G,1/3):G/r.t2+r.t0},ws=function(){var G,te,Q,ae,he,we,Ee;return ae=ue(arguments),Q=ae[0],te=ae[1],G=ae[2],Q=wo(Q),te=wo(te),G=wo(G),he=ke((.4124564*Q+.3575761*te+.1804375*G)/r.Xn),we=ke((.2126729*Q+.7151522*te+.072175*G)/r.Yn),Ee=ke((.0193339*Q+.119192*te+.9503041*G)/r.Zn),[he,we,Ee]},N.lab=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["lab"]),function(){})},p.lab=wr,e.prototype.lab=function(){return zo(this._rgb)},E=function(G){var te,Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt;return G=function(){var Et,Ct,Dt;for(Dt=[],Ct=0,Et=G.length;Ct<Et;Ct++)he=G[Ct],Dt.push(N(he));return Dt}(),G.length===2?(mt=function(){var Et,Ct,Dt;for(Dt=[],Ct=0,Et=G.length;Ct<Et;Ct++)he=G[Ct],Dt.push(he.lab());return Dt}(),we=mt[0],Ee=mt[1],te=function(Et){var Ct,Dt;return Dt=function(){var Lt,xr;for(xr=[],Ct=Lt=0;Lt<=2;Ct=++Lt)xr.push(we[Ct]+Et*(Ee[Ct]-we[Ct]));return xr}(),N.lab.apply(N,Dt)}):G.length===3?(Tt=function(){var Et,Ct,Dt;for(Dt=[],Ct=0,Et=G.length;Ct<Et;Ct++)he=G[Ct],Dt.push(he.lab());return Dt}(),we=Tt[0],Ee=Tt[1],Xe=Tt[2],te=function(Et){var Ct,Dt;return Dt=function(){var Lt,xr;for(xr=[],Ct=Lt=0;Lt<=2;Ct=++Lt)xr.push((1-Et)*(1-Et)*we[Ct]+2*(1-Et)*Et*Ee[Ct]+Et*Et*Xe[Ct]);return xr}(),N.lab.apply(N,Dt)}):G.length===4?(jt=function(){var Et,Ct,Dt;for(Dt=[],Ct=0,Et=G.length;Ct<Et;Ct++)he=G[Ct],Dt.push(he.lab());return Dt}(),we=jt[0],Ee=jt[1],Xe=jt[2],ut=jt[3],te=function(Et){var Ct,Dt;return Dt=function(){var Lt,xr;for(xr=[],Ct=Lt=0;Lt<=2;Ct=++Lt)xr.push((1-Et)*(1-Et)*(1-Et)*we[Ct]+3*(1-Et)*(1-Et)*Et*Ee[Ct]+3*(1-Et)*Et*Et*Xe[Ct]+Et*Et*Et*ut[Ct]);return xr}(),N.lab.apply(N,Dt)}):G.length===5&&(Q=E(G.slice(0,3)),ae=E(G.slice(2,5)),te=function(Et){return Et<.5?Q(Et*2):ae((Et-.5)*2)}),te},N.bezier=function(G){var te;return te=E(G),te.scale=function(){return N.scale(te)},te},N.cubehelix=function(G,te,Q,ae,he){var we,Ee,Xe;return G==null&&(G=300),te==null&&(te=-1.5),Q==null&&(Q=1),ae==null&&(ae=1),he==null&&(he=[0,1]),we=0,Oe(he)==="array"?Ee=he[1]-he[0]:(Ee=0,he=[he,he]),Xe=function(ut){var mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr;return mt=s*((G+120)/360+te*ut),Lt=Hr(he[0]+Ee*ut,ae),Dt=we!==0?Q[0]+ut*we:Q,Tt=Dt*Lt*(1-Lt)/2,Et=de(mt),Sr=to(mt),xr=Lt+Tt*(-.14861*Et+1.78277*Sr),Ct=Lt+Tt*(-.29227*Et-.90649*Sr),jt=Lt+Tt*(1.97294*Et),N(j([xr*255,Ct*255,jt*255,1]))},Xe.start=function(ut){return ut==null?G:(G=ut,Xe)},Xe.rotations=function(ut){return ut==null?te:(te=ut,Xe)},Xe.gamma=function(ut){return ut==null?ae:(ae=ut,Xe)},Xe.hue=function(ut){return ut==null?Q:(Q=ut,Oe(Q)==="array"?(we=Q[1]-Q[0],we===0&&(Q=Q[1])):we=0,Xe)},Xe.lightness=function(ut){return ut==null?he:(Oe(ut)==="array"?(he=ut,Ee=ut[1]-ut[0]):(he=[ut,ut],Ee=0),Xe)},Xe.scale=function(){return N.scale(Xe)},Xe.hue(Q),Xe},N.random=function(){var G,te,Q,ae;for(te="0123456789abcdef",G="#",Q=ae=0;ae<6;Q=++ae)G+=te.charAt(je(Math.random()*16));return new e(G)},_=[],rt=function(G,te,Q,ae){var he,we,Ee,Xe;for(Q==null&&(Q=.5),ae==null&&(ae="rgb"),Oe(G)!=="object"&&(G=N(G)),Oe(te)!=="object"&&(te=N(te)),Ee=0,we=_.length;Ee<we;Ee++)if(he=_[Ee],ae===he[0]){Xe=he[1](G,te,Q,ae);break}if(Xe==null)throw"color mode "+ae+" is not supported";return Xe.alpha(G.alpha()+Q*(te.alpha()-G.alpha()))},N.interpolate=rt,e.prototype.interpolate=function(G,te,Q){return rt(this,G,te,Q)},N.mix=rt,e.prototype.mix=e.prototype.interpolate,p.rgb=function(){var G,te,Q,ae;te=ue(arguments),Q=[];for(G in te)ae=te[G],Q.push(ae);return Q},N.rgb=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["rgb"]),function(){})},e.prototype.rgb=function(G){return G==null&&(G=!0),G?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},e.prototype.rgba=function(G){return G==null&&(G=!0),G?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(G){var te;if(te=ue(arguments),Oe(te)==="array"&&te.length===3||te.length===4&&Oe(te[3])==="number"&&te[3]>=0&&te[3]<=1)return"rgb"}}),p.lrgb=p.rgb,kt=function(G,te,Q,ae){var he,we;return he=G._rgb,we=te._rgb,new e(zr(Hr(he[0],2)*(1-Q)+Hr(we[0],2)*Q),zr(Hr(he[1],2)*(1-Q)+Hr(we[1],2)*Q),zr(Hr(he[2],2)*(1-Q)+Hr(we[2],2)*Q),ae)},a=function(G){var te,Q,ae,he,we,Ee;for(Q=1/G.length,Ee=[0,0,0,0],he=0,ae=G.length;he<ae;he++)te=G[he],we=te._rgb,Ee[0]+=Hr(we[0],2)*Q,Ee[1]+=Hr(we[1],2)*Q,Ee[2]+=Hr(we[2],2)*Q,Ee[3]+=we[3]*Q;return Ee[0]=zr(Ee[0]),Ee[1]=zr(Ee[1]),Ee[2]=zr(Ee[2]),Ee[3]>1&&(Ee[3]=1),new e(j(Ee))},_.push(["lrgb",kt]),N.average=function(G,te){var Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt;if(te==null&&(te="rgb"),Tt=G.length,G=G.map(function(Lt){return N(Lt)}),ut=G.splice(0,1)[0],te==="lrgb")return a(G);Ct=ut.get(te),we=[],Ee=0,Xe=0;for(mt in Ct)Ct[mt]=Ct[mt]||0,we.push(isNaN(Ct[mt])?0:1),te.charAt(mt)==="h"&&!isNaN(Ct[mt])&&(Q=Ct[mt]/180*n,Ee+=de(Q),Xe+=to(Q));for(ae=ut.alpha(),Et=0,jt=G.length;Et<jt;Et++){he=G[Et],Dt=he.get(te),ae+=he.alpha();for(mt in Ct)isNaN(Dt[mt])||(we[mt]+=1,te.charAt(mt)==="h"?(Q=Dt[mt]/180*n,Ee+=de(Q),Xe+=to(Q)):Ct[mt]+=Dt[mt])}for(mt in Ct)if(te.charAt(mt)==="h"){for(Q=A(Xe/we[mt],Ee/we[mt])/n*180;Q<0;)Q+=360;for(;Q>=360;)Q-=360;Ct[mt]=Q}else Ct[mt]=Ct[mt]/we[mt];return N(Ct,te).alpha(ae/Tt)},Se=function(G){var te,Q,ae,he,we,Ee;if(G.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(G.length===4||G.length===7)&&(G=G.substr(1)),G.length===3&&(G=G.split(""),G=G[0]+G[0]+G[1]+G[1]+G[2]+G[2]),Ee=parseInt(G,16),he=Ee>>16,ae=Ee>>8&255,Q=Ee&255,[he,ae,Q,1];if(G.match(/^#?([A-Fa-f0-9]{8})$/))return G.length===9&&(G=G.substr(1)),Ee=parseInt(G,16),he=Ee>>24&255,ae=Ee>>16&255,Q=Ee>>8&255,te=cr((Ee&255)/255*100)/100,[he,ae,Q,te];if(p.css!=null&&(we=p.css(G)))return we;throw"unknown color: "+G},bs=function(G,te){var Q,ae,he,we,Ee,Xe,ut;return te==null&&(te="auto"),Ee=G[0],he=G[1],ae=G[2],Q=G[3],te==="auto"&&(te=Q<1?"rgba":"rgb"),Ee=Math.round(Ee),he=Math.round(he),ae=Math.round(ae),ut=Ee<<16|he<<8|ae,Xe="000000"+ut.toString(16),Xe=Xe.substr(Xe.length-6),we="0"+cr(Q*255).toString(16),we=we.substr(we.length-2),"#"+function(){switch(te.toLowerCase()){case"rgba":return Xe+we;case"argb":return we+Xe;default:return Xe}}()},p.hex=function(G){return Se(G)},N.hex=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["hex"]),function(){})},e.prototype.hex=function(G){return G==null&&(G="auto"),bs(this._rgb,G)},u.push({p:4,test:function(G){if(arguments.length===1&&Oe(G)==="string")return"hex"}}),Je=function(){var G,te,Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct;if(G=ue(arguments),he=G[0],Tt=G[1],Ee=G[2],Tt===0)ut=ae=te=Ee*255;else{for(Ct=[0,0,0],Q=[0,0,0],Et=Ee<.5?Ee*(1+Tt):Ee+Tt-Ee*Tt,jt=2*Ee-Et,he/=360,Ct[0]=he+1/3,Ct[1]=he,Ct[2]=he-1/3,we=Xe=0;Xe<=2;we=++Xe)Ct[we]<0&&(Ct[we]+=1),Ct[we]>1&&(Ct[we]-=1),6*Ct[we]<1?Q[we]=jt+(Et-jt)*6*Ct[we]:2*Ct[we]<1?Q[we]=Et:3*Ct[we]<2?Q[we]=jt+(Et-jt)*(2/3-Ct[we])*6:Q[we]=jt;mt=[cr(Q[0]*255),cr(Q[1]*255),cr(Q[2]*255)],ut=mt[0],ae=mt[1],te=mt[2]}return G.length>3?[ut,ae,te,G[3]]:[ut,ae,te]},ba=function(G,te,Q){var ae,he,we,Ee,Xe;return G!==void 0&&G.length>=3&&(Ee=G,G=Ee[0],te=Ee[1],Q=Ee[2]),G/=255,te/=255,Q/=255,we=Math.min(G,te,Q),sr=Math.max(G,te,Q),he=(sr+we)/2,sr===we?(Xe=0,ae=Number.NaN):Xe=he<.5?(sr-we)/(sr+we):(sr-we)/(2-sr-we),G===sr?ae=(te-Q)/(sr-we):te===sr?ae=2+(Q-G)/(sr-we):Q===sr&&(ae=4+(G-te)/(sr-we)),ae*=60,ae<0&&(ae+=360),[ae,Xe,he]},N.hsl=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["hsl"]),function(){})},p.hsl=Je,e.prototype.hsl=function(){return ba(this._rgb)},gt=function(){var G,te,Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr;if(G=ue(arguments),he=G[0],Lt=G[1],Sr=G[2],Sr*=255,Lt===0)ut=ae=te=Sr;else switch(he===360&&(he=0),he>360&&(he-=360),he<0&&(he+=360),he/=60,we=je(he),Q=he-we,Ee=Sr*(1-Lt),Xe=Sr*(1-Lt*Q),xr=Sr*(1-Lt*(1-Q)),we){case 0:mt=[Sr,xr,Ee],ut=mt[0],ae=mt[1],te=mt[2];break;case 1:Tt=[Xe,Sr,Ee],ut=Tt[0],ae=Tt[1],te=Tt[2];break;case 2:jt=[Ee,Sr,xr],ut=jt[0],ae=jt[1],te=jt[2];break;case 3:Et=[Ee,Xe,Sr],ut=Et[0],ae=Et[1],te=Et[2];break;case 4:Ct=[xr,Ee,Sr],ut=Ct[0],ae=Ct[1],te=Ct[2];break;case 5:Dt=[Sr,Ee,Xe],ut=Dt[0],ae=Dt[1],te=Dt[2]}return[ut,ae,te,G.length>3?G[3]:1]},vs=function(){var G,te,Q,ae,he,we,Ee,Xe,ut;return Ee=ue(arguments),we=Ee[0],Q=Ee[1],G=Ee[2],he=Math.min(we,Q,G),sr=Math.max(we,Q,G),te=sr-he,ut=sr/255,sr===0?(ae=Number.NaN,Xe=0):(Xe=te/sr,we===sr&&(ae=(Q-G)/te),Q===sr&&(ae=2+(G-we)/te),G===sr&&(ae=4+(we-Q)/te),ae*=60,ae<0&&(ae+=360)),[ae,Xe,ut]},N.hsv=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["hsv"]),function(){})},p.hsv=gt,e.prototype.hsv=function(){return vs(this._rgb)},xt=function(G){var te,Q,ae;return Oe(G)==="number"&&G>=0&&G<=16777215?(ae=G>>16,Q=G>>8&255,te=G&255,[ae,Q,te,1]):(console.warn("unknown num color: "+G),[0,0,0,1])},eo=function(){var G,te,Q,ae;return ae=ue(arguments),Q=ae[0],te=ae[1],G=ae[2],(Q<<16)+(te<<8)+G},N.num=function(G){return new e(G,"num")},e.prototype.num=function(G){return G==null&&(G="rgb"),eo(this._rgb,G)},p.num=xt,u.push({p:1,test:function(G){if(arguments.length===1&&Oe(G)==="number"&&G>=0&&G<=16777215)return"num"}}),Re=function(){var G,te,Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr,ln,pr;if(Q=ue(arguments),Xe=Q[0],he=Q[1],te=Q[2],he=he/100,Ee=Ee/100*255,G=he*255,he===0)jt=Ee=ae=te;else switch(Xe===360&&(Xe=0),Xe>360&&(Xe-=360),Xe<0&&(Xe+=360),Xe/=60,ut=je(Xe),we=Xe-ut,mt=te*(1-he),Tt=mt+G*(1-we),ln=mt+G*we,pr=mt+G,ut){case 0:Et=[pr,ln,mt],jt=Et[0],Ee=Et[1],ae=Et[2];break;case 1:Ct=[Tt,pr,mt],jt=Ct[0],Ee=Ct[1],ae=Ct[2];break;case 2:Dt=[mt,pr,ln],jt=Dt[0],Ee=Dt[1],ae=Dt[2];break;case 3:Lt=[mt,Tt,pr],jt=Lt[0],Ee=Lt[1],ae=Lt[2];break;case 4:xr=[ln,mt,pr],jt=xr[0],Ee=xr[1],ae=xr[2];break;case 5:Sr=[pr,mt,Tt],jt=Sr[0],Ee=Sr[1],ae=Sr[2]}return[jt,Ee,ae,Q.length>3?Q[3]:1]},No=function(){var G,te,Q,ae,he,we,Ee,Xe,ut;return ut=ue(arguments),Xe=ut[0],he=ut[1],te=ut[2],Ee=Math.min(Xe,he,te),sr=Math.max(Xe,he,te),ae=sr-Ee,Q=ae*100/255,G=Ee/(255-ae)*100,ae===0?we=Number.NaN:(Xe===sr&&(we=(he-te)/ae),he===sr&&(we=2+(te-Xe)/ae),te===sr&&(we=4+(Xe-he)/ae),we*=60,we<0&&(we+=360)),[we,Q,G]},N.hcg=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["hcg"]),function(){})},p.hcg=Re,e.prototype.hcg=function(){return No(this._rgb)},fe=function(G){var te,Q,ae,he,we,Ee,Xe,ut;if(G=G.toLowerCase(),N.colors!=null&&N.colors[G])return Se(N.colors[G]);if(we=G.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(Xe=we.slice(1,4),he=Ee=0;Ee<=2;he=++Ee)Xe[he]=+Xe[he];Xe[3]=1}else if(we=G.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(Xe=we.slice(1,5),he=ut=0;ut<=3;he=++ut)Xe[he]=+Xe[he];else if(we=G.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(Xe=we.slice(1,4),he=te=0;te<=2;he=++te)Xe[he]=cr(Xe[he]*2.55);Xe[3]=1}else if(we=G.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(Xe=we.slice(1,5),he=Q=0;Q<=2;he=++Q)Xe[he]=cr(Xe[he]*2.55);Xe[3]=+Xe[3]}else(we=G.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(ae=we.slice(1,4),ae[1]*=.01,ae[2]*=.01,Xe=Je(ae),Xe[3]=1):(we=G.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(ae=we.slice(1,4),ae[1]*=.01,ae[2]*=.01,Xe=Je(ae),Xe[3]=+we[4]);return Xe},gn=function(G){var te;if(te=G[3]<1?"rgba":"rgb",te==="rgb")return te+"("+G.slice(0,3).map(cr).join(",")+")";if(te==="rgba")return te+"("+G.slice(0,3).map(cr).join(",")+","+G[3]+")"},Ht=function(G){return cr(G*100)/100},qe=function(G,te){var Q;return Q=te<1?"hsla":"hsl",G[0]=Ht(G[0]||0),G[1]=Ht(G[1]*100)+"%",G[2]=Ht(G[2]*100)+"%",Q==="hsla"&&(G[3]=te),Q+"("+G.join(",")+")"},p.css=function(G){return fe(G)},N.css=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["css"]),function(){})},e.prototype.css=function(G){if(G==null&&(G="rgb"),G.slice(0,3)==="rgb")return gn(this._rgb);if(G.slice(0,3)==="hsl")return qe(this.hsl(),this.alpha())},p.named=function(G){return Se(ge[G])},u.push({p:5,test:function(G){if(arguments.length===1&&ge[G]!=null)return"named"}}),e.prototype.name=function(G){var te,Q;arguments.length&&(ge[G]&&(this._rgb=Se(ge[G])),this._rgb[3]=1),te=this.hex("rgb");for(Q in ge)if(te===ge[Q])return Q;return te},Br=function(){var G,te,Q,ae;return ae=ue(arguments),Q=ae[0],G=ae[1],te=ae[2],te=te*t,[Q,de(te)*G,to(te)*G]},qt=function(){var G,te,Q,ae,he,we,Ee,Xe,ut,mt,Tt;return Q=ue(arguments),Xe=Q[0],he=Q[1],Ee=Q[2],mt=Br(Xe,he,Ee),G=mt[0],te=mt[1],ae=mt[2],Tt=wr(G,te,ae),ut=Tt[0],we=Tt[1],ae=Tt[2],[ut,we,ae,Q.length>3?Q[3]:1]},vr=function(){var G,te,Q,ae,he,we;return we=ue(arguments),he=we[0],G=we[1],te=we[2],Q=zr(G*G+te*te),ae=(A(te,G)*i+360)%360,cr(Q*1e4)===0&&(ae=Number.NaN),[he,Q,ae]},Do=function(){var G,te,Q,ae,he,we,Ee;return we=ue(arguments),he=we[0],Q=we[1],te=we[2],Ee=zo(he,Q,te),ae=Ee[0],G=Ee[1],te=Ee[2],vr(ae,G,te)},N.lch=function(){var G;return G=ue(arguments),new e(G,"lch")},N.hcl=function(){var G;return G=ue(arguments),new e(G,"hcl")},p.lch=qt,p.hcl=function(){var G,te,Q,ae;return ae=ue(arguments),te=ae[0],G=ae[1],Q=ae[2],qt([Q,G,te])},e.prototype.lch=function(){return Do(this._rgb)},e.prototype.hcl=function(){return Do(this._rgb).reverse()},Pn=function(G){var te,Q,ae,he,we,Ee,Xe,ut,mt;return G==null&&(G="rgb"),ut=ue(arguments),Xe=ut[0],he=ut[1],te=ut[2],Xe=Xe/255,he=he/255,te=te/255,we=1-Math.max(Xe,Math.max(he,te)),ae=we<1?1/(1-we):0,Q=(1-Xe-we)*ae,Ee=(1-he-we)*ae,mt=(1-te-we)*ae,[Q,Ee,mt,we]},J=function(){var G,te,Q,ae,he,we,Ee,Xe,ut;return te=ue(arguments),ae=te[0],Ee=te[1],ut=te[2],we=te[3],G=te.length>4?te[4]:1,we===1?[0,0,0,G]:(Xe=ae>=1?0:255*(1-ae)*(1-we),he=Ee>=1?0:255*(1-Ee)*(1-we),Q=ut>=1?0:255*(1-ut)*(1-we),[Xe,he,Q,G])},p.cmyk=function(){return J(ue(arguments))},N.cmyk=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["cmyk"]),function(){})},e.prototype.cmyk=function(){return Pn(this._rgb)},p.gl=function(){var G,te,Q,ae,he;for(ae=function(){var we,Ee;we=ue(arguments),Ee=[];for(te in we)he=we[te],Ee.push(he);return Ee}.apply(this,arguments),G=Q=0;Q<=2;G=++Q)ae[G]*=255;return ae},N.gl=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["gl"]),function(){})},e.prototype.gl=function(){var G;return G=this._rgb,[G[0]/255,G[1]/255,G[2]/255,G[3]]},Zt=function(G,te,Q){var ae;return ae=ue(arguments),G=ae[0],te=ae[1],Q=ae[2],G=bn(G),te=bn(te),Q=bn(Q),.2126*G+.7152*te+.0722*Q},bn=function(G){return G/=255,G<=.03928?G/12.92:Hr((G+.055)/1.055,2.4)},tr=function(G,te,Q,ae){var he,we;return he=G._rgb,we=te._rgb,new e(he[0]+Q*(we[0]-he[0]),he[1]+Q*(we[1]-he[1]),he[2]+Q*(we[2]-he[2]),ae)},_.push(["rgb",tr]),e.prototype.luminance=function(G,te){var Q,ae,he,we,Ee;return te==null&&(te="rgb"),arguments.length?(we=this._rgb,G===0?we=[0,0,0,this._rgb[3]]:G===1?we=[255,255,255,this[3]]:(Q=Zt(this._rgb),ae=1e-7,he=20,Ee=function(Xe,ut){var mt,Tt;return Tt=Xe.interpolate(ut,.5,te),mt=Tt.luminance(),Math.abs(G-mt)<ae||!he--?Tt:mt>G?Ee(Xe,Tt):Ee(Tt,ut)},Q>G?we=Ee(N("black"),this).rgba():we=Ee(this,N("white")).rgba()),N(we).alpha(this.alpha())):Zt(this._rgb)},Ao=function(G){var te,Q,ae,he;return he=G/100,he<66?(ae=255,Q=-155.25485562709179-.44596950469579133*(Q=he-2)+104.49216199393888*Rt(Q),te=he<20?0:-254.76935184120902+.8274096064007395*(te=he-10)+115.67994401066147*Rt(te)):(ae=351.97690566805693+.114206453784165*(ae=he-55)-40.25366309332127*Rt(ae),Q=325.4494125711974+.07943456536662342*(Q=he-50)-28.0852963507957*Rt(Q),te=255),[ae,Q,te]},Xn=function(){var G,te,Q,ae,he,we,Ee,Xe,ut;for(Ee=ue(arguments),we=Ee[0],Q=Ee[1],G=Ee[2],he=1e3,ae=4e4,te=.4;ae-he>te;)ut=(ae+he)*.5,Xe=Ao(ut),Xe[2]/Xe[0]>=G/we?ae=ut:he=ut;return cr(ut)},N.temperature=N.kelvin=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["temperature"]),function(){})},p.temperature=p.kelvin=p.K=Ao,e.prototype.temperature=function(){return Xn(this._rgb)},e.prototype.kelvin=e.prototype.temperature,N.contrast=function(G,te){var Q,ae,he,we;return((he=Oe(G))==="string"||he==="number")&&(G=new e(G)),((we=Oe(te))==="string"||we==="number")&&(te=new e(te)),Q=G.luminance(),ae=te.luminance(),Q>ae?(Q+.05)/(ae+.05):(ae+.05)/(Q+.05)},N.distance=function(G,te,Q){var ae,he,we,Ee,Xe,ut,mt;Q==null&&(Q="lab"),((Xe=Oe(G))==="string"||Xe==="number")&&(G=new e(G)),((ut=Oe(te))==="string"||ut==="number")&&(te=new e(te)),we=G.get(Q),Ee=te.get(Q),mt=0;for(he in we)ae=(we[he]||0)-(Ee[he]||0),mt+=ae*ae;return Math.sqrt(mt)},N.deltaE=function(G,te,Q,ae){var he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr,ln,pr,un,rn,en,Xr,di,It,fr,Ur,kr,Pr,xn;for(Q==null&&(Q=1),ae==null&&(ae=1),((un=Oe(G))==="string"||un==="number")&&(G=new e(G)),((rn=Oe(te))==="string"||rn==="number")&&(te=new e(te)),en=G.lab(),he=en[0],Ee=en[1],ut=en[2],Xr=te.lab(),we=Xr[0],Xe=Xr[1],mt=Xr[2],Tt=zr(Ee*Ee+ut*ut),jt=zr(Xe*Xe+mt*mt),fr=he<16?.511:.040975*he/(1+.01765*he),di=.0638*Tt/(1+.0131*Tt)+.638,pr=Tt<1e-6?0:A(ut,Ee)*180/n;pr<0;)pr+=360;for(;pr>=360;)pr-=360;return Ur=pr>=164&&pr<=345?.56+y(.2*de(n*(pr+168)/180)):.36+y(.4*de(n*(pr+35)/180)),Et=Tt*Tt*Tt*Tt,ln=zr(Et/(Et+1900)),It=di*(ln*Ur+1-ln),Sr=he-we,xr=Tt-jt,Dt=Ee-Xe,Lt=ut-mt,Ct=Dt*Dt+Lt*Lt-xr*xr,kr=Sr/(Q*fr),Pr=xr/(ae*di),xn=It,zr(kr*kr+Pr*Pr+Ct/(xn*xn))},e.prototype.get=function(G){var te,Q,ae,he,we,Ee;return ae=this,we=G.split("."),he=we[0],te=we[1],Ee=ae[he](),te?(Q=he.indexOf(te),Q>-1?Ee[Q]:console.warn("unknown channel "+te+" in mode "+he)):Ee},e.prototype.set=function(G,te){var Q,ae,he,we,Ee,Xe;if(he=this,Ee=G.split("."),we=Ee[0],Q=Ee[1],Q)if(Xe=he[we](),ae=we.indexOf(Q),ae>-1)if(Oe(te)==="string")switch(te.charAt(0)){case"+":Xe[ae]+=+te;break;case"-":Xe[ae]+=+te;break;case"*":Xe[ae]*=+te.substr(1);break;case"/":Xe[ae]/=+te.substr(1);break;default:Xe[ae]=+te}else Xe[ae]=te;else console.warn("unknown channel "+Q+" in mode "+we);else Xe=te;return N(Xe,we).alpha(he.alpha())},e.prototype.clipped=function(){return this._rgb._clipped||!1},e.prototype.alpha=function(G){return arguments.length?N.rgb([this._rgb[0],this._rgb[1],this._rgb[2],G]):this._rgb[3]},e.prototype.darken=function(G){var te,Q;return G==null&&(G=1),Q=this,te=Q.lab(),te[0]-=r.Kn*G,N.lab(te).alpha(Q.alpha())},e.prototype.brighten=function(G){return G==null&&(G=1),this.darken(-G)},e.prototype.darker=e.prototype.darken,e.prototype.brighter=e.prototype.brighten,e.prototype.saturate=function(G){var te,Q;return G==null&&(G=1),Q=this,te=Q.lch(),te[1]+=G*r.Kn,te[1]<0&&(te[1]=0),N.lch(te).alpha(Q.alpha())},e.prototype.desaturate=function(G){return G==null&&(G=1),this.saturate(-G)},e.prototype.premultiply=function(){var G,te;return te=this.rgb(),G=this.alpha(),N(te[0]*G,te[1]*G,te[2]*G,G)},k=function(G,te,Q){if(!k[Q])throw"unknown blend mode "+Q;return k[Q](G,te)},P=function(G){return function(te,Q){var ae,he;return ae=N(Q).rgb(),he=N(te).rgb(),N(G(ae,he),"rgb")}},be=function(G){return function(te,Q){var ae,he,we;for(we=[],ae=he=0;he<=3;ae=++he)we[ae]=G(te[ae],Q[ae]);return we}},dr=function(G,te){return G},Rn=function(G,te){return G*te/255},ye=function(G,te){return G>te?te:G},Lr=function(G,te){return G>te?G:te},ji=function(G,te){return 255*(1-(1-G/255)*(1-te/255))},ei=function(G,te){return te<128?2*G*te/255:255*(1-2*(1-G/255)*(1-te/255))},V=function(G,te){return 255*(1-(1-te/255)/(G/255))},ve=function(G,te){return G===255||(G=255*(te/255)/(1-G/255),G>255)?255:G},k.normal=P(be(dr)),k.multiply=P(be(Rn)),k.screen=P(be(ji)),k.overlay=P(be(ei)),k.darken=P(be(ye)),k.lighten=P(be(Lr)),k.dodge=P(be(ve)),k.burn=P(be(V)),N.blend=k,N.analyze=function(G){var te,Q,ae,he;for(ae={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},Q=0,te=G.length;Q<te;Q++)he=G[Q],he!=null&&!isNaN(he)&&(ae.values.push(he),ae.sum+=he,he<ae.min&&(ae.min=he),he>ae.max&&(ae.max=he),ae.count+=1);return ae.domain=[ae.min,ae.max],ae.limits=function(we,Ee){return N.limits(ae,we,Ee)},ae},N.scale=function(G,te){var Q,ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr,ln,pr,un,rn,en,Xr,di;return jt="rgb",Et=N("#ccc"),xr=0,Xe=!1,Ee=[0,1],Lt=[],Dt=[0,0],Q=!1,he=[],Ct=!1,Tt=0,mt=1,we=!1,ae={},Sr=!0,ut=1,Xr=function(It){var fr,Ur,kr,Pr,xn,on;if(It==null&&(It=["#fff","#000"]),It!=null&&Oe(It)==="string"&&N.brewer!=null&&(It=N.brewer[It]||N.brewer[It.toLowerCase()]||It),Oe(It)==="array"){for(It.length===1&&(It=[It[0],It[0]]),It=It.slice(0),fr=kr=0,Pr=It.length-1;0<=Pr?kr<=Pr:kr>=Pr;fr=0<=Pr?++kr:--kr)Ur=It[fr],Oe(Ur)==="string"&&(It[fr]=N(Ur));for(Lt.length=0,fr=on=0,xn=It.length-1;0<=xn?on<=xn:on>=xn;fr=0<=xn?++on:--on)Lt.push(fr/(It.length-1))}return en(),he=It},un=function(It){var fr,Ur;if(Q!=null){for(Ur=Q.length-1,fr=0;fr<Ur&&It>=Q[fr];)fr++;return fr-1}return 0},di=function(It){return It},ln=function(It){var fr,Ur,kr,Pr,xn;return xn=It,Q.length>2&&(Pr=Q.length-1,fr=un(It),kr=Q[0]+(Q[1]-Q[0])*(0+xr*.5),Ur=Q[Pr-1]+(Q[Pr]-Q[Pr-1])*(1-xr*.5),xn=Tt+(Q[fr]+(Q[fr+1]-Q[fr])*.5-kr)/(Ur-kr)*(mt-Tt)),xn},rn=function(It,fr){var Ur,kr,Pr,xn,on,qr,Nn,sn;if(fr==null&&(fr=!1),isNaN(It)||It===null)return Et;if(fr?sn=It:Q&&Q.length>2?(Ur=un(It),sn=Ur/(Q.length-2)):mt!==Tt?sn=(It-Tt)/(mt-Tt):sn=1,fr||(sn=di(sn)),ut!==1&&(sn=Hr(sn,ut)),sn=Dt[0]+sn*(1-Dt[0]-Dt[1]),sn=Math.min(1,Math.max(0,sn)),xn=Math.floor(sn*1e4),Sr&&ae[xn])kr=ae[xn];else{if(Oe(he)==="array")for(Pr=on=0,Nn=Lt.length-1;0<=Nn?on<=Nn:on>=Nn;Pr=0<=Nn?++on:--on){if(qr=Lt[Pr],sn<=qr){kr=he[Pr];break}if(sn>=qr&&Pr===Lt.length-1){kr=he[Pr];break}if(sn>qr&&sn<Lt[Pr+1]){sn=(sn-qr)/(Lt[Pr+1]-qr),kr=N.interpolate(he[Pr],he[Pr+1],sn,jt);break}}else Oe(he)==="function"&&(kr=he(sn));Sr&&(ae[xn]=kr)}return kr},en=function(){return ae={}},Xr(G),pr=function(It){var fr;return fr=N(rn(It)),Ct&&fr[Ct]?fr[Ct]():fr},pr.classes=function(It){var fr;return It!=null?(Oe(It)==="array"?(Q=It,Ee=[It[0],It[It.length-1]]):(fr=N.analyze(Ee),It===0?Q=[fr.min,fr.max]:Q=N.limits(fr,"e",It)),pr):Q},pr.domain=function(It){var fr,Ur,kr,Pr,xn,on,qr;if(!arguments.length)return Ee;if(Tt=It[0],mt=It[It.length-1],Lt=[],kr=he.length,It.length===kr&&Tt!==mt)for(xn=0,Pr=It.length;xn<Pr;xn++)Ur=It[xn],Lt.push((Ur-Tt)/(mt-Tt));else for(fr=qr=0,on=kr-1;0<=on?qr<=on:qr>=on;fr=0<=on?++qr:--qr)Lt.push(fr/(kr-1));return Ee=[Tt,mt],pr},pr.mode=function(It){return arguments.length?(jt=It,en(),pr):jt},pr.range=function(It,fr){return Xr(It,fr),pr},pr.out=function(It){return Ct=It,pr},pr.spread=function(It){return arguments.length?(xr=It,pr):xr},pr.correctLightness=function(It){return It==null&&(It=!0),we=It,en(),we?di=function(fr){var Ur,kr,Pr,xn,on,qr,Nn,sn,fn;for(Ur=rn(0,!0).lab()[0],kr=rn(1,!0).lab()[0],Nn=Ur>kr,Pr=rn(fr,!0).lab()[0],on=Ur+(kr-Ur)*fr,xn=Pr-on,sn=0,fn=1,qr=20;Math.abs(xn)>.01&&qr-- >0;)(function(){return Nn&&(xn*=-1),xn<0?(sn=fr,fr+=(fn-fr)*.5):(fn=fr,fr+=(sn-fr)*.5),Pr=rn(fr,!0).lab()[0],xn=Pr-on})();return fr}:di=function(fr){return fr},pr},pr.padding=function(It){return It!=null?(Oe(It)==="number"&&(It=[It,It]),Dt=It,pr):Dt},pr.colors=function(It,fr){var Ur,kr,Pr,xn,on,qr,Nn,sn,fn;if(arguments.length<2&&(fr="hex"),qr=[],arguments.length===0)qr=he.slice(0);else if(It===1)qr=[pr(.5)];else if(It>1)kr=Ee[0],Ur=Ee[1]-kr,qr=function(){Nn=[];for(var Kr=0;0<=It?Kr<It:Kr>It;0<=It?Kr++:Kr--)Nn.push(Kr);return Nn}.apply(this).map(function(Kr){return pr(kr+Kr/(It-1)*Ur)});else{if(G=[],sn=[],Q&&Q.length>2)for(Pr=fn=1,on=Q.length;1<=on?fn<on:fn>on;Pr=1<=on?++fn:--fn)sn.push((Q[Pr-1]+Q[Pr])*.5);else sn=Ee;qr=sn.map(function(Kr){return pr(Kr)})}return N[fr]&&(qr=qr.map(function(Kr){return Kr[fr]()})),qr},pr.cache=function(It){return It!=null?(Sr=It,pr):Sr},pr.gamma=function(It){return It!=null?(ut=It,pr):ut},pr.nodata=function(It){return It!=null?(Et=N(It),pr):Et},pr},N.scales==null&&(N.scales={}),N.scales.cool=function(){return N.scale([N.hsl(180,1,.9),N.hsl(250,.7,.4)])},N.scales.hot=function(){return N.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},N.analyze=function(G,te,Q){var ae,he,we,Ee,Xe,ut,mt;if(Xe={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},Q==null&&(Q=function(){return!0}),ae=function(Tt){Tt!=null&&!isNaN(Tt)&&(Xe.values.push(Tt),Xe.sum+=Tt,Tt<Xe.min&&(Xe.min=Tt),Tt>Xe.max&&(Xe.max=Tt),Xe.count+=1)},mt=function(Tt,jt){if(Q(Tt,jt))return te!=null&&Oe(te)==="function"?ae(te(Tt)):te!=null&&Oe(te)==="string"||Oe(te)==="number"?ae(Tt[te]):ae(Tt)},Oe(G)==="array")for(Ee=0,we=G.length;Ee<we;Ee++)ut=G[Ee],mt(ut);else for(he in G)ut=G[he],mt(ut,he);return Xe.domain=[Xe.min,Xe.max],Xe.limits=function(Tt,jt){return N.limits(Xe,Tt,jt)},Xe},N.limits=function(G,te,Q){var ae,he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr,Sr,ln,pr,un,rn,en,Xr,di,It,fr,Ur,kr,Pr,xn,on,qr,Nn,sn,fn,Kr,lo,Bn,vn,Vn,Lo,Ai,Ui,As,Ms,Ss,Me,Pe,Ke,bt,Ft,Xt,hn,_n,Wn,Kn,Qr,Mi;if(te==null&&(te="equal"),Q==null&&(Q=7),Oe(G)==="array"&&(G=N.analyze(G)),Ur=G.min,sr=G.max,hn=G.sum,Qr=G.values.sort(function(qi,Ql){return qi-Ql}),Q===1)return[Ur,sr];if(It=[],te.substr(0,1)==="c"&&(It.push(Ur),It.push(sr)),te.substr(0,1)==="e"){for(It.push(Ur),en=Nn=1,lo=Q-1;1<=lo?Nn<=lo:Nn>=lo;en=1<=lo?++Nn:--Nn)It.push(Ur+en/Q*(sr-Ur));It.push(sr)}else if(te.substr(0,1)==="l"){if(Ur<=0)throw"Logarithmic scales are only possible for values > 0";for(kr=Math.LOG10E*Rt(Ur),fr=Math.LOG10E*Rt(sr),It.push(Ur),en=Mi=1,Bn=Q-1;1<=Bn?Mi<=Bn:Mi>=Bn;en=1<=Bn?++Mi:--Mi)It.push(Hr(10,kr+en/Q*(fr-kr)));It.push(sr)}else if(te.substr(0,1)==="q"){for(It.push(Ur),en=ae=1,As=Q-1;1<=As?ae<=As:ae>=As;en=1<=As?++ae:--ae)sn=(Qr.length-1)*en/Q,fn=je(sn),fn===sn?It.push(Qr[fn]):(Kr=sn-fn,It.push(Qr[fn]*(1-Kr)+Qr[fn+1]*Kr));It.push(sr)}else if(te.substr(0,1)==="k"){for(xn=Qr.length,xr=new Array(xn),un=new Array(Q),Xt=!0,on=0,ln=null,ln=[],ln.push(Ur),en=he=1,Ms=Q-1;1<=Ms?he<=Ms:he>=Ms;en=1<=Ms?++he:--he)ln.push(Ur+en/Q*(sr-Ur));for(ln.push(sr);Xt;){for(Xr=we=0,Ss=Q-1;0<=Ss?we<=Ss:we>=Ss;Xr=0<=Ss?++we:--we)un[Xr]=0;for(en=Ee=0,Me=xn-1;0<=Me?Ee<=Me:Ee>=Me;en=0<=Me?++Ee:--Ee){for(Kn=Qr[en],Pr=Number.MAX_VALUE,Xr=Xe=0,Pe=Q-1;0<=Pe?Xe<=Pe:Xe>=Pe;Xr=0<=Pe?++Xe:--Xe)rn=y(ln[Xr]-Kn),rn<Pr&&(Pr=rn,Sr=Xr);un[Sr]++,xr[en]=Sr}for(qr=new Array(Q),Xr=ut=0,Ke=Q-1;0<=Ke?ut<=Ke:ut>=Ke;Xr=0<=Ke?++ut:--ut)qr[Xr]=null;for(en=mt=0,bt=xn-1;0<=bt?mt<=bt:mt>=bt;en=0<=bt?++mt:--mt)pr=xr[en],qr[pr]===null?qr[pr]=Qr[en]:qr[pr]+=Qr[en];for(Xr=Tt=0,Ft=Q-1;0<=Ft?Tt<=Ft:Tt>=Ft;Xr=0<=Ft?++Tt:--Tt)qr[Xr]*=1/un[Xr];for(Xt=!1,Xr=jt=0,vn=Q-1;0<=vn?jt<=vn:jt>=vn;Xr=0<=vn?++jt:--jt)if(qr[Xr]!==ln[en]){Xt=!0;break}ln=qr,on++,on>200&&(Xt=!1)}for(di={},Xr=Et=0,Vn=Q-1;0<=Vn?Et<=Vn:Et>=Vn;Xr=0<=Vn?++Et:--Et)di[Xr]=[];for(en=Ct=0,Lo=xn-1;0<=Lo?Ct<=Lo:Ct>=Lo;en=0<=Lo?++Ct:--Ct)pr=xr[en],di[pr].push(Qr[en]);for(_n=[],Xr=Dt=0,Ai=Q-1;0<=Ai?Dt<=Ai:Dt>=Ai;Xr=0<=Ai?++Dt:--Dt)_n.push(di[Xr][0]),_n.push(di[Xr][di[Xr].length-1]);for(_n=_n.sort(function(qi,Ql){return qi-Ql}),It.push(_n[0]),en=Lt=1,Ui=_n.length-1;Lt<=Ui;en=Lt+=2)Wn=_n[en],!isNaN(Wn)&&It.indexOf(Wn)===-1&&It.push(Wn)}return It},Ue=function(G,te,Q){var ae,he,we,Ee;return ae=ue(arguments),G=ae[0],te=ae[1],Q=ae[2],isNaN(G)&&(G=0),G/=360,G<1/3?(he=(1-te)/3,Ee=(1+te*de(s*G)/de(o-s*G))/3,we=1-(he+Ee)):G<2/3?(G-=1/3,Ee=(1-te)/3,we=(1+te*de(s*G)/de(o-s*G))/3,he=1-(Ee+we)):(G-=2/3,we=(1-te)/3,he=(1+te*de(s*G)/de(o-s*G))/3,Ee=1-(we+he)),Ee=Yr(Q*Ee*3),we=Yr(Q*we*3),he=Yr(Q*he*3),[Ee*255,we*255,he*255,ae.length>3?ae[3]:1]},qo=function(){var G,te,Q,ae,he,we,Ee,Xe;return Ee=ue(arguments),we=Ee[0],te=Ee[1],G=Ee[2],s=Math.PI*2,we/=255,te/=255,G/=255,he=Math.min(we,te,G),ae=(we+te+G)/3,Xe=1-he/ae,Xe===0?Q=0:(Q=(we-te+(we-G))/2,Q/=Math.sqrt((we-te)*(we-te)+(we-G)*(te-G)),Q=Math.acos(Q),G>te&&(Q=s-Q),Q/=s),[Q*360,Xe,ae]},N.hsi=function(){return function(G,te,Q){Q.prototype=G.prototype;var ae=new Q,he=G.apply(ae,te);return Object(he)===he?he:ae}(e,We.call(arguments).concat(["hsi"]),function(){})},p.hsi=Ue,e.prototype.hsi=function(){return qo(this._rgb)},At=function(G,te,Q,ae){var he,we,Ee,Xe,ut,mt,Tt,jt,Et,Ct,Dt,Lt,xr;return ae==="hsl"?(Lt=G.hsl(),xr=te.hsl()):ae==="hsv"?(Lt=G.hsv(),xr=te.hsv()):ae==="hcg"?(Lt=G.hcg(),xr=te.hcg()):ae==="hsi"?(Lt=G.hsi(),xr=te.hsi()):(ae==="lch"||ae==="hcl")&&(ae="hcl",Lt=G.hcl(),xr=te.hcl()),ae.substr(0,1)==="h"&&(Ee=Lt[0],Ct=Lt[1],mt=Lt[2],Xe=xr[0],Dt=xr[1],Tt=xr[2]),!isNaN(Ee)&&!isNaN(Xe)?(Xe>Ee&&Xe-Ee>180?he=Xe-(Ee+360):Xe<Ee&&Ee-Xe>180?he=Xe+360-Ee:he=Xe-Ee,we=Ee+Q*he):isNaN(Ee)?isNaN(Xe)?we=Number.NaN:(we=Xe,(mt===1||mt===0)&&ae!=="hsv"&&(Et=Dt)):(we=Ee,(Tt===1||Tt===0)&&ae!=="hsv"&&(Et=Ct)),Et==null&&(Et=Ct+Q*(Dt-Ct)),ut=mt+Q*(Tt-mt),jt=N[ae](we,Et,ut)},_=_.concat(function(){var G,te,Q,ae;for(Q=["hsv","hsl","hsi","hcl","lch","hcg"],ae=[],te=0,G=Q.length;te<G;te++)tn=Q[te],ae.push([tn,At]);return ae}()),yt=function(G,te,Q,ae){var he,we;return he=G.num(),we=te.num(),N.num(he+(we-he)*Q,"num")},_.push(["num",yt]),St=function(G,te,Q,ae){var he,we,Ee;return we=G.lab(),Ee=te.lab(),he=new e(we[0]+Q*(Ee[0]-we[0]),we[1]+Q*(Ee[1]-we[1]),we[2]+Q*(Ee[2]-we[2]),ae)},_.push(["lab",St])}).call(H2)});var lNe={};function sRe(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function jue(e,t,r){let n=Array.from(e.children[0].children[0].children),o=n.length,i=t.hasAttribute("settings");if(o<=1?n[0]?.removeAttribute("id"):n.forEach((s,a)=>{let u=i?1:0,h=a===o-(u+1)?"psp-column-titles":a===o-u?"psp-column-edit-buttons":null;h?s.setAttribute("id",h):s.removeAttribute("id")}),t.classList.toggle("psp-menu-open",!!r),i&&o>=2){let s=Array.from(n[o-2].children),a=Array.from(n[o-1].children);if(s&&a){n.slice(0,o-2).forEach(u=>{Array.from(u.children).forEach(h=>{h.classList.toggle("psp-menu-open",!1)})});for(let u=0;u<s.length;u++){let h=s[u],p=a[u],_=h.textContent===r;if(h.classList.toggle("psp-menu-open",_),p.classList.toggle("psp-menu-open",_),this._config.columns.length>1)for(let y of e.querySelectorAll("td")){let A=e.getMeta(y),E=A.column_header[A.column_header.length-2]===r;y.classList.toggle("psp-menu-open",E)}}}}}function aRe(e,t){let r=Array.from(e.children[0].children[0].children);if(r.length>0){jue.call(this,e,t,this._column_settings_selected_column);let[n]=r.splice(this._config.split_by.length,1);Pue.call(this,e,n,!1);let[o]=r.splice(this._config.split_by.length,1);o&&Pue.call(this,e,o,!0)}}function Pue(e,t,r){let n=e._view_cache.config.row_pivots.length-1;for(let o of t?.children){let i=e.getMeta(o),s=i.column_header?.[this._config.split_by.length],a=this._config.sort.find(k=>k[0]===s),u=i.row_header_x===n,h=typeof i.x>"u";u=u||(i.x+1)%this._config.columns.length===0,o.classList.toggle("psp-header-border",u),o.classList.toggle("psp-header-group",!1),o.classList.toggle("psp-header-leaf",!0),o.classList.toggle("psp-is-top",!1),o.classList.toggle("psp-header-corner",h),o.classList.toggle("psp-header-sort-asc",!r&&!!a&&a[1]==="asc"),o.classList.toggle("psp-header-sort-desc",!r&&!!a&&a[1]==="desc"),o.classList.toggle("psp-header-sort-col-asc",!r&&!!a&&a[1]==="col asc"),o.classList.toggle("psp-header-sort-col-desc",!r&&!!a&&a[1]==="col desc");let p=sRe.call(this,i),_=p==="integer"||p==="float",y=p==="string",A=p==="date",E=p==="datetime";o.classList.toggle("psp-align-right",_),o.classList.toggle("psp-align-left",!_),o.classList.toggle("psp-menu-enabled",(y||_||A||E)&&!h&&i.column_header_y==this._config.split_by.length+1),o.classList.toggle("psp-sort-enabled",(y||_||A||E)&&!h&&i.column_header_y===this._config.split_by.length),o.classList.toggle("psp-is-width-override",e._column_sizes?.override[i.size_key]!==void 0)}}function lRe(e){let t=e._view_cache.config.row_pivots.length-1,r=Array.from(e.children[0].children[0].children),n=[],o=new Set,i=e.children[0];for(let s=0;s<r.length;s++){let a=i.rows[s],u=new Set;for(let h=0;h<a.cells.length;h++){let p=a.cells[h];p.style.backgroundColor="";let _=e.getMeta(p),y=_.row_header_x===t||_.x>=0;p.classList.toggle("psp-align-right",!1),p.classList.toggle("psp-align-left",!1),p.classList.toggle("psp-header-group",!0),p.classList.toggle("psp-header-leaf",!1),p.classList.toggle("psp-header-border",y),p.classList.toggle("psp-header-group-corner",typeof _.x>"u"),p.classList.toggle("psp-color-mode-bar",!1),p.classList.toggle("psp-header-sort-asc",!1),p.classList.toggle("psp-header-sort-desc",!1),p.classList.toggle("psp-header-sort-col-asc",!1),p.classList.toggle("psp-header-sort-col-desc",!1),p.classList.toggle("psp-sort-enabled",!1);let A=a.cells[h],E=h,k,P;for(;n[s]&&n[s][E];++E);for(u.add(E),k=E;k<E+A.colSpan;++k)for(P=s;P<s+A.rowSpan;++P)n[P]||(n[P]=[]),n[P][k]=!0;A.classList.toggle("psp-is-top",s===0||!o.has(k))}o=u}}function cRe(e,t,[,,,,,r,n],[,,,,,o,i],s){let a=this._ids?.[e.dy]?.join("|"),u=(s?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(u)&&this.last_reverse_ids?.has(a)){let h=this.last_reverse_ids?.get(a),p=this.last_reverse_columns.get(u);this._is_old_viewport?this.last_meta?.[p]?.[h]>e.user?(t.style.setProperty("--pulse--background-color-start",o),t.style.setProperty("--pulse--background-color-end",i),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[p]?.[h]<e.user?(t.style.setProperty("--pulse--background-color-start",r),t.style.setProperty("--pulse--background-color-end",n),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):h!==e.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}function Oue(e,t){return J8.default.mix(e,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function $2([e,t,r,n],o=[255,255,255]){function i(s,a){return((1-n)*(o[s]/255)+n*(a/255))*255}return[i(0,e),i(1,t),i(2,r)]}function Q2([e,t,r]){return Math.sqrt(e*e*.299+t*t*.587+r*r*.114)>130?"#161616":"#ffffff"}function uRe(e){let[t,r,n]=e.rgb(),[o,i,s]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[a,u,h]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${o},${i},${s}),rgb(${t},${r},${n}) 50%,rgb(${a},${u},${h}))`}function Yu(e){let t=(0,J8.default)(e),r=uRe(t),n=t.rgb();return[e,...n,r,`rgba(${n[0]},${n[1]},${n[2]},1)`,`rgba(${n[0]},${n[1]},${n[2]},0)`]}function fRe(e,t,r,n){let o=r.user>0,i=r.user<0,s;e?.pos_bg_color!==void 0?s=e.pos_bg_color:s=this._pos_bg_color;let a;e?.neg_bg_color!==void 0?a=e.neg_bg_color:a=this._neg_bg_color;let u=o?s:i?a:["",...this._plugin_background,""];{let[E,k,P,R,V]=u;if(t.style.position="",e?.number_bg_mode==="color")t.style.animation="",t.style.backgroundColor=E;else if(e?.number_bg_mode==="gradient"){let N=Math.max(0,Math.min(1,Math.abs(r.user/e.bg_gradient))),j=this._plugin_background,J=Q2($2([k,P,R,N],j));t.style.animation="",t.style.color=J,t.style.backgroundColor=`rgba(${k},${P},${R},${N})`}else e?.number_bg_mode==="pulse"?(cRe.call(this,r,t,s,a,n),t.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,t.style.animation="",t.style.backgroundColor="")}let[h,p,_,y,A]=e?.pos_fg_color!==void 0?o?e.pos_fg_color:i?e.neg_fg_color:["",...this._plugin_background,""]:o?this._pos_fg_color:i?this._neg_fg_color:["",...this._plugin_background,""];if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let E=this._plugin_background,k=Q2($2([u[1],u[2],u[3],1],E));t.style.color=k}else e?.number_bg_mode==="gradient"||(t.style.color="");else e?.number_fg_mode==="bar"?(t.style.color="",t.style.position="relative",A!==""&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=A)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(t.style.color=h)}function hRe(e,t,r){let n=r.column_header?.[this._config.split_by.length],[o,i,s,a,u]=e?.color!==void 0?e.color:this._color;if(e?.string_color_mode==="foreground"&&r.user!==null)t.style.color=o,t.style.backgroundColor="",e?.format==="link"&&(t.children[0].style.color=o);else if(e?.string_color_mode==="background"&&r.user!==null){let h=this._plugin_background,p=Q2($2([i,s,a,1],h));t.style.color=p,t.style.backgroundColor=o}else if(e?.string_color_mode==="series"&&r.user!==null){this._series_color_map.has(n)||(this._series_color_map.set(n,new Map),this._series_color_seed.set(n,0));let h=this._series_color_map.get(n);if(!h.has(r.user)){let J=this._series_color_seed.get(n);h.set(r.user,J),this._series_color_seed.set(n,J+1)}let p=h.get(r.user),[_,y,A]=(0,$8.default)(o).hsl();_=_+p*150%360;let E=(0,$8.default)(_,y,A,"hsl"),[k,P,R]=E.rgb(),V=E.hex(),N=this._plugin_background,j=Q2($2([k,P,R,1],N));t.style.color=j,t.style.backgroundColor=V}else t.style.backgroundColor="",t.style.color=""}function dRe(e,t,r){let n=r.column_header?.[this._config.split_by.length],[o,i,s,a,u]=e?.color!==void 0?e.color:this._color;if(e?.datetime_color_mode==="foreground"&&r.user!==null)t.style.color=o,t.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&r.user!==null){let h=this._plugin_background,p=Q2($2([i,s,a,1],h));t.style.color=p,t.style.backgroundColor=o}else t.style.backgroundColor="",t.style.color=""}function pRe(e,t,r){let[n]=r.user===!0?this._pos_fg_color:r.user===!1?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=n}function mRe(e,t,r){let n=typeof r.value!=null&&typeof r.value!=null&&r.value?.toString()?.trim().length>0,o=r.row_header_x>=this._config.group_by.length,i=e.getMeta({dx:0,dy:r.y-r.y0+1}),s=i&&i.row_header&&typeof i.row_header[r.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",n&&!o),t.classList.toggle("psp-tree-label-expand",n&&!o&&!s),t.classList.toggle("psp-tree-label-collapse",n&&!o&&s),t.classList.toggle("psp-tree-leaf",n&&o)}function gRe(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function _Re(e,t){let r=e[eA]||{},n=t.hasAttribute("settings");for(let o of e.children[0].children[1].children)for(let i of o.children){let s=e.getMeta(i),a=s.column_header?.[this._config.split_by.length],u=gRe.call(this,s),h=r[a],p=u==="integer"||u==="float";p?fRe.call(this,h,i,s,n):u==="boolean"?pRe.call(this,h,i,s):u==="string"?hRe.call(this,h,i,s):u==="date"||u==="datetime"?dRe.call(this,h,i,s):(i.style.backgroundColor="",i.style.color=""),i.classList.toggle("psp-bool-type",u==="boolean"&&s.user!==null);let _=i.tagName==="TH";_&&mRe.call(this,e,i,s),i.classList.toggle("psp-align-right",!_&&p),i.classList.toggle("psp-align-left",_||!p),i.classList.toggle("psp-color-mode-bar",h?.number_fg_mode==="bar"&&p)}}async function yRe(e,t,r,n){let o=e.getMeta(n).column_header[this._config.split_by.length],i=(r.shiftKey?xRe:bRe).call(this,o);this._preserve_focus_state=!0,await t.restore({sort:i})}function xRe(e){let t=[],r=!1;for(let n of this._config.sort){let[o,i]=n;if(o===e){r=!0;let s=Uue.call(this,e,i);s&&t.push(s)}else t.push(n)}return r||t.push([e,"desc"]),t}function bRe(e){for(let[t,r]of this._config.sort)if(t===e){let n=Uue.call(this,e,r);return n?[n]:[]}return[[e,"desc"]]}function Uue(e,t){let r=this._config.split_by.length>0?wRe:vRe,n=t?r[t]:"desc";if(n)return[e,n]}async function ARe(e,t){let r=e.getMeta(t.target),n=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&n?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-2):t.shiftKey?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-1):n?this._view.collapse(r.y):this._view.expand(r.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function MRe(e,t,r){if(r.which!==1)return;let n=r.target;if(n.tagName!=="A"){for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!e.contains(n))return;if(n.classList.contains("psp-tree-label")){ARe.call(this,e,r),r.stopImmediatePropagation();return}if(n.classList.contains("psp-menu-enabled")){let o=e.getMeta(n).column_header?.[this._config.split_by.length];await t.toggleColumnSettings(o),r.preventDefault(),r.stopImmediatePropagation()}else n.classList.contains("psp-sort-enabled")&&(yRe.call(this,e,t,r,n),r.stopImmediatePropagation())}}function SRe(e,t){if(t.which!==1)return;let r=t.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!e.contains(r))return;(r.classList.contains("psp-tree-label")&&t.offsetX<26||r.classList.contains("psp-header-leaf")&&!r.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function Rue(e,t=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),o=t||e.children[0].dataset.editMode==="EDIT";return r&&!n&&o}function TRe(e,t,r){let n=e[eA]||{},o=Rue.call(this,t);r.classList.toggle("edit-mode-allowed",Rue.call(this,t,!0));for(let i of e.querySelectorAll("td")){let s=e.getMeta(i),a=this.get_psp_type(s);if(o&&this._is_editable[s.x]){let u=s.column_header[this._config.split_by.length];a==="string"&&n[u]?.format==="link"?(i.toggleAttribute("contenteditable",!1),i.classList.toggle("boolean-editable",!1)):a==="boolean"?(i.toggleAttribute("contenteditable",!1),i.classList.toggle("boolean-editable",s.user!==null)):(o!==i.hasAttribute("contenteditable")&&i.toggleAttribute("contenteditable",o),i.classList.toggle("boolean-editable",!1))}else i.toggleAttribute("contenteditable",!1),i.classList.toggle("boolean-editable",!1)}}function Wue(e,t,r){let n=e.getMeta(r),o=t._schema[t._column_paths[n.x]];if(n){let i=r.textContent,s=t._ids[n.y-n.y0][0];if(o==="float"||o==="integer"){if(i=parseFloat(i.replace(/,/g,"")),isNaN(i))return!1}else if(o==="date"||o==="datetime"){if(i=Date.parse(i),isNaN(i))return!1}else o==="boolean"&&(i=i==="true"?!1:i==="false"?!0:null);let a={__INDEX__:s,[t._column_paths[n.x]]:i};return t._table.update([a],{port_id:t._edit_port}),!0}}function ERe(e,t,r){let n=e.getMeta(r.target);if(typeof n?.x<"u"){let o=this._is_editable[n.x],i=this.get_psp_type(n)==="boolean",s=r.target.textContent==="-";o&&i&&!s&&Wue(e,this,r.target)}}function IRe(e){let t;return async function(...r){if(t&&await t&&t)return;let n;t=new Promise(o=>n=o),await e.apply(this,r),t=void 0,n()}}function Nue(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this),t.setEnd(e.endContainer,e.endOffset),t.toString().length}else return this.target.selectionStart}function CRe(e,t,r){return t.getMeta(r).y===e._num_rows-1}function kRe(e,t,r,n){let o=e.getRootNode().activeElement;switch(n.target.classList.remove("psp-error"),n.key){case"Enter":n.preventDefault(),CRe(this,e,o)?(o.blur(),r.delete(e)):n.shiftKey?cx.call(this,e,r,o,0,-1):cx.call(this,e,r,o,0,1);break;case"ArrowLeft":Nue.call(o)==0&&(n.preventDefault(),cx.call(this,e,r,o,-1,0));break;case"ArrowUp":n.preventDefault(),cx.call(this,e,r,o,0,-1);break;case"ArrowRight":Nue.call(o)==o.textContent.length&&(n.preventDefault(),cx.call(this,e,r,o,1,0));break;case"ArrowDown":n.preventDefault(),cx.call(this,e,r,o,0,1);break;default:}}function e7(e,t=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),o=t||e.children[0]._edit_mode==="EDIT";return r&&!n&&o}function PRe(e,t,r,n){if(this._edit_mode==="EDIT"){if(!e7.call(this,t))return;kRe.call(this,e,t,r,n)}else console.log(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function ORe(e,t,r){if(this._edit_mode==="EDIT"){if(!e7.call(this,t))return;ERe.call(this,e,t,r)}else this._edit_mode==="READ_ONLY"||this._edit_mode==="SELECT_COLUMN"||this._edit_mode==="SELECT_ROW"||this._edit_mode==="SELECT_REGION"||console.log(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function RRe(e,t,r,n){if(e7.call(this,t)&&r.has(e)){n.target.classList.remove("psp-error");let o=r.get(e);r.delete(e),o.content!==n.target.textContent&&(Wue(e,this,n.target)||(n.target.textContent=o.content,n.target.classList.add("psp-error"),n.target.focus()))}}function NRe(e,t,r,n){let o=e.getMeta(n.target);if(o){let i={x:o.x,y:o.y,content:n.target.textContent};r.set(e,i)}}async function Zue({_view:e,_config:t},r,n){let o=t.group_by,i=t.split_by,s=r>=0?r:0,a=s+1,u=await e.to_json({start_row:s,end_row:a}),h=u.map(P=>P.__ROW_PATH__)[0]||[],p=o.map((P,R)=>{let V=h[R];return V?[P,"==",V]:void 0}).filter(P=>P),_=o.length>0?n+1:n,y=Object.keys(u[0])[_],A={row:u[0]},E=[];if(y){let P=y.split("|");A.column_names=[P[i.length]],E=i.map((R,V)=>{let N=P[V];return N?[R,"==",N]:void 0}).filter(R=>R).filter(([,,R])=>R!=="__ROW_PATH__")}let k=t.filter.concat(p).concat(E);return A.config={filter:k},A}async function zRe(e,t,r,n){let o=e.getMeta(n.target);if(!t.hasAttribute("selectable")||n.handled||n.which!==1||!o)return;let i=this._ids[o.y-o.y0];if(o&&o.y>=0){let s=r.get(e),a=!!s&&s.reduce((A,E,k)=>A&&E===i[k],!0),u=!!s&&i.length===s.length&&a,h={selected:!u},{row:p,column_names:_,config:y}=await Zue(this,o.y,o.x);u?(r.delete(e),h={...h,row:p,config:{filter:structuredClone(this._config.filter)}}):(r.set(e,i),h={...h,row:p,column_names:_,config:y}),await e.draw({preserve_width:!0}),n.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:h}))}}function DRe(e,t,r){if(!t.hasAttribute("selectable"))return;let n=r.has(e),o=r.get(e);for(let i of e.querySelectorAll("td"))if(!n)i.classList.toggle("psp-row-selected",!1),i.classList.toggle("psp-row-subselected",!1);else{let s=e.getMeta(i),a=this._ids[s.y-s.y0],u=o.reduce((h,p,_)=>h&&p===a[_],!0);i.classList.toggle("psp-row-selected",a.length===o.length&&u),i.classList.toggle("psp-row-subselected",a.length!==o.length&&u)}for(let i of e.querySelectorAll("tbody th")){let s=e.getMeta(i),a=this._ids[s.y-s.y0];if(!n||a[s.row_header_x])i.classList.toggle("psp-row-selected",!1),i.classList.toggle("psp-row-subselected",!1);else{let u=o.reduce((h,p,_)=>h&&p===a[_],!0);i.classList.toggle("psp-row-selected",a.length===o.length&&u),i.classList.toggle("psp-row-subselected",a.length!==o.length&&u)}}}async function LRe(e,t,r){r.delete(e);for(let n of e.querySelectorAll("td,th"))n.classList.toggle("psp-row-selected",!1),n.classList.toggle("psp-row-subselected",!1)}function que(e,t,r={},n=!1){if(t===null)return"-";let o=n&&this._table_schema[e]||this._schema[e]||"string",i=r[e]||{};if((o==="integer"||o==="float")&&i?.number_fg_mode==="bar"){let s=Math.max(0,Math.min(Due,Math.abs(t/i.fg_gradient)*Due)),a=this._div_factory.get(),u=t>=0?"left":"right",h=(s*100).toFixed(2);return a.setAttribute("style",`width:calc(${h}% - 4px);position:absolute;${u}:2px;height:80%;top:10%;pointer-events:none;`),a}else if(i?.format==="link"&&o==="string"){let s=document.createElement("a");return s.setAttribute("href",t),s.setAttribute("target","_blank"),s.textContent=t,s}else if(i?.format==="bold"&&o==="string"){let s=document.createElement("b");return s.textContent=t,s}else if(i?.format==="italics"&&o==="string"){let s=document.createElement("i");return s.textContent=t,s}else{let s=jRe.get(o,i);return s?s.format(t):t}}function*URe(e=[],t,r){let n=r[eA];for(let o of e){o=["TOTAL",...o];let i=o[o.length-1];o=o.slice(0,o.length-1).fill("");let s=que.call(this,t[o.length-1],i,n,!0);s instanceof HTMLElement?o=o.concat(s):o=o.concat({toString:()=>s}),o.length=t.length+1,yield o}}function VRe(e){let t,r,n,o,i;return async function(s,a,u,h,p){let _={},y;h-a>0&&p-u>0?(this._is_old_viewport=this._last_window?.start_row===u&&this._last_window?.end_row===p&&this._last_window?.start_col===a&&this._last_window?.end_col===h,y={start_row:u,start_col:a,end_row:p,end_col:h,id:!0},_=JSON.parse(await this._view.to_columns_string(y)),this._last_window=y,this._ids=_.__ID__,this._reverse_columns=this._column_paths.slice(a,h).reduce((V,N,j)=>(V.set(N,j),V),new Map),this._reverse_ids=this._ids.reduce((V,N,j)=>(V.set(N?.join("|"),j),V),new Map)):this._div_factory.clear();let A=[],E=[],k=[],P=[],R=e.hasAttribute("settings");for(let V=a;V<Math.min(h,this._column_paths.length);++V){let N=this._column_paths[V],j=N.split("|"),J=_[N]||new Array(p-u).fill(null);A.push(J.map(ne=>que.call(this,j[this._config.split_by.length],ne,s[eA]))),E.push(J),R&&j.push(""),k.push(j),P.push(N)}return h-a>0&&p-u>0&&(this.last_column_paths=r,this.last_meta=t,this.last_ids=n,this.last_reverse_ids=o,this.last_reverse_columns=i,r=P,t=E,n=this._ids,o=this._reverse_ids,i=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(URe.call(this,_.__ROW_PATH__,this._config.group_by,s)),column_headers:k,data:A,metadata:E,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function _k(e,t,r){let n=window.getComputedStyle(e).getPropertyValue(t).trim();return n.length>0?n:r}function ZRe(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function Lue(e,t,r,n={}){let o=await r.get_config(),i=Array.isArray(o.expressions)?Object.fromEntries(o.expressions.map(ye=>[ye[0],ye[1]])):o.expressions,[s,a,u,h,p,_,y]=await Promise.all([t.schema(),t.validate_expressions(i),r.num_rows(),r.schema(),r.expression_schema(),r.column_paths(),this.parentElement.getEditPort()]),A=(0,Yue.default)(_k(e,"--plugin--background","#FFFFFF")).rgb(),E=Yu(_k(e,"--rt-pos-cell--color","#338DCD")),k=Yu(_k(e,"--rt-neg-cell--color","#FF5942")),P=Yu(Oue(E[0],A)),R=Yu(Oue(k[0],A)),V=Yu(_k(e,"--active--color","#ff0000")),N={...h,...p},j={...s,...a.expression_schema},J=_.filter(ye=>ye!=="__ROW_PATH__"&&ye!=="__ID__"),ne=[],de=[];for(let ye of J){let ve=ye.split("|")[o.split_by.length];de.push(N[ve]),ne.push(!!s[ve])}let fe=Object.assign(n,{_edit_port:y,_view:r,_table:t,_table_schema:j,_config:o,_num_rows:u,_schema:N,_ids:[],_plugin_background:A,_color:V,_pos_fg_color:E,_neg_fg_color:k,_pos_bg_color:P,_neg_bg_color:R,_column_paths:J,_column_types:de,_is_editable:ne,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:o.group_by.map(ye=>j[ye]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:ZRe});return fe._div_factory=fe._div_factory||new WRe("div"),e.setDataListener(VRe(this.parentElement).bind(fe,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),fe}async function YRe(e,t,r){let n=e.getMeta(r.target);if(!n)return;let{x:o,y:i}=n,{row:s,column_names:a,config:u}=await Zue(this,i,o);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:s,column_names:a,config:u}}))}function $Re(e,t,{x0:r,x1:n,y0:o,y1:i}){let s={},a=t.model._edit_mode;r!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(a)>-1&&(s.start_col=r),n!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(a)>-1&&(s.end_col=n+1),o!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(a)>-1&&(s.start_row=o),i!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(a)>-1&&(s.end_row=i+1),e.setSelection(s)}async function JRe(e){let t=this.parentElement,r=await t.getTable(!0);if(this._initialized)await Lue.call(this,this.regular_table,r,e,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await Lue.call(this,this.regular_table,r,e),GRe(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(_Re.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(lRe.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(aRe.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("click",SRe.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",MRe.bind(this.model,this.regular_table,t));let n=new WeakMap;this.regular_table.addStyleListener(DRe.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("mousedown",zRe.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("psp-deselect-all",LRe.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("click",YRe.bind(this.model,this.regular_table,t));let o=new WeakMap;this.regular_table.addStyleListener(TRe.bind(this.model,this.regular_table,t,this)),this.regular_table.addStyleListener(Vue.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("click",ORe.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",NRe.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("focusout",RRe.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("keydown",PRe.bind(this.model,this.regular_table,t,o)),t.addEventListener("perspective-toggle-column-settings",i=>{if(this.isConnected){if(jue.call(this.model,this.regular_table,t,i.detail.column_name),!i.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=i.detail.column_name}}),this._initialized=!0}}function Gue(e,t=!1){if(!this._initialized)return;t&&(this._cached_column_sizes=e);let r={},{group_by:n,columns:o}=this.model._config,i=n?.length>0?n.length+1:0;for(let s of Object.keys(e))if(s==="__ROW_PATH__")r[i-1]=e[s];else{let a=this.model._column_paths.indexOf(s);r[a+i]=e[s]}this.regular_table._column_sizes.override=r}function Hue(){if(!this._initialized)return[];if(this._cached_column_sizes){let i=this._cached_column_sizes;return this._cached_column_sizes=void 0,i}let e=this.regular_table._column_sizes.override,{group_by:t,columns:r}=this.model._config,n=t?.length>0?t.length+1:0,o={};for(let i of Object.keys(e))if(e[i]!==void 0){let s=i-n;s>-1?o[this.model._column_paths[s]]=e[i]:s===-1&&(o.__ROW_PATH__=e[i])}return o}function Xue(e=void 0){typeof e>"u"&&(e=yk[(yk.indexOf(this._edit_mode)+1)%yk.length]),this.model&&(this.model._edit_mode=e,this.parentElement?.setSelection(),this.model._selection_state={selected_areas:[],dirty:!0},this._edit_mode=e,this._edit_button!==void 0&&(this._edit_button.dataset.editMode=e)),this.dataset.editMode=e}function Kue(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",e)}function eNe(e,t){e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));let r={};if(e.columns)for(let[i,s]of Object.entries(e.columns))s.column_size_override!==void 0&&(r[i]=s.column_size_override,delete s.column_size_override);let n={};if(t)for(let[i,s]of Object.entries(t))n[i]={...s,pos_fg_color:s.pos_fg_color?Yu(s.pos_fg_color):void 0,neg_fg_color:s.neg_fg_color?Yu(s.neg_fg_color):void 0,pos_bg_color:s.pos_bg_color?Yu(s.pos_bg_color):void 0,neg_bg_color:s.neg_bg_color?Yu(s.neg_bg_color):void 0,color:s.color?Yu(s.color):void 0};"edit_mode"in e&&(yk.indexOf(e.edit_mode)!==-1?Xue.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&Kue.call(this,e.scroll_lock);let o=this.regular_table;Gue.call(this,r,!0),o[eA]=n}function tNe(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},t=Hue.call(this);for(let r of Object.keys(t||{}))e.columns[r]||(e.columns[r]={}),e.columns[r].column_size_override=t[r];return JSON.parse(JSON.stringify(e))}return{}}async function rNe(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null)return;let t=Hue.call(this),r=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),Gue.call(this,t),await r,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function nNe(e,t){return e==="integer"||e==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:e==="date"||e==="datetime"||e==="string"?{[e==="date"||e==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}function sNe(){let e=document.createElement("style");e.textContent=Bue,document.head.insertBefore(e,document.head.firstChild)}async function aNe(){customElements.define("perspective-viewer-datagrid-toolbar",oNe),customElements.define("perspective-viewer-datagrid",Q8),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}var J8,$8,Izt,Yue,tRe,rRe,nRe,Fue,K8,iRe,oRe,Bue,eA,vRe,wRe,Vue,cx,zue,FRe,BRe,jRe,Due,WRe,qRe,GRe,HRe,XRe,KRe,J2,QRe,yk,ux,$ue,Q8,iNe,oNe,Que=W(()=>{kue();J8=In(K2(),1),$8=In(K2(),1),Izt=In(K2(),1),Yue=In(K2(),1),tRe=Object.defineProperty,rRe=(e,t,r)=>t in e?tRe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,nRe=(e,t,r)=>(rRe(e,typeof t!="symbol"?t+"":t,r),r),Fue=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},K8=(e,t,r)=>(Fue(e,t,"read from private field"),r?r.call(e):t.get(e)),iRe=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},oRe=(e,t,r,n)=>(Fue(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Bue='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';eA=Symbol("Plugin Symbol");vRe={desc:"asc",asc:void 0},wRe={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};Vue=(e,t,r)=>{let n=e.querySelectorAll("td"),o=r.get(e),i=e.getRootNode();if(o){for(let s of n){let a=e.getMeta(s);if(a.x===o.x&&a.y===o.y)return i.activeElement!==s&&s.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(i.activeElement)&&i.activeElement.blur()}};cx=IRe(async function(e,t,r,n,o){let i=e.getMeta(r),s=this._column_paths.length,a=this._num_rows,u=t.get(e);if(!u)return;i.x+n<s&&0<=i.x+n&&(u.x=i.x+n),i.y+o<a&&0<=i.y+o&&(u.y=i.y+o);let h=Math.max(i.x0-10,0),p=Math.min(i.x0+10,s),_=Math.max(i.y0-5,0),y=Math.min(i.y0+10,a),A=i.x0+n,E=i.y0+o;for(;!Vue(e,void 0,t)&&A>=h&&A<p&&E>=_&&E<y;)await e.scrollToCell(A,E,s,a),t.set(e,u),A+=n,E+=o});zue={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},FRe={types:{float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}}},BRe=class{constructor(){this._formatters=new Map}create_datetime_formatter(e,t){let r={dateStyle:"short",timeStyle:"medium"};if(e==="datetime")if(t.date_format?.format!=="custom"){let n={...r,timeZone:t.date_format?.timeZone,dateStyle:t.date_format?.dateStyle,timeStyle:t.date_format?.timeStyle};return n.dateStyle==="disabled"?n.dateStyle=void 0:n.dateStyle===void 0&&(n.dateStyle="short"),n.timeStyle==="disabled"?n.timeStyle=void 0:n.timeStyle===void 0&&(n.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,n)}else{let n={timeZone:t.date_format?.timeZone,second:t.date_format?.second,minute:t.date_format?.minute,hour:t.date_format?.hour,day:t.date_format?.day,weekday:t.date_format?.weekday,month:t.date_format?.month,year:t.date_format?.year,hour12:t.date_format?.hour12,fractionalSecondDigits:t.date_format?.fractionalSecondDigits};return n.year==="disabled"?n.year=void 0:n.year===void 0&&(n.year="2-digit"),n.month==="disabled"?n.month=void 0:n.month===void 0&&(n.month="numeric"),n.day==="disabled"?n.day=void 0:n.day===void 0&&(n.day="numeric"),n.weekday==="disabled"&&(n.weekday=void 0),n.hour==="disabled"?n.hour=void 0:n.hour===void 0&&(n.hour="numeric"),n.minute==="disabled"?n.minute=void 0:n.minute===void 0&&(n.minute="numeric"),n.second==="disabled"?n.second=void 0:n.second===void 0&&(n.second="numeric"),n.hour12===void 0&&(n.hour12=!0),new Intl.DateTimeFormat(navigator.languages,n)}else{let n={...r.format,dateStyle:t.date_format?.dateStyle};return n.dateStyle==="disabled"?n.dateStyle=void 0:n.dateStyle===void 0&&(n.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,n)}}create_number_formatter(e,t){let r=FRe.types[e]?.format;return t.number_format!==void 0&&(r=t.number_format),new zue[e](navigator.languages,r)}create_boolean_formatter(e,t){return new zue[e](navigator.languages,{})}get(e,t){let r=[e,...Object.values(t.date_format??{}),...Object.values(t.number_format??{})].join("-");return this._formatters.has(r)||(e==="date"||e==="datetime"?this._formatters.set(r,this.create_datetime_formatter(e,t)):e==="integer"||e==="float"?this._formatters.set(r,this.create_number_formatter(e,t)):e==="boolean"?this._formatters.set(r,this.create_boolean_formatter(e,t)):this._formatters.set(r,!1)),this._formatters.get(r)}},jRe=new BRe,Due=1;WRe=class{constructor(e){this._name=e,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}};qRe="mouse-selected-area",GRe=(e,t,{className:r=qRe,selected:n=[]}={})=>(e.model._selection_state={selected_areas:n,dirty:!0},t.addEventListener("mousedown",HRe(e,t,r)),t.addEventListener("mouseover",XRe(e,t,r)),t.addEventListener("mouseup",KRe(e,t,r)),t.addStyleListener(()=>J2(e,t,r)),t),HRe=(e,t,r)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let o=t.getMeta(n.target);if(o&&o.x!==void 0&&o.y!==void 0){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:o.x,y:o.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let i={x0:o.x,x1:o.x,y0:o.y,y1:o.y};e.model._selection_state.potential_selection=i,J2(e,t,r,e.model._selection_state.selected_areas.concat([i]));return}}e.model._selection_state.selected_areas=[]},XRe=(e,t,r)=>n=>{if((e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0){let o=t.getMeta(n.target);if(o&&o.x!==void 0&&o.y!==void 0){let i={x0:Math.min(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=i,J2(e,t,r,e.model._selection_state.selected_areas.concat([i]))}}},KRe=(e,t,r)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){let o=t.getMeta(n.target);if(e.model._selection_state.old_selected_areas.length>0){let i=e.model._selection_state.old_selected_areas[0];if(i.x0===i.x1&&i.y0===i.y1&&i.x0===o.x&&i.y0===o.y){e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,J2(e,t,r,[]);return}}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0&&o.x!==void 0&&o.y!==void 0){let i={x0:Math.min(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(i),J2(e,t,r)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};J2=(e,t,r,n)=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){n=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&n.push(e.model._selection_state.potential_selection);let o=t.querySelectorAll("tbody td");if(n.length>0)$Re(e.parentElement,e,n[0]),QRe(e,t,n,r);else{e.parentElement.setSelection();for(let i of o)i.classList.remove(r)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let o=t.querySelectorAll("tbody td");for(let i of o)i.classList.remove(r)}},QRe=(e,t,r,n)=>{if(e.model._edit_mode==="SELECT_REGION"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let i of o){let s=t.getMeta(i),a=!1;for(let{x0:u,x1:h,y0:p,y1:_}of r)u!==void 0&&p!==void 0&&h!==void 0&&_!==void 0&&u<=s.x&&s.x<=h&&p<=s.y&&s.y<=_&&(a=!0,e.model._selection_state.dirty=!0,i.classList.add(n));a||i.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_ROW"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let i of o){let s=t.getMeta(i),a=!1;for(let{x0:u,x1:h,y0:p,y1:_}of r)u!==void 0&&p!==void 0&&h!==void 0&&_!==void 0&&p<=s.y&&s.y<=_&&(e.model._selection_state.dirty=!0,a=!0,i.classList.add(n));a||i.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_COLUMN"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let i of o){let s=t.getMeta(i),a=!1;for(let{x0:u,x1:h,y0:p,y1:_}of r)u!==void 0&&p!==void 0&&h!==void 0&&_!==void 0&&u<=s.x&&s.x<=h&&(e.model._selection_state.dirty=!0,a=!0,i.classList.add(n));a||i.classList.remove(n)}}};yk=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];$ue=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let e=$ue;e.renderTarget=="shadow"&&(K8(e,ux)||(oRe(e,ux,new CSSStyleSheet),K8(e,ux).replaceSync(Bue)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(K8(e,ux)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let e=this.parentElement;e&&e.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(e){return await JRe.call(this,e)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(e,t){return e!=="boolean"}column_style_controls(e,t){return nNe.call(this,e,t)}async draw(e){return await rNe.call(this,e)}async update(e){this.model._num_rows=await e.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return tNe.call(this)}restore(e,t){return eNe.call(this,e,t)}async restyle(e){await this.draw(e)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},Q8=$ue;ux=new WeakMap,nRe(Q8,"renderTarget",window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light"),iRe(Q8,ux,void 0);iNe=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;height:48px;cursor:pointer;}:host #toolbar .hover-target:hover{outline:4px solid var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color,#ccc);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}',oNe=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${iNe}
            </style>
            <div id="toolbar">
                <span class="hover-target">
                    <span id="scroll_lock" class="button">
                        <span></span>
                    </span>
                </span>
                <span class="hover-target">
                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">
                        <span></span>
                    </span>
                </span>
            </div>
        `;let e=this.parentElement,t=e.querySelector("perspective-viewer-datagrid");t._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),t._scroll_lock.addEventListener("click",()=>Kue.call(t)),t._edit_button=this.shadowRoot.querySelector("#edit_mode"),t._edit_button.addEventListener("click",()=>{Xue.call(t),t.regular_table.draw(),e.dispatchEvent(new Event("perspective-config-update"))})}};aNe();sNe()});var Jn=rd((xk,Jue)=>{(function(e,t){typeof xk=="object"&&typeof Jue<"u"?t(xk,(ki(),vl(xN)),(BF(),vl(Gae)),(Yy(),vl(Tae)),(VL(),vl(oae)),(nD(),vl(bre)),(ow(),vl(Ote)),(Fs(),vl(EQ)),(B8(),vl(Rce)),(N9(),vl(Fle)),(Ld(),vl(r$)),(Cz(),vl(Mte)),(V8(),vl(Bce))):typeof define=="function"&&define.amd?define(["exports","d3-array","d3-scale","d3-time","d3-random","d3-fetch","d3-path","d3-selection","d3-shape","d3-scale-chromatic","d3-dispatch","d3-brush","d3-zoom"],t):(e=typeof globalThis<"u"?globalThis:e||self,t(e.fc={},e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3))})(xk,function(e,t,r,n,o,i,s,a,u,h,p,_,y){"use strict";var A=function(I,O,z){var Z=O[z];if(typeof Z!="function")throw new Error("Attempt to rebind ".concat(z," which isn't a function on the source object"));return function(){for(var H=arguments.length,K=new Array(H),B=0;B<H;B++)K[B]=arguments[B];var q=Z.apply(O,K);return q===O?I:q}},E=function(I,O){for(var z=arguments.length,Z=new Array(z>2?z-2:0),H=2;H<z;H++)Z[H-2]=arguments[H];for(var K=0,B=Z;K<B.length;K++){var q=B[K];I[q]=A(I,O,q)}return I},k=function(O){return function(z){return O.reduce(function(Z,H){return Z&&H(Z)},z)}},P=function(I,O){for(var z=arguments.length,Z=new Array(z>2?z-2:0),H=2;H<z;H++)Z[H-2]=arguments[H];for(var K=k(Z),B=0,q=Object.keys(O);B<q.length;B++){var X=q[B],ee=K(X);ee&&(I[ee]=A(I,O,X))}return I},R=function(I){return I.map(function(O){return typeof O=="string"?new RegExp("^".concat(O,"$")):O})},V=function(){for(var I=arguments.length,O=new Array(I),z=0;z<I;z++)O[z]=arguments[z];return O=R(O),function(Z){return O.every(function(H){return!H.test(Z)})&&Z}},N=function(){for(var I=arguments.length,O=new Array(I),z=0;z<I;z++)O[z]=arguments[z];return O=R(O),function(Z){return O.some(function(H){return H.test(Z)})&&Z}},j=function(I){return function(O){return I[O]}},J=function(O){return O[0].toUpperCase()+O.slice(1)},ne=function(I){return function(O){return I+J(O)}};function de(I){return I}function fe(I){}function ye(I){return typeof I=="function"?I:function(){return I}}function ve(I){return typeof I=="number"&&isNaN(I)?void 0:I}function be(){var I=function(){return 10},O=fe,z=de,Z=function(B){return B!=null},H=function(B){var q=I.apply(this,arguments),X=B.slice(0,q).map(z);return B.map(function(ee,oe){return oe>=q&&(X.shift(),X.push(z(ee,oe))),oe<q-1||X.some(function(pe){return!Z(pe)})?O(void 0,oe):O(X,oe)})};return H.period=function(){return arguments.length?(I=ye(arguments.length<=0?void 0:arguments[0]),H):I},H.accumulator=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},H.defined=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],H):Z},H.value=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],H):z},H}function je(){var I=2,O=be().accumulator(function(Z){var H=Z&&t.deviation(Z),K=Z&&t.mean(Z);return{average:K,upper:ve(K+I*H),lower:ve(K-I*H)}}),z=function(H){return O(H)};return z.multiplier=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],z):I},E(z,O,"period","value"),z}function Re(){var I=de,O=function(){return 9},z=function(K){var B=[];return function(q){var X;return B.length<K&&(q!=null?B.push(q):B=[]),B.length>=K&&(X=t.mean(B)),X}},Z=function(K){var B=O.apply(this,arguments),q=2/(B+1),X=z(B),ee;return K.map(function(oe,pe){var _e=I(oe,pe);return ee===void 0?ee=X(_e):ee=_e*q+(1-q)*ee,ve(ee)})};return Z.period=function(){return arguments.length?(O=ye(arguments.length<=0?void 0:arguments[0]),Z):O},Z.value=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},Z}function Se(){var I=de,O=Re().period(12),z=Re().period(26),Z=Re().period(9),H=function(B){O.value(I),z.value(I);var q=t.zip(O(B),z(B)).map(function(ee){return ee[0]!==void 0&&ee[1]!==void 0?ee[0]-ee[1]:void 0}),X=Z(q);return t.zip(q,X).map(function(ee){return{macd:ee[0],signal:ee[1],divergence:ee[0]!==void 0&&ee[1]!==void 0?ee[0]-ee[1]:void 0}})};return H.value=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],H):I},P(H,O,j({period:"fastPeriod"})),P(H,z,j({period:"slowPeriod"})),P(H,Z,j({period:"signalPeriod"})),H}function Ue(I,O){(O==null||O>I.length)&&(O=I.length);for(var z=0,Z=Array(O);z<O;z++)Z[z]=I[z];return Z}function qe(I){if(Array.isArray(I))return I}function Je(I){if(Array.isArray(I))return Ue(I)}function gt(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function rt(I,O){if(!(I instanceof O))throw new TypeError("Cannot call a class as a function")}function At(I,O,z){if(Br())return Reflect.construct.apply(null,arguments);var Z=[null];Z.push.apply(Z,O);var H=new(I.bind.apply(I,Z));return z&&tn(H,z.prototype),H}function St(I,O){for(var z=0;z<O.length;z++){var Z=O[z];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(I,ei(Z.key),Z)}}function kt(I,O,z){return O&&St(I.prototype,O),z&&St(I,z),Object.defineProperty(I,"prototype",{writable:!1}),I}function yt(I,O){var z=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!z){if(Array.isArray(I)||(z=Pn(I))||O&&I&&typeof I.length=="number"){z&&(I=z);var Z=0,H=function(){};return{s:H,n:function(){return Z>=I.length?{done:!0}:{done:!1,value:I[Z++]}},e:function(X){throw X},f:H}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var K,B=!0,q=!1;return{s:function(){z=z.call(I)},n:function(){var X=z.next();return B=X.done,X},e:function(X){q=!0,K=X},f:function(){try{B||z.return==null||z.return()}finally{if(q)throw K}}}}function tr(I){var O=Br();return function(){var z,Z=vr(I);if(O){var H=vr(this).constructor;z=Reflect.construct(Z,arguments,H)}else z=Z.apply(this,arguments);return bn(this,z)}}function vr(I){return vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(O){return O.__proto__||Object.getPrototypeOf(O)},vr(I)}function wr(I,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(O&&O.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),Object.defineProperty(I,"prototype",{writable:!1}),O&&tn(I,O)}function Ir(I){try{return Function.toString.call(I).indexOf("[native code]")!==-1}catch{return typeof I=="function"}}function Br(){try{var I=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Br=function(){return!!I})()}function qt(I){if(typeof Symbol<"u"&&I[Symbol.iterator]!=null||I["@@iterator"]!=null)return Array.from(I)}function Lr(I,O){var z=I==null?null:typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(z!=null){var Z,H,K,B,q=[],X=!0,ee=!1;try{if(K=(z=z.call(I)).next,O===0){if(Object(z)!==z)return;X=!1}else for(;!(X=(Z=K.call(z)).done)&&(q.push(Z.value),q.length!==O);X=!0);}catch(oe){ee=!0,H=oe}finally{try{if(!X&&z.return!=null&&(B=z.return(),Object(B)!==B))return}finally{if(ee)throw H}}return q}}function Yr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bn(I,O){if(O&&(typeof O=="object"||typeof O=="function"))return O;if(O!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gt(I)}function tn(I,O){return tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,Z){return z.__proto__=Z,z},tn(I,O)}function sr(I,O){return qe(I)||Lr(I,O)||Pn(I,O)||Yr()}function Rn(I){return qe(I)||qt(I)||Pn(I)||Yr()}function dr(I){return Je(I)||qt(I)||Pn(I)||Rt()}function xt(I,O){if(typeof I!="object"||!I)return I;var z=I[Symbol.toPrimitive];if(z!==void 0){var Z=z.call(I,O||"default");if(typeof Z!="object")return Z;throw new TypeError("@@toPrimitive must return a primitive value.")}return(O==="string"?String:Number)(I)}function ei(I){var O=xt(I,"string");return typeof O=="symbol"?O:O+""}function Hr(I){"@babel/helpers - typeof";return Hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},Hr(I)}function Pn(I,O){if(I){if(typeof I=="string")return Ue(I,O);var z={}.toString.call(I).slice(8,-1);return z==="Object"&&I.constructor&&(z=I.constructor.name),z==="Map"||z==="Set"?Array.from(I):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?Ue(I,O):void 0}}function gn(I){var O=typeof Map=="function"?new Map:void 0;return gn=function(z){if(z===null||!Ir(z))return z;if(typeof z!="function")throw new TypeError("Super expression must either be null or a function");if(O!==void 0){if(O.has(z))return O.get(z);O.set(z,Z)}function Z(){return At(z,arguments,vr(this).constructor)}return Z.prototype=Object.create(z.prototype,{constructor:{value:Z,enumerable:!1,writable:!0,configurable:!0}}),tn(Z,z)},gn(I)}function No(){var I=be().period(14),O=function(X,ee){return ee+(X[X.length-1]-ee)/X.length},z=function(X){var ee=sr(X,2),oe=ee[0],pe=ee[1];return oe<pe?0:oe-pe},Z=function(X){var ee=sr(X,2),oe=ee[0],pe=ee[1];return oe>pe?0:pe-oe},H=function(X,ee){return ee!==void 0?O(X,ee):t.mean(X)},K=function(){var X,ee,oe;return function(pe){if(!pe){X!==void 0&&(X=NaN);return}if(X===void 0){X=pe[0];return}var _e=t.pairs([X].concat(dr(pe)));ee=H(_e.map(z),ee),oe=H(_e.map(Z),oe);var Ce=isNaN(X)?NaN:oe/ee;return ve(100-100/(1+Ce))}},B=function(X){var ee=K();return I.accumulator(ee),I(X)};return E(B,I,"period","value"),B}function bs(){var I=be().accumulator(function(z){return z&&t.mean(z)}),O=function(Z){return I(Z)};return E(O,I,"period","value"),O}function qo(){var I=function(q,X){return q.close},O=function(q,X){return q.high},z=function(q,X){return q.low},Z=be().period(5).defined(function(B){return I(B)!=null&&O(B)!=null&&z(B)!=null}).accumulator(function(B){var q=B&&t.max(B,O),X=B&&t.min(B,z),ee=B&&100*(I(B[B.length-1])-X)/(q-X);return ve(ee)}),H=bs().period(3),K=function(q){var X=Z(q),ee=H(X);return X.map(function(oe,pe){return{k:oe,d:ee[pe]}})};return K.closeValue=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],K):I},K.highValue=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.lowValue=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},P(K,Z,j({period:"kPeriod"})),P(K,H,j({period:"dPeriod"})),K}function ba(){var I=function(B,q){return B.volume},O=function(B,q){return B.close},z=Re().period(13),Z=be().period(2).defined(function(K){return O(K)!=null&&I(K)!=null}).accumulator(function(K){return K&&ve((O(K[1])-O(K[0]))*I(K[1]))}),H=function(B){var q=Z(B);return z(q)};return H.volumeValue=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],H):I},H.closeValue=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},E(H,z,"period"),H}function vs(){var I=.1,O=de,z=function(H){return H.map(function(K){var B=ve(O(K)*(1-I)),q=ve(O(K)*(1+I));return{lower:B,upper:q}})};return z.factor=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],z):I},z.value=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],z):O},z}function zo(){var I=function(B,q){return B.close},O=function(B,q){return B.high},z=function(B,q){return B.low},Z=Re().period(13),H=function(B){return Z.value(I),t.zip(B,Z(B)).map(function(q){var X=ve(O(q[0])-q[1]),ee=ve(z(q[0])-q[1]);return{bullPower:X,bearPower:ee}})};return H.closeValue=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],H):I},H.highValue=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},H.lowValue=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],H):z},E(H,Z,"period"),H}function Do(){var I={};return I.distance=function(O,z){return z-O},I.offset=function(O,z){return O instanceof Date?new Date(O.getTime()+z):O+z},I.clampUp=function(O){return O},I.clampDown=function(O){return O},I.copy=function(){return I},I}function Zt(I,O){var z=I.map(O.clampUp);return z.length!==new Set(z.map(function(Z){return Z?.valueOf()})).size&&console.warn("There are multiple ticks that fall within a discontinuity, which has led to them being rendered on top of each other. Consider using scale.ticks to explicitly specify the ticks for the scale."),z}function eo(I){var O=this;arguments.length||(I=r.scaleIdentity());var z=Do(),Z=function(K){var B=I.domain(),q=I.range(),X=z.distance(B[0],B[1]),ee=z.distance(B[0],K),oe=ee/X,pe=oe*(q[1]-q[0])+q[0];return pe};return Z.invert=function(H){var K=I.domain(),B=I.range(),q=(H-B[0])/(B[1]-B[0]),X=z.distance(K[0],K[1]),ee=q*X;return z.offset(K[0],ee)},Z.domain=function(){if(!arguments.length)return I.domain();var H=arguments.length<=0?void 0:arguments[0],K=z.clampUp(H[0]),B=z.clampDown(H[1]);return I.domain([K,B]),Z},Z.nice=function(){I.nice();var H=I.domain(),K=z.clampUp(H[0]),B=z.clampDown(H[1]);return I.domain([K,B]),Z},Z.ticks=function(){for(var H=arguments.length,K=new Array(H),B=0;B<H;B++)K[B]=arguments[B];var q=I.ticks.apply(O,K);return Zt(q,z)},Z.copy=function(){return eo(I.copy()).discontinuityProvider(z.copy())},Z.discontinuityProvider=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z):z},P(Z,I,N("range","rangeRound","interpolate","clamp","tickFormat")),Z}var Xn=function(O,z,Z,H){var K={sunday:0,monday:1,saturday:6},B=24*3600*1e3,q=B*5,X=B*7,ee={},oe=function(_e){return O(_e)===0||O(_e)===6};return ee.clampDown=function(pe){if(pe&&oe(pe)){var _e=z.ceil(pe);return O(_e)===K.sunday?z.offset(_e,-1):O(_e)===K.monday?z.offset(_e,-2):_e}else return pe},ee.clampUp=function(pe){if(pe&&oe(pe)){var _e=z.floor(pe);return O(_e)===K.saturday?z.offset(_e,2):O(_e)===K.sunday?z.offset(_e,1):_e}else return pe},ee.distance=function(pe,_e){pe=ee.clampUp(pe),_e=ee.clampDown(_e);var Ce=Z.ceil(pe);if(_e<Ce)return _e.getTime()-pe.getTime();var Be=Ce.getTime()-pe.getTime(),Fe=Z.ceil(_e),Ge=Fe.getTime()-_e.getTime(),it=Math.round((Fe.getTime()-Ce.getTime())/X);return it*q+Be-Ge},ee.offset=function(pe,_e){var Ce=oe(pe)?ee.clampUp(pe):pe;if(_e===0)return Ce;var Be=_e<0,Fe=_e>0,Ge=_e,it=Be?H.floor(Ce):Z.ceil(Ce);if(Ge-=it.getTime()-Ce.getTime(),Be&&Ge>0||Fe&&Ge<0)return new Date(Ce.getTime()+_e);Ce=Be?it:z.offset(it,2);var at=Math.floor(Ge/q);return Ce=z.offset(Ce,at*7),Ge-=at*q,Ce=new Date(Ce.getTime()+Ge),Ce},ee.copy=function(){return ee},ee},ws=function(){return Xn(function(I){return I.getDay()},n.timeDay,n.timeSaturday,n.timeMonday)},wo=function(){return Xn(function(I){return I.getUTCDay()},n.utcDay,n.utcSaturday,n.utcMonday)},Ht=function(){for(var O=arguments.length,z=new Array(O),Z=0;Z<O;Z++)z[Z]=arguments[Z];var H=function(ee,oe){return ee>oe[0]&&ee<oe[1]},K=function(ee,oe){return ee[0]>=oe[0]&&ee[1]<=oe[1]},B={};B.distance=function(X,ee){X=B.clampUp(X),ee=B.clampDown(ee);var oe=z.filter(function(_e){return K(_e,[X,ee])}),pe=oe.map(function(_e){return _e[1]-_e[0]});return ee-X-pe.reduce(function(_e,Ce){return _e+Ce},0)};var q=function(ee,oe){return ee instanceof Date?new Date(ee.getTime()+oe):ee+oe};return B.offset=function(X,ee){if(ee>0){for(var oe=B.clampUp(X),pe=ee;pe>0;){var _e=z.filter(function(dt){return dt[0]>oe}).sort(function(dt,Nt){return dt[0]-Nt[0]});if(_e.length){var Ce=_e[0],Be=Ce[0]-oe;Be>pe?(oe=q(oe,pe),pe=0):(oe=Ce[1],pe-=Be)}else oe=q(oe,pe),pe=0}return oe}else{for(var Fe=B.clampDown(X),Ge=ee;Ge<0;){var it=z.filter(function(dt){return dt[1]<Fe}).sort(function(dt,Nt){return Nt[0]-dt[0]});if(it.length){var at=it[0],ot=at[1]-Fe;ot<Ge?(Fe=q(Fe,Ge),Ge=0):(Fe=at[0],Ge-=ot)}else Fe=q(Fe,Ge),Ge=0}return Fe}},B.clampUp=function(X){return z.reduce(function(ee,oe){return H(ee,oe)?oe[1]:ee},X)},B.clampDown=function(X){return z.reduce(function(ee,oe){return H(ee,oe)?oe[0]:ee},X)},B.copy=function(){return B},B},$r=24*3600*1e3,cr="00:00:00.000",ji="SOD",to="EOD";function zr(I){if(arguments.length!==1||typeof I!="string")throw"Expected single argument of type string";var O=function(B,q){return Number.isInteger(B)?B>=0&&B<=q:!1},z=[0,0,0,0],Z=I.split(":");if(Z.length<2||Z.length>3)throw"Expected an argument wiht 2 or 3 colon delimited parts.";if(z[0]=O(parseInt(Z[0],10),23)?parseInt(Z[0],10):function(){throw"'Hours' component must be an int between 0 and 23, but was '".concat(Z[0],"'")}(),z[1]=O(parseInt(Z[1],10),59)?parseInt(Z[1],10):function(){throw"'Minutes' component must be an int between 0 and 59, but was '".concat(Z[1],"'")}(),Z.length===3){var H=Z[2].split(".").map(function(K){return parseInt(K,10)});z[2]=O(H[0],59)?H[0]:function(){throw"'Seconds' component must be an int between 0 and 59, but was '".concat(H[0],"'")}(),H.length===2&&(z[3]=O(H[1],999)?H[1]:function(){throw"'Miliseconds' component must be an int between 0 and 999, but was '".concat(H[1],"'")}())}return"".concat(z[0].toString(10).padStart(2,"0"),":").concat(z[1].toString(10).padStart(2,"0"),":").concat(z[2].toString(10).padStart(2,"0"),".").concat(z[3].toString(10).padStart(3,"0"))}function Ao(I,O){if(arguments.length!=2||!Array.isArray(I)||I.length!==2||typeof I[0]!="string"||typeof I[1]!="string")throw"Expected argument is a single string[] of length 2.";I[0]===ji&&(I[0]=cr),I[1]===to&&(I[1]=cr);var z=zr(I[0]),Z=zr(I[1]);if(Z!==cr&&z>Z)throw"Time range start time '".concat(z,"' must be before end time '").concat(Z,"' or both must equal ").concat(cr);var H=O.setTime(new Date(Z===cr?$r:0),Z)-O.setTime(new Date(0),z),K={startTime:z,endTime:Z,lenghtInMs:H};return K.isInRange=function(B){var q=O.getTimeString(B);return K.startTime<=q&&(K.endTime===cr||K.endTime>q)},K}var Oe=function(O,z){var Z=O.map(function(q){return Ao(q,z)}).sort(function(q,X){return q.startTime<X.startTime?-1:q.startTime>X.startTime?1:0}),H=$r-Z.reduce(function(q,X){return q+X.lenghtInMs},0),K=function(X,ee){if(X.getTime()===ee.getTime())return 0;if(z.dayInterval(X).getTime()!==z.dayInterval(ee).getTime()&&z.getStartOfNextDay(X).getTime()!==ee.getTime())throw"tradingDay.totalTradingMillisecondsBetween arguments must be on the same day or intervalEnd must be the start of the next day instead: intervalStart: '".concat(X,"'; intervalEnd: '").concat(ee,"'");var oe=0,pe=Z.filter(function(it){return it.endTime===cr||z.setTime(X,it.endTime)>=X}),_e=yt(pe),Ce;try{for(_e.s();!(Ce=_e.n()).done;){var Be=Ce.value,Fe=z.setTime(X,Be.startTime),Ge=Be.endTime===cr?z.getStartOfNextDay(X):z.setTime(X,Be.endTime);if(X<Fe&&ee<Fe)return oe+z.msInterval.count(X,ee);if(X<Fe&&(oe+=z.msInterval.count(X,Fe)),ee<Ge)return oe;X=Ge}}catch(it){_e.e(it)}finally{_e.f()}return oe+z.msInterval.count(X,ee)},B=function(X,ee){if(ee===0)return[X,ee];var oe=z.msInterval.offset(X,ee),pe=ee>0?Z.filter(function(dt){return z.setTime(X,dt.startTime)>=X}):Z.filter(function(dt){return z.setTime(X,dt.startTime)<X}).reverse();if(pe.length===0)return[z.msInterval.offset(X,ee),0];if(ee>0){var _e=yt(pe),Ce;try{for(_e.s();!(Ce=_e.n()).done;){var Be=Ce.value,Fe=z.setTime(X,Be.startTime);Fe<=oe&&(ee-=z.msInterval.count(X,Fe),X=Be.endTime===cr?z.getStartOfNextDay(X):z.setTime(X,Be.endTime),oe=z.msInterval.offset(X,ee))}}catch(dt){_e.e(dt)}finally{_e.f()}ee-=z.msInterval.count(X,oe)}else{var Ge=yt(pe),it;try{for(Ge.s();!(it=Ge.n()).done;){var at=it.value,ot=at.endTime===cr?z.getStartOfNextDay(X):z.setTime(X,at.endTime);oe<ot&&(ee+=z.msInterval.count(ot,X)+1,X=z.msInterval.offset(z.setTime(X,at.startTime),-1),oe=z.msInterval.offset(X,ee))}}catch(dt){Ge.e(dt)}finally{Ge.f()}ee+=z.msInterval.count(oe,X)}if(ee!==0)throw"tradingDay.offset was called with an offset that spans more than a day";return[oe,ee]};return{totalTradingTimeInMiliseconds:H,nonTradingTimeRanges:Z,totalTradingMillisecondsBetween:K,offset:B}},ue=function(O,z,Z,H,K){var B={};return B.getTimeComponentArrayFromString=function(q){return[q.slice(0,2),q.slice(3,5),q.slice(6,8),q.slice(9,12)]},B.getTimeString=function(q){var X=Z(q).map(function(Be){return Be.toString(10).padStart(2,"0")}),ee=sr(X,4),oe=ee[0],pe=ee[1],_e=ee[2],Ce=ee[3];return"".concat(oe,":").concat(pe,":").concat(_e,".").concat(Ce.padStart(3,"0"))},B.setTime=function(q,X){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,oe=B.getTimeComponentArrayFromString(X),pe=sr(oe,4),_e=pe[0],Ce=pe[1],Be=pe[2],Fe=pe[3];return K.offset(O(q,_e,Ce,Be,Fe),ee)},B.getStartOfNextDay=function(q){return H.offset(H.floor(q),1)},B.getEndOfPreviousDay=function(q){return K.offset(H.floor(q),-1)},B.dayInterval=H,B.msInterval=K,B.getDay=z,B},ge=ue(function(I,O,z,Z,H){return new Date(I.getFullYear(),I.getMonth(),I.getDate(),O,z,Z,H)},function(I){return I.getDay()},function(I){return[I.getHours(),I.getMinutes(),I.getSeconds(),I.getMilliseconds()]},n.timeDay,n.timeMillisecond),ke=function(O,z){var Z=function(X){return O[X]===void 0?[]:O[X]},H=[Oe(Z("Sunday"),z),Oe(Z("Monday"),z),Oe(Z("Tuesday"),z),Oe(Z("Wednesday"),z),Oe(Z("Thursday"),z),Oe(Z("Friday"),z),Oe(Z("Saturday"),z)],K=H.reduce(function(q,X){return q+X.totalTradingTimeInMiliseconds},0);if(K===0)throw"Trading pattern must yield at least 1 ms of trading time";var B={tradingDays:H,totalTradingWeekMilliseconds:K};return B.clampUp=function(q){var X=H[z.getDay(q)],ee=yt(X.nonTradingTimeRanges),oe;try{for(ee.s();!(oe=ee.n()).done;){var pe=oe.value;if(pe.isInRange(q))return pe.endTime===cr?B.clampUp(z.getStartOfNextDay(q)):z.setTime(q,pe.endTime)}}catch(_e){ee.e(_e)}finally{ee.f()}return q},B.clampDown=function(q){var X=H[z.getDay(q)],ee=yt(X.nonTradingTimeRanges),oe;try{for(ee.s();!(oe=ee.n()).done;){var pe=oe.value;if(pe.isInRange(q))return pe.startTime===cr?B.clampDown(z.getEndOfPreviousDay(q)):z.setTime(q,pe.startTime,-1)}}catch(_e){ee.e(_e)}finally{ee.f()}return q},B.distance=function(q,X){if(q.getTime()===X.getTime())return 0;var ee=q<=X?[q,X,1]:[X,q,-1],oe=sr(ee,3),pe=oe[0],_e=oe[1],Ce=oe[2];if(z.dayInterval(pe).getTime()===z.dayInterval(_e).getTime())return B.tradingDays[z.getDay(pe)].totalTradingMillisecondsBetween(pe,_e);var Be=B.tradingDays[z.getDay(pe)].totalTradingMillisecondsBetween(pe,z.dayInterval.offset(z.dayInterval(pe),1))+B.tradingDays[z.getDay(_e)].totalTradingMillisecondsBetween(z.dayInterval(_e),_e);return z.dayInterval.count(pe,_e)===1?Be:(pe=z.dayInterval.offset(z.dayInterval(pe),1),_e=z.dayInterval(_e),Ce*z.dayInterval.range(pe,_e).reduce(function(Fe,Ge,it,at){var ot=it<at.length-1?at[it+1]:z.dayInterval.offset(Ge,1),dt=ot-Ge!==$r,Nt=B.tradingDays[z.getDay(Ge)];return Fe+=dt?Nt.totalTradingMillisecondsBetween(Ge,ot):Nt.totalTradingTimeInMiliseconds},Be))},B.offset=function(q,X){q=X>=0?B.clampUp(q):B.clampDown(q);var ee=function(dt){return z.dayInterval.offset(dt)-z.dayInterval(dt)!==$r},oe=function(dt,Nt,or){if(or<0){var br=z.dayInterval(Nt),yr=dt.totalTradingMillisecondsBetween(br,Nt);return Math.abs(or)<=yr?dt.offset(Nt,or):[B.clampDown(z.msInterval.offset(br,-1)),or+yr+1]}else{var Zr=z.getStartOfNextDay(Nt),Ti=dt.totalTradingMillisecondsBetween(Nt,Zr);return or<Ti?dt.offset(Nt,or):[B.clampUp(Zr),or-Ti]}};if(X===0)return q;var pe=X<0?function(ot,dt,Nt){return[B.clampDown(z.dayInterval.offset(ot,-1)),dt+Nt]}:function(ot,dt,Nt){return[B.clampUp(z.dayInterval.offset(ot)),dt-Nt]},_e=B.tradingDays[z.getDay(q)],Ce=oe(_e,q,X),Be=sr(Ce,2);for(q=Be[0],X=Be[1];X!==0;)if(_e=B.tradingDays[z.getDay(q)],ee(q)){var Fe=oe(_e,q,X),Ge=sr(Fe,2);q=Ge[0],X=Ge[1]}else{var it=Math.abs(X)>=_e.totalTradingTimeInMiliseconds?pe(q,X,_e.totalTradingTimeInMiliseconds):oe(_e,q,X),at=sr(it,2);q=at[0],X=at[1]}return q},B.copy=function(){return B},B},Ve=function(I){return ke(I,ge)},We=ue(function(I,O,z,Z,H){return new Date(Date.UTC(I.getUTCFullYear(),I.getUTCMonth(),I.getUTCDate(),O,z,Z,H))},function(I){return I.getUTCDay()},function(I){return[I.getUTCHours(),I.getUTCMinutes(),I.getUTCSeconds(),I.getUTCMilliseconds()]},n.utcDay,n.utcMillisecond),G=function(I){return ke(I,We)};function te(){var I=[function(B){return B}],O=[0,0],z="percent",Z=null,H=[],K=function(q){var X=new Array(q.length),ee=yt(I),oe;try{for(ee.s();!(oe=ee.n()).done;)for(var pe=oe.value,_e=0;_e<q.length;_e++){var Ce=pe(q[_e],_e);Array.isArray(Ce)?X.push.apply(X,dr(Ce)):X.push(Ce)}}catch(it){ee.e(it)}finally{ee.f()}var Be=[t.min(X),t.max(X)];if(Be[0]=Be[0]==null?t.min(H):t.min([Be[0]].concat(dr(H))),Be[1]=Be[1]==null?t.max(H):t.max([Be[1]].concat(dr(H))),Z!=null){var Fe=Math.max(Math.abs(Be[1]-Z),Math.abs(Be[0]-Z));Be[0]=Z-Fe,Be[1]=Z+Fe}switch(z){case"domain":{Be[0]-=O[0],Be[1]+=O[1];break}case"percent":{var Ge=Be[1]-Be[0];Be[0]-=O[0]*Ge,Be[1]+=O[1]*Ge;break}default:throw new Error("Unknown padUnit: ".concat(z))}return Be};return K.accessors=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],K):I},K.pad=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.padUnit=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},K.include=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],K):H},K.symmetricalAbout=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],K):Z},K}function Q(){var I=[],O=[0,0],z="percent",Z=null,H=[],K=te(),B=function(ee){return ee!=null?ee.valueOf():null},q=function(ee){var oe=I.map(function(pe){return function(){var _e=pe.apply(void 0,arguments);return Array.isArray(_e)?_e.map(B):B(_e)}});return K.accessors(oe).pad(O).padUnit(z).symmetricalAbout(Z!=null?Z.valueOf():null).include(H.map(function(pe){return pe.valueOf()})),K(ee).map(function(pe){return new Date(pe)})};return q.accessors=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.pad=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],q):O},q.padUnit=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],q):z},q.include=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],q):H},q.symmetricalAbout=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],q):Z},q}function ae(){var I=1,O=20,z=.1,Z=.1,H=o.randomNormal(),K=function(){for(var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,X=I/O,ee=[],oe=0;oe<O+1;oe++){ee.push(q);var pe=H()*Math.sqrt(X)*Z+(z-Z*Z/2)*X;q=q*Math.exp(pe)}return ee};return K.period=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],K):I},K.steps=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.mu=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},K.sigma=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],K):Z},K.random=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],K):H},K}function he(I){return typeof I=="function"?I:function(){return I}}function we(){var I=new Date,O=100,z=n.timeDay,Z=1,H=n.timeYear,K=1,B=null,q=function(){var Fe=o.randomNormal(1,.1);return Math.ceil(Fe()*1e3)},X=ae(),ee=function(Fe){var Ge=H.offset(Fe,K)-Fe;return(z.offset(Fe,Z)-Fe)/Ge},oe=function(Fe,Ge){var it=ee(Fe),at=X.period(it)(Ge),ot={date:Fe,open:at[0],high:Math.max.apply(Math,at),low:Math.min.apply(Math,at),close:at[X.steps()]};return ot.volume=q(ot),ot},pe=function(Fe){var Ge,it,at;do Ge=Fe?z.offset(Fe.date,Z):new Date(I.getTime()),it=Fe?Fe.close:O,Fe=oe(Ge,it),at=B&&!B(Fe);while(at);return Fe},_e=function(){var Fe,Ge={};return Ge.next=function(){var it=pe(Fe);return Fe=it,it},Ge.take=function(it){return Ge.until(function(at,ot){return!it||it<0||ot===it})},Ge.until=function(it){for(var at=[],ot=0,dt=pe(Fe),Nt=it&&!it(dt,ot);Nt;)at.push(dt),Fe=dt,dt=pe(Fe),ot+=1,Nt=it&&!it(dt,ot);return at},Ge},Ce=function(Fe){return _e().take(Fe)};if(Ce.stream=_e,typeof Symbol!="function"||Hr(Symbol.iterator)!=="symbol")throw new Error("d3fc-random-data depends on Symbol. Make sure that you load a polyfill in older browsers. See README.");return Ce[Symbol.iterator]=function(){var Be=_e();return{next:function(){return{value:Be.next(),done:!1}}}},Ce.startDate=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Ce):I},Ce.startPrice=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Ce):O},Ce.interval=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Ce):z},Ce.intervalStep=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],Ce):Z},Ce.unitInterval=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],Ce):H},Ce.unitIntervalStep=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],Ce):K},Ce.filter=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],Ce):B},Ce.volume=function(){return arguments.length?(q=he(arguments.length<=0?void 0:arguments[0]),Ce):q},P(Ce,X),Ce}function Ee(I){var O=I.date.getDay();return!(O===0||O===6)}function Xe(){var I="BTC-USD",O=null,z=null,Z=null,H=function(){var B=[];O!=null&&B.push("start="+O.toISOString()),z!=null&&B.push("end="+z.toISOString()),Z!=null&&B.push("granularity="+Z);var q="https://api.gdax.com/products/"+I+"/candles?"+B.join("&");return i.json(q).then(function(X){return X.map(function(ee){return{date:new Date(ee[0]*1e3),open:ee[3],high:ee[2],low:ee[1],close:ee[4],volume:ee[5]}})})};return H.product=function(K){return arguments.length?(I=K,H):I},H.start=function(K){return arguments.length?(O=K,H):O},H.end=function(K){return arguments.length?(z=K,H):z},H.granularity=function(K){return arguments.length?(Z=K,H):Z},H}function ut(){var I=10,O=function(Z){return I<=1?Z.map(function(H){return[H]}):t.range(0,Math.ceil(Z.length/I)).map(function(H){return Z.slice(H*I,(H+1)*I)})};return O.bucketSize=function(z){return arguments.length?(I=z,O):I},O}function mt(){var I=ut(),O=function(B){return B},z=function(B){return B},Z=function(B){if(I.bucketSize()>=B.length)return B;var q=H(B),X=I(q),ee=I(B.slice(1,B.length-1)),oe=ee.map(function(pe,_e){var Ce=X[_e],Be=t.max(Ce),Fe=Ce.indexOf(Be);return pe[Fe]});return[].concat([B[0]],oe,[B[B.length-1]])};function H(K){var B=K.map(function(X){return[O(X),z(X)]}),q=t.range(1,B.length-1).map(function(X){var ee=B[X-1],oe=B[X],pe=B[X+1];return .5*Math.abs((ee[0]-pe[0])*(oe[1]-ee[1])-(ee[0]-oe[0])*(pe[1]-ee[1]))});return q}return E(Z,I,"bucketSize"),Z.x=function(K){return arguments.length?(O=K,Z):O},Z.y=function(K){return arguments.length?(z=K,Z):z},Z}function Tt(){var I=function(K){return K},O=function(K){return K},z=ut(),Z=function(K){if(z.bucketSize()>=K.length)return K;var B=z(K.slice(1,K.length-1)),q=K[0],X=K[K.length-1],ee=[].concat([q],B,[X]),oe=I(q),pe=O(q),_e=B.map(function(Ce,Be){var Fe=t.mean(ee[Be+1],I),Ge=t.mean(ee[Be+1],O),it=Ce.map(function(Nt){return[I(Nt),O(Nt)]}),at=it.map(function(Nt){return .5*Math.abs((oe-Fe)*(Nt[1]-pe)-(oe-Nt[0])*(Ge-pe))}),ot=at.indexOf(t.max(at)),dt=it[ot];return oe=dt[0],pe=dt[1],Ce[ot]});return[].concat([K[0]],_e,[K[K.length-1]])};return E(Z,z,"bucketSize"),Z.x=function(H){return arguments.length?(I=H,Z):I},Z.y=function(H){return arguments.length?(O=H,Z):O},Z}function jt(){var I=ut(),O=function(H){return H},z=function(H){if(I.bucketSize()>H.length)return H;var K=t.extent(H,O),B=I(H.slice(1,H.length-1)),q=B.map(function(X,ee){var oe={},pe,_e,Ce=!0,Be=X.map(O),Fe=Be.filter(function(Ge){return Ge===K[0]||Ge===K[1]}).map(function(Ge){return Be.indexOf(Ge)})[0];return Fe!==void 0?X[Fe]:(Be.forEach(function(Ge,it){oe[Ge]===void 0&&(oe[Ge]=0),oe[Ge]++,oe[Ge]>oe[pe]||pe===void 0?(pe=Ge,_e=it,Ce=!0):oe[Ge]===oe[pe]&&(Ce=!1)}),Ce?X[_e]:X[Math.floor(X.length/2)])});return[].concat([H[0]],q,[H[H.length-1]])};return E(z,I,"bucketSize"),z.value=function(Z){return arguments.length?(O=Z,z):O},z}var Et=function(I){return typeof I=="function"?I:function(){return I}},Ct=function(){var I=null,O=function(oe){return oe.date},z=function(oe){return oe.open},Z=function(oe){return oe.high},H=function(oe){return oe.low},K=function(oe){return oe.close},B="vertical",q=Et(3),X=function(oe){var pe=I||s.path();return oe.forEach(function(_e,Ce){var Be=O(_e,Ce),Fe=z(_e,Ce),Ge=Z(_e,Ce),it=H(_e,Ce),at=K(_e,Ce),ot=q(_e,Ce)/2;B==="vertical"?(pe.moveTo(Be,it),pe.lineTo(Be,Ge),pe.moveTo(Be,Fe),pe.lineTo(Be-ot,Fe),pe.moveTo(Be,at),pe.lineTo(Be+ot,at)):(pe.moveTo(it,Be),pe.lineTo(Ge,Be),pe.moveTo(Fe,Be),pe.lineTo(Fe,Be+ot),pe.moveTo(at,Be),pe.lineTo(at,Be-ot))}),I?null:pe.toString()};return X.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],X):I},X.x=function(){return arguments.length?(O=Et(arguments.length<=0?void 0:arguments[0]),X):O},X.open=function(){return arguments.length?(z=Et(arguments.length<=0?void 0:arguments[0]),X):z},X.high=function(){return arguments.length?(Z=Et(arguments.length<=0?void 0:arguments[0]),X):Z},X.low=function(){return arguments.length?(H=Et(arguments.length<=0?void 0:arguments[0]),X):H},X.close=function(){return arguments.length?(K=Et(arguments.length<=0?void 0:arguments[0]),X):K},X.width=function(){return arguments.length?(q=Et(arguments.length<=0?void 0:arguments[0]),X):q},X.orient=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],X):B},X},Dt=function(){var I=null,O=function(ee){return ee.x},z=function(ee){return ee.y},Z="center",H="center",K=function(ee){return ee.height},B=Et(3),q=function(ee,oe){var pe=I||s.path();return ee.forEach(function(_e,Ce){var Be=O.call(this,_e,oe||Ce),Fe=z.call(this,_e,oe||Ce),Ge=K.call(this,_e,oe||Ce),it=B.call(this,_e,oe||Ce),at;switch(Z){case"left":at=it;break;case"right":at=0;break;case"center":at=it/2;break;default:throw new Error("Invalid horizontal alignment "+Z)}var ot;switch(H){case"bottom":ot=-Ge;break;case"top":ot=0;break;case"center":ot=Ge/2;break;default:throw new Error("Invalid vertical alignment "+H)}pe.rect(Be-at,Fe-ot,it,Ge)},this),I?null:pe.toString()};return q.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.x=function(){return arguments.length?(O=Et(arguments.length<=0?void 0:arguments[0]),q):O},q.y=function(){return arguments.length?(z=Et(arguments.length<=0?void 0:arguments[0]),q):z},q.width=function(){return arguments.length?(B=Et(arguments.length<=0?void 0:arguments[0]),q):B},q.horizontalAlign=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],q):Z},q.height=function(){return arguments.length?(K=Et(arguments.length<=0?void 0:arguments[0]),q):K},q.verticalAlign=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],q):H},q},Lt=function(){var I=null,O=function(ee){return ee.date},z=function(ee){return ee.open},Z=function(ee){return ee.high},H=function(ee){return ee.low},K=function(ee){return ee.close},B=Et(3),q=function(ee){var oe=I||s.path();return ee.forEach(function(pe,_e){var Ce=O(pe,_e),Be=z(pe,_e),Fe=Z(pe,_e),Ge=H(pe,_e),it=K(pe,_e),at=B(pe,_e),ot=at/2;oe.rect(Ce-ot,Be,at,it-Be),oe.moveTo(Ce,Math.min(it,Be)),oe.lineTo(Ce,Fe),oe.moveTo(Ce,Math.max(it,Be)),oe.lineTo(Ce,Ge)}),I?null:oe.toString()};return q.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.x=function(){return arguments.length?(O=Et(arguments.length<=0?void 0:arguments[0]),q):O},q.open=function(){return arguments.length?(z=Et(arguments.length<=0?void 0:arguments[0]),q):z},q.high=function(){return arguments.length?(Z=Et(arguments.length<=0?void 0:arguments[0]),q):Z},q.low=function(){return arguments.length?(H=Et(arguments.length<=0?void 0:arguments[0]),q):H},q.close=function(){return arguments.length?(K=Et(arguments.length<=0?void 0:arguments[0]),q):K},q.width=function(){return arguments.length?(B=Et(arguments.length<=0?void 0:arguments[0]),q):B},q},xr=function(){var I=null,O=function(_e){return _e.value},z=function(_e){return _e.median},Z=function(_e){return _e.upperQuartile},H=function(_e){return _e.lowerQuartile},K=function(_e){return _e.high},B=function(_e){return _e.low},q="vertical",X=Et(5),ee=Et(.5),oe=function(_e){var Ce=I||s.path();return _e.forEach(function(Be,Fe){var Ge=O(Be,Fe),it=X(Be,Fe),at=it/2,ot=it*ee(Be,Fe),dt=ot/2,Nt=K(Be,Fe),or=Z(Be,Fe),br=z(Be,Fe),yr=H(Be,Fe),Zr=B(Be,Fe),Ti=yr-or;q==="vertical"?(Ce.moveTo(Ge-dt,Nt),Ce.lineTo(Ge+dt,Nt),Ce.moveTo(Ge,Nt),Ce.lineTo(Ge,or),Ce.rect(Ge-at,or,it,Ti),Ce.moveTo(Ge-at,br),Ce.lineTo(Ge+at,br),Ce.moveTo(Ge,yr),Ce.lineTo(Ge,Zr),Ce.moveTo(Ge-dt,Zr),Ce.lineTo(Ge+dt,Zr)):(Ce.moveTo(Zr,Ge-dt),Ce.lineTo(Zr,Ge+dt),Ce.moveTo(Zr,Ge),Ce.lineTo(yr,Ge),Ce.rect(yr,Ge-at,-Ti,it),Ce.moveTo(br,Ge-at),Ce.lineTo(br,Ge+at),Ce.moveTo(or,Ge),Ce.lineTo(Nt,Ge),Ce.moveTo(Nt,Ge-dt),Ce.lineTo(Nt,Ge+dt))}),I?null:Ce.toString()};return oe.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],oe):I},oe.value=function(){return arguments.length?(O=Et(arguments.length<=0?void 0:arguments[0]),oe):O},oe.median=function(){return arguments.length?(z=Et(arguments.length<=0?void 0:arguments[0]),oe):z},oe.upperQuartile=function(){return arguments.length?(Z=Et(arguments.length<=0?void 0:arguments[0]),oe):Z},oe.lowerQuartile=function(){return arguments.length?(H=Et(arguments.length<=0?void 0:arguments[0]),oe):H},oe.high=function(){return arguments.length?(K=Et(arguments.length<=0?void 0:arguments[0]),oe):K},oe.low=function(){return arguments.length?(B=Et(arguments.length<=0?void 0:arguments[0]),oe):B},oe.width=function(){return arguments.length?(X=Et(arguments.length<=0?void 0:arguments[0]),oe):X},oe.orient=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],oe):q},oe.cap=function(){return arguments.length?(ee=Et(arguments.length<=0?void 0:arguments[0]),oe):ee},oe},Sr=function(){var I=null,O=function(X){return X.x},z=function(X){return X.high},Z=function(X){return X.low},H="vertical",K=Et(5),B=function(X){var ee=I||s.path();return X.forEach(function(oe,pe){var _e=O(oe,pe),Ce=K(oe,pe),Be=Ce/2,Fe=z(oe,pe),Ge=Z(oe,pe);H==="vertical"?(ee.moveTo(_e-Be,Fe),ee.lineTo(_e+Be,Fe),ee.moveTo(_e,Fe),ee.lineTo(_e,Ge),ee.moveTo(_e-Be,Ge),ee.lineTo(_e+Be,Ge)):(ee.moveTo(Ge,_e-Be),ee.lineTo(Ge,_e+Be),ee.moveTo(Ge,_e),ee.lineTo(Fe,_e),ee.moveTo(Fe,_e-Be),ee.lineTo(Fe,_e+Be))}),I?null:ee.toString()};return B.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],B):I},B.value=function(){return arguments.length?(O=Et(arguments.length<=0?void 0:arguments[0]),B):O},B.high=function(){return arguments.length?(z=Et(arguments.length<=0?void 0:arguments[0]),B):z},B.low=function(){return arguments.length?(Z=Et(arguments.length<=0?void 0:arguments[0]),B):Z},B.width=function(){return arguments.length?(K=Et(arguments.length<=0?void 0:arguments[0]),B):K},B.orient=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B},ln=function(I){return typeof I=="function"?I:function(){return I}},pr=1e-6,un=function(O){return O.selection()!==O},rn=function(I,O){I=I||"g";var z=function(B,q){return q},Z=null,H=function(B,q){q=q||function(Fe){return Fe};var X=B.selection(),ee=un(B)?B:null,oe=X.selectChildren(O==null?I:"".concat(I,".").concat(O)),pe=oe.data(q,z),_e=pe.enter().append(I).attr("class",O),Ce=pe.exit();pe=pe.merge(_e);var Be=ee||Z;return Be&&(pe=pe.transition(Be).style("opacity",1),_e.style("opacity",pr),Ce=Ce.transition(Be).style("opacity",pr)),Ce.remove(),pe.enter=function(){return _e},pe.exit=function(){return Ce},pe};return H.element=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],H):I},H.className=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},H.key=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],H):z},H.transition=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],H):Z},H},en=function(I){var O=function(){},z=function(){return[0,0]},Z=function(pe,_e){return[pe.x,pe.y]},H=I||function(oe){return oe},K=function(){},B=r.scaleIdentity(),q=r.scaleIdentity(),X=rn("g","label"),ee=function(pe){pe.each(function(_e,Ce,Be){var Fe=X(a.select(Be[Ce]),_e).call(K),Ge=Fe.nodes(),it=Ge.map(function(ot,dt){var Nt=a.select(ot).datum(),or=Z(Nt,dt,Ge),br=[B(or[0]),q(or[1])],yr=z(Nt,dt,Ge);return{hidden:!1,x:br[0],y:br[1],width:yr[0],height:yr[1]}}),at=H(it);Fe.attr("style",function(ot,dt){return"display:"+(at[dt].hidden?"none":"inherit")}).attr("transform",function(ot,dt){return"translate("+at[dt].x+", "+at[dt].y+")"}).attr("layout-width",function(ot,dt){return at[dt].width}).attr("layout-height",function(ot,dt){return at[dt].height}).attr("anchor-x",function(ot,dt,Nt){return it[dt].x-at[dt].x}).attr("anchor-y",function(ot,dt,Nt){return it[dt].y-at[dt].y}),Fe.call(K),O(Fe,_e,Ce)})};return P(ee,X,N("key")),P(ee,H),ee.size=function(){return arguments.length?(z=ln(arguments.length<=0?void 0:arguments[0]),ee):z},ee.position=function(){return arguments.length?(Z=ln(arguments.length<=0?void 0:arguments[0]),ee):Z},ee.component=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],ee):K},ee.decorate=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],ee):O},ee.xScale=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],ee):B},ee.yScale=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],ee):q},ee},Xr=function(I){var O=2,z=function(X){return X},Z=rn("text"),H=rn("rect"),K=rn("circle"),B=function(X){X.each(function(ee,oe,pe){var _e=pe[oe],Ce=a.select(_e),Be=Number(_e.getAttribute("layout-width")),Fe=Number(_e.getAttribute("layout-height")),Ge=H(Ce,[ee]);Ge.attr("width",Be).attr("height",Fe);var it=Number(_e.getAttribute("anchor-x")),at=Number(_e.getAttribute("anchor-y")),ot=K(Ce,[ee]);ot.attr("r",2).attr("cx",it).attr("cy",at);var dt=Z(Ce,[ee]);dt.enter().attr("dy","0.9em").attr("transform","translate(".concat(O,", ").concat(O,")")),dt.text(z)})};return B.padding=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.value=function(){return arguments.length?(z=ln(arguments.length<=0?void 0:arguments[0]),B):z},B},di=function(O,z){return!(O.x>=z.x+z.width||O.x+O.width<=z.x||O.y>=z.y+z.height||O.y+O.height<=z.y)},It=function(I,O){if(di(I,O)){var z=Math.max(I.x,O.x),Z=Math.min(I.x+I.width,O.x+O.width),H=Math.max(I.y,O.y),K=Math.min(I.y+I.height,O.y+O.height);return(Z-z)*(K-H)}else return 0},fr=function(O,z){return t.sum(O.map(function(Z,H){return z===H?0:It(O[z],Z)}))},Ur=function(O,z,Z,H,K){return{x:O,y:z,width:Z,height:H,location:K}},kr=function(I){var O=I.x,z=I.y,Z=I.width,H=I.height;return[Ur(O,z,Z,H,"bottom-right"),Ur(O-Z,z,Z,H,"bottom-left"),Ur(O-Z,z-H,Z,H,"top-left"),Ur(O,z-H,Z,H,"top-right"),Ur(O,z-H/2,Z,H,"middle-right"),Ur(O-Z/2,z,Z,H,"bottom-center"),Ur(O-Z,z-H/2,Z,H,"middle-left"),Ur(O-Z/2,z-H,Z,H,"top-center")]},Pr=function(O,z,Z){return[].concat(dr(O.slice(0,z)),[Z],dr(O.slice(z+1)))},xn=function(O,z){return O<z},on=function I(){var O=null,z=xn,Z=function(){return 0},H,K=function(X,ee){return O-Z(H[ee],ee,H)+Z(X,ee,Pr(H,ee,X))},B=function q(X,ee){O||(O=t.sum(H.map(function(pe,_e){return Z(pe,_e,H)})));var oe=K(X,ee);return z(oe,O)?I().locationScore(Z).winningScore(z).score(oe).rectangles(Pr(H,ee,X)):q};return B.rectangles=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B.score=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.winningScore=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},B.locationScore=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B},qr=function(){var I,O=function(K){return I?K.width*K.height-It(K,I):0},z=function(K,B,q){return fr(q,B)+O(K)},Z=function(K){var B=on().locationScore(z).rectangles(K);return K.forEach(function(q,X){kr(q).forEach(function(ee,oe){B=B(ee,X)})}),B.rectangles()};return Z.bounds=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},Z},Nn=function(O){return O[sn(O)]},sn=function(O){return Math.floor(Math.random()*O.length)},fn=function(){var I=1e3,O=1,z,Z=function(X){switch(X.location){case"bottom-right":return 0;case"middle-right":case"bottom-center":return X.width*X.height/8}return X.width*X.height/4},H=function(X){return z?X.width*X.height-It(X,z):0},K=function(X,ee,oe){return fr(oe,ee)+H(X)+Z(X)},B=function(X){for(var ee=I,oe=function(Fe,Ge){return Math.exp((Ge-Fe)/ee)>Math.random()},pe=on().locationScore(K).winningScore(oe).rectangles(X);ee>0;){var _e=sn(X),Ce=Nn(kr(X[_e]));pe=pe(Ce,_e),ee-=O}return pe.rectangles()};return B.temperature=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],B):I},B.cooling=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.bounds=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},B},Kr=function(O,z){return O[t.scan(O,z)]},lo=function(I){I=I||function(z){return z};var O=function(Z){Z=I(Z);for(var H=function(){var q=Z.filter(function(oe){return!oe.hidden}),X=q.map(function(oe,pe){return[oe,fr(q,pe)]}),ee=Kr(X,function(oe,pe){return pe[1]-oe[1]});if(ee[1]>0)ee[0].hidden=!0;else return"break"};;){var K=H();if(K==="break")break}return Z};return P(O,I),O},Bn=function(){var I=[0,0],O=function(Z){return Z.map(function(H,K){var B=H.x,q=H.y;return B+H.width>I[0]&&(B-=H.width),q+H.height>I[1]&&(q-=H.height),{height:H.height,width:H.width,x:B,y:q}})};return O.bounds=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],O):I},O},vn=function(I){return typeof I=="function"?I:function(){return I}};function Vn(){var I=arguments;return function(O,z){for(var Z=0,H=I.length;Z<H;Z++)if(I[Z](O,z)==null)return!1;return!0}}var Lo=function(I,O){switch(I){case"left":return O/2;case"right":return-O/2;default:return 0}},Ai=function(I){var O=Object.assign({},I),z=function(){};return Object.keys(O).forEach(function(Z){z[Z]=function(){return arguments.length?(O[Z]=arguments.length<=0?void 0:arguments[0],z):O[Z]}}),z},Ui=function(){var I=function(){return 0},O=function(X){return X.x},z=function(X){return X.y},Z="center",H=function(){return 5},K="vertical",B=Ai({decorate:function(){},defined:function(X,ee){return Vn(I,O,z)(X,ee)},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()});return B.values=function(q,X){var ee=H(q,X),oe=Lo(Z,ee),pe=B.xScale(),_e=B.yScale();if(K==="vertical"){var Ce=_e(z(q,X),X),Be=_e(I(q,X),X),Fe=pe(O(q,X),X)+oe;return{d:q,x:Fe,y:Ce,y0:Be,width:ee,height:Ce-Be,origin:[Fe,Ce],baseOrigin:[Fe,Be],transposedX:Fe,transposedY:Ce}}else{var Ge=pe(z(q,X),X),it=pe(I(q,X),X),at=_e(O(q,X),X)+oe;return{d:q,x:at,y:Ge,y0:it,width:ee,height:Ge-it,origin:[Ge,at],baseOrigin:[it,at],transposedX:Ge,transposedY:at}}},B.xValues=function(){return K==="vertical"?[O]:[I,z]},B.yValues=function(){return K!=="vertical"?[O]:[I,z]},B.baseValue=function(){return arguments.length?(I=vn(arguments.length<=0?void 0:arguments[0]),B):I},B.crossValue=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),B):O},B.mainValue=function(){return arguments.length?(z=vn(arguments.length<=0?void 0:arguments[0]),B):z},B.bandwidth=function(){return arguments.length?(H=vn(arguments.length<=0?void 0:arguments[0]),B):H},B.align=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.orient=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],B):K},B},As="#c60",Ms="#6c0",Ss="#000",Me="#ddd",Pe="#999",Ke={red:As,green:Ms,black:Ss,gray:Me,darkGray:Pe},bt=function(){var I=Ui(),O=u.line().x(function(H,K){return I.values(H,K).transposedX}).y(function(H,K){return I.values(H,K).transposedY}),z=rn("path","line"),Z=function(K){un(K)&&z.transition(K),O.defined(I.defined()),K.each(function(B,q,X){var ee=z(a.select(X[q]),[B]);ee.enter().attr("fill","none").attr("stroke",Ke.black),ee.attr("d",O),I.decorate()(ee,B,q)})};return P(Z,I,V("baseValue","bandwidth","align")),E(Z,z,"key"),E(Z,O,"curve"),Z},Ft=function(){var I=Ui(),O=u.line().x(function(Z,H){return I.values(Z,H).transposedX}).y(function(Z,H){return I.values(Z,H).transposedY}),z=function(H){var K=O.context();K.beginPath(),K.strokeStyle=Ke.black,K.fillStyle="transparent",I.decorate()(K,H),O.defined(I.defined())(H),K.fill(),K.stroke(),K.closePath()};return P(z,I,V("baseValue","bandwidth","align")),E(z,O,"curve","context"),z},Xt=function(){var I=[0,1],O=[-1,1],z=function(){};return z.domain=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],z):I},z.range=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],z):O},z},hn=function(){var I={},O={},z=null,Z=function(K,B){var q=K.context();Object.keys(I).forEach(function(X){var ee=I[X];if(typeof ee!="function")throw new Error("Expected an attribute for ".concat(X,", found ").concat(ee));var oe=q.getAttribLocation(B,X);ee.location(oe)(K)}),Object.keys(O).forEach(function(X){var ee=O[X];if(typeof ee!="function")throw new Error("Expected a uniform for ".concat(X,", found ").concat(ee));var oe=q.getUniformLocation(B,X);ee.location(oe)(K)}),z!==null&&z(K)};return Z.flush=function(){Object.values(I).forEach(function(H){return H.clear()}),Object.values(O).forEach(function(H){return H.clear()}),z!==null&&z.clear()},Z.attribute=function(){for(var H=arguments.length,K=new Array(H),B=0;B<H;B++)K[B]=arguments[B];return K.length===1?I[K[0]]:(I[K[0]]=K[1],Z)},Z.uniform=function(){for(var H=arguments.length,K=new Array(H),B=0;B<H;B++)K[B]=arguments[B];return K.length===1?O[K[0]]:(O[K[0]]=K[1],Z)},Z.elementIndices=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z):z},Z},_n=function(I){var O=-1,z=I,Z=!0,H=function(B){if(Z){var q=B.context();if(Array.isArray(z))switch(z.length){case 1:q.uniform1fv(O,z);break;case 2:q.uniform2fv(O,z);break;case 3:q.uniform3fv(O,z);break;case 4:q.uniform4fv(O,z);break;default:throw new Error("Uniform supports up to 4 elements. ".concat(z.length," provided."))}else q.uniform1f(O,z);Z=!1}};return H.clear=function(){Z=!0},H.location=function(){return arguments.length?(O!==(arguments.length<=0?void 0:arguments[0])&&(O=arguments.length<=0?void 0:arguments[0],Z=!0),H):O},H.data=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z=!0,H):z},H},Wn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Kn=function(){var I=null,O=null,z=null,Z=null,H=null,K=null,B=Wn.TRIANGLES,q=0,X=hn(),ee=!1,oe=null,pe=!0,_e=1,Ce=function it(at){if(I!=null){var ot=z(),dt=Z();if(Be(O,ot,dt)&&(O=Fe(ot,dt),H=ot,K=dt,pe=!1),I.useProgram(O),X.uniform("uScreen",_n([I.canvas.width/_e,I.canvas.height/_e])),X(it,O),q===0)X.elementIndices()==null?I.drawArrays(B,0,at):I.drawElements(B,at,I.UNSIGNED_SHORT,0);else if(X.elementIndices()==null)oe.drawArraysInstancedANGLE(B,0,q,at);else{var Nt=X.elementIndices().data().length;if(q!==Nt)throw new Error("Expected elementIndices length ".concat(Nt)+" to match subInstanceCount ".concat(q,"."));oe.drawElementsInstancedANGLE(B,q,I.UNSIGNED_SHORT,0,at)}}};return Ce.extInstancedArrays=function(){return oe},Ce.context=function(){for(var it=arguments.length,at=new Array(it),ot=0;ot<it;ot++)at[ot]=arguments[ot];return at.length?((at[0]==null||at[0]!==I)&&(X.flush(),pe=!0),at[0]!=null&&at[0]!==I&&(oe=at[0].getExtension("ANGLE_instanced_arrays")),I=at[0],Ce):I},Ce.buffers=function(){return arguments.length?(X=arguments.length<=0?void 0:arguments[0],Ce):X},Ce.vertexShader=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Ce):z},Ce.fragmentShader=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],Ce):Z},Ce.mode=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],Ce):B},Ce.subInstanceCount=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],Ce):q},Ce.debug=function(){return arguments.length?(ee=arguments.length<=0?void 0:arguments[0],Ce):ee},Ce.pixelRatio=function(){return arguments.length?(_e=arguments.length<=0?void 0:arguments[0],Ce):_e},Ce;function Be(it,at,ot){return!it||pe?!0:at!==H||ot!==K}function Fe(it,at){var ot=Ge(it,I.VERTEX_SHADER),dt=Ge(at,I.FRAGMENT_SHADER),Nt=I.createProgram();if(I.attachShader(Nt,ot),I.attachShader(Nt,dt),I.linkProgram(Nt),ee&&!I.getProgramParameter(Nt,I.LINK_STATUS)){var or=I.getProgramInfoLog(Nt);throw I.deleteProgram(Nt),new Error("Failed to link program : ".concat(or,`
            Vertex Shader : `).concat(it,`
            Fragment Shader : `).concat(at))}return Nt}function Ge(it,at){var ot=I.createShader(at);if(I.shaderSource(ot,it),I.compileShader(ot),ee&&!I.getShaderParameter(ot,I.COMPILE_STATUS)){var dt=I.getShaderInfoLog(ot);throw I.deleteShader(ot),new Error("Failed to compile shader : ".concat(dt,`
            Shader : `).concat(it))}return ot}},Qr=function(I){var O=[],z=[],Z=function(){return I(O.join(`
`),z.join(`
`))};function H(q,X){q.push(X)}function K(q,X,ee){var oe=q.indexOf(ee);q.splice(oe>=0?oe:q.length,0,X)}function B(q,X){var ee=q.indexOf(X);ee===-1&&q.push(X)}return Z.appendHeader=function(q){return H(O,q),Z},Z.insertHeader=function(q,X){return K(O,q,X),Z},Z.appendHeaderIfNotExists=function(q){return B(O,q),Z},Z.appendBody=function(q){return H(z,q),Z},Z.insertBody=function(q,X){return K(z,q,X),Z},Z.appendBodyIfNotExists=function(q){return B(z,q),Z},Z},Mi=function(O,z){return`
precision mediump float;
float inf = 1.0 / 0.0;
`.concat(O,`
void main() {
    `).concat(z,`
}`)},qi=function(O,z){return`
precision mediump float;
`.concat(O,`
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
    `).concat(z,`
}`)},Ql={header:`attribute vec4 aFillColor;
             varying vec4 vFillColor;`,body:"vFillColor = aFillColor;"},Ah={header:`attribute vec4 aStrokeColor;
             varying vec4 vStrokeColor;`,body:"vStrokeColor = aStrokeColor;"},Mh={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 2.0 * sqrt(aSize / 3.14159);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},ul={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 4.0 * sqrt(aSize / 3.14159);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},$u={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 3.0 * sqrt(aSize / 3.14159);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},cs={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = sqrt(aSize);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},Qu={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = sqrt(aSize);
        gl_PointSize = 2.0 * (vSize + uStrokeWidth + 1.0);
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},Ju={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = sqrt((16.0 * aSize) / (3.0 * sqrt(3.0)));
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},Vc={header:`
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aSize;
        attribute float aDefined;

        uniform float uStrokeWidth;

        varying float vSize;
        varying float vStrokeWidthRatio;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vSize = 3.0 * sqrt(aSize / 5.0);
        vStrokeWidthRatio = uStrokeWidth / (vSize + uStrokeWidth + 1.0);
        gl_PointSize = vSize + uStrokeWidth + 1.0;
        gl_Position = vec4(aCrossValue, aMainValue, 0, 1);`},ef={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aOpenValue;
        attribute float aCloseValue;
        attribute float aLowValue;
        attribute vec3 aCorner;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vColorIndicator;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vColorIndicator = sign(aCloseValue - aOpenValue);

        float isPositiveY = (sign(aCorner.y) + 1.0) / 2.0;
        float isNotPositiveY = 1.0 - isPositiveY;
        float isExtremeY = abs(aCorner.y) - 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;
        float yValue =
         (isPositiveY * isExtremeY * aLowValue) +
         (isPositiveY * isNotExtremeY * aCloseValue) +
         (isNotPositiveY * isNotExtremeY * aOpenValue) +
         (isNotPositiveY * isExtremeY * aHighValue);

        float lineWidthXDirection = (isNotExtremeY * aCorner.x) + (isExtremeY * aCorner.z);

        float bodyThickness = (aOpenValue == aCloseValue ? 1.0 : sign(aCloseValue - aOpenValue));
        float lineWidthYDirection = (isNotExtremeY * bodyThickness * aCorner.y);

        float bandwidthModifier = aBandwidth * aCorner.x / 2.0;

        float xModifier = (uStrokeWidth * lineWidthXDirection / 2.0) + bandwidthModifier;
        float yModifier = uStrokeWidth * lineWidthYDirection / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},Jl={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aOpenValue;
        attribute float aCloseValue;
        attribute float aLowValue;
        attribute vec3 aCorner;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vColorIndicator;
        varying float vDefined;`,body:`
        vDefined = aDefined;
        vColorIndicator = sign(aCloseValue - aOpenValue);

        float isPositiveY = (sign(aCorner.y) + 1.0) / 2.0;
        float isNotPositiveY = 1.0 - isPositiveY;
        float isExtremeY = abs(aCorner.y) - 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;
        float yValue =
            (isPositiveY * isExtremeY * aLowValue) +
            (isPositiveY * isNotExtremeY * aCloseValue) +
            (isNotPositiveY * isNotExtremeY * aOpenValue) +
            (isNotPositiveY * isExtremeY * aHighValue);

        float lineWidthXDirection = isExtremeY * aCorner.z;
        float lineWidthYDirection = isNotExtremeY * aCorner.z;

        float bandwidthModifier = isNotExtremeY * aCorner.x * aBandwidth / 2.0;

        float xModifier = (uStrokeWidth * lineWidthXDirection / 2.0) + bandwidthModifier;
        float yModifier = uStrokeWidth * lineWidthYDirection / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},Fa={header:`
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aMainValue;
        attribute float aBaseValue;
        attribute vec2 aCorner;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vDefined;`,body:`
        vDefined = aDefined;
        float isBaseline = (1.0 - aCorner.y) / 2.0;
        float yValue = (isBaseline * aBaseValue) + ((1.0 - isBaseline) * aMainValue);

        float xModifier = aCorner.x * (aBandwidth) / 2.0;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);`},Sn={header:`
        attribute vec3 aCorner;
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aHighValue;
        attribute float aLowValue;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vDefined;`,body:`
        vDefined = aDefined;
        float isLow = (aCorner.y + 1.0) / 2.0;
        float yValue = isLow * aLowValue + (1.0 - isLow) * aHighValue;

        float isEdgeCorner = abs(aCorner.x);
        float lineWidthXDirection = (1.0 - isEdgeCorner) * aCorner.z;
        float lineWidthYDirection = isEdgeCorner * aCorner.z;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);

        float xModifier = (uStrokeWidth * lineWidthXDirection) + (aBandwidth * aCorner.x / 2.0);
        float yModifier = (uStrokeWidth * lineWidthYDirection);`},tf={header:`
        attribute vec3 aCorner;
        attribute float aCrossValue;
        attribute float aMainValue;
        attribute float aCrossNextValue;
        attribute float aMainNextValue;
        attribute float aBaseValue;
        attribute float aBaseNextValue;
        attribute float aDefined;
        attribute float aDefinedNext;

        varying float vDefined;

        float when_lt(float a, float b) {
            return max(sign(b - a), 0.0);
        }

        float and(float a, float b) {
            return a * b;
        }`,body:`
        vDefined = aDefined * aDefinedNext;
        gl_Position = vec4(0, 0, 0, 1);

        float hasIntercepted = when_lt((aMainNextValue - aBaseNextValue) * (aMainValue - aBaseValue), 0.0);
        float useIntercept = and(aCorner.z, hasIntercepted);

        float yGradient = (aMainNextValue - aMainValue) / (aCrossNextValue - aCrossValue);
        float yConstant = aMainNextValue - (yGradient * aCrossNextValue);

        float y0Gradient = (aBaseNextValue - aBaseValue) / (aCrossNextValue - aCrossValue);
        float y0Constant = aBaseNextValue - (y0Gradient * aCrossNextValue);

        float denominator = (yGradient - y0Gradient) + step(abs(yGradient - y0Gradient), 0.0);
        float interceptXValue = (y0Constant - yConstant) / denominator;
        float interceptYValue = (yGradient * interceptXValue) + yConstant;

        gl_Position = vec4(interceptXValue * useIntercept, interceptYValue * useIntercept, 0, 1);

        gl_Position.x += (1.0 - useIntercept) * ((aCorner.x * aCrossNextValue) + ((1.0 - aCorner.x) * aCrossValue));
        gl_Position.y += (1.0 - useIntercept) * (1.0 - aCorner.y) * ((aCorner.x * aMainNextValue) + ((1.0 - aCorner.x) * aMainValue));
        gl_Position.y += (1.0 - useIntercept) * aCorner.y * ((aCorner.x * aBaseNextValue) + ((1.0 - aCorner.x) * aBaseValue));`},Go={header:`
        attribute vec4 aCorner;
        attribute float aCrossValue;
        attribute float aBandwidth;
        attribute float aCapWidth;
        attribute float aHighValue;
        attribute float aUpperQuartileValue;
        attribute float aMedianValue;
        attribute float aLowerQuartileValue;
        attribute float aLowValue;
        attribute float aDefined;

        uniform vec2 uScreen;
        uniform float uStrokeWidth;

        varying float vDefined;
    `,body:`
        vDefined = aDefined;
        float isExtremeY = sign(abs(aCorner.y) - 2.0) + 1.0;
        float isNotExtremeY = 1.0 - isExtremeY;

        float isNonZeroY = abs(sign(aCorner.y));
        float isZeroY = 1.0 - isNonZeroY;

        float isQuartileY = isNotExtremeY * isNonZeroY;

        float isPositiveY = (sign(aCorner.y + 0.5) + 1.0) / 2.0;
        float isNegativeY = 1.0 - isPositiveY;

        float yValue =
          (isExtremeY * isNegativeY) * aHighValue +
          (isQuartileY * isNegativeY) * aUpperQuartileValue +
          isZeroY * aMedianValue +
          (isQuartileY * isPositiveY) * aLowerQuartileValue +
          (isExtremeY * isPositiveY) * aLowValue;

        gl_Position = vec4(aCrossValue, yValue, 0, 1);

        float isHorizontal = aCorner.w;
        float isVertical = 1.0 - isHorizontal;

        float xDisplacement = aCorner.x * (isExtremeY * aCapWidth + isNotExtremeY * aBandwidth) / 2.0;

        float xModifier = (isVertical * uStrokeWidth * aCorner.z / 2.0) + xDisplacement;
        float yModifier = isHorizontal * uStrokeWidth * aCorner.z / 2.0;`},Ho={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        float canFill = 1.0;
        float distance = length(2.0 * gl_PointCoord - 1.0);
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
            return;
        }`},Sh={header:`
        varying float vSize;
        varying float vDefined;

        // anterior, exterior angles
        float an = 0.628319;
        vec2 acs = vec2(0.809017, 0.587786); // (cos, sin)
        float en = 0.952000;
        vec2 ecs = vec2(0.580055, 0.814577);
    `,body:`
        float canFill = 1.0;

        vec2 p = 2.0 * gl_PointCoord - 1.0;
        p.y *= -1.0;

        // sector
        float bn = mod(atan(p.x, p.y), 2.0 * an) - an;
        p = length(p) * vec2(cos(bn), abs(sin(bn)));

        p -= acs;
        p += ecs * clamp(-dot(p, ecs), 0.0, acs.y / ecs.y);
        float d = length(p) * sign(p.x);

        float distance = 1.0 + d;
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
            return;
        }`},rf={header:`
        varying float vSize;
        varying float vDefined;
    `,body:`
        float canFill = 1.0;

        vec2 p = 2.0 * gl_PointCoord - 1.0;
        p.y *= -1.0;

        // sector
        float an = 3.141593 / 3.0;
        float bn = mod(atan(p.x, p.y), 2.0 * an) - an;
        p = length(p) * vec2(cos(bn), abs(sin(bn)));

        // box
        vec2 d = abs(p) - vec2(0.9, 0.35);
        float sdf = length(max(d, 0.0)) + min(max(d.x, d.y), 0.0);

        float distance = 1.0 + sdf;
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
            return;
        }`},nf={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        float canFill = 1.0;
        if (vDefined < 0.5) {
            discard;
        }
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float distance = max(abs(pointCoordTransform.x), abs(pointCoordTransform.y));
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);`},Th={header:`
        varying float vSize;
        varying float vDefined;
        float a = 0.6;
        float b = 1.0;
    `,body:`
        if (vDefined < 0.5) {
            discard;
        }

        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;

        float x = abs(pointCoordTransform.x);
        float y = abs(pointCoordTransform.y);

        float X = (a * b * x) / (a * y + b * x);
        float Y = (a * b * y) / (a * y + b * x);

        float distance = length(vec2(x, y)) / length(vec2(X, Y));

        if (distance > 1.0) {
            discard;
        }
    `},Eh={header:`
        varying float vSize;
        varying float vDefined;`,body:`
        float canFill = 1.0;
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float topEdgesDistance = abs(pointCoordTransform.x) - ((pointCoordTransform.y - 0.6) / sqrt(3.0));
        float bottomEdgeDistance = pointCoordTransform.y + 0.5;
        float distance = max(topEdgesDistance, bottomEdgeDistance);
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
        }`},of={header:`
        varying float vSize;
        varying float vStrokeWidthRatio;
        varying float vDefined;`,body:`
        float canFill = 1.0;
        vec2 pointCoordTransform = 2.0 * gl_PointCoord - 1.0;
        float innerCornerDistance = min(abs(pointCoordTransform.x), abs(pointCoordTransform.y)) + 0.66 - vStrokeWidthRatio;
        float outerEdgeDistance = max(abs(pointCoordTransform.x), abs(pointCoordTransform.y));
        float distance = max(innerCornerDistance, outerEdgeDistance);
        float canStroke = smoothstep(vSize - 2.0, vSize, distance * vSize);
        if (distance > 1.0 || vDefined < 0.5) {
            discard;
        }`},Ih={header:`
        varying float vColorIndicator;
        varying float vDefined;`,body:`
        float canFill = 1.0;
        float canStroke = 0.0;
        if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.4, 0.8, 0, 1);
        if (vColorIndicator < 0.0) {
            gl_FragColor = vec4(0.8, 0.4, 0, 1);
        }`},Ch={header:`
        varying float vColorIndicator;
        varying float vDefined;`,body:`
        float canFill = 0.0;
        float canStroke = 1.0;
        if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.4, 0.8, 0, 1);
        if (vColorIndicator < 0.0) {
            gl_FragColor = vec4(0.8, 0.4, 0, 1);
        }`},sf={header:`
        varying float vDefined;`,body:`
        float canFill = 1.0;
        float canStroke = 0.0;
        if (vDefined < 0.5) {
            discard;
        }
        gl_FragColor = vec4(0.86, 0.86, 0.86, 1);`},Up={header:`
        varying float vDefined;
    `,body:`
        float canFill = 0.0;
        float canStroke = 1.0;

        if (vDefined < 0.5) {
            discard;
        }`},Vp={header:"varying float vDefined;",body:`
        float canFill = 0.0;
        float canStroke = 1.0;
        if (vDefined < 0.5) {
            discard;
        }`},ec={header:"varying float vDefined;",body:`
        float canFill = 1.0;
        float canStroke = 0.0;

        gl_FragColor = vec4(0.60, 0.60, 0.60, 1.0);

        if (vDefined < 0.5) {
            discard;
        }`},g_={header:"varying vec4 vFillColor;",body:"gl_FragColor = (canFill * vFillColor) + ((1.0 - canFill) * gl_FragColor);"},__={header:"varying vec4 vStrokeColor;",body:"gl_FragColor = (canStroke * vStrokeColor) + ((1.0 - canStroke) * gl_FragColor);"},Ox=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(tf.header).appendBody(tf.body),O.appendHeader(sf.header).appendBody(sf.body),{vertex:function(){return I},fragment:function(){return O}}},Ln={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,FLOAT:5126};function Wp(I){switch(I){case Ln.BYTE:case Ln.UNSIGNED_BYTE:return 1;case Ln.SHORT:case Ln.UNSIGNED_SHORT:return 2;case Ln.FLOAT:return 4;default:throw new Error("Unknown type ".concat(I))}}function y_(I){switch(I){case Ln.BYTE:return Int8Array;case Ln.UNSIGNED_BYTE:return Uint8Array;case Ln.SHORT:return Int16Array;case Ln.UNSIGNED_SHORT:return Uint16Array;case Ln.FLOAT:return Float32Array;default:throw new Error("Unknown type ".concat(I))}}var Wc=function(){var I=-1,O=null,z=1,Z=Ln.FLOAT,H=!1,K=0,B=0,q=null,X=function(oe){var pe=oe.context();O==null&&(O=pe.createBuffer()),pe.bindBuffer(pe.ARRAY_BUFFER,O),pe.vertexAttribPointer(I,z,Z,H,K,B),pe.enableVertexAttribArray(I);var _e=oe.extInstancedArrays();_e.vertexAttribDivisorANGLE(I,q??(oe.subInstanceCount()>0?1:0))};return X.location=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],X):I},X.buffer=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],X):O},X.size=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],X):z},X.type=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],X):Z},X.normalized=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],X):H},X.stride=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],X):K},X.offset=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],X):B},X.divisor=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],X):q},X},kh=function(){var I=Ln.FLOAT,O=new Float32Array(0),z=function(H){var K=y_(I);return O.length>H?O=new K(O.buffer,0,H):O.length!==H&&(O=new K(H)),O};return z.type=function(){if(!arguments.length)return I;if(I!==(arguments.length<=0?void 0:arguments[0])){I=arguments.length<=0?void 0:arguments[0];var Z=y_(I);O=new Z(0)}return z},z},Ph=function(){var I=!0,O=1,z=Ln.FLOAT,Z=kh(),H=function(X,ee){return X},K=null,B=function(){var X=K.length,ee=Z.type(z)(X*O);if(O>1)for(var oe=0;oe<X;oe++){var pe=H(K[oe],oe);if(pe.length!==O)throw new Error("Expected components array of size ".concat(O,", recieved array with length ").concat(pe.length,"."));for(var _e=0;_e<O;_e++)ee[oe*O+_e]=pe[_e]}else for(var Ce=0;Ce<X;Ce++){var Be=H(K[Ce],Ce);if(Array.isArray(Be))throw new Error("Expected a single component value, recieved array with length ".concat(Be.length,"."));ee[Ce]=Be}return I=!1,ee};return B.dirty=function(){return I},B.clear=function(){I=!0},B.size=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],I=!0,B):O},B.type=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],I=!0,B):z},B.arrayViewFactory=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],I=!0,B):Z},B.value=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],I=!0,B):H},B.data=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],I=!0,B):K},B},yn=function(){var I=Wc(),O=Ph(),z=function Z(H){if(I.size(Z.size()).type(Z.type()),I(H),!!O.dirty()){var K=O(),B=H.context();B.bindBuffer(B.ARRAY_BUFFER,I.buffer()),B.bufferData(B.ARRAY_BUFFER,K,B.DYNAMIC_DRAW)}};return z.clear=function(){I.buffer(null),O.clear()},E(z,I,"normalized","location","divisor"),E(z,O,"data","value","size","type"),z},Gr=function(I,O,z,Z){for(var H=arguments.length,K=new Array(H>4?H-4:0),B=4;B<H;B++)K[B-4]=arguments[B];I[O]=function(){for(var q=arguments.length,X=new Array(q),ee=0;ee<q;ee++)X[ee]=arguments[ee];var oe=z[Z].apply(z,K.concat(X));return oe===z?I:oe}},Zp=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(6),O=Xt(),z=Xt(),Z=function(){},H=yn().divisor(0).size(3).type(Ln.UNSIGNED_BYTE).data([[0,0,0],[0,1,0],[1,1,1],[0,0,1],[1,0,0],[1,1,0]]);I.buffers().attribute("aCorner",H);var K=function(q){var X=Ox();I.vertexShader(X.vertex()).fragmentShader(X.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),Z(I),I(q-1)};return K.decorate=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],K):Z},K.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},E(K,I,"context","pixelRatio"),Gr(K,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(K,"crossNextValueAttribute",I.buffers(),"attribute","aCrossNextValue"),Gr(K,"mainValueAttribute",I.buffers(),"attribute","aMainValue"),Gr(K,"mainNextValueAttribute",I.buffers(),"attribute","aMainNextValue"),Gr(K,"baseValueAttribute",I.buffers(),"attribute","aBaseValue"),Gr(K,"baseNextValueAttribute",I.buffers(),"attribute","aBaseNextValue"),Gr(K,"definedAttribute",I.buffers(),"attribute","aDefined"),Gr(K,"definedNextAttribute",I.buffers(),"attribute","aDefinedNext"),K},Yp=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Mh.header).appendBody(Mh.body),O.appendHeader(Ho.header).appendBody(Ho.body),{vertex:function(){return I},fragment:function(){return O}}},Oh=function(){var I=Kn().mode(Wn.POINTS),O=Xt(),z=Xt(),Z=Yp(),H=function(){},K=function(q){I.vertexShader(Z.vertex()).fragmentShader(Z.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),H(I),I(q)};return K.type=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],K):Z},K.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],K):H},K.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},E(K,I,"context","pixelRatio"),Gr(K,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(K,"mainValueAttribute",I.buffers(),"attribute","aMainValue"),Gr(K,"sizeAttribute",I.buffers(),"attribute","aSize"),Gr(K,"definedAttribute",I.buffers(),"attribute","aDefined"),K},Gs=function(){var I=1,O=function(Z){Z.buffers().uniform("uStrokeWidth",_n(I))};return O.lineWidth=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],O):I},O},fl=function(I){var O=null,z=I,Z=!0,H=function(B){var q=B.context();O==null&&(O=q.createBuffer()),q.bindBuffer(q.ELEMENT_ARRAY_BUFFER,O),Z&&(q.bufferData(q.ELEMENT_ARRAY_BUFFER,new Uint16Array(z),q.STATIC_DRAW),Z=!1)};return H.clear=function(){O=null,Z=!0},H.data=function(){return arguments.length?(Z=!0,z=arguments.length<=0?void 0:arguments[0],H):z},H},Ba=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(6),O=Xt(),z=Xt(),Z=function(){},H=Gs(),K=yn().divisor(0).size(4).type(Ln.BYTE).data([[-1,1,1,0],[1,1,0,1],[1,-1,0,1],[-1,-1,1,0]]);I.buffers().elementIndices(fl([0,1,2,2,3,0])).attribute("aCorner",K);var B=function(X){var ee=Qr(Mi),oe=Qr(qi);I.vertexShader(ee).fragmentShader(oe),ee.appendHeader(`
            attribute vec4 aCorner;
            attribute float aCrossValue;
            attribute float aCrossNextValue;
            attribute float aMainValue;
            attribute float aMainNextValue;
            attribute float aDefined;
            attribute float aDefinedNext;

            uniform float uStrokeWidth;
            uniform vec2 uScreen;

            varying float vLength;
            varying vec2 vPosition;
        `),ee.appendBody(`
            vec4 value = vec4(aCrossValue, aMainValue, 0.0, 1.0);
            vec4 nextValue = vec4(aCrossNextValue, aMainNextValue, 0.0, 1.0);
        `),O(I,"value",0),O(I,"nextValue",0),z(I,"value",1),z(I,"nextValue",1),ee.appendBody(`
            vec2 position = aCorner[2] * value.xy + aCorner[3] * nextValue.xy;

            vec2 direction = normalize((nextValue.xy - value.xy) * uScreen);
            vec2 normal = vec2(direction.y, -direction.x);
            vec2 padding = ((uStrokeWidth / 2.0) / (uScreen / 2.0));
            
            padding *= aDefined * aDefinedNext;
            position += (aCorner[0] * direction + aCorner[1] * normal) * padding;

            gl_Position = vec4(position.x, position.y, 0.0, 1.0);

            vLength = length((nextValue.xy - value.xy) * (uScreen / 2.0));
            vPosition = aCorner.xy * (uStrokeWidth / 2.0);
            vPosition.x += aCorner[3] * vLength;
        `),oe.appendHeader(`
            uniform float uStrokeWidth;
            varying float vLength;
            varying vec2 vPosition;

            float canFill = 0.0;
            float canStroke = 1.0;
        `),oe.appendBody(`
            vec2 position = vPosition;
            position.x -= clamp(position.x, 0.0, vLength);
            float sdf = length(position) - uStrokeWidth / 2.0;
            if (sdf > 0.5) {
                discard;
            }
        `),H(I),Z(I),I(X-1)};return B.decorate=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},E(B,I,"context","pixelRatio"),E(B,H,"lineWidth"),Gr(B,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(B,"crossNextValueAttribute",I.buffers(),"attribute","aCrossNextValue"),Gr(B,"mainValueAttribute",I.buffers(),"attribute","aMainValue"),Gr(B,"mainNextValueAttribute",I.buffers(),"attribute","aMainNextValue"),Gr(B,"definedAttribute",I.buffers(),"attribute","aDefined"),Gr(B,"definedNextAttribute",I.buffers(),"attribute","aDefinedNext"),B},Zc=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Jl.header).appendBody(Jl.body),O.appendHeader(Ch.header).appendBody(Ch.body),{vertex:function(){return I},fragment:function(){return O}}},qp=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(18),O=Xt(),z=Xt(),Z=Gs(),H=function(){},K=yn().divisor(0).size(3).type(Ln.BYTE).data([[0,-2,-1],[0,-2,1],[0,2,1],[0,2,-1],[-1,-1,-1],[-1,-1,1],[0,-1,1],[0,-1,-1],[1,1,1],[0,1,1],[0,1,-1],[1,1,-1]]);I.buffers().elementIndices(fl([0,1,2,0,3,2,4,5,6,4,7,6,8,9,10,10,11,8])).attribute("aCorner",K);var B=function(X){var ee=Zc();I.vertexShader(ee.vertex()).fragmentShader(ee.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),Z(I),I.vertexShader().appendBody(`
          gl_Position.x += xModifier / uScreen.x * 2.0;
          gl_Position.y += yModifier / uScreen.y * 2.0;
        `),H(I),I(X)};return B.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},E(B,I,"context","pixelRatio"),E(B,Z,"lineWidth"),Gr(B,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(B,"openValueAttribute",I.buffers(),"attribute","aOpenValue"),Gr(B,"highValueAttribute",I.buffers(),"attribute","aHighValue"),Gr(B,"lowValueAttribute",I.buffers(),"attribute","aLowValue"),Gr(B,"closeValueAttribute",I.buffers(),"attribute","aCloseValue"),Gr(B,"bandwidthAttribute",I.buffers(),"attribute","aBandwidth"),Gr(B,"definedAttribute",I.buffers(),"attribute","aDefined"),B},Gp=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Fa.header).appendBody(Fa.body),O.appendHeader(ec.header).appendBody(ec.body),{vertex:function(){return I},fragment:function(){return O}}},Fn=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(6),O=Xt(),z=Xt(),Z=function(){},H=yn().divisor(0).size(2).type(Ln.BYTE).data([[-1,-1],[1,1],[-1,1],[1,-1]]);I.buffers().elementIndices(fl([0,1,2,0,1,3])).attribute("aCorner",H);var K=function(q){var X=Gp();I.vertexShader(X.vertex()).fragmentShader(X.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),I.vertexShader().appendBody(`
            gl_Position.x += xModifier / uScreen.x * 2.0;
        `),Z(I),I(q)};return K.decorate=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],K):Z},K.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},E(K,I,"context","pixelRatio"),Gr(K,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(K,"mainValueAttribute",I.buffers(),"attribute","aMainValue"),Gr(K,"baseValueAttribute",I.buffers(),"attribute","aBaseValue"),Gr(K,"bandwidthAttribute",I.buffers(),"attribute","aBandwidth"),Gr(K,"definedAttribute",I.buffers(),"attribute","aDefined"),K},pi=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Sn.header).appendBody(Sn.body),O.appendHeader(Vp.header).appendBody(Vp.body),{vertex:function(){return I},fragment:function(){return O}}},x_=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(18),O=Xt(),z=Xt(),Z=function(){},H=Gs(),K=yn().divisor(0).size(3).type(Ln.BYTE).data([[0,1,1],[0,1,-1],[0,-1,-1],[0,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,1,1],[1,1,-1]]);I.buffers().elementIndices(fl([0,1,2,0,3,2,4,5,6,4,7,6,8,9,10,8,11,10])).attribute("aCorner",K);var B=function(X){var ee=pi();I.vertexShader(ee.vertex()).fragmentShader(ee.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),H(I),I.vertexShader().appendBody(`
                gl_Position.x += xModifier / uScreen.x * 2.0;
                gl_Position.y += yModifier / uScreen.y * 2.0;
            `),Z(I),I(X)};return B.decorate=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},E(B,I,"context","pixelRatio"),E(B,H,"lineWidth"),Gr(B,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(B,"highValueAttribute",I.buffers(),"attribute","aHighValue"),Gr(B,"lowValueAttribute",I.buffers(),"attribute","aLowValue"),Gr(B,"bandwidthAttribute",I.buffers(),"attribute","aBandwidth"),Gr(B,"definedAttribute",I.buffers(),"attribute","aDefined"),B},Tn=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(ef.header).appendBody(ef.body),O.appendHeader(Ih.header).appendBody(Ih.body),{vertex:function(){return I},fragment:function(){return O}}},hl=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(12),O=Xt(),z=Xt(),Z=Gs(),H=function(){},K=yn().divisor(0).size(3).type(Ln.BYTE).data([[0,2,1],[0,2,-1],[0,-2,-1],[0,-2,1],[1,-1,0],[-1,-1,0],[-1,1,0],[1,1,0]]);I.buffers().elementIndices(fl([0,1,2,0,3,2,4,5,6,4,7,6])).attribute("aCorner",K);var B=function(X){var ee=Tn();I.vertexShader(ee.vertex()).fragmentShader(ee.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),Z(I),I.vertexShader().appendBody(`
          gl_Position.x += xModifier / uScreen.x * 2.0;
          gl_Position.y += yModifier / uScreen.y * 2.0;
        `),H(I),I(X)};return B.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},E(B,I,"context","pixelRatio"),E(B,Z,"lineWidth"),Gr(B,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(B,"openValueAttribute",I.buffers(),"attribute","aOpenValue"),Gr(B,"highValueAttribute",I.buffers(),"attribute","aHighValue"),Gr(B,"lowValueAttribute",I.buffers(),"attribute","aLowValue"),Gr(B,"closeValueAttribute",I.buffers(),"attribute","aCloseValue"),Gr(B,"bandwidthAttribute",I.buffers(),"attribute","aBandwidth"),Gr(B,"definedAttribute",I.buffers(),"attribute","aDefined"),B},mi=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Go.header).appendBody(Go.body),O.appendHeader(Up.header).appendBody(Up.body),{vertex:function(){return I},fragment:function(){return O}}},li=function(){var I=Kn().mode(Wn.TRIANGLES).subInstanceCount(54),O=Xt(),z=Xt(),Z=function(){},H=Gs(),K=yn().divisor(0).size(4).type(Ln.BYTE).data([[-1,-2,-1,1],[1,-2,-1,1],[1,-2,1,1],[-1,-2,1,1],[0,-2,-1,0],[0,-2,1,0],[0,-1,1,0],[0,-1,-1,0],[-1,-1,-1,1],[1,-1,-1,1],[1,-1,1,1],[-1,-1,1,1],[-1,0,-1,1],[1,0,-1,1],[1,0,1,1],[-1,0,1,1],[-1,1,-1,1],[1,1,-1,1],[1,1,1,1],[-1,1,1,1],[-1,-1,-1,0],[-1,-1,1,0],[-1,1,1,0],[-1,1,-1,0],[1,-1,-1,0],[1,-1,1,0],[1,1,1,0],[1,1,-1,0],[0,2,-1,0],[0,2,1,0],[0,1,1,0],[0,1,-1,0],[-1,2,-1,1],[1,2,-1,1],[1,2,1,1],[-1,2,1,1]]);I.buffers().elementIndices(fl([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23,24,25,26,24,26,27,28,29,30,28,30,31,32,33,34,32,34,35])).attribute("aCorner",K);var B=function(X){var ee=mi();I.vertexShader(ee.vertex()).fragmentShader(ee.fragment()),O(I,"gl_Position",0),z(I,"gl_Position",1),H(I),I.vertexShader().appendBody(`
            gl_Position.x += xModifier / uScreen.x * 2.0;
            gl_Position.y += yModifier / uScreen.y * 2.0;
        `),Z(I),I(X)};return B.decorate=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.xScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.yScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},E(B,I,"context","pixelRatio"),E(B,H,"lineWidth"),Gr(B,"crossValueAttribute",I.buffers(),"attribute","aCrossValue"),Gr(B,"highValueAttribute",I.buffers(),"attribute","aHighValue"),Gr(B,"upperQuartileValueAttribute",I.buffers(),"attribute","aUpperQuartileValue"),Gr(B,"medianValueAttribute",I.buffers(),"attribute","aMedianValue"),Gr(B,"lowerQuartileValueAttribute",I.buffers(),"attribute","aLowerQuartileValue"),Gr(B,"lowValueAttribute",I.buffers(),"attribute","aLowValue"),Gr(B,"bandwidthAttribute",I.buffers(),"attribute","aBandwidth"),Gr(B,"capAttribute",I.buffers(),"attribute","aCapWidth"),Gr(B,"definedAttribute",I.buffers(),"attribute","aDefined"),B},Ts=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(I>0||O<0)throw new Error("Offset values (".concat(I," & ").concat(O,") must straddle 0 "));var z=Wc(),Z=Ph(),H=function K(B){var q=K.size()*Wp(K.type()),X=Math.abs(I)*q;if(z.offset(X).size(K.size()).type(K.type()),z(B),!!Z.dirty()){var ee=Z(),oe=O*q,pe=X+ee.length*Wp(K.type())+oe,_e=B.context();_e.bindBuffer(_e.ARRAY_BUFFER,z.buffer()),_e.bufferData(_e.ARRAY_BUFFER,pe,_e.DYNAMIC_DRAW),_e.bufferSubData(_e.ARRAY_BUFFER,X,ee)}};return H.offset=function(K){if(I>K||K>O)throw new Error("Requested offset ".concat(K," exceeds bounds (").concat(I," & ").concat(O,") "));var B=function(X){z.offset((K-I)*H.size()*Wp(H.type())),z(X)};return E(B,H,"clear","location"),B},H.clear=function(){z.buffer(null),Z.clear()},E(H,z,"normalized","location","divisor"),E(H,Z,"data","value","size","type"),H},af=function(){var I=Xt(),O=function(H){return"linear".concat(H)},z=function(H,K,B){H.vertexShader().appendHeaderIfNotExists("uniform vec4 ".concat(O(B),"Offset;")).appendHeaderIfNotExists("uniform vec4 ".concat(O(B),"Scale;")).appendBody("".concat(K," = ").concat(K," + ").concat(O(B),"Offset;")).appendBody("".concat(K," = ").concat(K," * ").concat(O(B),"Scale;"));var q=I.domain()[1]-I.domain()[0],X=I.range()[1]-I.range()[0],ee=I.range()[0]*(q/X)-I.domain()[0],oe=X/q,pe=[0,0,0,0],_e=[1,1,1,1];pe[B]=ee,_e[B]=oe,H.buffers().uniform("".concat(O(B),"Offset"),_n(pe)).uniform("".concat(O(B),"Scale"),_n(_e))};return P(z,I),z},Rh=function(){var I=Xt(),O=10;function z(K,B){return Math.log10(K)/Math.log10(B)}var Z=function(B){return"log".concat(B)},H=function(B,q,X){var ee="".concat(Z(X),"Offset + (").concat(Z(X),"Scale * clamp(log(").concat(q,") / log(").concat(Z(X),"Base), -inf, inf))");B.vertexShader().appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Offset;")).appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Scale;")).appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Include;")).appendHeaderIfNotExists("uniform float ".concat(Z(X),"Base;")).appendBody("".concat(q," = (").concat(Z(X),"Include * (").concat(ee,")) + ((1.0 - ").concat(Z(X),"Include) * ").concat(q,");"));var oe=z(I.domain()[1],O)-z(I.domain()[0],O),pe=I.range()[1]-I.range()[0],_e=pe/oe,Ce=I.range()[0]-_e*z(I.domain()[0],O),Be=[0,0,0,0],Fe=[0,0,0,0],Ge=[0,0,0,0];Be[X]=Ce,Fe[X]=_e,Ge[X]=1,B.buffers().uniform("".concat(Z(X),"Offset"),_n(Be)).uniform("".concat(Z(X),"Scale"),_n(Fe)).uniform("".concat(Z(X),"Include"),_n(Ge)).uniform("".concat(Z(X),"Base"),_n(O))};return H.base=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},P(H,I),H},lf=function(){var I=Xt(),O=1;function z(K,B){return Math.sign(K)*Math.pow(Math.abs(K),B)}var Z=function(B){return"pow".concat(B)},H=function(B,q,X){var ee="".concat(Z(X),"Offset + (").concat(Z(X),"Scale * sign(").concat(q,") * pow(abs(").concat(q,"), vec4(").concat(Z(X),"Exp)))");B.vertexShader().appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Offset;")).appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Scale;")).appendHeaderIfNotExists("uniform vec4 ".concat(Z(X),"Include;")).appendHeaderIfNotExists("uniform float ".concat(Z(X),"Exp;")).appendBody("".concat(q," = (").concat(Z(X),"Include * (").concat(ee,")) + ((1.0 - ").concat(Z(X),"Include) * ").concat(q,");"));var oe=z(I.domain()[1],O)-z(I.domain()[0],O),pe=I.range()[1]-I.range()[0],_e=pe/oe,Ce=I.range()[0]-_e*z(I.domain()[0],O),Be=[0,0,0,0],Fe=[0,0,0,0],Ge=[0,0,0,0];Be[X]=Ce,Fe[X]=_e,Ge[X]=1,B.buffers().uniform("".concat(Z(X),"Offset"),_n(Be)).uniform("".concat(Z(X),"Scale"),_n(Fe)).uniform("".concat(Z(X),"Include"),_n(Ge)).uniform("".concat(Z(X),"Exp"),_n(O))};return H.exponent=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},P(H,I),H},Nh=r.scaleLinear().copy.toString(),Hp=r.scaleLog().copy.toString(),zh=r.scalePow().copy.toString(),Xp=r.scaleTime().copy.toString(),tc=r.scaleIdentity(),cf=Date.now(),Yc=function(O){return O-cf},dl=function(I){switch(I.copy.toString()){case Nh:return{scale:tc,webglScale:af().domain(I.domain())};case Xp:return{scale:Yc,webglScale:af().domain(I.domain().map(Yc))};case Hp:return{scale:tc,webglScale:Rh().domain(I.domain()).base(I.base())};case zh:return{scale:tc,webglScale:lf().domain(I.domain()).exponent(I.exponent())};default:return{scale:I.copy(),webglScale:af().domain(I.range())}}},Kp=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(cs.header).appendBody(cs.body),O.appendHeader(nf.header).appendBody(nf.body),{vertex:function(){return I},fragment:function(){return O}}},Rx=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Ju.header).appendBody(Ju.body),O.appendHeader(Eh.header).appendBody(Eh.body),{vertex:function(){return I},fragment:function(){return O}}},b_=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Vc.header).appendBody(Vc.body),O.appendHeader(of.header).appendBody(of.body),{vertex:function(){return I},fragment:function(){return O}}},Dh=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(Qu.header).appendBody(Qu.body),O.appendHeader(Th.header).appendBody(Th.body),{vertex:function(){return I},fragment:function(){return O}}},$p=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader(ul.header).appendBody(ul.body),O.appendHeader(Sh.header).appendBody(Sh.body),{vertex:function(){return I},fragment:function(){return O}}},v_=function(){var I=Qr(Mi),O=Qr(qi);return I.appendHeader($u.header).appendBody($u.body),O.appendHeader(rf.header).appendBody(rf.body),{vertex:function(){return I},fragment:function(){return O}}},Qp=function(I){switch(I){case u.symbolCircle:return Yp();case u.symbolSquare:return Kp();case u.symbolTriangle:return Rx();case u.symbolCross:return b_();case u.symbolDiamond:return Dh();case u.symbolStar:return $p();case u.symbolWye:return v_();default:throw new Error("Unrecognised symbol: ".concat(I))}},qc=function(I){var O=Wc().divisor(1),z=I,Z=!0,H=function(B){if(O(B),!!Z){if(!Array.isArray(z))throw new Error("Expected an array, received: ".concat(z));if(z.length!==O.size())throw new Error("Expected array of length: ".concat(O.size(),", recieved array of length: ").concat(z.length));var q=B.context();q["vertexAttrib".concat(z.length,"fv")](O.location(),z),q.disableVertexAttribArray(O.location()),Z=!1}};return H.clear=function(){Z=!0},H.value=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z=!0,H):z},E(H,O,"normalized","size","location"),H},Lh=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,1],O=yn().size(4),z=I,Z=!0,H=function(B){if(B.vertexShader().appendHeaderIfNotExists(Ql.header).appendBodyIfNotExists(Ql.body),B.fragmentShader().appendHeaderIfNotExists(g_.header).appendBodyIfNotExists(g_.body),Array.isArray(z))B.buffers().attribute("aFillColor",qc(z).size(4));else if(typeof z=="function"){if(!Z)return;O.value(z),B.buffers().attribute("aFillColor",O)}else throw new Error("Expected value to be an array or function, received ".concat(z));Z=!1};return H.value=function(){return arguments.length?(z!==(arguments.length<=0?void 0:arguments[0])&&(z=arguments.length<=0?void 0:arguments[0],Z=!0),H):z},E(H,O,"data"),H},Fh=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,1],O=yn().size(4),z=I,Z=!0,H=function(B){if(B.vertexShader().appendHeaderIfNotExists(Ah.header).appendBodyIfNotExists(Ah.body),B.fragmentShader().appendHeaderIfNotExists(__.header).appendBodyIfNotExists(__.body),Array.isArray(z))B.buffers().attribute("aStrokeColor",qc(z).size(4));else if(typeof z=="function"){if(!Z)return;O.value(z),B.buffers().attribute("aStrokeColor",O)}else throw new Error("Expected value to be an array or function, received ".concat(z));Z=!1};return H.value=function(){return arguments.length?(z!==(arguments.length<=0?void 0:arguments[0])&&(z=arguments.length<=0?void 0:arguments[0],Z=!0),H):z},E(H,O,"data"),H},Jp=function(){var I=Ui(),O=Ts(0,1),z=O.offset(1),Z=Ts(0,1),H=Z.offset(1),K=Ts(0,1).type(Ln.UNSIGNED_BYTE),B=K.offset(1),q=Ba().crossValueAttribute(O).crossNextValueAttribute(z).mainValueAttribute(Z).mainNextValueAttribute(H).definedAttribute(K).definedNextAttribute(B),X=function(Fe,Ge){return!1},ee=dl,oe=[],pe=null,_e=null,Ce=function(Fe){var Ge=ee(I.xScale()),it=ee(I.yScale()),at=!X(oe,Fe);at&&(oe=Fe,K.value(function(ot,dt){return I.defined()(ot,dt)}).data(Fe)),(at||Ge.scale!==pe)&&(pe=Ge.scale,I.orient()==="vertical"?O.value(function(ot,dt){return Ge.scale(I.crossValue()(ot,dt))}).data(Fe):O.value(function(ot,dt){return Ge.scale(I.mainValue()(ot,dt))}).data(Fe)),(at||it.scale!==_e)&&(_e=it.scale,I.orient()==="vertical"?Z.value(function(ot,dt){return it.scale(I.mainValue()(ot,dt))}).data(Fe):Z.value(function(ot,dt){return it.scale(I.crossValue()(ot,dt))}).data(Fe)),q.xScale(Ge.webglScale).yScale(it.webglScale).decorate(function(ot){return I.decorate()(ot,Fe,0)}),q(Fe.length)};return Ce.equals=function(){return arguments.length?(X=arguments.length<=0?void 0:arguments[0],Ce):X},Ce.scaleMapper=function(){return arguments.length?(ee=arguments.length<=0?void 0:arguments[0],Ce):ee},P(Ce,I,V("baseValue","bandwidth","align")),E(Ce,q,"context","lineWidth","pixelRatio"),Ce},gi=function(){var I=u.symbol(),O=Ui(),z=rn("g","point"),Z=function(B){return"translate("+B[0]+", "+B[1]+")"},H=function(B){un(B)&&z.transition(B),B.each(function(q,X,ee){var oe=q.filter(O.defined()),pe=z(a.select(ee[X]),oe);pe.enter().attr("transform",function(_e,Ce){return Z(O.values(_e,Ce).origin)}).attr("fill",Ke.gray).attr("stroke",Ke.black).append("path"),pe.attr("transform",function(_e,Ce){return Z(O.values(_e,Ce).origin)}).select("path").attr("d",I),O.decorate()(pe,q,X)})};return P(H,O,V("baseValue","bandwidth","align")),E(H,z,"key"),E(H,I,"type","size"),H},pl=function(){var I=u.symbol(),O=Ui(),z=function(H){var K=H.filter(O.defined()),B=I.context();K.forEach(function(q,X){B.save();var ee=O.values(q,X);B.translate(ee.origin[0],ee.origin[1]),B.beginPath(),B.strokeStyle=Ke.black,B.fillStyle=Ke.gray,O.decorate()(B,q,X),I(q,X),B.fill(),B.stroke(),B.closePath(),B.restore()})};return P(z,O,V("baseValue","bandwidth","align")),E(z,I,"size","type","context"),z},Xo=function(){var I=Ui(),O=vn(64),z=u.symbolCircle,Z=yn(),H=yn(),K=yn().type(Ln.UNSIGNED_SHORT),B=yn().type(Ln.UNSIGNED_BYTE),q=Oh().crossValueAttribute(Z).mainValueAttribute(H).sizeAttribute(K).definedAttribute(B),X=function(Fe,Ge){return!1},ee=dl,oe=[],pe=null,_e=null,Ce=function(Fe){var Ge=ee(I.xScale()),it=ee(I.yScale()),at=!X(oe,Fe);at&&(oe=Fe,K.value(function(ot,dt){return O(ot,dt)}).data(Fe),B.value(function(ot,dt){return I.defined()(ot,dt)}).data(Fe)),(at||Ge.scale!==pe)&&(pe=Ge.scale,I.orient()==="vertical"?Z.value(function(ot,dt){return Ge.scale(I.crossValue()(ot,dt))}).data(Fe):Z.value(function(ot,dt){return Ge.scale(I.mainValue()(ot,dt))}).data(Fe)),(at||it.scale!==_e)&&(_e=it.scale,I.orient()==="vertical"?H.value(function(ot,dt){return it.scale(I.mainValue()(ot,dt))}).data(Fe):H.value(function(ot,dt){return it.scale(I.crossValue()(ot,dt))}).data(Fe)),q.xScale(Ge.webglScale).yScale(it.webglScale).type(Qp(z)).decorate(function(ot){return I.decorate()(ot,Fe,0)}),q(Fe.length)};return Ce.size=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),Ce):O},Ce.type=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Ce):z},Ce.equals=function(){return arguments.length?(X=arguments.length<=0?void 0:arguments[0],Ce):X},Ce.scaleMapper=function(){return arguments.length?(ee=arguments.length<=0?void 0:arguments[0],Ce):ee},P(Ce,I,V("baseValue","bandwidth","align")),E(Ce,q,"context","pixelRatio"),Ce},Gc=function(){var I=Dt().x(0).y(0),O=Ui(),z=rn("g","bar"),Z=function(X){return O.orient()==="vertical"?X.height:X.width},H=function(X){return O.orient()==="vertical"?X.width:X.height},K=function(X){return"translate("+X[0]+", "+X[1]+")"},B=function(X){un(X)&&z.transition(X),X.each(function(ee,oe,pe){var _e=O.orient();if(_e!=="vertical"&&_e!=="horizontal")throw new Error("The bar series does not support an orientation of "+_e);var Ce=ee.filter(O.defined()),Be=Ce.map(O.values);I.width(0).height(0),O.orient()==="vertical"?(I.verticalAlign("top"),I.horizontalAlign("center")):(I.horizontalAlign("right"),I.verticalAlign("center"));var Fe=z(a.select(pe[oe]),Ce);Fe.enter().attr("transform",function(Ge,it){return K(Be[it].baseOrigin)}).attr("class","bar "+O.orient()).attr("fill",Ke.darkGray).append("path").attr("d",function(Ge,it){return H(I)(Be[it].width),I([Ge])}),Fe.attr("transform",function(Ge,it){return K(Be[it].origin)}).select("path").attr("d",function(Ge,it){return H(I)(Be[it].width),Z(I)(-Be[it].height),I([Ge])}),O.decorate()(Fe,Ce,oe)})};return P(B,O),E(B,z,"key"),B},uf=function(){var I=Ui(),O=Dt().x(0).y(0),z=function(B){return I.orient()==="vertical"?B.height:B.width},Z=function(B){return I.orient()==="vertical"?B.width:B.height},H=function(B){var q=O.context(),X=B.filter(I.defined()),ee=X.map(I.values);I.orient()==="vertical"?(O.verticalAlign("top"),O.horizontalAlign("center")):(O.horizontalAlign("right"),O.verticalAlign("center")),ee.forEach(function(oe,pe){q.save(),q.beginPath(),q.translate(oe.origin[0],oe.origin[1]),q.fillStyle=Ke.darkGray,q.strokeStyle="transparent",I.decorate()(q,oe.d,pe),z(O)(-oe.height),Z(O)(oe.width),O([oe]),q.fill(),q.stroke(),q.closePath(),q.restore()})};return P(H,I),E(H,O,"context"),H},Bh=function(){var I=Ui(),O=yn(),z=yn(),Z=yn(),H=yn().type(Ln.UNSIGNED_SHORT),K=yn().type(Ln.UNSIGNED_BYTE),B=Fn().crossValueAttribute(O).mainValueAttribute(z).baseValueAttribute(Z).bandwidthAttribute(H).definedAttribute(K),q=function(Be,Fe){return!1},X=dl,ee=[],oe=null,pe=null,_e=function(Be){if(I.orient()!=="vertical")throw new Error("Unsupported orientation ".concat(I.orient()));var Fe=X(I.xScale()),Ge=X(I.yScale()),it=!q(ee,Be);it&&(ee=Be,H.value(function(at,ot){return I.bandwidth()(at,ot)}).data(Be),K.value(function(at,ot){return I.defined()(at,ot)}).data(Be)),(it||Fe.scale!==oe)&&(oe=Fe.scale,O.value(function(at,ot){return Fe.scale(I.crossValue()(at,ot))}).data(Be)),(it||Ge.scale!==pe)&&(pe=Ge.scale,Z.value(function(at,ot){return Ge.scale(I.baseValue()(at,ot))}).data(Be),z.value(function(at,ot){return Ge.scale(I.mainValue()(at,ot))}).data(Be)),B.xScale(Fe.webglScale).yScale(Ge.webglScale).decorate(function(at){return I.decorate()(at,Be,0)}),B(Be.length)};return _e.equals=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],_e):q},_e.scaleMapper=function(){return arguments.length?(X=arguments.length<=0?void 0:arguments[0],_e):X},P(_e,I,V("align")),E(_e,B,"context","pixelRatio"),_e},ja=function(){var I=function(X){return X.high},O=function(X){return X.low},z=function(X){return X.cross},Z="vertical",H="center",K=function(){return 5},B=Ai({decorate:function(){},defined:function(X,ee){return Vn(O,I,z)(X,ee)},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()});return B.values=function(q,X){var ee=K(q,X),oe=Lo(H,ee),pe=B.xScale(),_e=B.yScale();if(Z==="vertical"){var Ce=_e(I(q,X));return{origin:[pe(z(q,X))+oe,Ce],high:0,low:_e(O(q,X))-Ce,width:ee}}else{var Be=pe(O(q,X));return{origin:[Be,_e(z(q,X))+oe],high:pe(I(q,X))-Be,low:0,width:ee}}},B.xValues=function(){return Z==="vertical"?[z]:[I,O]},B.yValues=function(){return Z!=="vertical"?[z]:[I,O]},B.orient=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.lowValue=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),B):O},B.highValue=function(){return arguments.length?(I=vn(arguments.length<=0?void 0:arguments[0]),B):I},B.crossValue=function(){return arguments.length?(z=vn(arguments.length<=0?void 0:arguments[0]),B):z},B.bandwidth=function(){return arguments.length?(K=vn(arguments.length<=0?void 0:arguments[0]),B):K},B.align=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B},ff=function(){var I=ja(),O=rn("g","error-bar"),z=Sr().value(0),Z=function(q){return function(X){return un(q)?X.transition(q):X}},H=function(q){return"translate("+q.origin[0]+", "+q.origin[1]+")"},K=function(q){un(q)&&O.transition(q);var X=Z(q);q.each(function(ee,oe,pe){var _e=ee.filter(I.defined()),Ce=_e.map(I.values),Be=O(a.select(pe[oe]),_e);Be.enter().attr("stroke",Ke.black).attr("fill",Ke.gray).attr("transform",function(Fe,Ge){return H(I.values(Fe,Ge))+" scale(1e-6, 1)"}).append("path"),z.orient(I.orient()),Be.each(function(Fe,Ge,it){var at=Ce[Ge];z.high(at.high).low(at.low).width(at.width),X(a.select(it[Ge])).attr("transform",H(at)+" scale(1)").select("path").attr("d",z([Fe]))}),I.decorate()(Be,ee,oe)})};return P(K,I),E(K,O,"key"),K},Hc=function(){var I=ja(),O=Sr().value(0),z=function(H){var K=H.filter(I.defined()),B=O.context();O.orient(I.orient()),K.forEach(function(q,X){B.save();var ee=I.values(q,X);B.translate(ee.origin[0],ee.origin[1]),B.beginPath(),B.strokeStyle=Ke.black,B.fillStyle=Ke.gray,I.decorate()(B,q,X),O.high(ee.high).width(ee.width).low(ee.low)([q]),B.fill(),B.stroke(),B.closePath(),B.restore()})};return P(z,I),E(z,O,"context"),z},w_=function(){var I=ja(),O=yn(),z=yn(),Z=yn(),H=yn().type(Ln.UNSIGNED_SHORT),K=yn().type(Ln.UNSIGNED_BYTE),B=x_().crossValueAttribute(O).highValueAttribute(z).lowValueAttribute(Z).bandwidthAttribute(H).definedAttribute(K),q=function(Be,Fe){return!1},X=dl,ee=[],oe=null,pe=null,_e=function(Be){if(I.orient()!=="vertical")throw new Error("Unsupported orientation ".concat(I.orient()));var Fe=X(I.xScale()),Ge=X(I.yScale()),it=!q(ee,Be);it&&(ee=Be,H.value(function(at,ot){return I.bandwidth()(at,ot)}).data(Be),K.value(function(at,ot){return I.defined()(at,ot)}).data(Be)),(it||Fe.scale!==oe)&&(oe=Fe.scale,O.value(function(at,ot){return Fe.scale(I.crossValue()(at,ot))}).data(Be)),(it||Ge.scale!==pe)&&(pe=Ge.scale,z.value(function(at,ot){return Ge.scale(I.highValue()(at,ot))}).data(Be),Z.value(function(at,ot){return Ge.scale(I.lowValue()(at,ot))}).data(Be)),B.xScale(Fe.webglScale).yScale(Ge.webglScale).decorate(function(at){return I.decorate()(at,Be,0)}),B(Be.length)};return _e.equals=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],_e):q},_e.scaleMapper=function(){return arguments.length?(X=arguments.length<=0?void 0:arguments[0],_e):X},P(_e,I,V("align")),E(_e,B,"context","lineWidth","pixelRatio"),_e},A_=function(){var I=Ui(),O=u.area(),z=rn("path","area"),Z=function(K){un(K)&&z.transition(K),O.defined(I.defined()),K.each(function(B,q,X){var ee=B.map(I.values);O.x(function(_e,Ce){return ee[Ce].transposedX}).y(function(_e,Ce){return ee[Ce].transposedY});var oe=I.orient()==="vertical"?"y":"x";O[oe+"0"](function(_e,Ce){return ee[Ce].y0}),O[oe+"1"](function(_e,Ce){return ee[Ce].y});var pe=z(a.select(X[q]),[B]);pe.enter().attr("fill",Ke.gray),pe.attr("d",O),I.decorate()(pe,B,q)})};return P(Z,I,V("bandwidth","align")),E(Z,z,"key"),E(Z,O,"curve"),Z},M_=function(){var I=Ui(),O=u.area(),z=function(H){var K=O.context();O.defined(I.defined());var B=H.map(I.values);O.x(function(X,ee){return B[ee].transposedX}).y(function(X,ee){return B[ee].transposedY});var q=I.orient()==="vertical"?"y":"x";O[q+"0"](function(X,ee){return B[ee].y0}),O[q+"1"](function(X,ee){return B[ee].y}),K.beginPath(),K.fillStyle=Ke.gray,K.strokeStyle="transparent",I.decorate()(K,H),O(H),K.fill(),K.stroke(),K.closePath()};return P(z,I,V("bandwidth","align")),E(z,O,"curve","context"),z},S_=function(){var I=Ui(),O=Ts(0,1),z=O.offset(1),Z=Ts(0,1),H=Z.offset(1),K=Ts(0,1),B=K.offset(1),q=Ts(0,1).type(Ln.UNSIGNED_BYTE),X=q.offset(1),ee=Zp().crossValueAttribute(O).crossNextValueAttribute(z).mainValueAttribute(Z).mainNextValueAttribute(H).baseValueAttribute(K).baseNextValueAttribute(B).definedAttribute(q).definedNextAttribute(X),oe=function(it,at){return!1},pe=dl,_e=[],Ce=null,Be=null,Fe=function(it){if(I.orient()!=="vertical")throw new Error("Unsupported orientation ".concat(I.orient()));var at=pe(I.xScale()),ot=pe(I.yScale()),dt=!oe(_e,it);dt&&(_e=it,q.value(function(Nt,or){return I.defined()(Nt,or)}).data(it)),(dt||at.scale!==Ce)&&(Ce=at.scale,O.value(function(Nt,or){return at.scale(I.crossValue()(Nt,or))}).data(it)),(dt||ot.scale!==Be)&&(Be=ot.scale,K.value(function(Nt,or){return ot.scale(I.baseValue()(Nt,or))}).data(it),Z.value(function(Nt,or){return ot.scale(I.mainValue()(Nt,or))}).data(it)),ee.xScale(at.webglScale).yScale(ot.webglScale).decorate(function(Nt){return I.decorate()(Nt,it,0)}),ee(it.length)};return Fe.equals=function(){return arguments.length?(oe=arguments.length<=0?void 0:arguments[0],Fe):oe},Fe.scaleMapper=function(){return arguments.length?(pe=arguments.length<=0?void 0:arguments[0],Fe):pe},P(Fe,I,V("bandwidth","align")),E(Fe,ee,"context","pixelRatio"),Fe},jh=function(){var I,O=function(oe){return oe.date},z=function(oe){return oe.open},Z=function(oe){return oe.high},H=function(oe){return oe.low},K=function(oe){return oe.close},B=function(){return 5},q="center",X=function(oe,pe){return I.xScale()(O(oe,pe))};return I=Ai({decorate:function(){},defined:function(oe,pe){return Vn(O,z,H,Z,K)(oe,pe)},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()}),I.values=function(ee,oe){var pe=K(ee,oe),_e=z(ee,oe),Ce=B(ee,oe),Be=Lo(q,Ce),Fe="";return pe>_e?Fe="up":pe<_e&&(Fe="down"),{cross:X(ee,oe)+Be,open:I.yScale()(_e),high:I.yScale()(Z(ee,oe)),low:I.yScale()(H(ee,oe)),close:I.yScale()(pe),width:Ce,direction:Fe}},I.xValues=function(){return[O]},I.yValues=function(){return[z,Z,H,K]},I.crossValue=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],I):O},I.openValue=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],I):z},I.highValue=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],I):Z},I.lowValue=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],I):H},I.yValue=I.closeValue=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],I):K},I.bandwidth=function(){return arguments.length?(B=vn(arguments.length<=0?void 0:arguments[0]),I):B},I.align=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],I):q},I},Hs=function(I,O){var z=jh(),Z=rn("g",O),H=function(X){return"translate("+X.cross+", "+X.high+")"},K=function(X){return function(ee){return un(X)?ee.transition(X):ee}},B=function(X){un(X)&&Z.transition(X);var ee=K(X);X.each(function(oe,pe,_e){var Ce=oe.filter(z.defined()),Be=Z(a.select(_e[pe]),Ce);Be.enter().attr("transform",function(Fe,Ge){return H(z.values(Fe,Ge))+" scale(1e-6, 1)"}).append("path"),Be.each(function(Fe,Ge,it){var at=z.values(Fe,Ge),ot=at.direction==="up"?Ke.green:Ke.red,dt=ee(a.select(it[Ge])).attr("class",O+" "+at.direction).attr("stroke",ot).attr("fill",ot).attr("transform",function(){return H(at)+" scale(1)"});I.x(0).width(at.width).open(function(){return at.open-at.high}).high(0).low(function(){return at.low-at.high}).close(function(){return at.close-at.high}),dt.select("path").attr("d",I([Fe]))}),z.decorate()(Be,oe,pe)})};return E(B,Z,"key"),P(B,z),B},hf=function(){return Hs(Lt(),"candlestick")},Ko=function(I){var O=jh(),z=function(H){var K=H.filter(O.defined()),B=I.context();K.forEach(function(q,X){B.save();var ee=O.values(q,X);B.translate(ee.cross,ee.high),B.beginPath(),I.x(0).open(function(){return ee.open-ee.high}).width(ee.width).high(0).low(function(){return ee.low-ee.high}).close(function(){return ee.close-ee.high})([q]);var oe=ee.direction==="up"?Ke.green:Ke.red;B.strokeStyle=oe,B.fillStyle=oe,O.decorate()(B,q,X),B.fill(),B.stroke(),B.closePath(),B.restore()})};return E(z,I,"context"),P(z,O),z},df=function(){return Ko(Lt())},em=function(I){var O=jh(),z=yn(),Z=yn(),H=yn(),K=yn(),B=yn(),q=yn().type(Ln.UNSIGNED_SHORT),X=yn().type(Ln.UNSIGNED_BYTE);I.crossValueAttribute(z).openValueAttribute(Z).highValueAttribute(H).lowValueAttribute(K).closeValueAttribute(B).bandwidthAttribute(q).definedAttribute(X);var ee=function(Ge,it){return!1},oe=dl,pe=[],_e=null,Ce=null,Be=function(Ge){var it=oe(O.xScale()),at=oe(O.yScale()),ot=!ee(pe,Ge);ot&&(pe=Ge,q.value(function(dt,Nt){return O.bandwidth()(dt,Nt)}).data(Ge),X.value(function(dt,Nt){return O.defined()(dt,Nt)}).data(Ge)),(ot||it.scale!==_e)&&(_e=it.scale,z.value(function(dt,Nt){return it.scale(O.crossValue()(dt,Nt))}).data(Ge)),(ot||at.scale!==Ce)&&(Ce=at.scale,Z.value(function(dt,Nt){return at.scale(O.openValue()(dt,Nt))}).data(Ge),H.value(function(dt,Nt){return at.scale(O.highValue()(dt,Nt))}).data(Ge),K.value(function(dt,Nt){return at.scale(O.lowValue()(dt,Nt))}).data(Ge),B.value(function(dt,Nt){return at.scale(O.closeValue()(dt,Nt))}).data(Ge)),I.xScale(it.webglScale).yScale(at.webglScale).decorate(function(dt){return O.decorate()(dt,Ge,0)}),I(Ge.length)};return Be.equals=function(){return arguments.length?(ee=arguments.length<=0?void 0:arguments[0],Be):ee},Be.scaleMapper=function(){return arguments.length?(oe=arguments.length<=0?void 0:arguments[0],Be):oe},P(Be,O,V("align")),E(Be,I,"context","lineWidth","pixelRatio"),Be},T_=function(){return em(hl())},Uh=function(){var I=function(pe){return pe.upperQuartile},O=function(pe){return pe.lowerQuartile},z=function(pe){return pe.high},Z=function(pe){return pe.low},H=function(pe){return pe.value},K=function(pe){return pe.median},B="vertical",q="center",X=function(){return 5},ee=Ai({decorate:function(){},defined:function(pe,_e){return Vn(Z,z,O,I,H,K)(pe,_e)},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()});return ee.values=function(oe,pe){var _e=X(oe,pe),Ce=Lo(q,_e),Be=ee.xScale(),Fe=ee.yScale();if(B==="vertical"){var Ge=Fe(z(oe,pe));return{origin:[Be(H(oe,pe))+Ce,Ge],high:0,upperQuartile:Fe(I(oe,pe))-Ge,median:Fe(K(oe,pe))-Ge,lowerQuartile:Fe(O(oe,pe))-Ge,low:Fe(Z(oe,pe))-Ge,width:_e}}else{var it=Be(Z(oe,pe));return{origin:[it,Fe(H(oe,pe))+Ce],high:Be(z(oe,pe))-it,upperQuartile:Be(I(oe,pe))-it,median:Be(K(oe,pe))-it,lowerQuartile:Be(O(oe,pe))-it,low:0,width:_e}}},ee.xValues=function(){return B==="vertical"?[H]:[I,O,z,Z,K]},ee.yValues=function(){return B!=="vertical"?[H]:[I,O,z,Z,K]},ee.orient=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],ee):B},ee.lowerQuartileValue=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),ee):O},ee.upperQuartileValue=function(){return arguments.length?(I=vn(arguments.length<=0?void 0:arguments[0]),ee):I},ee.lowValue=function(){return arguments.length?(Z=vn(arguments.length<=0?void 0:arguments[0]),ee):Z},ee.highValue=function(){return arguments.length?(z=vn(arguments.length<=0?void 0:arguments[0]),ee):z},ee.crossValue=function(){return arguments.length?(H=vn(arguments.length<=0?void 0:arguments[0]),ee):H},ee.medianValue=function(){return arguments.length?(K=vn(arguments.length<=0?void 0:arguments[0]),ee):K},ee.bandwidth=function(){return arguments.length?(X=vn(arguments.length<=0?void 0:arguments[0]),ee):X},ee.align=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],ee):q},ee},Ua=function(){var I=Uh(),O=rn("g","box-plot"),z=xr().value(0),Z=function(q){return function(X){return un(q)?X.transition(q):X}},H=function(q){return"translate("+q.origin[0]+", "+q.origin[1]+")"},K=function(q){un(q)&&O.transition(q);var X=Z(q);q.each(function(ee,oe,pe){var _e=ee.filter(I.defined()),Ce=O(a.select(pe[oe]),_e);Ce.enter().attr("stroke",Ke.black).attr("fill",Ke.gray).attr("transform",function(Be,Fe){return H(I.values(Be,Fe))+" scale(1e-6, 1)"}).append("path"),z.orient(I.orient()),Ce.each(function(Be,Fe,Ge){var it=I.values(Be,Fe);z.median(it.median).upperQuartile(it.upperQuartile).lowerQuartile(it.lowerQuartile).width(it.width).high(it.high).low(it.low),X(a.select(Ge[Fe])).attr("transform",H(it)).select("path").attr("d",z([Be]))}),I.decorate()(Ce,ee,oe)})};return P(K,I),E(K,O,"key"),E(K,z,"cap"),K},E_=function(){var I=Uh(),O=xr().value(0),z=function(H){var K=H.filter(I.defined()),B=O.context();O.orient(I.orient()),K.forEach(function(q,X){B.save();var ee=I.values(q,X);B.translate(ee.origin[0],ee.origin[1]),B.beginPath(),B.fillStyle=Ke.gray,B.strokeStyle=Ke.black,I.decorate()(B,q,X),O.median(ee.median).upperQuartile(ee.upperQuartile).lowerQuartile(ee.lowerQuartile).high(ee.high).width(ee.width).low(ee.low)([q]),B.fill(),B.stroke(),B.closePath(),B.restore()})};return P(z,I),E(z,O,"cap","context"),z},Es=function(){var I=Uh(),O=yn(),z=yn(),Z=yn(),H=yn(),K=yn(),B=yn(),q=yn().type(Ln.UNSIGNED_SHORT),X=yn().type(Ln.UNSIGNED_SHORT),ee=yn().type(Ln.UNSIGNED_BYTE),oe=li().crossValueAttribute(O).highValueAttribute(z).upperQuartileValueAttribute(Z).medianValueAttribute(H).lowerQuartileValueAttribute(K).lowValueAttribute(B).bandwidthAttribute(q).capAttribute(X).definedAttribute(ee),pe=function(ot,dt){return!1},_e=dl,Ce=[],Be=null,Fe=null,Ge=vn(20),it=function(ot){if(I.orient()!=="vertical")throw new Error("Unsupported orientation ".concat(I.orient()));var dt=_e(I.xScale()),Nt=_e(I.yScale()),or=!pe(Ce,ot);or&&(Ce=ot,q.value(function(br,yr){return I.bandwidth()(br,yr)}).data(ot),X.value(function(br,yr){return Ge(br,yr)}).data(ot),ee.value(function(br,yr){return I.defined()(br,yr)}).data(ot)),(or||dt.scale!==Be)&&(Be=dt.scale,O.value(function(br,yr){return dt.scale(I.crossValue()(br,yr))}).data(ot)),(or||Nt.scale!==Fe)&&(Fe=Nt.scale,z.value(function(br,yr){return Nt.scale(I.highValue()(br,yr))}).data(ot),Z.value(function(br,yr){return Nt.scale(I.upperQuartileValue()(br,yr))}).data(ot),H.value(function(br,yr){return Nt.scale(I.medianValue()(br,yr))}).data(ot),K.value(function(br,yr){return Nt.scale(I.lowerQuartileValue()(br,yr))}).data(ot),B.value(function(br,yr){return Nt.scale(I.lowValue()(br,yr))}).data(ot)),oe.xScale(dt.webglScale).yScale(Nt.webglScale).decorate(function(br){return I.decorate()(br,ot,0)}),oe(ot.length)};return it.cap=function(){return arguments.length?(Ge=vn(arguments.length<=0?void 0:arguments[0]),it):Ge},it.equals=function(){return arguments.length?(pe=arguments.length<=0?void 0:arguments[0],it):pe},it.scaleMapper=function(){return arguments.length?(_e=arguments.length<=0?void 0:arguments[0],it):_e},P(it,I,V("align")),E(it,oe,"context","lineWidth","pixelRatio"),it},Va=function(){return Hs(Ct(),"ohlc")},Vh=function(){return Ko(Ct())},Wa=function(){return em(qp())},Xs=function(){var I=[],O=function(K){return K},z=function(K,B){return B},Z=Ai({decorate:function(){},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()});return Z.xValues=function(){return I.map(function(H){return H.xValues()}).reduce(function(H,K){return H.concat(K)})},Z.yValues=function(){return I.map(function(H){return H.yValues()}).reduce(function(H,K){return H.concat(K)})},Z.mapping=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Z):O},Z.key=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z):z},Z.series=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},Z},tm=function(){var I=Xs(),O=rn("g"),z=rn("g","multi"),Z=function(K){un(K)&&(z.transition(K),O.transition(K));var B=I.mapping(),q=I.series(),X=I.xScale(),ee=I.yScale();K.each(function(oe,pe,_e){var Ce=z(a.select(_e[pe]),q);Ce.each(function(Be,Fe,Ge){Be.xScale(X).yScale(ee);var it=B(oe,Fe,q),at=O(a.select(Ge[Fe]),[it]);at.call(Be)}),Ce.selection().order(),I.decorate()(Ce,oe,pe)})};return P(Z,I),E(Z,z,"key"),Z},pf=function(){var I=null,O=Xs(),z=function(H){var K=O.mapping(),B=O.series(),q=O.xScale(),X=O.yScale();B.forEach(function(ee,oe){var pe=K(H,oe,B);ee.context(I).xScale(q).yScale(X);var _e;ee.decorate?(_e=ee.decorate(),ee.decorate(function(Ce,Be,Fe){O.decorate()(Ce,H,oe),_e(Ce,Be,Fe)})):O.decorate()(I,H,oe),ee(pe),_e&&ee.decorate(_e)})};return z.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],z):I},P(z,O),z},rm=function(){var I=null,O=1,z=Xs(),Z=function(K){var B=z.mapping(),q=z.series(),X=z.xScale(),ee=z.yScale();q.forEach(function(oe,pe){var _e=B(K,pe,q);oe.context(I).pixelRatio(O).xScale(X).yScale(ee);var Ce;oe.decorate?(Ce=oe.decorate(),oe.decorate(function(Be,Fe,Ge){z.decorate()(Be,K,pe),Ce(Be,Fe,Ge)})):z.decorate()(I,K,pe),oe(_e),Ce&&oe.decorate(Ce)})};return Z.context=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},Z.pixelRatio=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Z):O},P(Z,z),Z},mf=function(I){var O=function(){return 50},z="center",Z=r.scaleBand(),H=Ai({decorate:function(){},xScale:r.scaleLinear(),yScale:r.scaleLinear()});return H.offsetScaleForDatum=function(K,B,q){var X=O(B,q),ee=Lo(z,X),oe=X/2;return Z.domain(t.range(0,K.length)).range([-oe+ee,oe+ee])},H.bandwidth=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),H):O},H.align=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],H):z},P(H,Z,j({paddingInner:"paddingOuter"})),H},Xc=function(I){var O=mf(),z=rn("g","grouped"),Z=function(K){un(K)&&z.transition(K),K.each(function(B,q,X){var ee=z(a.select(X[q]),B);ee.enter().append("g"),ee.select("g").each(function(oe,pe,_e){var Ce=a.select(_e[pe]),Be=I.orient()!=="horizontal",Fe=function(it,at){var ot=O.offsetScaleForDatum(B,it,at),dt=Be?O.xScale():O.yScale();return dt(it)+ot(pe)+ot.bandwidth()/2};Be?(I.xScale(Fe),I.yScale(O.yScale())):(I.yScale(Fe),I.xScale(O.xScale())),I.bandwidth&&I.bandwidth(function(Ge,it){return O.offsetScaleForDatum(B,Ge,it).bandwidth()}),I.decorate(function(Ge,it){return O.decorate()(Ge,it,pe)}),Ce.call(I)})})};return P(Z,I,V("decorate","xScale","yScale")),P(Z,O,V("offsetScaleForDatum")),Z};function Za(I){var O=mf(),z=function(H){H.forEach(function(K,B){var q=I.orient()!=="horizontal",X=function(oe,pe){var _e=O.offsetScaleForDatum(H,oe,pe),Ce=q?O.xScale():O.yScale();return Ce(oe)+_e(B)+_e.bandwidth()/2};q?(I.xScale(X),I.yScale(O.yScale())):(I.yScale(X),I.xScale(O.xScale())),I.bandwidth&&I.bandwidth(function(ee,oe){return O.offsetScaleForDatum(H,ee,oe).bandwidth()}),I.decorate(function(ee,oe){return O.decorate()(ee,oe,B)}),I(K)})};return P(z,I,V("decorate","xScale","yScale")),P(z,O,V("offsetScaleForDatum")),z}var _r=function(){var I="vertical",O=bt(),z=tm(),Z=function(K){return K.each(function(B,q,X){I==="vertical"?z.series(B[0].map(function(ee){return O})).mapping(function(ee,oe){return ee.map(function(pe){return pe[oe]})}):z.series(B.map(function(ee){return O})).mapping(function(ee,oe){return ee[oe]}),a.select(X[q]).call(z)})};return Z.series=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Z):O},Z.orient=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},P(Z,z,V("series","mapping")),Z},Wh=function(){var I="vertical",O=Ft(),z=pf(),Z=function(K){I==="vertical"?z.series(K[0].map(function(B){return O})).mapping(function(B,q){return B.map(function(X){return X[q]})}):z.series(K.map(function(B){return O})).mapping(function(B,q){return B[q]}),z(K)};return Z.series=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Z):O},Z.orient=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},P(Z,z,V("series","mapping")),Z},ml=function(){var I="vertical",O=function(){return Jp()},z=rm(),Z=[],H=function(B){if(I==="vertical"){var q=Z;Z=B[0].map(function(ee,oe){return oe<q.length?q[oe]:O()}),z.series(Z).mapping(function(ee,oe){return ee.map(function(pe){return pe[oe]})})}else{var X=Z;Z=B.map(function(ee,oe){return oe<X.length?X[oe]:O()}),z.series(Z).mapping(function(ee,oe){return ee[oe]})}z(B)};return H.series=function(){for(var K=arguments.length,B=new Array(K),q=0;q<K;q++)B[q]=arguments[q];return B.length?(typeof B[0].xScale=="function"&&typeof B[0].yScale=="function"?O=function(){return B[0]}:O=B[0],Z=[],H):O},H.orient=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z=[],H):I},P(H,z,V("series","mapping")),H},Kc=function(O){return O.sort(t.ascending).filter(function(z,Z,H){return H.indexOf(z,Z+1)===-1})},I_=function(I){var O=.75,z=function(B){if(B.length<=1)return 10;B=Kc(B);var q=t.pairs(B).map(function(ee){return Math.abs(ee[0]-ee[1])}),X=t.min(q);return O*X},Z=function(B,q,X){if(B.bandwidth)return B.bandwidth();var ee,oe=Array.isArray(q)?(ee=[]).concat.apply(ee,dr(q)):q,pe=oe.filter(I.defined()).map(X()).map(B),_e=z(pe);return _e},H=function(B){var q=function(ee){if(I.xBandwidth&&I.yBandwidth)I.xBandwidth(Z(I.xScale(),ee,I.xValue)),I.yBandwidth(Z(I.yScale(),ee,I.yValue));else{var oe=I.orient&&I.orient()==="horizontal"?I.yScale():I.xScale();I.bandwidth(Z(oe,ee,I.crossValue))}};B instanceof a.selection?B.each(function(X,ee,oe){q(X),I(a.select(oe[ee]))}):(q(B),I(B))};return P(H,I),H.widthFraction=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],H):O},H},ir=function(){var I=function(X){return X.x},O=function(X){return X.y},z=function(X){return X.color},Z=function(){return 5},H=function(){return 5},K=h.interpolateViridis,B=Ai({decorate:function(){},defined:function(X,ee){return Vn(I,O,z)(X,ee)},xScale:r.scaleIdentity(),yScale:r.scaleIdentity()});return B.pathGenerator=Dt().x(0).y(0),B.colorScale=function(q){var X=q.map(z);return r.scaleLinear().domain([t.min(X),t.max(X)])},B.values=function(q,X){return{x:B.xScale()(I(q,X)),y:B.yScale()(O(q,X)),colorValue:z(q,X),width:H(q,X),height:Z(q,X)}},B.xValues=function(){return[I]},B.yValues=function(){return[O]},B.xValue=function(){return arguments.length?(I=vn(arguments.length<=0?void 0:arguments[0]),B):I},B.yValue=function(){return arguments.length?(O=vn(arguments.length<=0?void 0:arguments[0]),B):O},B.colorValue=function(){return arguments.length?(z=vn(arguments.length<=0?void 0:arguments[0]),B):z},B.colorInterpolate=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],B):K},B.xBandwidth=function(){return arguments.length?(H=vn(arguments.length<=0?void 0:arguments[0]),B):H},B.yBandwidth=function(){return arguments.length?(Z=vn(arguments.length<=0?void 0:arguments[0]),B):Z},P(B,B.pathGenerator,j({horizontalAlign:"xAlign",verticalAlign:"yAlign"})),B},nm=function(){var I=ir(),O=rn("g","box"),z=function(K){return"translate("+K.x+", "+K.y+")"},Z=function(K){K.each(function(B,q,X){var ee=B.filter(I.defined()),oe=I.colorValue(),pe=I.colorInterpolate(),_e=I.colorScale(ee),Ce=O(a.select(X[q]),ee);Ce.enter().append("path").attr("stroke","transparent"),Ce.attr("transform",function(Be,Fe){return z(I.values(Be,Fe))}).select("path").attr("d",function(Be,Fe){return I.pathGenerator.width(I.values(Be,Fe).width).height(I.values(Be,Fe).height)([Be])}).attr("fill",function(Be,Fe){return pe(_e(oe(Be,Fe)))}),I.decorate()(Ce,B,q)})};return P(Z,I),Z},im=function(){var I=ir(),O=function(Z){var H=Z.filter(I.defined()),K=I.colorInterpolate(),B=I.colorScale(H),q=I.pathGenerator.context();H.forEach(function(X,ee){q.save(),q.beginPath();var oe=I.values(X,ee);q.translate(oe.x,oe.y),q.fillStyle=K(B(oe.colorValue)),q.strokeStyle="transparent",I.decorate()(q,X,ee),I.pathGenerator.height(oe.height).width(oe.width)([X]),q.fill(),q.stroke(),q.closePath(),q.restore()})};return E(O,I.pathGenerator,"context"),P(O,I),O},gl=function(I){return typeof I=="function"?I:function(){return I}},om=function(){var I=r.scaleIdentity(),O=r.scaleIdentity(),z="horizontal",Z=function(oe){return oe.from},H=function(oe){return oe.to},K=function(){},B=rn("g","annotation-band"),q=Dt().horizontalAlign("center").verticalAlign("center").x(0).y(0),X=function(oe){if(un(oe)&&B.transition(oe),z!=="horizontal"&&z!=="vertical")throw new Error("Invalid orientation");var pe=z==="horizontal",_e=pe?function(dt,Nt){return"translate(".concat(dt,", ").concat(Nt,")")}:function(dt,Nt){return"translate(".concat(Nt,", ").concat(dt,")")},Ce=pe?I:O,Be=pe?O:I,Fe=Ce.range(),Ge=Fe[1]-Fe[0],it=pe?"height":"width",at=pe?"width":"height",ot=function(){return _e((Fe[1]+Fe[0])/2,(Be(H.apply(void 0,arguments))+Be(Z.apply(void 0,arguments)))/2)};q[at](Ge),q[it](function(){return Be(H.apply(void 0,arguments))-Be(Z.apply(void 0,arguments))}),oe.each(function(dt,Nt,or){var br=B(a.select(or[Nt]),dt);br.enter().attr("transform",ot).append("path").classed("band",!0),br.attr("class","annotation-band ".concat(z)).attr("transform",ot).select("path").attr("d",function(yr,Zr){return q([yr],Zr)}),K(br,dt,Nt)})};return X.xScale=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],X):I},X.yScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],X):O},X.orient=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],X):z},X.decorate=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],X):K},X.fromValue=function(){return arguments.length?(Z=gl(arguments.length<=0?void 0:arguments[0]),X):Z},X.toValue=function(){return arguments.length?(H=gl(arguments.length<=0?void 0:arguments[0]),X):H},X},C_=function(){var I=r.scaleIdentity(),O=r.scaleIdentity(),z="horizontal",Z=function(ee){return ee.from},H=function(ee){return ee.to},K=function(){},B=Dt().horizontalAlign("right").verticalAlign("top"),q=function(ee){if(z!=="horizontal"&&z!=="vertical")throw new Error("Invalid orientation");var oe=B.context(),pe=z==="horizontal",_e=pe?I:O,Ce=pe?O:I,Be=_e.range(),Fe=Be[1]-Be[0],Ge=pe?"x":"y",it=pe?"y":"x",at=pe?"height":"width",ot=pe?"width":"height";ee.forEach(function(dt,Nt){oe.save(),oe.beginPath(),oe.strokeStyle="transparent",B[it](Ce(Z(dt))),B[Ge](Be[0]),B[ot](Fe),B[at](Ce(H(dt))-Ce(Z(dt))),K(oe,dt,Nt),B.context(oe)([dt],Nt),oe.fill(),oe.stroke(),oe.closePath(),oe.restore()})};return q.xScale=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.yScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],q):O},q.orient=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],q):z},q.decorate=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],q):K},q.fromValue=function(){return arguments.length?(Z=gl(arguments.length<=0?void 0:arguments[0]),q):Z},q.toValue=function(){return arguments.length?(H=gl(arguments.length<=0?void 0:arguments[0]),q):H},E(q,B,"context"),q},Zh=function(){var I=r.scaleIdentity(),O=r.scaleIdentity(),z=function(ee){return ee},Z=z,H=function(){},K="horizontal",B=rn("g","annotation-line"),q=function(ee){if(un(ee)&&B.transition(ee),K!=="horizontal"&&K!=="vertical")throw new Error("Invalid orientation");var oe=K==="horizontal",pe=oe?function(yr,Zr){return"translate(".concat(yr,", ").concat(Zr,")")}:function(yr,Zr){return"translate(".concat(Zr,", ").concat(yr,")")},_e=oe?"x2":"y2",Ce=oe?I:O,Be=oe?O:I,Fe=oe?"left-handle":"bottom-handle",Ge=oe?"right-handle":"top-handle",it=oe?"9":"0",at=oe?"0":"9",ot=oe?"0.32em":"0.71em",dt=oe?"start":"middle",Nt=Ce.range(),or=function(){return pe(Nt[0],Be(z.apply(void 0,arguments)))},br=Nt[1]-Nt[0];ee.each(function(yr,Zr,Ti){var So=B(a.select(Ti[Zr]),yr),Ks=So.enter().attr("transform",or).style("stroke","#bbb");Ks.append("line").attr(_e,br),Ks.append("g").classed(Fe,!0).style("stroke","none"),Ks.append("g").classed(Ge,!0).style("stroke","none").attr("transform",pe(br,0)).append("text").attr("text-anchor",dt).attr("x",it).attr("y",at).attr("dy",ot),So.attr("class","annotation-line ".concat(K)),So.attr("transform",or),So.select("line").attr(_e,br),So.select("g."+Ge).attr("transform",pe(br,0)),So.select("text").text(Z),H(So,yr,Zr)})};return q.xScale=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.yScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],q):O},q.value=function(){return arguments.length?(z=gl(arguments.length<=0?void 0:arguments[0]),q):z},q.label=function(){return arguments.length?(Z=gl(arguments.length<=0?void 0:arguments[0]),q):Z},q.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],q):H},q.orient=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],q):K},q};function k_(){var I=function(Fe){return Fe.x},O=function(Fe){return Fe.y},z=r.scaleIdentity(),Z=r.scaleIdentity(),H=function(){},K=rn("g","annotation-crosshair"),B=gi(),q=Zh(),X=Zh().orient("vertical"),ee=r.scaleIdentity(),oe=r.scaleIdentity(),pe=tm().series([q,X,B]).xScale(ee).yScale(oe).mapping(function(Be){return[Be]}),_e=function(Fe){un(Fe)&&K.transition(Fe),Fe.each(function(Ge,it,at){var ot=K(a.select(at[it]),Ge);ot.enter().style("pointer-events","none"),ee.range(z.range()),oe.range(Z.range()),B.crossValue(I).mainValue(O),q.value(O),X.value(I),ot.call(pe),H(ot,Ge,it)})};_e.x=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],_e):I},_e.y=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],_e):O},_e.xScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],_e):z},_e.yScale=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],_e):Z},_e.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],_e):H};var Ce=N("label");return P(_e,q,Ce,ne("y")),P(_e,X,Ce,ne("x")),_e}var sm=function(){var I=r.scaleIdentity(),O=r.scaleIdentity(),z=function(ee){return ee},Z=z,H=function(){},K="horizontal",B=u.line(),q=function(ee){if(K!=="horizontal"&&K!=="vertical")throw new Error("Invalid orientation");var oe=K==="horizontal",pe=B.context(),_e=oe?I:O,Ce=oe?O:I,Be=_e.domain(),Fe=oe?9:0,Ge=oe?0:9,it=oe?"left":"center",at=oe?"middle":"hanging";ee.forEach(function(ot,dt){pe.save(),pe.beginPath(),pe.strokeStyle="#bbb",pe.fillStyle="#000",pe.textAlign=it,pe.textBaseline=at,H(pe,ot,dt),B.context(pe)(Be.map(function(br){var yr=[_e(br),Ce(z(ot))];return oe?yr:yr.reverse()}));var Nt=oe?_e(Be[1]):Ce(z(ot)),or=oe?Ce(z(ot)):_e(Be[1]);pe.fillText(Z(ot),Nt+Fe,or+Ge),pe.fill(),pe.stroke(),pe.closePath(),pe.restore()})};return q.xScale=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],q):I},q.yScale=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],q):O},q.value=function(){return arguments.length?(z=gl(arguments.length<=0?void 0:arguments[0]),q):z},q.label=function(){return arguments.length?(Z=gl(arguments.length<=0?void 0:arguments[0]),q):Z},q.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],q):H},q.orient=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],q):K},E(q,B,"context"),q},am=function(){var I=function(Ce){return Ce.x},O=function(Ce){return Ce.y},z=r.scaleIdentity(),Z=r.scaleIdentity(),H=pl(),K=sm(),B=sm().orient("vertical"),q=r.scaleIdentity(),X=r.scaleIdentity(),ee=pf().series([K,B,H]).xScale(q).yScale(X).mapping(function(_e){return[_e]}),oe=function(Ce){Ce.forEach(function(Be){q.range(z.range()),X.range(Z.range()),H.crossValue(I).mainValue(O),K.value(O),B.value(I),ee(Be)})};oe.x=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],oe):I},oe.y=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],oe):O},oe.xScale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],oe):z},oe.yScale=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],oe):Z};var pe=N("label","decorate");return P(oe,K,pe,ne("y")),P(oe,B,pe,ne("x")),E(oe,H,"decorate"),E(oe,ee,"context"),oe},$c=function(){var I=r.scaleIdentity(),O=[10],z=null,Z=function(){var K;return z??(I.ticks?(K=I).ticks.apply(K,dr(O)):I.domain())};return Z.scale=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],Z):I},Z.ticks=function(){for(var H=arguments.length,K=new Array(H),B=0;B<H;B++)K[B]=arguments[B];return O=K,Z},Z.tickArguments=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],Z):O},Z.tickValues=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],Z):z},Z},Yh=function(O){return O},lm=function(){var I=function(){},O=function(){},z=$c(),Z=$c(),H=rn("line","gridline-y").key(Yh),K=rn("line","gridline-x").key(Yh),B=function(X){un(X)&&(H.transition(X),K.transition(X)),X.each(function(ee,oe,pe){var _e=pe[oe],Ce=a.select(pe[oe]),Be=z.scale(),Fe=Z.scale(),Ge=_e.__x_scale__||Be;_e.__x_scale__=Be.copy();var it=z(),at=H(Ce,it);at.enter().attr("x1",Ge).attr("x2",Ge).attr("y1",Fe.range()[0]).attr("y2",Fe.range()[1]).attr("stroke","#bbb"),at.attr("x1",Be).attr("x2",Be).attr("y1",Fe.range()[0]).attr("y2",Fe.range()[1]),at.exit().attr("x1",Be).attr("x2",Be),I(at,it,oe);var ot=_e.__y_scale__||Fe;_e.__y_scale__=Fe.copy();var dt=Z(),Nt=K(Ce,dt);Nt.enter().attr("y1",ot).attr("y2",ot).attr("x1",Be.range()[0]).attr("x2",Be.range()[1]).attr("stroke","#bbb"),Nt.attr("y1",Fe).attr("y2",Fe).attr("x1",Be.range()[0]).attr("x2",Be.range()[1]),Nt.exit().attr("y1",Fe).attr("y2",Fe),O(Nt,dt,oe)})};return B.yDecorate=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},B.xDecorate=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],B):I},P(B,H,j({key:"xKey"})),P(B,K,j({key:"yKey"})),P(B,z,ne("x")),P(B,Z,ne("y")),B},$o=function(){var I=function(){},O=function(){},z=$c(),Z=$c(),H=u.line(),K=function(){var q=H.context(),X=z.scale(),ee=Z.scale();z().forEach(function(oe,pe){q.save(),q.beginPath(),q.strokeStyle="#bbb",q.fillStyle="transparent",I(q,oe,pe),H.context(q)(ee.domain().map(function(_e){return[X(oe),ee(_e)]})),q.fill(),q.stroke(),q.closePath(),q.restore()}),Z().forEach(function(oe,pe){q.save(),q.beginPath(),q.strokeStyle="#bbb",q.fillStyle="transparent",O(q,oe,pe),H.context(q)(X.domain().map(function(_e){return[X(_e),ee(oe)]})),q.fill(),q.stroke(),q.closePath(),q.restore()})};return K.yDecorate=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K.xDecorate=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],K):I},P(K,z,ne("x")),P(K,Z,ne("y")),E(K,H,"context"),K},_l=function(O){return O},Qc=function(O,z,Z,H){return O[z]?O[z].apply(O,Z):H},qh=function(O){var z;return(z=O.tickValues())!==null&&z!==void 0?z:Qc(O.scale(),"ticks",O.tickArguments(),O.scale().domain())},Jc=function(O){var z;return(z=O.tickFormat())!==null&&z!==void 0?z:Qc(O.scale(),"tickFormat",O.tickArguments(),_l)},cm=function(O){return O},um=function(O,z){var Z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},H=[10],K=null,B=function(){},q=null,X=6,ee=6,oe=3,pe=u.line(),_e=rn("g","tick").key(cm),Ce=rn("path","domain"),Be=function(){return{offset:[0,ee+oe]}},Fe=function(){return{path:[[0,0],[0,ee]]}},Ge=Z.labelOffset||Be,it=Z.tickPath||Fe,at=function(yr,Zr){var Ti=0;return yr.bandwidth&&(Ti=yr.bandwidth()/2,yr.round()&&(Ti=Math.round(Ti))),function(So){return Zr(yr(So)+Ti,0)}},ot=function(yr,Zr){return Nt()?"translate(".concat(Zr,", ").concat(yr,")"):"translate(".concat(yr,", ").concat(Zr,")")},dt=function(yr){return Nt()?yr.map(function(Zr){return[Zr[1],Zr[0]]}):yr},Nt=function(){return O==="left"||O==="right"},or=function br(yr){un(yr)&&(_e.transition(yr),Ce.transition(yr)),yr.each(function(Zr,Ti,So){var Ks=So[Ti],tu=a.select(Ks);Ks.__scale__||tu.attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",O==="right"?"start":O==="left"?"end":"middle");var mm=Ks.__scale__||z;Ks.__scale__=z.copy();var Ya=qh(br),dn=Jc(br),Cs=O==="bottom"||O==="right"?1:-1,fi=function(jn){var Ei=sr(jn,2),Li=Ei[0],Eo=Ei[1];return[Li,Cs*Eo]},Di=z.range(),co=dt([[Di[0],Cs*X],[Di[0],0],[Di[1],0],[Di[1],Cs*X]]),Vi=Ce(tu,[Zr]);Vi.enter().attr("stroke","#000"),Vi.attr("d",pe(co));var ro=_e(tu,Ya),gm=Ya.map(function(Dr,jn){return Ge(Dr,jn,Ya)}),To=Ya.map(function(Dr,jn){return it(Dr,jn,Ya)});ro.enter().attr("transform",at(mm,ot)).append("path").attr("stroke","#000"),ro.enter().append("text").attr("transform",function(Dr,jn){return ot.apply(void 0,dr(fi(gm[jn].offset)))}).attr("fill","#000"),ro.exit().attr("transform",at(z,ot)),ro.select("path").attr("visibility",function(Dr,jn){return To[jn].hidden&&"hidden"}).attr("d",function(Dr,jn){return pe(dt(To[jn].path.map(fi)))}),ro.select("text").attr("visibility",function(Dr,jn){return gm[jn].hidden&&"hidden"}).attr("transform",function(Dr,jn){return ot.apply(void 0,dr(fi(gm[jn].offset)))}).attr("dy",function(){var Dr="0em";return Nt()?Dr="0.32em":O==="bottom"&&(Dr="0.71em"),Dr}).text(dn),ro.attr("transform",at(z,ot)),B(ro,Zr,Ti)})};return or.tickFormat=function(){return arguments.length?(q=arguments.length<=0?void 0:arguments[0],or):q},or.tickSize=function(){return arguments.length?(ee=X=Number(arguments.length<=0?void 0:arguments[0]),or):ee},or.tickSizeInner=function(){return arguments.length?(ee=Number(arguments.length<=0?void 0:arguments[0]),or):ee},or.tickSizeOuter=function(){return arguments.length?(X=Number(arguments.length<=0?void 0:arguments[0]),or):X},or.tickPadding=function(){return arguments.length?(oe=arguments.length<=0?void 0:arguments[0],or):oe},or.decorate=function(){return arguments.length?(B=arguments.length<=0?void 0:arguments[0],or):B},or.scale=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],or):z},or.ticks=function(){for(var br=arguments.length,yr=new Array(br),Zr=0;Zr<br;Zr++)yr[Zr]=arguments[Zr];return H=[].concat(yr),or},or.tickArguments=function(){return arguments.length?(H=(arguments.length<=0?void 0:arguments[0])==null?[]:dr(arguments.length<=0?void 0:arguments[0]),or):H!==null?H.slice():null},or.tickValues=function(){return arguments.length?(K=(arguments.length<=0?void 0:arguments[0])==null?[]:dr(arguments.length<=0?void 0:arguments[0]),or):K!==null?K.slice():null},or.orient=function(){return O},or},Mo=function(O,z){var Z=!1,H=function(X,ee,oe){var pe=0,_e=K.tickSizeInner()+K.tickPadding(),Ce=!1;if(Z){var Be=z(X),Fe=ee<oe.length-1?z(oe[ee+1]):z.range()[1];pe=(Fe-Be)/2,_e=K.tickPadding(),Ce=ee===oe.length-1&&Be===Fe}return{offset:[pe,_e],hidden:Ce}},K=um(O,z,{labelOffset:H}),B=function(X){return K(X)};return B.tickCenterLabel=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},P(B,K),B},ii=function(O){return Mo("top",O)},gf=function(O){return Mo("bottom",O)},Gh=function(O){return Mo("left",O)},fm=function(O){return Mo("right",O)},_f=function(O,z){var Z=null,H=function(oe,pe,_e){if(z.step)return z.step();var Ce=z(oe);return pe<_e.length-1?z(_e[pe+1])/Ce:(z.range()[1]-Ce)*2},K=function(oe,pe,_e){var Ce=0;return Z?Ce=Z(oe,pe):Ce=H(oe,pe,_e)/2,{path:[[Ce,0],[Ce,q.tickSizeInner()]],hidden:pe===_e.length-1}},B=function(){return{offset:[0,q.tickPadding()]}},q=um(O,z,{labelOffset:B,tickPath:K}),X=function(oe){q(oe)};return X.tickOffset=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],X):Z},P(X,q),X},P_=function(O){return _f("top",O)},Nx=function(O){return _f("bottom",O)},Fo=function(O){return _f("left",O)},Hh=function(O){return _f("right",O)},Rr=function(I){var O=function(Z){var H=qh(I),K=Jc(I),B=H.map(K),q=Z.append("text"),X=B.map(function(pe){return q.text(pe).node().getBBox()}),ee=Math.max.apply(Math,dr(X.map(function(pe){return pe.height}))),oe=Math.max.apply(Math,dr(X.map(function(pe){return pe.width})));return q.remove(),{maxHeight:ee,maxWidth:oe,labelCount:B.length}};return O},Wr=function(I){var O="auto",z=function(){},Z=function(){return I.orient()==="left"||I.orient()==="right"},H=function(){return I.orient()==="top"||I.orient()==="left"?-1:1},K=function(){switch(I.orient()){case"top":case"right":return"start";default:return"end"}},B=function(oe){var pe=Rr(I)(oe),_e=pe.maxHeight,Ce=pe.maxWidth,Be=pe.labelCount,Fe=Be*Ce,Ge;if(O==="auto"){var it=I.scale().range()[1];Ge=it<Fe?90*Math.min(1,(Fe/it-.8)/2):0}else Ge=O;return{rotate:Z()?Math.floor(H()*(90-Ge)):Math.floor(-Ge),maxHeight:_e,maxWidth:Ce,anchor:Ge?K():"middle"}},q=function(oe){var pe=B(oe),_e=pe.rotate,Ce=pe.maxHeight,Be=pe.anchor,Fe=oe.select("text"),Ge=Fe.attr("transform"),it=H()*Math.floor(Ce/2),at=Z()?"translate(".concat(it,", 0)"):"translate(0, ".concat(it,")");Fe.style("text-anchor",Be).attr("transform","".concat(Ge," ").concat(at," rotate(").concat(_e," 0 0)"))},X=function(oe){I(oe)};return I.decorate(function(ee){q(ee),z(ee)}),X.decorate=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],X):z},X.labelRotate=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],X):O},P(X,I,V("decorate")),X},yf=function(I){var O="auto",z=function(){},Z=function(){return I.orient()==="left"||I.orient()==="right"},H=function(){return I.orient()==="top"||I.orient()==="left"?-1:1},K=function(X){var ee=Rr(I)(X),oe=ee.maxHeight,pe=ee.maxWidth,_e=ee.labelCount,Ce=I.scale().range()[1],Be=O==="auto"?Math.floor((Z()?oe:pe)*_e/Ce)+1:O,Fe=X.select("text"),Ge=Fe.attr("transform"),it=function(ot){return Z()?"translate(".concat(ot%Be*pe*H(),", 0)"):"translate(0, ".concat(ot%Be*oe*H(),")")};Fe.attr("transform",function(at,ot){return"".concat(Ge," ").concat(it(ot))})},B=function(X){return I(X)};return I.decorate(function(q){K(q),z(q)}),B.decorate=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],B):z},B.labelOffsetDepth=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],B):O},P(B,I,V("decorate")),B},xf="__d3fc-elements__",rc=function(O){return O[xf]||{}},Ni=function(O,z){return void(O[xf]=z)},hm=function(O){return delete O[xf]},Is=function(O){return O.tagName==="D3FC-GROUP"?[O].concat(dr(O.querySelectorAll("d3fc-canvas, d3fc-group, d3fc-svg"))):[O]},O_=function(O){var z=rc(O),Z=z.width,H=z.height,K=O.useDevicePixelRatio&&window.devicePixelRatio!=null?window.devicePixelRatio:1,B=O.clientWidth*K,q=O.clientHeight*K,X=B!==Z||q!==H,ee=O.children[0];Ni(O,{pixelRatio:K,width:B,height:q,resized:X,child:ee})};if(typeof CustomEvent!="function")throw new Error("d3fc-element depends on CustomEvent. Make sure that you load a polyfill in older browsers. See README.");var nc=function(O){var z=rc(O),Z=new CustomEvent("measure",{detail:z});O.dispatchEvent(Z)},Si=function(O){var z=rc(O),Z=new CustomEvent("draw",{detail:z});O.dispatchEvent(Z)},_i=function(I){var O=I.map(Is).reduce(function(z,Z){return z.concat(Z)});O.forEach(O_),O.forEach(nc),O.forEach(Si)},ic=function(O){return rc(O.ownerDocument).queue||[]},bf=function(O,z){var Z=rc(O.ownerDocument),H=Z.requestId;H==null&&(H=requestAnimationFrame(function(){var K=ic(O);_i(K),vf(O)})),Ni(O.ownerDocument,{queue:z,requestId:H})},vf=function(O){return hm(O.ownerDocument)},yl=function(O,z){var Z=O;do if(Z.parentNode===z)return!0;while(Z=Z.parentNode);return!1},wf=function(I){var O=ic(I),z=O.indexOf(I)>-1;if(!z){var Z=O.some(function(K){return yl(I,K)});if(!Z){var H=O.filter(function(K){return!yl(K,I)});H.push(I),bf(I,H)}}};if(typeof HTMLElement!="function")throw new Error("d3fc-element depends on Custom Elements (v1). Make sure that you load a polyfill in older browsers. See README.");var dm=function(O){O.__measureListener__==null&&(O.__measureListener__=function(z){return O.setMeasurements(z.detail)},O.addEventListener("measure",O.__measureListener__))},eu=function(O){O.__measureListener__!=null&&(O.removeEventListener("measure",O.__measureListener__),O.__measureListener__=null)},Xh=function(I,O){return function(z){wr(H,z);var Z=tr(H);function H(){return rt(this,H),Z.apply(this,arguments)}return kt(H,[{key:"attributeChangedCallback",value:function(B){switch(B){case"use-device-pixel-ratio":this.requestRedraw();break}}},{key:"connectedCallback",value:function(){this.childNodes.length===0&&this.appendChild(I()),dm(this)}},{key:"disconnectedCallback",value:function(){eu(this)}},{key:"setMeasurements",value:function(B){var q=B.width,X=B.height,ee=Rn(this.childNodes),oe=ee[0],pe=ee.slice(1);if(pe.length>0)throw new Error("A d3fc-svg/canvas element must only contain a single svg/canvas element.");O(this,oe,{width:q,height:X})}},{key:"useDevicePixelRatio",get:function(){return this.hasAttribute("use-device-pixel-ratio")&&this.getAttribute("use-device-pixel-ratio")!=="false"},set:function(B){B&&!this.useDevicePixelRatio?this.setAttribute("use-device-pixel-ratio",""):!B&&this.useDevicePixelRatio&&this.removeAttribute("use-device-pixel-ratio"),this.requestRedraw()}},{key:"requestRedraw",value:function(){wf(this)}}],[{key:"observedAttributes",get:function(){return["use-device-pixel-ratio"]}}]),H}(gn(HTMLElement))},pm=function(I){wr(z,I);var O=tr(z);function z(){return rt(this,z),O.apply(this,arguments)}return kt(z,[{key:"setWebglViewport",get:function(){return this.hasAttribute("set-webgl-viewport")&&this.getAttribute("set-webgl-viewport")!=="false"},set:function(H){H&&!this.setWebglViewport?this.setAttribute("set-webgl-viewport",""):!H&&this.setWebglViewport&&this.removeAttribute("set-webgl-viewport"),this.requestRedraw()}}]),z}(Xh(function(){return document.createElement("canvas")},function(I,O,z){var Z=z.width,H=z.height;if(O.setAttribute("width",Z),O.setAttribute("height",H),I.setWebglViewport){var K=O.getContext("webgl");K.viewport(0,0,Z,H)}})),zn=function(O){O.autoResize?M(O):c(O)},M=function(O){O.__autoResizeListener__==null&&(O.__autoResizeListener__=function(){return wf(O)},addEventListener("resize",O.__autoResizeListener__))},c=function(O){O.__autoResizeListener__!=null&&(removeEventListener("resize",O.__autoResizeListener__),O.__autoResizeListener__=null)},m=function(I){wr(z,I);var O=tr(z);function z(){return rt(this,z),O.apply(this,arguments)}return kt(z,[{key:"connectedCallback",value:function(){zn(this)}},{key:"disconnectedCallback",value:function(){c(this)}},{key:"requestRedraw",value:function(){wf(this)}},{key:"autoResize",get:function(){return this.hasAttribute("auto-resize")&&this.getAttribute("auto-resize")!=="false"},set:function(H){H&&!this.autoResize?this.setAttribute("auto-resize",""):!H&&this.autoResize&&this.removeAttribute("auto-resize"),zn(this)}},{key:"attributeChangedCallback",value:function(H){switch(H){case"auto-resize":zn(this);break}}}],[{key:"observedAttributes",get:function(){return["auto-resize"]}}]),z}(gn(HTMLElement)),x=Xh(function(){return document.createElementNS("http://www.w3.org/2000/svg","svg")},function(I,O,z){var Z=z.width,H=z.height;O.setAttribute("viewBox","0 0 ".concat(Z," ").concat(H))}),v="d3fc-canvas,d3fc-svg{position:relative;display:block}d3fc-canvas>canvas,d3fc-svg>svg{position:absolute;height:100%;width:100%}d3fc-svg>svg{overflow:visible}",S=document.createElement("style");if(S.setAttribute("type","text/css"),document.querySelector("head").appendChild(S),S.styleSheet?S.styleSheet.cssText+=v:S.textContent+=v,(typeof customElements>"u"?"undefined":Hr(customElements))!=="object"||typeof customElements.define!="function")throw new Error("d3fc-element depends on Custom Elements (v1). Make sure that you load a polyfill in older browsers. See README.");var L=[],F=function(O,z){customElements.get(O)?L.push(O):customElements.define(O,z)};F("d3fc-canvas",pm),F("d3fc-group",m),F("d3fc-svg",x),L.length>0&&console.warn('The d3fc components "'.concat(L.join(", "),'" is/are already registered on window. Be aware that this can create compatibility issues if different versions are used.'));var Y=function(){var I=p.dispatch("point");function O(H){var K=a.pointer(H);I.call("point",this,[{x:K[0],y:K[1]}])}function z(){I.call("point",this,[])}var Z=function(K){K.on("mouseenter.pointer",O).on("mousemove.pointer",O).on("mouseleave.pointer",z)};return E(Z,I,"on"),Z},re=function(){var I="",O="vertical",z=function(q,X){return Number(q[X])},Z=function(q){return Object.keys(q[0]).filter(function(X){return X!==I}).map(function(X){var ee=q.filter(function(oe){return oe[X]}).map(function(oe){var pe=[oe[I],z(oe,X)];return pe.data=oe,pe});return ee.key=X,ee})},H=function(q){return q.map(function(X){var ee=Object.keys(X).filter(function(oe){return oe!==I}).map(function(oe){var pe=[oe,z(X,oe)];return pe.data=X,pe});return ee.key=X[I],ee})},K=function(q){return O==="vertical"?Z(q):H(q)};return K.key=function(){return arguments.length?(I=arguments.length<=0?void 0:arguments[0],K):I},K.value=function(){return arguments.length?(z=arguments.length<=0?void 0:arguments[0],K):z},K.orient=function(){return arguments.length?(O=arguments.length<=0?void 0:arguments[0],K):O},K},se=function(){for(var I={},O=function(ee){for(var oe=0,pe=Object.keys(I);oe<pe.length;oe++){var _e=pe[oe];ee[_e].apply(null,I[_e])}return ee},z=arguments.length,Z=new Array(z),H=0;H<z;H++)Z[H]=arguments[H];for(var K=function(){var ee=q[B];O[ee]=function(){for(var oe=arguments.length,pe=new Array(oe),_e=0;_e<oe;_e++)pe[_e]=arguments[_e];return pe.length?(I[ee]=pe,O):I[ee]}},B=0,q=Z;B<q.length;B++)K();return O},le=`d3fc-group.cartesian-chart{width:100%;height:100%;overflow:hidden;display:grid;display:-ms-grid;grid-template-columns:minmax(1em,max-content) auto 1fr auto minmax(1em,max-content);-ms-grid-columns:minmax(1em,max-content) auto 1fr auto minmax(1em,max-content);grid-template-rows:minmax(1em,max-content) auto 1fr auto minmax(1em,max-content);-ms-grid-rows:minmax(1em,max-content) auto 1fr auto minmax(1em,max-content);}
d3fc-group.cartesian-chart>.top-label{align-self:center;-ms-grid-column-align:center;justify-self:center;-ms-grid-row-align:center;grid-column:3;-ms-grid-column:3;grid-row:1;-ms-grid-row:1;}
d3fc-group.cartesian-chart>.top-axis{height:2em;grid-column:3;-ms-grid-column:3;grid-row:2;-ms-grid-row:2;}
d3fc-group.cartesian-chart>.left-label{align-self:center;-ms-grid-column-align:center;justify-self:center;-ms-grid-row-align:center;grid-column:1;-ms-grid-column:1;grid-row:3;-ms-grid-row:3;}
d3fc-group.cartesian-chart>.left-axis{width:3em;grid-column:2;-ms-grid-column:2;grid-row:3;-ms-grid-row:3;}
d3fc-group.cartesian-chart>.plot-area{overflow:hidden;grid-column:3;-ms-grid-column:3;grid-row:3;-ms-grid-row:3;}
d3fc-group.cartesian-chart>.right-axis{width:3em;grid-column:4;-ms-grid-column:4;grid-row:3;-ms-grid-row:3;}
d3fc-group.cartesian-chart>.right-label{align-self:center;-ms-grid-column-align:center;justify-self:center;-ms-grid-row-align:center;grid-column:5;-ms-grid-column:5;grid-row:3;-ms-grid-row:3;}
d3fc-group.cartesian-chart>.bottom-axis{height:2em;grid-column:3;-ms-grid-column:3;grid-row:4;-ms-grid-row:4;}
d3fc-group.cartesian-chart>.bottom-label{align-self:center;-ms-grid-column-align:center;justify-self:center;-ms-grid-row-align:center;grid-column:3;-ms-grid-column:3;grid-row:5;-ms-grid-row:5;}
d3fc-group.cartesian-chart>.y-label{display:flex;transform:rotate(-90deg);width:1em;white-space:nowrap;justify-content:center;}`,xe=document.createElement("style");xe.setAttribute("type","text/css"),document.querySelector("head").appendChild(xe),xe.styleSheet?xe.styleSheet.cssText+=le:xe.textContent+=le;var Ne=function(O){return typeof O=="function"?O:function(){return O}},De=function(){var I=Ze.apply(void 0,arguments),O=I.xScale,z=I.yScale,Z=I.xAxis,H=I.yAxis,K=Ne(""),B=Ne(""),q=Ne(""),X=Ne(null),ee=Ne(null),oe=Ne("right"),pe=Ne("bottom"),_e=null,Ce=null,Be=null,Fe=!1,Ge=!0,it=se("tickFormat","ticks","tickArguments","tickSize","tickSizeInner","tickSizeOuter","tickValues","tickPadding","tickCenterLabel"),at=function(){},ot=se("tickFormat","ticks","tickArguments","tickSize","tickSizeInner","tickSizeOuter","tickValues","tickPadding","tickCenterLabel"),dt=function(){},Nt=function(){},or=rn("d3fc-group","cartesian-chart"),br=rn("d3fc-canvas","webgl-plot-area"),yr=rn("d3fc-canvas","canvas-plot-area"),Zr=rn("d3fc-svg","svg-plot-area"),Ti=rn("d3fc-svg","x-axis").key(function(fi){return fi}),So=rn("d3fc-svg","y-axis").key(function(fi){return fi}),Ks=rn("div","chart-label"),tu=rn("div","x-label").key(function(fi){return fi}),mm=rn("div","y-label").key(function(fi){return fi}),Ya=function(Di){return function(co){return un(Di)?co.transition(Di):co}},dn=function(Di){var co=Ya(Di);Di.each(function(Vi,ro,gm){var To=or(a.select(gm[ro]),[Vi]);To.enter().attr("auto-resize",""),Ks(To,[pe(Vi)]).attr("class",function(Dr){return Dr==="top"?"chart-label bottom-label":"chart-label top-label"}).style("margin-bottom",function(Dr){return Dr==="top"?0:"1em"}).style("margin-top",function(Dr){return Dr==="top"?"1em":0}).text(K(Vi)),tu(To,[pe(Vi)]).attr("class",function(Dr){return"x-label ".concat(Dr,"-label")}).text(B(Vi)),mm(To,[oe(Vi)]).attr("class",function(Dr){return"y-label ".concat(Dr,"-label")}).text(q(Vi)),br(To,_e?[Vi]:[]).attr("set-webgl-viewport","").classed("plot-area",!0).attr("use-device-pixel-ratio",Ge).on("draw",function(Dr,jn){var Ei=Dr.detail,Li=Ei.child,Eo=Ei.pixelRatio;_e.context(Fe?null:Li.getContext("webgl")).pixelRatio(Eo).xScale(O).yScale(z),_e(jn)}),To.select(".webgl-plot-area>canvas").on("webglcontextlost",function(Dr){console.warn("WebGLRenderingContext lost"),Dr.preventDefault(),Fe=!0,To.node().requestRedraw()}).on("webglcontextrestored",function(){console.info("WebGLRenderingContext restored"),Fe=!1,To.node().requestRedraw()}),yr(To,Ce?[Vi]:[]).classed("plot-area",!0).attr("use-device-pixel-ratio",Ge).on("draw",function(Dr,jn){var Ei=Dr.detail,Li=Ei.child,Eo=Ei.pixelRatio,qa=Li.getContext("2d");qa.save(),Ge&&qa.scale(Eo,Eo),Ce.context(qa).xScale(O).yScale(z),Ce(jn),qa.restore()}),Zr(To,Be?[Vi]:[]).classed("plot-area",!0).on("draw",function(Dr,jn){var Ei=Dr.detail.child;Be.xScale(O).yScale(z),co(a.select(Ei).datum(jn)).call(Be)}),Ti(To,[pe(Vi)]).attr("class",function(Dr){return"x-axis ".concat(Dr,"-axis")}).style("height",X(Vi)).on("measure",function(Dr,jn){var Ei=Dr.detail,Li=Ei.width,Eo=Ei.height,qa=Ei.child;jn==="top"&&a.select(qa).attr("viewBox","0 ".concat(-Eo," ").concat(Li," ").concat(Eo)),O.range([0,Li])}).on("draw",function(Dr,jn){var Ei=Dr.detail.child,Li=jn==="top"?Z.top(O):Z.bottom(O);Li.decorate(at),co(a.select(Ei).datum(jn)).call(it(Li))}),So(To,[oe(Vi)]).attr("class",function(Dr){return"y-axis ".concat(Dr,"-axis")}).style("width",ee(Vi)).on("measure",function(Dr,jn){var Ei=Dr.detail,Li=Ei.width,Eo=Ei.height,qa=Ei.child;jn==="left"&&a.select(qa).attr("viewBox","".concat(-Li," 0 ").concat(Li," ").concat(Eo)),z.range([Eo,0])}).on("draw",function(Dr,jn){var Ei=Dr.detail.child,Li=jn==="left"?H.left(z):H.right(z);Li.decorate(dt),co(a.select(Ei).datum(jn)).call(ot(Li))}),To.each(function(Dr,jn,Ei){return Ei[jn].requestRedraw()}),Nt(To,Vi,ro)})},Cs=V(/range\w*/,/tickFormat/);return P(dn,O,Cs,ne("x")),P(dn,z,Cs,ne("y")),P(dn,it,ne("x")),P(dn,ot,ne("y")),dn.xOrient=function(){return arguments.length?(pe=Ne(arguments.length<=0?void 0:arguments[0]),dn):pe},dn.yOrient=function(){return arguments.length?(oe=Ne(arguments.length<=0?void 0:arguments[0]),dn):oe},dn.xDecorate=function(){return arguments.length?(at=arguments.length<=0?void 0:arguments[0],dn):at},dn.yDecorate=function(){return arguments.length?(dt=arguments.length<=0?void 0:arguments[0],dn):dt},dn.chartLabel=function(){return arguments.length?(K=Ne(arguments.length<=0?void 0:arguments[0]),dn):K},dn.xLabel=function(){return arguments.length?(B=Ne(arguments.length<=0?void 0:arguments[0]),dn):B},dn.yLabel=function(){return arguments.length?(q=Ne(arguments.length<=0?void 0:arguments[0]),dn):q},dn.xAxisHeight=function(){return arguments.length?(X=Ne(arguments.length<=0?void 0:arguments[0]),dn):X},dn.yAxisWidth=function(){return arguments.length?(ee=Ne(arguments.length<=0?void 0:arguments[0]),dn):ee},dn.webglPlotArea=function(){return arguments.length?(_e=arguments.length<=0?void 0:arguments[0],dn):_e},dn.canvasPlotArea=function(){return arguments.length?(Ce=arguments.length<=0?void 0:arguments[0],dn):Ce},dn.svgPlotArea=function(){return arguments.length?(Be=arguments.length<=0?void 0:arguments[0],dn):Be},dn.decorate=function(){return arguments.length?(Nt=arguments.length<=0?void 0:arguments[0],dn):Nt},dn.useDevicePixelRatio=function(){return arguments.length?(Ge=arguments.length<=0?void 0:arguments[0],dn):Ge},dn},Ze=function(){for(var O={xScale:r.scaleIdentity(),yScale:r.scaleIdentity(),xAxis:{bottom:gf,top:ii},yAxis:{right:fm,left:Gh}},z=arguments.length,Z=new Array(z),H=0;H<z;H++)Z[H]=arguments[H];return Z.length===1&&!Z[0].domain&&!Z[0].range?Object.assign(O,Z[0]):Object.assign(O,{xScale:Z[0]||O.xScale,yScale:Z[1]||O.yScale})},ze=function(O){return typeof O=="function"?O:function(){return O}},nt=function(I,O){return function(){var z=ze(""),Z=O,H=function(){},K=De.apply(void 0,arguments),B=function(X){I(K,Z),K.decorate(function(ee,oe,pe){ee.enter().select(".x-label").style("height","1em").style("line-height","1em");var _e=K.yOrient()(oe);ee.enter().append("div").attr("class","y-label-container").style("grid-column",_e==="left"?1:5).style("-ms-grid-column",_e==="left"?1:5).style("grid-row",3).style("-ms-grid-row",3).style("width","1em").style("display","flex").style("align-items","center").style("justify-content","center").style("white-space","nowrap").append("div").attr("class","y-label").style("transform","rotate(-90deg)"),ee.select(".y-label-container>.y-label").text(z),H(ee,oe,pe)}),X.call(K)};return P(B,K,N(/^x/,/^y/,"chartLabel")),B.yLabel=function(){return arguments.length?(z=ze(arguments.length<=0?void 0:arguments[0]),B):z},B.plotArea=function(){return arguments.length?(Z=arguments.length<=0?void 0:arguments[0],B):Z},B.decorate=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],B):H},B}},_t=nt(function(I,O){return I.svgPlotArea(O)},bt),$e=nt(function(I,O){return I.canvasPlotArea(O)},Ft),st=function(O){switch(O){case"x":return _.brushX();case"y":return _.brushY();case"xy":return _.brush()}},wt=function(O){return[O[1],O[0]]},Mt=function(O){var z=st(O),Z=p.dispatch("brush","start","end"),H=r.scaleIdentity(),K=r.scaleIdentity(),B=rn("g","brush"),q=function(Fe,Ge,it){switch(O){case"x":return Fe.map(Ge);case"y":return Fe.map(it);case"xy":return[[Ge(Fe[0][0]),it(Fe[0][1])],[Ge(Fe[1][0]),it(Fe[1][1])]]}},X=function(Fe){return q(Fe,r.scaleLinear().domain(H.range()).invert,r.scaleLinear().domain(wt(K.range())).invert)},ee=function(Fe){return q(Fe,r.scaleLinear().domain(H.range()),r.scaleLinear().domain(wt(K.range())))},oe=function(Fe){var Ge=r.scaleLinear().domain(H.domain());if(O==="x")return Fe.map(Ge.invert);if(O==="xy")return[Ge.invert(Fe[0][0]),Ge.invert(Fe[1][0])]},pe=function(Fe){var Ge=r.scaleLinear().domain(wt(K.domain()));if(O==="y")return[Fe[1],Fe[0]].map(Ge.invert);if(O==="xy")return[Ge.invert(Fe[1][1]),Ge.invert(Fe[0][1])]},_e=function(Fe){if(!(Fe.sourceEvent&&Fe.sourceEvent.type==="draw"))if(Fe.selection){var Ge=ee(Fe.selection);Z.call(Fe.type,{},{selection:Ge,xDomain:oe(Ge),yDomain:pe(Ge)})}else Z.call(Fe.type,{},{})},Ce=function(Fe){Fe.each(function(Ge,it,at){z.extent([[H.range()[0],K.range()[1]],[H.range()[1],K.range()[0]]]),z.on("end",function(dt){return _e(dt)}).on("brush",function(dt){return _e(dt)}).on("start",function(dt){return _e(dt)});var ot=B(a.select(at[it]),[Ge]);ot.call(z).call(z.move,Ge?X(Ge):null)})};return Ce.xScale=function(){return arguments.length?(H=arguments.length<=0?void 0:arguments[0],Ce):H},Ce.yScale=function(){return arguments.length?(K=arguments.length<=0?void 0:arguments[0],Ce):K},E(Ce,Z,"on"),E(Ce,z,"filter","handleSize"),Ce},Pt=function(){return Mt("x")},Vt=function(){return Mt("y")},zt=function(){return Mt("xy")},Gt=function(O,z){if(O==null&&z==null)return!0;var Z=O.domain(),H=z.domain();return Z.length===H.length&&Z.every(function(K,B){var q;return K?.valueOf()===((q=H[B])===null||q===void 0?void 0:q.valueOf())})},Er=function(O,z){return y.zoomIdentity.scale(O.k/z.k).translate(O.x-z.x,O.y-z.y)},pn=Symbol("d3fc-domain-zoom"),er=function(){var I=p.dispatch("zoom"),O=y.zoom().on("zoom",function(Z){var H=Z.transform,K=this,B=H,q=K[pn],X=q.originalXScale,ee=q.previousXScale,oe=q.xScale,pe=q.originalYScale,_e=q.previousYScale,Ce=q.yScale,Be=q.previousTransform;(!Gt(ee,oe)||!Gt(_e,Ce))&&(X=oe?.copy(),pe=Ce?.copy(),B=Er(H,Be)),oe!=null&&(ee=B.rescaleX(X.range(oe.range())),oe.domain(ee.domain())),Ce!=null&&(_e=B.rescaleY(pe.range(Ce.range())),Ce.domain(_e.domain())),Be=B,K[pn]={originalXScale:X,previousXScale:ee,xScale:oe,originalYScale:pe,previousYScale:_e,yScale:Ce,previousTransform:Be},B!==H&&O.transform(a.select(K),B),I.call("zoom",this,Z)}),z=function(H){var K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;K==null&&B==null&&console.warn("Without an xScale and/or yScale specified, this component won't do anything. Perhaps you forgot to specify them e.g. selection.call(zoom, x, y)?"),H.each(function(q,X,ee){var oe=ee[X][pn];oe!=null&&oe.xScale===K&&oe.yScale===B&&console.warn("This component should only be called on a selection once. Perhaps you're missing an .enter()?");var pe=K?.copy(),_e=B?.copy();ee[X][pn]={originalXScale:pe,previousXScale:pe,xScale:K,originalYScale:_e,previousYScale:_e,yScale:B,previousTransform:y.zoomIdentity}}).call(O)};return E(z,I,"on"),E(z,O,"extent","filter","wheelDelta","touchable","clickDistance","tapDistance","duration","interpolate","scaleExtent","translateExtent"),z};e.annotationCanvasBand=C_,e.annotationCanvasCrosshair=am,e.annotationCanvasGridline=$o,e.annotationCanvasLine=sm,e.annotationSvgBand=om,e.annotationSvgCrosshair=k_,e.annotationSvgGridline=lm,e.annotationSvgLine=Zh,e.autoBandwidth=I_,e.axisBottom=gf,e.axisLabelOffset=yf,e.axisLabelRotate=Wr,e.axisLeft=Gh,e.axisOrdinalBottom=Nx,e.axisOrdinalLeft=Fo,e.axisOrdinalRight=Hh,e.axisOrdinalTop=P_,e.axisRight=fm,e.axisTop=ii,e.brush=zt,e.brushX=Pt,e.brushY=Vt,e.bucket=ut,e.chartCanvasCartesian=$e,e.chartCartesian=De,e.chartSvgCartesian=_t,e.dataJoin=rn,e.discontinuityIdentity=Do,e.discontinuityRange=Ht,e.discontinuitySkipUtcWeekends=wo,e.discontinuitySkipUtcWeeklyPattern=G,e.discontinuitySkipWeekends=ws,e.discontinuitySkipWeeklyPattern=Ve,e.effectivelyZero=pr,e.exclude=V,e.extentDate=Q,e.extentLinear=te,e.extentTime=Q,e.feedGdax=Xe,e.group=re,e.include=N,e.includeMap=j,e.indicatorBollingerBands=je,e.indicatorElderRay=zo,e.indicatorEnvelope=vs,e.indicatorExponentialMovingAverage=Re,e.indicatorForceIndex=ba,e.indicatorMacd=Se,e.indicatorMovingAverage=bs,e.indicatorRelativeStrengthIndex=No,e.indicatorStochasticOscillator=qo,e.isTransition=un,e.largestTriangleOneBucket=mt,e.largestTriangleThreeBucket=Tt,e.layoutAnnealing=fn,e.layoutBoundingBox=Bn,e.layoutGreedy=qr,e.layoutLabel=en,e.layoutRemoveOverlaps=lo,e.layoutTextLabel=Xr,e.modeMedian=jt,e.pointer=Y,e.prefix=ne,e.randomFinancial=we,e.randomGeometricBrownianMotion=ae,e.randomSkipWeekends=Ee,e.rebind=E,e.rebindAll=P,e.scaleDiscontinuous=eo,e.seriesCanvasArea=M_,e.seriesCanvasBar=uf,e.seriesCanvasBoxPlot=E_,e.seriesCanvasCandlestick=df,e.seriesCanvasErrorBar=Hc,e.seriesCanvasGrouped=Za,e.seriesCanvasHeatmap=im,e.seriesCanvasLine=Ft,e.seriesCanvasMulti=pf,e.seriesCanvasOhlc=Vh,e.seriesCanvasPoint=pl,e.seriesCanvasRepeat=Wh,e.seriesSvgArea=A_,e.seriesSvgBar=Gc,e.seriesSvgBoxPlot=Ua,e.seriesSvgCandlestick=hf,e.seriesSvgErrorBar=ff,e.seriesSvgGrouped=Xc,e.seriesSvgHeatmap=nm,e.seriesSvgLine=bt,e.seriesSvgMulti=tm,e.seriesSvgOhlc=Va,e.seriesSvgPoint=gi,e.seriesSvgRepeat=_r,e.seriesWebglArea=S_,e.seriesWebglBar=Bh,e.seriesWebglBoxPlot=Es,e.seriesWebglCandlestick=T_,e.seriesWebglErrorBar=w_,e.seriesWebglLine=Jp,e.seriesWebglMulti=rm,e.seriesWebglOhlc=Wa,e.seriesWebglPoint=Xo,e.seriesWebglRepeat=ml,e.shapeBar=Dt,e.shapeBoxPlot=xr,e.shapeCandlestick=Lt,e.shapeErrorBar=Sr,e.shapeOhlc=Ct,e.webglAdjacentAttribute=Ts,e.webglAttribute=yn,e.webglBaseAttribute=Wc,e.webglBufferBuilder=hn,e.webglElementIndices=fl,e.webglFillColor=Lh,e.webglProgramBuilder=Kn,e.webglScaleLinear=af,e.webglScaleLog=Rh,e.webglScaleMapper=dl,e.webglScalePow=lf,e.webglSeriesArea=Zp,e.webglSeriesBar=Fn,e.webglSeriesBoxPlot=li,e.webglSeriesCandlestick=hl,e.webglSeriesErrorBar=x_,e.webglSeriesLine=Ba,e.webglSeriesOhlc=qp,e.webglSeriesPoint=Oh,e.webglShaderBuilder=Qr,e.webglStrokeColor=Fh,e.webglSymbolMapper=Qp,e.webglTypes=Ln,e.webglUniform=_n,e.zoom=er,Object.defineProperty(e,"__esModule",{value:!0})})});var bk,vk,wk=W(()=>{bk="http://www.w3.org/1999/xhtml",vk={svg:"http://www.w3.org/2000/svg",xhtml:bk,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"}});function tA(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),vk.hasOwnProperty(t)?{space:vk[t],local:e}:e}var Ak=W(()=>{wk()});function cNe(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===bk&&t.documentElement.namespaceURI===bk?t.createElement(e):t.createElementNS(r,e)}}function uNe(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function rA(e){var t=tA(e);return(t.local?uNe:cNe)(t)}var Mk=W(()=>{Ak();wk()});function r7(){return new t7}function t7(){this._="@"+(++fNe).toString(36)}var fNe,efe=W(()=>{fNe=0;t7.prototype=r7.prototype={constructor:t7,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}}});var rfe,fx,tfe,n7,i7=W(()=>{rfe=function(e){return function(){return this.matches(e)}};typeof document<"u"&&(fx=document.documentElement,fx.matches||(tfe=fx.webkitMatchesSelector||fx.msMatchesSelector||fx.mozMatchesSelector||fx.oMatchesSelector,rfe=function(e){return function(){return tfe.call(this,e)}}));n7=rfe});function hNe(e,t,r){return e=ofe(e,t,r),function(n){var o=n.relatedTarget;(!o||o!==this&&!(o.compareDocumentPosition(this)&8))&&e.call(this,n)}}function ofe(e,t,r){return function(n){var o=nA;nA=n;try{e.call(this,this.__data__,t,r)}finally{nA=o}}}function dNe(e){return e.trim().split(/^|\s+/).map(function(t){var r="",n=t.indexOf(".");return n>=0&&(r=t.slice(n+1),t=t.slice(0,n)),{type:t,name:r}})}function pNe(e){return function(){var t=this.__on;if(t){for(var r=0,n=-1,o=t.length,i;r<o;++r)i=t[r],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.capture):t[++n]=i;++n?t.length=n:delete this.__on}}}function mNe(e,t,r){var n=ife.hasOwnProperty(e.type)?hNe:ofe;return function(o,i,s){var a=this.__on,u,h=n(t,i,s);if(a){for(var p=0,_=a.length;p<_;++p)if((u=a[p]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=h,u.capture=r),u.value=t;return}}this.addEventListener(e.type,h,r),u={type:e.type,name:e.name,value:t,listener:h,capture:r},a?a.push(u):this.__on=[u]}}function sfe(e,t,r){var n=dNe(e+""),o,i=n.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,h=a.length,p;u<h;++u)for(o=0,p=a[u];o<i;++o)if((s=n[o]).type===p.type&&s.name===p.name)return p.value}return}for(a=t?mNe:pNe,r==null&&(r=!1),o=0;o<i;++o)this.each(a(n[o],t,r));return this}var ife,nA,nfe,Sk=W(()=>{ife={},nA=null;typeof document<"u"&&(nfe=document.documentElement,"onmouseenter"in nfe||(ife={mouseenter:"mouseover",mouseleave:"mouseout"}))});var Tk=W(()=>{Sk()});var Ek=W(()=>{});var cfe=W(()=>{Tk();Ek()});function gNe(){}function iA(e){return e==null?gNe:function(){return this.querySelector(e)}}var Ik=W(()=>{});function ufe(e){typeof e!="function"&&(e=iA(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var i=t[o],s=i.length,a=n[o]=new Array(s),u,h,p=0;p<s;++p)(u=i[p])&&(h=e.call(u,u.__data__,p,i))&&("__data__"in u&&(h.__data__=u.__data__),a[p]=h);return new Ji(n,this._parents)}var ffe=W(()=>{Kl();Ik()});function _Ne(){return[]}function o7(e){return e==null?_Ne:function(){return this.querySelectorAll(e)}}var s7=W(()=>{});function hfe(e){typeof e!="function"&&(e=o7(e));for(var t=this._groups,r=t.length,n=[],o=[],i=0;i<r;++i)for(var s=t[i],a=s.length,u,h=0;h<a;++h)(u=s[h])&&(n.push(e.call(u,u.__data__,h,s)),o.push(u));return new Ji(n,o)}var dfe=W(()=>{Kl();s7()});function pfe(e){typeof e!="function"&&(e=n7(e));for(var t=this._groups,r=t.length,n=new Array(r),o=0;o<r;++o)for(var i=t[o],s=i.length,a=n[o]=[],u,h=0;h<s;++h)(u=i[h])&&e.call(u,u.__data__,h,i)&&a.push(u);return new Ji(n,this._parents)}var mfe=W(()=>{Kl();i7()});function Ck(e){return new Array(e.length)}var a7=W(()=>{});function gfe(){return new Ji(this._enter||this._groups.map(Ck),this._parents)}function oA(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}var l7=W(()=>{a7();Kl();oA.prototype={constructor:oA,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}}});function _fe(e){return function(){return e}}var yfe=W(()=>{});function yNe(e,t,r,n,o,i){for(var s=0,a,u=t.length,h=i.length;s<h;++s)(a=t[s])?(a.__data__=i[s],n[s]=a):r[s]=new oA(e,i[s]);for(;s<u;++s)(a=t[s])&&(o[s]=a)}function xNe(e,t,r,n,o,i,s){var a,u,h={},p=t.length,_=i.length,y=new Array(p),A;for(a=0;a<p;++a)(u=t[a])&&(y[a]=A=xfe+s.call(u,u.__data__,a,t),A in h?o[a]=u:h[A]=u);for(a=0;a<_;++a)A=xfe+s.call(e,i[a],a,i),(u=h[A])?(n[a]=u,u.__data__=i[a],h[A]=null):r[a]=new oA(e,i[a]);for(a=0;a<p;++a)(u=t[a])&&h[y[a]]===u&&(o[a]=u)}function bfe(e,t){if(!e)return A=new Array(this.size()),h=-1,this.each(function(ne){A[++h]=ne}),A;var r=t?xNe:yNe,n=this._parents,o=this._groups;typeof e!="function"&&(e=_fe(e));for(var i=o.length,s=new Array(i),a=new Array(i),u=new Array(i),h=0;h<i;++h){var p=n[h],_=o[h],y=_.length,A=e.call(p,p&&p.__data__,h,n),E=A.length,k=a[h]=new Array(E),P=s[h]=new Array(E),R=u[h]=new Array(y);r(p,_,k,P,R,A,t);for(var V=0,N=0,j,J;V<E;++V)if(j=k[V]){for(V>=N&&(N=V+1);!(J=P[N])&&++N<E;);j._next=J||null}}return s=new Ji(s,n),s._enter=a,s._exit=u,s}var xfe,vfe=W(()=>{Kl();l7();yfe();xfe="$"});function wfe(){return new Ji(this._exit||this._groups.map(Ck),this._parents)}var Afe=W(()=>{a7();Kl()});function Mfe(e){for(var t=this._groups,r=e._groups,n=t.length,o=r.length,i=Math.min(n,o),s=new Array(n),a=0;a<i;++a)for(var u=t[a],h=r[a],p=u.length,_=s[a]=new Array(p),y,A=0;A<p;++A)(y=u[A]||h[A])&&(_[A]=y);for(;a<n;++a)s[a]=t[a];return new Ji(s,this._parents)}var Sfe=W(()=>{Kl()});function Tfe(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n=e[t],o=n.length-1,i=n[o],s;--o>=0;)(s=n[o])&&(i&&i!==s.nextSibling&&i.parentNode.insertBefore(s,i),i=s);return this}var Efe=W(()=>{});function Ife(e){e||(e=bNe);function t(_,y){return _&&y?e(_.__data__,y.__data__):!_-!y}for(var r=this._groups,n=r.length,o=new Array(n),i=0;i<n;++i){for(var s=r[i],a=s.length,u=o[i]=new Array(a),h,p=0;p<a;++p)(h=s[p])&&(u[p]=h);u.sort(t)}return new Ji(o,this._parents).order()}function bNe(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var Cfe=W(()=>{Kl()});function kfe(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}var Pfe=W(()=>{});function Ofe(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}var Rfe=W(()=>{});function Nfe(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],o=0,i=n.length;o<i;++o){var s=n[o];if(s)return s}return null}var zfe=W(()=>{});function Dfe(){var e=0;return this.each(function(){++e}),e}var Lfe=W(()=>{});function Ffe(){return!this.node()}var Bfe=W(()=>{});function jfe(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var o=t[r],i=0,s=o.length,a;i<s;++i)(a=o[i])&&e.call(a,a.__data__,i,o);return this}var Ufe=W(()=>{});function vNe(e){return function(){this.removeAttribute(e)}}function wNe(e){return function(){this.removeAttributeNS(e.space,e.local)}}function ANe(e,t){return function(){this.setAttribute(e,t)}}function MNe(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function SNe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function TNe(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function Vfe(e,t){var r=tA(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((t==null?r.local?wNe:vNe:typeof t=="function"?r.local?TNe:SNe:r.local?MNe:ANe)(r,t))}var Wfe=W(()=>{Ak()});function sA(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}var kk=W(()=>{});function ENe(e){return function(){this.style.removeProperty(e)}}function INe(e,t,r){return function(){this.style.setProperty(e,t,r)}}function CNe(e,t,r){return function(){var n=t.apply(this,arguments);n==null?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}function Zfe(e,t,r){var n;return arguments.length>1?this.each((t==null?ENe:typeof t=="function"?CNe:INe)(e,t,r??"")):sA(n=this.node()).getComputedStyle(n,null).getPropertyValue(e)}var Yfe=W(()=>{kk()});function kNe(e){return function(){delete this[e]}}function PNe(e,t){return function(){this[e]=t}}function ONe(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function qfe(e,t){return arguments.length>1?this.each((t==null?kNe:typeof t=="function"?ONe:PNe)(e,t)):this.node()[e]}var Gfe=W(()=>{});function Hfe(e){return e.trim().split(/^|\s+/)}function c7(e){return e.classList||new Xfe(e)}function Xfe(e){this._node=e,this._names=Hfe(e.getAttribute("class")||"")}function Kfe(e,t){for(var r=c7(e),n=-1,o=t.length;++n<o;)r.add(t[n])}function $fe(e,t){for(var r=c7(e),n=-1,o=t.length;++n<o;)r.remove(t[n])}function RNe(e){return function(){Kfe(this,e)}}function NNe(e){return function(){$fe(this,e)}}function zNe(e,t){return function(){(t.apply(this,arguments)?Kfe:$fe)(this,e)}}function Qfe(e,t){var r=Hfe(e+"");if(arguments.length<2){for(var n=c7(this.node()),o=-1,i=r.length;++o<i;)if(!n.contains(r[o]))return!1;return!0}return this.each((typeof t=="function"?zNe:t?RNe:NNe)(r,t))}var Jfe=W(()=>{Xfe.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}}});function DNe(){this.textContent=""}function LNe(e){return function(){this.textContent=e}}function FNe(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function ehe(e){return arguments.length?this.each(e==null?DNe:(typeof e=="function"?FNe:LNe)(e)):this.node().textContent}var the=W(()=>{});function BNe(){this.innerHTML=""}function jNe(e){return function(){this.innerHTML=e}}function UNe(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function rhe(e){return arguments.length?this.each(e==null?BNe:(typeof e=="function"?UNe:jNe)(e)):this.node().innerHTML}var nhe=W(()=>{});function VNe(){this.nextSibling&&this.parentNode.appendChild(this)}function ihe(){return this.each(VNe)}var ohe=W(()=>{});function WNe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function she(){return this.each(WNe)}var ahe=W(()=>{});function lhe(e){var t=typeof e=="function"?e:rA(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}var che=W(()=>{Mk()});function ZNe(){return null}function uhe(e,t){var r=typeof e=="function"?e:rA(e),n=t==null?ZNe:typeof t=="function"?t:iA(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})}var fhe=W(()=>{Mk();Ik()});function YNe(){var e=this.parentNode;e&&e.removeChild(this)}function hhe(){return this.each(YNe)}var dhe=W(()=>{});function phe(e){return arguments.length?this.property("__data__",e):this.node().__data__}var mhe=W(()=>{});function ghe(e,t,r){var n=sA(e),o=n.CustomEvent;o?o=new o(t,r):(o=n.document.createEvent("Event"),r?(o.initEvent(t,r.bubbles,r.cancelable),o.detail=r.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function qNe(e,t){return function(){return ghe(this,e,t)}}function GNe(e,t){return function(){return ghe(this,e,t.apply(this,arguments))}}function _he(e,t){return this.each((typeof t=="function"?GNe:qNe)(e,t))}var yhe=W(()=>{kk()});function Ji(e,t){this._groups=e,this._parents=t}function HNe(){return new Ji([[document.documentElement]],Pk)}var Pk,Kl=W(()=>{ffe();dfe();mfe();vfe();l7();Afe();Sfe();Efe();Cfe();Pfe();Rfe();zfe();Lfe();Bfe();Ufe();Wfe();Yfe();Gfe();Jfe();the();nhe();ohe();ahe();che();fhe();dhe();mhe();Sk();yhe();Pk=[null];Ji.prototype=HNe.prototype={constructor:Ji,select:ufe,selectAll:hfe,filter:pfe,data:bfe,enter:gfe,exit:wfe,merge:Mfe,order:Tfe,sort:Ife,call:kfe,nodes:Ofe,node:Nfe,size:Dfe,empty:Ffe,each:jfe,attr:Vfe,style:Zfe,property:qfe,classed:Qfe,text:ehe,html:rhe,raise:ihe,lower:she,append:lhe,insert:uhe,remove:hhe,datum:phe,on:sfe,dispatch:_he}});function u7(e){return typeof e=="string"?new Ji([[document.querySelector(e)]],[document.documentElement]):new Ji([[e]],Pk)}var xhe=W(()=>{Kl()});var bhe=W(()=>{Kl()});var vhe=W(()=>{Tk();Ek()});var whe=W(()=>{Tk();Ek()});var Ahe=W(()=>{Mk();efe();i7();cfe();Ak();wk();xhe();bhe();Kl();Ik();s7();vhe();whe();kk();Sk()});function $g(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}var Ok=W(()=>{});function aA(e){return e=$g(Math.abs(e)),e?e[1]:NaN}var lA=W(()=>{Ok()});function Mhe(e,t){return function(r,n){for(var o=r.length,i=[],s=0,a=e[0],u=0;o>0&&a>0&&(u+a+1>n&&(a=Math.max(1,n-u)),i.push(r.substring(o-=a,o+a)),!((u+=a+1)>n));)a=e[s=(s+1)%e.length];return i.reverse().join(t)}}var She=W(()=>{});function The(e,t){e=e.toPrecision(t);e:for(var r=e.length,n=1,o=-1,i;n<r;++n)switch(e[n]){case".":o=i=n;break;case"0":o===0&&(o=n),i=n;break;case"e":break e;default:o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(i+1):e}var Ehe=W(()=>{});function Ihe(e,t){var r=$g(e,t);if(!r)return e+"";var n=r[0],o=r[1],i=o-(f7=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=n.length;return i===s?n:i>s?n+new Array(i-s+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+$g(e,Math.max(0,t+i-1))[0]}var f7,h7=W(()=>{Ok()});function d7(e,t){var r=$g(e,t);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var Che=W(()=>{Ok()});var Rk,p7=W(()=>{Ehe();h7();Che();Rk={"":The,"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return d7(e*100,t)},r:d7,s:Ihe,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}}});function Qg(e){return new khe(e)}function khe(e){if(!(t=XNe.exec(e)))throw new Error("invalid format: "+e);var t,r=t[1]||" ",n=t[2]||">",o=t[3]||"-",i=t[4]||"",s=!!t[5],a=t[6]&&+t[6],u=!!t[7],h=t[8]&&+t[8].slice(1),p=t[9]||"";p==="n"?(u=!0,p="g"):Rk[p]||(p=""),(s||r==="0"&&n==="=")&&(s=!0,r="0",n="="),this.fill=r,this.align=n,this.sign=o,this.symbol=i,this.zero=s,this.width=a,this.comma=u,this.precision=h,this.type=p}var XNe,m7=W(()=>{p7();XNe=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;khe.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+this.type}});function KNe(e){return e}function hx(e){var t=e.grouping&&e.thousands?Mhe(e.grouping,e.thousands):KNe,r=e.currency,n=e.decimal;function o(s){s=Qg(s);var a=s.fill,u=s.align,h=s.sign,p=s.symbol,_=s.zero,y=s.width,A=s.comma,E=s.precision,k=s.type,P=p==="$"?r[0]:p==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",R=p==="$"?r[1]:/[%p]/.test(k)?"%":"",V=Rk[k],N=!k||/[defgprs%]/.test(k);E=E==null?k?6:12:/[gprs]/.test(k)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function j(J){var ne=P,de=R,fe,ye,ve;if(k==="c")de=V(J)+de,J="";else{J=+J;var be=(J<0||1/J<0)&&(J*=-1,!0);if(J=V(J,E),be){for(fe=-1,ye=J.length,be=!1;++fe<ye;)if(ve=J.charCodeAt(fe),48<ve&&ve<58||k==="x"&&96<ve&&ve<103||k==="X"&&64<ve&&ve<71){be=!0;break}}if(ne=(be?h==="("?h:"-":h==="-"||h==="("?"":h)+ne,de=de+(k==="s"?Phe[8+f7/3]:"")+(be&&h==="("?")":""),N){for(fe=-1,ye=J.length;++fe<ye;)if(ve=J.charCodeAt(fe),48>ve||ve>57){de=(ve===46?n+J.slice(fe+1):J.slice(fe))+de,J=J.slice(0,fe);break}}}A&&!_&&(J=t(J,1/0));var je=ne.length+J.length+de.length,Re=je<y?new Array(y-je+1).join(a):"";switch(A&&_&&(J=t(Re+J,Re.length?y-de.length:1/0),Re=""),u){case"<":return ne+J+de+Re;case"=":return ne+Re+J+de;case"^":return Re.slice(0,je=Re.length>>1)+ne+J+de+Re.slice(je)}return Re+ne+J+de}return j.toString=function(){return s+""},j}function i(s,a){var u=o((s=Qg(s),s.type="f",s)),h=Math.max(-8,Math.min(8,Math.floor(aA(a)/3)))*3,p=Math.pow(10,-h),_=Phe[8+h/3];return function(y){return u(p*y)+_}}return{format:o,formatPrefix:i}}var Phe,g7=W(()=>{lA();She();m7();p7();h7();Phe=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function _7(e){return Nk=hx(e),zk=Nk.format,Dk=Nk.formatPrefix,Nk}var Nk,zk,Dk,Ohe=W(()=>{g7();_7({decimal:".",thousands:",",grouping:[3],currency:["$",""]})});var Rhe=W(()=>{lA()});var Nhe=W(()=>{lA()});var zhe=W(()=>{lA()});var Dhe=W(()=>{Ohe();g7();m7();Rhe();Nhe();zhe()});function Fhe(){for(var e=0,t=arguments.length,r={},n;e<t;++e){if(!(n=arguments[e]+"")||n in r)throw new Error("illegal type: "+n);r[n]=[]}return new Lk(r)}function Lk(e){this._=e}function QNe(e,t){return e.trim().split(/^|\s+/).map(function(r){var n="",o=r.indexOf(".");if(o>=0&&(n=r.slice(o+1),r=r.slice(0,o)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:n}})}function JNe(e,t){for(var r=0,n=e.length,o;r<n;++r)if((o=e[r]).name===t)return o.value}function Lhe(e,t,r){for(var n=0,o=e.length;n<o;++n)if(e[n].name===t){e[n]=$Ne,e=e.slice(0,n).concat(e.slice(n+1));break}return r!=null&&e.push({name:t,value:r}),e}var $Ne,Fk,Bhe=W(()=>{$Ne={value:function(){}};Lk.prototype=Fhe.prototype={constructor:Lk,on:function(e,t){var r=this._,n=QNe(e+"",r),o,i=-1,s=n.length;if(arguments.length<2){for(;++i<s;)if((o=(e=n[i]).type)&&(o=JNe(r[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(e=n[i]).type)r[o]=Lhe(r[o],e.name,t);else if(t==null)for(o in r)r[o]=Lhe(r[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new Lk(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var r=new Array(o),n=0,o,i;n<o;++n)r[n]=arguments[n+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],n=0,o=i.length;n<o;++n)i[n].value.apply(t,r)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var n=this._[e],o=0,i=n.length;o<i;++o)n[o].value.apply(t,r)}};Fk=Fhe});var jhe=W(()=>{Bhe()});function yh(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var Jg=W(()=>{});function Bk(e){return e.length===1&&(e=eze(e)),{left:function(t,r,n,o){for(n==null&&(n=0),o==null&&(o=t.length);n<o;){var i=n+o>>>1;e(t[i],r)<0?n=i+1:o=i}return n},right:function(t,r,n,o){for(n==null&&(n=0),o==null&&(o=t.length);n<o;){var i=n+o>>>1;e(t[i],r)>0?o=i:n=i+1}return n}}}function eze(e){return function(t,r){return yh(e(t),r)}}var y7=W(()=>{Jg()});var Uhe,Vhe,tze,e_,x7=W(()=>{Jg();y7();Uhe=Bk(yh),Vhe=Uhe.right,tze=Uhe.left,e_=Vhe});var b7=W(()=>{});var Whe=W(()=>{b7()});var Zhe=W(()=>{});var dx=W(()=>{});var v7=W(()=>{dx()});var w7=W(()=>{v7()});var A7=W(()=>{});var Yhe,nze,ize,M7=W(()=>{Yhe=Array.prototype,nze=Yhe.slice,ize=Yhe.map});var qhe=W(()=>{});var Ghe=W(()=>{});var S7=W(()=>{});function Uk(e,t,r){var n,o=-1,i,s,a;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(i=e,e=t,t=i),(a=Hhe(e,t,r))===0||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),s=new Array(i=Math.ceil(t-e+1));++o<i;)s[o]=(e+o)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),s=new Array(i=Math.ceil(e-t+1));++o<i;)s[o]=(e-o)/a;return n&&s.reverse(),s}function Hhe(e,t,r){var n=(t-e)/Math.max(0,r),o=Math.floor(Math.log(n)/Math.LN10),i=n/Math.pow(10,o);return o>=0?(i>=T7?10:i>=E7?5:i>=I7?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(i>=T7?10:i>=E7?5:i>=I7?2:1)}function Mp(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),i=n/o;return i>=T7?o*=10:i>=E7?o*=5:i>=I7&&(o*=2),t<e?-o:o}var T7,E7,I7,C7=W(()=>{T7=Math.sqrt(50),E7=Math.sqrt(10),I7=Math.sqrt(2)});var k7=W(()=>{});var Khe=W(()=>{M7();x7();qhe();A7();Ghe();S7();C7();k7()});var Vk=W(()=>{dx()});var $he=W(()=>{M7();Jg();dx();Vk()});var Qhe=W(()=>{w7()});var Jhe=W(()=>{});var ede=W(()=>{dx()});var tde=W(()=>{Jg();dx();Vk()});var rde=W(()=>{});var O7=W(()=>{});var nde=W(()=>{});var ide=W(()=>{Jg()});var ode=W(()=>{});var sde=W(()=>{});var R7=W(()=>{O7()});var ade=W(()=>{R7()});var qu=W(()=>{x7();Jg();y7();Whe();Zhe();w7();A7();Khe();$he();Qhe();k7();Jhe();ede();tde();rde();O7();b7();nde();Vk();S7();ide();ode();sde();C7();R7();v7();ade()});function Wk(){}function lde(e,t){var r=new Wk;if(e instanceof Wk)e.each(function(a,u){r.set(u,a)});else if(Array.isArray(e)){var n=-1,o=e.length,i;if(t==null)for(;++n<o;)r.set(n,e[n]);else for(;++n<o;)r.set(t(i=e[n],n,e),i)}else if(e)for(var s in e)r.set(s,e[s]);return r}var ll,cA,Zk=W(()=>{ll="$";Wk.prototype=lde.prototype={constructor:Wk,has:function(e){return ll+e in this},get:function(e){return this[ll+e]},set:function(e,t){return this[ll+e]=t,this},remove:function(e){var t=ll+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===ll&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===ll&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===ll&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===ll&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===ll&&++e;return e},empty:function(){for(var e in this)if(e[0]===ll)return!1;return!0},each:function(e){for(var t in this)t[0]===ll&&e(this[t],t.slice(1),this)}};cA=lde});var cde=W(()=>{Zk()});function Yk(){}function uze(e,t){var r=new Yk;if(e instanceof Yk)e.each(function(i){r.add(i)});else if(e){var n=-1,o=e.length;if(t==null)for(;++n<o;)r.add(e[n]);else for(;++n<o;)r.add(t(e[n],n,e))}return r}var t_,ude=W(()=>{Zk();t_=cA.prototype;Yk.prototype=uze.prototype={constructor:Yk,has:t_.has,add:function(e){return e+="",this[ll+e]=e,this},remove:t_.remove,clear:t_.clear,values:t_.keys,size:t_.size,empty:t_.empty,each:t_.each}});var fde=W(()=>{});var hde=W(()=>{});var dde=W(()=>{});var pde=W(()=>{cde();ude();Zk();fde();hde();dde()});var mde,qk,r_,Sp=W(()=>{mde=Array.prototype,qk=mde.map,r_=mde.slice});var N7=W(()=>{pde();Sp()});var gde=W(()=>{qu();N7()});function px(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function uA(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}var z7=W(()=>{});function i_(){}function yde(){return this.rgb().formatHex()}function xze(){return Mde(this).formatHsl()}function xde(){return this.rgb().formatRgb()}function Ep(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=hze.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?bde(t):r===3?new Ys(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?Gk(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?Gk(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=dze.exec(e))?new Ys(t[1],t[2],t[3],1):(t=pze.exec(e))?new Ys(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=mze.exec(e))?Gk(t[1],t[2],t[3],t[4]):(t=gze.exec(e))?Gk(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_ze.exec(e))?Ade(t[1],t[2]/100,t[3]/100,1):(t=yze.exec(e))?Ade(t[1],t[2]/100,t[3]/100,t[4]):_de.hasOwnProperty(e)?bde(_de[e]):e==="transparent"?new Ys(NaN,NaN,NaN,0):null}function bde(e){return new Ys(e>>16&255,e>>8&255,e&255,1)}function Gk(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ys(e,t,r,n)}function F7(e){return e instanceof i_||(e=Ep(e)),e?(e=e.rgb(),new Ys(e.r,e.g,e.b,e.opacity)):new Ys}function gx(e,t,r,n){return arguments.length===1?F7(e):new Ys(e,t,r,n??1)}function Ys(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function vde(){return"#"+D7(this.r)+D7(this.g)+D7(this.b)}function wde(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function D7(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Ade(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Gu(e,t,r,n)}function Mde(e){if(e instanceof Gu)return new Gu(e.h,e.s,e.l,e.opacity);if(e instanceof i_||(e=Ep(e)),!e)return new Gu;if(e instanceof Gu)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,o=Math.min(t,r,n),i=Math.max(t,r,n),s=NaN,a=i-o,u=(i+o)/2;return a?(t===i?s=(r-n)/a+(r<n)*6:r===i?s=(n-t)/a+2:s=(t-r)/a+4,a/=u<.5?i+o:2-i-o,s*=60):a=u>0&&u<1?0:s,new Gu(s,a,u,e.opacity)}function Sde(e,t,r,n){return arguments.length===1?Mde(e):new Gu(e,t,r,n??1)}function Gu(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function L7(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var Tp,n_,mx,fA,Hu,hze,dze,pze,mze,gze,_ze,yze,_de,B7=W(()=>{z7();Tp=.7,n_=1/Tp,mx="\\s*([+-]?\\d+)\\s*",fA="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",hze=/^#([0-9a-f]{3,8})$/,dze=new RegExp("^rgb\\("+[mx,mx,mx]+"\\)$"),pze=new RegExp("^rgb\\("+[Hu,Hu,Hu]+"\\)$"),mze=new RegExp("^rgba\\("+[mx,mx,mx,fA]+"\\)$"),gze=new RegExp("^rgba\\("+[Hu,Hu,Hu,fA]+"\\)$"),_ze=new RegExp("^hsl\\("+[fA,Hu,Hu]+"\\)$"),yze=new RegExp("^hsla\\("+[fA,Hu,Hu,fA]+"\\)$"),_de={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};px(i_,Ep,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:yde,formatHex:yde,formatHsl:xze,formatRgb:xde,toString:xde});px(Ys,gx,uA(i_,{brighter:function(e){return e=e==null?n_:Math.pow(n_,e),new Ys(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Tp:Math.pow(Tp,e),new Ys(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:vde,formatHex:vde,formatRgb:wde,toString:wde}));px(Gu,Sde,uA(i_,{brighter:function(e){return e=e==null?n_:Math.pow(n_,e),new Gu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Tp:Math.pow(Tp,e),new Gu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,o=2*r-n;return new Ys(L7(e>=240?e-240:e+120,o,n),L7(e,o,n),L7(e<120?e+240:e-120,o,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}))});var Tde,Ede,Ide=W(()=>{Tde=Math.PI/180,Ede=180/Math.PI});function bze(e){if(e instanceof o_)return new o_(e.h,e.s,e.l,e.opacity);e instanceof Ys||(e=F7(e));var t=e.r/255,r=e.g/255,n=e.b/255,o=(Pde*n+Cde*t-kde*r)/(Pde+Cde-kde),i=n-o,s=(hA*(r-o)-U7*i)/Hk,a=Math.sqrt(s*s+i*i)/(hA*o*(1-o)),u=a?Math.atan2(s,i)*Ede-120:NaN;return new o_(u<0?u+360:u,a,o,e.opacity)}function xa(e,t,r,n){return arguments.length===1?bze(e):new o_(e,t,r,n??1)}function o_(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}var Ode,j7,U7,Hk,hA,Cde,kde,Pde,Rde=W(()=>{z7();B7();Ide();Ode=-.14861,j7=1.78277,U7=-.29227,Hk=-.90649,hA=1.97294,Cde=hA*Hk,kde=hA*j7,Pde=j7*U7-Hk*Ode;px(o_,xa,uA(i_,{brighter:function(e){return e=e==null?n_:Math.pow(n_,e),new o_(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Tp:Math.pow(Tp,e),new o_(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Tde,t=+this.l,r=isNaN(this.s)?0:this.s*t*(1-t),n=Math.cos(e),o=Math.sin(e);return new Ys(255*(t+r*(Ode*n+j7*o)),255*(t+r*(U7*n+Hk*o)),255*(t+r*(hA*n)),this.opacity)}}))});var _x=W(()=>{B7();Rde()});function V7(e,t,r,n,o){var i=e*e,s=i*e;return((1-3*e+3*i-s)*t+(4-6*i+3*s)*r+(1+3*e+3*i-3*s)*n+s*o)/6}function Nde(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),o=e[n],i=e[n+1],s=n>0?e[n-1]:2*o-i,a=n<t-1?e[n+2]:2*i-o;return V7((r-n/t)*t,s,o,i,a)}}var W7=W(()=>{});function zde(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),o=e[(n+t-1)%t],i=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return V7((r-n/t)*t,o,i,s,a)}}var Dde=W(()=>{W7()});function yx(e){return function(){return e}}var Z7=W(()=>{});function Lde(e,t){return function(r){return e+r*t}}function vze(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Fde(e,t){var r=t-e;return r?Lde(e,r>180||r<-180?r-360*Math.round(r/360):r):yx(isNaN(e)?t:e)}function Bde(e){return(e=+e)==1?xh:function(t,r){return r-t?vze(t,r,e):yx(isNaN(t)?r:t)}}function xh(e,t){var r=t-e;return r?Lde(e,r):yx(isNaN(e)?t:e)}var Y7=W(()=>{Z7()});function jde(e){return function(t){var r=t.length,n=new Array(r),o=new Array(r),i=new Array(r),s,a;for(s=0;s<r;++s)a=gx(t[s]),n[s]=a.r||0,o[s]=a.g||0,i[s]=a.b||0;return n=e(n),o=e(o),i=e(i),a.opacity=1,function(u){return a.r=n(u),a.g=o(u),a.b=i(u),a+""}}}var q7,z7t,D7t,Ude=W(()=>{_x();W7();Dde();Y7();q7=function e(t){var r=Bde(t);function n(o,i){var s=r((o=gx(o)).r,(i=gx(i)).r),a=r(o.g,i.g),u=r(o.b,i.b),h=xh(o.opacity,i.opacity);return function(p){return o.r=s(p),o.g=a(p),o.b=u(p),o.opacity=h(p),o+""}}return n.gamma=e,n}(1);z7t=jde(Nde),D7t=jde(zde)});function Vde(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),o;return function(i){for(o=0;o<r;++o)n[o]=e[o]*(1-i)+t[o]*i;return n}}function Wde(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var Zde=W(()=>{});function Yde(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,o=new Array(n),i=new Array(r),s;for(s=0;s<n;++s)o[s]=s_(e[s],t[s]);for(;s<r;++s)i[s]=t[s];return function(a){for(s=0;s<n;++s)i[s]=o[s](a);return i}}var qde=W(()=>{Xk()});function Gde(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}var Hde=W(()=>{});function Ip(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var Kk=W(()=>{});function Xde(e,t){var r={},n={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?r[o]=s_(e[o],t[o]):n[o]=t[o];return function(i){for(o in r)n[o]=r[o](i);return n}}var Kde=W(()=>{Xk()});function wze(e){return function(){return e}}function Aze(e){return function(t){return e(t)+""}}function $de(e,t){var r=H7.lastIndex=G7.lastIndex=0,n,o,i,s=-1,a=[],u=[];for(e=e+"",t=t+"";(n=H7.exec(e))&&(o=G7.exec(t));)(i=o.index)>r&&(i=t.slice(r,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,u.push({i:s,x:Ip(n,o)})),r=G7.lastIndex;return r<t.length&&(i=t.slice(r),a[s]?a[s]+=i:a[++s]=i),a.length<2?u[0]?Aze(u[0].x):wze(t):(t=u.length,function(h){for(var p=0,_;p<t;++p)a[(_=u[p]).i]=_.x(h);return a.join("")})}var H7,G7,Qde=W(()=>{Kk();H7=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,G7=new RegExp(H7.source,"g")});function s_(e,t){var r=typeof t,n;return t==null||r==="boolean"?yx(t):(r==="number"?Ip:r==="string"?(n=Ep(t))?(t=n,q7):$de:t instanceof Ep?q7:t instanceof Date?Gde:Wde(t)?Vde:Array.isArray(t)?Yde:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Xde:Ip)(e,t)}var Xk=W(()=>{_x();Ude();qde();Hde();Kk();Kde();Qde();Z7();Zde()});function X7(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var Jde=W(()=>{});function epe(e){return function t(r){r=+r;function n(o,i){var s=e((o=xa(o)).h,(i=xa(i)).h),a=xh(o.s,i.s),u=xh(o.l,i.l),h=xh(o.opacity,i.opacity);return function(p){return o.h=s(p),o.s=a(p),o.l=u(Math.pow(p,r)),o.opacity=h(p),o+""}}return n.gamma=t,n}(1)}var Mze,xx,tpe=W(()=>{_x();Y7();Mze=epe(Fde),xx=epe(xh)});var dA=W(()=>{Xk();Kk();Jde();tpe()});function $k(e){return function(){return e}}var Qk=W(()=>{});function K7(e){return+e}var $7=W(()=>{});function Jk(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:$k(t)}function Sze(e){return function(t,r){var n=e(t=+t,r=+r);return function(o){return o<=t?0:o>=r?1:n(o)}}}function Tze(e){return function(t,r){var n=e(t=+t,r=+r);return function(o){return o<=0?t:o>=1?r:n(o)}}}function Eze(e,t,r,n){var o=e[0],i=e[1],s=t[0],a=t[1];return i<o?(o=r(i,o),s=n(a,s)):(o=r(o,i),s=n(s,a)),function(u){return s(o(u))}}function Ize(e,t,r,n){var o=Math.min(e.length,t.length)-1,i=new Array(o),s=new Array(o),a=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<o;)i[a]=r(e[a],e[a+1]),s[a]=n(t[a],t[a+1]);return function(u){var h=e_(e,u,1,o)-1;return s[h](i[h](u))}}function pA(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp())}function bx(e,t){var r=rpe,n=rpe,o=s_,i=!1,s,a,u;function h(){return s=Math.min(r.length,n.length)>2?Ize:Eze,a=u=null,p}function p(_){return(a||(a=s(r,n,i?Sze(e):e,o)))(+_)}return p.invert=function(_){return(u||(u=s(n,r,Jk,i?Tze(t):t)))(+_)},p.domain=function(_){return arguments.length?(r=qk.call(_,K7),h()):r.slice()},p.range=function(_){return arguments.length?(n=r_.call(_),h()):n.slice()},p.rangeRound=function(_){return n=r_.call(_),o=X7,h()},p.clamp=function(_){return arguments.length?(i=!!_,h()):i},p.interpolate=function(_){return arguments.length?(o=_,h()):o},h()}var rpe,mA=W(()=>{qu();dA();Sp();Qk();$7();rpe=[0,1]});function npe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function a_(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}var gA=W(()=>{});function Xu(e){return e=a_(Math.abs(e)),e?e[1]:NaN}var _A=W(()=>{gA()});function ipe(e,t){return function(r,n){for(var o=r.length,i=[],s=0,a=e[0],u=0;o>0&&a>0&&(u+a+1>n&&(a=Math.max(1,n-u)),i.push(r.substring(o-=a,o+a)),!((u+=a+1)>n));)a=e[s=(s+1)%e.length];return i.reverse().join(t)}}var ope=W(()=>{});function spe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var ape=W(()=>{});function Cp(e){if(!(t=Cze.exec(e)))throw new Error("invalid format: "+e);var t;return new e4({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function e4(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}var Cze,Q7=W(()=>{Cze=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;Cp.prototype=e4.prototype;e4.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type}});function lpe(e){e:for(var t=e.length,r=1,n=-1,o;r<t;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var cpe=W(()=>{});function upe(e,t){var r=a_(e,t);if(!r)return e+"";var n=r[0],o=r[1],i=o-(J7=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=n.length;return i===s?n:i>s?n+new Array(i-s+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+a_(e,Math.max(0,t+i-1))[0]}var J7,eB=W(()=>{gA()});function tB(e,t){var r=a_(e,t);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var fpe=W(()=>{gA()});var rB,hpe=W(()=>{gA();eB();fpe();rB={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:npe,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return tB(e*100,t)},r:tB,s:upe,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}}});function nB(e){return e}var dpe=W(()=>{});function gpe(e){var t=e.grouping===void 0||e.thousands===void 0?nB:ipe(ppe.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?nB:spe(ppe.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function h(_){_=Cp(_);var y=_.fill,A=_.align,E=_.sign,k=_.symbol,P=_.zero,R=_.width,V=_.comma,N=_.precision,j=_.trim,J=_.type;J==="n"?(V=!0,J="g"):rB[J]||(N===void 0&&(N=12),j=!0,J="g"),(P||y==="0"&&A==="=")&&(P=!0,y="0",A="=");var ne=k==="$"?r:k==="#"&&/[boxX]/.test(J)?"0"+J.toLowerCase():"",de=k==="$"?n:/[%p]/.test(J)?s:"",fe=rB[J],ye=/[defgprs%]/.test(J);N=N===void 0?6:/[gprs]/.test(J)?Math.max(1,Math.min(21,N)):Math.max(0,Math.min(20,N));function ve(be){var je=ne,Re=de,Se,Ue,qe;if(J==="c")Re=fe(be)+Re,be="";else{be=+be;var Je=be<0||1/be<0;if(be=isNaN(be)?u:fe(Math.abs(be),N),j&&(be=lpe(be)),Je&&+be==0&&E!=="+"&&(Je=!1),je=(Je?E==="("?E:a:E==="-"||E==="("?"":E)+je,Re=(J==="s"?mpe[8+J7/3]:"")+Re+(Je&&E==="("?")":""),ye){for(Se=-1,Ue=be.length;++Se<Ue;)if(qe=be.charCodeAt(Se),48>qe||qe>57){Re=(qe===46?o+be.slice(Se+1):be.slice(Se))+Re,be=be.slice(0,Se);break}}}V&&!P&&(be=t(be,1/0));var gt=je.length+be.length+Re.length,rt=gt<R?new Array(R-gt+1).join(y):"";switch(V&&P&&(be=t(rt+be,rt.length?R-Re.length:1/0),rt=""),A){case"<":be=je+be+Re+rt;break;case"=":be=je+rt+be+Re;break;case"^":be=rt.slice(0,gt=rt.length>>1)+je+be+Re+rt.slice(gt);break;default:be=rt+je+be+Re;break}return i(be)}return ve.toString=function(){return _+""},ve}function p(_,y){var A=h((_=Cp(_),_.type="f",_)),E=Math.max(-8,Math.min(8,Math.floor(Xu(y)/3)))*3,k=Math.pow(10,-E),P=mpe[8+E/3];return function(R){return A(k*R)+P}}return{format:h,formatPrefix:p}}var ppe,mpe,_pe=W(()=>{_A();ope();ape();Q7();cpe();hpe();eB();dpe();ppe=Array.prototype.map,mpe=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"]});function iB(e){return t4=gpe(e),r4=t4.format,n4=t4.formatPrefix,t4}var t4,r4,n4,ype=W(()=>{_pe();iB({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"})});function oB(e){return Math.max(0,-Xu(Math.abs(e)))}var xpe=W(()=>{_A()});function sB(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Xu(t)/3)))*3-Xu(Math.abs(e)))}var bpe=W(()=>{_A()});function aB(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Xu(t)-Xu(e))+1}var vpe=W(()=>{_A()});var wpe=W(()=>{ype();Q7();xpe();bpe();vpe()});function Ape(e,t,r){var n=e[0],o=e[e.length-1],i=Mp(n,o,t??10),s;switch(r=Cp(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(n),Math.abs(o));return r.precision==null&&!isNaN(s=sB(i,a))&&(r.precision=s),n4(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=aB(i,Math.max(Math.abs(n),Math.abs(o))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=oB(i))&&(r.precision=s-(r.type==="%")*2);break}}return r4(r)}var Mpe=W(()=>{qu();wpe()});function yA(e){var t=e.domain;return e.ticks=function(r){var n=t();return Uk(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){return Ape(t(),r,n)},e.nice=function(r){var n=t(),o=n.length-1,i=r??10,s=n[0],a=n[o],u=Mp(s,a,i);return u&&(u=Mp(Math.floor(s/u)*u,Math.ceil(a/u)*u,i),n[0]=Math.floor(s/u)*u,n[o]=Math.ceil(a/u)*u,t(n)),e},e}function vx(){var e=bx(Jk,Ip);return e.copy=function(){return pA(e,vx())},yA(e)}var wx=W(()=>{qu();dA();mA();Mpe()});var Spe=W(()=>{Sp();wx();$7()});var lB=W(()=>{});var Tpe=W(()=>{qu();Qk();lB();mA()});var Epe=W(()=>{Qk();wx();mA()});var Ipe=W(()=>{qu();Sp()});var Cpe=W(()=>{qu();Sp();wx()});var kpe=W(()=>{qu();Sp()});var Pze,Oze,Rze,cB,Ujt,Vjt,Wjt,uB=W(()=>{qu();Sp();mA();lB();Pze=1e3,Oze=Pze*60,Rze=Oze*60,cB=Rze*24,Ujt=cB*7,Vjt=cB*30,Wjt=cB*365});var Ppe=W(()=>{uB()});function cl(e){return e.match(/.{6}/g).map(function(t){return"#"+t})}var Ax=W(()=>{});var Nze,Ope=W(()=>{Ax();Nze=cl("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf")});var zze,Rpe=W(()=>{Ax();zze=cl("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6")});var Dze,Npe=W(()=>{Ax();Dze=cl("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9")});var Lze,zpe=W(()=>{Ax();Lze=cl("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5")});var Fze,Dpe=W(()=>{_x();dA();Fze=xx(xa(300,.5,0),xa(-240,.5,1))});var Bze,jze,lUt,Lpe=W(()=>{_x();dA();Bze=xx(xa(-100,.75,.35),xa(80,1.5,.8)),jze=xx(xa(260,.75,.35),xa(80,1.5,.8)),lUt=xa()});function i4(e){var t=e.length;return function(r){return e[Math.max(0,Math.min(t-1,Math.floor(r*t)))]}}var Uze,Vze,Wze,Zze,Fpe=W(()=>{Ax();Uze=i4(cl("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),Vze=i4(cl("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),Wze=i4(cl("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),Zze=i4(cl("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"))});var Bpe=W(()=>{wx()});var jpe=W(()=>{gde();Spe();wx();Tpe();N7();Epe();Ipe();Cpe();kpe();uB();Ppe();Ope();Rpe();Npe();zpe();Dpe();Lpe();Fpe();Bpe()});function kp(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var l_=W(()=>{});function fB(e){return e.length===1&&(e=Yze(e)),{left:function(t,r,n,o){for(n==null&&(n=0),o==null&&(o=t.length);n<o;){var i=n+o>>>1;e(t[i],r)<0?n=i+1:o=i}return n},right:function(t,r,n,o){for(n==null&&(n=0),o==null&&(o=t.length);n<o;){var i=n+o>>>1;e(t[i],r)>0?o=i:n=i+1}return n}}}function Yze(e){return function(t,r){return kp(e(t),r)}}var hB=W(()=>{l_()});var Upe,qze,Gze,dB=W(()=>{l_();hB();Upe=fB(kp),qze=Upe.right,Gze=Upe.left});var Vpe=W(()=>{});var Mx=W(()=>{});var pB=W(()=>{Mx()});var mB=W(()=>{pB()});var gB=W(()=>{});var Wpe,Xze,Kze,_B=W(()=>{Wpe=Array.prototype,Xze=Wpe.slice,Kze=Wpe.map});var Zpe=W(()=>{});var Ype=W(()=>{});var yB=W(()=>{});var hVt,dVt,pVt,xB=W(()=>{yB();hVt=Math.sqrt(50),dVt=Math.sqrt(10),pVt=Math.sqrt(2)});var bB=W(()=>{});var qpe=W(()=>{_B();dB();Zpe();gB();Ype();xB();bB()});var s4=W(()=>{Mx()});var Hpe=W(()=>{_B();l_();Mx();s4()});var Xpe=W(()=>{mB()});function a4(e,t){var r=-1,n=e.length,o,i;if(t==null){for(;++r<n;)if((i=e[r])!=null&&i>=i){o=i;break}for(;++r<n;)(i=e[r])!=null&&i>o&&(o=i)}else{for(;++r<n;)if((i=t(e[r],r,e))!=null&&i>=i){o=i;break}for(;++r<n;)(i=t(e[r],r,e))!=null&&i>o&&(o=i)}return o}var Kpe=W(()=>{});var $pe=W(()=>{Mx()});var Qpe=W(()=>{l_();Mx();s4()});var Jpe=W(()=>{});var vB=W(()=>{});var eme=W(()=>{});var tme=W(()=>{});var rme=W(()=>{l_()});var nme=W(()=>{});function l4(e,t){var r=0,n=e.length,o,i=-1;if(t==null)for(;++i<n;)(o=+e[i])&&(r+=o);else for(;++i<n;)(o=+t(e[i],i,e))&&(r+=o);return r}var ime=W(()=>{});var wB=W(()=>{vB()});var ome=W(()=>{wB()});var sme=W(()=>{dB();l_();hB();Vpe();mB();gB();qpe();Hpe();Xpe();bB();Kpe();$pe();Qpe();Jpe();vB();eme();tme();s4();yB();rme();nme();ime();xB();wB();pB();ome()});function c4(){var e=vx(),t="rect",r=15,n=15,o=10,i=2,s=[5],a=void 0,u=[],h="",p=!1,_="",y=Ro.d3_defaultLocale,A=Ro.d3_defaultFormatSpecifier,E=10,k="middle",P=Ro.d3_defaultDelimiter,R=void 0,V="vertical",N=!1,j=void 0,J=void 0,ne=Fk("cellover","cellout","cellclick");function de(fe){var ye=Ro.d3_calcType(e,N,s,u,y.format(A),P),ve=fe.selectAll("g").data([e]);ve.enter().append("g").attr("class",h+"legendCells"),a&&Ro.d3_filterCells(ye,a);var be=fe.select("."+h+"legendCells").selectAll("."+h+"cell").data(ye.data),je=be.enter().append("g").attr("class",h+"cell");je.append(t).attr("class",h+"swatch");var Re=fe.selectAll("g."+h+"cell "+t+"."+h+"swatch").data(ye.data);Ro.d3_addEvents(je,ne),be.exit().transition().style("opacity",0).remove(),Re.exit().transition().style("opacity",0).remove(),Re=Re.merge(Re),Ro.d3_drawShapes(t,Re,n,r,o,j);var Se=Ro.d3_addText(fe,je,ye.labels,h,R);be=je.merge(be);var Ue=Se.nodes().map(function(At){return At.getBBox()}),qe=Re.nodes().map(function(At){return At.getBBox()});p?Re.attr("class",function(At){return h+"swatch "+ye.feature(At)}):t=="line"?Re.style("stroke",ye.feature):Re.style("fill",ye.feature);var Je=void 0,gt=void 0,rt=k=="start"?0:k=="middle"?.5:1;V==="vertical"?function(){var At=Ue.map(function(St,kt){return Math.max(St.height,qe[kt].height)});Je=function(kt,yt){var tr=l4(At.slice(0,yt));return"translate(0, "+(tr+yt*i)+")"},gt=function(kt,yt){return"translate( "+(qe[yt].width+qe[yt].x+E)+", "+(qe[yt].y+qe[yt].height/2+5)+")"}}():V==="horizontal"&&(Je=function(St,kt){return"translate("+kt*(qe[kt].width+i)+",0)"},gt=function(St,kt){return"translate("+(qe[kt].width*rt+qe[kt].x)+`,
          `+(qe[kt].height+qe[kt].y+E+8)+")"}),Ro.d3_placement(V,be,Je,Se,gt,k),Ro.d3_title(fe,_,h,J),be.transition().style("opacity",1)}return de.scale=function(fe){return arguments.length?(e=fe,de):e},de.cells=function(fe){return arguments.length?((fe.length>1||fe>=2)&&(s=fe),de):s},de.cellFilter=function(fe){return arguments.length?(a=fe,de):a},de.shape=function(fe,ye){return arguments.length?((fe=="rect"||fe=="circle"||fe=="line"||fe=="path"&&typeof ye=="string")&&(t=fe,j=ye),de):t},de.shapeWidth=function(fe){return arguments.length?(r=+fe,de):r},de.shapeHeight=function(fe){return arguments.length?(n=+fe,de):n},de.shapeRadius=function(fe){return arguments.length?(o=+fe,de):o},de.shapePadding=function(fe){return arguments.length?(i=+fe,de):i},de.labels=function(fe){return arguments.length?(u=fe,de):u},de.labelAlign=function(fe){return arguments.length?((fe=="start"||fe=="end"||fe=="middle")&&(k=fe),de):k},de.locale=function(fe){return arguments.length?(y=hx(fe),de):y},de.labelFormat=function(fe){return arguments.length?(A=Qg(fe),de):de.locale().format(A)},de.labelOffset=function(fe){return arguments.length?(E=+fe,de):E},de.labelDelimiter=function(fe){return arguments.length?(P=fe,de):P},de.labelWrap=function(fe){return arguments.length?(R=fe,de):R},de.useClass=function(fe){return arguments.length?((fe===!0||fe===!1)&&(p=fe),de):p},de.orient=function(fe){return arguments.length?(fe=fe.toLowerCase(),(fe=="horizontal"||fe=="vertical")&&(V=fe),de):V},de.ascending=function(fe){return arguments.length?(N=!!fe,de):N},de.classPrefix=function(fe){return arguments.length?(h=fe,de):h},de.title=function(fe){return arguments.length?(_=fe,de):_},de.titleWidth=function(fe){return arguments.length?(J=fe,de):J},de.textWrap=function(fe){return arguments.length?(textWrap=fe,de):textWrap},de.on=function(){var fe=ne.on.apply(ne,arguments);return fe===ne?de:fe},de}function ume(){var e=vx(),t="path",r=15,n=15,o=10,i=5,s=[5],a=void 0,u=[],h="",p="",_=Ro.d3_defaultLocale,y=Ro.d3_defaultFormatSpecifier,A="middle",E=10,k=Ro.d3_defaultDelimiter,P=void 0,R="vertical",V=!1,N=void 0,j=Fk("cellover","cellout","cellclick");function J(ne){var de=Ro.d3_calcType(e,V,s,u,_.format(y),k),fe=ne.selectAll("g").data([e]);a&&Ro.d3_filterCells(de,a),fe.enter().append("g").attr("class",h+"legendCells");var ye=ne.select("."+h+"legendCells").selectAll("."+h+"cell").data(de.data),ve=ye.enter().append("g").attr("class",h+"cell");ve.append(t).attr("class",h+"swatch");var be=ne.selectAll("g."+h+"cell "+t+"."+h+"swatch");Ro.d3_addEvents(ve,j),ye.exit().transition().style("opacity",0).remove(),be.exit().transition().style("opacity",0).remove(),be=be.merge(be),Ro.d3_drawShapes(t,be,n,r,o,de.feature);var je=Ro.d3_addText(ne,ve,de.labels,h,P);ye=ve.merge(ye);var Re=je.nodes().map(function(At){return At.getBBox()}),Se=be.nodes().map(function(At){return At.getBBox()}),Ue=a4(Se,function(At){return At.height}),qe=a4(Se,function(At){return At.width}),Je=void 0,gt=void 0,rt=A=="start"?0:A=="middle"?.5:1;R==="vertical"?function(){var At=Re.map(function(St,kt){return Math.max(Ue,St.height)});Je=function(kt,yt){var tr=l4(At.slice(0,yt));return"translate(0, "+(tr+yt*i)+" )"},gt=function(kt,yt){return"translate( "+(qe+E)+`,
              `+(Se[yt].y+Se[yt].height/2+5)+")"}}():R==="horizontal"&&(Je=function(St,kt){return"translate( "+kt*(qe+i)+",0)"},gt=function(St,kt){return"translate( "+(Se[kt].width*rt+Se[kt].x)+`,
              `+(Ue+E)+")"}),Ro.d3_placement(R,ye,Je,je,gt,A),Ro.d3_title(ne,p,h,N),ye.transition().style("opacity",1)}return J.scale=function(ne){return arguments.length?(e=ne,J):e},J.cells=function(ne){return arguments.length?((ne.length>1||ne>=2)&&(s=ne),J):s},J.cellFilter=function(ne){return arguments.length?(a=ne,J):a},J.shapePadding=function(ne){return arguments.length?(i=+ne,J):i},J.labels=function(ne){return arguments.length?(u=ne,J):u},J.labelAlign=function(ne){return arguments.length?((ne=="start"||ne=="end"||ne=="middle")&&(A=ne),J):A},J.locale=function(ne){return arguments.length?(_=hx(ne),J):_},J.labelFormat=function(ne){return arguments.length?(y=Qg(ne),J):J.locale().format(y)},J.labelOffset=function(ne){return arguments.length?(E=+ne,J):E},J.labelDelimiter=function(ne){return arguments.length?(k=ne,J):k},J.labelWrap=function(ne){return arguments.length?(P=ne,J):P},J.orient=function(ne){return arguments.length?(ne=ne.toLowerCase(),(ne=="horizontal"||ne=="vertical")&&(R=ne),J):R},J.ascending=function(ne){return arguments.length?(V=!!ne,J):V},J.classPrefix=function(ne){return arguments.length?(h=ne,J):h},J.title=function(ne){return arguments.length?(p=ne,J):p},J.titleWidth=function(ne){return arguments.length?(N=ne,J):N},J.on=function(){var ne=j.on.apply(j,arguments);return ne===j?J:ne},J}var oDe,cme,ame,lme,sDe,aDe,lDe,cDe,uDe,fDe,hDe,Ro,AB=W(()=>{Ahe();Dhe();jhe();jpe();sme();oDe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cme=function(t){return t},ame=function(t){for(var r=[],n=0,o=t.length;n<o;n++)r[n]=t[o-n-1];return r},lme=function(t,r){t.each(function(){for(var n=u7(this),o=n.text().split(/\s+/).reverse(),i,s=[],a=0,u=1.2,h=n.attr("y"),p=parseFloat(n.attr("dy"))||0,_=n.text(null).append("tspan").attr("x",0).attr("dy",p+"em");i=o.pop();)s.push(i),_.text(s.join(" ")),_.node().getComputedTextLength()>r&&s.length>1&&(s.pop(),_.text(s.join(" ")),s=[i],_=n.append("tspan").attr("x",0).attr("dy",u+p+"em").text(i))})},sDe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments[1],n=arguments[2],o=arguments[3],i=arguments[4];if((typeof r>"u"?"undefined":oDe(r))==="object"){if(r.length===0)return t;for(var s=r.length;s<t.length;s++)r.push(t[s]);return r}else if(typeof r=="function"){for(var a=[],u=t.length,h=0;h<u;h++)a.push(r({i:h,genLength:u,generatedLabels:t,domain:n,range:o,labelDelimiter:i}));return a}return t},aDe=function(t,r,n){var o=[];if(r.length>1)o=r;else for(var i=t.domain(),s=(i[i.length-1]-i[0])/(r-1),a=0;a<r;a++)o.push(i[0]+a*s);var u=o.map(n);return{data:o,labels:u,feature:function(p){return t(p)}}},lDe=function(t,r,n){var o=t.range().map(function(i){var s=t.invertExtent(i);return r(s[0])+" "+n+" "+r(s[1])});return{data:t.range(),labels:o,feature:cme}},cDe=function(t){return{data:t.domain(),labels:t.domain(),feature:function(n){return t(n)}}},uDe=function(t,r,n){t.call("cellover",n,r)},fDe=function(t,r,n){t.call("cellout",n,r)},hDe=function(t,r,n){t.call("cellclick",n,r)},Ro={d3_drawShapes:function(t,r,n,o,i,s){t==="rect"?r.attr("height",n).attr("width",o):t==="circle"?r.attr("r",i):t==="line"?r.attr("x1",0).attr("x2",o).attr("y1",0).attr("y2",0):t==="path"&&r.attr("d",s)},d3_addText:function(t,r,n,o,i){r.append("text").attr("class",o+"label");var s=t.selectAll("g."+o+"cell text."+o+"label").data(n).text(cme);return i&&t.selectAll("g."+o+"cell text."+o+"label").call(lme,i),s},d3_calcType:function(t,r,n,o,i,s){var a=t.invertExtent?lDe(t,i,s):t.ticks?aDe(t,n,i):cDe(t),u=t.range&&t.range()||t.domain();return a.labels=sDe(a.labels,o,t.domain(),u,s),r&&(a.labels=ame(a.labels),a.data=ame(a.data)),a},d3_filterCells:function(t,r){var n=t.data.map(function(s,a){return{data:s,label:t.labels[a]}}).filter(r),o=n.map(function(s){return s.data}),i=n.map(function(s){return s.label});return t.data=t.data.filter(function(s){return o.indexOf(s)!==-1}),t.labels=t.labels.filter(function(s){return i.indexOf(s)!==-1}),t},d3_placement:function(t,r,n,o,i,s){r.attr("transform",n),o.attr("transform",i),t==="horizontal"&&o.style("text-anchor",s)},d3_addEvents:function(t,r){t.on("mouseover.legend",function(n){uDe(r,n,this)}).on("mouseout.legend",function(n){fDe(r,n,this)}).on("click.legend",function(n){hDe(r,n,this)})},d3_title:function(t,r,n,o){if(r!==""){var i=t.selectAll("text."+n+"legendTitle");i.data([r]).enter().append("text").attr("class",n+"legendTitle"),t.selectAll("text."+n+"legendTitle").text(r),o&&t.selectAll("text."+n+"legendTitle").call(lme,o);var s=t.select("."+n+"legendCells"),a=t.select("."+n+"legendTitle").nodes().map(function(h){return h.getBBox().height})[0],u=-s.nodes().map(function(h){return h.getBBox().x})[0];s.attr("transform","translate("+u+","+a+")")}},d3_defaultLocale:{format:zk,formatPrefix:Dk},d3_defaultFormatSpecifier:".01f",d3_defaultDelimiter:"to"}});var hme=rd(MB=>{var c_=c_||{};c_.stringify=function(){var e={"visit_linear-gradient":function(t){return e.visit_gradient(t)},"visit_repeating-linear-gradient":function(t){return e.visit_gradient(t)},"visit_radial-gradient":function(t){return e.visit_gradient(t)},"visit_repeating-radial-gradient":function(t){return e.visit_gradient(t)},visit_gradient:function(t){var r=e.visit(t.orientation);return r&&(r+=", "),t.type+"("+r+e.visit(t.colorStops)+")"},visit_shape:function(t){var r=t.value,n=e.visit(t.at),o=e.visit(t.style);return o&&(r+=" "+o),n&&(r+=" at "+n),r},"visit_default-radial":function(t){var r="",n=e.visit(t.at);return n&&(r+=n),r},"visit_extent-keyword":function(t){var r=t.value,n=e.visit(t.at);return n&&(r+=" at "+n),r},"visit_position-keyword":function(t){return t.value},visit_position:function(t){return e.visit(t.value.x)+" "+e.visit(t.value.y)},"visit_%":function(t){return t.value+"%"},visit_em:function(t){return t.value+"em"},visit_px:function(t){return t.value+"px"},visit_literal:function(t){return e.visit_color(t.value,t)},visit_hex:function(t){return e.visit_color("#"+t.value,t)},visit_rgb:function(t){return e.visit_color("rgb("+t.value.join(", ")+")",t)},visit_rgba:function(t){return e.visit_color("rgba("+t.value.join(", ")+")",t)},visit_color:function(t,r){var n=t,o=e.visit(r.length);return o&&(n+=" "+o),n},visit_angular:function(t){return t.value+"deg"},visit_directional:function(t){return"to "+t.value},visit_array:function(t){var r="",n=t.length;return t.forEach(function(o,i){r+=e.visit(o),i<n-1&&(r+=", ")}),r},visit:function(t){if(!t)return"";var r="";if(t instanceof Array)return e.visit_array(t,r);if(t.type){var n=e["visit_"+t.type];if(n)return n(t);throw Error("Missing visitor visit_"+t.type)}else throw Error("Invalid node.")}};return function(t){return e.visit(t)}}();var c_=c_||{};c_.parse=function(){var e={linearGradient:/^(\-(webkit|o|ms|moz)\-)?(linear\-gradient)/i,repeatingLinearGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-linear\-gradient)/i,radialGradient:/^(\-(webkit|o|ms|moz)\-)?(radial\-gradient)/i,repeatingRadialGradient:/^(\-(webkit|o|ms|moz)\-)?(repeating\-radial\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},t="";function r(Je){var gt=new Error(t+": "+Je);throw gt.source=t,gt}function n(){var Je=o();return t.length>0&&r("Invalid input not EOF"),Je}function o(){return N(i)}function i(){return s("linear-gradient",e.linearGradient,u)||s("repeating-linear-gradient",e.repeatingLinearGradient,u)||s("radial-gradient",e.radialGradient,_)||s("repeating-radial-gradient",e.repeatingRadialGradient,_)}function s(Je,gt,rt){return a(gt,function(At){var St=rt();return St&&(Ue(e.comma)||r("Missing comma before color stops")),{type:Je,orientation:St,colorStops:N(j)}})}function a(Je,gt){var rt=Ue(Je);if(rt){Ue(e.startCall)||r("Missing (");var At=gt(rt);return Ue(e.endCall)||r("Missing )"),At}}function u(){return h()||p()}function h(){return Se("directional",e.sideOrCorner,1)}function p(){return Se("angular",e.angleValue,1)}function _(){var Je,gt=y(),rt;return gt&&(Je=[],Je.push(gt),rt=t,Ue(e.comma)&&(gt=y(),gt?Je.push(gt):t=rt)),Je}function y(){var Je=A()||E();if(Je)Je.at=P();else{var gt=k();if(gt){Je=gt;var rt=P();rt&&(Je.at=rt)}else{var At=R();At&&(Je={type:"default-radial",at:At})}}return Je}function A(){var Je=Se("shape",/^(circle)/i,0);return Je&&(Je.style=Re()||k()),Je}function E(){var Je=Se("shape",/^(ellipse)/i,0);return Je&&(Je.style=be()||k()),Je}function k(){return Se("extent-keyword",e.extentKeywords,1)}function P(){if(Se("position",/^at/,0)){var Je=R();return Je||r("Missing positioning value"),Je}}function R(){var Je=V();if(Je.x||Je.y)return{type:"position",value:Je}}function V(){return{x:be(),y:be()}}function N(Je){var gt=Je(),rt=[];if(gt)for(rt.push(gt);Ue(e.comma);)gt=Je(),gt?rt.push(gt):r("One extra comma");return rt}function j(){var Je=J();return Je||r("Expected color definition"),Je.length=be(),Je}function J(){return de()||ye()||fe()||ne()}function ne(){return Se("literal",e.literalColor,0)}function de(){return Se("hex",e.hexColor,1)}function fe(){return a(e.rgbColor,function(){return{type:"rgb",value:N(ve)}})}function ye(){return a(e.rgbaColor,function(){return{type:"rgba",value:N(ve)}})}function ve(){return Ue(e.number)[1]}function be(){return Se("%",e.percentageValue,1)||je()||Re()}function je(){return Se("position-keyword",e.positionKeywords,1)}function Re(){return Se("px",e.pixelValue,1)||Se("em",e.emValue,1)}function Se(Je,gt,rt){var At=Ue(gt);if(At)return{type:Je,value:At[rt]}}function Ue(Je){var gt,rt;return rt=/^[\n\r\t\s]+/.exec(t),rt&&qe(rt[0].length),gt=Je.exec(t),gt&&qe(gt[0].length),gt}function qe(Je){t=t.substr(Je)}return function(Je){return t=Je.toString(),n()}}();MB.parse=c_.parse;MB.stringify=c_.stringify});var WFe={};function zB(e){return e.getRootNode().host}function p4(e){return e.closest("#container.chart")}function $l(e,t,r){let n=e.select(t);return n.size()>0?n:r()}function u_(e,t,r="right"){if(r==="right"||r==="bottom")return e[r]<t[r];if(r==="left"||r==="top")return e[r]>t[r];throw`Direction being checked for overflow is invalid: ${r}`}function dme(e,t,r,n=0){let o=e==="x"?"width":"height",i=t[e],s=t[e]+t[o],a=r[e],u=r[e]+r[o],h=a+n>i&&a-n<s,p=u+n>i&&u-n<s,_=a+n<i&&u-n>s;return h||p||_}function d_(e,t){switch(e){case"date":case"datetime":return t instanceof Date?t:new Date(parseInt(t)).toLocaleString([],{dateStyle:"short",timeStyle:"medium"});case"integer":return parseInt(t,10);case"float":return parseFloat(t)}return t}function Gme(e,t){return t.crossValues.length===0?[]:e.crossValue.length===0?[]:((e.crossValue.split?e.crossValue.split("|"):Array.isArray(e.crossValue)?e.crossValue:[e.crossValue])||[e.key]).map((r,n)=>({name:t.crossValues[n].name,value:d_(t.crossValues[n].type,r)}))}function Hme(e,t){if(t.splitValues.length===0)return[];let r=[e.mainValue];return e.key?r=e.key.split("|"):e.mainValue?.split&&(r=e.mainValue.split("|")),t.splitValues.map((n,o)=>({name:n.name,value:d_(n.type,r[o])}))}function Xme(e,t){return t.mainValues.length>1?e.mainValues?t.mainValues.map((r,n)=>({name:r.name,value:d_(r.type,e.mainValues[n])})):t.mainValues.map(r=>({name:r.name,value:d_(r.type,e.row[zDe(e.key,r,t.realValues)])})):[{name:t.mainValues[0].name,value:d_(t.mainValues[0].type,e.colorValue||e.mainValue-e.baseValue||e.mainValue||e.mainValues)}]}function zDe(e,t,r){if(!e)return t.name;if(e.includes("|")){let n=e.split("|");return n[n.length-1]===t.name?e:`${r.includes(n[n.length-1])?n.slice(0,n.length-1).join("|"):e}|${t.name}`}return r.includes(e)?t.name:`${e}|${t.name}`}function DDe(e,t,r){let n=Gme(t,r).concat(Hme(t,r)).concat(Xme(t,r));LDe(e,n)}function LDe(e,t){e.select("#tooltip-values").selectAll("li").data(t).join("li").each(function(r){$t(this).text(`${r.name}: `).append("b").text(FDe(r.value))})}function jDe(e){return $l(e,"div.tooltip",()=>e.append("div").attr("class","tooltip").style("z-index",3).style("opacity",0).html(NDe))}function UDe(e,t,r,n){let o=e.getBoundingClientRect(),i=t.getBoundingClientRect(),s=i.left+i.width/2-o.left,a=i.top-o.top+e.scrollTop;n&&(a=i.top+i.height/2-o.top+e.scrollTop),r.style("left",`${s}px`).style("top",`${a}px`).style("opacity",.9),n&&([s,a]=VDe(r,o)),WDe(r,o,s,a,n)}function VDe(e,t){let r=e.node().getBoundingClientRect(),n=r.width/2,o=r.left-n-t.left;e.style("left",`${o}px`);let i=r.height/2,s=r.top-i-t.top;return e.style("top",`${s}px`),[o,s]}function WDe(e,t,r,n,o=!1){let i=e.node().getBoundingClientRect();if(u_(t,i)){let s=i.right-t.right;e.style("left",`${r-s}px`)}if(u_(t,i,"bottom")){let s=i.bottom-t.bottom;e.style("top",`${n-s}px`)}if(o){if(u_(t,i,"left")){let s=i.left-t.left;e.style("left",`${r-s}px`)}if(u_(t,i,"top")){let s=i.top-t.top;e.style("top",`${n-s}px`)}}}function mme(e){e&&e.style("opacity",0)}function Kme(e,t){let r=e.mainValues.length>1?bh.seriesSvgGrouped(bh.seriesSvgBar()):bh.seriesSvgBar();return r=r.decorate(n=>{g4().settings(e)(n),n.style("fill",o=>t(o.key))}),bh.autoBandwidth(ZDe(r)).crossValue(n=>n.crossValue).mainValue(n=>n.mainValue?n.mainValue:0).baseValue(n=>n.baseValue)}function _4(e){return e.split("|").slice(0,-1).join("|")}function $me(e,t){return e.data.map(r=>Object.entries(r).filter(([n,o])=>n.split("|").at(-1)===t&&!!o).map(([n,o])=>o)).flat()}function MA(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(n=>n!=="__ROW_PATH__");return Op().settings(e).domain(r)()}function YDe(e,t){let r=$me(e,t),n=[...new Set(r)].sort();return Op().settings(e).domain(n)()}function f4(e,t){let r=[...new Set(t)];return Op().settings(e).domain(r)()}function qDe(e){let t=e.data[0]??{},r=Object.keys(t).filter(o=>o!=="__ROW_PATH__").map(o=>_4(o)),n=[...new Set(r)];return Op().settings(e).domain(n)()}function Op(){let e=null,t=null,r={},n=i=>y4(i,r.colorStyles&&r.colorStyles.opacity),o=()=>{let i=r.colorStyles,s=t||[i.series];if(s||e.length>1){let a=e.length>1?i.scheme:s;return sl(a.map(n)).domain(e)}return null};return o.domain=(...i)=>i.length===0?e:(e=i[0],o),o.defaultColors=(...i)=>i.length?(t=i[0],o):t,o.mapFunction=(...i)=>i.length?(n=i[0],o):n,o.settings=(...i)=>i.length?(r=i[0],o):r,o}function SA(e){return bA(1)(e)}function y4(e,t=.5){return bA(t)(e)}function bA(e){return t=>{let r=Vo(t);return r!=null&&(r.opacity=e),r+""}}function x4(e,t,{stack:r=!1,excludeEmpty:n=!1}={}){let o=t||e.data;return e.splitValues.length>0?HDe(e,o,{stack:r,excludeEmpty:n}):[o]}function HDe(e,t,{stack:r=!1,excludeEmpty:n=!1}){let o={};return t.forEach(i=>{let s={},a={};Object.keys(i).filter(u=>u!=="__ROW_PATH__").filter(u=>!n||i[u]!=null&&i[u]!=null).forEach(u=>{let h=u.split("|"),p=h[h.length-1],_=i[u]||0,y=`${p}${_>=0?"+ve":"-ve"}`,A=h.slice(0,h.length-1).join("|"),E=a[A]=a[A]||{__ROW_PATH__:i.__ROW_PATH__},k=s[y]||0;E.__KEY__=A,r?(E[p]=k+_,E[`__BASE_VALUE__${p}`]=k,s[y]=E[p]):E[p]=_,E.row=i}),Object.keys(a).forEach(u=>{(o[u]=o[u]||[]).push(a[u])})}),Object.keys(o).map(i=>{let s=o[i];return s.key=i,s})}function XDe(e,t){let r={stack:!1},n=x4(e,t,r).map(o=>ege(e,o,r));return e.mainValues.length>1?n.reduce((o,i)=>o.concat(i)):n}function Jme(e,t){let r={stack:!0};return x4(e,t,r).map(n=>ege(e,n,r))}function KDe(e,t,{stack:r=!1}){let n=Cx(e);return o=>{let i=a=>r&&a[`__BASE_VALUE__${o.name}`]||0,s=t.map((a,u)=>({crossValue:n(a,u),mainValue:a[o.name]?a[o.name]:null,baseValue:i(a),key:a.__KEY__?`${a.__KEY__}|${o.name}`:o.name,row:a.row||a}));return s.key=s[0].key,s}}function ege(e,t,{stack:r=!1}){let n=KDe(e,t,{stack:r});return e.mainValues.length>1?e.mainValues.map(n):n(e.mainValues[0])}function QDe(e){let t=e.select("g.legendCells"),r=e.node().getBoundingClientRect();if(!u_(r,t.node().getBoundingClientRect()))return;let n=e.select(".legend");t.selectAll(".label").text((o,i,s)=>{let a=s[i];if(u_(r,a.getBoundingClientRect())){let u=JDe(a,n,r);return`${o.substring(0,u-3)}...`}else return o})}function JDe(e,t,r){let n=e.getBoundingClientRect(),o=t.node().createSVGPoint(),i=3;return o.x=r.right-n.left-i,o.y=0,e.getCharNumAtPosition(o)}function Tx(e,t,r){let n=$t(zB(e).getContainer()).node().getBoundingClientRect(),o=e.getBoundingClientRect(),i={top:o.top+r-Sx,right:o.right+t+Sx,bottom:o.bottom+r+Sx,left:o.left+t-Sx},s={x:t,y:r};return[{edge:"right",dimension:"x"},{edge:"left",dimension:"x"},{edge:"top",dimension:"y"},{edge:"bottom",dimension:"y"}].forEach(a=>{if(u_(n,i,a.edge)){let u=i[a.edge]-n[a.edge];s[a.dimension]=s[a.dimension]-u}}),s}function eLe(){let e=!0,t=null,r=n=>{let o=n.node(),i=o.getRootNode().host.closest("perspective-viewer");o.style.cursor="move",t.legend&&(o.style.left=t.legend.left,o.style.top=t.legend.top);let s=hg().on("drag",function(a){let u=Tx(this,a.dx,a.dy);this.style.left=`${this.offsetLeft+u.x}px`,this.style.top=`${this.offsetTop+u.y}px`;let h={left:this.style.left,top:this.style.top};t.legend={...t.legend,...h},e=nLe(o)?rLe(o):tLe(o,e)});s.on("end",function(a){$t(window).on(FB,null),i?.dispatchEvent(new Event("perspective-config-update"))}),n.call(s)};return r.settings=(...n)=>n.length?(t=n[0],r):t,r}function tLe(e,t){return t!==!1&&$t(window).on(FB,function(){let r=Tx(e,0,0);e.style.left=`${e.offsetLeft+r.x}px`,e.style.top=`${e.offsetTop+r.y}px`}),!1}function rLe(e){return $t(window).on(FB,null),e.style.left="auto",!0}function nLe(e){let t=e.getBoundingClientRect(),r=$t(p4(e)).node().getBoundingClientRect(),n=5;return t.right+Sx+n>=r.right&&t.top-Sx-n<=r.top}function oLe(){let e=9,t=3,r=null,n={height:100,width:100},o={height:null,width:null},i=[],s=(p,_)=>i.filter(y=>y.event===p).forEach(y=>y.execute(_)),a=p=>{if(aLe(p))return;let _={left:yt=>s(Pp,{horizontal:Ue(yt),vertical:!1}),top:yt=>s(Pp,{horizontal:!1,vertical:Je(yt)}),right:yt=>s(Pp,{horizontal:qe(yt),vertical:!1}),bottom:yt=>s(Pp,{horizontal:!1,vertical:gt(yt)}),topleft:yt=>s(Pp,{horizontal:Ue(yt),vertical:Je(yt)}),topright:yt=>s(Pp,{horizontal:qe(yt),vertical:Je(yt)}),bottomright:yt=>s(Pp,{horizontal:qe(yt),vertical:gt(yt)}),bottomleft:yt=>s(Pp,{horizontal:Ue(yt),vertical:gt(yt)})},y=p.node();r.legend&&(y.style.height=r.legend.height,y.style.width=r.legend.width);let A=y.getBoundingClientRect(),E=p.append("svg").attr("id",rge).attr("width",A.width).attr("height",A.height),k=E.append("g"),P=yt=>yt==="left"||yt==="right",R={left:0,top:e,right:A.width-e,bottom:e},V={left:e,top:0,right:e,bottom:A.height-e},N=["left","top","right","bottom"],[j,J,ne,de]=N.map(yt=>k.append("rect").attr("id",`drag${yt}`).attr("class",P(yt)?_me:gme).attr("y",V[yt]).attr("x",R[yt]).attr("height",P(yt)?A.height-e*2:e).attr("width",P(yt)?e:A.width-e*2).attr("fill",P(yt)?"lightgreen":"lightblue").attr("fill-opacity",yme).style("z-index",t).attr("cursor",P(yt)?"ew-resize":"ns-resize").call(hg().on("drag",_[yt]))),fe=yt=>`${yt[0]}${yt[1]}`,ye={topleft:"nwse",topright:"nesw",bottomright:"nwse",bottomleft:"nesw"},ve=[["top","left"],["top","right"],["bottom","right"],["bottom","left"]],[be,je,Re,Se]=ve.map(yt=>k.append("rect").attr("id",`drag${fe(yt)}`).attr("class",`${iLe} ${yt[0]} ${yt[1]}`).attr("height",e).attr("width",e).attr("fill","red").attr("fill-opacity",yme).style("z-index",t).attr("cursor",`${ye[fe(yt)]}-resize`).call(hg().on("drag",_[fe(yt)])));kt("height","y",de),kt("width","x",ne),St(E);function Ue(yt){let tr=h(Tx(j.node(),yt.x,0).x,E,"width",(vr,wr)=>vr-wr);return y.style.left=`${y.offsetLeft+tr}px`,y.style.width=`${y.offsetWidth-tr}px`,rt(),At(ne,tr,"width","x")}function qe(yt){let tr=-h(Tx(ne.node(),yt.dx,0).x,E,"width",(vr,wr)=>vr+wr);return u(tr,"x",ne,yt)?!1:(y.style.width=`${y.offsetWidth-tr}px`,rt(),At(ne,tr,"width","x"))}function Je(yt){let tr=h(Tx(J.node(),0,yt.y).y,E,"height",(vr,wr)=>vr-wr);return y.style.top=`${y.offsetTop+tr}px`,y.style.height=`${y.offsetHeight-tr}px`,rt(),At(de,tr,"height","y")}function gt(yt){let tr=-h(Tx(de.node(),0,yt.dy).y,E,"height",(vr,wr)=>vr+wr);return u(tr,"y",de,yt)?!1:(y.style.height=`${y.offsetHeight-tr}px`,rt(),At(de,tr,"height","y"))}function rt(){let yt={top:y.style.top,left:y.style.left,height:y.style.height,width:y.style.width};r.legend={...r.legend,...yt}}function At(yt,tr,vr,wr){return cLe(E,vr,tr),lLe(yt,wr,tr),sLe(E,tr,vr,vr==="height"?_me:gme),St(E),tr!=0}function St(yt){be.attr("y",0),je.attr("y",0).attr("x",yt.attr("width")-e),Re.attr("y",yt.attr("height")-e).attr("x",yt.attr("width")-e),Se.attr("y",yt.attr("height")-e).attr("x",0)}function kt(yt,tr,vr){o[yt]&&o[yt]<A[yt]&&(y.style[yt]=`${o[yt]}px`,At(vr,A[yt]-o[yt],yt,tr))}};a.on=(p,_)=>(i.push({event:p,execute:_}),a),a.zIndex=p=>(t=p,a),a.settings=(...p)=>p.length?(r=p[0],a):r,a.minWidth=p=>(n.width=p,o.width&&(o.width=Math.max(n.width,o.width)),a),a.minHeight=p=>(n.height=p,o.height&&(o.height=Math.max(n.height,o.height)),a),a.handleWidth=p=>(e=p,a),a.maxWidth=p=>(o.width=p,n.width=Math.min(n.width,o.width),a),a.maxHeight=p=>(o.height=p,n.height=Math.min(n.height,o.height),a);function u(p,_,y,A){let E=(P,R,V,N)=>P<0&&N[R]<Number(V.attr(R)),k=(P,R,V,N)=>P>0&&N[R]>Number(V.attr(R));return E(p,_,y,A)||k(p,_,y,A)}function h(p,_,y,A){let E=A(Number(_.attr(y)),p);if(E<n[y]){let k=n[y]-E;return A(p,k)}if(o[y]&&E>o[y]){let k=o[y]-E;return A(p,k)}return p}return a}function oge(e){if(!e)return null;let t=e.domain(),r=e.range().map(n=>rx().type(n)());return sl().domain(t).range(r)}function BB(e,t=void 0){let r={},n=null,o=null,i=s=>{if(n&&n.range().length>1){let a=e(r);a.scale(n).orient("vertical").on("cellclick",function(h){let p=this.__data__;r.hideKeys=r.hideKeys||[],r.hideKeys.includes(p)?r.hideKeys=r.hideKeys.filter(_=>_!==p):r.hideKeys.push(p),zB(this)._draw()}),a.labels(h=>{let p=String(h.domain[h.i]).split("|");return r.mainValues.length<=1&&p.length>1?p.slice(0,p.length-1).join("|"):h.domain[h.i]});let u=$l(s,"div.legend-container",()=>s.append("div"));a.decorate(h=>{let p=y=>r.hideKeys&&r.hideKeys.includes(y),_=h.select("g.legendCells").attr("transform","translate(20,20)").selectAll("g.cell");_.classed("hidden",p),_.append("title").html(y=>y),o&&_.select("circle, path").style("fill",y=>p(y)?null:o(y)).style("stroke",y=>p(y)?null:SA(o(y)))}),u.attr("class","legend-container").attr("borderbox-on-hover",!0).style("z-index","2").call(a)}};return i.settings=(...s)=>s.length===0?r:(r=s[0],i),i.scale=(...s)=>s.length?(n=t?t(s[0]):s[0],i):n,i.color=(...s)=>s.length?(o=s[0],i):o,i}function kx(e,t=void 0){let r=t||e.data;return(e.hideKeys?.length??0)>0?r.map(n=>{let o={...n};return e.hideKeys.forEach(i=>{delete o[i]}),o}):r}function jB(e){let t=e.data,r=e.hideKeys?.length??0,n=e.splitValues.length;return r>0?n===0?t.filter(o=>Object.values(o).reduce((i,s)=>i&&!e.hideKeys.includes(s),!0)):t.map(o=>{let i=Object.entries(o).filter(([s,a])=>!e.hideKeys.includes(_4(s)));return Object.fromEntries(i)}):t}function UB(e,t){return e===0?t?t.textStyles.color:"#666":t?t.colorStyles.grid.gridLineColor:"#bbb"}function age(e,t){let r=Jme(t,kx(t)),n=MA(t),o=zp().settings(t).scale(n),i=Kme(t,n).orient("horizontal"),s=Pme.seriesSvgMulti().mapping((_,y)=>_[y]).series(r.map(()=>i)),a=xs(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[0]).excludeType(Yo.ordinal).include([0]).paddingStrategy(Lp())(r),u=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue").orient("vertical")(r),h=Ix(a,u).plotArea(vh(s,t).orient("horizontal"));h.yPaddingInner&&(h.yPaddingInner(.5),h.yPaddingOuter(.25),i.align("left")),h.xNice&&h.xNice();let p=wh().chart(h).settings(t).yScale(u.scale);e.datum(r).call(p),e.call(o)}function fge(e,t){let r=Jme(t,kx(t)),n=MA(t),o=zp().settings(t).scale(n),i=Kme(t,n).orient("vertical"),s=lge.seriesSvgMulti().mapping((k,P)=>k[P]).series(r.map(()=>i)),a=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue")(r),u=xs(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(Yo.ordinal).orient("vertical").include([0]).paddingStrategy(Lp()),h=t.mainValues.length>1?vLe:uge,p=b4(t,r,h).color(n),_=u(p.data()),y=p.haveSplit()?s:vh(s,t).orient("vertical"),A=Ix(a,_).axisSplitter(p).plotArea(y);A.xPaddingInner&&(A.xPaddingInner(.5),A.xPaddingOuter(.25),i.align("left")),A.yNice&&A.yNice();let E=wh().chart(A).settings(t).xScale(a.scale);if(p.haveSplit()){let k=u(p.altData());yLe(_.domain,k.domain),A.yDomain(_.domain).altAxis(k)}e.datum(p.data()).call(E),e.call(o)}function VB(e,t){let r=dge.seriesSvgLine(),n=e.data.length*(e.data?.length>0?Object.keys(e.data[0]).length-(e.crossValues?.length>0?1:0):0),o=Math.max(1,Math.min(3,Math.floor(e.size.width/n/2)));return r=r.decorate(i=>{i.style("stroke",s=>SA(t(s[0]&&s[0].key))).style("stroke-width",o)}),r.crossValue(i=>i.crossValue).mainValue(i=>i.mainValue)}function ALe(e,t){let r=Cx(e);return t.map((n,o)=>Object.keys(n).filter(i=>i!=="__ROW_PATH__").map(i=>({key:i,crossValue:r(n,o),mainValue:n[i],row:n})))}function mge(e,t){let r=ALe(t,kx(t)),n=MA(t),o=zp().settings(t).scale(n),i=hge.seriesSvgRepeat().series(VB(t,n)).orient("horizontal"),s=Lp().pad([.1,.1]).padUnit("percent"),a=b4(t,pge(r)).color(n),u=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue")(r),h=xs(t).settingName("mainValues").valueName("mainValue").memoValue(a.haveSplit()?null:t.axisMemo[0]).orient("vertical").paddingStrategy(s),p=h(a.data()),_=a.haveSplit()?i:vh(i,t).orient("vertical"),y=Ix(u,p).axisSplitter(a).plotArea(_);y.yNice&&y.yNice();let A=wh().chart(y).settings(t).xScale(u.scale),E=m_().settings(t).xScale(u.scale).yScale(p.scale).color(n).data(r);if(a.haveSplit()){let P=h(a.altData());y.altAxis(P),E.data(a.data()).altDataWithScale({yScale:P.scale,data:a.altData()})}let k=a.data();e.datum(k).call(A),e.call(E),e.call(o)}function WB(e){return e.length>1?sl().domain(e).range(TLe):null}function CLe(e,t,r,n,o,i,s=1){let a=(0,_ge.seriesCanvasPoint)().crossValue(u=>u.x).mainValue(u=>u.y);return i&&a.type(u=>i(u.row[t])),r&&a.size(u=>Math.round(s*r(u.size))),a.decorate((u,h)=>{let p=n(h.colorValue),_=e.colorStyles?.opacity;if(o){let{type:y}=e.mainValues.find(E=>E.name===o),A=d_(y,h.row[o]);if(A!==null){u.fillStyle=e.textStyles.color,u.font=e.textStyles.font;let E=0;r&&(E=Math.sqrt(s*r(h.size)/Math.PI)*ILe);let k=E+ELe;u.fillText(A,k,4)}}u.strokeStyle=SA(p),u.fillStyle=y4(p,_)}),a}function kLe(e,t){let r=[...new Set($me(e,t))];return WB(r)}function PLe(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=[];return Object.keys(t).forEach(n=>{if(n!=="__ROW_PATH__"){let o=_4(n);r.includes(o)||r.push(o)}}),WB(r)}function OLe(e,t){let r=e.mainValues.length;return t.map(n=>{let o=Object.keys(n).filter(s=>s!=="__ROW_PATH__"),i=new Array(o.length/r);for(let s=0;s<o.length/r;s++)i[s]={key:_4(o[s*r]),crossValue:n[o[s*r]],mainValue:n[o[s*r+1]],row:n};return i})}function xge(e,t){let r=pge(OLe(t,jB(t))),n=qDe(t),o=PLe(t),i=null;n.domain().length>=2&&(i=fLe().settings(t).scale(o).color(n));let s=gge.seriesSvgRepeat().series(VB(t,n)).orient("horizontal"),a=Lp().pad([.1,.1]).padUnit("percent"),u=xs(t).settingName("mainValues").settingValue(t.mainValues[0].name).valueName("crossValue").memoValue(t.axisMemo[0]).paddingStrategy(a),h=xs(t).settingName("mainValues").settingValue(t.mainValues[1].name).valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(a)(r),p=u(r),_=vh(s,t).orient("vertical"),y=Ix(p,h).xLabel(t.mainValues[0].name).yLabel(t.mainValues[1].name).plotArea(_);y.xNice&&y.xNice(),y.yNice&&y.yNice();let A=wh().chart(y).settings(t).xScale(p.scale).yScale(h.scale),E=m_().settings(t).xScale(p.scale).yScale(h.scale).color(n).data(r);e.datum(r).call(A),e.call(E),i&&e.call(i)}function NLe(e,t){let r=bge.seriesSvgArea();return r=r.decorate(n=>{n.style("fill",o=>t(o[0].key)).style("opacity",.5)}),r.crossValue(n=>n.crossValue).mainValue(n=>n.mainValue).baseValue(n=>n.baseValue)}function zLe(e,t){let r=Cx(e);return t.map((n,o)=>{let i={};return Object.keys(n).filter(s=>s!=="__ROW_PATH__").map(s=>{let a=s.split("|"),u=a[a.length-1],h=i[u]||0,p=h+n[s];return i[u]=p,{key:s,crossValue:r(n,o),mainValue:p,baseValue:h,row:n}})})}function vge(e,t){let r=zLe(t,kx(t)),n=MA(t),o=zp().settings(t).scale(n),i=vA.seriesSvgRepeat().series(NLe(t,n).orient("vertical")),s=vA.seriesSvgRepeat().series(VB(t,n)).orient("vertical"),a=vA.seriesSvgMulti().series([i,s]),u=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue")(r),h=xs(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).excludeType(Yo.ordinal).orient("vertical").include([0]).paddingStrategy(Lp()),p=b4(t,r).color(n),_=h(p.data()),y=p.haveSplit()?a:vh(a,t).orient("vertical"),A=Ix(u,_).axisSplitter(p).plotArea(y);A.yNice&&A.yNice();let E=wh().chart(A).settings(t).xScale(u.scale),k=m_().settings(t).xScale(u.scale).yScale(_.scale).color(n).data(r);if(p.haveSplit()){let P=h(p.altData());A.altAxis(P),k.data(p.data()).altDataWithScale({yScale:P.scale,data:p.altData()})}e.datum(p.data()).call(E),e.call(k),e.call(o)}function LLe(e,t,r,n){let o=Age.seriesSvgPoint().size(100),i=e.colorStyles&&e.colorStyles.opacity;return n&&o.type(n(t)),o.decorate(s=>{s.style("stroke",a=>SA(r(a.colorValue||t))).style("fill",a=>y4(r(a.colorValue||t),i))}),o.crossValue(s=>s.crossValue).mainValue(s=>s.mainValue)}function FLe(e){let t=e.data&&e.data.length>0?e.data[0]:{},r=Object.keys(t).filter(n=>n!=="__ROW_PATH__");return WB(r)}function Mge(e,t){let r=XDe(t,kx(t)),n=FLe(t),o=MA(t),i=kB().settings(t).scale(n).color(o),s=wge.seriesSvgMulti().mapping((P,R)=>P[R]).series(r.map(P=>LLe(t,P.key,o,n))),a=Lp().pad([.05,.05]).padUnit("percent"),u=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue")(r),h=xs(t).settingName("mainValues").valueName("mainValue").memoValue(t.axisMemo[1]).orient("vertical").paddingStrategy(a),p=b4(t,r).color(o),_=h(p.data()),y=p.haveSplit()?s:vh(s,t).orient("vertical"),A=Ix(u,_).axisSplitter(p).plotArea(y);A.yNice&&A.yNice();let E=wh().chart(A).settings(t).xScale(u.scale),k=m_().settings(t).xScale(u.scale).yScale(_.scale).color(o).data(r);if(p.haveSplit()){let P=h(p.altData());A.altAxis(P),k.data(p.data()).altDataWithScale({yScale:P.scale,data:p.altData()})}e.datum(p.data()).call(E),e.call(k),i&&e.call(i)}function jLe(e,t){return x4(e,t,{excludeEmpty:!0}).map(r=>ULe(e,r))}function ULe(e,t){let r=Cx(e),n=t.map((o,i)=>({crossValue:r(o,i),mainValues:e.mainValues.map(s=>o[s.name]),x:o[e.mainValues[0].name],y:o[e.mainValues[1].name],colorValue:e.realValues[2]?o[e.realValues[2]]:void 0,size:e.realValues[3]?o[e.realValues[3]]:void 0,key:t.key,row:o}));return n.key=t.key,n}function VLe(e,t,r,n){return Oc().domain(Sge(t,r,n))}function w4(e,t,r,n=null){let o=Sge(t,r,n),i=e.colorStyles.gradient.full;if(o[0]>=0)i=e.colorStyles.gradient.positive;else if(o[1]<=0)i=e.colorStyles.gradient.negative;else{let a=Math.max(-o[0],o[1]);o=[-a,a]}let s=WLe(i);return mh(s).domain(o)}function A4(){let e=null;function t(r){let n=$l(r,"div.legend-container",()=>r.append("div").attr("class","legend-container legend-color").style("z-index","2")),{width:o,height:i}=n.node().getBoundingClientRect(),s=Vl().domain([0,1]).range([0,o]),a=e.copy().nice().domain(),u=Fp.extentLinear().pad([.1,.1]).padUnit("percent")(a),[h,p]=u,_=ca(h,p,(p-h)/i),y=Oc().domain(u).range([i,0]),A=Fp.autoBandwidth(Fp.seriesSvgBar()).xScale(s).yScale(y).crossValue(0).baseValue((J,ne)=>_[Math.max(0,ne-1)]).mainValue(J=>J).decorate(J=>{J.selectAll("path").style("fill",ne=>e(ne))}),E=a[0]<0&&a[1]>0?0:Math.round((a[1]+a[0])/2),k=[...a,E],P=Fme(h,p),R=Fp.axisRight(y).tickValues(k).tickSizeOuter(0).tickFormat(J=>P(J)),V=$l(n,"svg",()=>n.append("svg")).style("width",o).style("height",i),N=$l(V,"g",()=>V.append("g")).datum(_).call(A),j=Math.abs(N.node().getBBox().x);$l(V,"#legend-axis",()=>V.append("g").attr("id","legend-axis")).attr("transform",`translate(${j})`).datum(_).call(R).select(".domain").attr("visibility","hidden")}return t.scale=(...r)=>r.length?(e=r[0],t):e,t}function ZB(){let e="element-prefix-unset",t=null,r=null,n=null,o=null,i=null,s=null,a=!0,u=null,h=p=>{let _=$l(p,"div.outer-container",()=>p.append("div").attr("class","outer-container").style("width",`calc(100% - ${u??0})`).style("height",`calc(100% - ${u??0})`).style("padding-left",u??0)),y=$l(_,"div.inner-container",()=>_.append("div").attr("class","inner-container")),A=_.node().getBoundingClientRect(),E=A.height,k=A.width-(i?70:0),P=300,R=p.datum(),V=Math.max(1,Math.min(R.length,Math.floor(k/P))),N=Math.ceil(R.length/V);s={width:k/Math.max(V,1),height:Math.min(E,Math.max(E/N,k/Math.max(V,1)))},E/N>s.height*.75&&(s.height=E/N),R.length>1?(y.style("grid-template-columns",`repeat(${V}, ${100/V}%)`),y.style("grid-template-rows",`repeat(${N}, ${s.height}px)`)):(y.style("grid-template-columns","repeat(1, 100%)"),y.style("grid-template-rows","repeat(1, 100%)")),n=y.selectAll(`div.${e}-container`).data(R,j=>j.split),n.exit().remove(),r=n.enter().append("div").attr("class",`${e}-container`),o=r.append("div").attr("class","title-container").style("text-align","center").attr("display","inline-block").append("text").attr("class","title").style("text-align","left"),a?t=r.append("svg").append("g").attr("class",e):t=r.append("div").attr("class",e)};return h.padding=(...p)=>p.length?(u=p[0],h):u,h.svg=(...p)=>p.length?(a=p[0],h):a,h.elementsPrefix=(...p)=>p.length?(e=p[0],h):e,h.chartContainer=()=>t,h.chartEnter=()=>r,h.chartDiv=()=>n,h.chartTitle=()=>o,h.containerSize=()=>s,h}function ZLe([e,t],[r,n]){let o=(n-t)/(r-e),i=n-o*r;return function(s){let a=s.node(),u=Math.min(a.clientWidth,a.clientHeight);return Math.min(n,Math.max(t,o*u+i))}}function Sme(){let e=null,t=null,r=null,n=null,o=i=>{let s=!!e.realValues[2],a=e.realValues[4],u=e.realValues[3]?VLe(e,t,"size").range([10,1e4]):null,h=e.realValues[5],p=ZLe([600,.1],[1600,1])(i),_=Tge.seriesCanvasMulti().mapping((j,J)=>j[J]).series(t.map(()=>CLe(e,a,u,r,h,n,p))),y=()=>xs(e).settingName("mainValues").paddingStrategy(Lp()).pad([.1,.1]),A=y().settingValue(e.mainValues[0].name).memoValue(e.axisMemo[0]).valueName("x")(t),E=y().orient("vertical").settingValue(e.mainValues[1].name).memoValue(e.axisMemo[1]).valueName("y")(t),[k,P]=e.splitValues.length===0?[e.mainValues[0].name,e.mainValues[1].name]:["",""],R=DB(A,E).xLabel(k).yLabel(P).plotArea(vh(_,e).canvas(!0));R.xNice&&R.xNice(),R.yNice&&R.yNice();let V=wh().chart(R).settings(e).xScale(A.scale).yScale(E.scale).canvas(!0),N=m_().scaleFactor(p).settings(e).canvas(!0).xScale(A.scale).xValueName("x").yValueName("y").yScale(E.scale).color(!s&&r).size(u).data(t);i.datum(t).call(V),i.call(N)};return o.settings=(...i)=>i.length?(e=i[0],o):e,o.data=(...i)=>i.length?(t=i[0],o):t,o.color=(...i)=>i.length?(r=i[0],o):r,o.symbols=(...i)=>i.length?(n=i[0],o):n,o}function YLe(e,t){if(!t)return;let r=e.realValues[4],n=e.mainValues.find(u=>u.name===r)?.type,o=t.domain(),i=t.range(),s=i.length;for(let[u,h]of o.entries())i[u]=i[u%s];let a=e.columns_config?.[r]?.symbols??{};return Object.entries(a).forEach(([u,h])=>{let p=yge[h]??Zl,_=o.findIndex(y=>{switch(n){case"date":case"datetime":return new Date(y).valueOf()===new Date(u).valueOf();default:return String(y)===String(u)}});i[_]=p}),t.range(i),t}function M4(e,t){let r=t.realValues[2],n=!!r,o=t.mainValues.find(_=>_.name===r)?.type==="string",i=null,s=null,a=t.realValues[4],u=kLe(t,a),h=YLe(t,u),p=jLe(t,jB(t));if(n&&o?a?(t.splitValues.length>0?i=f4(t,p):i=f4(t,p[0]),s=kB().settings(t).scale(h)):(i=YDe(t,r),s=zp().settings(t).scale(i)):n?(i=w4(t,p,"colorValue"),s=A4().scale(i)):(i=Op().settings(t).domain([""])(),s=kB().settings(t).scale(h)),t.splitValues.length!==0){let _=ZB().svg(!1).elementsPrefix("xy-scatter");_=_.padding("2.5em"),e.append("div").attr("class","multi-xlabel").append("p").text(t.mainValues[0].name),e.append("div").attr("class","multi-ylabel").append("p").text(t.mainValues[1].name).style("transform","rotate(-90deg)").style("text-wrap","nowrap"),e=e.datum(p),e.call(_);let y=_.chartContainer(),A=_.chartEnter(),E=_.chartDiv(),k=_.chartTitle(),P=_.containerSize();k.each((R,V,N)=>$t(N[V]).text(R.key)),A.merge(E).attr("transform",`translate(${P.width/2}, ${P.height/2})`).each(function(R){let V=$t(this);Sme().settings(t).data([R]).color(i).symbols(h)(V)})}else Sme().settings(t).data(p).color(i).symbols(h)(e);s&&e.call(s)}function GLe(e,t){let r=S4.seriesCanvasHeatmap();return r.decorate((n,o)=>{n.fillStyle=t(o.colorValue)}),S4.autoBandwidth(r).xValue(n=>n.crossValue).yValue(n=>n.mainValue).colorValue(n=>n.colorValue).colorInterpolate(t.interpolator()).widthFraction(1)}function HLe(e,t){let r=Cx(e),n=RB(e).excludeType(Yo.linear).settingName("splitValues")(),o=[];return t.forEach((i,s)=>{let a=r(i,s);Object.keys(i).filter(u=>u!=="__ROW_PATH__").forEach(u=>{let h=XLe(u);o.push({crossValue:a,mainValue:n===Yo.time?new Date(h):h,colorValue:i[u],row:i})})}),o}function XLe(e){let t=e.split("|");return t.pop(),t.join("|")}function Ege(e,t){let r=HLe(t,kx(t)),n=w4(t,r,"colorValue"),o=GLe(t,n),i=A4().scale(n),s=xs(t).excludeType(Yo.linear).settingName("crossValues").valueName("crossValue")(r),a=xs(t).excludeType(Yo.linear).settingName("splitValues").valueName("mainValue").modifyDomain(_=>isNaN(_[0])?_:_.reverse()).orient("vertical")(r),u=DB(s,a).plotArea(vh(o,t).canvas(!0));u.xPaddingInner&&(u.xPaddingInner(0),u.xPaddingOuter(0),o.xAlign("right")),u.yPaddingInner&&(u.yPaddingInner(0),u.yPaddingOuter(0),o.yAlign("top"));let h=wh().chart(u).settings(t).xScale(s.scale).yScale(a.scale).canvas(!0),p=m_().settings(t).canvas(!0).xScale(s.scale).yScale(a.scale).color(n).data(r);e.datum(r).call(h),e.call(i),e.call(p)}function $Le(e,t){return x4(e,t,{excludeEmpty:!0}).map(r=>QLe(e,r))}function QLe(e,t){let r=Cx(e),n=i=>t[i<t.length-1?i+1:i][e.realValues[0]],o=t.map((i,s)=>{let a=e.realValues[0]?i[e.realValues[0]]:void 0,u=e.realValues[1]?i[e.realValues[1]]:n(s);return{crossValue:r(i,s),mainValues:e.mainValues.map(h=>i[h.name]),openValue:a,closeValue:u,highValue:e.realValues[2]?i[e.realValues[2]]:Math.max(a,u),lowValue:e.realValues[3]?i[e.realValues[3]]:Math.min(a,u),key:t.key,row:i}});return o.key=t.key,o}function eFe(e,t,r){let n=r.domain(),o=Op().domain(n).settings(e).defaultColors([e.colorStyles["series-2"]]).mapFunction(bA(.5))(),i=Op().settings(e).domain(n)(),s=t().crossValue(h=>h.crossValue).openValue(h=>h.openValue).highValue(h=>h.highValue).lowValue(h=>h.lowValue).closeValue(h=>h.closeValue).decorate((h,p)=>{let _=JLe(p)?r(p.key):o(p.key);h.fillStyle=_,h.strokeStyle=_}),a=Px.seriesCanvasLine().mainValue(h=>h.bollinger.average).crossValue(h=>h.crossValue).decorate((h,p)=>{h.strokeStyle=i(p[0].key)}),u=Px.seriesCanvasArea().mainValue(h=>h.bollinger.upper).baseValue(h=>h.bollinger.lower).crossValue(h=>h.crossValue).decorate((h,p)=>{h.fillStyle=bA(.25)(i(p[0].key))});return Px.seriesCanvasMulti().series([u,s,a])}function tFe(e){return function(t,r){let n=$Le(r,jB(r)),o=T4.indicatorBollingerBands().value(R=>R.openValue),i=n.map(R=>{let V=o(R);return R.map((N,j)=>Object.assign({bollinger:V[j]},N))}),s=n.map(R=>R.key).concat(r.hideKeys?r.hideKeys:[]).sort(),a=Op().domain(s).settings(r).mapFunction(bA(1))(),u=zp().settings(r).scale(s.length>1?a:null),h=eFe(r,e,a),p=T4.seriesCanvasMulti().mapping((R,V)=>R[V]).series(i.map(()=>h)),_=Lp().pad([.1,.1]).padUnit("percent"),y=xs(r).settingName("crossValues").valueName("crossValue")(i),A=xs(r).settingName("mainValues").valueNames(["lowValue","highValue"]).memoValue(r.axisMemo[1]).orient("vertical").paddingStrategy(_)(i),E=DB(y,A).plotArea(vh(p,r).orient("vertical").canvas(!0));E.yNice&&E.yNice();let k=wh().chart(E).settings(r).xScale(y.scale).onChange(R=>{let V=i.map(N=>N.filter(j=>j.crossValue>=R.xDomain[0]&&j.crossValue<=R.xDomain[1]));E.yDomain(A.domainFunction(V))}).canvas(!0),P=m_().settings(r).xScale(y.scale).yScale(A.scale).yValueName("closeValue").color(a).data(i).canvas(!0);t.datum(i).call(k),t.call(P),t.call(u)}}function iFe(e,t){if(e.realValues.length>1&&e.realValues[1]!==null){let r=e.realValues[1];if(e.mainValues.find(n=>n.name===r)?.type==="string"){let n=t.map(o=>o.data).filter(o=>o.height>0).map(o=>Rge(o)).reduce((o,i)=>o.concat(i));return f4(e,n)}else return w4(e,null,null,pDe(t.map(n=>n.extents)))}}function Rge(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(Rge(r,t))):e.data.color&&t.push(e.data.color),t}function Nge(e){let t={},r=e.realValues.map(n=>n===null?null:e.mainValues.find(o=>o.name===n));return e.data.forEach((n,o)=>{let i=Array.isArray(n.__ROW_PATH__)?n.__ROW_PATH__:[];sFe(n).forEach(s=>{let a;t[s]||(t[s]=[]),a=t[s],i.forEach((u,h)=>{let p=a.find(_=>_.name===u);if(p||(p={name:u,children:[]},a.push(p)),e.realValues.length>1&&e.realValues[1]!==null){let _=h===i.length-1,y=xA(_?n:e.agg_paths[o][h+1]||n,e.mainValues[1],s);y!==void 0&&(p.color=y)}if(e.realValues.length>2&&e.realValues[2]!==null){p.tooltip=[];for(let _=2;_<e.realValues.length;++_)p.tooltip.push(xA(n,r[_],s))}if(h===i.length-1){if(p.name=i.slice(-1)[0],e.crossValues.length===0)p.size=xA(n,e.mainValues[0],"");else if(i.length===e.crossValues.length){let _=xA(n,e.mainValues[0],s);p.size=_>0?_:0}}a=p.children})})}),Object.entries(t).map(n=>{let o={name:"root",children:n[1]},i=ch(o).sum(a=>a.size),s=LI().size([2*Math.PI,i.height+1])(i);return s.each(a=>{a.current=a,a.mainValues=e.realValues.length===1||e.realValues[1]===null&&e.realValues[2]===null?a.value:[a.value,a.data.color].concat(a.data.tooltip||[]).filter(u=>u!==void 0),a.crossValue=a.ancestors().slice(0,-1).reverse().map(u=>u.data.name),a.key=n[0],a.label=d_(e.crossValues[a.depth-1<0?0:a.depth-1]?.type||e.mainValues[0].type,a.data.name)}),{split:n[0],data:s,extents:oFe(e,n)}})}function oFe(e,[t,r]){if(e.realValues.length>1&&e.realValues[1]!==null){let n=Math.min(...e.data.map(i=>xA(i,e.mainValues[1],t))),o=Math.max(...r.map(i=>i.color));return[n,o]}}function sFe(e){let t=[];return Object.keys(e).forEach(r=>{if(r!=="__ROW_PATH__"){let n=r.split("|").slice(0,-1).join("|");t.includes(n)||t.push(n)}}),t}function Dge(e,t){let r=(e.x0+e.x1)/2*180/Math.PI,n=(e.y0-1+(e.y1-1))/2*t;return`rotate(${r-90}) translate(${n},0) rotate(${r<180?0:180})`}function aFe(e,t){let r=this.getBBox().width;if(r>t){let n=e.label,o=$t(this);for(;r>t;)n=n.substring(0,n.length-1),o.text(()=>n),r=this.getBBox().width;o.text(()=>`${n.substring(0,n.length-3).replace(/\s+$/,"")}...`)}}function cFe(){let e=null,t=null,r=null,n=null,o=null,i=s=>{let a=s.selectAll("g.segment").data(r.descendants().slice(1)),u=a.enter().append("g").attr("class","segment");u.append("path"),u.append("text").attr("class","segment").attr("dy","0.35em");let h=u.merge(a),p=h.select("path").attr("fill-opacity",k=>f_(k.current)?1:0).attr("user-select",k=>f_(k.current)?"initial":"none").style("pointer-events",k=>f_(k.current)?"initial":"none").attr("d",k=>zge(o)(k.current));n&&p.style("fill",k=>n(k.data.color));let _=h.select("text").attr("fill-opacity",k=>+PB(k.current)).attr("transform",k=>Dge(k.current,o)).text(k=>k.label).each(function(k){aFe.call(this,k,o)}),y=s.select("text.parent"),A=s.select("circle").attr("r",o).datum(r),E=lFe(r,s,A,y,p,_,o,t,e);if(e.sunburstLevel){let k=r.descendants().find(P=>P.data.name===e.sunburstLevel[t]);k&&E(k,!0)}else e.sunburstLevel={};A.on("click",k=>E(k,!1)),p.filter(k=>k.children).style("cursor","pointer").on("click",k=>E(k,!1))};return i.settings=(...s)=>s.length?(e=s[0],i):e,i.split=(...s)=>s.length?(t=s[0],i):t,i.data=(...s)=>s.length?(r=s[0],i):r,i.color=(...s)=>s.length?(n=s[0],i):n,i.radius=(...s)=>s.length?(o=s[0],i):o,i}function Lge(e,t){let r=Nge(t),n=iFe(t,r),o=ZB().elementsPrefix("sunburst");if(e.datum(r).call(o),n){let p=t.realValues[1];if(t.mainValues.find(_=>_.name===p)?.type==="string"){let _=zp().settings(t).scale(n);e.call(_)}else{let _=A4().scale(n);e.call(_)}}let i=o.chartContainer(),s=o.chartEnter(),a=o.chartDiv(),u=o.chartTitle(),h=o.containerSize();u.each((p,_,y)=>$t(y[_]).text(p.split)),i.append("circle").attr("fill","none").style("pointer-events","all"),i.append("text").attr("class","parent"),s.merge(a).select("svg").select("g.sunburst").attr("transform",`translate(${h.width/2}, ${h.height/2})`).each(function({split:p,data:_}){let y=$t(this),A=this.parentNode,{width:E,height:k}=A.getBoundingClientRect(),P=(Math.min(E,k)-24)/Math.max(2,t.crossValues.length*2);cFe().settings(t).split(p).data(_).color(n).radius(P)(y),g4().settings(t)(y.selectAll("g.segment"))})}function fFe(e,t){if(e.realValues.length<1||e.realValues[1]===null||e.realValues[1]===void 0)return;let r=e.realValues[1],n=t.filter(o=>o.height>0).map(o=>Fge(o)).reduce((o,i)=>o.concat(i));if(e.mainValues.find(o=>o.name===r)?.type==="string")return f4(e,n);{let o=Math.min(...n),i=Math.max(...n);return w4(e,null,null,[o,i])}}function Fge(e,t=[]){return e.children&&e.children.length>0?e.children.forEach(r=>t.concat(Fge(r,t))):e.data.color&&t.push(e.data.color),t}function Zge(e,t,r,n,o,i){vFe(e,t,r,n,o),e.mapLevel[n].levelRoot=!0,wFe(e,i.node().getBoundingClientRect().width,i.node().getBoundingClientRect().height,n),qge(r,n)}function bFe(e,t){e.each(r=>{r.mapLevel=[],r.mapLevel[0]={x0:r.x0,x1:wA(r)+r.x0,y0:r.y0,y1:AA(r)+r.y0,visible:!0,opacity:1}}),t.mapLevel[0].levelRoot=!0,qge(e,0)}function vFe(e,t,r,n,o){let i={x:e.x0,y:e.y0,width:e.x1-e.x0,height:e.y1-e.y0},s={width:o.x1-o.x0,height:o.y1-o.y0},a={width:s.width/i.width,height:s.height/i.height};r.each(u=>{let h=(u.x0-i.x)*a.width,p=(u.y0-i.y)*a.height,_=wA(u)*a.width,y=AA(u)*a.height,A=xFe(u,t)&&u.data.name!==t[n-1];u.mapLevel[n]={x0:h,x1:_+h,y0:p,y1:y+p,visible:A,opacity:A?1:0}}),e.mapLevel[n].levelRoot=!0}function wFe(e,t,r,n){let o=Wge(t,r)(ch(e.data).sum(s=>s.size)).descendants(),i=e.descendants();o.forEach((s,a)=>{i[a].mapLevel[n].x0=o[a].x0,i[a].mapLevel[n].x1=o[a].x1,i[a].mapLevel[n].y0=o[a].y0,i[a].mapLevel[n].y1=o[a].y1})}function qge(e,t){e.selectAll("text").each((r,n,o)=>{let i=$t(o[n]),s=$t(o[n]).datum(),a=i.attr("class");s.mapLevel[t].textLockedAt={opacity:YB[a]}})}function AFe(e,t,r,n,o,i,s,a,u){if(n.treemapLevel>0){let h=s.crossValue;OB(s,e,t,r,n,o,i,s,0,h,a,u,1,!1),n.treemapRoute.slice(1,n.treemapRoute.length).forEach(p=>{let _=t.filter(A=>A.crossValue===p).datum(),y=_.crossValue;Zge(_,y,t,_.depth,s,o),OB(_,e,t,r,n,o,i,s,_.depth,y,a,u,1,!1)})}}function Gge(e,t,r,n,o,i,s,a,u,h){if(!e.children)return;o.treemapLevel<e.depth?o.treemapRoute.push(e.crossValue):o.treemapRoute.pop(),o.treemapLevel=e.depth;let p=e.crossValue;(!e.mapLevel[o.treemapLevel]||!e.mapLevel[o.treemapLevel].levelRoot)&&Zge(e,p,r,o.treemapLevel,a,i),OB(e,t,r,n,o,i,s,a,o.treemapLevel,p,u,h)}function OB(e,t,r,n,o,i,s,a,u,h,p,_,y=500,A=!0){let E=e.parent,k=s.transition("main transition").duration(y).ease(tw);r.each(R=>R.target=R.mapLevel[u]),EB(e)||EFe(r,p),r.transition(k).tween("data",R=>{let V=$i(R.current,R.target);return N=>R.current=V(N)}).styleTween("opacity",R=>()=>R.current.opacity).attrTween("pointer-events",R=>()=>R.target.visible?"all":"none"),t.transition(k).filter(R=>R.target.visible).styleTween("x",R=>()=>`${R.current.x0}px`).styleTween("y",R=>()=>`${R.current.y0}px`).styleTween("width",R=>()=>`${R.current.x1-R.current.x0}px`).styleTween("height",R=>()=>`${R.current.y1-R.current.y0}px`),n.transition(k).filter(R=>R.target.visible).attrTween("x",R=>()=>R.current.x0+wA(R.current)/2).attrTween("y",R=>()=>R.current.y0+AA(R.current)/2).end().catch(()=>IB(r)).then(()=>{EB(e)||(jge(P),Uge(P),MFe(n,s,y),A&&Yge(r,u),IB(r,p))}).catch(R=>{console.error("Exception completing promises after main transition",R),IB(r,p)}),EB(e)?hFe(r):(n.each((R,V,N)=>dFe(N[V])),Bge(r,u,h));let P=qB(r);E?p.hide(!1).text(e.label).onClick(()=>{Gge(E,t,r,n,o,i,s,a,p,_);let R=i.node().getRootNode().host.parentElement;LB(R,E,_)})():p.hide(!0)()}async function MFe(e,t,r=400){let n=t.transition("text fade transition").duration(r).ease(tw);await e.transition(n).filter(o=>o.target.visible).tween("data",(o,i,s)=>{let a=s[i],u=$i(SFe(o),TFe(a));return h=>o.current.opacity=u(h)}).styleTween("opacity",o=>()=>o.current.opacity).end().catch(o=>console.error("Exception in text fade transition",o)).then(()=>e.each((o,i,s)=>pFe(s[i])))}function CFe(e){let t=null,r=null,n=!0,o=!1,i=$l(e,".parent-controls",()=>e.append("div").attr("class","parent-controls").style("display",n?"none":"").html(IFe)),s=()=>{i.style("display",n?"none":"").select("#goto-parent").style("pointer-events",o?"none":null).html(`\u21EA ${r}`).on("click",()=>t())};return s.deactivate=(...a)=>{if(!a.length)return o;o=a[0];let u=i.select("#goto-parent");return o?u.style("pointer-events","none"):u.style("pointer-events",null),s},s.hide=(...a)=>a.length?(n=a[0],s):n,s.text=(...a)=>a.length?(r=a[0],s):r,s.onClick=(...a)=>a.length?(t=a[0],s):t,s}function PFe(){let e=null,t=null,r=null,n=null,o=null,i=null,s=a=>{i=CFe(o),i();let u=r.height;e.treemapLevel||(e.treemapLevel=0),e.treemapRoute||(e.treemapRoute=[]),Wge(o.node().getBoundingClientRect().width,o.node().getBoundingClientRect().height)(r);let h=a.selectAll("g").data(r.descendants()),p=h.enter().append("g");p.append("rect"),p.append("text");let _=p.merge(h).sort((k,P)=>P.depth-k.depth),y=_.select("rect").attr("class",k=>`treerect ${Eme(u,k)}`).style("x",k=>k.x0).style("y",k=>k.y0).style("width",k=>wA(k)).style("height",k=>AA(k));y.style("fill",k=>Eme(u,k)===u4.leaf?k.data.color?n(k.data.color):t.colorStyles.series:"transparent");let A=_.filter(k=>k.value!==0).select("text").attr("x",k=>k.x0+wA(k)/2).attr("y",k=>k.y0+AA(k)/2).text(k=>k.label),E=y.filter(k=>k.crossValue.length===0).datum();bFe(_,E),Bge(_,0,[]),Uge(qB(_)),Yge(_,0),e.treemapRoute.length===0&&e.treemapRoute.push(E.crossValue),y.filter(k=>k.children).on("click",(k,P)=>Gge(P,y,_,A,e,o,a,E,i,t)),AFe(y,_,A,e,o,a,E,i,t)};return s.settings=(...a)=>a.length?(e=a[0],t=a[1],s):e,s.data=(...a)=>a.length?(r=a[0],s):r,s.color=(...a)=>a.length?(n=a[0],s):n,s.container=(...a)=>a.length?(o=a[0],s):o,s}function Hge(e,t){t.treemaps||(t.treemaps={});let r=Nge(t),n=fFe(t,r.map(a=>a.data));n&&this._container.classList.add("has-legend");let o=ZB().elementsPrefix("treemap");if(e.datum(r).call(o),n){let a=t.realValues[1];if(t.mainValues.find(u=>u.name===a)?.type==="string"){let u=zp().settings(t).scale(n);e.call(u)}else{let u=A4().scale(n);e.call(u)}}let i=o.chartEnter(),s=o.chartDiv();o.chartTitle().each((a,u,h)=>$t(h[u]).text(a.split)),i.merge(s).select("svg").select("g.treemap").each(function({split:a,data:u}){let h=$t(this);t.treemaps[a]||(t.treemaps[a]={}),PFe().settings(t.treemaps[a],t).data(u).container($t($t(this.parentNode).node().parentNode)).color(n)(h),g4().settings(t).centered(!0)(h.selectAll("g"))})}function jFe(){let e=document.querySelector("head").querySelectorAll("style"),t=[];return e.forEach(r=>{r.innerText.indexOf("d3fc-")!==-1&&t.push(r.innerText)}),t.join("")}async function UFe(e){await customElements.get("perspective-viewer").registerPlugin(e)}function VFe(...e){let t=new Set(e.length>0?e:Ime.map(r=>r.plugin.name));Ime.forEach(r=>{if(t.has(r.plugin.name)){let n=r.plugin.name.toLowerCase().replace(/[ \t\r\n\/]*/g,""),o=`perspective-viewer-d3fc-${n}`;customElements.define(o,class extends HTMLElement{_chart;_settings;render_warning;_initialized;_container;_staged_view;config;constructor(){super(),this._chart=null,this._settings=null,this.render_warning=!0}connectedCallback(){this._initialized||(this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>${BFe}</style>`,this.shadowRoot.innerHTML+='<div id="container" class="chart"></div>',this._container=this.shadowRoot.querySelector(".chart"),this._initialized=!0)}get name(){return r.plugin.name}get category(){return r.plugin.category}get select_mode(){return r.plugin.selectMode||"select"}get min_config_columns(){return r.plugin.initial?.count||kme.initial.count}get config_column_names(){return r.plugin.initial?.names||kme.initial.names}get max_cells(){return r.plugin.max_cells||4e3}set max_cells(i){r.plugin.max_cells=i}get max_columns(){return r.plugin.max_columns||50}set max_columns(i){r.plugin.max_columns=i}can_render_column_styles(i,s){return r.can_render_column_styles?.call(this,i,s)}column_style_controls(i,s){return r.column_style_controls?.call(this,i,s)}async render(){var i=document.createElement("canvas"),s=this.shadowRoot.querySelector("#container");i.width=s.offsetWidth,i.height=s.offsetHeight;let a=i.getContext("2d");a.fillStyle=window.getComputedStyle(this).getPropertyValue("--plugin--background")||"white",a.fillRect(0,0,i.width,i.height);let u=window.getComputedStyle(this).getPropertyValue("color"),h=Array.from(this.shadowRoot.querySelectorAll("svg:not(#dragHandles)"));for(let A of h.reverse()){var p=document.createElement("img");let E=0;p.width=A.parentElement?A.parentElement.offsetWidth:E,p.height=A.parentElement?A.parentElement.offsetHeight:E;let k=A.cloneNode(!0);k.hasAttribute("viewBox")||k.setAttribute("viewBox",`0 0 ${p.width} ${p.height}`),k.setAttribute("xmlns","http://www.w3.org/2000/svg");for(let R of k.querySelectorAll("text"))R.setAttribute("fill",u);var _=new XMLSerializer().serializeToString(k);_=_.replace(/[^\x00-\x7F]/g,"");let P=new Promise((R,V)=>{p.onload=R,p.onerror=V});try{p.src=`data:image/svg+xml;base64,${btoa(_)}`,await P}catch{let R=new Promise((V,N)=>{p.onload=V,p.onerror=N});p.src=`data:image/svg+xml;utf8,${_}`,await R}a.drawImage(p,A.parentNode.offsetLeft,A.parentNode.offsetTop,p.width,p.height)}let y=Array.from(this.shadowRoot.querySelectorAll("canvas"));for(let A of y.reverse())a.drawImage(A,A.parentNode.offsetLeft,A.parentNode.offsetTop,A.width/window.devicePixelRatio,A.height/window.devicePixelRatio);return await new Promise(A=>i.toBlob(E=>A(E)),"image/png")}async draw(i,s,a){if(this.offsetParent===null){this._staged_view=[i,s,a];return}this._staged_view=void 0,this._settings&&(this._settings.axisMemo=[[1/0,-1/0],[1/0,-1/0]]),await this.update(i,s,a,!0)}async update(i,s,a,u=!1){if(this.offsetParent===null)return;let h=this.parentElement,p,_,y=r.plugin.name!=="Sunburst";s&&a?p=i.to_columns_string({end_row:a,end_col:s,leaves_only:y}):s?p=i.to_columns_string({end_col:s,leaves_only:y}):a?p=i.to_columns_string({end_row:a,leaves_only:y}):p=i.to_columns_string({leaves_only:y}),_=await Promise.all([h.save(),h.getTable().then(rt=>rt.schema()),i.expression_schema(!1),i.schema(!1),p,i.get_config()]);let[A,E,k,P,R,V]=_,N=JSON.parse(R),j=Object.keys(N),J={row(rt){let At={};for(let St of j)At[St]=N[St][rt];return At}};this.config=A;let ne=this.config.columns,de=function(rt){let At=E[rt];return At||(At=k[rt]),At},{columns:fe,group_by:ye,split_by:ve,filter:be}=V,je=N[Object.keys(N)[0]]||[],Re=ye.length>0?je.reduce((rt,At,St)=>{let kt=J.row(St);if(kt.__ROW_PATH__&&kt.__ROW_PATH__.length==ye.length)rt.agg_paths.push(rt.aggs.slice()),rt.rows.push(kt);else{let yt=kt.__ROW_PATH__.filter(tr=>tr!==void 0).length;rt.aggs[yt]=kt,rt.aggs=rt.aggs.slice(0,yt+1)}return rt},{rows:[],aggs:[],agg_paths:[]}):{rows:je.map((rt,At)=>J.row(At))},Se=(rt,At)=>ye.length?rt:{...rt,__ROW_PATH__:[At]},Ue=Re.rows.map(Se),qe={realValues:ne,crossValues:ye.map(rt=>({name:rt,type:de(rt)})),mainValues:fe.map(rt=>({name:rt,type:P[rt]})),splitValues:ve.map(rt=>({name:rt,type:de(rt)})),filter:be,data:Ue,agg_paths:Re.agg_paths,...this.config.plugin_config};this._chart=r;let Je={set:(rt,At,St)=>(CB.includes(At)||this._container&&this._container.dispatchEvent(new Event("perspective-plugin-update",{bubbles:!0,composed:!0})),rt[At]=St,!0)},gt=[[1/0,-1/0],[1/0,-1/0]];this._settings=new Proxy({axisMemo:gt,...this._settings,...qe},Je),this._settings.splitMainValues&&this._settings.splitMainValues.length>=fe.length&&(this._settings.splitMainValues=[]),Cme(this._container,this._settings),u&&(this._container.innerHTML=""),this._draw(),await new Promise(rt=>requestAnimationFrame(rt))}async clear(){this._container&&(this._container.innerHTML="")}_draw(){if(this.offsetParent!==null){let i=$t(this._container),s=`chart ${n}`;this._settings.size=this._container.getBoundingClientRect(),this._settings.data.length>0?this._chart(i.attr("class",s),this._settings):i.attr("class",`${s} disabled`)}}async resize(i){if(this.offsetParent!==null)if(this._settings?.data!==void 0)this._draw();else{let[s,a,u]=this._staged_view;this._staged_view=void 0,this.draw(s,a,u)}}async restyle(i,s,a){let u=this._settings;u&&(delete u.colorStyles,delete u.textStyles,this.isConnected&&(Cme(this._container,this._settings),this.resize(i)))}async delete(){this._container.innerHTML=""}getContainer(){return this._container}save(){let i={...this._settings};return CB.forEach(s=>{delete i[s]}),i}restore(i,s){let a={};for(let u of CB)this._settings?.[u]!==void 0&&(a[u]=this._settings?.[u]);this._settings={...a,...i,columns_config:s}}}),customElements.whenDefined("perspective-viewer").then(()=>UFe(o))}})}var Pme,Rp,Rme,zme,Ku,Ex,Np,qs,p_,bh,Qme,tge,Dp,sge,lge,cge,hge,dge,v4,gge,_ge,vA,bge,wge,Age,Fp,Tge,S4,Ige,T4,Px,Pge,Xge,dDe,h4,Yo,RB,Ome,pDe,d4,mDe,Nme,gDe,_De,yDe,Dme,NB,Lme,xDe,SB,bDe,Fme,vDe,Bme,jme,Ume,wDe,Vme,ADe,MDe,Wme,Zme,SDe,m4,TDe,EDe,IDe,CDe,kDe,PDe,Yme,ODe,RDe,xs,Ix,DB,qme,NDe,FDe,pme,LB,BDe,g4,ZDe,GDe,Cx,$De,Sx,FB,gme,_me,iLe,rge,yme,Pp,sLe,aLe,lLe,cLe,xme,bme,nge,ige,uLe,zp,kB,fLe,hLe,dLe,pLe,mLe,vh,Lp,gLe,wh,_Le,yLe,vme,wme,Ame,xLe,b4,bLe,uge,vLe,wLe,pge,Mme,m_,MLe,TB,SLe,TLe,yge,ELe,ILe,RLe,DLe,BLe,Sge,WLe,qLe,KLe,JLe,Cge,kge,rFe,Oge,nFe,xA,zge,f_,PB,lFe,uFe,Tme,EB,Bge,hFe,jge,dFe,pFe,YB,qB,Uge,mFe,Vge,gFe,_Fe,yFe,h_,Wge,xFe,Yge,SFe,TFe,EFe,IB,IFe,u4,wA,AA,kFe,Eme,OFe,RFe,Ime,Cme,NFe,zFe,DFe,LFe,FFe,kme,BFe,CB,Kge=W(()=>{Pme=In(Jn(),1),Rp=In(Jn(),1);Qn();Rme=In(Jn(),1),zme=In(Jn(),1);Qn();Ku=In(Jn(),1);ki();Qn();Qn();Ex=In(Jn(),1);Qn();Np=In(Jn(),1);Qn();qs=In(Jn(),1);Qn();p_=In(Jn(),1),bh=In(Jn(),1);Qn();Qn();Qn();Qme=In(Jn(),1);Qn();AB();AB();tge=In(Jn(),1);Qn();Qn();Qn();Dp=In(Jn(),1),sge=In(Jn(),1);Qn();lge=In(Jn(),1),cge=In(Jn(),1),hge=In(Jn(),1),dge=In(Jn(),1),v4=In(Jn(),1),gge=In(Jn(),1),_ge=In(Jn(),1);Qn();vA=In(Jn(),1),bge=In(Jn(),1),wge=In(Jn(),1),Age=In(Jn(),1);Qn();Qn();Qn();Fp=In(Jn(),1),Tge=In(Jn(),1),S4=In(Jn(),1),Ige=In(Jn(),1),T4=In(Jn(),1),Px=In(Jn(),1),Pge=In(Jn(),1);Qn();Qn();Qn();Qn();Qn();Qn();Qn();Qn();Qn();Qn();Qn();Xge=In(hme(),1);Qn();dDe=Object.defineProperty,h4=(e,t)=>{for(var r in t)dDe(e,r,{get:t[r],enumerable:!0})};Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null});Yo={none:"none",ordinal:"ordinal",time:"time",linear:"linear"},RB=e=>{let t="crossValues",r=null,n=null,o=()=>{let i=s=>{let a=r?e[t].filter(u=>r==u.name):e[t];return t=="crossValues"&&a.length>1?!1:a.some(u=>s.includes(u.type))};return e[t].length===0?Yo.none:n!=Yo.time&&i(["datetime","date"])?Yo.time:n!=Yo.linear&&i(["integer","float"])||n==Yo.ordinal?Yo.linear:Yo.ordinal};return o.settingName=(...i)=>i.length?(t=i[0],o):t,o.settingValue=(...i)=>i.length?(r=i[0],o):r,o.excludeType=(...i)=>i.length?(n=i[0],o):n,o},Ome={};h4(Ome,{domain:()=>yDe,labelFunction:()=>Dme,scale:()=>_De});pDe=e=>{let t=r=>(n,o)=>n===void 0?o:o===void 0?n:r(n,o);return e.reduce((r,n)=>[t(Math.min)(r[0],n[0]),t(Math.max)(r[1],n[1])],[void 0,void 0])},d4=e=>Array.isArray(e)?e.flat(1/0):[e],mDe=1,Nme=e=>{let t=r=>e(r);return(0,Rme.rebindAll)(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(...r),t):Math.max(e.bandwidth(),mDe),t},gDe=e=>{let t=r=>e(r);return(0,zme.rebindAll)(t,e),t.ticks=function(){return[]},t},_De=()=>gDe(Nme(Vl())),yDe=()=>{let e=["crossValue"],t="horizontal",r=o=>{let i=d4(o);return n([...new Set(i.map(s=>s[e[0]]))])},n=o=>t=="vertical"?o.reverse():o;return r.valueName=(...o)=>o.length?(e=[o[0]],r):e[0],r.valueNames=(...o)=>o.length?(e=o[0],r):e,r.orient=(...o)=>o.length?(t=o[0],r):t,r},Dme=e=>t=>t[e].join("|"),NB={};h4(NB,{component:()=>wDe,domain:()=>Bme,labelFunction:()=>jme,scale:()=>vDe,tickFormatFunction:()=>Ume});Lme=()=>{let e=[0,0],t="percent",r=n=>{switch(t){case"domain":{n[0]-=e[0],n[1]+=e[1];break}case"percent":{let o=n[1]-n[0];n[0]-=e[0]*o,n[1]+=e[1]*o;break}default:throw new Error("Unknown padUnit: "+t)}return n};return r.pad=function(...n){return n.length?(e=n[0],r):e},r.padUnit=function(...n){return n.length?(t=n[0],r):t},r},xDe=function(){let e=[function(i){return i}],t=null,r=[],n=Lme(),o=function(i){let s=new Array(i.length),a=!0,u=!1,h,p=e[Symbol.iterator]();try{for(let y;!(a=(y=p.next()).done);a=!0){let A=y.value;for(let E=0;E<i.length;E++){let k=A(i[E],E);Array.isArray(k)?s.push.apply(s,SB(k)):s.push(k)}}}catch(y){u=!0,h=y}finally{try{!a&&p.return&&p.return()}finally{if(u)throw h}}let _=[tl(s),za(s)];if(_[0]=_[0]==null?tl(r):tl([_[0]].concat(SB(r))),_[1]=_[1]==null?za(r):za([_[1]].concat(SB(r))),t!=null){let y=Math.max(Math.abs(_[1]-t),Math.abs(_[0]-t));_[0]=t-y,_[1]=t+y}return n(_)};return o.accessors=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],o):e},o.pad=function(...i){return i.length?(n.pad(i[0]),o):n.pad},o.padUnit=function(...i){return i.length?(n.padUnit(i[0]),o):n.padUnit},o.include=function(...i){return i.length?(r=i[0],o):r},o.symmetricalAbout=function(...i){return i.length?(t=i[0],o):t},o.paddingStrategy=function(...i){return i.length?(n=i[0],o):n},o},SB=function(e){if(Array.isArray(e)){let t=Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}else return Array.from(e)},bDe=1e7,Fme=(e,t)=>{let r=Math.ceil(Math.abs(Math.log10(t-e)))+1;return n=>Math.abs(n)>=bDe?Ic(".3s")(n):Number.isInteger(n)?Ic(",.0f")(n):Ic(`,.${r}f`)(n)};vDe=()=>Oc(),Bme=()=>{let e=xDe().pad([0,.1]).padUnit("percent"),t=["crossValue"],r=i=>(e.accessors(t.map(s=>a=>parseFloat(a[s]))),o(d4(i)));Ku.rebindAll(r,e);let n=i=>{let s=t.map(a=>i.map(u=>u[a]).sort((u,h)=>u-h).filter((u,h,p)=>h===0||u!==p[h-1]).reduce((u,h,p,_)=>p===0||u<=h-_[p-1]?u:Math.abs(h-_[p-1])));return Math.min(...s)},o=i=>{if(e.padUnit()=="domain"){let s=n(i);return e.pad([s/2,s/2])(i)}else return e(i)};return r.valueName=(...i)=>i.length?(t=[i[0]],r):t[0],r.valueNames=(...i)=>i.length?(t=i[0],r):t,r},jme=e=>t=>t[e][0],Ume=Fme,wDe=e=>{let t=null,r="horizontal",n=null,o=(h,p)=>{try{return p4(h.node()).querySelector(".cartesian-chart").querySelector(`.${p}-axis`)}catch{return null}},i=h=>{let p=$t(h).select("text").node();p.style.fontSize="80%"},s=(h,p)=>{let _=h.getBoundingClientRect();p.each((y,A,E)=>{let k=$t(E[A]).node().getBoundingClientRect();(r=="vertical"&&_.width<k.width||r=="horizontal"&&_.height<k.height)&&i(E[A])})},a=(h,p,_)=>{let y=o(h,p);y&&s(y,h)},u=()=>({bottom:Ku.axisBottom,left:Ku.axisLeft,top:Ku.axisTop,right:Ku.axisRight,decorate:a});return u.domain=(...h)=>h.length?(t=h[0],u):t,u.orient=(...h)=>h.length?(r=h[0],u):r,u.settingName=(...h)=>h.length?(n=h[0],u):n,u},Vme={};h4(Vme,{domain:()=>MDe,labelFunction:()=>Wme,scale:()=>ADe});ADe=()=>Gy(),MDe=()=>{let e=Ex.extentTime(),t=["crossValue"],r=i=>(e.accessors(t.map(s=>a=>new Date(a[s]))),o(d4(i)));Ex.rebindAll(r,e,Ex.exclude("include","paddingStrategy"));let n=i=>{let s=t.map(a=>i.map(u=>new Date(u[a]).getTime()).sort((u,h)=>u-h).filter((u,h,p)=>h===0||u!==p[h-1]).reduce((u,h,p,_)=>p===0||Math.abs(u)<=Math.abs(h-_[p-1])?Math.abs(u):Math.abs(h-_[p-1])));return Math.min(...s)},o=i=>{let s=Math.abs(n(i));return e.padUnit("domain").pad([s/2,s/2])(i)};return r.valueName=(...i)=>i.length?(t=[i[0]],r):t[0],r.valueNames=(...i)=>i.length?(t=i[0],r):t,r},Wme=e=>t=>new Date(t[e][0]),Zme={};h4(Zme,{component:()=>ODe,domain:()=>PDe,labelFunction:()=>Yme,scale:()=>kDe});SDe=(...e)=>{let t={},r=n=>{for(let o of Object.keys(t))n[o](t[o]);return n};for(let n of e)r[n]=(...o)=>o.length?(t[n]=o[0],r):t[n];return r},m4=(e,t,r)=>{let n=6,o=6,i=SDe("tickFormat","ticks","tickArguments","tickValues","tickPadding"),s=(...k)=>{},a=null,u=(0,qs.dataJoin)("g","group"),h=(0,qs.dataJoin)("path","domain"),p=(k,P)=>y()?`translate(${P}, ${k})`:`translate(${k}, ${P})`,_=k=>y()?k.map(P=>[P[1],P[0]]):k,y=()=>e==="left"||e==="right",A=k=>{if(!a){i(t(r).decorate(s))(k);return}k.each((P,R,V)=>{let N=V[R],j=$t(N),J=e==="bottom"||e==="right"?1:-1,ne=r.range(),de=_([[ne[0],J*n],[ne[0],0],[ne[1],0],[ne[1],J*n]]);h(j,[P]).attr("d",_h()(de)).attr("stroke","#000").attr("fill","none");let fe=u(j,a),ye=be=>Array.isArray(o)?o[be]:o,ve=be=>{let je=0;for(let Re=0;Re<be;Re++)je+=ye(Re);return je};fe.attr("transform",(be,je)=>p(0,J*ve(je))).each((be,je,Re)=>{let Se=$t(Re[je]),Ue=E(r,be);i(t(Ue)).decorate((qe,Je)=>s(qe,Je,je)).tickSizeInner(ye(je)).tickOffset(qe=>Ue.step(qe)/2)(Se),Se.select("path.domain").attr("visibility","hidden")}),fe.exit().attr("transform",(be,je)=>p(0,J*ve(je)))})},E=(k,P)=>{function R(V){let N=V.domain;return N.reduce((j,J)=>j+k(J),0)/N.length}return R.ticks=()=>P,R.tickFormat=()=>V=>V.text,R.copy=()=>E(k,P),R.step=V=>V.domain.length*k.step(),(0,qs.rebindAll)(R,k,(0,qs.exclude)("ticks","step","copy")),R};return A.tickSize=(...k)=>k.length?(o=n=Number(k[0]),A):o,A.tickSizeInner=(...k)=>k.length?(o=Array.isArray(k[0])?k[0]:Number(k[0]),A):o,A.tickSizeOuter=(...k)=>k.length?(n=Number(k[0]),A):n,A.decorate=(...k)=>k.length?(s=k[0],A):s,A.groups=(...k)=>k.length?(a=k[0],A):a,(0,qs.rebindAll)(A,i),A},TDe=e=>m4("top",qs.axisOrdinalTop,e),EDe=e=>m4("bottom",qs.axisOrdinalBottom,e),IDe=e=>m4("left",qs.axisOrdinalLeft,e),CDe=e=>m4("right",qs.axisOrdinalRight,e),kDe=()=>Nme(Vl()).padding(.5),PDe=()=>{let e=["crossValue"],t="horizontal",r=o=>{let i=d4(o);return n([...Array.from(new Set(i.map(s=>s[e[0]])))])},n=o=>t=="vertical"?o.reverse():o;return r.valueName=(...o)=>o.length?(e=[o[0]],r):e[0],r.valueNames=(...o)=>o.length?(e=o[0],r):e,r.orient=(...o)=>o.length?(t=o[0],r):t,r},Yme=e=>t=>t[e].join("|"),ODe=e=>{let t="horizontal",r="crossValues",n=null,o=()=>{let y=e[r].length>1,A=s(n),E=A.map(a),k=y?E.map(j=>j.size):E[0].size,P=E.reduce((j,J)=>j+J.size,0),R=j=>J=>{let ne=j(J);return y&&ne.groups(A).tickSizeInner(k).tickSizeOuter(P),t!=="horizontal"&&ne.tickPadding(10),ne},V=(j,J,ne)=>{let de=E[ne].rotation;t==="horizontal"&&_(j,de),u(j,de)},N=i(y);return{bottom:R(N.bottom),left:R(N.left),right:R(N.right),top:R(N.top),size:`${P+10}px`,decorate:V}},i=y=>y?{bottom:EDe,left:IDe,top:TDe,right:CDe}:{bottom:Np.axisOrdinalBottom,left:Np.axisOrdinalLeft,top:Np.axisOrdinalTop,right:Np.axisOrdinalRight},s=y=>{let A=[];return y.forEach(E=>{(E&&E.split?E.split("|"):[E]).forEach((k,P)=>{for(;A.length<=P;)A.push([]);let R=A[P];R.length>0&&R[R.length-1].text===k?R[R.length-1].domain.push(E):R.push({text:k,domain:[E]})})}),A.reverse()},a=y=>{let A=e.size.width,E=Math.max(...y.map(k=>k.text?k.text.length:0));return t==="horizontal"?y&&y.length*16>A-100?{size:E*5+10,rotation:90}:y&&y.length*(E*6+10)>A-100?{size:E*3+20,rotation:45}:{size:25,rotation:0}:{size:E*5+10,rotation:0}},u=(y,A)=>{let E=N=>{let j=N.indexOf(",")!==-1?",":" ",J=N.substring(N.indexOf("(")+1,N.indexOf(")")).split(j).map(ne=>parseInt(ne));for(;J.length<2;)J.push(0);return J},k=A?(N,j)=>N.x+N.width+14>j.x+j.width:(N,j)=>N.x<=j.x+j.width&&j.x<=N.x+N.width&&N.y<=j.y+j.height&&j.y<=N.y+N.height,P=(N,j)=>N.x>=j.x&&N.x+N.width<=j.x+j.width&&N.y>=j.y&&N.y+N.height<=j.y+j.height,R=t=="horizontal"?h(y):null,V=[];y.each((N,j,J)=>{let ne=$t(J[j]),de=E(ne.attr("transform")),fe=ne.node().getBBox(),ye={x:fe.x+de[0],y:fe.y+de[1],width:fe.width,height:fe.height},ve=V.some(be=>k(be,ye))||R&&!P(ye,R);ne.attr("visibility",ve?"hidden":""),ve||V.push(ye)})},h=y=>{let A=p4(y.node());if(A===null)return;let E=A.querySelector(".cartesian-chart"),k=E.querySelector(".x-axis"),P=E.getBoundingClientRect(),R=k.getBoundingClientRect();return{x:P.left-R.left,width:P.width,y:P.top-R.top,height:P.height}},p=y=>y?y<60?`rotate(-${y} 5 5)`:`rotate(-${y} 3 7)`:"translate(0, 8)",_=(y,A)=>{let E=p(A),k=A?"end":"";y.each((P,R,V)=>{$t(V[R]).select("text").attr("transform",E).style("text-anchor",k)})};return o.orient=(...y)=>y.length?(t=y[0],o):t,o.settingName=(...y)=>y.length?(r=y[0],o):r,o.domain=(...y)=>y.length?(n=y[0],o):n,o},RDe={none:Ome,ordinal:Zme,time:Vme,linear:NB},xs=e=>{let t=null,r="horizontal",n="crossValues",o,i=["crossValue"],s=null,a=null,u=["include","paddingStrategy","pad"],h={},p=A=>{let E=RB(e).excludeType(t).settingName(n).settingValue(o)(),k=RDe[E],P=k.domain().valueNames(i);u.forEach(j=>{h[j]&&P[j]&&P[j](h[j])}),P.orient&&P.orient(r);let R=P(A);s!==null&&(R=s(R)),a&&typeof R[0]=="number"&&(a[0]=R[0]=Math.min(R[0],a[0]),a[1]=R[1]=Math.max(R[1],a[1]));let V=k.hasOwnProperty("component")?_(k,R,A):y(),N=k==NB?Ume(R[0],R[1]):void 0;return{scale:k.scale(),domain:R,domainFunction:P,labelFunction:k.labelFunction,component:{bottom:V.bottom,left:V.left,top:V.top,right:V.right},size:V.size,decorate:V.decorate,label:e[n].map(j=>j.name).join(", "),tickFormatFunction:N}},_=(A,E,k)=>A.component(e).orient(r).settingName(n).domain(E)(k),y=()=>({bottom:Rp.axisBottom,left:Rp.axisLeft,top:Rp.axisTop,right:Rp.axisRight,decorate:()=>{}});return p.memoValue=(...A)=>A.length?(a=A[0],p):a,p.excludeType=(...A)=>A.length?(t=A[0],p):t,p.orient=(...A)=>A.length?(r=A[0],p):r,p.settingName=(...A)=>A.length?(n=A[0],p):n,p.settingValue=(...A)=>A.length?(o=A[0],p):o,p.valueName=(...A)=>A.length?(i=[A[0]],p):i[0],p.valueNames=(...A)=>A.length?(i=A[0],p):i,p.modifyDomain=A=>A?(s=A,p):s,u.forEach(A=>{p[A]=(...E)=>E.length?(h[A]=E[0],p):h[A]}),p},Ix=(e,t)=>qme(e,t,(r,n)=>r.svgPlotArea(n),!1),DB=(e,t)=>qme(e,t,(r,n)=>r.canvasPlotArea(n).svgPlotArea(p_.seriesSvgPoint()),!0),qme=(e,t,r,n)=>{let o=null,i=null,s=p_.chartCartesian({xScale:e.scale,yScale:t.scale,xAxis:e.component,yAxis:t.component}).xDomain(e.domain).xLabel(e.label).xAxisHeight(e.size).xDecorate(e.decorate).xTickFormat(e.tickFormatFunction).yDomain(t.domain).yLabel(t.label).yAxisWidth(t.size).yDecorate(t.decorate).yOrient("left").yTickFormat(t.tickFormatFunction);e.decorate&&s.xDecorate(e.decorate),t.decorate&&s.yDecorate(t.decorate),s.xPaddingInner&&s.xPaddingInner(1),s.xPaddingOuter&&s.xPaddingOuter(.5),s.yPaddingInner&&s.yPaddingInner(1),s.yPaddingOuter&&s.yPaddingOuter(.5),s.axisSplitter=(...u)=>u.length?(o=u[0],s):o,s.altAxis=(...u)=>u.length?(i=u[0],s):i,s.plotArea=function(...u){return u.length==0?n?this.canvasPlotArea():this.svgPlotArea():r(this,...u)};let a=s.decorate();return s.decorate((u,h)=>{let p=u.select("d3fc-svg.plot-area"),_=p.select("svg").node();_.setAttribute("viewBox",`0 0 ${p.node().clientWidth} ${p.node().clientHeight}`),_.setAttribute("preserveAspectRatio","none");for(let y of["x-axis","y-axis"])u.select(`d3fc-svg.${y} svg`).node().setAttribute("preserveAspectRatio","none");if(a(u,h),n){let y=u.select(".svg-plot-area").node(),A=u.select(".canvas-plot-area").node();L1([y,A]).order()}if(o){if(o.haveSplit()){let y=o.altData(),A=p_.dataJoin("d3fc-svg","y2-axis").key(R=>R),E=p_.dataJoin("g","y-series").key(R=>R);u.append("div").attr("class","y-label right-label").style("grid-column",5).style("-ms-grid-column",5).style("grid-row",3).style("-ms-grid-row",3).style("width",i.size||"1em").style("display","flex").style("align-items","center").style("justify-content","center").append("span").attr("class","y-label splitter-label").style("transform","rotate(-90deg)");let k=i.scale.domain(i.domain),P=i.component.right(k);if(P.tickFormat(i.tickFormatFunction),i.decorate&&P.decorate(i.decorate),A(u,["right"]).attr("class",R=>`y-axis ${R}-axis`).on("measure",function(R,V){let{width:N,height:j}=R.detail;V==="left"&&$t(R.currentTarget).select("svg").attr("viewBox",`${-N} 0 ${N} ${j}`).attr("preserveAspectRatio","none"),k.range([j,0])}).on("draw",function(R,V){$t(R.currentTarget).select("svg").call(P)}),n){let R=V=>{let N=s.plotArea();N.context(V.node().getContext("2d")).xScale(e.scale);let j=[t.scale,k];[h,y].forEach((J,ne)=>{N.yScale(j[ne]),N(J)})};u.select("d3fc-canvas.plot-area").on("draw",function(V,N){R($t(V.currentTarget).select("canvas"))})}else{let R=function(V){let N=s.plotArea();N.xScale(e.scale);let j=[t.scale,k];E(V,[h,y]).each((J,ne,de)=>{N.yScale(j[ne]),$t(de[ne]).datum(J).call(N)})};u.select("d3fc-svg.plot-area").on("draw",function(V,N){R($t(V.currentTarget).select("svg"))})}}o(u)}}),s};NDe=`<ul id="tooltip-values"></ul>
`;FDe=e=>e==null?"-":e.toLocaleString(void 0,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),pme=e=>[e.name,"==",e.value],LB=(e,t,r)=>{let n=Xme(t,r).map(a=>a.name),o=Gme(t,r).map(pme),i=Hme(t,r).map(pme),s=r.filter.concat(o).concat(i);e.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{column_names:n,config:{filter:s},row:t.row}}))},BDe=()=>{let e=null,t=r=>{let n=r.node();r.on("click",(o,i)=>LB(n,i,e))};return t.settings=(...r)=>r.length?(e=r[0],t):e,t},g4=()=>{let e=!1,t=null,r=null,n=!1,o=i=>{let s=i.node();if(!s||!s.isConnected){mme(t);return}let a=$t(p4(s));t=jDe(a);let u=function(p,_){DDe(t,_,r);let y=i.nodes(),A=y.indexOf(this);UDe(a.node(),y[A],t,n),$t(y[A]).style("opacity","0.7")},h=function(p,_){mme(t);let y=i.nodes(),A=y.indexOf(this);y&&$t(y[A]).style("opacity","1")};e?i.each(function(p){return u.call(this,void 0,p)}):(i.on("mouseover",u).on("mouseout",h),BDe().settings(r)(i))};return o.alwaysShow=(...i)=>i.length?(e=i[0],o):e,o.centered=(...i)=>i.length?(n=i[0],o):n,o.settings=(...i)=>i.length?(r=i[0],o):r,o};ZDe=e=>{let t=r=>e(r);return bh.rebindAll(t,e),t.bandwidth=(...r)=>r.length?(e.bandwidth(Math.max(r[0],1)),t):e.bandwidth(),t};GDe={none:Dme,ordinal:Yme,time:Wme,linear:jme},Cx=e=>{let t=RB(e),r="__ROW_PATH__",n=(o,i)=>GDe[t()](r)(o);return(0,Qme.rebindAll)(n,t),n.valueName=(...o)=>o.length?(r=o[0],n):r,n};$De=`<span id="up-arrow">&#9650;</span>
<span id="page-text"></span>
<span id="down-arrow">&#9660;</span>
`;Sx=10;FB="resize.for-dragging";gme="horizontal-drag-handle",_me="vertical-drag-handle",iLe="corner-drag-handle",rge="dragHandles",yme=0,Pp="resize";sLe=(e,t,r,n)=>{e.selectAll(`.${n}`).each((o,i,s)=>{let a=s[i];$t(a).attr(r,a.getBoundingClientRect()[r]-t)})},aLe=e=>e.select(`#${rge}`).size()>0,lLe=(e,t,r)=>e.attr(t,Number(e.attr(t))-r),cLe=(e,t,r)=>e.attr(t,e.node().getBoundingClientRect()[t]-r),xme=16,bme=20,nge=(e,t)=>{let r=e||c4(),n=[],o=1,i,s=t.legend&&t.legend.pageIndex?t.legend.pageIndex:0,a=()=>{},u=eLe().settings(t),h,p=j=>{n=r.scale().domain(),h=oLe().settings(t).maxHeight(n.length*xme+bme).on("resize",()=>_(j)),h(j),u(j),_(j)},_=j=>{P(j),y(j),A(j),QDe(j)},y=j=>{let J=V(j);J.style("display",o<=1?"none":"block"),J.select("#page-text").text(`${s+1}/${o}`),J.select("#up-arrow").attr("class",s===0?"disabled":"").on("click",()=>{s>0&&(E(s-1),_(j))}),J.select("#down-arrow").attr("class",s>=o-1?"disabled":"").on("click",()=>{s<o-1&&(E(s+1),_(j))})},A=j=>{o>1&&r.cellFilter(k()),j.select("g.legendCells").remove();let J=N(j);J.call(r);let ne=j.select("g.legendCells").node().getBBox();J.attr("height",ne.height+bme),a(j)},E=j=>{s=j,t.legend={...t.legend,pageIndex:s}},k=()=>(j,J)=>J>=i*s&&J<i*s+i,P=j=>{let J=j.node().getBoundingClientRect(),ne=Math.floor(J.height/xme)-1;i=ne<n.length?ne-1:ne,o=R(ne),s=Math.min(s,o-1)},R=j=>Math.ceil(n.length/j),V=j=>$l(j,".legend-controls",()=>j.append("g").attr("class","legend-controls").html($De)),N=j=>$l(j,".legend",()=>j.append("svg").attr("class","legend"));return p.decorate=(...j)=>j.length?(a=j[0],p):a,(0,tge.rebindAll)(p,r),p},ige=e=>nge(c4().shape("circle").shapeRadius(6),e),uLe=e=>nge(ume().shapePadding(1).labelOffset(3),e),zp=()=>BB(ige),kB=()=>BB(uLe,oge),fLe=()=>BB(ige,oge);hLe=e=>(t,r)=>t.style("stroke-width",n=>"1.0").style("stroke",n=>UB(n,e));dLe=e=>(t,r)=>{t.strokeStyle=UB(r,e),t.lineWidth=1},pLe=(e,t)=>e.style("display","none"),mLe=e=>(t,r)=>{t.lineWidth=1,t.strokeStyle=UB(r,e)},vh=(e,t)=>{let r="both",n=!1,o=null,i=null,s=null,a=Dp.seriesSvgMulti(),u=Dp.annotationSvgGridline(),h=hLe(t),p=pLe,_=function(...y){n&&(a=Dp.seriesCanvasMulti().context(s),u=Dp.annotationCanvasGridline(),h=dLe(t),p=mLe(t));let A=a.xScale(o).yScale(i),E=r==="vertical"?p:h,k=r==="horizontal"?p:h,P=u.xDecorate(E).yDecorate(k);return A.series([P,e])(...y)};return _.orient=(...y)=>y.length?(r=y[0],_):r,_.canvas=(...y)=>y.length?(n=y[0],_):n,_.xScale=(...y)=>y.length?(o=y[0],_):o,_.yScale=(...y)=>y.length?(i=y[0],_):i,_.context=(...y)=>y.length?(s=y[0],_):s,_},Lp=()=>{let e=Lme(),t=r=>{let n=e.pad(),o=e.padUnit(),i=1;switch(o){case"domain":break;case"percent":{i=r[1]-r[0];break}default:throw new Error("Unknown padUnit: "+o)}let s=r[0]-n[0]*i,a=r[1]+n[1]*i;return r[0]=r[0]>=0&&s<0?0:s,r[1]=r[1]<=0&&a>0?0:a,r};return t.pad=function(...r){return e.pad()},t.padUnit=function(...r){return e.padUnit()},sge.rebindAll(t,e),t},gLe=`<button id="zoom-reset">Reset zoom</button>
<button id="one-year">1 Year</button>
<button id="six-months">6 Months</button>
<button id="one-month">1 Month</button>
`,wh=()=>{let e=null,t=null,r=null,n=null,o=null,i=null,s=!1,a=!1,u=()=>{};function h(A){let E=`d3fc-${a?"canvas":"svg"}.plot-area`;if(r||o){let k=n&&n.domain()[0]instanceof Date,P=j2().on("zoom",V=>{let{transform:N}=V;t.zoom={k:N.k,x:N.x,y:N.y},p(N),A.call(e);let j=N.k===1&&N.x===0&&N.y===0,J=_(A).style("display",j?"none":"");J.select("#zoom-reset").on("click",()=>A.select(E).call(P.transform,Fc));let ne=J.select("#one-year").style("display",k?"":"none"),de=J.select("#six-months").style("display",k?"":"none"),fe=J.select("#one-month").style("display",k?"":"none");if(k){let ye=ve=>()=>{let be=new Date(r.domain()[0]),je=new Date(be);ve(be,je);let Re=n.range(),Se=(Re[1]-Re[0])/(n(je)-n(be)),Ue=-n(be)*Se,qe=0;if(o){let Je=o.domain().reduce((gt,rt)=>gt+rt)/2;qe=-i(Je)*Se+o(Je)}A.select(E).call(P.transform,Fc.translate(Ue,qe).scale(Se))};ne.on("click",ye((ve,be)=>be.setYear(ve.getFullYear()+1))),de.on("click",ye((ve,be)=>be.setMonth(ve.getMonth()+6))),fe.on("click",ye((ve,be)=>be.setMonth(ve.getMonth()+1)))}}),R=e.decorate();e.decorate((V,N)=>{if(R(V,N),!s){s=!0;let j=V.select(E),J=a?window.devicePixelRatio:1;j.on("measure.zoom-range",ne=>{if(n&&n.range([0,ne.detail.width/J]),i&&i.range([0,ne.detail.height/J]),t.zoom){let de=Fc.translate(t.zoom.x,t.zoom.y).scale(t.zoom.k);j.call(P.transform,de)}}).call(P)}})}A.call(e)}h.chart=(...A)=>A.length?(e=A[0],h):e,h.settings=(...A)=>A.length?(t=A[0],h):t,h.xScale=(...A)=>A.length?(r=y(A[0]),n=r?r.copy():null,h):r,h.yScale=(...A)=>{if(!A.length)return o;if(o=y(A[0]),i=o?o.copy():null,i){let E=i.domain();i.domain([E[1],E[0]])}return h},h.canvas=(...A)=>A.length?(a=A[0],h):a,h.onChange=(...A)=>A.length?(u=A[0],h):u;let p=A=>{let E={...A};if(r&&(r.domain(A.rescaleX(n).domain()),E.xDomain=r.domain()),o){let k=A.rescaleY(i).domain();o.domain([k[1],k[0]]),E.yDomain=o.domain()}u(E)},_=A=>$l(A,".zoom-controls",()=>A.append("div").attr("class","zoom-controls").style("display","none").html(gLe)),y=A=>A&&A.nice?A:null;return h};age.plugin={name:"X Bar",category:"X Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["X Axis"]}};_Le=age,yLe=(e,t)=>{if(!vme(e)||!vme(t))return;let r=wme(e),n=wme(t);r>n?t[0]=Ame(t,r):e[0]=Ame(e,n)},vme=e=>e.length===2&&!isNaN(e[0])&&!isNaN(e[1])&&e[0]!==e[1],wme=e=>(0-e[0])/(e[1]-e[0]),Ame=(e,t)=>t*e[1]/(t-1),xLe=e=>{let t=[],r=!1,n,o=s=>{s.text("");let a=cge.dataJoin("span","splitter-label").key(p=>p),u=!r&&t.length===1,h=n&&e.splitValues.length===0;a(s,t).classed("disabled",u).text(p=>p.name).style("color",p=>h?SA(n(p.name)):void 0).on("click",(p,_)=>{u||(r?e.splitMainValues=e.splitMainValues.filter(y=>y!=_.name):e.splitMainValues=[_.name].concat(e.splitMainValues||[]),p.target.getRootNode().host.closest("perspective-viewer")?.dispatchEvent(new Event("perspective-config-update")),i(s))})},i=s=>{let a=zB(s.node());a._container.innerHTML="",a._draw()};return o.labels=(...s)=>s.length?(t=s[0],o):t,o.alt=(...s)=>s.length?(r=s[0],o):r,o.color=(...s)=>s.length?(n=s[0],o):n,o},b4=(e,t,r=bLe)=>{let n,o,i,s=e.splitMainValues||[],a=p=>{let _=p.split("|");return s.includes(_[_.length-1])},u=e.mainValues.some(p=>a(p.name));o=u?r(t,p=>!a(p)):t,i=u?r(t,a):null;let h=p=>{if(e.mainValues.length===1)return;let _=e.mainValues.map((k,P)=>({index:P,name:k.name})),y=_.filter(k=>!a(k.name)),A=_.filter(k=>a(k.name)),E=()=>xLe(e).color(n);p.select(".y-label.left-label").call(E().labels(y)),p.select(".y-label.right-label").call(E().labels(A).alt(!0))};return h.color=(...p)=>p.length?(n=p[0],h):n,h.haveSplit=()=>u,h.data=(...p)=>p.length?(o=p[0],h):o,h.altData=(...p)=>p.length?(i=p[0],h):i,h},bLe=(e,t)=>e.map(r=>r.filter(n=>t(n.key))),uge=(e,t)=>e.map(r=>t(r.key)?r:r.map(n=>Object.assign({},n,{mainValue:null}))),vLe=(e,t)=>e.map(r=>uge(r,t));fge.plugin={name:"Y Bar",category:"Y Chart",max_cells:1e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};wLe=fge;pge=function(e){let t=[];for(let r of e)for(let n=0;n<r.length;n++)r[n].mainValue!==null&&(t[n]=t[n]||[],t[n].push(r[n]));return t},Mme=(e,t,r=Math.min)=>{let n=s=>s.reduce((a,u)=>{let h=o(u);return h&&(!a||r(a.value,h.value)===h.value)?h:a},null),o=s=>{if(Array.isArray(s))return n(s);let a=t(s);return a!==null?{item:s,value:a}:null},i=n(e);return i?i.item:null},m_=()=>{let e=g4().alwaysShow(!0),t=null,r=null,n=null,o=null,i=!1,s=null,a="crossValue",u="mainValue",h=null,p=1,_=E=>{let k=`d3fc-${i?"canvas":"svg"}.plot-area`;if(t||r){let P=null,R=v4.pointer().on("point",V=>{let N=V.length?A(V[0]):null;P=N?[N.data]:[];let j=N?N.scale:r;y(E,P,j)});E.select(k).on("measure.nearbyTip",()=>y(E,[])).on("click",()=>{P.length&&LB(E.node(),P[0],e.settings())}).call(R)}},y=(E,k,P=r)=>{let R=E.select("d3fc-svg.plot-area svg").selectAll("circle.nearbyTip").data(k);R.exit().remove(),R.enter().append("circle").attr("class","nearbyTip").merge(R).attr("r",V=>o?p*Math.sqrt(o(V.size)):10).attr("transform",V=>`translate(${t(V[a])},${P(V[u])})`).style("stroke","none").style("fill",V=>n&&V.key&&y4(n(V.key))),e(R)},A=E=>{let k=V=>N=>N[u]===void 0||N[u]===null||N[a]===void 0||N[a]===null?null:Math.sqrt(Math.pow(t(N[a])-E.x,2)+Math.pow(V(N[u])-E.y,2)),P=k(r),R=Mme(s,P,Math.min);if(h){let V=k(h.yScale),N=Mme(h.data,V,Math.min);return P(R)<=V(N)?{data:R,scale:r}:{data:N,scale:h.yScale}}return{data:R,scale:r}};return _.scaleFactor=(...E)=>E.length?(p=E[0],_):p,_.xScale=(...E)=>E.length?(t=E[0],_):t,_.yScale=(...E)=>E.length?(r=E[0],_):r,_.color=(...E)=>E.length?(n=E[0],_):n,_.size=(...E)=>E.length?(o=E[0]?E[0].copy().range([40,4e3]):null,_):o,_.canvas=(...E)=>E.length?(i=E[0],_):i,_.data=(...E)=>E.length?(s=E[0],_):s,_.xValueName=(...E)=>E.length?(a=E[0],_):a,_.yValueName=(...E)=>E.length?(u=E[0],_):u,_.altDataWithScale=(...E)=>E.length?(h=E[0],_):h,_.settings=(...E)=>E.length?(e.settings(E[0]),_):e.settings(),v4.rebindAll(_,e),_};mge.plugin={name:"Y Line",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};MLe=mge,TB=Math.sqrt(3),SLe={draw:function(e,t){let r=Math.sqrt(t/(TB*3));e.moveTo(0,r*2),e.lineTo(-TB*r,-r),e.lineTo(TB*r,-r),e.closePath()}},TLe=[Zl,_p,yp,xp,bp,vp,wp],yge={circle:Zl,square:xp,cross:_p,diamond:yp,star:bp,triangle:vp,wye:wp,nabla:SLe};ELe=8,ILe=1;xge.plugin={name:"X/Y Line",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Tooltip"]},selectMode:"toggle"};RLe=xge;vge.plugin={name:"Y Area",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};DLe=vge;Mge.plugin={name:"Y Scatter",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{names:["Y Axis"]}};BLe=Mge;Sge=(e,t,r)=>r||Bme().valueName(t).pad([0,0])(e),WLe=e=>{let t=e.slice(1).map((r,n)=>$i(e[n][1],r[1]));return r=>{let n=e.findIndex((a,u)=>u<e.length-1&&r<=e[u+1][0]&&r>a[0]);if(n===-1)return r<=e[0][0]?e[0][1]:e[e.length-1][1];let o=t[n],[i]=e[n],[s]=e[n+1];return o((r-i)/(s-i))}};M4.plugin={name:"X/Y Scatter",category:"X/Y Chart",max_cells:5e4,max_columns:50,render_warning:!0,initial:{type:"number",count:2,names:["X Axis","Y Axis","Color","Size","Symbol","Label","Tooltip"]},selectMode:"toggle"};M4.can_render_column_styles=(e,t)=>e==="string"&&t==="Symbol";M4.column_style_controls=(e,t)=>e==="string"&&t==="Symbol"?{symbols:{keys:"row",values:Object.keys(yge)}}:null;qLe=M4;Ege.plugin={name:"Heatmap",category:"Hierarchial Chart",max_cells:5e4,max_columns:500,render_warning:!0,initial:{names:["Color"]}};KLe=Ege;JLe=e=>e.closeValue>=e.openValue;Cge=tFe,kge=Cge(Ige.seriesCanvasOhlc);kge.plugin={name:"OHLC",category:"Y Chart",max_cells:3500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};rFe=kge,Oge=Cge(Pge.seriesCanvasCandlestick);Oge.plugin={name:"Candlestick",category:"Y Chart",max_cells:4e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Open","Close","High","Low","Tooltip"]},selectMode:"toggle"};nFe=Oge;xA=(e,t,r)=>r.length?e[`${r}|${t.name}`]:e[t.name];zge=e=>v2().startAngle(t=>t.x0).endAngle(t=>t.x1).padAngle(t=>Math.min((t.x1-t.x0)/2,.005)).padRadius(e).innerRadius(t=>Math.max(1,(t.y0-1)*e)).outerRadius(t=>Math.max((t.y0-1)*e,(t.y1-1)*e-1)),f_=e=>e.y0>=1&&e.x1>e.x0,PB=e=>e.y1<=3&&e.y0>=1&&(e.y1-e.y0)*(e.x1-e.x0)>.06;lFe=(e,t,r,n,o,i,s,a,u)=>(h,p)=>{u.sunburstLevel[a]=h.data.name,h.parent?(r.datum(h.parent),r.style("cursor","pointer"),n.html(`&#8682; ${h.label}`)):(r.datum(e),r.style("cursor","default"),n.html("")),e.each(y=>y.target={x0:Math.max(0,Math.min(1,(y.x0-h.x0)/(h.x1-h.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(y.x1-h.x0)/(h.x1-h.x0)))*2*Math.PI,y0:Math.max(0,y.y0-h.depth),y1:Math.max(0,y.y1-h.depth)});let _=t.transition().duration(p?0:750);o.transition(_).tween("data",y=>{let A=$i(y.current,y.target);return E=>y.current=A(E)}).filter(function(y){return+this.getAttribute("fill-opacity")||f_(y.target)}).attr("fill-opacity",y=>f_(y.target)?1:0).attr("user-select",y=>f_(y.target)?"initial":"none").style("pointer-events",y=>f_(y.target)?"initial":"none").attrTween("d",y=>()=>zge(s)(y.current)),i.filter(function(y){return+this.getAttribute("fill-opacity")||PB(y.target)}).transition(_).attr("fill-opacity",y=>+PB(y.target)).attrTween("transform",y=>()=>Dge(y.current,s))};Lge.plugin={name:"Sunburst",category:"Hierarchial Chart",max_cells:7500,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};uFe=Lge;Tme=7,EB=e=>!!(e.target&&e.target.textAttributes),Bge=(e,t,r)=>{e.selectAll("text").each(function(o,i){let s=yFe(o,t,r);this.style=s});let n=qB(e);mFe(n),jge(n)},hFe=e=>{e.each((t,r,n)=>{$t(n[r]).selectAll("text").attr("dx",t.target.textAttributes.dx).attr("dy",t.target.textAttributes.dy).attr("style",t.target.textAttributes.style)})},jge=e=>{let t=n=>n.getBoundingClientRect(),r=[];e.selectAll("text").filter((n,o,i)=>$t(i[o]).attr("style")===h_.high).each((n,o,i)=>r.push(i[o])),e.selectAll("text").filter((n,o,i)=>$t(i[o]).attr("style")===h_.low).each((n,o,i)=>{let s=i[o];r.filter(a=>dme("x",t(a),t(s))&&dme("y",t(a),t(s),-2)).forEach(()=>$t(s).attr("dy",Number($t(s).attr("dy"))+14))})},dFe=e=>$t(e).style("opacity",YB[$t(e).attr("class")]),pFe=e=>$t(e).style("opacity",null),YB={top:1,mid:.7,lower:0},qB=e=>e.filter((t,r,n)=>$t(n[r]).selectAll("text").attr("style")!==h_.zero),Uge=e=>e.selectAll("text").each((t,r,n)=>gFe(n[r])),mFe=e=>e.selectAll("text").each((t,r,n)=>Vge(n[r])),Vge=e=>{let t=$t(e),r=e.getBoundingClientRect();t.attr("dx",0-r.width/2).attr("dy",0+r.height/4)},gFe=e=>{let t=e.parentNode.childNodes[0],r=e.getBBox(),n=t.getBBox();_Fe(e,n,r)||$t(e).attr("style",$t(e).attr("style"))},_Fe=(e,t,r)=>{let n=Math.min(t.height/r.height,t.width/r.width);if(n<1){let o=parseInt($t(e).style("font-size")),i=Math.floor(o*n);return o>Tme&&i>Tme?($t(e).style("font-size",`${i}px`),Vge(e)):($t(e).style("font-size",null),$t(e).style("opacity","0")),!0}return!1},yFe=(e,t,r)=>{if(!r.filter(n=>n!=="").every(n=>e.crossValue.includes(n)))return h_.zero;switch(e.depth){case t+1:return h_.high;case t+2:return h_.low;default:return h_.zero}},h_={high:"font-size:14px;z-index:5;pointer-events: none;",low:"font-size:8px;opacity:0.7;z-index:4;",zero:"font-size:0px;opacity:0;z-index:4;"},Wge=(e,t)=>{let r=UI().size([e,t]).paddingInner(n=>1+2*(n.height-1));return r.tile(VI),r},xFe=(e,t)=>t.every(r=>e.crossValue.includes(r));Yge=(e,t)=>{e.each((r,n,o)=>{let i=$t(o[n]).selectAll("text");r.mapLevel[t].textAttributes={dx:i.attr("dx"),dy:i.attr("dy"),class:i.attr("class"),"font-size":i.style("font-size")}})};SFe=e=>e.target.textLockedAt.opacity,TFe=e=>YB[$t(e).attr("class")],EFe=(e,t)=>{t.deactivate(!0),e.each((r,n,o)=>{$t(o[n]).selectAll("rect").style("pointer-events","none")})},IB=(e,t=void 0)=>{t&&t.deactivate(!1),e.each((r,n,o)=>{$t(o[n]).selectAll("rect").style("pointer-events",null)})},IFe=`<button id="goto-parent">Goto parent</button>
`;u4={leaf:"leafnode",branch:"branchnode",root:"rootnode"},wA=e=>e.x1-e.x0,AA=e=>e.y1-e.y0,kFe=(e,t)=>t.depth===e,Eme=(e,t)=>t.depth===0?u4.root:kFe(e,t)?u4.leaf:u4.branch;Hge.plugin={type:"Treemap",name:"Treemap",category:"Hierarchial Chart",max_cells:3e3,max_columns:50,render_warning:!0,initial:{type:"number",count:1,names:["Size","Color","Tooltip"]}};OFe=Hge,RFe=[_Le,wLe,MLe,RLe,DLe,BLe,qLe,rFe,nFe,OFe,uFe,KLe],Ime=RFe,Cme=(e,t)=>{if(!t.colorStyles){let r={scheme:[],gradient:{},interpolator:{},grid:{}},n=DFe(e);r.series=n("--d3fc-local-series");for(let o=1;;o++){let i=`series-${o}`,s=n(`--d3fc-local-${i}`);if(!s)break;r[i]=s,r.scheme.push(s)}r.opacity=NFe(r.series),r.grid.gridLineColor=n`--d3fc-gridline--color`,["full","positive","negative"].forEach(o=>{let i=n(`--d3fc-local-${o}--gradient`);r.gradient[o]=LFe(i,r.opacity)}),t.colorStyles=r}if(!t.textStyles){let r=window.getComputedStyle(e),n=r.getPropertyValue("color"),o=`12px ${r.getPropertyValue("font-family")}`;t.textStyles={color:n,font:o}}},NFe=e=>Vo(e).opacity,zFe=(e,t)=>{let r=Vo(`#${e}`);return r.opacity=t,r+""},DFe=e=>{let t=getComputedStyle(e);return r=>t?.getPropertyValue(r)},LFe=(e,t)=>{let r=Xge.parse(e)[0].colorStops;return r.map((n,o)=>[n.length?n.length.value/100:o/(r.length-1),zFe(n.value,t)]).sort((n,o)=>n[0]-o[0])},FFe=':host .chart{--d3fc-local-full--gradient:var(--d3fc-full--gradient,linear-gradient(#4d342f 0%,#e4521b 22.5%,#feeb65 42.5%,#f0f0f0 50%,#dcedc8 57.5%,#42b3d5 67.5%,#1a237e 100%));--d3fc-local-positive--gradient:var(--d3fc-positive--gradient,linear-gradient(#dcedc8 0%,#42b3d5 35%,#1a237e 100%));--d3fc-local-negative--gradient:var(--d3fc-negative--gradient,linear-gradient(#feeb65 100%,#e4521b 70%,#4d342f 0%));--d3fc-local-series:var(--d3fc-series,rgba(31,119,180,0.5));--d3fc-local-series-1:var(--d3fc-series-1,#0366d6);--d3fc-local-series-2:var(--d3fc-series-2,#ff7f0e);--d3fc-local-series-3:var(--d3fc-series-3,#2ca02c);--d3fc-local-series-4:var(--d3fc-series-4,#d62728);--d3fc-local-series-5:var(--d3fc-series-5,#9467bd);--d3fc-local-series-6:var(--d3fc-series-6,#8c564b);--d3fc-local-series-7:var(--d3fc-series-7,#e377c2);--d3fc-local-series-8:var(--d3fc-series-8,#7f7f7f);--d3fc-local-series-9:var(--d3fc-series-9,#bcbd22);--d3fc-local-series-10:var(--d3fc-series-10,#17becf);}:host .chart .series{fill:var(--d3fc-local-series);}:host .chart .series-1{fill:var(--d3fc-local-series-1);}:host .chart .series-2{fill:var(--d3fc-local-series-2);}:host .chart .series-3{fill:var(--d3fc-local-series-3);}:host .chart .series-4{fill:var(--d3fc-local-series-4);}:host .chart .series-5{fill:var(--d3fc-local-series-5);}:host .chart .series-6{fill:var(--d3fc-local-series-6);}:host .chart .series-7{fill:var(--d3fc-local-series-7);}:host .chart .series-8{fill:var(--d3fc-local-series-8);}:host .chart .series-9{fill:var(--d3fc-local-series-9);}:host .chart .series-10{fill:var(--d3fc-local-series-10);}:host{user-select:none;}:host .chart{position:absolute;box-sizing:border-box;left:0;top:0;width:100%;height:100%;padding:12px;overflow:hidden;}:host .chart.heatmap d3fc-group.cartesian-chart,:host .chart.treemap d3fc-group.cartesian-chart{grid-template-columns:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);grid-template-rows:minmax(0em,max-content)auto 1fr auto minmax(0em,max-content);}:host .chart .chart-label{display:none;}:host .chart.heatmap{padding-right:120px;}:host .chart.xyscatter{padding:0;font-size:14px;}:host .chart.xyscatter d3fc-group:first-child{padding:16px;padding-top:0px;width:calc(100% - 32px);height:calc(100% - 16px);}:host .chart.xyscatter .multi-xlabel{position:absolute;bottom:0;height:2.5em;width:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .multi-ylabel{position:absolute;top:0;width:2.5em;height:100%;display:flex;justify-content:center;align-items:center;background:var(--d3fc-legend--background);}:host .chart.xyscatter .outer-container{height:100%;}:host .chart.xyscatter .inner-container{display:inline-grid;overflow-y:auto;width:calc(100% - 16px);height:100%;padding:0;margin:0;}:host .chart.xyscatter .inner-container div{overflow:hidden;}:host .chart.xyscatter .inner-container text.segment,:host .chart.xyscatter .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.xyscatter .inner-container div.xy-scatter-container{margin:5px 0;}:host .chart.sunburst{padding:0;font-size:14px;}:host .chart.sunburst .outer-container{height:100%;}:host .chart.sunburst .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.sunburst .inner-container div{overflow:hidden;}:host .chart.sunburst .inner-container .sunburst-container:not(:only-child) svg{transform:translate(0,-27px);}:host .chart.sunburst .inner-container svg{width:100%;height:100%;}:host .chart.sunburst .inner-container path{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.sunburst .inner-container text.segment,:host .chart.sunburst .inner-container text.parent{text-anchor:middle;user-select:none;pointer-events:none;fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.sunburst .inner-container div.title-container{margin-top:5px;}:host .chart.has-legend{padding-right:120px;}:host .chart.treemap .treemap-container{position:relative;}:host .chart.treemap .treemap-container:not(:only-child){width:calc(100% - 12px);height:calc(100% - 12px);}:host .chart.treemap .outer-container{height:100%;}:host .chart.treemap .inner-container{width:100%;height:100%;display:inline-grid;padding:0;margin:0;overflow-x:hidden;overflow-y:auto;}:host .chart.treemap .inner-container div{overflow:hidden;}:host .chart.treemap .inner-container svg{width:100%;height:100%;}:host .chart.treemap .inner-container .treerect{stroke:var(--d3fc-treedata-axis--lines,var(--d3fc-axis--lines,white));fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host .chart.treemap .inner-container .treerect:hover{cursor:pointer;stroke:var(--d3fc-treedata--hover-highlight,black);stroke-opacity:1;}:host .chart.treemap .inner-container .rootnode{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .branchnode{opacity:0;}:host .chart.treemap .inner-container .branchnode:hover{fill-opacity:0.1;opacity:1;fill:var(--d3fc-treedata--hover-highlight,black);}:host .chart.treemap .inner-container .leafnode{fill-opacity:0.8;}:host .chart.treemap .inner-container .leafnode:hover{fill-opacity:0.5;}:host .chart.treemap .inner-container #hidden{opacity:0;pointer-events:none;z-index:0;}:host .chart.treemap .inner-container .top{font-size:14px;z-index:5;pointer-events:none;}:host .chart.treemap .inner-container .mid{font-size:8px;opacity:0.7;z-index:4;}:host .chart.treemap .inner-container .lower{font-size:0px;opacity:0;z-index:4;}:host .chart.treemap .inner-container text{fill:var(--d3fc-treedata--labels,rgb(51,51,51));}:host .chart.treemap .inner-container text.title{dominant-baseline:hanging;}:host .chart.treemap .inner-container .parent-controls{position:absolute;top:12px;right:auto;left:30px;width:auto;z-index:4;transition:box-shadow 1s;}:host .chart.treemap .inner-container .parent-controls:hover{box-shadow:2px 2px 6px#000;transition:box-shadow 0.2s;}:host .chart .x-label{height:1.2em!important;line-height:1em!important;}:host .chart .x-label,:host .chart .y-label{color:var(--d3fc-label--color,inherit);font-size:14px;}:host .chart d3fc-canvas.plot-area{display:none;}:host .chart.xyscatter d3fc-canvas.plot-area,:host .chart.xyline d3fc-canvas.plot-area,:host .chart.ohlc d3fc-canvas.plot-area,:host .chart.candlestick d3fc-canvas.plot-area,:host .chart.heatmap d3fc-canvas.plot-area{display:block;}:host .chart .y-axis text,:host .chart .x-axis text{fill:var(--d3fc-axis-ticks--color,rgb(80,80,80));font-size:11px;}:host .chart .y-axis path,:host .chart .x-axis path{stroke:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label{display:inline-block;margin:0 10px;cursor:pointer;}:host .chart .splitter-label::after{margin-left:5px;color:var(--d3fc-axis--lines,rgb(180,210,225));}:host .chart .splitter-label:hover::after{color:var(--d3fc-axis-ticks--color,rgb(80,80,80));}:host .chart .splitter-label.disabled::after{color:rgba(80,80,80,0.3);}:host .chart .splitter-label.disabled{cursor:default;}:host .chart .y-label.left-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}:host .chart .y-label.right-label .splitter-label::after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:16px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}:host .chart.ybar .y-axis path,:host .chart.yline .y-axis path,:host .chart.xyline .y-axis path,:host .chart.xyline .x-axis path,:host .chart.yarea .y-axis path,:host .chart.yscatter .y-axis path,:host .chart.xyscatter .y-axis path,:host .chart.xyscatter .x-axis path,:host .chart.xbar .x-axis path{visibility:hidden;}:host .chart .y-label{white-space:nowrap;}:host .chart .nearbyTip{fill:var(--d3fc-series,rgba(31,119,180,0.5));}:host #dragHandles{position:absolute;top:0px;right:0px;left:auto;pointer-events:none;}:host #dragHandles rect{pointer-events:all;}:host .label rect{fill:none;}:host .legend-container{position:absolute;top:12px;right:12px;left:auto;width:150px;height:280px;}:host .legend-container.legend-color{width:90px;height:150px;}:host .legend-container[borderbox-on-hover="true"]{transition:box-shadow 1s;}:host .legend-container[borderbox-on-hover="true"]:hover{background-color:var(--d3fc-legend--background,#ffffff);transition:box-shadow 0.2s,background-color 0.2s;}:host .legend-container .legend{font-size:8pt;width:100%;}:host .legend-container .legend .cell{cursor:pointer;}:host .legend-container .legend .cell path{fill:var(--d3fc-series,rgba(31,119,180,0.5));stroke:var(--d3fc-series,rgb(31,119,180));}:host .legend-container .legend .cell.hidden path{fill:rgba(204,204,204,0.5);stroke:rgb(204,204,204);}:host .legend-container .legend .cell.hidden circle{fill:rgb(204,204,204)!important;}:host .legend-container text{fill:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .label:hover{fill:rgb(34,160,206);}:host .legend-container #legend-axis path{stroke:var(--d3fc-legend--text,rgb(51,51,51));}:host .legend-container .legend-controls{margin-left:12px;}:host .legend-container .legend-controls #up-arrow,:host .legend-container .legend-controls #down-arrow{cursor:pointer;color:rgb(31,119,180);}:host .legend-container .legend-controls #up-arrow.disabled,:host .legend-container .legend-controls #down-arrow.disabled{cursor:default;color:rgb(51,51,51);}:host .heatmap .legend-container.legend-color{height:200px;}:host .treemap .legend-container.legend-color{height:200px;}:host .treemap .legend-container:not(.legend-color){width:100px;}:host .zoom-controls{position:absolute;top:10px;left:0;width:100%;text-align:center;}:host .zoom-controls button{-webkit-appearance:none;background:var(--plugin--background,rgb(247,247,247));border:1px solid var(--inactive--color,rgb(204,204,204));color:var(--d3fc-label--color,inherit);font-size:12px;padding:8px;opacity:0.5;cursor:pointer;}:host .zoom-controls button:hover{opacity:1;}:host .parent-controls{position:absolute;top:30px;right:145px;width:100%;text-align:right;}:host .parent-controls button{-webkit-appearance:none;background:rgb(247,247,247);border:1px solid rgb(204,204,204);padding:10px;opacity:0.5;cursor:pointer;}:host .parent-controls button:hover{background:rgb(230,230,230);}:host div.tooltip{position:absolute;text-align:left;font-size:12px;font-weight:300;white-space:nowrap;padding:0.5em;background:var(--d3fc-tooltip--background,#ffffff);color:var(--d3fc-tooltip--color,black);border:1px solid var(--d3fc-tooltip--border-color,#777777);box-shadow:var(--d3fc-tooltip--box-shadow,none);pointer-events:none;}:host div.tooltip ul{margin:0;padding:0;list-style-type:none;}',kme={initial:{type:"number",count:1,names:[]},selectMode:"select"},BFe=`${FFe}${jFe()}`,CB=["crossValues","mainValues","realValues","splitValues","filter","data","size","colorStyles","textStyles","agg_paths","treemaps","axisMemo","columns_config"];Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector);VFe()});function nd(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var iu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},tye=iu.self||iu.window||iu.global||{},rye=iu.window||iu.self||iu.global||{},nye=iu.global||iu.self||iu.window||{},iye=iu.document||{};var bm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var RU=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),oye=RU&&parseFloat(RU[1])||0;var HA=globalThis,sye=globalThis.document||{},XA=globalThis.process||{},aye=globalThis.console,NU=globalThis.navigator||{};function KA(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let t=typeof navigator<"u"&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}function zs(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||KA()}function y5(e){return!e&&!zs()?"Node":KA(e)?"Electron":(e||NU.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var x5="4.0.7";function cye(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}var $A=class{constructor(t,r,n="sessionStorage"){this.storage=cye(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){let r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}};function zU(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function DU(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var QA;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(QA||(QA={}));var uye=10;function LU(e){return typeof e!="string"?e:(e=e.toUpperCase(),QA[e]||QA.WHITE)}function FU(e,t,r){return!zs&&typeof e=="string"&&(t&&(e=`\x1B[${LU(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${LU(r)+uye}m${e}\x1B[49m`)),e}function BU(e,t=["constructor"]){let r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),o=e;for(let i of n){let s=o[i];typeof s=="function"&&(t.find(a=>i===a)||(o[i]=s.bind(e)))}}function Qx(e,t){if(!e)throw new Error(t||"Assertion failed")}function vm(){let e;if(zs()&&HA.performance)e=HA?.performance?.now?.();else if("hrtime"in XA){let t=XA?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var W_={debug:zs()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},fye={enabled:!0,level:0};function Z_(){}var jU={},UU={once:!0},wa=class{constructor({id:t}={id:""}){this.VERSION=x5,this._startTs=vm(),this._deltaTs=vm(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new $A(`__probe-${this.id}__`,fye),this.timeStamp(`${this.id} started`),BU(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((vm()-this._startTs).toPrecision(10))}getDelta(){return Number((vm()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,W_.warn,arguments,UU)}error(t){return this._getLogFunction(0,t,W_.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,W_.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,W_.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,W_.debug||W_.info,arguments,UU)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||Z_,n&&[n],{tag:dye(r)}):Z_}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||Z_)}group(t,r,n={collapsed:!1}){let o=VU({logLevel:t,message:r,opts:n}),{collapsed:i}=n;return o.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Z_)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=WU(t)}_getLogFunction(t,r,n,o,i){if(this._shouldLog(t)){i=VU({logLevel:t,message:r,args:o,opts:i}),n=n||i.method,Qx(n),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=vm();let s=i.tag||i.message;if(i.once&&s)if(!jU[s])jU[s]=vm();else return Z_;return r=hye(this.id,i.message,i),n.bind(console,r,...i.args)}return Z_}};wa.VERSION=x5;function WU(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Qx(Number.isFinite(t)&&t>=0),t}function VU(e){let{logLevel:t,message:r}=e;e.logLevel=WU(t);let n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break;default:}typeof e.message=="function"&&(e.message=e.message());let o=typeof e.message;return Qx(o==="string"||o==="object"),Object.assign(e,{args:n},e.opts)}function hye(e,t,r){if(typeof t=="string"){let n=r.time?DU(zU(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=FU(t,r.color,r.background)}return t}function dye(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}globalThis.probe={};var E9e=new wa({id:"@probe.gl/log"});function b5(e,t){return ZU(e||{},t)}function ZU(e,t,r=0){if(r>3)return t;let n={...e};for(let[o,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?n[o]=ZU(n[o]||{},t[o],r+1):n[o]=t[o];return n}var YU="latest";function pye(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0"),globalThis._loadersgl_.version}var v5=pye();function ta(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var ou={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},N9e=ou.self||ou.window||ou.global||{},z9e=ou.window||ou.self||ou.global||{},D9e=ou.global||ou.self||ou.window||{},L9e=ou.document||{};var wl=typeof process!="object"||String(process)!=="[object process]"||process.browser;var GU=typeof window<"u"&&typeof window.orientation<"u",qU=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),F9e=qU&&parseFloat(qU[1])||0;var Jx=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((n,o)=>{this._resolve=n,this._reject=o})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){ta(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){ta(this.isRunning),this.isRunning=!1,this._reject(t)}};var Y_=class{terminate(){}};var w5=new Map;function HU(e){ta(e.source&&!e.url||!e.source&&e.url);let t=w5.get(e.source||e.url);return t||(e.url&&(t=mye(e.url),w5.set(e.url,t)),e.source&&(t=XU(e.source),w5.set(e.source,t))),ta(t),t}function mye(e){if(!e.startsWith("http"))return e;let t=gye(e);return XU(t)}function XU(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function gye(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function A5(e,t=!0,r){let n=r||new Set;if(e){if(KU(e))n.add(e);else if(KU(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let o in e)A5(e[o],t,n)}}return r===void 0?Array.from(n):[]}function KU(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var M5=()=>{},id=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&wl||typeof Y_<"u"&&!wl}constructor(t){let{name:r,source:n,url:o}=t;ta(n||o),this.name=r,this.source=n,this.url=o,this.onMessage=M5,this.onError=i=>console.log(i),this.worker=wl?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=M5,this.onError=M5,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,r){r=r||A5(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=HU({source:this.source,url:this.url});let t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){let n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Y_(n,{eval:!1})}else if(this.source)t=new Y_(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}};var eb=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return id.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(o,i,s)=>o.done(s),n=(o,i)=>o.error(i)){let o=new Promise(i=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:i}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;let t=this._getAvailableWorker();if(!t)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});let n=new Jx(r.name,t);t.onMessage=o=>r.onMessage(n,o.type,o.payload),t.onError=o=>r.onError(n,o),r.onStart(n);try{await n.result}catch(o){console.error(`Worker exception: ${o}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!wl||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new id({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return GU?this.maxMobileConcurrency:this.maxConcurrency}};var _ye={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},wm=class e{props;workerPools=new Map;static _workerFarm;static isSupported(){return id.isSupported()}static getWorkerFarm(t={}){return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}constructor(t){this.props={..._ye},this.setProps(t),this.workerPools=new Map}destroy(){for(let t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){let{name:r,source:n,url:o}=t,i=this.workerPools.get(r);return i||(i=new eb({name:r,source:n,url:o}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function S5(e,t={}){let r=t[e.id]||{},n=wl?`${e.id}-worker.js`:`${e.id}-worker-node.js`,o=r.workerUrl;if(!o&&e.id==="compression"&&(o=t.workerUrl),t._workerType==="test"&&(wl?o=`modules/${e.module}/dist/${n}`:o=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!o){let i=e.version;i==="latest"&&(i=YU);let s=i?`@${i}`:"";o=`https://unpkg.com/@loaders.gl/${e.module}${s}/dist/${n}`}return ta(o),o}function T5(e,t=v5){ta(e,"no worker provided");let r=e.version;return!(!t||!r)}function E5(e,t){return!wm.isSupported()||!wl&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function I5(e,t,r,n,o){let i=e.id,s=S5(e,r),u=wm.getWorkerFarm(r).getWorkerPool({name:i,url:s});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));let h=await u.startJob("process-on-worker",yye.bind(null,o));return h.postMessage("process",{input:t,options:r,context:n}),await(await h.result).result}async function yye(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":let{id:o,input:i,options:s}=n;try{let a=await e(i,s);t.postMessage("done",{id:o,result:a})}catch(a){let u=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:o,error:u})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function C5(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let n=new Uint8Array(e),o=new Uint8Array(t);for(let i=0;i<n.length;++i)if(n[i]!==o[i])return!1;return!0}function k5(...e){return $U(e)}function $U(e){let t=e.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),r=t.reduce((i,s)=>i+s.byteLength,0),n=new Uint8Array(r),o=0;for(let i of t)n.set(i,o),o+=i.byteLength;return n.buffer}async function P5(e){let t=[];for await(let r of e)t.push(r);return k5(...t)}function tb(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var Am=class{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Aa=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let t of Object.values(this.stats))t.reset();return this}forEach(t){for(let r of Object.values(this.stats))t(r)}getTable(){let t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){let{name:r,type:n}=t,o=this.stats[r];return o||(t instanceof Am?o=t:o=new Am(r,n),this.stats[r]=o),o}};var xye="Queued Requests",bye="Active Requests",vye="Cancelled Requests",wye="Queued Requests Ever",Aye="Active Requests Ever",Mye={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},q_=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...Mye,...t},this.stats=new Aa({id:this.props.id}),this.stats.get(xye),this.stats.get(bye),this.stats.get(vye),this.stats.get(wye),this.stats.get(Aye)}scheduleRequest(t,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);let n={handle:t,priority:0,getPriority:r},o=new Promise(i=>(n.resolve=i,n));return this.requestQueue.push(n),this.requestMap.set(t,o),this._issueNewRequests(),o}_issueRequest(t){let{handle:r,resolve:n}=t,o=!1,i=()=>{o||(o=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let r=0;r<t;++r){let n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){let t=this.requestQueue;for(let r=0;r<t.length;++r){let n=t[r];this._updateRequest(n)||(t.splice(r,1),this.requestMap.delete(n.handle),r--)}t.sort((r,n)=>r.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}};var Sye="",QU={};function O5(e){for(let t in QU)if(e.startsWith(t)){let r=QU[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Sye}${e}`),e}function JU(e){return e&&typeof e=="object"&&e.isBuffer}function JA(e){if(JU(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var Mm={};io(Mm,{dirname:()=>Eye,filename:()=>Tye,join:()=>Iye,resolve:()=>Cye});function eV(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function Tye(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function Eye(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Iye(...e){let t="/";return e=e.map((r,n)=>(n&&(r=r.replace(new RegExp(`^${t}`),"")),n!==e.length-1&&(r=r.replace(new RegExp(`${t}$`),"")),r)),e.join(t)}function Cye(...e){let t=[];for(let i=0;i<e.length;i++)t[i]=e[i];let r="",n=!1,o;for(let i=t.length-1;i>=-1&&!n;i--){let s;i>=0?s=t[i]:(o===void 0&&(o=eV()),s=o),s.length!==0&&(r=`${s}/${r}`,n=s.charCodeAt(0)===rb)}return r=kye(r,!n),n?`/${r}`:r.length>0?r:"."}var rb=47,R5=46;function kye(e,t){let r="",n=-1,o=0,i,s=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===rb)break;i=rb}if(i===rb){if(!(n===a-1||o===1))if(n!==a-1&&o===2){if(r.length<2||!s||r.charCodeAt(r.length-1)!==R5||r.charCodeAt(r.length-2)!==R5){if(r.length>2){let u=r.length-1,h=u;for(;h>=0&&r.charCodeAt(h)!==rb;--h);if(h!==u){r=h===-1?"":r.slice(0,h),n=a,o=0,s=!1;continue}}else if(r.length===2||r.length===1){r="",n=a,o=0,s=!1;continue}}t&&(r.length>0?r+="/..":r="..",s=!0)}else{let u=e.slice(n+1,a);r.length>0?r+=`/${u}`:r=u,s=!1}n=a,o=0}else i===R5&&o!==-1?++o:o=-1}return r}var Pye=e=>typeof e=="boolean",nb=e=>typeof e=="function",Sm=e=>e!==null&&typeof e=="object",N5=e=>Sm(e)&&e.constructor==={}.constructor;var tV=e=>!!e&&typeof e[Symbol.iterator]=="function",rV=e=>e&&typeof e[Symbol.asyncIterator]=="function";var Al=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var Ml=e=>typeof Blob<"u"&&e instanceof Blob,nV=e=>e&&typeof e=="object"&&e.isBuffer;var Oye=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Sm(e)&&nb(e.tee)&&nb(e.cancel)&&nb(e.getReader);var Rye=e=>Sm(e)&&nb(e.read)&&nb(e.pipe)&&Pye(e.readable),eM=e=>Oye(e)||Rye(e);var tM=class extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var Nye=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,zye=/^([-\w.]+\/[-\w.+]+)/;function z5(e,t){return e.toLowerCase()===t.toLowerCase()}function iV(e){let t=zye.exec(e);return t?t[1]:e}function D5(e){let t=Nye.exec(e);return t?t[1]:""}var oV=/\?.*/;function sV(e){let t=e.match(oV);return t&&t[0]}function G_(e){return e.replace(oV,"")}function aV(e){if(e.length<50)return e;let t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Tm(e){return Al(e)?e.url:Ml(e)?e.name||"":typeof e=="string"?e:""}function ib(e){if(Al(e)){let t=e,r=t.headers.get("content-type")||"",n=G_(t.url);return iV(r)||D5(n)}return Ml(e)?e.type||"":typeof e=="string"?D5(e):""}function lV(e){return Al(e)?e.headers["content-length"]||-1:Ml(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function rM(e){if(Al(e))return e;let t={},r=lV(e);r>=0&&(t["content-length"]=String(r));let n=Tm(e),o=ib(e);o&&(t["content-type"]=o);let i=await Lye(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));let s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:n}),s}async function cV(e){if(!e.ok)throw await Dye(e)}async function Dye(e){let t=aV(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let n={reason:e.statusText,url:e.url,response:e};try{let o=e.headers.get("Content-Type");n.reason=o?.includes("application/json")?await e.json():e.text()}catch{}return new tM(r,n)}async function Lye(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let r=e.slice(0,5);return await new Promise(n=>{let o=new FileReader;o.onload=i=>n(i?.target?.result),o.readAsDataURL(r)})}if(e instanceof ArrayBuffer){let r=e.slice(0,5);return`data:base64,${Fye(r)}`}return null}function Fye(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function Bye(e){return!jye(e)&&!Uye(e)}function jye(e){return e.startsWith("http:")||e.startsWith("https:")}function Uye(e){return e.startsWith("data:")}async function L5(e,t){if(typeof e=="string"){let r=O5(e);return Bye(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await rM(e)}var F5=new wa({id:"loaders.gl"}),nM=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},iM=class{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}};var B5={fetch:null,mimeType:void 0,nothrow:!1,log:new iM,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:bm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},uV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function j5(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function U5(){let e=j5();return e.globalOptions=e.globalOptions||{...B5},e.globalOptions}function dV(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],Vye(e,r),Zye(t,e,n)}function Vye(e,t){fV(e,null,B5,uV,t);for(let r of t){let n=e&&e[r.id]||{},o=r.options&&r.options[r.id]||{},i=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};fV(n,r.id,o,i,t)}}function fV(e,t,r,n,o){let i=t||"Top level",s=t?`${t}.`:"";for(let a in e){let u=!t&&Sm(e[a]),h=a==="baseUri"&&!t,p=a==="workerUrl"&&t;if(!(a in r)&&!h&&!p){if(a in n)F5.warn(`${i} loader option '${s}${a}' no longer supported, use '${n[a]}'`)();else if(!u){let _=Wye(a,o);F5.warn(`${i} loader option '${s}${a}' not recognized. ${_}`)()}}}}function Wye(e,t){let r=e.toLowerCase(),n="";for(let o of t)for(let i in o.options){if(e===i)return`Did you mean '${o.id}.${i}'?`;let s=i.toLowerCase();(r.startsWith(s)||s.startsWith(r))&&(n=n||`Did you mean '${o.id}.${i}'?`)}return n}function Zye(e,t,r){let o={...e.options||{}};return Yye(o,r),o.log===null&&(o.log=new nM),hV(o,U5()),hV(o,t),o}function hV(e,t){for(let r in t)if(r in t){let n=t[r];N5(n)&&N5(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Yye(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function ob(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function sb(e){nd(e,"null loader"),nd(ob(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var pV=()=>{let e=j5();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function V5(e){let t=pV();e=Array.isArray(e)?e:[e];for(let r of e){let n=sb(r);t.find(o=>n===o)||t.unshift(n)}}function mV(){return pV()}var gV=new wa({id:"loaders.gl"});var qye=/\.([^.]+)$/;async function xV(e,t=[],r,n){if(!bV(e))return null;let o=_V(e,t,{...r,nothrow:!0},n);if(o)return o;if(Ml(e)&&(e=await e.slice(0,10).arrayBuffer(),o=_V(e,t,r,n)),!o&&!r?.nothrow)throw new Error(vV(e));return o}function _V(e,t=[],r,n){if(!bV(e))return null;if(t&&!Array.isArray(t))return sb(t);let o=[];t&&(o=o.concat(t)),r?.ignoreRegisteredLoaders||o.push(...mV()),Hye(o);let i=Gye(e,o,r,n);if(!i&&!r?.nothrow)throw new Error(vV(e));return i}function Gye(e,t,r,n){let o=Tm(e),i=ib(e),s=G_(o)||n?.url,a=null,u="";return r?.mimeType&&(a=W5(t,r?.mimeType),u=`match forced by supplied MIME type ${r?.mimeType}`),a=a||Xye(t,s),u=u||(a?`matched url ${s}`:""),a=a||W5(t,i),u=u||(a?`matched MIME type ${i}`:""),a=a||$ye(t,e),u=u||(a?`matched initial data ${wV(e)}`:""),r?.fallbackMimeType&&(a=a||W5(t,r?.fallbackMimeType),u=u||(a?`matched fallback MIME type ${i}`:"")),u&&gV.log(1,`selectLoader selected ${a?.name}: ${u}.`),a}function bV(e){return!(e instanceof Response&&e.status===204)}function vV(e){let t=Tm(e),r=ib(e),n="No valid loader found (";n+=t?`${Mm.filename(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let o=e?wV(e):"";return n+=o?` first bytes: "${o}"`:"first bytes: not available",n+=")",n}function Hye(e){for(let t of e)sb(t)}function Xye(e,t){let r=t&&qye.exec(t),n=r&&r[1];return n?Kye(e,n):null}function Kye(e,t){t=t.toLowerCase();for(let r of e)for(let n of r.extensions)if(n.toLowerCase()===t)return r;return null}function W5(e,t){for(let r of e)if(r.mimeTypes?.some(n=>z5(t,n))||z5(t,`application/x.${r.id}`))return r;return null}function $ye(e,t){if(!t)return null;for(let r of e)if(typeof t=="string"){if(Qye(t,r))return r}else if(ArrayBuffer.isView(t)){if(yV(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&yV(t,0,r))return r;return null}function Qye(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function yV(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(o=>Jye(e,t,r,o))}function Jye(e,t,r,n){if(n instanceof ArrayBuffer)return C5(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":let o=Z5(e,t,n.length);return n===o;default:return!1}}function wV(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Z5(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Z5(e,0,t):""}function Z5(e,t,r){if(e.byteLength<t+r)return"";let n=new DataView(e),o="";for(let i=0;i<r;i++)o+=String.fromCharCode(n.getUint8(t+i));return o}function*AV(e,t){let r=t?.chunkSize||262144,n=0,o=new TextEncoder;for(;n<e.length;){let i=Math.min(e.length-n,r),s=e.slice(n,n+i);n+=i,yield o.encode(s)}}function*MV(e,t={}){let{chunkSize:r=262144}=t,n=0;for(;n<e.byteLength;){let o=Math.min(e.byteLength-n,r),i=new ArrayBuffer(o),s=new Uint8Array(e,n,o);new Uint8Array(i).set(s),n+=o,yield i}}async function*SV(e,t){let r=t?.chunkSize||1048576,n=0;for(;n<e.size;){let o=n+r,i=await e.slice(n,o).arrayBuffer();n=o,yield i}}function Y5(e,t){return bm?exe(e,t):txe(e,t)}async function*exe(e,t){let r=e.getReader(),n;try{for(;;){let o=n||r.read();t?._streamReadAhead&&(n=r.read());let{done:i,value:s}=await o;if(i)return;yield JA(s)}}catch{r.releaseLock()}}async function*txe(e,t){for await(let r of e)yield JA(r)}function TV(e,t){if(typeof e=="string")return AV(e,t);if(e instanceof ArrayBuffer)return MV(e,t);if(Ml(e))return SV(e,t);if(eM(e))return Y5(e,t);if(Al(e))return Y5(e.body,t);throw new Error("makeIterator")}var EV="Cannot convert supplied data type";function rxe(e,t,r){if(t.text&&typeof e=="string")return e;if(nV(e)&&(e=e.buffer),e instanceof ArrayBuffer){let n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer,o=e.byteLength||e.length;return(e.byteOffset!==0||o!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+o)),n}throw new Error(EV)}async function IV(e,t,r){let n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return rxe(e,t,r);if(Ml(e)&&(e=await rM(e)),Al(e)){let o=e;return await cV(o),t.binary?await o.arrayBuffer():await o.text()}if(eM(e)&&(e=TV(e,r)),tV(e)||rV(e))return P5(e);throw new Error(EV)}function oM(e,t){let r=U5(),n=e||r;return typeof n.fetch=="function"?n.fetch:Sm(n.fetch)?o=>L5(o,n.fetch):t?.fetch?t?.fetch:L5}function CV(e,t,r){if(r)return r;let n={fetch:oM(t,e),...e};if(n.url){let o=G_(n.url);n.baseUrl=o,n.queryString=sV(n.url),n.filename=Mm.filename(o),n.baseUrl=Mm.dirname(o)}return Array.isArray(n.loaders)||(n.loaders=null),n}function kV(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function ab(e,t,r,n){t&&!Array.isArray(t)&&!ob(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};let o=Tm(e),s=kV(t,n),a=await xV(e,s,r);return a?(r=dV(r,a,s,o),n=CV({url:o,_parse:ab,loaders:s},r,n||null),await nxe(a,e,r,n)):null}async function nxe(e,t,r,n){if(T5(e),r=b5(e.options,r),Al(t)){let i=t,{ok:s,redirected:a,status:u,statusText:h,type:p,url:_}=i,y=Object.fromEntries(i.headers.entries());n.response={headers:y,ok:s,redirected:a,status:u,statusText:h,type:p,url:_}}t=await IV(t,e,r);let o=e;if(o.parseTextSync&&typeof t=="string")return o.parseTextSync(t,r,n);if(E5(e,r))return await I5(e,t,r,n,ab);if(o.parseText&&typeof t=="string")return await o.parseText(t,r,n);if(o.parse)return await o.parse(t,r,n);throw ta(!o.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}var sM=class{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(t,r){if(this.options=r,this.schema=t,!Array.isArray(t)){this._headers=[];for(let n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,r){Number.isFinite(r)&&(this.cursor=r),this.shape="array-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}addObjectRow(t,r){Number.isFinite(r)&&(this.cursor=r),this.shape="object-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}};function lb(e,t){if(!e)throw new Error("null row");let r={};if(t)for(let n=0;n<t.length;n++)r[t[n]]=e[n];else for(let n=0;n<e.length;n++){let o=`column-${n}`;r[o]=e[n]}return r}function cb(e,t){if(!e)throw new Error("null row");if(t){let r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=e[t[n]];return r}return Object.values(e)}function PV(e){let t=[];for(let r=0;r<e.length;r++){let n=`column-${r}`;t.push(n)}return t}function OV(e){return Object.keys(e)}var RV=100,aM=class{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(t,r){if(this.options=r,this.schema=t,t){this._headers=[];for(let n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=PV(t),this.options.shape){case"object-row-table":let n=lb(t,this._headers);this.addObjectRow(n,r);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(RV),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,r){switch(Number.isFinite(r)&&(this.cursor=r),this._headers||=OV(t),this.options.shape){case"array-row-table":let n=cb(t,this._headers);this.addArrayRow(n,r);break;case"object-row-table":this.objectRows=this.objectRows||new Array(RV),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}};var lM=class{schema;length=0;allocated=0;columns={};constructor(t,r){this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let r=0;for(let n in this.columns)this.columns[n][this.length]=t[r++];this.length++}addObjectRow(t){this._reallocateColumns();for(let r in t)this.columns[r][this.length]=t[r];this.length++}getBatch(){this._pruneColumns();let t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(let n in this.schema){let o=this.schema[n];t[o.name]=this.columns[o.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={};for(let t in this.schema){let r=this.schema[t],n=r.type||Float32Array,o=this.columns[r.index];if(o&&ArrayBuffer.isView(o)){let i=new n(this.allocated);i.set(o),this.columns[r.index]=i}else o?(o.length=this.allocated,this.columns[r.index]=o):this.columns[r.index]=new n(this.allocated)}}}_pruneColumns(){for(let[t,r]of Object.entries(this.columns))this.columns[t]=r.slice(0,this.length)}};var ixe={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},oxe="TableBatchBuilder",ub=class e{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(t,r){this.schema=t,this.options={...ixe,...r}}limitReached(){return!!(this.options?.limit&&this.totalLength>=this.options.limit||this.options?._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){let r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){let r=this._getTableBatchType();this.aggregator=new r(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t?.bytesUsed&&(this.bytesUsed=t.bytesUsed);let r=this.aggregator.getBatch();return r.count=this.batchCount,r.bytesUsed=this.bytesUsed,Object.assign(r,t),this.batchCount++,this.aggregator=null,r}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return aM;case"columnar-table":return lM;case"arrow-table":if(!e.ArrowBatch)throw new Error(oxe);return e.ArrowBatch;default:return sM}}};var cM=class extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}},H_=class{_values;_settlers;_closed;constructor(){this._values=new cM,this._settlers=new cM,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");let r=this._settlers.dequeue();t instanceof Error?r.reject(t):r.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){let t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,r)=>{this._settlers.enqueue({resolve:t,reject:r})})}};async function su(e,t,r,n){let o,i;!Array.isArray(t)&&!ob(t)?(o=[],i=t,n=void 0):(o=t,i=r);let s=oM(i),a=e;return typeof e=="string"&&(a=await s(e)),Ml(e)&&(a=await s(e)),Array.isArray(o)?await ab(a,o,i):await ab(a,o,i)}var NV="4.2.0";var sxe=globalThis.loaders?.parseImageNode,q5=typeof Image<"u",G5=typeof ImageBitmap<"u",axe=!!sxe,H5=bm?!0:axe;function zV(e){switch(e){case"auto":return G5||q5||H5;case"imagebitmap":return G5;case"image":return q5;case"data":return H5;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function DV(){if(G5)return"imagebitmap";if(q5)return"image";if(H5)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function lxe(e){let t=cxe(e);if(!t)throw new Error("Not an image");return t}function LV(e){switch(lxe(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function cxe(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}var uxe=/^data:image\/svg\+xml/,fxe=/\.svg((\?|#).*)?$/;function uM(e){return e&&(uxe.test(e)||fxe.test(e))}function FV(e,t){if(uM(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return X5(e,t)}function X5(e,t){if(uM(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function fM(e,t,r){let n=FV(e,r),o=self.URL||self.webkitURL,i=typeof n!="string"&&o.createObjectURL(n);try{return await hxe(i||n,t)}finally{i&&o.revokeObjectURL(i)}}async function hxe(e,t){let r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,o)=>{try{r.onload=()=>n(r),r.onerror=i=>{let s=i instanceof Error?i.message:"error";o(new Error(s))}}catch(i){o(i)}})}var dxe={},BV=!0;async function jV(e,t,r){let n;uM(r)?n=await fM(e,t,r):n=X5(e,r);let o=t&&t.imagebitmap;return await pxe(n,o)}async function pxe(e,t=null){if((mxe(t)||!BV)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),BV=!1}return await createImageBitmap(e)}function mxe(e){for(let t in e||dxe)return!1;return!0}function UV(e){return!xxe(e,"ftyp",4)||!(e[8]&96)?null:gxe(e)}function gxe(e){switch(_xe(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function _xe(e,t,r){return String.fromCharCode(...e.slice(t,r))}function yxe(e){return[...e].map(t=>t.charCodeAt(0))}function xxe(e,t,r=0){let n=yxe(t);for(let o=0;o<n.length;++o)if(n[o]!==e[o+r])return!1;return!0}var au=!1,fb=!0;function hM(e){let t=hb(e);return vxe(t)||Mxe(t)||wxe(t)||Axe(t)||bxe(t)}function bxe(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),r=UV(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function vxe(e){let t=hb(e);return t.byteLength>=24&&t.getUint32(0,au)===2303741511?{mimeType:"image/png",width:t.getUint32(16,au),height:t.getUint32(20,au)}:null}function wxe(e){let t=hb(e);return t.byteLength>=10&&t.getUint32(0,au)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,fb),height:t.getUint16(8,fb)}:null}function Axe(e){let t=hb(e);return t.byteLength>=14&&t.getUint16(0,au)===16973&&t.getUint32(2,fb)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,fb),height:t.getUint32(22,fb)}:null}function Mxe(e){let t=hb(e);if(!(t.byteLength>=3&&t.getUint16(0,au)===65496&&t.getUint8(2)===255))return null;let{tableMarkers:n,sofMarkers:o}=Sxe(),i=2;for(;i+9<t.byteLength;){let s=t.getUint16(i,au);if(o.has(s))return{mimeType:"image/jpeg",height:t.getUint16(i+5,au),width:t.getUint16(i+7,au)};if(!n.has(s))return null;i+=2,i+=t.getUint16(i,au)}return null}function Sxe(){let e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function hb(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function VV(e,t){let{mimeType:r}=hM(e)||{},n=globalThis.loaders?.parseImageNode;return nd(n),await n(e,r)}async function WV(e,t,r){t=t||{};let o=(t.image||{}).type||"auto",{url:i}=r||{},s=Txe(o),a;switch(s){case"imagebitmap":a=await jV(e,t,i);break;case"image":a=await fM(e,t,i);break;case"data":a=await VV(e,t);break;default:nd(!1)}return o==="data"&&(a=LV(a)),a}function Txe(e){switch(e){case"auto":case"data":return DV();default:return zV(e),e}}var Exe=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Ixe=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Cxe={image:{type:"auto",decode:!0}},K5={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:NV,mimeTypes:Ixe,extensions:Exe,parse:WV,tests:[e=>!!hM(new DataView(e))],options:Cxe};var kxe=new wa({id:"deck"}),Vr=kxe;var $5={};function ZV(e){$5=e}function oo(e,t,r,n){Vr.level>0&&$5[e]&&$5[e].call(null,t,r,n)}function Pxe(e){let t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}var YV={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Pxe,parseTextSync:JSON.parse};function Oxe(){let e="9.0.14",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Vr.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Vr,_registerLoggers:ZV},V5([YV,[K5,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var qV=Oxe();function lu(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var Q5={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function HV(e){let t={};for(let[r,n]of Object.entries(e))t[r]=Rxe(n);return t}function XV(e,t,r){let n={};for(let[o,i]of Object.entries(t))e&&o in e&&!i.private?(i.validate&&lu(i.validate(e[o],i),`${r}: invalid ${o}`),n[o]=e[o]):n[o]=i.value;return n}function Rxe(e){let t=GV(e);if(t!=="object")return{value:e,...Q5[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...Q5[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=GV(e.value),{...e,...Q5[t],type:t}):{type:"object",value:null};throw new Error("props")}function GV(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var KV=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,$V=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`;var Nxe={vertex:KV,fragment:$V},QV=/void\s+main\s*\([^)]*\)\s*\{\n?/,JV=/}\n?[^{}]*$/,J5=[],db="__LUMA_INJECT_DECLARATIONS__";function eW(e){let t={vertex:{},fragment:{}};for(let r in e){let n=e[r],o=zxe(r);typeof n=="string"&&(n={order:0,injection:n}),t[o][r]=n}return t}function zxe(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function pb(e,t,r,n=!1){let o=t==="vertex";for(let i in r){let s=r[i];s.sort((u,h)=>u.order-h.order),J5.length=s.length;for(let u=0,h=s.length;u<h;++u)J5[u]=s[u].injection;let a=`${J5.join(`
`)}
`;switch(i){case"vs:#decl":o&&(e=e.replace(db,a));break;case"vs:#main-start":o&&(e=e.replace(QV,u=>u+a));break;case"vs:#main-end":o&&(e=e.replace(JV,u=>a+u));break;case"fs:#decl":o||(e=e.replace(db,a));break;case"fs:#main-start":o||(e=e.replace(QV,u=>u+a));break;case"fs:#main-end":o||(e=e.replace(JV,u=>a+u));break;default:e=e.replace(i,u=>u+a)}}return e=e.replace(db,""),n&&(e=e.replace(/\}\s*$/,i=>i+Nxe[t])),e}var Dxe=1,X_=class e{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(t){return t.map(r=>{if(r instanceof e)return r;lu(typeof r!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(r)}' and use it directly.`),r.name||(console.warn("shader module has no name"),r.name=`shader-module-${Dxe++}`);let n=new e(r);return n.dependencies=e.instantiateModules(r.dependencies||[]),n})}constructor(t){let{name:r,vs:n,fs:o,dependencies:i=[],uniformTypes:s={},uniformPropTypes:a={},getUniforms:u,deprecations:h=[],defines:p={},inject:_={}}=t;lu(typeof r=="string"),this.name=r,this.vs=n,this.fs=o,this.getModuleUniforms=u,this.dependencies=e.instantiateModules(i),this.deprecations=this._parseDeprecationDefinitions(h),this.defines=p,this.injections=eW(_),this.uniformTypes=s,a&&(this.uniforms=HV(a))}getModuleSource(t){let r;switch(t){case"vertex":r=this.vs||"";break;case"fragment":r=this.fs||"";break;default:lu(!1)}let n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${r}

`}getUniforms(t,r){return this.getModuleUniforms?this.getModuleUniforms(t,r):XV(t,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(t,r){this.deprecations.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}_parseDeprecationDefinitions(t){return t.forEach(r=>{switch(r.type){case"function":r.regex=new RegExp(`\\b${r.old}\\(`);break;default:r.regex=new RegExp(`${r.type} ${r.old};`)}}),t}_defaultGetUniforms(t={}){let r={},n=this.uniforms;for(let o in n){let i=n[o];o in t&&!i.private?(i.validate&&lu(i.validate(t[o],i),`${this.name}: invalid ${o}`),r[o]=t[o]):r[o]=i.value}return r}};function eP(e){if(e.source&&e.platformInfo.type==="webgpu")return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");let t=tW(e.platformInfo,e.vs),r;return e.fs&&(r=tW(e.platformInfo,e.fs)),{...e,vs:t,fs:r}}function tW(e,t){if(typeof t=="string")return t;switch(e.type){case"webgpu":if(t?.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(t?.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Em(e){let t=X_.instantiateModules(e);return Lxe(t)}function Lxe(e){let t={},r={};return rW({modules:e,level:0,moduleMap:t,moduleDepth:r}),Object.keys(r).sort((n,o)=>r[o]-r[n]).map(n=>t[n])}function rW(e){let{modules:t,level:r,moduleMap:n,moduleDepth:o}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let i of t)n[i.name]=i,(o[i.name]===void 0||o[i.name]<r)&&(o[i.name]=r);for(let i of t)i.dependencies&&rW({modules:i.dependencies,level:r+1,moduleMap:n,moduleDepth:o})}function nW(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function oW(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=iW(e,Fxe),e;case"fragment":return e=iW(e,Bxe),e;default:throw new Error(t)}}var sW=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Fxe=[...sW,[tP("attribute"),"in $1"],[tP("varying"),"out $1"]],Bxe=[...sW,[tP("varying"),"in $1"]];function iW(e,t){for(let[r,n]of t)e=e.replace(r,n);return e}function tP(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function rP(e,t){let r="";for(let n in e){let o=e[n];if(r+=`void ${o.signature} {
`,o.header&&(r+=`  ${o.header}`),t[n]){let i=t[n];i.sort((s,a)=>s.order-a.order);for(let s of i)r+=`  ${s.injection}
`}o.footer&&(r+=`  ${o.footer}`),r+=`}
`}return r}function nP(e){let t={vertex:{},fragment:{}};for(let r of e){let n,o;typeof r!="string"?(n=r,o=n.hook):(n={},o=r),o=o.trim();let[i,s]=o.split(":"),a=o.replace(/\(.+/,""),u=Object.assign(n,{signature:s});switch(i){case"vs":t.vertex[a]=u;break;case"fs":t.fragment[a]=u;break;default:throw new Error(i)}}return t}function aW(e,t){return{name:jxe(e,t),language:"glsl",version:Uxe(e)}}function jxe(e,t="unnamed"){let n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function Uxe(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}var cW=`

${db}
`,Vxe=`precision highp float;
`;function uW(e){let t=Em(e.modules||[]);return{source:iP(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:oP(t)}}function fW(e){let t=Em(e.modules||[]);return{vs:iP(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:iP(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:oP(t)}}function hW(e){let{vs:t,fs:r}=e,n=Em(e.modules||[]);return{vs:lW(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:lW(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:oP(n)}}function iP(e,t){let{source:r,stage:n,modules:o,hookFunctions:i=[],inject:s={},log:a}=t;lu(typeof r=="string","shader source must be a string");let u=r,h="",p=nP(i),_={},y={},A={};for(let k in s){let P=typeof s[k]=="string"?{injection:s[k],order:0}:s[k],R=/^(v|f)s:(#)?([\w-]+)$/.exec(k);if(R){let V=R[2],N=R[3];V?N==="decl"?y[k]=[P]:A[k]=[P]:_[k]=[P]}else A[k]=[P]}let E=e.type!=="webgpu"?o:[];for(let k of E){a&&k.checkDeprecations(u,a);let P=k.getModuleSource(n,"wgsl");h+=P;let R=k.injections[n];for(let V in R){let N=/^(v|f)s:#([\w-]+)$/.exec(V);if(N){let J=N[2]==="decl"?y:A;J[V]=J[V]||[],J[V].push(R[V])}else _[V]=_[V]||[],_[V].push(R[V])}}return h+=cW,h=pb(h,n,y),h+=rP(p[n],_),h+=u,h=pb(h,n,A),h}function lW(e,t){let{id:r,source:n,stage:o,language:i="glsl",modules:s,defines:a={},hookFunctions:u=[],inject:h={},prologue:p=!0,log:_}=t;lu(typeof n=="string","shader source must be a string");let y=i==="glsl"?aW(n).version:-1,A=e.shaderLanguageVersion,E=y===100?"#version 100":"#version 300 es",P=n.split(`
`).slice(1).join(`
`),R={};s.forEach(de=>{Object.assign(R,de.getDefines())}),Object.assign(R,a);let V="";switch(i){case"wgsl":break;case"glsl":V=p?`${E}

// ----- PROLOGUE -------------------------
${Wxe({id:r,source:n,stage:o})}
${`#define SHADER_TYPE_${o.toUpperCase()}`}
${nW(e)}
${o==="fragment"?Vxe:""}

// ----- APPLICATION DEFINES -------------------------

${Zxe(R)}

`:`${E}
`;break}let N=nP(u),j={},J={},ne={};for(let de in h){let fe=typeof h[de]=="string"?{injection:h[de],order:0}:h[de],ye=/^(v|f)s:(#)?([\w-]+)$/.exec(de);if(ye){let ve=ye[2],be=ye[3];ve?be==="decl"?J[de]=[fe]:ne[de]=[fe]:j[de]=[fe]}else ne[de]=[fe]}for(let de of s){_&&de.checkDeprecations(P,_);let fe=de.getModuleSource(o);V+=fe;let ye=de.injections[o];for(let ve in ye){let be=/^(v|f)s:#([\w-]+)$/.exec(ve);if(be){let Re=be[2]==="decl"?J:ne;Re[ve]=Re[ve]||[],Re[ve].push(ye[ve])}else j[ve]=j[ve]||[],j[ve].push(ye[ve])}}return V+="// ----- MAIN SHADER SOURCE -------------------------",V+=cW,V=pb(V,o,J),V+=rP(N[o],j),V+=P,V=pb(V,o,ne),i==="glsl"&&y!==A&&(V=oW(V,o)),V.trim()}function oP(e){return function(r){let n={};for(let o of e){let i=o.getUniforms(r,n);Object.assign(n,i)}return n}}function Wxe(e){let{id:t,source:r,stage:n}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}

`:""}function Zxe(e={}){let t="";for(let r in e){let n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}var Im=class e{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return e.defaultShaderAssembler=e.defaultShaderAssembler||new e,e.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){let r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleShader(t){let r=this._getModuleList(t.modules),n=this._hookFunctions,o=eP(t);return{...uW({platformInfo:t.platformInfo,...o,modules:r,hookFunctions:n}),modules:r}}assembleShaderPair(t){let r=eP(t),n=this._getModuleList(t.modules),o=this._hookFunctions,{platformInfo:i}=t;return{...t.platformInfo.shaderLanguage==="wgsl"?fW({platformInfo:i,...r,modules:n,hookFunctions:o}):hW({platformInfo:i,...r,modules:n,hookFunctions:o}),modules:n}}_getModuleList(t=[]){let r=new Array(this._defaultModules.length+t.length),n={},o=0;for(let i=0,s=this._defaultModules.length;i<s;++i){let a=this._defaultModules[i],u=a.name;r[o++]=a,n[u]=!0}for(let i=0,s=t.length;i<s;++i){let a=t[i],u=a.name;n[u]||(r[o++]=a,n[u]=!0)}return r.length=o,X_.instantiateModules(r)}};var Yxe=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,qxe=`#version 300 es
${Yxe}`;function sP(e){let{input:t,inputChannels:r,output:n}=e||{};if(!t)return qxe;if(!r)throw new Error("inputChannels");let o=Gxe(r),i=dW(t,r);return`#version 300 es
in ${o} ${t};
out vec4 ${n};
void main() {
  ${n} = ${i};
}`}function Gxe(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function dW(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}var Ut=new wa({id:"luma.gl"});var aP=class{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new Aa({id:t})),this.stats.get(t)}},K_=new aP;function Hxe(){let e="9.0.14",t="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(zs()&&Ut.log(1,`${e} - ${t}`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:Ut,stats:K_}),e}var pW=Hxe();function Xxe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)?e:null}function od(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number"?e:null:Xxe(e)}var lP={};function ra(e="id"){lP[e]=lP[e]||1;let t=lP[e]++;return`${e}-${t}`}function sd(e){let t=!0;for(let r in e){t=!1;break}return t}var An=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=Kxe(r,n);let o=this.props.id!=="undefined"?this.props.id:ra(this[Symbol.toStringTag]);this.props.id=o,this.id=o,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(let t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){let n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}};function Kxe(e,t){let r={...t};for(let n in e)e[n]!==void 0&&(r[n]=e[n]);return r}var qn=class e extends An{static defaultProps={...An.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){let n={...r};(r.usage||0)&e.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),super(t,n,e.defaultProps),this.usage=r.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}readSyncWebGL(t,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,r,n){let o=ArrayBuffer.isView(t)?t.buffer:t,i=Math.min(t?t.byteLength:n,e.DEBUG_DATA_MAX_LENGTH);t===null?this.debugData=new ArrayBuffer(i):r===0&&n===t.byteLength?this.debugData=o.slice(0,i):this.debugData=o.slice(r,r+i)}};function dM(e){let t=mW[e],r=$xe(t),n=e.includes("norm"),o=!n&&!e.startsWith("float"),i=e.startsWith("s");return{dataType:mW[e],byteLength:r,integer:o,signed:i,normalized:n}}function $xe(e){return Qxe[e]}var mW={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},Qxe={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Jxe=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],ebe=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function gW(e){return Jxe.some(t=>e.startsWith(t))}function pM(e){let t=ebe.exec(e);if(t){let[,r,n,o,i,s]=t;if(r){let a=`${o}${n}`,u=dM(a);return{format:r,components:r.length,srgb:i==="-srgb",unsized:s==="-unsized",webgl:s==="-webgl",...u}}}return rbe(e)}var tbe={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function rbe(e){let t=tbe[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||t.format?.length||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}var mb=class{},gb=class{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}},Ef=class e{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Ut.get("debug"),spector:!!(Ut.get("spector")||Ut.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>Ut.error(t.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=pW;constructor(t){this.props={...e.defaultProps,...t},this.id=this.props.id||ra(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=K_;_lumaData={};isTextureFormatCompressed(t){return gW(t)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||typeof t=="string")&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});let r={...t};return(t.usage||0)&qn.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":Ut.warn("indices buffer content must be of integer type")()),r}};function Cn(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}var _b=new Map,If=class e{static defaultProps={...Ef.defaultProps,type:"best-available",devices:void 0};static stats=K_;static log=Ut;static registerDevices(t){for(let r of t)Cn(r.type&&r.isSupported&&r.create),_b.set(r.type,r)}static getAvailableDevices(){return Array.from(_b).map(t=>t.type)}static getSupportedDevices(){return Array.from(_b).filter(t=>t.isSupported()).map(t=>t.type)}static setDefaultDeviceProps(t){Object.assign(Ef.defaultProps,t)}static async attachDevice(t){let r=_W(t.devices)||_b;if(t.handle instanceof WebGL2RenderingContext){let n=r.get("webgl");if(n)return await n.attach(t.handle)}if(t.handle===null){let n=r.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){t={...e.defaultProps,...t},t.gl&&(t.type="webgl");let r=_W(t.devices)||_b;switch(t.type){case"webgpu":let n=r.get("webgpu");if(n)return await n.create(t);break;case"webgl":let o=r.get("webgl");if(o)return await o.create(t);break;case"unknown":let i=r.get("unknown");if(i)return await i.create(t);break;case"best-available":if(n=r.get("webgpu"),n?.isSupported?.())return await n.create(t);if(o=r.get("webgl"),o?.isSupported?.())return await o.create(t);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(t=!0){let r=HTMLCanvasElement.prototype;if(!t&&r.originalGetContext){r.getContext=r.originalGetContext,r.originalGetContext=void 0;return}r.originalGetContext=r.getContext,r.getContext=function(n,o){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",o):this.originalGetContext(n,o)}}};function _W(e){if(!e||e?.length===0)return null;let t=new Map;for(let r of e)t.set(r.type,r);return t}var nbe=zs()&&typeof document<"u",mM=()=>nbe&&document.readyState==="complete",ibe={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"},Cm=class{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return mM()}static pageLoaded=obe();constructor(t){if(this.props={...ibe,...t},t=this.props,!zs()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=abe(t.canvas):this.canvas=t.canvas;else{let r=lbe(t),n=sbe(t?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{let[t]=this.getDrawingBufferSize(),{clientWidth:r}=this._canvasSizeInfo;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){let n=this.cssToDeviceRatio(),[o,i]=this.getDrawingBufferSize();return cbe(t,n,o,i,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,o="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!o)&&(Ut.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,o=this.htmlCanvas.height||1);let i=this._canvasSizeInfo;if(i.clientWidth!==n||i.clientHeight!==o||i.devicePixelRatio!==t){let s=t,a=Math.floor(n*s),u=Math.floor(o*s);this.htmlCanvas.width=a,this.htmlCanvas.height=u;let[h,p]=this.getDrawingBufferSize();(h!==a||p!==u)&&(s=Math.min(h/n,p/o),this.htmlCanvas.width=Math.floor(n*s),this.htmlCanvas.height=Math.floor(o*s),Ut.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=o,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){let t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}};function obe(){return mM()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}function sbe(e){if(typeof e=="string"){let t=document.getElementById(e);if(!t&&!mM())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function abe(e){let t=document.getElementById(e);if(!t&&!mM())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function lbe(e){let{width:t,height:r}=e,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function cbe(e,t,r,n,o){let i=e,s=yW(i[0],t,r),a=xW(i[1],t,n,o),u=yW(i[0]+1,t,r),h=u===r-1?u:u-1;u=xW(i[1]+1,t,n,o);let p;return o?(u=u===0?u:u+1,p=a,a=u):p=u===n-1?u:u-1,{x:s,y:a,width:Math.max(h-s+1,1),height:Math.max(p-a+1,1)}}function yW(e,t,r){return Math.min(Math.round(e*t),r-1)}function xW(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var Io=class e extends An{static defaultProps={...An.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(t,r,n=e.defaultProps){super(t,r,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}};var km=class e extends An{static defaultProps={...An.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,e.defaultProps)}};function vW(e,t,r){let n="",o=t.split(/\r?\n/),i=e.slice().sort((s,a)=>s.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let s=0;for(let a=1;a<=o.length;a++)for(n+=wW(o[a-1],a,r);i.length>s&&i[s].lineNum===a;){let u=i[s++];n+=bW(u,o,u.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(let a of e)n+=bW(a,o,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function bW(e,t,r,n){if(n?.inlineSource){let o=ube(t,r),i=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${o}${i}${e.type.toUpperCase()}: ${e.message}

`}return n?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function ube(e,t,r){let n="";for(let o=t-2;o<=t;o++){let i=e[o-1];i!==void 0&&(n+=wW(i,t,r))}return n}function wW(e,t,r){let n=r?.html?hbe(e):e;return`${fbe(String(t),4)}: ${n}${r?.html?"<br/>":`
`}`}function fbe(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function hbe(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function cP(e,t){return{name:dbe(e,t),language:"glsl",version:pbe(e)}}function dbe(e,t="unnamed"){let n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function pbe(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}return t}var Pm=class e extends An{static defaultProps={...An.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){super(t,{id:mbe(r),...r},e.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();this.props.debug==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;let r=cP(this.source).name,n=`${this.stage} ${r}`,o=vW(t,this.source,{showSourceCode:"all",html:!0}),i=this.getTranslatedSource();i&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${i}</pre></code>`);let s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s);let a=document.getElementsByClassName("luma-compiler-log-error");a[0]?.scrollIntoView&&a[0].scrollIntoView(),s.onclick=()=>{let u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};function mbe(e){return cP(e.source).name||e.id||ra(`unnamed ${e.stage}-shader`)}var Om=class e extends An{static defaultProps={...An.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){super(t,r,e.defaultProps)}};var Rm=class e extends An{static defaultProps={...An.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(t,r={}){super(t,r,e.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(t){let r=!t;if(t){let[n,o]=Array.isArray(t)?t:[t.width,t.height];r=r||o!==this.height||n!==this.width,this.width=n,this.height=o}r&&(Ut.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){let n=this.createColorTexture(r);return this.attachResource(n),n.view}return r instanceof Io?r.view:r});let t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){let r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Io?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:Io.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:Io.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){let o=this.device._createTexture({...this.colorAttachments[n].props,width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){let n=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}};var cu=class e extends An{static defaultProps={...An.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,e.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};var yb=class e extends An{static defaultProps={...An.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){super(t,r,e.defaultProps)}};var $_=class e extends An{static defaultProps={...An.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(t,r){super(t,r,e.defaultProps)}};var xb=class e extends An{static defaultProps={...An.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,e.defaultProps)}};var bb=class e extends An{static defaultProps={...An.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,e.defaultProps)}};function AW(e){let[t,r]=_be[e],n=t==="i32"||t==="u32",o=t!=="u32",i=ybe[t]*r,s=gbe(t,r);return{dataType:t,components:r,defaultVertexFormat:s,byteLength:i,integer:n,signed:o}}function gbe(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}var _be={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},ybe={f32:4,f16:2,i32:4,u32:4};function uP(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,n]=e.split("x"),o=r,i=n?parseInt(n):1,s=dM(o),a={type:o,components:i,byteLength:s.byteLength*i,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function gM(e,t){let r={};for(let n of e.attributes)r[n.name]=xbe(e,t,n.name);return r}function MW(e,t,r=16){let n=gM(e,t),o=new Array(r).fill(null);for(let i of Object.values(n))o[i.location]=i;return o}function xbe(e,t,r){let n=bbe(e,r),o=vbe(t,r);if(!n)return null;let i=AW(n.type),s=o?.vertexFormat||i.defaultVertexFormat,a=uP(s);return{attributeName:o?.attributeName||n.name,bufferName:o?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:o?.stepMode||n.stepMode,byteOffset:o?.byteOffset||0,byteStride:o?.byteStride||0}}function bbe(e,t){let r=e.attributes.find(n=>n.name===t);return r||Ut.warn(`shader layout attribute "${t}" not present in shader`),r||null}function vbe(e,t){wbe(e);let r=Abe(e,t);return r||(r=Mbe(e,t),r)?r:(Ut.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function wbe(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&Ut.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Abe(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function Mbe(e,t){for(let r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(let i of r.attributes||[]){let s=uP(i.format);n+=s.byteLength}let o=r.attributes?.find(i=>i.attribute===t);if(o)return{attributeName:o.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:n}}return null}function fP(e,t){let r={...e,attributes:e.attributes.map(n=>({...n}))};for(let n of t?.attributes||[]){let o=r.attributes.find(i=>i.name===n.name);o?(o.type=n.type||o.type,o.stepMode=n.stepMode||o.stepMode):Ut.warn(`shader layout attribute ${n.name} not present in shader`)}return r}var vb=class e extends An{static defaultProps={...An.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,e.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=MW(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,r){throw new Error("constant attributes not supported")}};var wb=class e extends An{static defaultProps={...An.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,e.defaultProps)}};var Ab=class e extends An{static defaultProps={...An.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,e.defaultProps)}};var Sbe={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function SW(e){let t=Sbe[e];return Cn(e),t}function TW(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var _M;function yM(e){return(!_M||_M.byteLength<e)&&(_M=new ArrayBuffer(e)),_M}function hP(e,t){let r=yM(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function dP(e){let{target:t,source:r,start:n=0,count:o=1}=e,i=r.length,s=o*i,a=0;for(let u=n;a<i;a++)t[u++]=r[a];for(;a<s;)a<s-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+s-a),a=s);return e.target}var EW=1024,xM=class{layout={};byteLength;constructor(t){let r=0;for(let[o,i]of Object.entries(t)){let s=SW(i),{type:a,components:u}=s;r=TW(r,u);let h=r;r+=u,this.layout[o]={type:a,size:u,offset:h}}r+=(4-r%4)%4;let n=r*4;this.byteLength=Math.max(n,EW)}getData(t){let r=Math.max(this.byteLength,EW),n=yM(r),o={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(let[i,s]of Object.entries(t)){let a=this.layout[i];if(!a){Ut.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}let{type:u,size:h,offset:p}=a,_=o[u];if(h===1){if(typeof s!="number"&&typeof s!="boolean"){Ut.warn(`Supplied value for single component uniform ${i} is not a number: ${s}`)();continue}_[p]=Number(s)}else{let y=od(s);if(!y){Ut.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${s}`)();continue}_.set(y,p)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}};function IW(e,t,r=16){if(e!==t)return!1;let n=od(e);if(!n)return!1;let o=od(t);if(o&&n.length===o.length){for(let i=0;i<n.length;++i)if(o[i]!==n[i])return!1}return!0}function CW(e){let t=od(e);return t?t.slice():e}var bM=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name,t?.name&&t?.shaderLayout){let r=t?.shaderLayout.bindings?.find(o=>o.type==="uniform"&&o.name===t?.name);if(!r)throw new Error(t?.name);let n=r;for(let o of n.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(t){for(let[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){IW(this.uniforms[t],r)||(this.uniforms[t]=CW(r),this.modifiedUniforms[t]=!0,this.modified=!0)}};var Mb=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(let[r,n]of Object.entries(t)){let o=r,i=new xM(n.uniformTypes||{});this.uniformBufferLayouts.set(o,i);let s=new bM({name:r});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(o,s)}}destroy(){for(let t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(let[r,n]of Object.entries(t))this.uniformBlocks.get(r).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){let r=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);let o=this.getUniformBufferByteLength(r),i=t.createBuffer({usage:qn.UNIFORM|qn.COPY_DST,byteLength:o}),s=this.getUniformBufferData(r);return i.write(s),i}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){let n=this.getUniformBufferByteLength(r),o=t.createBuffer({usage:qn.UNIFORM|qn.COPY_DST,byteLength:n});this.uniformBuffers.set(r,o)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(let r of this.uniformBlocks.keys()){let n=this.updateUniformBuffer(r);t||=n}return t&&Ut.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){let r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t),o=!1;if(n&&r.needsRedraw){o||=r.needsRedraw;let i=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(i);let a=this.uniformBlocks.get(t).getAllUniforms();Ut.log(4,`Writing to uniform buffer ${String(t)}`,i,a)()}return o}};function vM(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function Sb(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function pP(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);let n=t,o=vM(e);if(o==="uint8"||o==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(o=o.replace("int","norm")),`${o}x${n}`}if(o==="uint16"||o==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(o=o.replace("int","norm")),`${o}x${n}`}return n===1?o:`${o}x${n}`}function kW(e){return od(e)!==null||typeof e=="number"||typeof e=="boolean"}function Tb(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];kW(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}function mP(e,t,r){let{removedProps:n={},deprecatedProps:o={},replacedProps:i={}}=r;for(let a in n)if(a in t){let h=n[a]?`${e}.${n[a]}`:"N/A";Ut.removed(`${e}.${a}`,h)()}for(let a in o)if(a in t){let u=o[a];Ut.deprecated(`${e}.${a}`,`${e}.${u}`)()}let s=null;for(let[a,u]of Object.entries(i))a in t&&(Ut.deprecated(`${e}.${a}`,`${e}.${u}`)(),s=s||Object.assign({},t),s[u]=t[a],delete s[a]);return s||t}var Tbe="";async function gP(e,t){return await new Promise((r,n)=>{try{let o=new Image;o.onload=()=>r(o),o.onerror=()=>n(new Error(`Could not load image ${e}.`)),o.crossOrigin=t?.crossOrigin||"anonymous",o.src=e.startsWith("http")?e:Tbe+e}catch(o){n(o)}})}async function Eb(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),t&&(n.id=t),new Promise((o,i)=>{n.onload=o,n.onerror=s=>i(new Error(`Unable to load script '${e}': ${s}`)),r.appendChild(n)})}function Ib(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Ib(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(let i of n)if(!t.hasOwnProperty(i)||!Ib(e[i],t[i],r-1))return!1;return!0}return!1}function _P(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function yP(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}var xP=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},kf=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}},Wi=class extends kf{constructor(){super()}},wM=class extends Wi{constructor(t,r,n,o){super(),this.name=t,this.args=r,this.returnType=n,this.body=o}get astNodeType(){return"function"}},bP=class extends Wi{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}},vP=class extends Wi{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}},wP=class extends Wi{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}},AP=class extends Wi{constructor(t,r,n,o){super(),this.init=t,this.condition=r,this.increment=n,this.body=o}get astNodeType(){return"for"}},ld=class extends Wi{constructor(t,r,n,o,i){super(),this.name=t,this.type=r,this.storage=n,this.access=o,this.value=i}get astNodeType(){return"var"}},AM=class extends Wi{constructor(t,r,n){super(),this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}},MM=class extends Wi{constructor(t,r,n,o,i){super(),this.name=t,this.type=r,this.storage=n,this.access=o,this.value=i}get astNodeType(){return"let"}},SM=class extends Wi{constructor(t,r,n,o,i){super(),this.name=t,this.type=r,this.storage=n,this.access=o,this.value=i}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}},t0;(function(e){e.increment="++",e.decrement="--"})(t0||(t0={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return e[n]}e.parse=t})(t0||(t0={}));var MP=class extends Wi{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}},kb;(function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(kb||(kb={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return e[n]}e.parse=t})(kb||(kb={}));var SP=class extends Wi{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}},TP=class extends Wi{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}},EP=class extends Wi{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}},IP=class extends Wi{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"body"}},CP=class extends Wi{constructor(t,r,n,o){super(),this.condition=t,this.body=r,this.elseif=n,this.else=o}get astNodeType(){return"if"}},kP=class extends Wi{constructor(t){super(),this.value=t}get astNodeType(){return"return"}},PP=class extends Wi{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}},TM=class extends Wi{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}},OP=class extends Wi{constructor(){super()}get astNodeType(){return"discard"}},RP=class extends Wi{constructor(){super()}get astNodeType(){return"break"}},NP=class extends Wi{constructor(){super()}get astNodeType(){return"continue"}},Pf=class extends Wi{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}},Cf=class extends Pf{constructor(t,r){super(t),this.members=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}},EM=class extends Pf{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}},zP=class extends Pf{constructor(t,r,n,o){super(t),this.storage=r,this.type=n,this.access=o}get astNodeType(){return"pointer"}},IM=class extends Pf{constructor(t,r,n,o){super(t),this.attributes=r,this.format=n,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}},Nm=class extends Pf{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}},Tl=class extends kf{constructor(){super()}},CM=class extends Tl{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}},zm=class extends Tl{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}},DP=class extends Tl{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}},LP=class extends Tl{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}},kM=class extends Tl{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(t){var r,n;if(this.initializer instanceof zm){let o=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(t),i=(n=this.initializer.type)===null||n===void 0?void 0:n.name,s=t.structs.get(i),a=s?.getMemberIndex(o);if(a!=-1)return this.initializer.args[a].evaluate(t);console.log(a)}return this.initializer.evaluate(t)}},PM=class extends Tl{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}},FP=class extends Tl{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}},BP=class extends Tl{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(t){return this.args[0].evaluate(t)}},OM=class extends Tl{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}},RM=class extends Tl{constructor(){super()}},jP=class extends RM{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}},Sl=class extends RM{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}},NM=class extends kf{constructor(){super()}},UP=class extends NM{constructor(t,r){super(),this.selector=t,this.body=r}get astNodeType(){return"case"}},VP=class extends NM{constructor(t){super(),this.body=t}get astNodeType(){return"default"}},WP=class extends kf{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}},ZP=class extends kf{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}},YP=class extends kf{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}},zM=class extends kf{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}},Bt,ht;(function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(ht||(ht={}));var ft=class{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}},Ye=class{};Bt=Ye;Ye.none=new ft("",ht.reserved,"");Ye.eof=new ft("EOF",ht.token,"");Ye.reserved={asm:new ft("asm",ht.reserved,"asm"),bf16:new ft("bf16",ht.reserved,"bf16"),do:new ft("do",ht.reserved,"do"),enum:new ft("enum",ht.reserved,"enum"),f16:new ft("f16",ht.reserved,"f16"),f64:new ft("f64",ht.reserved,"f64"),handle:new ft("handle",ht.reserved,"handle"),i8:new ft("i8",ht.reserved,"i8"),i16:new ft("i16",ht.reserved,"i16"),i64:new ft("i64",ht.reserved,"i64"),mat:new ft("mat",ht.reserved,"mat"),premerge:new ft("premerge",ht.reserved,"premerge"),regardless:new ft("regardless",ht.reserved,"regardless"),typedef:new ft("typedef",ht.reserved,"typedef"),u8:new ft("u8",ht.reserved,"u8"),u16:new ft("u16",ht.reserved,"u16"),u64:new ft("u64",ht.reserved,"u64"),unless:new ft("unless",ht.reserved,"unless"),using:new ft("using",ht.reserved,"using"),vec:new ft("vec",ht.reserved,"vec"),void:new ft("void",ht.reserved,"void")};Ye.keywords={array:new ft("array",ht.keyword,"array"),atomic:new ft("atomic",ht.keyword,"atomic"),bool:new ft("bool",ht.keyword,"bool"),f32:new ft("f32",ht.keyword,"f32"),i32:new ft("i32",ht.keyword,"i32"),mat2x2:new ft("mat2x2",ht.keyword,"mat2x2"),mat2x3:new ft("mat2x3",ht.keyword,"mat2x3"),mat2x4:new ft("mat2x4",ht.keyword,"mat2x4"),mat3x2:new ft("mat3x2",ht.keyword,"mat3x2"),mat3x3:new ft("mat3x3",ht.keyword,"mat3x3"),mat3x4:new ft("mat3x4",ht.keyword,"mat3x4"),mat4x2:new ft("mat4x2",ht.keyword,"mat4x2"),mat4x3:new ft("mat4x3",ht.keyword,"mat4x3"),mat4x4:new ft("mat4x4",ht.keyword,"mat4x4"),ptr:new ft("ptr",ht.keyword,"ptr"),sampler:new ft("sampler",ht.keyword,"sampler"),sampler_comparison:new ft("sampler_comparison",ht.keyword,"sampler_comparison"),struct:new ft("struct",ht.keyword,"struct"),texture_1d:new ft("texture_1d",ht.keyword,"texture_1d"),texture_2d:new ft("texture_2d",ht.keyword,"texture_2d"),texture_2d_array:new ft("texture_2d_array",ht.keyword,"texture_2d_array"),texture_3d:new ft("texture_3d",ht.keyword,"texture_3d"),texture_cube:new ft("texture_cube",ht.keyword,"texture_cube"),texture_cube_array:new ft("texture_cube_array",ht.keyword,"texture_cube_array"),texture_multisampled_2d:new ft("texture_multisampled_2d",ht.keyword,"texture_multisampled_2d"),texture_storage_1d:new ft("texture_storage_1d",ht.keyword,"texture_storage_1d"),texture_storage_2d:new ft("texture_storage_2d",ht.keyword,"texture_storage_2d"),texture_storage_2d_array:new ft("texture_storage_2d_array",ht.keyword,"texture_storage_2d_array"),texture_storage_3d:new ft("texture_storage_3d",ht.keyword,"texture_storage_3d"),texture_depth_2d:new ft("texture_depth_2d",ht.keyword,"texture_depth_2d"),texture_depth_2d_array:new ft("texture_depth_2d_array",ht.keyword,"texture_depth_2d_array"),texture_depth_cube:new ft("texture_depth_cube",ht.keyword,"texture_depth_cube"),texture_depth_cube_array:new ft("texture_depth_cube_array",ht.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ft("texture_depth_multisampled_2d",ht.keyword,"texture_depth_multisampled_2d"),texture_external:new ft("texture_external",ht.keyword,"texture_external"),u32:new ft("u32",ht.keyword,"u32"),vec2:new ft("vec2",ht.keyword,"vec2"),vec3:new ft("vec3",ht.keyword,"vec3"),vec4:new ft("vec4",ht.keyword,"vec4"),bitcast:new ft("bitcast",ht.keyword,"bitcast"),block:new ft("block",ht.keyword,"block"),break:new ft("break",ht.keyword,"break"),case:new ft("case",ht.keyword,"case"),continue:new ft("continue",ht.keyword,"continue"),continuing:new ft("continuing",ht.keyword,"continuing"),default:new ft("default",ht.keyword,"default"),discard:new ft("discard",ht.keyword,"discard"),else:new ft("else",ht.keyword,"else"),enable:new ft("enable",ht.keyword,"enable"),fallthrough:new ft("fallthrough",ht.keyword,"fallthrough"),false:new ft("false",ht.keyword,"false"),fn:new ft("fn",ht.keyword,"fn"),for:new ft("for",ht.keyword,"for"),function:new ft("function",ht.keyword,"function"),if:new ft("if",ht.keyword,"if"),let:new ft("let",ht.keyword,"let"),const:new ft("const",ht.keyword,"const"),loop:new ft("loop",ht.keyword,"loop"),while:new ft("while",ht.keyword,"while"),private:new ft("private",ht.keyword,"private"),read:new ft("read",ht.keyword,"read"),read_write:new ft("read_write",ht.keyword,"read_write"),return:new ft("return",ht.keyword,"return"),storage:new ft("storage",ht.keyword,"storage"),switch:new ft("switch",ht.keyword,"switch"),true:new ft("true",ht.keyword,"true"),alias:new ft("alias",ht.keyword,"alias"),type:new ft("type",ht.keyword,"type"),uniform:new ft("uniform",ht.keyword,"uniform"),var:new ft("var",ht.keyword,"var"),override:new ft("override",ht.keyword,"override"),workgroup:new ft("workgroup",ht.keyword,"workgroup"),write:new ft("write",ht.keyword,"write"),r8unorm:new ft("r8unorm",ht.keyword,"r8unorm"),r8snorm:new ft("r8snorm",ht.keyword,"r8snorm"),r8uint:new ft("r8uint",ht.keyword,"r8uint"),r8sint:new ft("r8sint",ht.keyword,"r8sint"),r16uint:new ft("r16uint",ht.keyword,"r16uint"),r16sint:new ft("r16sint",ht.keyword,"r16sint"),r16float:new ft("r16float",ht.keyword,"r16float"),rg8unorm:new ft("rg8unorm",ht.keyword,"rg8unorm"),rg8snorm:new ft("rg8snorm",ht.keyword,"rg8snorm"),rg8uint:new ft("rg8uint",ht.keyword,"rg8uint"),rg8sint:new ft("rg8sint",ht.keyword,"rg8sint"),r32uint:new ft("r32uint",ht.keyword,"r32uint"),r32sint:new ft("r32sint",ht.keyword,"r32sint"),r32float:new ft("r32float",ht.keyword,"r32float"),rg16uint:new ft("rg16uint",ht.keyword,"rg16uint"),rg16sint:new ft("rg16sint",ht.keyword,"rg16sint"),rg16float:new ft("rg16float",ht.keyword,"rg16float"),rgba8unorm:new ft("rgba8unorm",ht.keyword,"rgba8unorm"),rgba8unorm_srgb:new ft("rgba8unorm_srgb",ht.keyword,"rgba8unorm_srgb"),rgba8snorm:new ft("rgba8snorm",ht.keyword,"rgba8snorm"),rgba8uint:new ft("rgba8uint",ht.keyword,"rgba8uint"),rgba8sint:new ft("rgba8sint",ht.keyword,"rgba8sint"),bgra8unorm:new ft("bgra8unorm",ht.keyword,"bgra8unorm"),bgra8unorm_srgb:new ft("bgra8unorm_srgb",ht.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ft("rgb10a2unorm",ht.keyword,"rgb10a2unorm"),rg11b10float:new ft("rg11b10float",ht.keyword,"rg11b10float"),rg32uint:new ft("rg32uint",ht.keyword,"rg32uint"),rg32sint:new ft("rg32sint",ht.keyword,"rg32sint"),rg32float:new ft("rg32float",ht.keyword,"rg32float"),rgba16uint:new ft("rgba16uint",ht.keyword,"rgba16uint"),rgba16sint:new ft("rgba16sint",ht.keyword,"rgba16sint"),rgba16float:new ft("rgba16float",ht.keyword,"rgba16float"),rgba32uint:new ft("rgba32uint",ht.keyword,"rgba32uint"),rgba32sint:new ft("rgba32sint",ht.keyword,"rgba32sint"),rgba32float:new ft("rgba32float",ht.keyword,"rgba32float"),static_assert:new ft("static_assert",ht.keyword,"static_assert")};Ye.tokens={decimal_float_literal:new ft("decimal_float_literal",ht.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new ft("hex_float_literal",ht.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new ft("int_literal",ht.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ft("uint_literal",ht.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new ft("ident",ht.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new ft("and",ht.token,"&"),and_and:new ft("and_and",ht.token,"&&"),arrow:new ft("arrow ",ht.token,"->"),attr:new ft("attr",ht.token,"@"),attr_left:new ft("attr_left",ht.token,"[["),attr_right:new ft("attr_right",ht.token,"]]"),forward_slash:new ft("forward_slash",ht.token,"/"),bang:new ft("bang",ht.token,"!"),bracket_left:new ft("bracket_left",ht.token,"["),bracket_right:new ft("bracket_right",ht.token,"]"),brace_left:new ft("brace_left",ht.token,"{"),brace_right:new ft("brace_right",ht.token,"}"),colon:new ft("colon",ht.token,":"),comma:new ft("comma",ht.token,","),equal:new ft("equal",ht.token,"="),equal_equal:new ft("equal_equal",ht.token,"=="),not_equal:new ft("not_equal",ht.token,"!="),greater_than:new ft("greater_than",ht.token,">"),greater_than_equal:new ft("greater_than_equal",ht.token,">="),shift_right:new ft("shift_right",ht.token,">>"),less_than:new ft("less_than",ht.token,"<"),less_than_equal:new ft("less_than_equal",ht.token,"<="),shift_left:new ft("shift_left",ht.token,"<<"),modulo:new ft("modulo",ht.token,"%"),minus:new ft("minus",ht.token,"-"),minus_minus:new ft("minus_minus",ht.token,"--"),period:new ft("period",ht.token,"."),plus:new ft("plus",ht.token,"+"),plus_plus:new ft("plus_plus",ht.token,"++"),or:new ft("or",ht.token,"|"),or_or:new ft("or_or",ht.token,"||"),paren_left:new ft("paren_left",ht.token,"("),paren_right:new ft("paren_right",ht.token,")"),semicolon:new ft("semicolon",ht.token,";"),star:new ft("star",ht.token,"*"),tilde:new ft("tilde",ht.token,"~"),underscore:new ft("underscore",ht.token,"_"),xor:new ft("xor",ht.token,"^"),plus_equal:new ft("plus_equal",ht.token,"+="),minus_equal:new ft("minus_equal",ht.token,"-="),times_equal:new ft("times_equal",ht.token,"*="),division_equal:new ft("division_equal",ht.token,"/="),modulo_equal:new ft("modulo_equal",ht.token,"%="),and_equal:new ft("and_equal",ht.token,"&="),or_equal:new ft("or_equal",ht.token,"|="),xor_equal:new ft("xor_equal",ht.token,"^="),shift_right_equal:new ft("shift_right_equal",ht.token,">>="),shift_left_equal:new ft("shift_left_equal",ht.token,"<<=")};Ye.storage_class=[Bt.keywords.function,Bt.keywords.private,Bt.keywords.workgroup,Bt.keywords.uniform,Bt.keywords.storage];Ye.access_mode=[Bt.keywords.read,Bt.keywords.write,Bt.keywords.read_write];Ye.sampler_type=[Bt.keywords.sampler,Bt.keywords.sampler_comparison];Ye.sampled_texture_type=[Bt.keywords.texture_1d,Bt.keywords.texture_2d,Bt.keywords.texture_2d_array,Bt.keywords.texture_3d,Bt.keywords.texture_cube,Bt.keywords.texture_cube_array];Ye.multisampled_texture_type=[Bt.keywords.texture_multisampled_2d];Ye.storage_texture_type=[Bt.keywords.texture_storage_1d,Bt.keywords.texture_storage_2d,Bt.keywords.texture_storage_2d_array,Bt.keywords.texture_storage_3d];Ye.depth_texture_type=[Bt.keywords.texture_depth_2d,Bt.keywords.texture_depth_2d_array,Bt.keywords.texture_depth_cube,Bt.keywords.texture_depth_cube_array,Bt.keywords.texture_depth_multisampled_2d];Ye.texture_external_type=[Bt.keywords.texture_external];Ye.any_texture_type=[...Bt.sampled_texture_type,...Bt.multisampled_texture_type,...Bt.storage_texture_type,...Bt.depth_texture_type,...Bt.texture_external_type];Ye.texel_format=[Bt.keywords.r8unorm,Bt.keywords.r8snorm,Bt.keywords.r8uint,Bt.keywords.r8sint,Bt.keywords.r16uint,Bt.keywords.r16sint,Bt.keywords.r16float,Bt.keywords.rg8unorm,Bt.keywords.rg8snorm,Bt.keywords.rg8uint,Bt.keywords.rg8sint,Bt.keywords.r32uint,Bt.keywords.r32sint,Bt.keywords.r32float,Bt.keywords.rg16uint,Bt.keywords.rg16sint,Bt.keywords.rg16float,Bt.keywords.rgba8unorm,Bt.keywords.rgba8unorm_srgb,Bt.keywords.rgba8snorm,Bt.keywords.rgba8uint,Bt.keywords.rgba8sint,Bt.keywords.bgra8unorm,Bt.keywords.bgra8unorm_srgb,Bt.keywords.rgb10a2unorm,Bt.keywords.rg11b10float,Bt.keywords.rg32uint,Bt.keywords.rg32sint,Bt.keywords.rg32float,Bt.keywords.rgba16uint,Bt.keywords.rgba16sint,Bt.keywords.rgba16float,Bt.keywords.rgba32uint,Bt.keywords.rgba32sint,Bt.keywords.rgba32float];Ye.const_literal=[Bt.tokens.int_literal,Bt.tokens.uint_literal,Bt.tokens.decimal_float_literal,Bt.tokens.hex_float_literal,Bt.keywords.true,Bt.keywords.false];Ye.literal_or_ident=[Bt.tokens.ident,Bt.tokens.int_literal,Bt.tokens.uint_literal,Bt.tokens.decimal_float_literal,Bt.tokens.hex_float_literal];Ye.element_count_expression=[Bt.tokens.int_literal,Bt.tokens.uint_literal,Bt.tokens.ident];Ye.template_types=[Bt.keywords.vec2,Bt.keywords.vec3,Bt.keywords.vec4,Bt.keywords.mat2x2,Bt.keywords.mat2x3,Bt.keywords.mat2x4,Bt.keywords.mat3x2,Bt.keywords.mat3x3,Bt.keywords.mat3x4,Bt.keywords.mat4x2,Bt.keywords.mat4x3,Bt.keywords.mat4x4,Bt.keywords.atomic,Bt.keywords.bitcast,...Bt.any_texture_type];Ye.attribute_name=[Bt.tokens.ident,Bt.keywords.block];Ye.assignment_operators=[Bt.tokens.equal,Bt.tokens.plus_equal,Bt.tokens.minus_equal,Bt.tokens.times_equal,Bt.tokens.division_equal,Bt.tokens.modulo_equal,Bt.tokens.and_equal,Bt.tokens.or_equal,Bt.tokens.xor_equal,Bt.tokens.shift_right_equal,Bt.tokens.shift_left_equal];Ye.increment_operators=[Bt.tokens.plus_plus,Bt.tokens.minus_minus];var DM=class{constructor(t,r,n){this.type=t,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return Ye.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Ye.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},qP=class{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new DM(Ye.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let n=1;for(;n>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),n--,n==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),n++)}return!0}}let r=Ye.none;for(;;){let n=this._findType(t),o=this._peekAhead();if(t==">"&&(o==">"||o=="=")){let i=!1,s=this._tokens.length-1;for(let a=0;a<5&&s>=0;++a,--s)if(this._tokens[s].type===Ye.tokens.less_than){s>0&&this._tokens[s-1].isArrayOrTemplateType()&&(i=!0);break}if(i)return this._addToken(n),!0}if(n===Ye.none){let i=t,s=0,a=2;for(let u=0;u<a;++u)if(i+=this._peekAhead(u),n=this._findType(i),n!==Ye.none){s=u;break}if(n===Ye.none)return r===Ye.none?!1:(this._current--,this._addToken(r),!0);t=i,this._current+=s+1}if(r=n,this._isAtEnd())break;t+=this._advance()}return r===Ye.none?!1:(this._addToken(r),!0)}_findType(t){for(let r in Ye.keywords){let n=Ye.keywords[r];if(this._match(t,n.rule))return n}for(let r in Ye.tokens){let n=Ye.tokens[r];if(this._match(t,n.rule))return n}return Ye.none}_match(t,r){if(typeof r=="string"){if(r==t)return!0}else{let n=r.exec(t);if(n&&n.index==0&&n[0]==t)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){let r=this._source.substring(this._start,this._current);this._tokens.push(new DM(t,r,this._line))}},GP=class{constructor(){this._tokens=[],this._current=0,this._context=new xP}parse(t){this._initialize(t);let r=[];for(;!this._isAtEnd();){let n=this._global_decl_or_directive();if(!n)break;r.push(n)}return r}_initialize(t){if(t)if(typeof t=="string"){let r=new qP(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,r){return console.error(t,r),{token:t,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ye.eof}_match(t){if(t instanceof ft)return this._check(t)?(this._advance(),!0):!1;for(let r=0,n=t.length;r<n;++r){let o=t[r];if(this._check(o))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),r)}_check(t){if(this._isAtEnd())return!1;let r=this._peek();if(t instanceof Array){let n=r.type;return t.indexOf(n)!=-1}return r.type==t}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ye.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ye.keywords.alias)){let r=this._type_alias();return this._consume(Ye.tokens.semicolon,"Expected ';'"),r}if(this._match(Ye.keywords.enable)){let r=this._enable_directive();return this._consume(Ye.tokens.semicolon,"Expected ';'"),r}let t=this._attribute();if(this._check(Ye.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(Ye.tokens.semicolon,"Expected ';'."),r}if(this._check(Ye.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(Ye.tokens.semicolon,"Expected ';'."),r}if(this._check(Ye.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(Ye.tokens.semicolon,"Expected ';'."),r}if(this._check(Ye.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(Ye.tokens.semicolon,"Expected ';'."),r}if(this._check(Ye.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=t),r}if(this._check(Ye.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=t),r}return null}_function_decl(){if(!this._match(Ye.keywords.fn))return null;let t=this._consume(Ye.tokens.ident,"Expected function name.").toString();this._consume(Ye.tokens.paren_left,"Expected '(' for function arguments.");let r=[];if(!this._check(Ye.tokens.paren_right))do{if(this._check(Ye.tokens.paren_right))break;let i=this._attribute(),s=this._consume(Ye.tokens.ident,"Expected argument name.").toString();this._consume(Ye.tokens.colon,"Expected ':' for argument type.");let a=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=a,r.push(new WP(s,u,i)))}while(this._match(Ye.tokens.comma));this._consume(Ye.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Ye.tokens.arrow)){let i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let o=this._compound_statement();return new wM(t,r,n,o)}_compound_statement(){let t=[];for(this._consume(Ye.tokens.brace_left,"Expected '{' for block.");!this._check(Ye.tokens.brace_right);){let r=this._statement();r!==null&&t.push(r)}return this._consume(Ye.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(Ye.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ye.keywords.if))return this._if_statement();if(this._check(Ye.keywords.switch))return this._switch_statement();if(this._check(Ye.keywords.loop))return this._loop_statement();if(this._check(Ye.keywords.for))return this._for_statement();if(this._check(Ye.keywords.while))return this._while_statement();if(this._check(Ye.keywords.continuing))return this._continuing_statement();if(this._check(Ye.keywords.static_assert))return this._static_assert_statement();if(this._check(Ye.tokens.brace_left))return this._compound_statement();let t=null;return this._check(Ye.keywords.return)?t=this._return_statement():this._check([Ye.keywords.var,Ye.keywords.let,Ye.keywords.const])?t=this._variable_statement():this._match(Ye.keywords.discard)?t=new OP:this._match(Ye.keywords.break)?t=new RP:this._match(Ye.keywords.continue)?t=new NP:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(Ye.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(Ye.keywords.static_assert))return null;let t=this._optional_paren_expression();return new bP(t)}_while_statement(){if(!this._match(Ye.keywords.while))return null;let t=this._optional_paren_expression(),r=this._compound_statement();return new vP(t,r)}_continuing_statement(){if(!this._match(Ye.keywords.continuing))return null;let t=this._compound_statement();return new wP(t)}_for_statement(){if(!this._match(Ye.keywords.for))return null;this._consume(Ye.tokens.paren_left,"Expected '('.");let t=this._check(Ye.tokens.semicolon)?null:this._for_init();this._consume(Ye.tokens.semicolon,"Expected ';'.");let r=this._check(Ye.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(Ye.tokens.semicolon,"Expected ';'.");let n=this._check(Ye.tokens.paren_right)?null:this._for_increment();this._consume(Ye.tokens.paren_right,"Expected ')'.");let o=this._compound_statement();return new AP(t,r,n,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ye.keywords.var)){let t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(Ye.tokens.equal)&&(r=this._short_circuit_or_expression()),new ld(t.name,t.type,t.storage,t.access,r)}if(this._match(Ye.keywords.let)){let t=this._consume(Ye.tokens.ident,"Expected name for let.").toString(),r=null;if(this._match(Ye.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(Ye.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return new MM(t,r,null,null,n)}if(this._match(Ye.keywords.const)){let t=this._consume(Ye.tokens.ident,"Expected name for const.").toString(),r=null;if(this._match(Ye.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}this._consume(Ye.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return new SM(t,r,null,null,n)}return null}_increment_decrement_statement(){let t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(Ye.increment_operators))return this._current=t,null;let n=this._consume(Ye.increment_operators,"Expected increment operator");return new MP(n.type===Ye.tokens.plus_plus?t0.increment:t0.decrement,r)}_assignment_statement(){let t=null;if(this._check(Ye.tokens.brace_right))return null;let r=this._match(Ye.tokens.underscore);if(r||(t=this._unary_expression()),!r&&t==null)return null;let n=this._consume(Ye.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new SP(kb.parse(n.lexeme),t,o)}_func_call_statement(){if(!this._check(Ye.tokens.ident))return null;let t=this._current,r=this._consume(Ye.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):new TP(r.lexeme,n)}_loop_statement(){if(!this._match(Ye.keywords.loop))return null;this._consume(Ye.tokens.brace_left,"Expected '{' for loop.");let t=[],r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let o of r)t.push(o);else t.push(r);r=this._statement()}let n=null;return this._match(Ye.keywords.continuing)&&(n=this._compound_statement()),this._consume(Ye.tokens.brace_right,"Expected '}' for loop."),new EP(t,n)}_switch_statement(){if(!this._match(Ye.keywords.switch))return null;let t=this._optional_paren_expression();this._consume(Ye.tokens.brace_left,"Expected '{' for switch.");let r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ye.tokens.brace_right,"Expected '}' for switch."),new IP(t,r)}_switch_body(){let t=[];if(this._match(Ye.keywords.case)){let r=this._case_selectors();this._match(Ye.tokens.colon),this._consume(Ye.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(Ye.tokens.brace_right,"Exected '}' for switch case."),t.push(new UP(r,n))}if(this._match(Ye.keywords.default)){this._match(Ye.tokens.colon),this._consume(Ye.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(Ye.tokens.brace_right,"Exected '}' for switch default."),t.push(new VP(r))}if(this._check([Ye.keywords.default,Ye.keywords.case])){let r=this._switch_body();t.push(r[0])}return t}_case_selectors(){var t,r,n,o;let i=[(r=(t=this._shift_expression())===null||t===void 0?void 0:t.evaluate(this._context).toString())!==null&&r!==void 0?r:""];for(;this._match(Ye.tokens.comma);)i.push((o=(n=this._shift_expression())===null||n===void 0?void 0:n.evaluate(this._context).toString())!==null&&o!==void 0?o:"");return i}_case_body(){if(this._match(Ye.keywords.fallthrough))return this._consume(Ye.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);let r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(Ye.keywords.if))return null;let t=this._optional_paren_expression(),r=this._compound_statement(),n=[];this._match_elseif()&&(n=this._elseif_statement(n));let o=null;return this._match(Ye.keywords.else)&&(o=this._compound_statement()),new CP(t,r,n,o)}_match_elseif(){return this._tokens[this._current].type===Ye.keywords.else&&this._tokens[this._current+1].type===Ye.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){let r=this._optional_paren_expression(),n=this._compound_statement();return t.push(new ZP(r,n)),this._match_elseif()&&this._elseif_statement(t),t}_return_statement(){if(!this._match(Ye.keywords.return))return null;let t=this._short_circuit_or_expression();return new kP(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(Ye.tokens.or_or);)t=new Sl(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(Ye.tokens.and_and);)t=new Sl(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(Ye.tokens.or);)t=new Sl(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(Ye.tokens.xor);)t=new Sl(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(Ye.tokens.and);)t=new Sl(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){let t=this._relational_expression();return this._match([Ye.tokens.equal_equal,Ye.tokens.not_equal])?new Sl(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([Ye.tokens.less_than,Ye.tokens.greater_than,Ye.tokens.less_than_equal,Ye.tokens.greater_than_equal]);)t=new Sl(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([Ye.tokens.shift_left,Ye.tokens.shift_right]);)t=new Sl(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([Ye.tokens.plus,Ye.tokens.minus]);)t=new Sl(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([Ye.tokens.star,Ye.tokens.forward_slash,Ye.tokens.modulo]);)t=new Sl(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([Ye.tokens.minus,Ye.tokens.bang,Ye.tokens.tilde,Ye.tokens.star,Ye.tokens.and])?new jP(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){let t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(Ye.tokens.bracket_left)){let t=this._short_circuit_or_expression();this._consume(Ye.tokens.bracket_right,"Expected ']'.");let r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(Ye.tokens.period)){let t=this._consume(Ye.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new CM(t.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(Ye.tokens.ident)){let n=this._previous().toString();if(this._check(Ye.tokens.paren_left)){let o=this._argument_expression_list(),i=this._getStruct(n);return i!=null?new zm(i,o):new DP(n,o)}if(this._context.constants.has(n)){let o=this._context.constants.get(n);return new kM(n,o.value)}return new LP(n)}if(this._match(Ye.const_literal))return new PM(parseFloat(this._previous().toString()));if(this._check(Ye.tokens.paren_left))return this._paren_expression();if(this._match(Ye.keywords.bitcast)){this._consume(Ye.tokens.less_than,"Expected '<'.");let n=this._type_decl();this._consume(Ye.tokens.greater_than,"Expected '>'.");let o=this._paren_expression();return new FP(n,o)}let t=this._type_decl(),r=this._argument_expression_list();return new BP(t,r)}_argument_expression_list(){if(!this._match(Ye.tokens.paren_left))return null;let t=[];do{if(this._check(Ye.tokens.paren_right))break;let r=this._short_circuit_or_expression();t.push(r)}while(this._match(Ye.tokens.comma));return this._consume(Ye.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(Ye.tokens.paren_left);let t=this._short_circuit_or_expression();return this._match(Ye.tokens.paren_right),new OM([t])}_paren_expression(){this._consume(Ye.tokens.paren_left,"Expected '('.");let t=this._short_circuit_or_expression();return this._consume(Ye.tokens.paren_right,"Expected ')'."),new OM([t])}_struct_decl(){if(!this._match(Ye.keywords.struct))return null;let t=this._consume(Ye.tokens.ident,"Expected name for struct.").toString();this._consume(Ye.tokens.brace_left,"Expected '{' for struct body.");let r=[];for(;!this._check(Ye.tokens.brace_right);){let o=this._attribute(),i=this._consume(Ye.tokens.ident,"Expected variable name.").toString();this._consume(Ye.tokens.colon,"Expected ':' for struct member type.");let s=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=s),this._check(Ye.tokens.brace_right)?this._match(Ye.tokens.comma):this._consume(Ye.tokens.comma,"Expected ',' for struct member."),r.push(new YP(i,a,o))}this._consume(Ye.tokens.brace_right,"Expected '}' after struct body.");let n=new Cf(t,r);return this._context.structs.set(t,n),n}_global_variable_decl(){let t=this._variable_decl();return t&&this._match(Ye.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){let t=this._override_decl();return t&&this._match(Ye.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(Ye.keywords.const))return null;let t=this._consume(Ye.tokens.ident,"Expected variable name"),r=null;if(this._match(Ye.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let n=null;if(this._match(Ye.tokens.equal)){let i=this._short_circuit_or_expression();if(i instanceof zm)n=i;else if(i instanceof kM&&i.initializer instanceof zm)n=i.initializer;else try{let s=i.evaluate(this._context);n=new PM(s)}catch{n=i}}let o=new SM(t.toString(),r,"","",n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Ye.keywords.let))return null;let t=this._consume(Ye.tokens.ident,"Expected variable name"),r=null;if(this._match(Ye.tokens.colon)){let o=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=o)}let n=null;return this._match(Ye.tokens.equal)&&(n=this._const_expression()),new MM(t.toString(),r,"","",n)}_const_expression(){if(this._match(Ye.const_literal))return new CM(this._previous().toString());let t=this._type_decl();this._consume(Ye.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(Ye.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(Ye.tokens.comma));)this._advance();return this._consume(Ye.tokens.paren_right,"Expected ')'."),new zm(t,r)}_variable_decl(){if(!this._match(Ye.keywords.var))return null;let t="",r="";this._match(Ye.tokens.less_than)&&(t=this._consume(Ye.storage_class,"Expected storage_class.").toString(),this._match(Ye.tokens.comma)&&(r=this._consume(Ye.access_mode,"Expected access_mode.").toString()),this._consume(Ye.tokens.greater_than,"Expected '>'."));let n=this._consume(Ye.tokens.ident,"Expected variable name"),o=null;if(this._match(Ye.tokens.colon)){let i=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=i)}return new ld(n.toString(),o,t,r,null)}_override_decl(){if(!this._match(Ye.keywords.override))return null;let t=this._consume(Ye.tokens.ident,"Expected variable name"),r=null;if(this._match(Ye.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new AM(t.toString(),r,null)}_enable_directive(){let t=this._consume(Ye.tokens.ident,"identity expected.");return new PP(t.toString())}_type_alias(){let t=this._consume(Ye.tokens.ident,"identity expected.");this._consume(Ye.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let n=new TM(t.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ye.tokens.ident,...Ye.texel_format,Ye.keywords.bool,Ye.keywords.f32,Ye.keywords.i32,Ye.keywords.u32])){let n=this._advance(),o=n.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new Pf(n.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(Ye.template_types)){let n=this._advance().toString(),o=null,i=null;return this._match(Ye.tokens.less_than)&&(o=this._type_decl(),i=null,this._match(Ye.tokens.comma)&&(i=this._consume(Ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ye.tokens.greater_than,"Expected '>' for type.")),new EM(n,o,i)}if(this._match(Ye.keywords.ptr)){let n=this._previous().toString();this._consume(Ye.tokens.less_than,"Expected '<' for pointer.");let o=this._consume(Ye.storage_class,"Expected storage_class for pointer");this._consume(Ye.tokens.comma,"Expected ',' for pointer.");let i=this._type_decl(),s=null;return this._match(Ye.tokens.comma)&&(s=this._consume(Ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ye.tokens.greater_than,"Expected '>' for pointer."),new zP(n,o.toString(),i,s)}let r=this._attribute();if(this._match(Ye.keywords.array)){let n=null,o=-1,i=this._previous();if(this._match(Ye.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let s="";this._match(Ye.tokens.comma)&&(s=this._shift_expression().evaluate(this._context).toString()),this._consume(Ye.tokens.greater_than,"Expected '>' for array."),o=s?parseInt(s):0}return new IM(i.toString(),r,n,o)}return null}_texture_sampler_types(){if(this._match(Ye.sampler_type))return new Nm(this._previous().toString(),null,null);if(this._match(Ye.depth_texture_type))return new Nm(this._previous().toString(),null,null);if(this._match(Ye.sampled_texture_type)||this._match(Ye.multisampled_texture_type)){let t=this._previous();this._consume(Ye.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(Ye.tokens.greater_than,"Expected '>' for sampler type."),new Nm(t.toString(),r,null)}if(this._match(Ye.storage_texture_type)){let t=this._previous();this._consume(Ye.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(Ye.texel_format,"Invalid texel format.").toString();this._consume(Ye.tokens.comma,"Expected ',' after texel format.");let n=this._consume(Ye.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ye.tokens.greater_than,"Expected '>' for sampler type."),new Nm(t.toString(),r,n)}return null}_attribute(){let t=[];for(;this._match(Ye.tokens.attr);){let r=this._consume(Ye.attribute_name,"Expected attribute name"),n=new zM(r.toString(),null);if(this._match(Ye.tokens.paren_left)){if(n.value=this._consume(Ye.literal_or_ident,"Expected attribute value").toString(),this._check(Ye.tokens.comma)){this._advance();do{let o=this._consume(Ye.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(o)}while(this._match(Ye.tokens.comma))}this._consume(Ye.tokens.paren_right,"Expected ')'")}t.push(n)}for(;this._match(Ye.tokens.attr_left);){if(!this._check(Ye.tokens.attr_right))do{let r=this._consume(Ye.attribute_name,"Expected attribute name"),n=new zM(r.toString(),null);if(this._match(Ye.tokens.paren_left)){if(n.value=[this._consume(Ye.literal_or_ident,"Expected attribute value").toString()],this._check(Ye.tokens.comma)){this._advance();do{let o=this._consume(Ye.literal_or_ident,"Expected attribute value").toString();n.value.push(o)}while(this._match(Ye.tokens.comma))}this._consume(Ye.tokens.paren_right,"Expected ')'")}t.push(n)}while(this._match(Ye.tokens.comma));this._consume(Ye.tokens.attr_right,"Expected ']]' after attribute declarations")}return t.length==0?null:t}},cd=class{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}},LM=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Q_=class extends cd{constructor(t,r){super(t,r),this.members=[],this.align=0}get isStruct(){return!0}},Cb=class extends cd{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}},FM=class extends cd{constructor(t,r,n,o){super(t,n),this.format=r,this.access=o}get isTemplate(){return!0}},ad;(function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(ad||(ad={}));var J_=class{constructor(t,r,n,o,i,s,a){this.name=t,this.type=r,this.group=n,this.binding=o,this.attributes=i,this.resourceType=s,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},HP=class{constructor(t,r){this.name=t,this.type=r}},e0=class{constructor(t,r){this.align=t,this.size=r}},XP=class{constructor(t,r,n,o){this.name=t,this.type=r,this.locationType=n,this.location=o,this.interpolation=null}},BM=class{constructor(t,r,n,o){this.name=t,this.type=r,this.locationType=n,this.location=o}},KP=class{constructor(t,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=t,this.stage=r}},$P=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},QP=class{constructor(t,r,n,o){this.name=t,this.type=r,this.attributes=n,this.id=o}},Dm=class e{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $P,this._types=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){let n=new GP().parse(t);for(let o of n){if(o instanceof Cf){let i=this._getTypeInfo(o,null);i instanceof Q_&&this.structs.push(i);continue}if(o instanceof TM){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof AM){let i=o,s=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this._getTypeInfo(i.type,i.attributes):null;this.overrides.push(new QP(i.name,a,i.attributes,s));continue}if(this._isUniformVar(o)){let i=o,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),u=this._getTypeInfo(i.type,i.attributes),h=new J_(i.name,u,s,a,i.attributes,ad.Uniform,i.access);this.uniforms.push(h);continue}if(this._isStorageVar(o)){let i=o,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),u=this._getTypeInfo(i.type,i.attributes),h=this._isStorageTexture(u),p=new J_(i.name,u,s,a,i.attributes,h?ad.StorageTexture:ad.Storage,i.access);this.storage.push(p);continue}if(this._isTextureVar(o)){let i=o,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),u=this._getTypeInfo(i.type,i.attributes),h=this._isStorageTexture(u),p=new J_(i.name,u,s,a,i.attributes,h?ad.StorageTexture:ad.Texture,i.access);h?this.storage.push(p):this.textures.push(p);continue}if(this._isSamplerVar(o)){let i=o,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),u=this._getTypeInfo(i.type,i.attributes),h=new J_(i.name,u,s,a,i.attributes,ad.Sampler,i.access);this.samplers.push(h);continue}if(o instanceof wM){let i=this._getAttribute(o,"vertex"),s=this._getAttribute(o,"fragment"),a=this._getAttribute(o,"compute"),u=i||s||a;if(u){let h=new KP(o.name,u.name);h.inputs=this._getInputs(o.args),h.outputs=this._getOutputs(o.returnType),this.entry[u.name].push(h)}continue}}}getBindGroups(){let t=[];function r(n,o){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),o>=t[n].length&&(t[n].length=o+1)}for(let n of this.uniforms){r(n.group,n.binding);let o=t[n.group];o[n.binding]=n}for(let n of this.storage){r(n.group,n.binding);let o=t[n.group];o[n.binding]=n}for(let n of this.textures){r(n.group,n.binding);let o=t[n.group];o[n.binding]=n}for(let n of this.samplers){r(n.group,n.binding);let o=t[n.group];o[n.binding]=n}return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof Cf)this._getStructOutputs(t,r);else{let n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(let n of t.members)if(n.type instanceof Cf)this._getStructOutputs(n.type,r);else{let o=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(o!==null){let i=this._getTypeInfo(n.type,n.type.attributes),s=this._parseInt(o.value),a=new BM(n.name,i,o.name,s);r.push(a)}}}_getOutputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getTypeInfo(t,t.attributes),o=this._parseInt(r.value);return new BM("",n,r.name,o)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(let n of t)if(n.type instanceof Cf)this._getStructInputs(n.type,r);else{let o=this._getInputInfo(n);o!==null&&r.push(o)}return r}_getStructInputs(t,r){for(let n of t.members)if(n.type instanceof Cf)this._getStructInputs(n.type,r);else{let o=this._getInputInfo(n);o!==null&&r.push(o)}}_getInputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getAttribute(t,"interpolation"),o=this._getTypeInfo(t.type,t.attributes),i=this._parseInt(r.value),s=new XP(t.name,o,r.name,i);return n!==null&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);let r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(let r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new HP(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,r){if(this._types.has(t))return this._types.get(t);if(t instanceof IM){let o=t,i=this._getTypeInfo(o.format,o.attributes),s=new Cb(o.name,r);return s.format=i,s.count=o.count,this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof Cf){let o=t,i=new Q_(o.name,r);for(let s of o.members){let a=this._getTypeInfo(s.type,s.attributes);i.members.push(new LM(s.name,a,s.attributes))}return this._types.set(t,i),this._updateTypeInfo(i),i}if(t instanceof Nm){let o=t,i=o.format instanceof Pf,s=o.format?i?this._getTypeInfo(o.format,null):new cd(o.format,null):null,a=new FM(o.name,s,r,o.access);return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof EM){let o=t,i=o.format?this._getTypeInfo(o.format,null):null,s=new FM(o.name,i,r,o.access);return this._types.set(t,s),this._updateTypeInfo(s),s}let n=new cd(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n;let o=this._getTypeSize(t);if(t.size=(r=o?.size)!==null&&r!==void 0?r:0,t instanceof Cb){let i=this._getTypeSize(t.format);t.stride=(n=i?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(t.format)}t instanceof Q_&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,o=0,i=0,s=0;for(let a=0,u=t.members.length;a<u;++a){let h=t.members[a],p=this._getTypeSize(h);if(!p)continue;(r=this._getAlias(h.type.name))!==null&&r!==void 0||h.type;let _=p.align,y=p.size;n=this._roundUp(_,n+o),o=y,i=n,s=Math.max(s,_),h.offset=n,h.size=y,this._updateTypeInfo(h.type)}t.size=this._roundUp(s,i+o),t.align=s}_getTypeSize(t){var r;if(t==null)return null;let n=this._getAttributeNum(t.attributes,"size",0),o=this._getAttributeNum(t.attributes,"align",0);if(t instanceof LM&&(t=t.type),t instanceof cd){let i=this._getAlias(t.name);i!==null&&(t=i)}{let i=e._typeInfo[t.name];if(i!==void 0){let s=t.format==="f16"?2:1;return new e0(Math.max(o,i.align/s),Math.max(n,i.size/s))}}{let i=e._typeInfo[t.name.substring(0,t.name.length-1)];if(i){let s=t.name[t.name.length-1]==="h"?2:1;return new e0(Math.max(o,i.align/s),Math.max(n,i.size/s))}}if(t instanceof Cb){let i=t,s=8,a=8,u=this._getTypeSize(i.format);u!==null&&(a=u.size,s=u.align);let h=i.count,p=this._getAttributeNum((r=t?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(s,a));return a=h*p,n&&(a=n),new e0(Math.max(o,s),Math.max(n,a))}if(t instanceof Q_){let i=0,s=0,a=0,u=0,h=0;for(let p of t.members){let _=this._getTypeSize(p.type);_!==null&&(i=Math.max(_.align,i),a=this._roundUp(_.align,a+u),u=_.size,h=a)}return s=this._roundUp(i,h+u),new e0(Math.max(o,i),Math.max(n,s))}return null}_isUniformVar(t){return t instanceof ld&&t.storage=="uniform"}_isStorageVar(t){return t instanceof ld&&t.storage=="storage"}_isTextureVar(t){return t instanceof ld&&t.type!==null&&e._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof ld&&t.type!==null&&e._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){let n=t;if(!n||!n.attributes)return null;let o=n.attributes;for(let i of o)if(i.name==r)return i;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let o of t)if(o.name==r){let i=o!==null&&o.value!==null?o.value:n;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}};Dm._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Dm._textureTypes=Ye.any_texture_type.map(e=>e.name);Dm._samplerTypes=Ye.sampler_type.map(e=>e.name);function JP(e){let t={attributes:[],bindings:[]},r;try{r=Ebe(e)}catch(i){return Ut.error(i.message)(),t}for(let i of r.uniforms){let s=[];for(let a of i.type.members)s.push({name:a.name,type:PW(a.type)});t.bindings.push({type:"uniform",name:i.name,location:i.binding,group:i.group,members:s})}let n=r.entry.vertex[0],o=n?.inputs.length||0;for(let i=0;i<o;i++){let s=n.inputs[i];if(s.locationType==="location"){let a=PW(s.type);t.attributes.push({name:s.name,location:s.location,type:a})}}return t}function PW(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function Ebe(e){try{return new Dm(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}var Ibe=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,eO={name:"fp32",vs:Ibe};var Cbe=new Float32Array([0,1,1,1]),kbe=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,Pbe=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,jM={name:"picking",vs:kbe,fs:Pbe,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:Cbe},getUniforms:Obe};function Obe(e={},t){let r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){let n=Array.from(e.highlightColor,o=>o/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(r.useFloatColors=!!e.useFloatColors),r}function tO(e,t=[],r=0){let n=Math.fround(e),o=e-n;return t[r]=n,t[r+1]=o,t}function OW(e){return e-Math.fround(e)}function RW(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){let o=r*4+n;tO(e[n*4+r],t,o*2)}return t}var NW=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var Rbe={ONE:1};function Nbe(){return Rbe}var rO={name:"fp64-arithmetic",vs:NW,getUniforms:Nbe,fp64ify:tO,fp64LowPart:OW,fp64ifyMatrix4:RW};var qWe=1/Math.PI*180,GWe=1/180*Math.PI,zbe={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...zbe}};var _o=globalThis.mathgl.config;function nO(e,{precision:t=_o.precision}={}){return e=Dbe(e),`${parseFloat(e.toPrecision(t))}`}function cc(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function El(e,t,r){return Fbe(e,n=>Math.max(t,Math.min(r,n)))}function Ma(e,t,r){return cc(e)?e.map((n,o)=>Ma(n,t[o],r)):r*t+(1-r)*e}function na(e,t,r){let n=_o.EPSILON;r&&(_o.EPSILON=r);try{if(e===t)return!0;if(cc(e)&&cc(t)){if(e.length!==t.length)return!1;for(let o=0;o<e.length;++o)if(!na(e[o],t[o]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=_o.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{_o.EPSILON=n}}function Dbe(e){return Math.round(e/_o.EPSILON)*_o.EPSILON}function Lbe(e){return e.clone?e.clone():new Array(e.length)}function Fbe(e,t,r){if(cc(e)){let n=e;r=r||Lbe(n);for(let o=0;o<r.length&&o<n.length;++o){let i=typeof e=="number"?e:e[o];r[o]=t(i,o,r)}return r}return t(e)}var ud=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:cc(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_o)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+nO(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!na(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let o=0;o<this.ELEMENTS;++o){let i=t[o],s=typeof r=="number"?r:r[o];this[o]=i+n*(s-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(_o.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function Bbe(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function ti(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function fd(e,t,r=""){if(_o.debug&&!Bbe(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function uu(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var r0=class extends ud{get x(){return this[0]}set x(t){this[0]=ti(t)}get y(){return this[1]}set y(t){this[1]=ti(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let o=this[n]-t[n];r+=o*o}return ti(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return ti(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return uu(t>=0&&t<this.ELEMENTS,"index is out of range"),ti(this[t])}setComponent(t,r){return uu(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var hu={};io(hu,{add:()=>Zbe,angle:()=>lve,ceil:()=>Ybe,clone:()=>jbe,copy:()=>Vbe,create:()=>zW,cross:()=>rve,dist:()=>_ve,distance:()=>BW,div:()=>gve,divide:()=>FW,dot:()=>tve,equals:()=>hve,exactEquals:()=>fve,floor:()=>qbe,forEach:()=>bve,fromValues:()=>Ube,inverse:()=>Jbe,len:()=>dve,length:()=>UW,lerp:()=>nve,max:()=>Hbe,min:()=>Gbe,mul:()=>mve,multiply:()=>LW,negate:()=>Qbe,normalize:()=>eve,random:()=>ive,rotate:()=>ave,round:()=>Xbe,scale:()=>Kbe,scaleAndAdd:()=>$be,set:()=>Wbe,sqrDist:()=>yve,sqrLen:()=>xve,squaredDistance:()=>jW,squaredLength:()=>VW,str:()=>uve,sub:()=>pve,subtract:()=>DW,transformMat2:()=>ove,transformMat2d:()=>sve,transformMat3:()=>iO,transformMat4:()=>oO,zero:()=>cve});var xi=typeof Float32Array<"u"?Float32Array:Array,fu=Math.random;function Il(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var iZe=Math.PI/180;function zW(){let e=new xi(2);return xi!=Float32Array&&(e[0]=0,e[1]=0),e}function jbe(e){let t=new xi(2);return t[0]=e[0],t[1]=e[1],t}function Ube(e,t){let r=new xi(2);return r[0]=e,r[1]=t,r}function Vbe(e,t){return e[0]=t[0],e[1]=t[1],e}function Wbe(e,t,r){return e[0]=t,e[1]=r,e}function Zbe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function DW(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function LW(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function FW(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Ybe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function qbe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Gbe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Hbe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Xbe(e,t){return e[0]=Il(t[0]),e[1]=Il(t[1]),e}function Kbe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function $be(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function BW(e,t){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function jW(e,t){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function UW(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function VW(e){let t=e[0],r=e[1];return t*t+r*r}function Qbe(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Jbe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function eve(e,t){let r=t[0],n=t[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e}function tve(e,t){return e[0]*t[0]+e[1]*t[1]}function rve(e,t,r){let n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function nve(e,t,r,n){let o=t[0],i=t[1];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e}function ive(e,t){t=t===void 0?1:t;let r=fu()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function ove(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e}function sve(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e}function iO(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[3]*o+r[6],e[1]=r[1]*n+r[4]*o+r[7],e}function oO(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[4]*o+r[12],e[1]=r[1]*n+r[5]*o+r[13],e}function ave(e,t,r,n){let o=t[0]-r[0],i=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=o*a-i*s+r[0],e[1]=o*s+i*a+r[1],e}function lve(e,t){let r=e[0],n=e[1],o=t[0],i=t[1],s=Math.sqrt((r*r+n*n)*(o*o+i*i)),a=s&&(r*o+n*i)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function cve(e){return e[0]=0,e[1]=0,e}function uve(e){return`vec2(${e[0]}, ${e[1]})`}function fve(e,t){return e[0]===t[0]&&e[1]===t[1]}function hve(e,t){let r=e[0],n=e[1],o=t[0],i=t[1];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))}var dve=UW,pve=DW,mve=LW,gve=FW,_ve=BW,yve=jW,xve=VW,bve=function(){let e=zW();return function(t,r,n,o,i,s){let a,u;for(r||(r=2),n||(n=0),o?u=Math.min(o*r+n,t.length):u=t.length,a=n;a<u;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function WW(e,t,r){let n=t[0],o=t[1],i=r[3]*n+r[7]*o||1;return e[0]=(r[0]*n+r[4]*o)/i,e[1]=(r[1]*n+r[5]*o)/i,e}function UM(e,t,r){let n=t[0],o=t[1],i=t[2],s=r[3]*n+r[7]*o+r[11]*i||1;return e[0]=(r[0]*n+r[4]*o+r[8]*i)/s,e[1]=(r[1]*n+r[5]*o+r[9]*i)/s,e[2]=(r[2]*n+r[6]*o+r[10]*i)/s,e}function ZW(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e[2]=t[2],e}function YW(e,t,r){let n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e[2]=t[2],e[3]=t[3],e}function VM(e,t,r){let n=t[0],o=t[1],i=t[2];return e[0]=r[0]*n+r[3]*o+r[6]*i,e[1]=r[1]*n+r[4]*o+r[7]*i,e[2]=r[2]*n+r[5]*o+r[8]*i,e[3]=t[3],e}var Sa={};io(Sa,{add:()=>Mve,angle:()=>uO,bezier:()=>Lve,ceil:()=>Sve,clone:()=>vve,copy:()=>wve,create:()=>WM,cross:()=>Lm,dist:()=>qve,distance:()=>KW,div:()=>Yve,divide:()=>XW,dot:()=>Pb,equals:()=>Vve,exactEquals:()=>Uve,floor:()=>Tve,forEach:()=>Xve,fromValues:()=>ZM,hermite:()=>Dve,inverse:()=>Rve,len:()=>fO,length:()=>qW,lerp:()=>Nve,max:()=>Ive,min:()=>Eve,mul:()=>Zve,multiply:()=>HW,negate:()=>Ove,normalize:()=>sO,random:()=>Fve,rotateX:()=>aO,rotateY:()=>lO,rotateZ:()=>cO,round:()=>Cve,scale:()=>kve,scaleAndAdd:()=>Pve,set:()=>Ave,slerp:()=>zve,sqrDist:()=>Gve,sqrLen:()=>Hve,squaredDistance:()=>$W,squaredLength:()=>QW,str:()=>jve,sub:()=>Wve,subtract:()=>GW,transformMat3:()=>Ob,transformMat4:()=>Fm,transformQuat:()=>Rb,zero:()=>Bve});function WM(){let e=new xi(3);return xi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vve(e){let t=new xi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function qW(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function ZM(e,t,r){let n=new xi(3);return n[0]=e,n[1]=t,n[2]=r,n}function wve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ave(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Mve(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function GW(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function HW(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function XW(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Sve(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Tve(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Eve(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Ive(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Cve(e,t){return e[0]=Il(t[0]),e[1]=Il(t[1]),e[2]=Il(t[2]),e}function kve(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Pve(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function KW(e,t){let r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+n*n+o*o)}function $W(e,t){let r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o}function QW(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Ove(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Rve(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function sO(e,t){let r=t[0],n=t[1],o=t[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Pb(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Lm(e,t,r){let n=t[0],o=t[1],i=t[2],s=r[0],a=r[1],u=r[2];return e[0]=o*u-i*a,e[1]=i*s-n*u,e[2]=n*a-o*s,e}function Nve(e,t,r,n){let o=t[0],i=t[1],s=t[2];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=s+n*(r[2]-s),e}function zve(e,t,r,n){let o=Math.acos(Math.min(Math.max(Pb(t,r),-1),1)),i=Math.sin(o),s=Math.sin((1-n)*o)/i,a=Math.sin(n*o)/i;return e[0]=s*t[0]+a*r[0],e[1]=s*t[1]+a*r[1],e[2]=s*t[2]+a*r[2],e}function Dve(e,t,r,n,o,i){let s=i*i,a=s*(2*i-3)+1,u=s*(i-2)+i,h=s*(i-1),p=s*(3-2*i);return e[0]=t[0]*a+r[0]*u+n[0]*h+o[0]*p,e[1]=t[1]*a+r[1]*u+n[1]*h+o[1]*p,e[2]=t[2]*a+r[2]*u+n[2]*h+o[2]*p,e}function Lve(e,t,r,n,o,i){let s=1-i,a=s*s,u=i*i,h=a*s,p=3*i*a,_=3*u*s,y=u*i;return e[0]=t[0]*h+r[0]*p+n[0]*_+o[0]*y,e[1]=t[1]*h+r[1]*p+n[1]*_+o[1]*y,e[2]=t[2]*h+r[2]*p+n[2]*_+o[2]*y,e}function Fve(e,t){t=t===void 0?1:t;let r=fu()*2*Math.PI,n=fu()*2-1,o=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e[2]=n*t,e}function Fm(e,t,r){let n=t[0],o=t[1],i=t[2],s=r[3]*n+r[7]*o+r[11]*i+r[15];return s=s||1,e[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/s,e[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/s,e[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/s,e}function Ob(e,t,r){let n=t[0],o=t[1],i=t[2];return e[0]=n*r[0]+o*r[3]+i*r[6],e[1]=n*r[1]+o*r[4]+i*r[7],e[2]=n*r[2]+o*r[5]+i*r[8],e}function Rb(e,t,r){let n=r[0],o=r[1],i=r[2],s=r[3],a=t[0],u=t[1],h=t[2],p=o*h-i*u,_=i*a-n*h,y=n*u-o*a,A=o*y-i*_,E=i*p-n*y,k=n*_-o*p,P=s*2;return p*=P,_*=P,y*=P,A*=2,E*=2,k*=2,e[0]=a+p+A,e[1]=u+_+E,e[2]=h+y+k,e}function aO(e,t,r,n){let o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function lO(e,t,r,n){let o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function cO(e,t,r,n){let o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function uO(e,t){let r=e[0],n=e[1],o=e[2],i=t[0],s=t[1],a=t[2],u=Math.sqrt((r*r+n*n+o*o)*(i*i+s*s+a*a)),h=u&&Pb(e,t)/u;return Math.acos(Math.min(Math.max(h,-1),1))}function Bve(e){return e[0]=0,e[1]=0,e[2]=0,e}function jve(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function Uve(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Vve(e,t){let r=e[0],n=e[1],o=e[2],i=t[0],s=t[1],a=t[2];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-s)<=1e-6*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-a)<=1e-6*Math.max(1,Math.abs(o),Math.abs(a))}var Wve=GW,Zve=HW,Yve=XW,qve=KW,Gve=$W,fO=qW,Hve=QW,Xve=function(){let e=WM();return function(t,r,n,o,i,s){let a,u;for(r||(r=3),n||(n=0),o?u=Math.min(o*r+n,t.length):u=t.length,a=n;a<u;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var hO=[0,0,0],YM,mr=class e extends r0{static get ZERO(){return YM||(YM=new e(0,0,0),Object.freeze(YM)),YM}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&cc(t)?this.copy(t):(_o.debug&&(ti(t),ti(r),ti(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return _o.debug&&(ti(t.x),ti(t.y),ti(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ti(t)}angle(t){return uO(this,t)}cross(t){return Lm(this,this,t),this.check()}rotateX({radians:t,origin:r=hO}){return aO(this,this,r,t),this.check()}rotateY({radians:t,origin:r=hO}){return lO(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=hO}){return cO(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Fm(this,this,t),this.check()}transformAsVector(t){return UM(this,this,t),this.check()}transformByMatrix3(t){return Ob(this,this,t),this.check()}transformByMatrix2(t){return ZW(this,this,t),this.check()}transformByQuaternion(t){return Rb(this,this,t),this.check()}};var qM,GM=class e extends r0{static get ZERO(){return qM||(qM=new e(0,0,0,0),Object.freeze(qM)),qM}constructor(t=0,r=0,n=0,o=0){super(-0,-0,-0,-0),cc(t)&&arguments.length===1?this.copy(t):(_o.debug&&(ti(t),ti(r),ti(n),ti(o)),this[0]=t,this[1]=r,this[2]=n,this[3]=o)}set(t,r,n,o){return this[0]=t,this[1]=r,this[2]=n,this[3]=o,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return _o.debug&&(ti(t.x),ti(t.y),ti(t.z),ti(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ti(t)}get w(){return this[3]}set w(t){this[3]=ti(t)}transform(t){return Fm(this,this,t),this.check()}transformByMatrix3(t){return VM(this,this,t),this.check()}transformByMatrix2(t){return YW(this,this,t),this.check()}transformByQuaternion(t){return Rb(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};var i0=class extends ud{toString(){let t="[";if(_o.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=ti(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let o=0;o<this.RANK;++o)r[o]=this[n+o];return r}setColumn(t,r){let n=t*this.RANK;for(let o=0;o<this.RANK;++o)this[n+o]=r[o];return this}};function JW(){let e=new xi(9);return xi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function eZ(e,t){if(e===t){let r=t[1],n=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function tZ(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],u=t[6],h=t[7],p=t[8],_=p*s-a*h,y=-p*i+a*u,A=h*i-s*u,E=r*_+n*y+o*A;return E?(E=1/E,e[0]=_*E,e[1]=(-p*n+o*h)*E,e[2]=(a*n-o*s)*E,e[3]=y*E,e[4]=(p*r-o*u)*E,e[5]=(-a*r+o*i)*E,e[6]=A*E,e[7]=(-h*r+n*u)*E,e[8]=(s*r-n*i)*E,e):null}function rZ(e){let t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],s=e[5],a=e[6],u=e[7],h=e[8];return t*(h*i-s*u)+r*(-h*o+s*a)+n*(u*o-i*a)}function dO(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],u=t[5],h=t[6],p=t[7],_=t[8],y=r[0],A=r[1],E=r[2],k=r[3],P=r[4],R=r[5],V=r[6],N=r[7],j=r[8];return e[0]=y*n+A*s+E*h,e[1]=y*o+A*a+E*p,e[2]=y*i+A*u+E*_,e[3]=k*n+P*s+R*h,e[4]=k*o+P*a+R*p,e[5]=k*i+P*u+R*_,e[6]=V*n+N*s+j*h,e[7]=V*o+N*a+j*p,e[8]=V*i+N*u+j*_,e}function nZ(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],u=t[5],h=t[6],p=t[7],_=t[8],y=r[0],A=r[1];return e[0]=n,e[1]=o,e[2]=i,e[3]=s,e[4]=a,e[5]=u,e[6]=y*n+A*s+h,e[7]=y*o+A*a+p,e[8]=y*i+A*u+_,e}function iZ(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],u=t[5],h=t[6],p=t[7],_=t[8],y=Math.sin(r),A=Math.cos(r);return e[0]=A*n+y*s,e[1]=A*o+y*a,e[2]=A*i+y*u,e[3]=A*s-y*n,e[4]=A*a-y*o,e[5]=A*u-y*i,e[6]=h,e[7]=p,e[8]=_,e}function pO(e,t,r){let n=r[0],o=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function oZ(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=r+r,a=n+n,u=o+o,h=r*s,p=n*s,_=n*a,y=o*s,A=o*a,E=o*u,k=i*s,P=i*a,R=i*u;return e[0]=1-_-E,e[3]=p-R,e[6]=y+P,e[1]=p+R,e[4]=1-h-E,e[7]=A-k,e[2]=y-P,e[5]=A+k,e[8]=1-h-_,e}var mO;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(mO||(mO={}));var Kve=Object.freeze([1,0,0,0,1,0,0,0,1]),Hi=class extends i0{static get IDENTITY(){return Qve()}static get ZERO(){return $ve()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return mO}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Kve)}fromObject(t){return this.check()}fromQuaternion(t){return oZ(this,t),this.check()}set(t,r,n,o,i,s,a,u,h){return this[0]=t,this[1]=r,this[2]=n,this[3]=o,this[4]=i,this[5]=s,this[6]=a,this[7]=u,this[8]=h,this.check()}setRowMajor(t,r,n,o,i,s,a,u,h){return this[0]=t,this[1]=o,this[2]=a,this[3]=r,this[4]=i,this[5]=u,this[6]=n,this[7]=s,this[8]=h,this.check()}determinant(){return rZ(this)}transpose(){return eZ(this,this),this.check()}invert(){return tZ(this,this),this.check()}multiplyLeft(t){return dO(this,t,this),this.check()}multiplyRight(t){return dO(this,this,t),this.check()}rotate(t){return iZ(this,this,t),this.check()}scale(t){return Array.isArray(t)?pO(this,this,t):pO(this,this,[t,t]),this.check()}translate(t){return nZ(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=iO(r||[-0,-0],t,this);break;case 3:n=Ob(r||[-0,-0,-0],t,this);break;case 4:n=VM(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fd(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},HM,XM=null;function $ve(){return HM||(HM=new Hi([0,0,0,0,0,0,0,0,0]),Object.freeze(HM)),HM}function Qve(){return XM||(XM=new Hi,Object.freeze(XM)),XM}var yo={};io(yo,{add:()=>A1e,adjoint:()=>i1e,clone:()=>e1e,copy:()=>t1e,create:()=>Jve,decompose:()=>p1e,determinant:()=>yO,equals:()=>E1e,exactEquals:()=>T1e,frob:()=>w1e,fromQuat:()=>SO,fromQuat2:()=>f1e,fromRotation:()=>a1e,fromRotationTranslation:()=>lZ,fromRotationTranslationScale:()=>m1e,fromRotationTranslationScaleOrigin:()=>g1e,fromScaling:()=>s1e,fromTranslation:()=>o1e,fromValues:()=>r1e,fromXRotation:()=>l1e,fromYRotation:()=>c1e,fromZRotation:()=>u1e,frustum:()=>TO,getRotation:()=>d1e,getScaling:()=>cZ,getTranslation:()=>h1e,identity:()=>aZ,invert:()=>_O,lookAt:()=>CO,mul:()=>I1e,multiply:()=>Nb,multiplyScalar:()=>M1e,multiplyScalarAndAdd:()=>S1e,ortho:()=>IO,orthoNO:()=>fZ,orthoZO:()=>x1e,perspective:()=>EO,perspectiveFromFieldOfView:()=>y1e,perspectiveNO:()=>uZ,perspectiveZO:()=>_1e,rotate:()=>vO,rotateX:()=>wO,rotateY:()=>AO,rotateZ:()=>MO,scale:()=>bO,set:()=>n1e,str:()=>v1e,sub:()=>C1e,subtract:()=>hZ,targetTo:()=>b1e,translate:()=>xO,transpose:()=>gO});function Jve(){let e=new xi(16);return xi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function e1e(e){let t=new xi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function t1e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function r1e(e,t,r,n,o,i,s,a,u,h,p,_,y,A,E,k){let P=new xi(16);return P[0]=e,P[1]=t,P[2]=r,P[3]=n,P[4]=o,P[5]=i,P[6]=s,P[7]=a,P[8]=u,P[9]=h,P[10]=p,P[11]=_,P[12]=y,P[13]=A,P[14]=E,P[15]=k,P}function n1e(e,t,r,n,o,i,s,a,u,h,p,_,y,A,E,k,P){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=s,e[6]=a,e[7]=u,e[8]=h,e[9]=p,e[10]=_,e[11]=y,e[12]=A,e[13]=E,e[14]=k,e[15]=P,e}function aZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gO(e,t){if(e===t){let r=t[1],n=t[2],o=t[3],i=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=o,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function _O(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],u=t[6],h=t[7],p=t[8],_=t[9],y=t[10],A=t[11],E=t[12],k=t[13],P=t[14],R=t[15],V=r*a-n*s,N=r*u-o*s,j=r*h-i*s,J=n*u-o*a,ne=n*h-i*a,de=o*h-i*u,fe=p*k-_*E,ye=p*P-y*E,ve=p*R-A*E,be=_*P-y*k,je=_*R-A*k,Re=y*R-A*P,Se=V*Re-N*je+j*be+J*ve-ne*ye+de*fe;return Se?(Se=1/Se,e[0]=(a*Re-u*je+h*be)*Se,e[1]=(o*je-n*Re-i*be)*Se,e[2]=(k*de-P*ne+R*J)*Se,e[3]=(y*ne-_*de-A*J)*Se,e[4]=(u*ve-s*Re-h*ye)*Se,e[5]=(r*Re-o*ve+i*ye)*Se,e[6]=(P*j-E*de-R*N)*Se,e[7]=(p*de-y*j+A*N)*Se,e[8]=(s*je-a*ve+h*fe)*Se,e[9]=(n*ve-r*je-i*fe)*Se,e[10]=(E*ne-k*j+R*V)*Se,e[11]=(_*j-p*ne-A*V)*Se,e[12]=(a*ye-s*be-u*fe)*Se,e[13]=(r*be-n*ye+o*fe)*Se,e[14]=(k*N-E*J-P*V)*Se,e[15]=(p*J-_*N+y*V)*Se,e):null}function i1e(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],u=t[6],h=t[7],p=t[8],_=t[9],y=t[10],A=t[11],E=t[12],k=t[13],P=t[14],R=t[15],V=r*a-n*s,N=r*u-o*s,j=r*h-i*s,J=n*u-o*a,ne=n*h-i*a,de=o*h-i*u,fe=p*k-_*E,ye=p*P-y*E,ve=p*R-A*E,be=_*P-y*k,je=_*R-A*k,Re=y*R-A*P;return e[0]=a*Re-u*je+h*be,e[1]=o*je-n*Re-i*be,e[2]=k*de-P*ne+R*J,e[3]=y*ne-_*de-A*J,e[4]=u*ve-s*Re-h*ye,e[5]=r*Re-o*ve+i*ye,e[6]=P*j-E*de-R*N,e[7]=p*de-y*j+A*N,e[8]=s*je-a*ve+h*fe,e[9]=n*ve-r*je-i*fe,e[10]=E*ne-k*j+R*V,e[11]=_*j-p*ne-A*V,e[12]=a*ye-s*be-u*fe,e[13]=r*be-n*ye+o*fe,e[14]=k*N-E*J-P*V,e[15]=p*J-_*N+y*V,e}function yO(e){let t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],s=e[5],a=e[6],u=e[7],h=e[8],p=e[9],_=e[10],y=e[11],A=e[12],E=e[13],k=e[14],P=e[15],R=t*s-r*i,V=t*a-n*i,N=r*a-n*s,j=h*E-p*A,J=h*k-_*A,ne=p*k-_*E,de=t*ne-r*J+n*j,fe=i*ne-s*J+a*j,ye=h*N-p*V+_*R,ve=A*N-E*V+k*R;return u*de-o*fe+P*ye-y*ve}function Nb(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],u=t[5],h=t[6],p=t[7],_=t[8],y=t[9],A=t[10],E=t[11],k=t[12],P=t[13],R=t[14],V=t[15],N=r[0],j=r[1],J=r[2],ne=r[3];return e[0]=N*n+j*a+J*_+ne*k,e[1]=N*o+j*u+J*y+ne*P,e[2]=N*i+j*h+J*A+ne*R,e[3]=N*s+j*p+J*E+ne*V,N=r[4],j=r[5],J=r[6],ne=r[7],e[4]=N*n+j*a+J*_+ne*k,e[5]=N*o+j*u+J*y+ne*P,e[6]=N*i+j*h+J*A+ne*R,e[7]=N*s+j*p+J*E+ne*V,N=r[8],j=r[9],J=r[10],ne=r[11],e[8]=N*n+j*a+J*_+ne*k,e[9]=N*o+j*u+J*y+ne*P,e[10]=N*i+j*h+J*A+ne*R,e[11]=N*s+j*p+J*E+ne*V,N=r[12],j=r[13],J=r[14],ne=r[15],e[12]=N*n+j*a+J*_+ne*k,e[13]=N*o+j*u+J*y+ne*P,e[14]=N*i+j*h+J*A+ne*R,e[15]=N*s+j*p+J*E+ne*V,e}function xO(e,t,r){let n=r[0],o=r[1],i=r[2],s,a,u,h,p,_,y,A,E,k,P,R;return t===e?(e[12]=t[0]*n+t[4]*o+t[8]*i+t[12],e[13]=t[1]*n+t[5]*o+t[9]*i+t[13],e[14]=t[2]*n+t[6]*o+t[10]*i+t[14],e[15]=t[3]*n+t[7]*o+t[11]*i+t[15]):(s=t[0],a=t[1],u=t[2],h=t[3],p=t[4],_=t[5],y=t[6],A=t[7],E=t[8],k=t[9],P=t[10],R=t[11],e[0]=s,e[1]=a,e[2]=u,e[3]=h,e[4]=p,e[5]=_,e[6]=y,e[7]=A,e[8]=E,e[9]=k,e[10]=P,e[11]=R,e[12]=s*n+p*o+E*i+t[12],e[13]=a*n+_*o+k*i+t[13],e[14]=u*n+y*o+P*i+t[14],e[15]=h*n+A*o+R*i+t[15]),e}function bO(e,t,r){let n=r[0],o=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vO(e,t,r,n){let o=n[0],i=n[1],s=n[2],a=Math.sqrt(o*o+i*i+s*s),u,h,p,_,y,A,E,k,P,R,V,N,j,J,ne,de,fe,ye,ve,be,je,Re,Se,Ue;return a<1e-6?null:(a=1/a,o*=a,i*=a,s*=a,h=Math.sin(r),u=Math.cos(r),p=1-u,_=t[0],y=t[1],A=t[2],E=t[3],k=t[4],P=t[5],R=t[6],V=t[7],N=t[8],j=t[9],J=t[10],ne=t[11],de=o*o*p+u,fe=i*o*p+s*h,ye=s*o*p-i*h,ve=o*i*p-s*h,be=i*i*p+u,je=s*i*p+o*h,Re=o*s*p+i*h,Se=i*s*p-o*h,Ue=s*s*p+u,e[0]=_*de+k*fe+N*ye,e[1]=y*de+P*fe+j*ye,e[2]=A*de+R*fe+J*ye,e[3]=E*de+V*fe+ne*ye,e[4]=_*ve+k*be+N*je,e[5]=y*ve+P*be+j*je,e[6]=A*ve+R*be+J*je,e[7]=E*ve+V*be+ne*je,e[8]=_*Re+k*Se+N*Ue,e[9]=y*Re+P*Se+j*Ue,e[10]=A*Re+R*Se+J*Ue,e[11]=E*Re+V*Se+ne*Ue,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function wO(e,t,r){let n=Math.sin(r),o=Math.cos(r),i=t[4],s=t[5],a=t[6],u=t[7],h=t[8],p=t[9],_=t[10],y=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*o+h*n,e[5]=s*o+p*n,e[6]=a*o+_*n,e[7]=u*o+y*n,e[8]=h*o-i*n,e[9]=p*o-s*n,e[10]=_*o-a*n,e[11]=y*o-u*n,e}function AO(e,t,r){let n=Math.sin(r),o=Math.cos(r),i=t[0],s=t[1],a=t[2],u=t[3],h=t[8],p=t[9],_=t[10],y=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o-h*n,e[1]=s*o-p*n,e[2]=a*o-_*n,e[3]=u*o-y*n,e[8]=i*n+h*o,e[9]=s*n+p*o,e[10]=a*n+_*o,e[11]=u*n+y*o,e}function MO(e,t,r){let n=Math.sin(r),o=Math.cos(r),i=t[0],s=t[1],a=t[2],u=t[3],h=t[4],p=t[5],_=t[6],y=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o+h*n,e[1]=s*o+p*n,e[2]=a*o+_*n,e[3]=u*o+y*n,e[4]=h*o-i*n,e[5]=p*o-s*n,e[6]=_*o-a*n,e[7]=y*o-u*n,e}function o1e(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function s1e(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a1e(e,t,r){let n=r[0],o=r[1],i=r[2],s=Math.sqrt(n*n+o*o+i*i),a,u,h;return s<1e-6?null:(s=1/s,n*=s,o*=s,i*=s,u=Math.sin(t),a=Math.cos(t),h=1-a,e[0]=n*n*h+a,e[1]=o*n*h+i*u,e[2]=i*n*h-o*u,e[3]=0,e[4]=n*o*h-i*u,e[5]=o*o*h+a,e[6]=i*o*h+n*u,e[7]=0,e[8]=n*i*h+o*u,e[9]=o*i*h-n*u,e[10]=i*i*h+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function l1e(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c1e(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u1e(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lZ(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=n+n,u=o+o,h=i+i,p=n*a,_=n*u,y=n*h,A=o*u,E=o*h,k=i*h,P=s*a,R=s*u,V=s*h;return e[0]=1-(A+k),e[1]=_+V,e[2]=y-R,e[3]=0,e[4]=_-V,e[5]=1-(p+k),e[6]=E+P,e[7]=0,e[8]=y+R,e[9]=E-P,e[10]=1-(p+A),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function f1e(e,t){let r=new xi(3),n=-t[0],o=-t[1],i=-t[2],s=t[3],a=t[4],u=t[5],h=t[6],p=t[7],_=n*n+o*o+i*i+s*s;return _>0?(r[0]=(a*s+p*n+u*i-h*o)*2/_,r[1]=(u*s+p*o+h*n-a*i)*2/_,r[2]=(h*s+p*i+a*o-u*n)*2/_):(r[0]=(a*s+p*n+u*i-h*o)*2,r[1]=(u*s+p*o+h*n-a*i)*2,r[2]=(h*s+p*i+a*o-u*n)*2),lZ(e,t,r),e}function h1e(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function cZ(e,t){let r=t[0],n=t[1],o=t[2],i=t[4],s=t[5],a=t[6],u=t[8],h=t[9],p=t[10];return e[0]=Math.sqrt(r*r+n*n+o*o),e[1]=Math.sqrt(i*i+s*s+a*a),e[2]=Math.sqrt(u*u+h*h+p*p),e}function d1e(e,t){let r=new xi(3);cZ(r,t);let n=1/r[0],o=1/r[1],i=1/r[2],s=t[0]*n,a=t[1]*o,u=t[2]*i,h=t[4]*n,p=t[5]*o,_=t[6]*i,y=t[8]*n,A=t[9]*o,E=t[10]*i,k=s+p+E,P=0;return k>0?(P=Math.sqrt(k+1)*2,e[3]=.25*P,e[0]=(_-A)/P,e[1]=(y-u)/P,e[2]=(a-h)/P):s>p&&s>E?(P=Math.sqrt(1+s-p-E)*2,e[3]=(_-A)/P,e[0]=.25*P,e[1]=(a+h)/P,e[2]=(y+u)/P):p>E?(P=Math.sqrt(1+p-s-E)*2,e[3]=(y-u)/P,e[0]=(a+h)/P,e[1]=.25*P,e[2]=(_+A)/P):(P=Math.sqrt(1+E-s-p)*2,e[3]=(a-h)/P,e[0]=(y+u)/P,e[1]=(_+A)/P,e[2]=.25*P),e}function p1e(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let o=n[0],i=n[1],s=n[2],a=n[4],u=n[5],h=n[6],p=n[8],_=n[9],y=n[10];r[0]=Math.sqrt(o*o+i*i+s*s),r[1]=Math.sqrt(a*a+u*u+h*h),r[2]=Math.sqrt(p*p+_*_+y*y);let A=1/r[0],E=1/r[1],k=1/r[2],P=o*A,R=i*E,V=s*k,N=a*A,j=u*E,J=h*k,ne=p*A,de=_*E,fe=y*k,ye=P+j+fe,ve=0;return ye>0?(ve=Math.sqrt(ye+1)*2,e[3]=.25*ve,e[0]=(J-de)/ve,e[1]=(ne-V)/ve,e[2]=(R-N)/ve):P>j&&P>fe?(ve=Math.sqrt(1+P-j-fe)*2,e[3]=(J-de)/ve,e[0]=.25*ve,e[1]=(R+N)/ve,e[2]=(ne+V)/ve):j>fe?(ve=Math.sqrt(1+j-P-fe)*2,e[3]=(ne-V)/ve,e[0]=(R+N)/ve,e[1]=.25*ve,e[2]=(J+de)/ve):(ve=Math.sqrt(1+fe-P-j)*2,e[3]=(R-N)/ve,e[0]=(ne+V)/ve,e[1]=(J+de)/ve,e[2]=.25*ve),e}function m1e(e,t,r,n){let o=t[0],i=t[1],s=t[2],a=t[3],u=o+o,h=i+i,p=s+s,_=o*u,y=o*h,A=o*p,E=i*h,k=i*p,P=s*p,R=a*u,V=a*h,N=a*p,j=n[0],J=n[1],ne=n[2];return e[0]=(1-(E+P))*j,e[1]=(y+N)*j,e[2]=(A-V)*j,e[3]=0,e[4]=(y-N)*J,e[5]=(1-(_+P))*J,e[6]=(k+R)*J,e[7]=0,e[8]=(A+V)*ne,e[9]=(k-R)*ne,e[10]=(1-(_+E))*ne,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function g1e(e,t,r,n,o){let i=t[0],s=t[1],a=t[2],u=t[3],h=i+i,p=s+s,_=a+a,y=i*h,A=i*p,E=i*_,k=s*p,P=s*_,R=a*_,V=u*h,N=u*p,j=u*_,J=n[0],ne=n[1],de=n[2],fe=o[0],ye=o[1],ve=o[2],be=(1-(k+R))*J,je=(A+j)*J,Re=(E-N)*J,Se=(A-j)*ne,Ue=(1-(y+R))*ne,qe=(P+V)*ne,Je=(E+N)*de,gt=(P-V)*de,rt=(1-(y+k))*de;return e[0]=be,e[1]=je,e[2]=Re,e[3]=0,e[4]=Se,e[5]=Ue,e[6]=qe,e[7]=0,e[8]=Je,e[9]=gt,e[10]=rt,e[11]=0,e[12]=r[0]+fe-(be*fe+Se*ye+Je*ve),e[13]=r[1]+ye-(je*fe+Ue*ye+gt*ve),e[14]=r[2]+ve-(Re*fe+qe*ye+rt*ve),e[15]=1,e}function SO(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=r+r,a=n+n,u=o+o,h=r*s,p=n*s,_=n*a,y=o*s,A=o*a,E=o*u,k=i*s,P=i*a,R=i*u;return e[0]=1-_-E,e[1]=p+R,e[2]=y-P,e[3]=0,e[4]=p-R,e[5]=1-h-E,e[6]=A+k,e[7]=0,e[8]=y+P,e[9]=A-k,e[10]=1-h-_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function TO(e,t,r,n,o,i,s){let a=1/(r-t),u=1/(o-n),h=1/(i-s);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*u,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(o+n)*u,e[10]=(s+i)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*i*2*h,e[15]=0,e}function uZ(e,t,r,n,o){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0){let s=1/(n-o);e[10]=(o+n)*s,e[14]=2*o*n*s}else e[10]=-1,e[14]=-2*n;return e}var EO=uZ;function _1e(e,t,r,n,o){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0){let s=1/(n-o);e[10]=o*s,e[14]=o*n*s}else e[10]=-1,e[14]=-n;return e}function y1e(e,t,r,n){let o=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),u=2/(s+a),h=2/(o+i);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((s-a)*u*.5),e[9]=(o-i)*h*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function fZ(e,t,r,n,o,i,s){let a=1/(t-r),u=1/(n-o),h=1/(i-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*a,e[13]=(o+n)*u,e[14]=(s+i)*h,e[15]=1,e}var IO=fZ;function x1e(e,t,r,n,o,i,s){let a=1/(t-r),u=1/(n-o),h=1/(i-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+r)*a,e[13]=(o+n)*u,e[14]=i*h,e[15]=1,e}function CO(e,t,r,n){let o,i,s,a,u,h,p,_,y,A,E=t[0],k=t[1],P=t[2],R=n[0],V=n[1],N=n[2],j=r[0],J=r[1],ne=r[2];return Math.abs(E-j)<1e-6&&Math.abs(k-J)<1e-6&&Math.abs(P-ne)<1e-6?aZ(e):(_=E-j,y=k-J,A=P-ne,o=1/Math.sqrt(_*_+y*y+A*A),_*=o,y*=o,A*=o,i=V*A-N*y,s=N*_-R*A,a=R*y-V*_,o=Math.sqrt(i*i+s*s+a*a),o?(o=1/o,i*=o,s*=o,a*=o):(i=0,s=0,a=0),u=y*a-A*s,h=A*i-_*a,p=_*s-y*i,o=Math.sqrt(u*u+h*h+p*p),o?(o=1/o,u*=o,h*=o,p*=o):(u=0,h=0,p=0),e[0]=i,e[1]=u,e[2]=_,e[3]=0,e[4]=s,e[5]=h,e[6]=y,e[7]=0,e[8]=a,e[9]=p,e[10]=A,e[11]=0,e[12]=-(i*E+s*k+a*P),e[13]=-(u*E+h*k+p*P),e[14]=-(_*E+y*k+A*P),e[15]=1,e)}function b1e(e,t,r,n){let o=t[0],i=t[1],s=t[2],a=n[0],u=n[1],h=n[2],p=o-r[0],_=i-r[1],y=s-r[2],A=p*p+_*_+y*y;A>0&&(A=1/Math.sqrt(A),p*=A,_*=A,y*=A);let E=u*y-h*_,k=h*p-a*y,P=a*_-u*p;return A=E*E+k*k+P*P,A>0&&(A=1/Math.sqrt(A),E*=A,k*=A,P*=A),e[0]=E,e[1]=k,e[2]=P,e[3]=0,e[4]=_*P-y*k,e[5]=y*E-p*P,e[6]=p*k-_*E,e[7]=0,e[8]=p,e[9]=_,e[10]=y,e[11]=0,e[12]=o,e[13]=i,e[14]=s,e[15]=1,e}function v1e(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function w1e(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function A1e(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function hZ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function M1e(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function S1e(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function T1e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function E1e(e,t){let r=e[0],n=e[1],o=e[2],i=e[3],s=e[4],a=e[5],u=e[6],h=e[7],p=e[8],_=e[9],y=e[10],A=e[11],E=e[12],k=e[13],P=e[14],R=e[15],V=t[0],N=t[1],j=t[2],J=t[3],ne=t[4],de=t[5],fe=t[6],ye=t[7],ve=t[8],be=t[9],je=t[10],Re=t[11],Se=t[12],Ue=t[13],qe=t[14],Je=t[15];return Math.abs(r-V)<=1e-6*Math.max(1,Math.abs(r),Math.abs(V))&&Math.abs(n-N)<=1e-6*Math.max(1,Math.abs(n),Math.abs(N))&&Math.abs(o-j)<=1e-6*Math.max(1,Math.abs(o),Math.abs(j))&&Math.abs(i-J)<=1e-6*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(s-ne)<=1e-6*Math.max(1,Math.abs(s),Math.abs(ne))&&Math.abs(a-de)<=1e-6*Math.max(1,Math.abs(a),Math.abs(de))&&Math.abs(u-fe)<=1e-6*Math.max(1,Math.abs(u),Math.abs(fe))&&Math.abs(h-ye)<=1e-6*Math.max(1,Math.abs(h),Math.abs(ye))&&Math.abs(p-ve)<=1e-6*Math.max(1,Math.abs(p),Math.abs(ve))&&Math.abs(_-be)<=1e-6*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(y-je)<=1e-6*Math.max(1,Math.abs(y),Math.abs(je))&&Math.abs(A-Re)<=1e-6*Math.max(1,Math.abs(A),Math.abs(Re))&&Math.abs(E-Se)<=1e-6*Math.max(1,Math.abs(E),Math.abs(Se))&&Math.abs(k-Ue)<=1e-6*Math.max(1,Math.abs(k),Math.abs(Ue))&&Math.abs(P-qe)<=1e-6*Math.max(1,Math.abs(P),Math.abs(qe))&&Math.abs(R-Je)<=1e-6*Math.max(1,Math.abs(R),Math.abs(Je))}var I1e=Nb,C1e=hZ;var Ta={};io(Ta,{add:()=>kO,ceil:()=>k1e,clone:()=>pZ,copy:()=>gZ,create:()=>dZ,cross:()=>F1e,dist:()=>q1e,distance:()=>vZ,div:()=>Y1e,divide:()=>bZ,dot:()=>RO,equals:()=>V1e,exactEquals:()=>AZ,floor:()=>P1e,forEach:()=>K1e,fromValues:()=>mZ,inverse:()=>L1e,len:()=>H1e,length:()=>KM,lerp:()=>NO,max:()=>R1e,min:()=>O1e,mul:()=>Z1e,multiply:()=>xZ,negate:()=>D1e,normalize:()=>OO,random:()=>B1e,round:()=>N1e,scale:()=>PO,scaleAndAdd:()=>z1e,set:()=>_Z,sqrDist:()=>G1e,sqrLen:()=>X1e,squaredDistance:()=>wZ,squaredLength:()=>$M,str:()=>U1e,sub:()=>W1e,subtract:()=>yZ,transformMat4:()=>zO,transformQuat:()=>DO,zero:()=>j1e});function dZ(){let e=new xi(4);return xi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function pZ(e){let t=new xi(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function mZ(e,t,r,n){let o=new xi(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=n,o}function gZ(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function _Z(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e}function kO(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function yZ(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function xZ(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function bZ(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function k1e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function P1e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function O1e(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function R1e(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function N1e(e,t){return e[0]=Il(t[0]),e[1]=Il(t[1]),e[2]=Il(t[2]),e[3]=Il(t[3]),e}function PO(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function z1e(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function vZ(e,t){let r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+n*n+o*o+i*i)}function wZ(e,t){let r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+o*o+i*i}function KM(e){let t=e[0],r=e[1],n=e[2],o=e[3];return Math.sqrt(t*t+r*r+n*n+o*o)}function $M(e){let t=e[0],r=e[1],n=e[2],o=e[3];return t*t+r*r+n*n+o*o}function D1e(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function L1e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function OO(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=r*r+n*n+o*o+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e[2]=o*s,e[3]=i*s,e}function RO(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function F1e(e,t,r,n){let o=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],h=r[2]*n[3]-r[3]*n[2],p=t[0],_=t[1],y=t[2],A=t[3];return e[0]=_*h-y*u+A*a,e[1]=-(p*h)+y*s-A*i,e[2]=p*u-_*s+A*o,e[3]=-(p*a)+_*i-y*o,e}function NO(e,t,r,n){let o=t[0],i=t[1],s=t[2],a=t[3];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=s+n*(r[2]-s),e[3]=a+n*(r[3]-a),e}function B1e(e,t){t=t===void 0?1:t;let r,n,o,i,s,a;do r=fu()*2-1,n=fu()*2-1,s=r*r+n*n;while(s>=1);do o=fu()*2-1,i=fu()*2-1,a=o*o+i*i;while(a>=1);let u=Math.sqrt((1-s)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*o*u,e[3]=t*i*u,e}function zO(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3];return e[0]=r[0]*n+r[4]*o+r[8]*i+r[12]*s,e[1]=r[1]*n+r[5]*o+r[9]*i+r[13]*s,e[2]=r[2]*n+r[6]*o+r[10]*i+r[14]*s,e[3]=r[3]*n+r[7]*o+r[11]*i+r[15]*s,e}function DO(e,t,r){let n=t[0],o=t[1],i=t[2],s=r[0],a=r[1],u=r[2],h=r[3],p=h*n+a*i-u*o,_=h*o+u*n-s*i,y=h*i+s*o-a*n,A=-s*n-a*o-u*i;return e[0]=p*h+A*-s+_*-u-y*-a,e[1]=_*h+A*-a+y*-s-p*-u,e[2]=y*h+A*-u+p*-a-_*-s,e[3]=t[3],e}function j1e(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function U1e(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function AZ(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function V1e(e,t){let r=e[0],n=e[1],o=e[2],i=e[3],s=t[0],a=t[1],u=t[2],h=t[3];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(o-u)<=1e-6*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-h)<=1e-6*Math.max(1,Math.abs(i),Math.abs(h))}var W1e=yZ,Z1e=xZ,Y1e=bZ,q1e=vZ,G1e=wZ,H1e=KM,X1e=$M,K1e=function(){let e=dZ();return function(t,r,n,o,i,s){let a,u;for(r||(r=4),n||(n=0),o?u=Math.min(o*r+n,t.length):u=t.length,a=n;a<u;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var BO;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(BO||(BO={}));var $1e=45*Math.PI/180,Q1e=1,LO=.1,FO=500,J1e=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ci=class extends i0{static get IDENTITY(){return twe()}static get ZERO(){return ewe()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return BO}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,o,i,s,a,u,h,p,_,y,A,E,k,P){return this[0]=t,this[1]=r,this[2]=n,this[3]=o,this[4]=i,this[5]=s,this[6]=a,this[7]=u,this[8]=h,this[9]=p,this[10]=_,this[11]=y,this[12]=A,this[13]=E,this[14]=k,this[15]=P,this.check()}setRowMajor(t,r,n,o,i,s,a,u,h,p,_,y,A,E,k,P){return this[0]=t,this[1]=i,this[2]=h,this[3]=A,this[4]=r,this[5]=s,this[6]=p,this[7]=E,this[8]=n,this[9]=a,this[10]=_,this[11]=k,this[12]=o,this[13]=u,this[14]=y,this[15]=P,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(J1e)}fromObject(t){return this.check()}fromQuaternion(t){return SO(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:o,top:i,near:s=LO,far:a=FO}=t;return a===1/0?rwe(this,r,n,o,i,s):TO(this,r,n,o,i,s,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:o=[0,1,0]}=t;return CO(this,r,n,o),this.check()}ortho(t){let{left:r,right:n,bottom:o,top:i,near:s=LO,far:a=FO}=t;return IO(this,r,n,o,i,s,a),this.check()}orthographic(t){let{fovy:r=$1e,aspect:n=Q1e,focalDistance:o=1,near:i=LO,far:s=FO}=t;MZ(r);let a=r/2,u=o*Math.tan(a),h=u*n;return this.ortho({left:-h,right:h,bottom:-u,top:u,near:i,far:s})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:o=.1,far:i=500}=t;return MZ(r),EO(this,r,n,o,i),this.check()}determinant(){return yO(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),o=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*o,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=0,t[4]=this[4]*o,t[5]=this[5]*i,t[6]=this[6]*s,t[7]=0,t[8]=this[8]*o,t[9]=this[9]*i,t[10]=this[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),o=1/n[0],i=1/n[1],s=1/n[2];return t[0]=this[0]*o,t[1]=this[1]*i,t[2]=this[2]*s,t[3]=this[4]*o,t[4]=this[5]*i,t[5]=this[6]*s,t[6]=this[8]*o,t[7]=this[9]*i,t[8]=this[10]*s,t}transpose(){return gO(this,this),this.check()}invert(){return _O(this,this),this.check()}multiplyLeft(t){return Nb(this,t,this),this.check()}multiplyRight(t){return Nb(this,this,t),this.check()}rotateX(t){return wO(this,this,t),this.check()}rotateY(t){return AO(this,this,t),this.check()}rotateZ(t){return MO(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return vO(this,this,t,r),this.check()}scale(t){return bO(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return xO(this,this,t),this.check()}transform(t,r){return t.length===4?(r=zO(r||[-0,-0,-0,-0],t,this),fd(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,o;switch(n){case 2:o=oO(r||[-0,-0],t,this);break;case 3:o=Fm(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fd(o,t.length),o}transformAsVector(t,r){let n;switch(t.length){case 2:n=WW(r||[-0,-0],t,this);break;case 3:n=UM(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fd(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},QM,JM;function ewe(){return QM||(QM=new Ci([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(QM)),QM}function twe(){return JM||(JM=new Ci,Object.freeze(JM)),JM}function MZ(e){if(e>Math.PI*2)throw Error("expected radians")}function rwe(e,t,r,n,o,i){let s=2*i/(r-t),a=2*i/(o-n),u=(r+t)/(r-t),h=(o+n)/(o-n),p=-1,_=-1,y=-2*i;return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=u,e[9]=h,e[10]=p,e[11]=_,e[12]=0,e[13]=0,e[14]=y,e[15]=0,e}function SZ(){let e=new xi(4);return xi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function TZ(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function jO(e,t,r){r=r*.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function UO(e,t,r){let n=t[0],o=t[1],i=t[2],s=t[3],a=r[0],u=r[1],h=r[2],p=r[3];return e[0]=n*p+s*a+o*h-i*u,e[1]=o*p+s*u+i*a-n*h,e[2]=i*p+s*h+n*u-o*a,e[3]=s*p-n*a-o*u-i*h,e}function EZ(e,t,r){r*=.5;let n=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+s*a,e[1]=o*u+i*a,e[2]=i*u-o*a,e[3]=s*u-n*a,e}function IZ(e,t,r){r*=.5;let n=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u-i*a,e[1]=o*u+s*a,e[2]=i*u+n*a,e[3]=s*u-o*a,e}function CZ(e,t,r){r*=.5;let n=t[0],o=t[1],i=t[2],s=t[3],a=Math.sin(r),u=Math.cos(r);return e[0]=n*u+o*a,e[1]=o*u-n*a,e[2]=i*u+s*a,e[3]=s*u-i*a,e}function kZ(e,t){let r=t[0],n=t[1],o=t[2];return e[0]=r,e[1]=n,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-o*o)),e}function zb(e,t,r,n){let o=t[0],i=t[1],s=t[2],a=t[3],u=r[0],h=r[1],p=r[2],_=r[3],y,A,E,k,P;return y=o*u+i*h+s*p+a*_,y<0&&(y=-y,u=-u,h=-h,p=-p,_=-_),1-y>1e-6?(A=Math.acos(y),P=Math.sin(A),E=Math.sin((1-n)*A)/P,k=Math.sin(n*A)/P):(E=1-n,k=n),e[0]=E*o+k*u,e[1]=E*i+k*h,e[2]=E*s+k*p,e[3]=E*a+k*_,e}function PZ(e,t){let r=t[0],n=t[1],o=t[2],i=t[3],s=r*r+n*n+o*o+i*i,a=s?1/s:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-o*a,e[3]=i*a,e}function OZ(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function VO(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let o=0;t[4]>t[0]&&(o=1),t[8]>t[o*3+o]&&(o=2);let i=(o+1)%3,s=(o+2)%3;n=Math.sqrt(t[o*3+o]-t[i*3+i]-t[s*3+s]+1),e[o]=.5*n,n=.5/n,e[3]=(t[i*3+s]-t[s*3+i])*n,e[i]=(t[i*3+o]+t[o*3+i])*n,e[s]=(t[s*3+o]+t[o*3+s])*n}return e}var RZ=kO;var NZ=PO,zZ=RO,DZ=NO,LZ=KM;var FZ=$M;var BZ=OO;var jZ=function(){let e=WM(),t=ZM(1,0,0),r=ZM(0,1,0);return function(n,o,i){let s=Pb(o,i);return s<-.999999?(Lm(e,t,o),fO(e)<1e-6&&Lm(e,r,o),sO(e,e),jO(n,e,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Lm(e,o,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+s,BZ(n,n))}}(),LZe=function(){let e=SZ(),t=SZ();return function(r,n,o,i,s,a){return zb(e,n,s,a),zb(t,o,i,a),zb(r,e,t,2*a*(1-a)),r}}(),FZe=function(){let e=JW();return function(t,r,n,o){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],BZ(t,VO(t,e))}}();var iwe=[0,0,0,1],o0=class extends ud{constructor(t=0,r=0,n=0,o=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,o)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,o){return this[0]=t,this[1]=r,this[2]=n,this[3]=o,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return VO(this,t),this.check()}fromAxisRotation(t,r){return jO(this,t,r),this.check()}identity(){return TZ(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=ti(t)}get y(){return this[1]}set y(t){this[1]=ti(t)}get z(){return this[2]}set z(t){this[2]=ti(t)}get w(){return this[3]}set w(t){this[3]=ti(t)}len(){return LZ(this)}lengthSquared(){return FZ(this)}dot(t){return zZ(this,t)}rotationTo(t,r){return jZ(this,t,r),this.check()}add(t){return RZ(this,this,t),this.check()}calculateW(){return kZ(this,this),this.check()}conjugate(){return OZ(this,this),this.check()}invert(){return PZ(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(DZ(this,t,r,n),this.check())}multiplyRight(t){return UO(this,this,t),this.check()}multiplyLeft(t){return UO(this,t,this),this.check()}normalize(){let t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return EZ(this,this,t),this.check()}rotateY(t){return IZ(this,this,t),this.check()}rotateZ(t){return CZ(this,this,t),this.check()}scale(t){return NZ(this,this,t),this.check()}slerp(t,r,n){let o,i,s;switch(arguments.length){case 1:({start:o=iwe,target:i,ratio:s}=t);break;case 2:o=this,i=t,s=r;break;default:o=t,i=r,s=n}return zb(this,o,i,s),this.check()}transformVector4(t,r=new GM){return DO(r,t,this),fd(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};var Db={};io(Db,{EPSILON1:()=>owe,EPSILON10:()=>pwe,EPSILON11:()=>mwe,EPSILON12:()=>gwe,EPSILON13:()=>_we,EPSILON14:()=>ywe,EPSILON15:()=>xwe,EPSILON16:()=>bwe,EPSILON17:()=>vwe,EPSILON18:()=>wwe,EPSILON19:()=>Awe,EPSILON2:()=>swe,EPSILON20:()=>Mwe,EPSILON3:()=>awe,EPSILON4:()=>lwe,EPSILON5:()=>cwe,EPSILON6:()=>uwe,EPSILON7:()=>fwe,EPSILON8:()=>hwe,EPSILON9:()=>dwe,PI_OVER_FOUR:()=>Twe,PI_OVER_SIX:()=>Ewe,PI_OVER_TWO:()=>Swe,TWO_PI:()=>Iwe});var owe=.1,swe=.01,awe=.001,lwe=1e-4,cwe=1e-5,uwe=1e-6,fwe=1e-7,hwe=1e-8,dwe=1e-9,pwe=1e-10,mwe=1e-11,gwe=1e-12,_we=1e-13,ywe=1e-14,xwe=1e-15,bwe=1e-16,vwe=1e-17,wwe=1e-18,Awe=1e-19,Mwe=1e-20,Swe=Math.PI/2,Twe=Math.PI/4,Ewe=Math.PI/6,Iwe=Math.PI*2;var WO=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`;var Cwe={lightSources:{}};function ZO(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/255)}function kwe({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let n={};return e?n["lighting_uAmbientLight.color"]=ZO(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,i)=>{n[`lighting_uPointLight[${i}].color`]=ZO(o),n[`lighting_uPointLight[${i}].position`]=o.position,n[`lighting_uPointLight[${i}].attenuation`]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((o,i)=>{n[`lighting_uDirectionalLight[${i}].color`]=ZO(o),n[`lighting_uDirectionalLight[${i}].direction`]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function UZ(e=Cwe){if("lightSources"in e){let{ambientLight:t,pointLights:r,directionalLights:n}=e.lightSources||{};return t||r&&r.length>0||n&&n.length>0?Object.assign({},kwe({ambientLight:t,pointLights:r,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){let t={pointLights:[],directionalLights:[]};for(let r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break;default:}return UZ({lightSources:t})}return{}}var VZ={name:"lights",vs:WO,fs:WO,getUniforms:UZ,defines:{MAX_LIGHTS:3}};var WZ=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`;var Pwe={};function Owe(e){let{ambient:t=.35,diffuse:r=.6,shininess:n=32,specularColor:o=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:n,lighting_uSpecularColor:o.map(i=>i/255)}}function Rwe(e=Pwe){if(!("material"in e))return{};let{material:t}=e;return t?Owe(t):{lighting_uEnabled:!1}}var Lb={name:"gouraud-lighting",dependencies:[VZ],vs:WZ,defines:{LIGHTING_VERTEX:1},getUniforms:Rwe};var YZ="#define SMOOTH_EDGE_RADIUS 0.5",Nwe=`
${YZ}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,zwe=`
${YZ}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,qZ={name:"geometry",vs:Nwe,fs:zwe};var Mn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Mn,"IDENTITY",{get:()=>(Vr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Ds={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},$a={common:0,meters:1,pixels:2},Fb={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};var Dwe=Object.keys(Mn).map(e=>`const int COORDINATE_SYSTEM_${e} = ${Mn[e]};`).join(""),Lwe=Object.keys(Ds).map(e=>`const int PROJECTION_MODE_${e} = ${Ds[e]};`).join(""),Fwe=Object.keys($a).map(e=>`const int UNIT_${e.toUpperCase()} = ${$a[e]};`).join(""),GZ=`${Dwe}
${Lwe}
${Fwe}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function Bwe(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function du(e){let t={},r;return n=>{for(let o in n)if(!Bwe(n[o],t[o])){r=e(n),t=n;break}return r}}var HZ=[0,0,0,0],jwe=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],XZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Uwe=[0,0,0],KZ=[0,0,0],Vwe=du(Zwe);function YO(e,t,r=KZ){r.length<3&&(r=[r[0],r[1],0]);let n=r,o,i=!0;switch(t===Mn.LNGLAT_OFFSETS||t===Mn.METER_OFFSETS?o=r:o=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Ds.WEB_MERCATOR:(t===Mn.LNGLAT||t===Mn.CARTESIAN)&&(o=[0,0,0],i=!1);break;case Ds.WEB_MERCATOR_AUTO_OFFSET:t===Mn.LNGLAT?n=o:t===Mn.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],o=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Ds.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case Ds.GLOBE:i=!1,o=null;break;default:i=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:n,offsetMode:i}}function Wwe(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:o}=e,{viewMatrix:i,viewProjectionMatrix:s}=e,a=HZ,u=HZ,h=e.cameraPosition,{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=YO(e,t,r);return y&&(u=e.projectPosition(p||_),h=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],u[3]=1,a=Ta.transformMat4([],u,s),i=n||i,s=yo.multiply([],o,i),s=yo.multiply([],s,jwe)),{viewMatrix:i,viewProjectionMatrix:s,projectionCenter:a,originCommon:u,cameraPosCommon:h,shaderCoordinateOrigin:_,geospatialOrigin:p}}function $Z({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Mn.DEFAULT,coordinateOrigin:o=KZ,autoWrapLongitude:i=!1}){n===Mn.DEFAULT&&(n=e.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN);let s=Vwe({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=i,s.project_uModelMatrix=r||XZ,s}function Zwe({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){let{projectionCenter:o,viewProjectionMatrix:i,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:u,geospatialOrigin:h}=Wwe(e,r,n),p=e.getDistanceScales(),_=[e.width*t,e.height*t],y=Ta.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,A={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:u,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:_,project_uDevicePixelRatio:t,project_uFocalDistance:y,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:Uwe,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:i,project_uModelMatrix:XZ,project_uCameraPosition:a};if(h){let E=e.getDistanceScales(h);switch(r){case Mn.METER_OFFSETS:A.project_uCommonUnitsPerWorldUnit=E.unitsPerMeter,A.project_uCommonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case Mn.LNGLAT:case Mn.LNGLAT_OFFSETS:e._pseudoMeters||(A.project_uCommonUnitsPerMeter=E.unitsPerMeter),A.project_uCommonUnitsPerWorldUnit=E.unitsPerDegree,A.project_uCommonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case Mn.CARTESIAN:A.project_uCommonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],A.project_uCommonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break;default:break}}return A}var Ywe={};function qwe(e=Ywe){return"viewport"in e?$Z(e):{}}var Bm={name:"project",dependencies:[eO,qZ],vs:GZ,getUniforms:qwe};var Gwe=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Ea={name:"project32",dependencies:[Bm],vs:Gwe};function qO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hd(e,t){let r=Ta.transformMat4([],t,e);return Ta.scale(r,r,1/r[3]),r}function GO(e,t){let r=e%t;return r<0?t+r:r}function Bb(e,t,r){return e<t?t:e>r?r:e}function Hwe(e){return Math.log(e)*Math.LOG2E}var s0=Math.log2||Hwe;function uc(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var fc=Math.PI,QZ=fc/4,Cl=fc/180,HO=180/fc,a0=512,eS=4003e4,l0=85.051129,JZ=1.5;function XO(e){return s0(e)}function ps(e){let[t,r]=e;uc(Number.isFinite(t)),uc(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let n=t*Cl,o=r*Cl,i=a0*(n+fc)/(2*fc),s=a0*(fc+Math.log(Math.tan(QZ+o*.5)))/(2*fc);return[i,s]}function Qa(e){let[t,r]=e,n=t/a0*(2*fc)-fc,o=2*(Math.atan(Math.exp(r/a0*(2*fc)-fc))-QZ);return[n*HO,o*HO]}function KO(e){let{latitude:t}=e;uc(Number.isFinite(t));let r=Math.cos(t*Cl);return XO(eS*r)-9}function Um(e){let t=Math.cos(e*Cl);return a0/eS/t}function c0(e){let{latitude:t,longitude:r,highPrecision:n=!1}=e;uc(Number.isFinite(t)&&Number.isFinite(r));let o=a0,i=Math.cos(t*Cl),s=o/360,a=s/i,u=o/eS/i,h={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[s,a,u],degreesPerUnit:[1/s,1/a,1/u]};if(n){let p=Cl*Math.tan(t*Cl)/i,_=s*p/2,y=o/eS*p,A=y/a*u;h.unitsPerDegree2=[0,_,y],h.unitsPerMeter2=[A,0,A]}return h}function jb(e,t){let[r,n,o]=e,[i,s,a]=t,{unitsPerMeter:u,unitsPerMeter2:h}=c0({longitude:r,latitude:n,highPrecision:!0}),p=ps(e);p[0]+=i*(u[0]+h[0]*s),p[1]+=s*(u[1]+h[1]*s);let _=Qa(p),y=(o||0)+(a||0);return Number.isFinite(o)||Number.isFinite(a)?[_[0],_[1],y]:_}function tS(e){let{height:t,pitch:r,bearing:n,altitude:o,scale:i,center:s}=e,a=qO();yo.translate(a,a,[0,0,-o]),yo.rotateX(a,a,-r*Cl),yo.rotateZ(a,a,n*Cl);let u=i/t;return yo.scale(a,a,[u,u,u]),s&&yo.translate(a,a,Sa.negate([],s)),a}function $O(e){let{width:t,height:r,altitude:n,pitch:o=0,offset:i,center:s,scale:a,nearZMultiplier:u=1,farZMultiplier:h=1}=e,{fovy:p=jm(JZ)}=e;n!==void 0&&(p=jm(n));let _=p*Cl,y=o*Cl,A=Ub(p),E=A;s&&(E+=s[2]*a/Math.cos(y)/r);let k=_*(.5+(i?i[1]:0)/r),P=Math.sin(k)*E/Math.sin(Bb(Math.PI/2-y-k,.01,Math.PI-.01)),R=Math.sin(y)*P+E,V=E*10,N=Math.min(R*h,V);return{fov:_,aspect:t/r,focalDistance:A,near:u,far:N}}function jm(e){return 2*Math.atan(.5/e)*HO}function Ub(e){return .5/Math.tan(.5*e*Cl)}function u0(e,t){let[r,n,o=0]=e;return uc(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(o)),hd(t,[r,n,o,1])}function dd(e,t,r=0){let[n,o,i]=e;if(uc(Number.isFinite(n)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(i))return hd(t,[n,o,i,1]);let s=hd(t,[n,o,0,1]),a=hd(t,[n,o,1,1]),u=s[2],h=a[2],p=u===h?0:((r||0)-u)/(h-u);return hu.lerp([],s,a,p)}function rS(e){let{width:t,height:r,bounds:n,minExtent:o=0,maxZoom:i=24,offset:s=[0,0]}=e,[[a,u],[h,p]]=n,_=Xwe(e.padding),y=ps([a,Bb(p,-l0,l0)]),A=ps([h,Bb(u,-l0,l0)]),E=[Math.max(Math.abs(A[0]-y[0]),o),Math.max(Math.abs(A[1]-y[1]),o)],k=[t-_.left-_.right-Math.abs(s[0])*2,r-_.top-_.bottom-Math.abs(s[1])*2];uc(k[0]>0&&k[1]>0);let P=k[0]/E[0],R=k[1]/E[1],V=(_.right-_.left)/2/P,N=(_.top-_.bottom)/2/R,j=[(A[0]+y[0])/2+V,(A[1]+y[1])/2+N],J=Qa(j),ne=Math.min(i,s0(Math.abs(Math.min(P,R))));return uc(Number.isFinite(ne)),{longitude:J[0],latitude:J[1],zoom:ne}}function Xwe(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(uc(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var eY=Math.PI/180;function nS(e,t=0){let{width:r,height:n,unproject:o}=e,i={targetZ:t},s=o([0,n],i),a=o([r,n],i),u,h,p=e.fovy?.5*e.fovy*eY:Math.atan(.5/e.altitude),_=(90-e.pitch)*eY;return p>_-.01?(u=tY(e,0,t),h=tY(e,r,t)):(u=o([0,0],i),h=o([r,0],i)),[s,a,h,u]}function tY(e,t,r){let{pixelUnprojectionMatrix:n}=e,o=hd(n,[t,0,1,1]),i=hd(n,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-o[2])/(i[2]-o[2]),u=hu.lerp([],o,i,a),h=Qa(u);return h.push(r),h}var nY=512;function QO(e){let{width:t,height:r,pitch:n=0}=e,{longitude:o,latitude:i,zoom:s,bearing:a=0}=e;(o<-180||o>180)&&(o=GO(o+180,360)-180),(a<-180||a>180)&&(a=GO(a+180,360)-180);let u=s0(r/nY);if(s<=u)s=u,i=0;else{let h=r/2/Math.pow(2,s),p=Qa([0,h])[1];if(i<p)i=p;else{let _=Qa([0,nY-h])[1];i>_&&(i=_)}}return{width:t,height:r,longitude:o,latitude:i,zoom:s,pitch:n,bearing:a}}var Qwe=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Jwe=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,e2e=du(o2e),t2e=du(s2e),r2e=[0,0,0,1],n2e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function i2e(e,t){let[r,n,o]=e,i=dd([r,n,o],t);return Number.isFinite(o)?i:[i[0],i[1],0]}function o2e({viewport:e,center:t}){return new Ci(e.viewProjectionMatrix).invert().transform(t)}function s2e({viewport:e,shadowMatrices:t}){let r=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,i=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>i2e(s,n));for(let s of t){let a=s.clone().translate(new mr(e.center).negate()),u=i.map(p=>a.transform(p)),h=new Ci().ortho({left:Math.min(...u.map(p=>p[0])),right:Math.max(...u.map(p=>p[0])),bottom:Math.min(...u.map(p=>p[1])),top:Math.max(...u.map(p=>p[1])),near:Math.min(...u.map(p=>-p[2])),far:Math.max(...u.map(p=>-p[2]))});r.push(h.multiplyRight(s))}return r}function a2e(e,t){let{shadowEnabled:r=!0}=e;if(!r||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let n={shadow_uDrawShadowMap:!!e.drawToShadowMap,shadow_uUseShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,shadow_uColor:e.shadowColor||r2e,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},o=e2e({viewport:e.viewport,center:t.project_uCenter}),i=[],s=t2e({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let a=0;a<e.shadowMatrices.length;a++){let u=s[a],h=u.clone().translate(new mr(e.viewport.center).negate());t.project_uCoordinateSystem===Mn.LNGLAT&&t.project_uProjectionMode===Ds.WEB_MERCATOR?(s[a]=h,i[a]=o):(s[a]=u.clone().multiplyRight(n2e),i[a]=h.transform(o))}for(let a=0;a<s.length;a++)n[`shadow_uViewProjectionMatrices[${a}]`]=s[a],n[`shadow_uProjectCenters[${a}]`]=i[a];for(let a=0;a<2;a++)n[`shadow_uShadowMap${a}`]=e.shadowMaps&&e.shadowMaps[a]||e.dummyShadowMap;return n}var iS={name:"shadow",dependencies:[Bm],vs:Qwe,fs:Jwe,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?a2e(e,t):{}};var Ia={...jM,defaultUniforms:{...jM.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var l2e=[Bm],c2e=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function iY(){let e=Im.getDefaultShaderAssembler();for(let t of l2e)e.addDefaultModule(t);for(let t of c2e)e.addShaderHook(t);return e}var u2e=[255,255,255],f2e=1,h2e=0,oS=class{constructor(t={}){this.type="ambient";let{color:r=u2e}=t,{intensity:n=f2e}=t;this.id=t.id||`ambient-${h2e++}`,this.color=r,this.intensity=n}};var d2e=[255,255,255],p2e=1,m2e=[0,0,-1],g2e=0,Vb=class{constructor(t={}){this.type="directional";let{color:r=d2e}=t,{intensity:n=p2e}=t,{direction:o=m2e}=t,{_shadow:i=!1}=t;this.id=t.id||`directional-${g2e++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new mr(o).normalize().toArray(),this.shadow=i}getProjectedLight(t){return this}};var Wb=class{constructor(t,r={id:"pass"}){let{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}};var Of=class extends Wb{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){let[r,n]=this.device.canvasContext.getDrawingBufferSize(),o=t.clearCanvas??!0,i=t.clearColor??(o?[0,0,0,0]:!1),s=o?1:!1,a=o?0:!1,u=t.colorMask??15,h={viewport:[0,0,r,n]};t.colorMask&&(h.colorMask=u),t.scissorRect&&(h.scissorRect=t.scissorRect);let p=this.device.beginRenderPass({framebuffer:t.target,parameters:h,clearColor:i,clearDepth:s,clearStencil:a});try{return this._drawLayers(p,t)}finally{p.end()}}_drawLayers(t,r){let{target:n,moduleParameters:o,viewports:i,views:s,onViewportActive:a,clearStack:u=!0}=r;r.pass=r.pass||"unknown",u&&(this._lastRenderIndex=-1);let h=[];for(let p of i){let _=s&&s[p.id];a?.(p);let y=this._getDrawLayerParams(p,r),A=p.subViewports||[p];for(let E of A){let k=this._drawLayersInViewport(t,{target:n,moduleParameters:o,viewport:E,view:_,pass:r.pass,layers:r.layers},y);h.push(k)}}return h}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:o=!1,layerFilter:i,cullRect:s,effects:a,moduleParameters:u},h=!1){let p=[],_=oY(this._lastRenderIndex+1),y={layer:r[0],viewport:t,isPicking:o,renderPass:n,cullRect:s},A={};for(let E=0;E<r.length;E++){let k=r[E],P=this._shouldDrawLayer(k,y,i,A),R={shouldDrawLayer:P};P&&!h&&(R.layerRenderIndex=_(k,P),R.moduleParameters=this._getModuleParameters(k,a,n,u),R.layerParameters={...k.context.deck?.props.parameters,...this.getLayerParameters(k,E,t)}),p[E]=R}return p}_drawLayersInViewport(t,{layers:r,moduleParameters:n,pass:o,target:i,viewport:s,view:a},u){let h=_2e(this.device,{moduleParameters:n,target:i,viewport:s});if(a&&a.props.clear){let _=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:h},()=>this.device.clearWebGL(_))}let p={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:h});for(let _=0;_<r.length;_++){let y=r[_],{shouldDrawLayer:A,layerRenderIndex:E,moduleParameters:k,layerParameters:P}=u[_];if(A&&y.props.pickable&&p.pickableCount++,y.isComposite)p.compositeCount++;else if(A){p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),k.viewport=s,y.context.renderPass=t;try{y._drawLayer({renderPass:t,moduleParameters:k,uniforms:{layerIndex:E},parameters:P})}catch(R){y.raiseError(R,`drawing ${y} to ${o}`)}}}return p}shouldDrawLayer(t){return!0}getModuleParameters(t,r){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,o){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(r))return!1;r.layer=s,s=s.parent}if(n){let a=r.layer.id;if(a in o||(o[a]=n(r)),!o[a])return!1}return t.activateViewport(r.viewport),!0}_getModuleParameters(t,r,n,o){let i=this.device.canvasContext.cssToDeviceRatio(),s=Object.assign(Object.create(t.internalState?.propsInTransition||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,picking:{isActive:0},devicePixelRatio:i});if(r)for(let a of r)Object.assign(s,a.getModuleParameters?.(t));return Object.assign(s,this.getModuleParameters(t,r),o)}};function oY(e=0,t={}){let r={},n=(o,i)=>{let s=o.props._offset,a=o.id,u=o.parent&&o.parent.id,h;if(u&&!(u in t)&&n(o.parent,!1),u in r){let p=r[u]=r[u]||oY(t[u],t);h=p(o,i),r[a]=p}else Number.isFinite(s)?(h=s+(t[u]||0),r[a]=null):h=e;return i&&h>=e&&(e=h+1),t[a]=h,h};return n}function _2e(e,{moduleParameters:t,target:r,viewport:n}){let o=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,i]=e.canvasContext.getDrawingBufferSize(),s=r?r.height:i,a=n;return[a.x*o,s-(a.y+a.height)*o,a.width*o,a.height*o]}var Zb=class extends Of{constructor(t,r){super(t,r),this.shadowMap=t.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(t){let r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),o=t.viewports[0],i=o.width*n,s=o.height*n,a=[1,1,1,1];(i!==r.width||s!==r.height)&&r.resize({width:i,height:s}),super.render({...t,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}};var y2e={color:[255,255,255],intensity:1},sY=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],x2e=[0,0,0,200/255],f0=class{constructor(t={}){this.id="lighting-effect",this.shadowColor=x2e,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;let{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(iS),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(let r in t){let n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:o,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:t,layerFilter:r,viewports:n,onViewportActive:o,views:i,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(t){let r=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return r.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:t})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:t}))},r}cleanup(t){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(iS))}_calculateMatrices(){let t=[];for(let r of this.directionalLights){let n=new Ci().lookAt({eye:new mr(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){let n=new Zb(t);this.shadowPasses[r]=n,this.shadowMaps[r]=n.shadowMap}}_applyDefaultLights(){let{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new oS(y2e),this.directionalLights.push(new Vb(sY[0]),new Vb(sY[1])))}};var JO=class{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:o,padding:i=0,copy:s=!1,initialize:a=!1,maxCount:u}){let h=o||t&&t.constructor||Float32Array,p=r*n+i;if(ArrayBuffer.isView(t)){if(p<=t.length)return t;if(p*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new h(t.buffer,0,p)}let _=1/0;u&&(_=u*n+i);let y=this._allocate(h,p,a,_);return t&&s?y.set(t):a||y.fill(0,0,4),this._release(t),y}release(t){this._release(t)}_allocate(t,r,n,o){let i=Math.max(Math.ceil(r*this.opts.overAlloc),1);i>o&&(i=o);let s=this._pool,a=t.BYTES_PER_ELEMENT*i,u=s.findIndex(h=>h.byteLength>=a);if(u>=0){let h=new t(s.splice(u,1)[0],0,i);return n&&h.fill(0),h}return new t(i)}_release(t){if(!ArrayBuffer.isView(t))return;let r=this._pool,{buffer:n}=t,{byteLength:o}=n,i=r.findIndex(s=>s.byteLength>=o);i<0?r.push(n):(i>0||r.length<this.opts.poolSize)&&r.splice(i,0,n),r.length>this.opts.poolSize&&r.shift()}},hc=new JO;function d0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lY(e){return[e[12],e[13],e[14]]}function cY(e){return{left:h0(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:h0(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:h0(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:h0(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:h0(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:h0(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}var aY=new mr;function h0(e,t,r,n){aY.set(e,t,r);let o=aY.len();return{distance:n/o,normal:new mr(-e/o,-t/o,-r/o)}}function b2e(e){return e-Math.fround(e)}var Yb;function sS(e,t){let{size:r=1,startIndex:n=0}=t,o=t.endIndex!==void 0?t.endIndex:e.length,i=(o-n)/r;Yb=hc.allocate(Yb,i,{type:Float32Array,size:r*2});let s=n,a=0;for(;s<o;){for(let u=0;u<r;u++){let h=e[s++];Yb[a+u]=h,Yb[a+u+r]=b2e(h)}a+=r*2}return Yb.subarray(0,i*r*2)}function uY(e){let t=null,r=!1;for(let n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}var v2e=Math.PI/180,w2e=d0(),fY=[0,0,0],A2e={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function M2e({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:o,padding:i,near:s,far:a}){let u=e/t,h=r?new Ci().orthographic({fovy:n,aspect:u,focalDistance:o,near:s,far:a}):new Ci().perspective({fovy:n,aspect:u,near:s,far:a});if(i){let{left:p=0,right:_=0,top:y=0,bottom:A=0}=i,E=El((p+e-_)/2,0,e)-e/2,k=El((y+t-A)/2,0,t)-t/2;h[8]-=E*2/e,h[9]+=k*2/t}return h}var Rf=class e{static{this.displayName="Viewport"}constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||A2e,this.focalDistance=t.focalDistance||1,this.position=t.position||fY,this.modelMatrix=t.modelMatrix||null;let{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ds.WEB_MERCATOR:Ds.WEB_MERCATOR_AUTO_OFFSET:Ds.IDENTITY}equals(t){return t instanceof e?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&na(t.projectionMatrix,this.projectionMatrix)&&na(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){let n=this.projectPosition(t),o=u0(n,this.pixelProjectionMatrix),[i,s]=o,a=r?s:this.height-s;return t.length===2?[i,a]:[i,a,o[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[o,i,s]=t,a=r?i:this.height-i,u=n&&n*this.distanceScales.unitsPerMeter[2],h=dd([o,a,s],this.pixelUnprojectionMatrix,u),[p,_,y]=this.unprojectPosition(h);return Number.isFinite(s)?[p,_,y]:Number.isFinite(n)?[p,_,n]:[p,_]}projectPosition(t){let[r,n]=this.projectFlat(t),o=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,o]}unprojectPosition(t){let[r,n]=this.unprojectFlat(t),o=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,o]}projectFlat(t){if(this.isGeospatial){let r=ps(t);return r[1]=El(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?Qa(t):t}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,0],r),o=this.unproject([this.width,0],r),i=this.unproject([0,this.height],r),s=this.unproject([this.width,this.height],r);return[Math.min(n[0],o[0],i[0],s[0]),Math.min(n[1],o[1],i[1],s[1]),Math.max(n[0],o[0],i[0],s[0]),Math.max(n[1],o[1],i[1],s[1])]}getDistanceScales(t){return t?c0({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:o=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,cY(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){let r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=KO({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||c0({latitude:n,longitude:r}));let o=Math.pow(2,this.zoom);this.scale=o;let{position:i,modelMatrix:s}=t,a=fY;if(i&&(a=s?new Ci(s).transformAsVector(i,[]):i),this.isGeospatial){let u=this.projectPosition([r,n,0]);this.center=new mr(a).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(a)}_initMatrices(t){let{viewMatrix:r=w2e,projectionMatrix:n=null,orthographic:o=!1,fovyRadians:i,fovy:s=75,near:a=.1,far:u=1e3,padding:h=null,focalDistance:p=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new Ci().multiplyRight(r).translate(new mr(this.center).negate()),this.projectionMatrix=n||M2e({width:this.width,height:this.height,orthographic:o,fovyRadians:i||s*v2e,focalDistance:p,padding:h,near:a,far:u});let _=d0();yo.multiply(_,_,this.projectionMatrix),yo.multiply(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=yo.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=lY(this.viewMatrixInverse);let y=d0(),A=d0();yo.scale(y,y,[this.width/2,-this.height/2,1]),yo.translate(y,y,[1,-1,0]),yo.multiply(A,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=A,this.pixelUnprojectionMatrix=yo.invert(d0(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Vr.warn("Pixel project matrix not invertible")()}};var Ja=class e extends Rf{static{this.displayName="WebMercatorViewport"}constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:o=0,pitch:i=0,bearing:s=0,nearZMultiplier:a=.1,farZMultiplier:u=1.01,nearZ:h,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:A=!1,worldOffset:E=0,position:k,padding:P,legacyMeterSizes:R=!1}=t,{width:V,height:N,altitude:j=1.5}=t,J=Math.pow(2,o);V=V||1,N=N||1;let ne,de=null;if(y)j=y[5]/2,ne=jm(j);else{t.fovy?(ne=t.fovy,j=Ub(ne)):ne=jm(j);let ye;if(P){let{top:ve=0,bottom:be=0}=P;ye=[0,El((ve+N-be)/2,0,N)-N/2]}de=$O({width:V,height:N,scale:J,center:k&&[0,0,k[2]*Um(r)],offset:ye,pitch:i,fovy:ne,nearZMultiplier:a,farZMultiplier:u}),Number.isFinite(h)&&(de.near=h),Number.isFinite(p)&&(de.far=p)}let fe=tS({height:N,pitch:i,bearing:s,scale:J,altitude:j});E&&(fe=new Ci().translate([512*E,0,0]).multiplyLeft(fe)),super({...t,width:V,height:N,viewMatrix:fe,longitude:n,latitude:r,zoom:o,...de,fovy:ne,focalDistance:j}),this.latitude=r,this.longitude=n,this.zoom=o,this.pitch=i,this.bearing=s,this.altitude=j,this.fovy=ne,this.orthographic=_,this._subViewports=A?[]:null,this._pseudoMeters=R,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let o=r;o<=n;o++){let i=o?new e({...this,worldOffset:o}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);let[r,n]=this.projectFlat(t),o=(t[2]||0)*Um(t[1]);return[r,n,o]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);let[r,n]=this.unprojectFlat(t),o=(t[2]||0)/Um(n);return[r,n,o]}addMetersToLngLat(t,r){return jb(t,r)}panByPosition(t,r){let n=dd(r,this.pixelUnprojectionMatrix),o=this.projectFlat(t),i=hu.add([],o,hu.negate([],n)),s=hu.add([],this.center,i),[a,u]=this.unprojectFlat(s);return{longitude:a,latitude:u}}getBounds(t={}){let r=nS(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){let{width:n,height:o}=this,{longitude:i,latitude:s,zoom:a}=rS({width:n,height:o,bounds:t,...r});return new e({width:n,height:o,longitude:i,latitude:s,zoom:a})}};var hY=[0,0,0];function e6(e,t,r=!1){let n=t.projectPosition(e);if(r&&t instanceof Ja){let[o,i,s=0]=e,a=t.getDistanceScales([o,i]);n[2]=s*a.unitsPerMeter[2]}return n}function S2e(e){let{viewport:t,modelMatrix:r,coordinateOrigin:n}=e,{coordinateSystem:o,fromCoordinateSystem:i,fromCoordinateOrigin:s}=e;return o===Mn.DEFAULT&&(o=t.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN),i===void 0&&(i=o),s===void 0&&(s=n),{viewport:t,coordinateSystem:o,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:i,fromCoordinateOrigin:s}}function t6(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:i}){let[s,a,u=0]=e;switch(r&&([s,a,u]=Ta.transformMat4([],[s,a,u,1],r)),n){case Mn.LNGLAT:return e6([s,a,u],t,i);case Mn.LNGLAT_OFFSETS:return e6([s+o[0],a+o[1],u+(o[2]||0)],t,i);case Mn.METER_OFFSETS:return e6(jb(o,[s,a,u]),t,i);case Mn.CARTESIAN:default:return t.isGeospatial?[s+o[0],a+o[1],u+o[2]]:t.projectPosition([s,a,u])}}function dY(e,t){let{viewport:r,coordinateSystem:n,coordinateOrigin:o,modelMatrix:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=S2e(t),{autoOffset:u=!0}=t,{geospatialOrigin:h=hY,shaderCoordinateOrigin:p=hY,offsetMode:_=!1}=u?YO(r,n,o):{},y=t6(e,{viewport:r,modelMatrix:i,coordinateSystem:s,coordinateOrigin:a,offsetMode:_});if(_){let A=r.projectPosition(h||p);Sa.sub(y,y,A)}return y}var T2e=1,E2e=1,Vm=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){let{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:o=1,repeat:i=1}=t,s=T2e++,a={time:0,delay:r,duration:n,rate:o,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(s,a),s}removeChannel(t){this.channels.delete(t);for(let[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){let r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;let r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);let r=this.channels.values();for(let o of r)this._setChannelTime(o,this.time);let n=this.animations.values();for(let o of n){let{animation:i,channel:s}=o;i.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){let n=E2e++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){let n=r-t.delay,o=t.duration*t.repeat;n>=o?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}};var I2e=0,C2e={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:If.stats.get(`animation-loop-${I2e++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},qb=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(t){if(this.props={...C2e,...t},t=this.props,!t.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=t.stats||new Aa({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){let r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=_P(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(yP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);let n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[t,r]=this.device?.canvasContext?.getPixelSize()||[1,1],n=1,o=this.device?.canvasContext?.canvas;return o&&o.clientHeight?n=o.clientWidth/o.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}};var aS=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){this.id=t.id||ra("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&Cn(this.indices.usage===qn.INDEX)}destroy(){this.indices?.destroy();for(let t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(t){return t.byteLength/12}};function pY(e,t){if(t instanceof aS)return t;let r=k2e(e,t),{attributes:n,bufferLayout:o}=P2e(e,t);return new aS({topology:t.topology||"triangle-list",bufferLayout:o,vertexCount:t.vertexCount,indices:r,attributes:n})}function k2e(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:qn.INDEX,data:r})}function P2e(e,t){let r=[],n={};for(let[i,s]of Object.entries(t.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}n[a]=e.createBuffer({data:s.value,id:`${i}-buffer`});let{value:u,size:h,normalized:p}=s;r.push({name:a,format:pP(u,h,p)})}let o=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:o}}var lS=class{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(t){let r=Em(Object.values(t).filter(n=>n.dependencies));for(let n of r)t[n.name]=n;Ut.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(let[n,o]of Object.entries(t)){let i=n;this.moduleUniforms[i]=o.defaultUniforms||{},this.moduleBindings[i]={}}}destroy(){}setProps(t){for(let r of Object.keys(t)){let n=r,o=t[n],i=this.modules[n];if(!i){Ut.warn(`Module ${r} not found`)();continue}let s=this.moduleUniforms[n],a=i.getUniforms?.(o,this.moduleUniforms[n])||o;this.moduleUniforms[n]={...s,...a}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){let t={};for(let r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){let t={};for(let[r,n]of Object.entries(this.moduleUniforms))for(let[o,i]of Object.entries(n))t[`${r}.${o}`]={type:this.modules[r].uniformTypes?.[o],value:String(i)};return t}};var cS=class e{static defaultProps={...cu.defaultProps};device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new e(t),t._lumaData.defaultPipelineFactory}constructor(t){this.device=t}createRenderPipeline(t){let r={...cu.defaultProps,...t},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){let o=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});o.hash=n,this._renderPipelineCache[n]={pipeline:o,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){let r={...$_.defaultProps,...t},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){let o=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});o.hash=n,this._computePipelineCache[n]={pipeline:o,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){let r=t.hash,n=t instanceof $_?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){let r=this._getHash(t.vs.source),n=t.fs?this._getHash(t.fs.source):0,o="-",i=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${o}BL${i}`;default:let s=this._getHash(JSON.stringify(t.parameters));return`${r}/${n}V${o}T${t.topology}P${s}BL${i}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}};var uS=class e{static defaultProps={...Pm.defaultProps};device;_cache={};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new e(t),t._lumaData.defaultShaderFactory}constructor(t){this.device=t}createShader(t){let r=this._hashShader(t),n=this._cache[r];if(!n){let o=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:o,useCount:0}}return n.useCount++,n.shader}release(t){let r=this._hashShader(t),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&(delete this._cache[r],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}};function mY(e,t){let r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(let o of e.attributes)if(o){let i=`${o.location} ${o.name}: ${o.type}`;r[`in ${i}`]={[n]:o.stepMode||"vertex"}}for(let o of e.varyings||[]){let i=`${o.location} ${o.name}`;r[`out ${i}`]={[n]:JSON.stringify(o.accessor)}}return r}var ts=null,r6=null;function gY(e,{id:t,minimap:r,opaque:n,top:o="0",left:i="0",rgbaScale:s=1}){ts||(ts=document.createElement("canvas"),ts.id=t,ts.title=t,ts.style.zIndex="100",ts.style.position="absolute",ts.style.top=o,ts.style.left=i,ts.style.border="blue 1px solid",ts.style.transform="scaleY(-1)",document.body.appendChild(ts),r6=ts.getContext("2d")),(ts.width!==e.width||ts.height!==e.height)&&(ts.width=e.width/2,ts.height=e.height/2,ts.style.width="400px",ts.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),u=r6.createImageData(e.width,e.height),h=0;for(let p=0;p<a.length;p+=4)u.data[h+p+0]=a[p+0]*s,u.data[h+p+1]=a[p+1]*s,u.data[h+p+2]=a[p+2]*s,u.data[h+p+3]=n?255:a[p+3]*s;r6.putImageData(u,0,0)}var p0=2,O2e=1e4,Co=class e{static defaultProps={...cu.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Im.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(t,r){this.props={...e.defaultProps,...r},r=this.props,this.id=r.id||ra("model"),this.device=t,Object.assign(this.userData,r.userData);let n=Object.fromEntries(this.props.modules?.map(a=>[a.name,a])||[]);this.setShaderInputs(r.shaderInputs||new lS(n));let o=R2e(t),i=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=JP(this.props.source);let{source:a,getUniforms:u}=this.props.shaderAssembler.assembleShader({platformInfo:o,...this.props,modules:i});this.source=a,this._getModuleUniforms=u}else{let{vs:a,fs:u,getUniforms:h}=this.props.shaderAssembler.assembleShaderPair({platformInfo:o,...this.props,modules:i});this.vs=a,this.fs=u,this._getModuleUniforms=h}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||cS.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||uS.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniforms(r.uniforms),r.moduleSettings&&this.updateModuleSettings(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){this.predraw();let r;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),sd(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:n}=this.vertexArray,o=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(t),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(t){this._gpuGeometry?.destroy();let r=t&&pY(this.device,t);r&&(this.setTopology(r.topology||"triangle-list"),this.bufferLayout=_Y(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)),this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){this.bufferLayout=this._gpuGeometry?_Y(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){Ib(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new Mb(this.shaderInputs.modules);for(let r of Object.keys(this.shaderInputs.modules)){let n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){t.indices&&Ut.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(let[n,o]of Object.entries(t)){let i=this.bufferLayout.find(u=>yY(u).includes(n));if(!i){Ut.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}let s=yY(i),a=!1;for(let u of s){let h=this._attributeInfos[u];h&&(this.vertexArray.setBuffer(h.location,o),a=!0)}!a&&!(r?.disableWarnings??this.props.disableWarnings)&&Ut.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(let[n,o]of Object.entries(t)){let i=this._attributeInfos[n];i?this.vertexArray.setConstantWebGL(i.location,o):(r?.disableWarnings??this.props.disableWarnings)||Ut.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){sd(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettings(t){let{bindings:r,uniforms:n}=Tb(this._getModuleUniforms(t));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let t=0;for(let r of Object.values(this.bindings))r instanceof km?t=Math.max(t,r.texture.updateTimestamp):r instanceof qn||r instanceof Io?t=Math.max(t,r.updateTimestamp):r instanceof Om||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){let r={...t.attributes};for(let[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(o=>o.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(Ut.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders}),o=null;this.source?o=n:this.fs&&(o=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:o}),this._attributeInfos=gM(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let t=Ut.level>3?0:O2e;Ut.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,Ut.group(p0,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ut.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let t=mY(this.pipeline.shaderLayout,this.id);Ut.table(p0,t)();let r=this.shaderInputs.getDebugTable();for(let[o,i]of Object.entries(this.uniforms))r[o]={value:i};Ut.table(p0,r)();let n=this._getAttributeDebugTable();Ut.table(p0,this._attributeInfos)(),Ut.table(p0,n)(),Ut.groupEnd(p0)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){let r=Ut.get("framebuffer");if(this._drawCount++,!r||this._drawCount++>3&&this._drawCount%60)return;let n=t.props.framebuffer;n&&gY(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){let t={};for(let[r,n]of Object.entries(this._attributeInfos))t[n.location]={name:r,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){let n=Sb(r);return(t instanceof qn?new n(t.debugData):t).toString()}};function _Y(e,t){let r=[...e];for(let n of t){let o=r.findIndex(i=>i.name===n.name);o<0?r.push(n):r[o]=n}return r}function R2e(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function yY(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}var pd=class e{device;model;transformFeedback;static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=Co.defaultProps){Cn(e.isSupported(t),"BufferTransform not yet implemented on WebGPU"),this.device=t,this.model=new Co(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||sP(),topology:r.topology||"point-list",...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){let r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}update(...t){console.warn("TextureTransform#update() not implemented")}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){let r=this.getBuffer(t);if(r instanceof qn)return r.readAsync();let{buffer:n,byteOffset:o=0,byteLength:i=n.byteLength}=r;return n.readAsync(o,i)}};var Ca=class{id;topology;vertexCount;indices;attributes;userData={};constructor(t){let{attributes:r={},indices:n=null,vertexCount:o=null}=t;this.id=t.id||ra("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(let[i,s]of Object.entries(r)){let a=ArrayBuffer.isView(s)?{value:s}:s;Cn(ArrayBuffer.isView(a.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?(Cn(!this.indices),this.indices=a):this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(let o of Object.values(t)){let{value:i,size:s,constant:a}=o;!a&&i&&s>=1&&(n=Math.min(n,i.length/s))}return Cn(Number.isFinite(n)),n}};var N2e={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},Wm=class extends Of{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:i,pickingFBO:s,deviceRect:{x:a,y:u,width:h,height:p},cullRect:_,effects:y,pass:A="picking",pickZ:E,moduleParameters:k}){this.pickZ=E;let P=this._resetColorEncoder(E),R=[a,u,h,p],V=super.render({target:s,layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:i,cullRect:_,effects:y?.filter(j=>j.useInPicking),pass:A,isPicking:!0,moduleParameters:k,clearColor:[0,0,0,0],colorMask:15,scissorRect:R});return this._colorEncoderState=null,{decodePickingColor:P&&D2e.bind(null,P),stats:V}}shouldDrawLayer(t){let{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(t,r,n){let o={depthMask:!0,depthTest:!0,depthRange:[0,1],...t.props.parameters},{pickable:i,operation:s}=t.props;return!this._colorEncoderState||s.includes("terrain")?o.blend=!1:i&&s.includes("draw")&&(Object.assign(o,N2e),o.blend=!0,o.blendColor=z2e(this._colorEncoderState,t,n)),o}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function z2e(e,t,r){let{byLayer:n,byAlpha:o}=e,i,s=n.get(t);return s?(s.viewports.push(r),i=s.a):(i=n.size+1,i<=255?(s={a:i,layer:t,viewports:[r]},n.set(t,s),o[i]=s):(Vr.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function D2e(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}var md={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},m0=Symbol.for("component"),kl=Symbol.for("propTypes"),fS=Symbol.for("deprecatedProps"),Nf=Symbol.for("asyncPropDefaults"),pu=Symbol.for("asyncPropOriginal"),dc=Symbol.for("asyncPropResolved");function ka(e,t=()=>!0){return Array.isArray(e)?xY(e,t,[]):t(e)?[e]:[]}function xY(e,t,r){let n=-1;for(;++n<e.length;){let o=e[n];Array.isArray(o)?xY(o,t,r):t(o)&&r.push(o)}return r}function n6({target:e,source:t,start:r=0,count:n=1}){let o=t.length,i=n*o,s=0;for(let a=r;s<o;s++)e[a++]=t[s];for(;s<i;)s<i-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+i-s),s=i);return e}var Gb=class{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;let n=++this._loadCount,o=t;typeof t=="string"&&(o=su(t)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(i=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===n&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(let i of this._subscribers)i.onChange(this.getData())}};var Hb=class{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:o=!0}){let i=this._resources[t];i?i.setData(r,n):(i=new Gb(t,r,this._context),this._resources[t]=i),i.persistent=o}remove(t){let r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){let r=this._consumers[t];if(r){for(let n in r){let o=r[n],i=this._resources[o.resourceId];i&&i.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:o="default"}){let{_resources:i,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),i[t]||this.add({resourceId:t,data:null,persistent:!1}));let a=i[t];if(this._track(n,o,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let t in this._resources)this._resources[t].delete()}_track(t,r,n,o){let i=this._consumers,s=i[t]=i[t]||{},a=s[r],u=a&&a.resourceId&&this._resources[a.resourceId];u&&(u.unsubscribe(a),this.prune()),n&&(a?(a.onChange=o,a.resourceId=n.id):a={onChange:o,resourceId:n.id},s[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(let t of Object.keys(this._resources)){let r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}};var L2e="layerManager.setLayers",F2e="layerManager.activateViewport",Xb=class{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{oo(F2e,this,a),a&&(this.context.viewport=a)};let{deck:n,stats:o,viewport:i,timeline:s}=r||{};this.layers=[],this.resourceManager=new Hb({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:iY(),defaultShaderModules:[],renderPass:void 0,stats:o||new Aa({id:"deck.gl"}),viewport:i||new Rf({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new Vm,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(let n of this.layers){let o=n.getNeedsRedraw(t);r=r||o}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){oo(L2e,this,r,t),this._lastRenderedLayers=t;let n=ka(t,Boolean);for(let o of n)o.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){let t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){let{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){let{defaultShaderModules:r}=this.context,n=r.findIndex(o=>o.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){let n={};for(let s of t)n[s.id]?Vr.warn(`Multiple old layers with same id ${s.id}`)():n[s.id]=s;if(this._defaultShaderModulesChanged){for(let s of t)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let o=[];this._updateSublayersRecursively(r,n,o),this._finalizeOldLayers(n);let i=!1;for(let s of o)if(s.hasUniformTransition()){i=`Uniform transition in ${s}`;break}this._needsUpdate=i,this.layers=o}_updateSublayersRecursively(t,r,n){for(let o of t){o.context=this.context;let i=r[o.id];i===null&&Vr.warn(`Multiple new layers with same id ${o.id}`)(),r[o.id]=null;let s=null;try{this._debug&&i!==o&&o.validateProps(),i?(this._transferLayerState(i,o),this._updateLayer(o)):this._initializeLayer(o),n.push(o),s=o.isComposite?o.getSubLayers():null}catch(a){this._handleError("matching",a,o)}s&&this._updateSublayersRecursively(s,r,n)}}_finalizeOldLayers(t){for(let r in t){let n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=md.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=md.MATCHED,r!==t&&(t.lifecycle=md.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=md.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=md.FINALIZED}catch(r){this._handleError("finalization",r,t)}}};function jo(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!jo(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(let i of n)if(!t.hasOwnProperty(i)||!jo(e[i],t[i],r-1))return!1;return!0}return!1}var Kb=class{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(let t in this.controllers){let r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(let t in this.controllers){let r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){let t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){let r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){let n=this.getViewports(),o={x:t[0],y:t[1]};for(let i=n.length-1;i>=0;--i){let s=n[i];if(s.containsPixel(o)){let a=t.slice();return a[0]-=s.x,a[1]-=s.y,s.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=ka(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!jo(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Vr.warn("missing `viewState` or `initialViewState`")()}_createController(t,r){let n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>this.getView(t.id)?.makeViewport({viewState:i,width:this.width,height:this.height})})}_updateController(t,r,n,o){let i=t.controller;if(i&&n){let s={...r,...i,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!o||o.constructor!==i.type)&&(o=this._createController(t,s)),o&&o.setProps(s),o}return null}_rebuildViewports(){let{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let o=t.length;o--;){let i=t[o],s=this.getViewState(i),a=i.makeViewport({viewState:s,width:this.width,height:this.height}),u=r[i.id],h=!!i.controller;h&&!u&&(n=!0),(n||!h)&&u&&(u.finalize(),u=null),this.controllers[i.id]=this._updateController(i,s,a,u),a&&this._viewports.unshift(a)}for(let o in r){let i=r[o];i&&!this.controllers[o]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,o)=>!t[o].equals(r[o]))}};var B2e=/([0-9]+\.?[0-9]*)(%|px)/;function zf(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=B2e.exec(e);if(t&&t.length>=3){let r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function Df(e,t){return e.relative?Math.round(e.position*t):e.position}var $b=class{constructor(t){let{id:r,x:n=0,y:o=0,width:i="100%",height:s="100%",padding:a=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=zf(n),this._y=zf(o),this._width=zf(i),this._height=zf(s),this._padding=a&&{left:zf(a.left||0),right:zf(a.right||0),top:zf(a.top||0),bottom:zf(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.ViewportType===t.ViewportType&&jo(this.props,t.props,2)}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);let o=this.getDimensions({width:t,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){let{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...t};for(let n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){let n={x:Df(this._x,t),y:Df(this._y,r),width:Df(this._width,t),height:Df(this._height,r)};return this._padding&&(n.padding={left:Df(this._padding.left,t),top:Df(this._padding.top,r),right:Df(this._padding.right,t),bottom:Df(this._padding.bottom,r)}),n}get controller(){let t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};var pc=class{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var bY=()=>{},i6={BREAK:1,SNAP_TO_END:2,IGNORE:3},j2e=e=>e,U2e=i6.BREAK,Qb=class{constructor(t){this._onTransitionUpdate=r=>{let{time:n,settings:{interpolator:o,startProps:i,endProps:s,duration:a,easing:u}}=r,h=u(n/a),p=o.interpolateProps(i,s,h);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new pc(t.timeline),this.onViewStateChange=t.onViewStateChange||bY,this.onStateChange=t.onStateChange||bY}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1,n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let o=n;if(this.transition.inProgress){let{interruption:i,endProps:s}=this.transition.settings;o={...n,...i===i6.SNAP_TO_END?s:this.propsInTransition||n}}this._triggerTransition(o,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){let{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===i6.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){let n=this.getControllerState(t),o=this.getControllerState(r).shortestPathFrom(n),i=r.transitionInterpolator,s=i.getDuration?i.getDuration(t,r):r.transitionDuration;if(s===0)return;let a=i.initializeProps(t,o);this.propsInTransition={};let u={duration:s,easing:r.transitionEasing||j2e,interpolator:i,interruption:r.transitionInterruption||U2e,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}};function hi(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var Jb=class{constructor(t){let{compare:r,extract:n,required:o}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=o}arePropsEqual(t,r){for(let n of this._propsToCompare)if(!(n in t)||!(n in r)||!na(t[n],r[n]))return!1;return!0}initializeProps(t,r){let n={},o={};for(let i of this._propsToExtract)(i in t||i in r)&&(n[i]=t[i],o[i]=r[i]);return this._checkRequiredProps(n),this._checkRequiredProps(o),{start:n,end:o}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{let n=t[r];hi(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};var V2e=["longitude","latitude","zoom","bearing","pitch"],W2e=["longitude","latitude","zoom"],Zm=class extends Jb{constructor(t={}){let r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:V2e,required:W2e},super(n.transitionProps),this.opts=n}initializeProps(t,r){let n=super.initializeProps(t,r),{makeViewport:o,around:i}=this.opts;if(o&&i){let s=o(t),a=o(r),u=s.unproject(i);n.start.around=i,Object.assign(n.end,{around:a.project(u),aroundPosition:u,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){let o={};for(let i of this._propsToExtract)o[i]=Ma(t[i]||0,r[i]||0,n);if(r.aroundPosition&&this.opts.makeViewport){let i=this.opts.makeViewport({...r,...o});Object.assign(o,i.panByPosition(r.aroundPosition,Ma(t.around,r.around,n)))}return o}};var gd={transitionDuration:0},Z2e=300,hS=e=>1-(1-e)*(1-e),g0={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ym={},ev=class{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Qb({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;let r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return r?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){let{x:r,y:n}=this.props,{offsetCenter:o}=t;return[o.x-r,o.y-n]}isPointInBounds(t,r){let{width:n,height:o}=this.props;if(r&&r.handled)return!1;let i=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=o;return i&&r&&r.stopPropagation(),i}isFunctionKeyPressed(t){let{srcEvent:r}=t;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?Z2e:0;let{scrollZoom:n=!0,dragPan:o=!0,dragRotate:i=!0,doubleClickZoom:s=!0,touchZoom:a=!0,touchRotate:u=!1,keyboard:h=!0}=t,p=!!this.onViewStateChange;this.toggleEvents(g0.WHEEL,p&&n),this.toggleEvents(g0.PAN,p),this.toggleEvents(g0.PINCH,p&&(a||u)),this.toggleEvents(g0.TRIPLE_PAN,p&&u),this.toggleEvents(g0.DOUBLE_TAP,p&&s),this.toggleEvents(g0.KEYBOARD,p&&h),this.scrollZoom=n,this.dragPan=o,this.dragRotate=i,this.doubleClickZoom=s,this.touchZoom=a,this.touchRotate=u,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){let o={...t.getViewportProps(),...r},i=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),i){let s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);let o=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(o,gd,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;let r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,gd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){let{inertia:r}=this;if(this.dragPan&&r&&t.velocity){let n=this.getCenter(t),o=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],i=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:hS},{isDragging:!1,isPanning:!0})}else{let n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;let r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,gd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){let{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){let n=this.getCenter(t),o=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],i=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:hS},{isDragging:!1,isRotating:!0})}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();let{speed:n=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=t,s=2/(1+Math.exp(-Math.abs(i*n)));i<0&&s!==0&&(s=1/s);let a=this.controllerState.zoom({pos:r,scale:s});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,gd,{isDragging:!0}),!0}_onTriplePan(t){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(t);r[0]-=t.deltaX;let n=this.controllerState.rotate({pos:r});return this.updateViewport(n,gd,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){let n=this.getCenter(t),o=[n[0],n[1]+=t.velocityY*r/2],i=this.controllerState.rotate({pos:o});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:hS},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Ym._startPinchRotation=t.rotation,Ym._lastPinchEvent=t,this.updateViewport(n,gd,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:n}=t,o=this.getCenter(t);r=r.zoom({pos:o,scale:n})}if(this.touchRotate){let{rotation:n}=t;r=r.rotate({deltaAngleX:Ym._startPinchRotation-n})}return this.updateViewport(r,gd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ym._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:n}=Ym;if(this.touchZoom&&r&&n&&t.scale!==n.scale){let o=this.getCenter(t),i=this.controllerState.rotateEnd(),s=Math.log2(t.scale),a=(s-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),u=Math.pow(2,s+a*r/2);i=i.zoom({pos:o,scale:u}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:o}),transitionDuration:r,transitionEasing:hS},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ym._startPinchRotation=null,Ym._lastPinchEvent=null,!0}_onDoubleTap(t){if(!this.doubleClickZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t),o=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(o,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:o,rotateSpeedX:i,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,u,h={};switch(t.srcEvent.code){case"Minus":u=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),h.isZooming=!0;break;case"Equal":u=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),h.isZooming=!0;break;case"ArrowLeft":r?(u=a.rotateLeft(i),h.isRotating=!0):(u=a.moveLeft(o),h.isPanning=!0);break;case"ArrowRight":r?(u=a.rotateRight(i),h.isRotating=!0):(u=a.moveRight(o),h.isPanning=!0);break;case"ArrowUp":r?(u=a.rotateUp(s),h.isRotating=!0):(u=a.moveUp(o),h.isPanning=!0);break;case"ArrowDown":r?(u=a.rotateDown(s),h.isRotating=!0):(u=a.moveDown(o),h.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),h),!0}_getTransitionProps(t){let{transition:r}=this;return!r||!r.transitionInterpolator?gd:t?{...r,transitionInterpolator:new Zm({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var tv=class{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var vY=5,Y2e=1.2,o6=class extends tv{constructor(t){let{width:r,height:n,latitude:o,longitude:i,zoom:s,bearing:a=0,pitch:u=0,altitude:h=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:A=60,minPitch:E=0,startPanLngLat:k,startZoomLngLat:P,startRotatePos:R,startBearing:V,startPitch:N,startZoom:j,normalize:J=!0}=t;hi(Number.isFinite(i)),hi(Number.isFinite(o)),hi(Number.isFinite(s)),super({width:r,height:n,latitude:o,longitude:i,zoom:s,bearing:a,pitch:u,altitude:h,maxZoom:_,minZoom:y,maxPitch:A,minPitch:E,normalize:J,position:p},{startPanLngLat:k,startZoomLngLat:P,startRotatePos:R,startBearing:V,startPitch:N,startZoom:j}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){let n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:o,startBearing:i,startPitch:s}=this.getState();if(!o||i===void 0||s===void 0)return this;let a;return t?a=this._getNewRotation(t,o,s,i):a={bearing:i+r,pitch:s+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:o,startZoomLngLat:i}=this.getState();if(i||(o=this.getViewportProps().zoom,i=this._unproject(r)||this._unproject(t)),!i)return this;let{maxZoom:s,minZoom:a}=this.getViewportProps(),u=o+Math.log2(n);u=El(u,a,s);let h=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...h.panByPosition(i,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:o,longitude:i}=n;return Math.abs(o-r.bearing)>180&&(n.bearing=o<0?o+360:o-360),Math.abs(i-r.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:o}=t;t.zoom=El(o,n,r);let{maxPitch:i,minPitch:s,pitch:a}=t;t.pitch=El(a,s,i);let{normalize:u=!0}=t;return u&&Object.assign(t,QO(t)),t}_zoomFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,o){let i=t[0]-r[0],s=t[1]-r[1],a=t[1],u=r[1],{width:h,height:p}=this.getViewportProps(),_=i/h,y=0;s>0?Math.abs(p-u)>vY&&(y=s/(u-p)*Y2e):s<0&&u>vY&&(y=1-a/u),y=El(y,-1,1);let{minPitch:A,maxPitch:E}=this.getViewportProps(),k=o+180*_,P=n;return y>0?P=n+y*(E-n):y<0&&(P=n-y*(A-n)),{pitch:P,bearing:k}}},rv=class extends ev{constructor(){super(...arguments),this.ControllerState=o6,this.transition={transitionDuration:300,transitionInterpolator:new Zm({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];let r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};var _d=class extends $b{static{this.displayName="MapView"}constructor(t={}){super(t)}get ViewportType(){return Ja}get ControllerType(){return rv}};var q2e=new f0;function G2e(e,t){let r=e.order??1/0,n=t.order??1/0;return r-n}var nv=class{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){let r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){let n=r.findIndex(o=>G2e(o,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(jo(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){let r={};for(let o of this.effects)r[o.id]=o;let n=[];for(let o of t){let i=r[o.id],s=o;i&&i!==o?i.setProps?(i.setProps(o.props),s=i):i.cleanup(this._context):i||o.setup(this._context),n.push(s),delete r[o.id]}for(let o in r)r[o].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(o=>o instanceof f0)||this._resolvedEffects.push(q2e),this._needsRedraw="effects changed"}finalize(){for(let t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var iv=class extends Of{shouldDrawLayer(t){let{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}};var H2e="deckRenderer.renderLayers",ov=class{constructor(t){this.device=t,this.gl=t.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iv(t),this.pickLayersPass=new Wm(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);let o=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);let i=r.render({...n,target:o});n.effects&&this._postRender(n.effects,n),this.renderCount++,oo(H2e,this,i,t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:t}=this;for(let r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{let o=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[o]}))});for(let n of t)n.resize(r)}_postRender(t,r){let{renderBuffers:n}=this,o={...r,inputBuffer:n[0],swapBuffer:n[1]};for(let i of t)if(i.postRender){o.target=i.id===this.lastPostProcessEffect?r.target:void 0;let s=i.postRender(o);o.inputBuffer=s,o.swapBuffer=s===n[0]?n[1]:n[0]}}};var X2e={pickedColor:null,pickedObjectIndex:-1};function wY({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:i}){let{x:s,y:a,width:u,height:h}=i,p=o*o,_=-1,y=0;for(let A=0;A<h;A++){let E=A+a-n,k=E*E;if(k>p)y+=4*u;else for(let P=0;P<u;P++){if(e[y+3]-1>=0){let V=P+s-r,N=V*V+k;N<=p&&(p=N,_=y)}y+=4}}if(_>=0){let A=e.slice(_,_+4),E=t(A);if(E){let k=Math.floor(_/4/u),P=_/4-k*u;return{...E,pickedColor:A,pickedX:s+P,pickedY:a+k}}Vr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return X2e}function AY({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){let i=e.slice(n,n+4),s=i.join(",");if(!r.has(s)){let a=t(i);a?r.set(s,{...a,color:i}):Vr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function s6({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:o,z:i}){let s=t[0];t.length>1&&(s=K2e(e?.pickedViewports||t,{x:n,y:o}));let a;if(s){let u=[n-s.x,o-s.y];i!==void 0&&(u[2]=i),a=s.unproject(u)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function MY(e){let{pickInfo:t,lastPickedInfo:r,mode:n,layers:o}=e,{pickedColor:i,pickedLayer:s,pickedObjectIndex:a}=t,u=s?[s]:[];if(n==="hover"){let _=r.index,y=r.layerId,A=s?s.props.id:null;if(A!==y||a!==_){if(A!==y){let E=o.find(k=>k.props.id===y);E&&u.unshift(E)}r.layerId=A,r.index=a,r.info=null}}let h=s6(e),p=new Map;return p.set(null,h),u.forEach(_=>{let y={...h};_===s&&(y.color=i,y.index=a,y.picked=!0),y=a6({layer:_,info:y,mode:n});let A=y.layer;_===s&&n==="hover"&&(r.info=y),p.set(A.id,y),n==="hover"&&A.updateAutoHighlight(y)}),p}function a6({layer:e,info:t,mode:r}){for(;e&&t;){let n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function K2e(e,t){for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.containsPixel(t))return n}return e[0]}var sv=class{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new Wm(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:o},i=this.lastPickedInfo.info){let s=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,u=s?n.find(y=>y.id===s):null,h=a&&o.find(y=>y.id===a)||o[0],p=h&&h.unproject([t-h.x,r-h.y]);return{...i,...{x:t,y:r,viewport:h,coordinate:p,layer:u}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let t=this.device.gl;this.pickingFBO?.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO?.resize({width:t.canvas.width,height:t.canvas.height})}_getPickable(t){if(this._pickable===!1)return null;let r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:t,views:r,viewports:n,x:o,y:i,radius:s=0,depth:a=1,mode:u="query",unproject3D:h,onViewportActive:p,effects:_}){let y=this.device.canvasContext.cssToDeviceRatio(),A=this._getPickable(t);if(!A||n.length===0)return{result:[],emptyInfo:s6({viewports:n,x:o,y:i,pixelRatio:y})};this._resizeBuffer();let E=this.device.canvasContext.cssToDevicePixels([o,i],!0),k=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],P=Math.round(s*y),{width:R,height:V}=this.pickingFBO,N=this._getPickingRect({deviceX:k[0],deviceY:k[1],deviceRadius:P,deviceWidth:R,deviceHeight:V}),j={x:o-s,y:i-s,width:s*2+1,height:s*2+1},J,ne=[],de=new Set;for(let fe=0;fe<a;fe++){let ye;if(N){let be=this._drawAndSample({layers:A,views:r,viewports:n,onViewportActive:p,deviceRect:N,cullRect:j,effects:_,pass:`picking:${u}`});ye=wY({...be,deviceX:k[0],deviceY:k[1],deviceRadius:P,deviceRect:N})}else ye={pickedColor:null,pickedObjectIndex:-1};let ve;if(ye.pickedLayer&&h&&this.depthFBO){let{pickedColors:be}=this._drawAndSample({layers:[ye.pickedLayer],views:r,viewports:n,onViewportActive:p,deviceRect:{x:ye.pickedX,y:ye.pickedY,width:1,height:1},cullRect:j,effects:_,pass:`picking:${u}:z`},!0);be[3]&&(ve=be[0])}ye.pickedLayer&&fe+1<a&&(de.add(ye.pickedLayer),ye.pickedLayer.disablePickingIndex(ye.pickedObjectIndex)),J=MY({pickInfo:ye,lastPickedInfo:this.lastPickedInfo,mode:u,layers:A,viewports:n,x:o,y:i,z:ve,pixelRatio:y});for(let be of J.values())be.layer&&ne.push(be);if(!ye.pickedColor)break}for(let fe of de)fe.restorePickingColors();return{result:ne,emptyInfo:J.get(null)}}_pickVisibleObjects({layers:t,views:r,viewports:n,x:o,y:i,width:s=1,height:a=1,mode:u="query",maxObjects:h=null,onViewportActive:p,effects:_}){let y=this._getPickable(t);if(!y||n.length===0)return[];this._resizeBuffer();let A=this.device.canvasContext.cssToDeviceRatio(),E=this.device.canvasContext.cssToDevicePixels([o,i],!0),k=E.x,P=E.y+E.height,R=this.device.canvasContext.cssToDevicePixels([o+s,i+a],!0),V=R.x+R.width,N=R.y,j={x:k,y:N,width:V-k,height:P-N},J=this._drawAndSample({layers:y,views:r,viewports:n,onViewportActive:p,deviceRect:j,cullRect:{x:o,y:i,width:s,height:a},effects:_,pass:`picking:${u}`}),ne=AY(J),de=new Map,fe=[],ye=Number.isFinite(h);for(let ve=0;ve<ne.length&&!(ye&&fe.length>=h);ve++){let be=ne[ve],je={color:be.pickedColor,layer:null,index:be.pickedObjectIndex,picked:!0,x:o,y:i,pixelRatio:A};je=a6({layer:be.pickedLayer,info:je,mode:u});let Re=je.layer.id;de.has(Re)||de.set(Re,new Set);let Se=de.get(Re),Ue=je.object??je.index;Se.has(Ue)||(Se.add(Ue),fe.push(je))}return fe}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:o,deviceRect:i,cullRect:s,effects:a,pass:u},h=!1){let p=h?this.depthFBO:this.pickingFBO,_={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:p,deviceRect:i,cullRect:s,effects:a,pass:u,pickZ:h,preRenderStats:{}};for(let V of a)V.useInPicking&&(_.preRenderStats[V.id]=V.preRender(_));let{decodePickingColor:y}=this.pickLayersPass.render(_),{x:A,y:E,width:k,height:P}=i,R=new(h?Float32Array:Uint8Array)(k*P*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:A,sourceY:E,sourceWidth:k,sourceHeight:P,target:R}),{pickedColors:R,decodePickingColor:y}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:i}){let s=Math.max(0,t-n),a=Math.max(0,r-n),u=Math.min(o,t+n+1)-s,h=Math.min(i,r+n+1)-a;return u<=0||h<=0?null:{x:s,y:a,width:u,height:h}}};var $2e={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Q2e="top-left",SY="__root",dS=class{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!jo(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(let t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){let r={};for(let n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(let n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){let o=r[n.id];o?o.viewId!==n.viewId||o.placement!==n.placement?(this._remove(o),this._add(n)):n!==o&&(o.setProps(n.props),n=o):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(let n in r){let o=r[n];o&&this._remove(o)}this.widgets=t}_add(t){let{viewId:r=null,placement:n=Q2e}=t,o=t.onAdd({deck:this.deck,viewId:r});o&&this._getContainer(r,n).append(o),t._element=o}_remove(t){t.onRemove(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,r){let n=t||SY,o=this.containers[n];o||(o=document.createElement("div"),o.style.pointerEvents="none",o.style.position="absolute",o.style.overflow="hidden",this.parentElement?.append(o),this.containers[n]=o);let i=o.querySelector(`.${r}`);return i||(i=document.createElement("div"),i.className=r,i.style.position="absolute",Object.assign(i.style,$2e[r]),o.append(i)),i}_updateContainers(){let t=this.deck.width,r=this.deck.height;for(let n in this.containers){let o=this.lastViewports[n]||null,i=n===SY||o,s=this.containers[n];i?(s.style.display="block",s.style.left=`${o?o.x:0}px`,s.style.top=`${o?o.y:0}px`,s.style.width=`${o?o.width:t}px`,s.style.height=`${o?o.height:r}px`):s.style.display="none"}}onRedraw({viewports:t,layers:r}){let n=t.reduce((i,s)=>(i[s.id]=s,i),{}),{lastViewports:o}=this;for(let i of this.getWidgets()){let{viewId:s}=i;if(s){let a=n[s];a&&(i.onViewportChange&&!a.equals(o[s])&&i.onViewportChange(a),i.onRedraw?.({viewports:[a],layers:r}))}else{if(i.onViewportChange)for(let a of t)a.equals(o[a.id])||i.onViewportChange(a);i.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(let n of this.getWidgets()){let{viewId:o}=n;(!o||o===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){let n=Fb[r.type];if(n)for(let o of this.getWidgets()){let{viewId:i}=o;(!i||i===t.viewport?.id)&&o[n.handler]?.(t,r)}}};var J2e={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},av=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,J2e),this.deck=t,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){let{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;let o=n(t);this.lastViewport=t.viewport,this.setTooltip(o,t.x,t.y)}setTooltip(t,r,n){let o=this.element;if(o){if(typeof t=="string")o.innerText=t;else if(t)t.text&&(o.innerText=t.text),t.html&&(o.innerHTML=t.html),t.className&&(o.className=t.className);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(o.style,t.style)}}};var yd;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(yd||(yd={}));var cv={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ko=(e,t,r)=>t?e.enable(r):e.disable(r),TY=(e,t,r)=>e.hint(r,t),el=(e,t,r)=>e.pixelStorei(r,t),EY=(e,t,r)=>{let n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},lv=(e,t,r)=>{let o={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];e.bindBuffer(o,t)};function l6(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var IY={3042:ko,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:ko,2885:(e,t)=>e.cullFace(t),2929:ko,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:ko,35723:TY,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:EY,36010:EY,34964:lv,36662:lv,36663:lv,35053:lv,35055:lv,2886:(e,t)=>e.frontFace(t),33170:TY,2849:(e,t)=>e.lineWidth(t),32823:ko,32824:"polygonOffset",10752:"polygonOffset",35977:ko,32926:ko,32928:ko,32938:"sampleCoverage",32939:"sampleCoverage",3089:ko,3088:(e,t)=>e.scissor(...t),2960:ko,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:ko,10754:ko,12288:ko,12289:ko,12290:ko,12291:ko,12292:ko,12293:ko,12294:ko,12295:ko,3333:el,3317:el,37440:el,37441:el,37443:el,3330:el,3332:el,3331:el,3314:el,32878:el,3316:el,3315:el,32877:el,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=l6(t)?t:[t,t];let[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=l6(t)&&t.length===3?[...t,...t]:t;let[r,n,o,i,s,a]=t;e.stencilFuncSeparate(1028,r,n,o),e.stencilFuncSeparate(1029,i,s,a)},stencilOp:(e,t)=>{t=l6(t)&&t.length===3?[...t,...t]:t;let[r,n,o,i,s,a]=t;e.stencilOpSeparate(1028,r,n,o),e.stencilOpSeparate(1029,i,s,a)},viewport:(e,t)=>e.viewport(...t)};function so(e,t,r){return t[e]!==void 0?t[e]:r[e]}var CY={blendEquation:(e,t,r)=>e.blendEquationSeparate(so(32777,t,r),so(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(so(32969,t,r),so(32968,t,r),so(32971,t,r),so(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(so(32824,t,r),so(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(so(32938,t,r),so(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,so(2962,t,r),so(2967,t,r),so(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,so(34816,t,r),so(36003,t,r),so(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,so(2964,t,r),so(2965,t,r),so(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,so(34817,t,r),so(34818,t,r),so(34819,t,r))},c6={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{let n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,o)=>e({32773:new Float32Array([t,r,n,o])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,n,o)=>e({32969:t,32968:r,32971:n,32970:o}),clearColor:(e,t,r,n,o)=>e({3106:new Float32Array([t,r,n,o])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,n,o)=>e({3107:[t,r,n,o]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,n,o)=>e({3088:new Int32Array([t,r,n,o])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({2962:t,2967:r,2963:n,34816:t,36003:r,36004:n}),stencilFuncSeparate:(e,t,r,n,o)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:o}),stencilOp:(e,t,r,n)=>e({2964:t,2965:r,2966:n,34817:t,34818:r,34819:n}),stencilOpSeparate:(e,t,r,n,o)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:o}),viewport:(e,t,r,n,o)=>e({2978:[t,r,n,o]})},mu=(e,t)=>e.isEnabled(t),u6={3042:mu,2884:mu,2929:mu,3024:mu,32823:mu,32926:mu,32928:mu,3089:mu,2960:mu,35977:mu},kY=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function mc(e,t){if(eAe(t))return;let r={};for(let o in t){let i=Number(o),s=IY[o];s&&(typeof s=="string"?r[s]=!0:s(e,t[o],i))}let n=e.state&&e.state.cache;if(n)for(let o in r){let i=CY[o];i(e,t,n)}}function pS(e,t=cv){if(typeof t=="number"){let o=t,i=u6[o];return i?i(e,o):e.getParameter(o)}let r=Array.isArray(t)?t:Object.keys(t),n={};for(let o of r){let i=u6[o];n[o]=i?i(e,Number(o)):e.getParameter(Number(o))}return n}function PY(e){mc(e,cv)}function eAe(e){for(let t in e)return!1;return!0}function OY(e,t){if(e===t)return!0;let r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let o=0;o<e.length;++o)if(e[o]!==t[o])return!1;return!0}return!1}var f6=class{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(t,{copyState:r=!1,log:n=()=>{}}={}){this.gl=t,this.cache=r?pS(t):Object.assign({},cv),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){Cn(this.stateStack.length>0);let t=this.stateStack[this.stateStack.length-1];mc(this.gl,t),this.stateStack.pop()}_updateCache(t){let r=!1,n,o=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let i in t){Cn(i!==void 0);let s=t[i],a=this.cache[i];OY(s,a)||(r=!0,n=a,o&&!(i in o)&&(o[i]=a),this.cache[i]=s)}return{valueChanged:r,oldValue:n}}};function qm(e){return e.state}function h6(e,t){let{enable:r=!0,copyState:n}=t;if(Cn(n!==void 0),!e.state){e.state=new f6(e,{copyState:n}),rAe(e);for(let i in c6){let s=c6[i];tAe(e,i,s)}RY(e,"getParameter"),RY(e,"isEnabled")}let o=qm(e);return o.enable=r,e}function xd(e){let t=qm(e);t||(h6(e,{copyState:!1}),t=qm(e)),t.push()}function Lf(e){let t=qm(e);Cn(t),t.pop()}function RY(e,t){let r=e[t].bind(e);e[t]=function(o){if(o===void 0||kY.has(o))return r(o);let i=qm(e);return o in i.cache||(i.cache[o]=r(o)),i.enable?i.cache[o]:r(o)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function tAe(e,t,r){if(!e[t])return;let n=e[t].bind(e);e[t]=function(...i){let s=qm(e),{valueChanged:a,oldValue:u}=r(s._updateCache,...i);return a&&n(...i),u},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function rAe(e){let t=e.useProgram.bind(e);e.useProgram=function(n){let o=qm(e);o.program!==n&&(t(n),o.program=n)}}var nAe={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function NY(e,t){t={...nAe,...t};let r=null,n=i=>r=i.statusMessage||r;e.addEventListener("webglcontextcreationerror",n,!1);let o=null;if(o||=e.getContext("webgl2",t),e.removeEventListener("webglcontextcreationerror",n,!1),!o)throw new Error(`Failed to create WebGL context: ${r||"Unknown error"}`);if(t.onContextLost){let{onContextLost:i}=t;e.addEventListener("webglcontextlost",s=>i(s),!1)}if(t.onContextRestored){let{onContextRestored:i}=t;e.addEventListener("webglcontextrestored",s=>i(s),!1)}return o}function Pl(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function zY(e,t){let r=e.getParameter(7936),n=e.getParameter(7937);Pl(e,"WEBGL_debug_renderer_info",t);let o=t.WEBGL_debug_renderer_info,i=e.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),s=e.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),a=i||r,u=s||n,h=e.getParameter(7938),p=DY(a,u),_=iAe(a,u),y=oAe(a,u);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:a,renderer:u,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function DY(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function iAe(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function oAe(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(DY(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function mS(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var Ls="texture-compression-bc",bi="texture-compression-astc",gu="texture-compression-etc2",sAe="texture-compression-etc1-webgl",gS="texture-compression-pvrtc-webgl",d6="texture-compression-atc-webgl",uv="float32-renderable-webgl",p6="float16-renderable-webgl",aAe="rgb9e5ufloat_renderable-webgl",m6="snorm8-renderable-webgl",fv="norm16-renderable-webgl",g6="snorm16-renderable-webgl",_S="float32-filterable",LY="float16-filterable-webgl",hv="WEBGL_compressed_texture_s3tc",dv="WEBGL_compressed_texture_s3tc_srgb",_0="EXT_texture_compression_rgtc",y0="EXT_texture_compression_bptc",lAe="WEBGL_compressed_texture_etc",cAe="WEBGL_compressed_texture_astc",uAe="WEBGL_compressed_texture_etc1",fAe="WEBGL_compressed_texture_pvrtc",hAe="WEBGL_compressed_texture_atc",FY="EXT_texture_norm16",BY="EXT_render_snorm",dAe="EXT_color_buffer_float",yS={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[BY],"norm16-renderable-webgl":[FY],"snorm16-renderable-webgl":[FY,BY],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[hv,dv,_0,y0],"texture-compression-bc5-webgl":[_0],"texture-compression-bc7-webgl":[y0],"texture-compression-etc2":[lAe],"texture-compression-astc":[cAe],"texture-compression-etc1-webgl":[uAe],"texture-compression-pvrtc-webgl":[fAe],"texture-compression-atc-webgl":[hAe]};function jY(e){return e in yS}function UY(e,t,r){return(yS[t]||[]).every(o=>Pl(e,o,r))}var xS={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:m6},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:m6},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:p6,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:fv,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:g6},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:m6},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:p6,filter:LY,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:fv},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:g6},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:uv,filter:_S},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:aAe},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:uv,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:fv},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:fv},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:uv,filter:_S,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:p6,filter:LY},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:fv,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:g6},"rgb32float-webgl":{gl:34837,render:uv,filter:_S,gl2ext:dAe,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:uv,filter:_S,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:hv,f:Ls},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:dv,f:Ls},"bc1-rgba-unorm":{gl:33777,x:hv,f:Ls},"bc1-rgba-unorm-srgb":{gl:35916,x:dv,f:Ls},"bc2-rgba-unorm":{gl:33778,x:hv,f:Ls},"bc2-rgba-unorm-srgb":{gl:35918,x:dv,f:Ls},"bc3-rgba-unorm":{gl:33779,x:hv,f:Ls},"bc3-rgba-unorm-srgb":{gl:35919,x:dv,f:Ls},"bc4-r-unorm":{gl:36283,x:_0,f:Ls},"bc4-r-snorm":{gl:36284,x:_0,f:Ls},"bc5-rg-unorm":{gl:36285,x:_0,f:Ls},"bc5-rg-snorm":{gl:36286,x:_0,f:Ls},"bc6h-rgb-ufloat":{gl:36495,x:y0,f:Ls},"bc6h-rgb-float":{gl:36494,x:y0,f:Ls},"bc7-rgba-unorm":{gl:36492,x:y0,f:Ls},"bc7-rgba-unorm-srgb":{gl:36493,x:y0,f:Ls},"etc2-rgb8unorm":{gl:37492,f:gu},"etc2-rgb8unorm-srgb":{gl:37494,f:gu},"etc2-rgb8a1unorm":{gl:37496,f:gu},"etc2-rgb8a1unorm-srgb":{gl:37497,f:gu},"etc2-rgba8unorm":{gl:37493,f:gu},"etc2-rgba8unorm-srgb":{gl:37495,f:gu},"eac-r11unorm":{gl:37488,f:gu},"eac-r11snorm":{gl:37489,f:gu},"eac-rg11unorm":{gl:37490,f:gu},"eac-rg11snorm":{gl:37491,f:gu},"astc-4x4-unorm":{gl:37808,f:bi},"astc-4x4-unorm-srgb":{gl:37840,f:bi},"astc-5x4-unorm":{gl:37809,f:bi},"astc-5x4-unorm-srgb":{gl:37841,f:bi},"astc-5x5-unorm":{gl:37810,f:bi},"astc-5x5-unorm-srgb":{gl:37842,f:bi},"astc-6x5-unorm":{gl:37811,f:bi},"astc-6x5-unorm-srgb":{gl:37843,f:bi},"astc-6x6-unorm":{gl:37812,f:bi},"astc-6x6-unorm-srgb":{gl:37844,f:bi},"astc-8x5-unorm":{gl:37813,f:bi},"astc-8x5-unorm-srgb":{gl:37845,f:bi},"astc-8x6-unorm":{gl:37814,f:bi},"astc-8x6-unorm-srgb":{gl:37846,f:bi},"astc-8x8-unorm":{gl:37815,f:bi},"astc-8x8-unorm-srgb":{gl:37847,f:bi},"astc-10x5-unorm":{gl:37819,f:bi},"astc-10x5-unorm-srgb":{gl:37851,f:bi},"astc-10x6-unorm":{gl:37817,f:bi},"astc-10x6-unorm-srgb":{gl:37849,f:bi},"astc-10x8-unorm":{gl:37818,f:bi},"astc-10x8-unorm-srgb":{gl:37850,f:bi},"astc-10x10-unorm":{gl:37819,f:bi},"astc-10x10-unorm-srgb":{gl:37851,f:bi},"astc-12x10-unorm":{gl:37820,f:bi},"astc-12x10-unorm-srgb":{gl:37852,f:bi},"astc-12x12-unorm":{gl:37821,f:bi},"astc-12x12-unorm-srgb":{gl:37853,f:bi},"pvrtc-rgb4unorm-webgl":{gl:35840,f:gS},"pvrtc-rgba4unorm-webgl":{gl:35842,f:gS},"pvrtc-rbg2unorm-webgl":{gl:35841,f:gS},"pvrtc-rgba2unorm-webgl":{gl:35843,f:gS},"etc1-rbg-unorm-webgl":{gl:36196,f:sAe},"atc-rgb-unorm-webgl":{gl:35986,f:d6},"atc-rgba-unorm-webgl":{gl:35986,f:d6},"atc-rgbai-unorm-webgl":{gl:34798,f:d6}},pAe={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},mAe={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function bS(e,t,r){let n=xS[t];if(!n||n.gl===void 0)return!1;let o=n.x||n.gl2ext;return o?!!Pl(e,o,r):!0}function _6(e){let r=xS[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}function VY(e,t,r){if(!bS(e,t,r)||t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(pM(t).signed)return!1}catch{return!1}return t.endsWith("32float")?!!Pl(e,"OES_texture_float_linear, extensions",r):t.endsWith("16float")?!!Pl(e,"OES_texture_half_float_linear, extensions",r):!0}function WY(e,t,r){return!(!bS(e,t,r)||typeof t=="number")}function x0(e){let t=xS[e],r=_6(e),n=pM(e);return{format:r,dataFormat:t?.dataFormat||gAe(n.format,n.integer,n.normalized,r),type:n.dataType?mS(n.dataType):t?.types?.[0]||5121,compressed:n.compressed}}function ZY(e){let t=xS[e];if(!t?.attachment)throw new Error(`${e} is not a depth stencil format`);return t.attachment}function y6(e){let t=x0(e),r=pAe[t.dataFormat]||4,n=mAe[t.type]||1;return r*n}function gAe(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;default:return 6408}}var YY={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},vS=class extends gb{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,Pl(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let t=this.getFeatures();for(let r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),jY(t)&&UY(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){let t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of t)this.has(r)}getFeatures(){return[...Object.keys(YY),...Object.keys(yS)]}getWebGLFeature(t){let r=YY[t];return typeof r=="string"?!!Pl(this.gl,r,this.extensions):!!r}};var wS=class extends mb{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]}};function Ol(e,t,r){if(_Ae(t))return r(e);let{nocatch:n=!0}=t;xd(e),mc(e,t);let o;if(n)o=r(e),Lf(e);else try{o=r(e)}finally{Lf(e)}return o}function _Ae(e){for(let t in e)return!1;return!0}function GY(e,t,r,n){if(sd(t))return n(e);let o=e;xd(o.gl);try{return yAe(e,t),mc(o.gl,r),n(e)}finally{Lf(o.gl)}}function yAe(e,t){let r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Gm("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let i=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Gm("provokingVertex",t.provokingVertex,{first:36429,last:36430});i?.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let i=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Gm("polygonMode",t.polygonMode,{fill:6914,line:6913});i?.polygonModeWEBGL(1028,s),i?.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(bAe("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(MS("depthCompare",t.depthCompare))),t.stencilWriteMask){let o=t.stencilWriteMask;n.stencilMaskSeparate(1028,o),n.stencilMaskSeparate(1029,o)}if(t.stencilReadMask&&Ut.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let o=t.stencilReadMask||4294967295,i=MS("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,i,0,o),n.stencilFuncSeparate(1029,i,0,o)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let o=x6("stencilPassOperation",t.stencilPassOperation),i=x6("stencilFailOperation",t.stencilFailOperation),s=x6("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,i,s,o),n.stencilOpSeparate(1029,i,s,o)}if(t.blendColorOperation||t.blendAlphaOperation){n.enable(3042);let o=qY("blendColorOperation",t.blendColorOperation||"add"),i=qY("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(o,i);let s=AS("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=AS("blendColorDstFactor",t.blendColorDstFactor||"zero"),u=AS("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),h=AS("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(s,a,u,h)}}function MS(e,t){return Gm(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function x6(e,t){return Gm(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function qY(e,t){return Gm(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function AS(e,t){return Gm(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function xAe(e,t){return`Illegal parameter ${t} for ${e}`}function Gm(e,t,r){if(!(t in r))throw new Error(xAe(e,t));return r[t]}function bAe(e,t){return t}function SS(e){let t={};return e.addressModeU&&(t[10242]=b6(e.addressModeU)),e.addressModeV&&(t[10243]=b6(e.addressModeV)),e.addressModeW&&(t[32882]=b6(e.addressModeW)),e.magFilter&&(t[10240]=HY(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=vAe(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=MS("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function b6(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function HY(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function vAe(e,t){if(!t)return HY(e);switch(e){case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}var ia=class extends qn{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;let n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=wAe(this.props.usage),this.glUsage=AAe(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,n=t.byteLength+r){let o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,n,this.glUsage),this.gl.bufferSubData(o,r,t),this.gl.bindBuffer(o,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){Cn(t>=0);let r=t;t===0&&(r=new Float32Array(0));let n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;let n=new Uint8Array(r),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,o,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}};function wAe(e){return e&qn.INDEX?34963:e&qn.VERTEX?34962:e&qn.UNIFORM?35345:34962}function AAe(e){return e&qn.INDEX||e&qn.VERTEX?35044:e&qn.UNIFORM?35048:35044}var Hm=class extends Om{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=SS(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(let[r,n]of Object.entries(t)){let o=Number(r);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,n);break;default:this.device.gl.samplerParameteri(this.handle,o,n);break}}}};var gc=class extends km{device;gl;handle;texture;constructor(t,r){super(t,{...Io.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var MAe={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Pa=class e extends Io{static FACES=[34069,34070,34071,34072,34073,34074];MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(t,r){super(t,{...MAe,format:"rgba8unorm",...r}),this.device=t,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=SAe(this.props),this.loaded=!1,typeof this.props?.data=="string"&&Object.assign(this.props,{data:gP(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(t){return new gc(this.device,{...t,texture:this})}initialize(t={}){if(this.props.dimension==="cube")return this.initializeCube(t);let r=t.data;if(r instanceof Promise)return r.then(P=>this.initialize(Object.assign({},t,{pixels:P,data:P}))),this;let n=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(t)),this;let{parameters:o={}}=t,{pixels:i=null,pixelStore:s={},textureUnit:a=void 0,mipmaps:u=!0}=t;r||(r=i);let{width:h,height:p,dataFormat:_,type:y,compressed:A=!1}=t,{depth:E=0}=t,k=_6(t.format);return{width:h,height:p,compressed:A,dataFormat:_,type:y}=this._deduceParameters({format:t.format,type:y,dataFormat:_,compressed:A,data:r,width:h,height:p}),this.width=h,this.height=p,this.glFormat=k,this.type=y,this.dataFormat=_,this.textureUnit=a,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=u,this.setImageData({data:r,width:h,height:p,depth:E,format:k,type:y,dataFormat:_,parameters:s,compressed:A}),this.setSampler(t.sampler),this._setSamplerParameters(o),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),u&&this.device.isTextureFormatFilterable(t.format)&&this.generateMipmap(),n&&(this._video={video:r,parameters:o,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(t){let{mipmaps:r=!0,parameters:n={}}=t;return this.setCubeMapImageData(t).then(()=>{this.loaded=!0,r&&this.generateMipmap(t),this.setSampler(t.sampler),this._setSamplerParameters(n)}),this}setSampler(t={}){let r;t instanceof Hm?(this.sampler=t,r=t.props):(this.sampler=new Hm(this.device,t),r=t);let n=SS(r);return this._setSamplerParameters(n),this}resize(t){let{height:r,width:n,mipmaps:o=!1}=t;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:o}):this}update(){if(this._video){let{video:t,parameters:r,lastTime:n}=this._video;if(n===t.currentTime||t.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:t,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=t.currentTime}}generateMipmap(t={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ol(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(t){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(t);this.trackDeallocatedMemory("Texture");let{target:r=this.target,pixels:n=null,level:o=0,glFormat:i=this.glFormat,offset:s=0,parameters:a={}}=t,{data:u=null,type:h=this.type,width:p=this.width,height:_=this.height,dataFormat:y=this.dataFormat,compressed:A=!1}=t;u||(u=n),{type:h,dataFormat:y,compressed:A,width:p,height:_}=this._deduceParameters({format:this.props.format,type:h,dataFormat:y,compressed:A,data:u,width:p,height:_});let{gl:E}=this;E.bindTexture(this.target,this.handle);let k=null;if({data:u,dataType:k}=this._getDataType({data:u,compressed:A}),Ol(this.gl,a,()=>{switch(k){case"null":E.texImage2D(r,o,i,p,_,0,y,h,u);break;case"typed-array":E.texImage2D(r,o,i,p,_,0,y,h,u,s);break;case"buffer":this.device.gl.bindBuffer(35052,u.handle||u),this.device.gl.texImage2D(r,o,i,p,_,0,y,h,s),this.device.gl.bindBuffer(35052,null);break;case"browser-object":E.texImage2D(r,o,i,p,_,0,y,h,u);break;case"compressed":for(let[P,R]of u.entries())E.compressedTexImage2D(r,P,R.format,R.width,R.height,0,R.data);break;default:Cn(!1,"Unknown image data type")}}),u&&u.byteLength)this.trackAllocatedMemory(u.byteLength,"Texture");else{let P=y6(this.props.format);this.trackAllocatedMemory(this.width*this.height*P,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:r=null,data:n=null,x:o=0,y:i=0,width:s=this.width,height:a=this.height,level:u=0,glFormat:h=this.glFormat,type:p=this.type,dataFormat:_=this.dataFormat,compressed:y=!1,offset:A=0,parameters:E={}}){if({type:p,dataFormat:_,compressed:y,width:s,height:a}=this._deduceParameters({format:this.props.format,type:p,dataFormat:_,compressed:y,data:n,width:s,height:a}),Cn(this.depth===1,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){let k=n;n=k.data,s=k.shape[0],a=k.shape[1]}n instanceof ia&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Ol(this.gl,E,()=>{y?this.gl.compressedTexSubImage2D(t,u,o,i,s,a,h,n):n===null?this.gl.texSubImage2D(t,u,o,i,s,a,_,p,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(t,u,o,i,s,a,_,p,n,A):typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(t,u,o,i,s,a,_,p,A),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(t,u,o,i,s,a,_,p,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return Ut.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t=this.textureUnit){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.target,null),t}_getDataType({data:t,compressed:r=!1}){return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ia?{data:t.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){let{format:r,data:n}=t,{width:o,height:i,dataFormat:s,type:a,compressed:u}=t,h=x0(r);return s=s||h.dataFormat,a=a||h.type,u=u||h.compressed,{width:o,height:i}=this._deduceImageSize(n,o,i),{dataFormat:s,type:a,compressed:u,width:o,height:i,format:r,data:n}}_deduceImageSize(t,r,n){let o;return typeof ImageData<"u"&&t instanceof ImageData?o={width:t.width,height:t.height}:typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement?o={width:t.naturalWidth,height:t.naturalHeight}:typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement?o={width:t.width,height:t.height}:typeof ImageBitmap<"u"&&t instanceof ImageBitmap?o={width:t.width,height:t.height}:typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?o={width:t.videoWidth,height:t.videoHeight}:t?o={width:r,height:n}:o={width:r>=0?r:1,height:n>=0?n:1},Cn(o,"Could not deduced texture size"),Cn(r===void 0||o.width===r,"Deduced texture width does not match supplied width"),Cn(n===void 0||o.height===n,"Deduced texture height does not match supplied height"),o}async setCubeMapImageData(t){let{gl:r}=this,{width:n,height:o,pixels:i,data:s,format:a=6408,type:u=5121}=t,h=i||s,p=await Promise.all(e.FACES.map(_=>{let y=h[_];return Promise.all(Array.isArray(y)?y:[y])}));this.bind(),e.FACES.forEach((_,y)=>{p[y].length>1&&this.props.mipmaps!==!1&&Ut.warn(`${this.id} has mipmap and multiple LODs.`)(),p[y].forEach((A,E)=>{n&&o?r.texImage2D(_,E,a,n,o,0,a,u,A):r.texImage2D(_,E,a,a,u,A)})}),this.unbind()}setImageDataForFace(t){let{face:r,width:n,height:o,pixels:i,data:s,format:a=6408,type:u=5121}=t,{gl:h}=this,p=i||s;return this.bind(),p instanceof Promise?p.then(_=>this.setImageDataForFace(Object.assign({},t,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,a,n,o,0,a,u,p):h.texImage2D(r,0,a,a,u,p),this}setImageData3D(t){let{level:r=0,dataFormat:n,format:o,type:i,width:s,height:a,depth:u=1,offset:h=0,data:p,parameters:_={}}=t;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);let y=x0(o);if(Ol(this.gl,_,()=>{ArrayBuffer.isView(p)&&this.gl.texImage3D(this.target,r,y.format,s,a,u,0,y.dataFormat,y.type,p),p instanceof ia&&(this.gl.bindBuffer(35052,p.handle),this.gl.texImage3D(this.target,r,n,s,a,u,0,o,i,h))}),p&&p.byteLength)this.trackAllocatedMemory(p.byteLength,"Texture");else{let A=y6(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*A,"Texture")}return this.loaded=!0,this}_setSamplerParameters(t){if(!sd(t)){TAe(t),this.gl.bindTexture(this.target,this.handle);for(let[r,n]of Object.entries(t)){let o=Number(r),i=n;switch(o){case 33082:case 33083:this.gl.texParameterf(this.target,o,i);break;default:this.gl.texParameteri(this.target,o,i);break}}this.gl.bindTexture(this.target,null)}}};function SAe(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(e.dimension)}}function TAe(e){Ut.log(1,"texture sampler parameters",e)()}var _u=class extends Rm{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(t,r){super(t,r);let n=r.handle===null;if(this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();let o=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){let s=this.colorAttachments[i],a=36064+i;s&&this._attachOne(a,s)}if(this.depthStencilAttachment&&this._attachOne(ZY(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){let i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${IAe(i)}`)}this.gl.bindFramebuffer(36160,o)}}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(t){return new Pa(this.device,{id:`${this.id}-depth-stencil`,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(let n of this.colorAttachments)n.texture.resize({width:t,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:t,height:r}),this}_attachOne(t,r){if(Array.isArray(r)){let[n,o=0,i=0]=r;return this._attachTexture(t,n,o,i),n}if(r instanceof Pa)return this._attachTexture(t,r,0,0),r;if(r instanceof gc){let n=r;return this._attachTexture(t,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(t,r,n,o){let{gl:i}=this.device;switch(i.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:i.framebufferTextureLayer(36160,t,r.target,o,n);break;case 34067:let s=EAe(n);i.framebufferTexture2D(36160,t,s,r.handle,o);break;case 3553:i.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Cn(!1,"Illegal texture type")}i.bindTexture(r.target,null)}};function EAe(e){return e<34069?e+34069:e}function IAe(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}var TS=class extends Cm{device;presentationSize;_framebuffer=null;constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new _u(this.device,{handle:null}),this._framebuffer}update(){let t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}};var CAe={spector:Ut.get("spector")||Ut.get("spectorjs")},kAe="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",PAe=1,Oa=null,XY=!1;async function KY(e){if(!globalThis.SPECTOR)try{await Eb(kAe)}catch(t){Ut.warn(String(t))}}function $Y(e){if(e={...CAe,...e},!e?.spector||(!Oa&&globalThis.SPECTOR&&(Ut.probe(PAe,"SPECTOR found and initialized")(),Oa=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Oa)),!Oa))return null;if(XY||(XY=!0,Oa.spyCanvases(),Oa?.onCaptureStarted.add(t=>Ut.info("Spector capture started:",t)()),Oa?.onCapture.add(t=>{Ut.info("Spector capture complete:",t)(),Oa?.getResultUI(),Oa?.resultView.display(),Oa?.resultView.addCapture(t)})),e?.canvas){if(typeof e.spector=="string"&&e.spector!==e.canvas.id)return Oa;Oa?.startCapture(e?.canvas,500),new Promise(t=>setTimeout(t,2e3)).then(t=>{Ut.info("Spector capture stopped after 2 seconds")(),Oa?.stopCapture()})}return Oa}var OAe="https://unpkg.com/webgl-debug@2.0.1/index.js";function QY(e){return e.luma=e.luma||{},e.luma}async function JY(){zs()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Eb(OAe))}function eq(e,t={}){return e?t.debug?NAe(e,t):RAe(e):null}function RAe(e){let t=QY(e);return t.realContext?t.realContext:e}function NAe(e,t){if(!globalThis.WebGLDebugUtils)return Ut.warn("webgl-debug not loaded")(),e;let r=QY(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...yd,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,zAe.bind(null,t),DAe.bind(null,t));for(let s in yd)!(s in n)&&typeof yd[s]=="number"&&(n[s]=yd[s]);class o{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(o,n);let i=Object.create(o);return r.realContext=e,r.debugContext=i,i.debug=!0,i}function v6(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function zAe(e,t,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);let o=globalThis.WebGLDebugUtils.glEnumToString(t),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),s=`${o} in gl.${r}(${i})`;Ut.error(s)();debugger;if(e.throwOnError)throw new Error(s)}function DAe(e,t,r){let n="";if(Ut.level>=1&&(n=v6(t,r),Ut.log(1,n)()),e.break&&e.break.length>0&&(n=n||v6(t,r),e.break.every(i=>n.indexOf(i)!==-1)))debugger;for(let o of r)if(o===void 0){if(n=n||v6(t,r),e.throwOnError)throw new Error(`Undefined argument: ${n}`);Ut.error(`Undefined argument: ${n}`)();debugger}}function rq(e){let t=e.split(/\r?\n/),r=[];for(let n of t){if(n.length<=1)continue;let o=n.split(":");if(o.length===2){let[_,y]=o;r.push({message:y.trim(),type:tq(_),lineNum:0,linePos:0});continue}let[i,s,a,...u]=o,h=parseInt(a,10);isNaN(h)&&(h=0);let p=parseInt(s,10);isNaN(p)&&(p=0),r.push({message:u.join(":").trim(),type:tq(i),lineNum:h,linePos:p})}return r}function tq(e){let t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}var ES=class extends Pm{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let t=this.device.gl.getShaderInfoLog(this.handle);return rq(t)}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)}async _compile(t){t=(o=>o.startsWith("#version ")?o:`#version 100
${o}`)(t);let{gl:n}=this.device;if(n.shaderSource(this.handle,t),n.compileShader(this.handle),Ut.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Ut.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ut.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let t=async o=>await new Promise(i=>setTimeout(i,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};var LAe=256,FAe=1024,BAe=16384,w6=6144,jAe=[1,2,4,8],IS=class extends yb{device;glParameters;constructor(t,r){super(t,r),this.device=t,xd(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Lf(this.device.gl)}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){let r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=jAe.map(n=>!!(n&t.colorMask))),this.glParameters=r,mc(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let t={...this.glParameters},r=0;this.props.clearColor!==!1&&(r|=BAe,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=LAe,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=FAe,t.clearStencil=this.props.clearStencil),r!==0&&Ol(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){Ol(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(w6,t,r);break;case Uint32Array:this.device.gl.clearBufferuiv(w6,t,r);break;case Float32Array:default:this.device.gl.clearBufferfv(w6,t,r);break}})}};var UAe="Failed to deduce GL constant from typed array";function nq(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(UAe)}}function pv(e,t){let{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}var VAe={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},WAe={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},CS=class e{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(t){return pv(t.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return Cn(t.size),pv(t.type||5126).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new e(VAe,...t)}constructor(...t){t.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return e.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return e.getBytesPerVertex(this)}_assign(t={}){return t=mP("Accessor",t,WAe),t.type!==void 0&&(this.type=t.type,(t.type===5124||t.type===5125)&&(this.integer=!0)),t.size!==void 0&&(this.size=t.size),t.offset!==void 0&&(this.offset=t.offset),t.stride!==void 0&&(this.stride=t.stride),t.normalize!==void 0&&(this.normalized=t.normalize),t.normalized!==void 0&&(this.normalized=t.normalized),t.integer!==void 0&&(this.integer=t.integer),t.divisor!==void 0&&(this.divisor=t.divisor),t.buffer!==void 0&&(this.buffer=t.buffer),t.index!==void 0&&(typeof t.index=="boolean"?this.index=t.index?1:0:this.index=t.index),t.instanced!==void 0&&(this.divisor=t.instanced?1:0),t.isInstanced!==void 0&&(this.divisor=t.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}};function iq(e){return ZAe.includes(e)}var ZAe=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],oq={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function A6(e){let t=oq[e];if(!t)throw new Error("uniform");let[r,n,,o]=t;return{format:o,components:n,glType:r}}function sq(e){let t=oq[e];if(!t)throw new Error("attribute");let[,r,,n,o]=t;return{attributeType:n,vertexFormat:o,components:r}}function aq(e,t){let r={attributes:[],bindings:[]};r.attributes=YAe(e,t);let n=HAe(e,t);for(let a of n){let u=a.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));r.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:u})}let o=GAe(e,t),i=0;for(let a of o)if(iq(a.type)){let{viewDimension:u,sampleType:h}=KAe(a.type);r.bindings.push({type:"texture",name:a.name,location:i,viewDimension:u,sampleType:h}),a.textureUnit=i,i+=1}o.length&&(r.uniforms=o);let s=qAe(e,t);return s?.length&&(r.varyings=s),r}function YAe(e,t){let r=[],n=e.getProgramParameter(t,35721);for(let o=0;o<n;o++){let i=e.getActiveAttrib(t,o);if(!i)throw new Error("activeInfo");let{name:s,type:a}=i,u=e.getAttribLocation(t,s);if(u>=0){let{attributeType:h}=sq(a),p=/instance/i.test(s)?"instance":"vertex";r.push({name:s,location:u,stepMode:p,type:h})}}return r.sort((o,i)=>o.location-i.location),r}function qAe(e,t){let r=[],n=e.getProgramParameter(t,35971);for(let o=0;o<n;o++){let i=e.getTransformFeedbackVarying(t,o);if(!i)throw new Error("activeInfo");let{name:s,type:a,size:u}=i,{glType:h,components:p}=A6(a),_=new CS({type:h,size:u*p}),y={location:o,name:s,accessor:_};r.push(y)}return r.sort((o,i)=>o.location-i.location),r}function GAe(e,t){let r=[],n=e.getProgramParameter(t,35718);for(let o=0;o<n;o++){let i=e.getActiveUniform(t,o);if(!i)throw new Error("activeInfo");let{name:s,size:a,type:u}=i,{name:h,isArray:p}=$Ae(s),_=e.getUniformLocation(t,h),y={location:_,name:h,size:a,type:u,isArray:p};if(r.push(y),y.size>1)for(let A=0;A<y.size;A++){let E=`${h}[${A}]`;_=e.getUniformLocation(t,E);let k={...y,name:E,location:_};r.push(k)}}return r}function HAe(e,t){let r=(i,s)=>e.getActiveUniformBlockParameter(t,i,s),n=[],o=e.getProgramParameter(t,35382);for(let i=0;i<o;i++){let s={name:e.getActiveUniformBlockName(t,i)||"",location:r(i,35391),byteLength:r(i,35392),vertex:r(i,35396),fragment:r(i,35398),uniformCount:r(i,35394),uniforms:[]},a=r(i,35395)||[],u=e.getActiveUniforms(t,a,35383),h=e.getActiveUniforms(t,a,35384),p=e.getActiveUniforms(t,a,35387),_=e.getActiveUniforms(t,a,35388);for(let y=0;y<s.uniformCount;++y){let A=e.getActiveUniform(t,a[y]);if(!A)throw new Error("activeInfo");s.uniforms.push({name:A.name,format:A6(u[y]).format,type:u[y],arrayLength:h[y],byteOffset:p[y],byteStride:_[y]})}n.push(s)}return n.sort((i,s)=>i.location-s.location),n}var XAe={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function KAe(e){let t=XAe[e];if(!t)throw new Error("sampler");let[r,n]=t;return{viewDimension:r,sampleType:n}}function $Ae(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function lq(e,t,r,n){let o=e,i=n;i===!0&&(i=1),i===!1&&(i=0);let s=typeof i=="number"?[i]:i;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:return e.uniform1iv(t,s);case 35667:return e.uniform2iv(t,s);case 35668:return e.uniform3iv(t,s);case 35669:return e.uniform4iv(t,s);case 35670:return e.uniform1iv(t,s);case 35671:return e.uniform2iv(t,s);case 35672:return e.uniform3iv(t,s);case 35673:return e.uniform4iv(t,s);case 5125:return o.uniform1uiv(t,s,1);case 36294:return o.uniform2uiv(t,s,2);case 36295:return o.uniform3uiv(t,s,3);case 36296:return o.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return o.uniformMatrix2x3fv(t,!1,s);case 35686:return o.uniformMatrix2x4fv(t,!1,s);case 35687:return o.uniformMatrix3x2fv(t,!1,s);case 35688:return o.uniformMatrix3x4fv(t,!1,s);case 35689:return o.uniformMatrix4x2fv(t,!1,s);case 35690:return o.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}function cq(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}function uq(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(e)}}var fq=4,kS=class extends cu{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:n,bufferMode:o=35981}=r;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,o)),this._linkShaders(),Ut.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=aq(this.device.gl,this.handle),Ut.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=fP(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Ut.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break;default:}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(let[n,o]of Object.entries(t)){let i=this.shaderLayout.bindings.find(s=>s.name===n)||this.shaderLayout.bindings.find(s=>s.name===`${n}Uniforms`);if(!i){let s=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||Ut.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${s}`)();continue}switch(o||Ut.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),i.type){case"uniform":if(!(o instanceof ia)&&!(o.buffer instanceof ia))throw new Error("buffer value");break;case"texture":if(!(o instanceof gc||o instanceof Pa||o instanceof _u))throw new Error("texture value");break;case"sampler":Ut.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(i.type)}this.bindings[n]=o}}draw(t){let{renderPass:r,parameters:n=this.props.parameters,topology:o=this.props.topology,vertexArray:i,vertexCount:s,instanceCount:a,isInstanced:u=!1,firstVertex:h=0,transformFeedback:p}=t,_=cq(o),y=!!i.indexBuffer,A=i.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Ut.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||s===0)return Ut.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(s===0)return Ut.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),i.bindBeforeRender(r),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let E=r;return GY(this.device,n,E.glParameters,()=>{y&&u?this.device.gl.drawElementsInstanced(_,s||0,A,h,a||0):y?this.device.gl.drawElements(_,s||0,A,h):u?this.device.gl.drawArraysInstanced(_,h,s||0,a||0):this.device.gl.drawArrays(_,h,s||0),p&&p.end()}),i.unbindAfterRender(r),!0}setUniformsWebGL(t){let{bindings:r}=Tb(t);Object.keys(r).forEach(n=>{Ut.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){let{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),Ut.time(fq,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),Ut.timeEnd(fq,`linkProgram for ${this.id}`)(),Ut.level,!this.device.features.has("compilation-status-async-webgl")){let n=this._getLinkStatus();this._reportLinkStatus(n);return}Ut.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ut.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(t){switch(t){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):this.fs?.compilationStatus==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${t}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){let{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let t=async o=>await new Promise(i=>setTimeout(i,o));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(let[,r]of Object.entries(this.bindings))r instanceof Pa&&(r.update(),t=t&&r.loaded);return t}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(let o of this.shaderLayout.bindings){let i=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!i)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":let{name:s}=o,a=t.getUniformBlockIndex(this.handle,s);if(a===4294967295)throw new Error(`Invalid uniform block name ${s}`);t.uniformBlockBinding(this.handle,n,a),i instanceof ia?t.bindBufferBase(35345,n,i.handle):t.bindBufferRange(35345,n,i.buffer.handle,i.offset||0,i.size||i.buffer.byteLength-i.offset),n+=1;break;case"texture":if(!(i instanceof gc||i instanceof Pa||i instanceof _u))throw new Error("texture");let u;if(i instanceof gc)u=i.texture;else if(i instanceof Pa)u=i;else if(i instanceof _u&&i.colorAttachments[0]instanceof gc)Ut.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=i.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(u.target,u.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(let t of this.shaderLayout.uniforms||[]){let{name:r,location:n,type:o,textureUnit:i}=t,s=this.uniforms[r]??i;s!==void 0&&lq(this.device.gl,n,o,s)}}};var PS=class extends bb{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(let r of t)switch(r.name){case"copy-buffer-to-buffer":QAe(this.device,r.options);break;case"copy-buffer-to-texture":JAe(this.device,r.options);break;case"copy-texture-to-buffer":eMe(this.device,r.options);break;case"copy-texture-to-texture":tMe(this.device,r.options);break}}};function QAe(e,t){let r=t.source,n=t.destination;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function JAe(e,t){throw new Error("Not implemented")}function eMe(e,t){let{source:r,mipLevel:n=0,aspect:o="all",width:i=t.source.width,height:s=t.source.height,depthOrArrayLayers:a=0,origin:u=[0,0],destination:h,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=t;if(o!=="all")throw new Error("not supported");if(n!==0||a!==0||_||y)throw new Error("not implemented");let{framebuffer:A,destroyFramebuffer:E}=hq(r),k;try{let P=h,R=i||A.width,V=s||A.height,N=x0(A.texture.props.format),j=N.dataFormat,J=N.type;e.gl.bindBuffer(35051,P.handle),k=e.gl.bindFramebuffer(36160,A.handle),e.gl.readPixels(u[0],u[1],R,V,j,J,p)}finally{e.gl.bindBuffer(35051,null),k!==void 0&&e.gl.bindFramebuffer(36160,k),E&&A.destroy()}}function tMe(e,t){let{source:r,destinationMipLevel:n=0,origin:o=[0,0],destinationOrigin:i=[0,0],destination:s}=t,{width:a=t.destination.width,height:u=t.destination.height}=t,{framebuffer:h,destroyFramebuffer:p}=hq(r),[_,y]=o,[A,E,k]=i,P=e.gl.bindFramebuffer(36160,h.handle),R=null,V;if(s instanceof Pa)R=s,a=Number.isFinite(a)?a:R.width,u=Number.isFinite(u)?u:R.height,R.bind(0),V=R.target;else throw new Error("invalid destination");switch(V){case 3553:case 34067:e.gl.copyTexSubImage2D(V,n,A,E,_,y,a,u);break;case 35866:case 32879:e.gl.copyTexSubImage3D(V,n,A,E,k,_,y,a,u);break;default:}R&&R.unbind(),e.gl.bindFramebuffer(36160,P),p&&h.destroy()}function hq(e){if(e instanceof Io){let{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var OS=class extends xb{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new PS(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}};var RS=class e extends vb{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return y5()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){let r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){let n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:o,type:i,stride:s,offset:a,normalized:u,integer:h,divisor:p}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),h?this.device.gl.vertexAttribIPointer(t,o,i,s,a):this.device.gl.vertexAttribPointer(t,o,i,u,s,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,p||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){let r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){let r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);let n=mS(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){let o=e.isConstantAttributeZeroSupported(this.device)||t!==0;(r||o)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){let n=rMe(r),o=n.byteLength*t,i=n.length*t;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),s=s||!nMe(n,this.bufferValue),s){let a=hP(r.constructor,i);dP({target:a,source:n,start:0,count:i}),this.buffer.write(a),this.bufferValue=r}return this.buffer}};function rMe(e){return Array.isArray(e)?new Float32Array(e):e}function nMe(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var NS=class extends wb{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(uq(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){let n=this._getVaryingIndex(t),{buffer:o,byteLength:i,byteOffset:s}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=o,Ut.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:o,byteLength:i,byteOffset:s},this.bindOnUse||this._bindBuffer(n,o,s,i)}getBuffer(t){if(dq(t))return this.buffers[t]||null;let r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof ia)return{buffer:t,byteOffset:0,byteLength:t.byteLength};let{buffer:r,byteOffset:n=0,byteLength:o=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:o}}_getVaryingIndex(t){if(dq(t))return Number(t);for(let r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(let t in this.buffers){let{buffer:r,byteLength:n,byteOffset:o}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,o,n)}}_unbindBuffers(){for(let t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,o){let i=r&&r.handle;!i||o===void 0?this.gl.bindBufferBase(35982,t,i):this.gl.bindBufferRange(35982,t,i,n,o)}};function dq(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}var zS=class extends Ab{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,o)=>{let i=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}};function M6(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Cn(!1),0}}function pq(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Cn(!1),0}}function mq(e,t){let{sourceX:r=0,sourceY:n=0,sourceFormat:o=6408,sourceAttachment:i=36064}=t||{},{target:s=null,sourceWidth:a,sourceHeight:u,sourceType:h}=t||{},{framebuffer:p,deleteFramebuffer:_}=_q(e);Cn(p);let{gl:y,handle:A}=p;a=a||p.width,u=u||p.height;let E=i-36064;h=h||p.colorAttachments[E]?.texture?.type||5121,s=oMe(s,h,o,a,u),h=h||nq(s);let k=y.bindFramebuffer(36160,A);return y.readPixels(r,n,a,u,o,h,s),y.bindFramebuffer(36160,k||null),_&&p.destroy(),s}function gq(e,t){let{target:r,sourceX:n=0,sourceY:o=0,sourceFormat:i=6408,targetByteOffset:s=0}=t||{},{sourceWidth:a,sourceHeight:u,sourceType:h}=t||{},{framebuffer:p,deleteFramebuffer:_}=_q(e);Cn(p),a=a||p.width,u=u||p.height;let y=p;h=h||5121;let A=r;if(!A){let k=M6(i),P=pq(h),R=s+a*u*k*P;A=y.device.createBuffer({byteLength:R})}let E=e.device.createCommandEncoder();return E.copyTextureToBuffer({source:e,width:a,height:u,origin:[n,o],destination:A,byteOffset:s}),E.destroy(),_&&p.destroy(),A}function _q(e){return e instanceof Rm?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:iMe(e),deleteFramebuffer:!0}}function iMe(e,t){let{device:r,width:n,height:o,id:i}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${i}`,width:n,height:o,colorAttachments:[e]})}function oMe(e,t,r,n,o){if(e)return e;t=t||5121;let i=pv(t,{clamped:!1}),s=M6(r);return new i(n*o*s)}var sMe=256,aMe=1024,lMe=16384;var cMe="clear: bad arguments";function yq(e,t){let{framebuffer:r=null,color:n=null,depth:o=null,stencil:i=null}=t||{},s={};r&&(s.framebuffer=r);let a=0;n&&(a|=lMe,n!==!0&&(s.clearColor=n)),o&&(a|=sMe,o!==!0&&(s.clearDepth=o)),i&&(a|=aMe,o!==!0&&(s.clearStencil=o)),Cn(a!==0,cMe);let u=e.gl;Ol(u,s,()=>{u.clear(a)})}var mv=1,Xm=class e extends Ef{static type="webgl";type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(t){if(t instanceof e)return t;if(t?.device instanceof Ef)return t.device;if(!uMe(t))throw new Error("Invalid WebGL2RenderingContext");return new e({gl:t})}static async create(t={}){Ut.groupCollapsed(mv,"WebGLDevice created")();let r=[];t.debug&&r.push(JY()),t.spector&&r.push(KY()),typeof t.canvas=="string"&&r.push(Cm.pageLoaded);let n=await Promise.allSettled(r);for(let s of n)s.status==="rejected"&&Ut.error(`Failed to initialize debug libraries ${s.reason}`)();if(Ut.probe(mv+1,"DOM is loaded")(),t.gl?.device)return Ut.warn("reattaching existing device")(),e.attach(t.gl);let o=new e(t),i=`Created ${o.type}${o.debug?" debug":""} context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Ut.probe(mv,i)(),Ut.table(mv,o.info)(),Ut.groupEnd(mv)(),o}constructor(t){super({...t,id:t.id||ra("webgl-device")});let r=t.gl?.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);let n=t.gl?.canvas||t.canvas;this.canvasContext=new TS(this,{...t,canvas:n}),this.lost=new Promise(a=>{this._resolveContextLost=a});let o=t.gl||null;if(o||=NY(this.canvasContext.canvas,{...t,onContextLost:a=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!o)throw new Error("WebGL context creation failed");this.handle=o,this.gl=o,this.gl.device=this,this.gl._version=2,t.spector&&(this.spectorJS=$Y({...this.props,canvas:this.handle.canvas})),this.info=zY(this.gl,this._extensions),this.limits=new wS(this.gl),this.features=new vS(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();let{enable:i=!0,copyState:s=!1}=t;h6(this.gl,{enable:i,copyState:s,log:(...a)=>Ut.log(1,...a)()}),t.debug&&(this.gl=eq(this.gl,{...t,throwOnError:!0}),this.debug=!0,Ut.level=Math.max(Ut.level,1),Ut.warn("WebGL debug mode activated. Performance reduced.")())}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(t){return bS(this.gl,t,this._extensions)}isTextureFormatFilterable(t){return VY(this.gl,t,this._extensions)}isTextureFormatRenderable(t){return WY(this.gl,t,this._extensions)}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){let r=this._getBufferProps(t);return new ia(this,r)}_createTexture(t){return new Pa(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Hm(this,t)}createShader(t){return new ES(this,t)}createFramebuffer(t){return new _u(this,t)}createVertexArray(t){return new RS(this,t)}createTransformFeedback(t){return new NS(this,t)}createQuerySet(t){return new zS(this,t)}createRenderPipeline(t){return new kS(this,t)}beginRenderPass(t){return new IS(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t){return new OS(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return mq(t,r)}readPixelsToBufferWebGL(t,r){return gq(t,r)}setParametersWebGL(t){mc(this.gl,t)}getParametersWebGL(t){return pS(this.gl,t)}withParametersWebGL(t,r){return Ol(this.gl,t,r)}clearWebGL(t){yq(this,t)}resetWebGL(){Ut.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),PY(this.gl)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let t=!1,n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){xd(this.gl)}popState(){Lf(this.gl)}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){r=r||this.gl2||this.gl;let n=Number(t);for(let o in r)if(r[o]===n)return`GL.${o}`;return String(t)}_constants;setConstantAttributeWebGL(t,r){let n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);let o=this._constants[t];switch(o&&pMe(o,r)&&Ut.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:fMe(this,t,r);break;case Int32Array:hMe(this,t,r);break;case Uint32Array:dMe(this,t,r);break;default:Cn(!1)}}getExtension(t){return Pl(this.gl,t,this._extensions),this._extensions}};function uMe(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}function fMe(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:Cn(!1)}}function hMe(e,t,r){e.gl.vertexAttribI4iv(t,r)}function dMe(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function pMe(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var Km=In(xq());var mMe={mousedown:1,mousemove:2,mouseup:4};function gMe(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return!0;return!1}function bq(e){let t=e.prototype.handler;e.prototype.handler=function(n){let o=this.store;n.button>0&&n.type==="pointerdown"&&(gMe(o,i=>i.pointerId===n.pointerId)||o.push(n)),t.call(this,n)}}function vq(e){e.prototype.handler=function(r){let n=mMe[r.type];n&1&&r.button>=0&&(this.pressed=!0),n&2&&r.buttons===0&&(n=4),this.pressed&&(n&4&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[r],changedPointers:[r],pointerType:"mouse",srcEvent:r}))}}bq(Km.PointerEventInput);vq(Km.MouseInput);var wq=Km.Manager,_c=Km;var yc=class{constructor(t,r,n){this.element=t,this.callback=r,this.options={enable:!0,...n}}};var Aq=_c?[[_c.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[_c.Rotate,{enable:!1}],[_c.Pinch,{enable:!1}],[_c.Swipe,{enable:!1}],[_c.Pan,{threshold:0,enable:!1}],[_c.Press,{enable:!1}],[_c.Tap,{event:"doubletap",taps:2,enable:!1}],[_c.Tap,{event:"anytap",enable:!1}],[_c.Tap,{enable:!1}]]:null,S6={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Mq={doubletap:["tap"]},Sq={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},b0={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Tq={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},T6={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var Eq=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",$m=typeof window<"u"?window:global;var LS=!1;try{let e={get passive(){return LS=!0,!0}};$m.addEventListener("test",null,e),$m.removeEventListener("test",null)}catch{LS=!1}var _Me=Eq.indexOf("firefox")!==-1,{WHEEL_EVENTS:yMe}=b0,Iq="wheel",Cq=4.000244140625,xMe=40,bMe=.25,gv=class extends yc{constructor(t,r,n){super(t,r,n),this.handleEvent=o=>{if(!this.options.enable)return;let i=o.deltaY;$m.WheelEvent&&(_Me&&o.deltaMode===$m.WheelEvent.DOM_DELTA_PIXEL&&(i/=$m.devicePixelRatio),o.deltaMode===$m.WheelEvent.DOM_DELTA_LINE&&(i*=xMe)),i!==0&&i%Cq===0&&(i=Math.floor(i/Cq)),o.shiftKey&&i&&(i=i*bMe),this.callback({type:Iq,center:{x:o.clientX,y:o.clientY},delta:-i,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(yMe),this.events.forEach(o=>t.addEventListener(o,this.handleEvent,LS?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===Iq&&(this.options.enable=r)}};var{MOUSE_EVENTS:vMe}=b0,kq="pointermove",Pq="pointerover",Oq="pointerout",Rq="pointerenter",Nq="pointerleave",_v=class extends yc{constructor(t,r,n){super(t,r,n),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;let{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(vMe),this.events.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===kq&&(this.enableMoveEvent=r),t===Pq&&(this.enableOverEvent=r),t===Oq&&(this.enableOutEvent=r),t===Rq&&(this.enableEnterEvent=r),t===Nq&&(this.enableLeaveEvent=r)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(Pq,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(Oq,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(Rq,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(Nq,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit(kq,t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var{KEY_EVENTS:wMe}=b0,zq="keydown",Dq="keyup",yv=class extends yc{constructor(t,r,n){super(t,r,n),this.handleEvent=o=>{let i=o.target||o.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:zq,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:Dq,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(wMe),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(o=>t.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t===zq&&(this.enableDownEvent=r),t===Dq&&(this.enableUpEvent=r)}};var Lq="contextmenu",xv=class extends yc{constructor(t,r,n){super(t,r,n),this.handleEvent=o=>{this.options.enable&&this.callback({type:Lq,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t===Lq&&(this.options.enable=r)}};var AMe={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},MMe=0,SMe=1,TMe=2,EMe=1,IMe=2,CMe=4;function Fq(e){let t=AMe[e.srcEvent.type];if(!t)return null;let{buttons:r,button:n}=e.srcEvent,o=!1,i=!1,s=!1;return t===2?(o=!!(r&EMe),i=!!(r&CMe),s=!!(r&IMe)):(o=n===MMe,i=n===SMe,s=n===TMe),{leftButton:o,middleButton:i,rightButton:s}}function Bq(e,t){let r=e.center;if(!r)return null;let n=t.getBoundingClientRect(),o=n.width/t.offsetWidth||1,i=n.height/t.offsetHeight||1,s={x:(r.x-n.left-t.clientLeft)/o,y:(r.y-n.top-t.clientTop)/i};return{center:r,offsetCenter:s}}var E6={srcElement:"root",priority:0},bv=class{constructor(t){this.handleEvent=r=>{if(this.isEmpty())return;let n=this._normalizeEvent(r),o=r.srcEvent.target;for(;o&&o!==n.rootElement;){if(this._emit(n,o),n.handled)return;o=o.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,o=!1,i=!1){let{handlers:s,handlersByElement:a}=this,u=E6;typeof n=="string"||n&&n.addEventListener?u={...E6,srcElement:n}:n&&(u={...E6,...n});let h=a.get(u.srcElement);h||(h=[],a.set(u.srcElement,h));let p={type:t,handler:r,srcElement:u.srcElement,priority:u.priority};o&&(p.once=!0),i&&(p.passive=!0),s.push(p),this._active=this._active||!p.passive;let _=h.length-1;for(;_>=0&&!(h[_].priority>=p.priority);)_--;h.splice(_+1,0,p)}remove(t,r){let{handlers:n,handlersByElement:o}=this;for(let i=n.length-1;i>=0;i--){let s=n[i];if(s.type===t&&s.handler===r){n.splice(i,1);let a=o.get(s.srcElement);a.splice(a.indexOf(s),1),a.length===0&&o.delete(s.srcElement)}}this._active=n.some(i=>!i.passive)}_emit(t,r){let n=this.handlersByElement.get(r);if(n){let o=!1,i=()=>{t.handled=!0},s=()=>{t.handled=!0,o=!0},a=[];for(let u=0;u<n.length;u++){let{type:h,handler:p,once:_}=n[u];if(p({...t,type:h,stopPropagation:i,stopImmediatePropagation:s}),_&&a.push(n[u]),o)break}for(let u=0;u<a.length;u++){let{type:h,handler:p}=a[u];this.remove(h,p)}}}_normalizeEvent(t){let r=this.eventManager.getElement();return{...t,...Fq(t),...Bq(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};var kMe={events:null,recognizers:null,recognizerOptions:{},Manager:wq,touchAction:"none",tabIndex:0},v0=class{constructor(t=null,r){this._onBasicInput=o=>{let{srcEvent:i}=o,s=Sq[i.type];s&&this.manager.emit(s,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...kMe,...r},this.events=new Map,this.setElement(t);let{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;let{options:r}=this,n=r.Manager;this.manager=new n(t,{touchAction:r.touchAction,recognizers:r.recognizers||Aq}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(S6).forEach(o=>{let i=this.manager.get(o);i&&S6[o].forEach(s=>{i.recognizeWith(s)})});for(let o in r.recognizerOptions){let i=this.manager.get(o);if(i){let s=r.recognizerOptions[o];delete s.enable,i.set(s)}}this.wheelInput=new gv(t,this._onOtherEvent,{enable:!1}),this.moveInput=new _v(t,this._onOtherEvent,{enable:!1}),this.keyInput=new yv(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new xv(t,this._onOtherEvent,{enable:!1});for(let[o,i]of this.events)i.isEmpty()||(this._toggleRecognizer(i.recognizerName,!0),this.manager.on(o,i.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){let{manager:n}=this;if(!n)return;let o=n.get(t);if(o&&o.options.enable!==r){o.set({enable:r});let i=Mq[t];i&&!this.options.recognizers&&i.forEach(s=>{let a=n.get(s);r?(a.requireFailure(t),o.dropRequireFailure(s)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,r),this.moveInput.enableEventType(t,r),this.keyInput.enableEventType(t,r),this.contextmenuInput.enableEventType(t,r)}_addEventHandler(t,r,n,o,i){if(typeof t!="string"){n=r;for(let p in t)this._addEventHandler(p,t[p],n,o,i);return}let{manager:s,events:a}=this,u=T6[t]||t,h=a.get(u);h||(h=new bv(this),a.set(u,h),h.recognizerName=Tq[u]||u,s&&s.on(u,h.handleEvent)),h.add(t,r,n,o,i),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(let s in t)this._removeEventHandler(s,t[s]);return}let{events:n}=this,o=T6[t]||t,i=n.get(o);if(i&&(i.remove(t,r),i.isEmpty())){let{recognizerName:s}=i,a=!1;for(let u of n.values())if(u.recognizerName===s&&!u.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}};function bd(){}var PMe=({isDragging:e})=>e?"grabbing":"grab",jq={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:bd,onWebGLInitialized:bd,onResize:bd,onViewStateChange:bd,onInteractionStateChange:bd,onBeforeRender:bd,onAfterRender:bd,onLoad:bd,onError:e=>Vr.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:PMe,getTooltip:null,debug:!1,drawPickingColors:!1},Ff=class{static{this.defaultProps=jq}static{this.VERSION=qV}constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Aa({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{let{_pickRequest:o}=this;if(n.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(n.leftButton||n.rightButton)return;{let i=n.offsetCenter;if(!i)return;o.x=i.x,o.y=i.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=n},this._onEvent=n=>{let o=Fb[n.type],i=n.offsetCenter;if(!o||!i||!this.layerManager)return;let s=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:u}=a,h=u&&(u[o.handler]||u.props[o.handler]),p=this.props[o.handler],_=!1;h&&(_=h.call(u,a,n)),_||(p?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{let o=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...jq,...t},t=this.props,t.viewState&&t.initialViewState&&Vr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device?this.device=t.device:t.gl&&(t.gl instanceof WebGLRenderingContext&&Vr.error("WebGL1 context not supported.")(),this.device=Xm.attach(t.gl));let r=this.device;r||(If.registerDevices([Xm]),r=If.createDevice({...t.deviceProps,canvas:this._createCanvas(t)})),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&hc.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Vr.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Vr.removed("onLayerClick","onClick")(),t.initialViewState&&!jo(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);let n=this.viewManager.needsRedraw(t),o=this.layerManager.needsRedraw(t),i=this.effectManager.needsRedraw(t),s=this.deckRenderer.needsRedraw(t);return r=r||n||o||i||s,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return hi(this.viewManager),this.viewManager.views}getViewports(t){return hi(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){let r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(let n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(let r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){hi(this.deckPicker);let{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(r).timeStart();let i=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return o.get(r).timeEnd(),i}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),hi(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;let{width:r,height:n}=t;if(r||r===0){let o=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=o}if(n||n===0){let o=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){let{canvas:t}=this;if(!t)return;let r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){let{gl:n,onError:o,useDevicePixels:i}=r;return new qb({device:t,useDevicePixels:i,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:o})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new _d({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:t}=this;if(t.event){let{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let o=n,i=!1;for(let s of r)o=s,i=s.layer?.onHover(s,t.event)||i;i||(this.props.onHover?.(o,t.event),this.widgetManager.onHover(o,t.event)),t.event=null}}_updateCursor(){let t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Xm&&this.props.onWebGLInitialized(this.device.gl);let r=new Vm;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new v0(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let o in Fb)this.eventManager.on(o,this._onEvent);this.viewManager=new Kb({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let n=this.viewManager.getViewports()[0];this.layerManager=new Xb(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new nv({deck:this,device:this.device}),this.deckRenderer=new ov(this.device),this.deckPicker=new sv(this.device),this.widgetManager=new dS({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new av),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){let{device:n,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:o});let i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:n,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Vr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){let r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){let{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();let r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let n=If.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}};function Uq(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Sb(e)}}var Vq=vM;function vv(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function vd(e){return e.stride||e.size*e.bytesPerElement}function Wq(e,t){return e.type===t.type&&e.size===t.size&&vd(e)===vd(t)&&(e.offset||0)===(t.offset||0)}function I6(e,t){t.offset&&Vr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=vd(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,o=t.elementOffset||0,i=n*r+o*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:r}}function OMe(e,t){let r=I6(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}var wv=class{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;let o=r.logicalType||r.type,i=o==="float64",{defaultValue:s}=r;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let a;i?a="float32":!o&&r.isIndexed?a="uint32":a=o||"float32";let u=Uq(o||a);this.doublePrecision=i,i&&r.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...r,defaultType:u,defaultValue:s,logicalType:o,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let t=this.getAccessor();return t.vertexOffset?t.vertexOffset*vd(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){let n={};if(this.state.constant){let o=this.value;if(r){let i=I6(this.getAccessor(),r),s=i.offset/o.BYTES_PER_ELEMENT,a=i.size||this.size;n[t]=o.subarray(s,s+a)}else n[t]=o}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,r=null){let n=this.getAccessor(),o=[],i={name:this.id,byteStride:vd(n),attributes:o};if(this.doublePrecision){let s=OMe(n,r||{});o.push(vv(t,{...n,...s.high}),vv(`${t}64Low`,{...n,...s.low}))}else if(r){let s=I6(n,r);o.push(vv(t,{...n,...s}))}else o.push(vv(t,n));return i}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){let r=Array.from(this.value);t=[r,r]}else{let{value:r,numInstances:n,size:o}=this,i=n*o;if(r&&i&&r.length>=i){let s=new Array(o).fill(1/0),a=new Array(o).fill(-1/0);for(let u=0;u<i;)for(let h=0;h<o;h++){let p=r[u++];p<s[h]&&(s[h]=p),p>a[h]&&(a[h]=p)}t=[s,a]}}return this.state.bounds=t,t}setData(t){let{state:r}=this,n;ArrayBuffer.isView(t)?n={value:t}:t instanceof qn?n={buffer:t}:n=t;let o={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)o.type="float32";else{let s=Vq(n.value);o.type=o.normalized?s.replace("int","norm"):s}o.bytesPerElement=n.value.BYTES_PER_ELEMENT,o.stride=vd(o)}if(r.bounds=null,n.constant){let i=n.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!r.constant||!this._areValuesEqual(i,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(n.buffer){let i=n.buffer;r.externalBuffer=i,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let i=n.value;r.externalBuffer=null,r.constant=!1,this.value=i;let{buffer:s}=this,a=vd(o),u=(o.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=sS(i,o)),this.settings.isIndexed){let p=this.settings.defaultType;i.constructor!==p&&(i=new p(i))}let h=i.byteLength+u+a*2;(!s||s.byteLength<h)&&(s=this._createBuffer(h)),s.write(i,u)}return this.setAccessor(o),!0}updateSubBuffer(t={}){this.state.bounds=null;let r=this.value,{startOffset:n=0,endOffset:o}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?sS(r,{size:this.size,startIndex:n,endIndex:o}):r.subarray(n,o),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){let{state:n}=this,o=n.allocatedValue,i=hc.allocate(o,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=i;let{byteOffset:s}=this,{buffer:a}=this;return(!a||a.byteLength<i.byteLength+s)&&(a=this._createBuffer(i.byteLength+s),r&&o&&a.write(o instanceof Float64Array?sS(o,this):o,s)),n.allocatedValue=i,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){let{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let n=this.settings.defaultType,o=!1;if(this.doublePrecision&&(o=r.BYTES_PER_ELEMENT<4),o)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Vr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){let{defaultValue:o,size:i}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let s=i;for(;--s>=0;)r[n+s]=o[s];return r}switch(i){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:o[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:o[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:o[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:o[0];break;default:let s=i;for(;--s>=0;)r[n+s]=Number.isFinite(t[s])?t[s]:o[s]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;let{size:n}=this;for(let o=0;o<n;o++)if(t[o]!==r[o])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?qn.INDEX:qn.VERTEX,indexType:r?n:void 0,byteLength:t}),this._buffer}};var Zq=[],Yq=[];function Bf(e,t=0,r=1/0){let n=Zq,o={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(Yq.length=e.length,n=Yq):n=Zq,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),o.index=t-1),{iterable:n,objectInfo:o}}function FS(e){return e&&e[Symbol.asyncIterator]}function BS(e,t){let{size:r,stride:n,offset:o,startIndices:i,nested:s}=t,a=e.BYTES_PER_ELEMENT,u=n?n/a:r,h=o?o/a:0,p=Math.floor((e.length-h)/u);return(_,{index:y,target:A})=>{if(!i){let R=y*u+h;for(let V=0;V<r;V++)A[V]=e[R+V];return A}let E=i[y],k=i[y+1]||p,P;if(s){P=new Array(k-E);for(let R=E;R<k;R++){let V=R*u+h;A=new Array(r);for(let N=0;N<r;N++)A[N]=e[V+N];P[R-E]=A}}else if(u===r)P=e.subarray(E*r+h,k*r+h);else{P=new e.constructor((k-E)*r);let R=0;for(let V=E;V<k;V++){let N=V*u+h;for(let j=0;j<r;j++)P[R++]=e[N+j]}}return P}}var qq=[],Av=[[0,1/0]];function Gq(e,t){if(e===Av||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],n=e.length,o=0;for(let i=0;i<n;i++){let s=e[i];s[1]<t[0]?(r.push(s),o=i+1):s[0]>t[1]?r.push(s):t=[Math.min(s[0],t[0]),Math.max(s[1],t[1])]}return r.splice(o,0,t),r}var NMe={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function jS(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...NMe[r],...t,...e,type:r}}var Qm=class extends wv{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Av}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){this.state.layoutChanged||=!Wq(t,this.getAccessor()),super.setAccessor(t)}getUpdateTriggers(){let{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;let{accessor:r}=this.settings,n=this.settings.transition,o=Array.isArray(r)?t[r.find(i=>t[i])]:t[r];return jS(o,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){let{startRow:n=0,endRow:o=1/0}=r;this.state.updateRanges=Gq(this.state.updateRanges,[n,o])}else this.state.updateRanges=Av}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=qq}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){let{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==Av),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:o}){if(!this.needsUpdate())return!1;let{state:{updateRanges:i},settings:{update:s,noAlloc:a}}=this,u=!0;if(s){for(let[h,p]of i)s.call(o,this,{data:r,startRow:h,endRow:p,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[h,p]of i){let _=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(p)?this.getVertexOffset(p):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){let{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){let{state:n,settings:o}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),o.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});let s=t;hi(ArrayBuffer.isView(s.value),`invalid ${o.accessor}`);let a=!!s.size&&s.size!==this.size;return n.binaryAccessor=BS(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){let{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){let t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(let n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(t){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:o}=this.settings;if(o==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=o??"vertex",!r)return n;for(let i in r){let s=super._getBufferLayout(i,r[i]);n.attributes.push(...s.attributes)}return n}_autoUpdater(t,{data:r,startRow:n,endRow:o,props:i,numInstances:s}){if(t.constant)return;let{settings:a,state:u,value:h,size:p,startIndices:_}=t,{accessor:y,transform:A}=a,E=u.binaryAccessor||(typeof y=="function"?y:i[y]);hi(typeof E=="function",`accessor "${y}" is not a function`);let k=t.getVertexOffset(n),{iterable:P,objectInfo:R}=Bf(r,n,o);for(let V of P){R.index++;let N=E(V,R);if(A&&(N=A.call(this,N)),_){let j=(R.index<_.length-1?_[R.index+1]:s)-_[R.index];if(N&&Array.isArray(N[0])){let J=k;for(let ne of N)t._normalizeValue(ne,h,J),J+=p}else N&&N.length>p?h.set(N,k):(t._normalizeValue(N,R.target,0),n6({target:h,source:R.target,start:k,count:j}));k+=j*p}else t._normalizeValue(N,h,k),k+=p}}_validateAttributeUpdaters(){let{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function C6(e){let{source:t,target:r,start:n=0,size:o,getData:i}=e,s=e.end||r.length,a=t.length,u=s-n;if(a>u){r.set(t.subarray(0,u),n);return}if(r.set(t,n),!i)return;let h=a;for(;h<u;){let p=i(h,t);for(let _=0;_<o;_++)r[n+h]=p[_]||0,h++}}function Hq({source:e,target:t,size:r,getData:n,sourceStartIndices:o,targetStartIndices:i}){if(!o||!i)return C6({source:e,target:t,size:r,getData:n}),t;let s=0,a=0,u=n&&((p,_)=>n(p+a,_)),h=Math.min(o.length,i.length);for(let p=1;p<h;p++){let _=o[p]*r,y=i[p]*r;C6({source:e.subarray(s,_),target:t,start:a,end:y,size:r,getData:u}),s=_,a=y}return a<t.length&&C6({source:[],target:t,start:a,size:r,getData:u}),t}function Xq(e){let{device:t,settings:r,value:n}=e,o=new Qm(t,r);return o.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),o}function US(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function VS(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function WS(e){e.push(e.shift())}function Kq(e,t){let{doublePrecision:r,settings:n,value:o,size:i}=e,s=r&&o instanceof Float64Array?2:1,a=0,{shaderAttributes:u}=e.settings;if(u)for(let h of Object.values(u))a=Math.max(a,h.vertexOffset??0);return(n.noAlloc?o.length:(t+a)*i)*s}function ZS({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function YS({device:e,buffer:t,attribute:r,fromLength:n,toLength:o,fromStartIndices:i,getData:s=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,u=r.size*a,h=r.byteOffset,p=r.settings.bytesPerElement<4?h/r.settings.bytesPerElement*4:h,_=r.startIndices,y=i&&_,A=r.isConstant;if(!y&&t&&n>=o)return t;let E=r.value instanceof Float64Array?Float32Array:r.value.constructor,k=A?r.value:new E(r.getBuffer().readSyncWebGL(h,o*E.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!A){let N=s;s=(j,J)=>r.normalizeConstant(N(j,J))}let P=A?(N,j)=>s(k,j):(N,j)=>s(k.subarray(N+h,N+h+u),j),R=t?new Float32Array(t.readSyncWebGL(p,n*4).buffer):new Float32Array(0),V=new Float32Array(o);return Hq({source:R,target:V,sourceStartIndices:i,targetStartIndices:_,size:u,getData:P}),(!t||t.byteLength<V.byteLength+p)&&(t?.destroy(),t=e.createBuffer({byteLength:V.byteLength+p,usage:35050})),t.write(V,p),t}var w0=class{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new pc(n),this.attribute=r,this.attributeInTransition=Xq(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Kq(this.attribute,r),this.transition.start({...t,duration:n})}update(){let t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let t of this.buffers)t.destroy();this.buffers.length=0}};var Mv=class extends w0{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=LMe(t,r)}start(t,r){let n=this.currentLength,o=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}let{buffers:i,attribute:s}=this;WS(i),i[0]=YS({device:this.device,buffer:i[0],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:o,getData:t.enter}),i[1]=ZS({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);let{transform:a}=this,u=a.model,h=Math.floor(this.currentLength/s.size);$q(s)&&(h/=2),u.setVertexCount(h),s.isConstant?(u.setAttributes({aFrom:i[0]}),u.setConstantAttributes({aTo:s.value})):u.setAttributes({aFrom:i[0],aTo:s.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){let{duration:t,easing:r}=this.settings,{time:n}=this.transition,o=n/t;r&&(o=r(o));let{model:i}=this.transform;i.setUniforms({time:o}),i.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},zMe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,DMe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function $q(e){return e.doublePrecision&&e.value instanceof Float64Array}function LMe(e,t){let r=t.size,n=US(r),o=VS(r),i=t.getBufferLayout();return $q(t)?new pd(e,{vs:DMe,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*r}]}],modules:[rO],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new pd(e,{vs:zMe,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:i.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}var Sv=class extends w0{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=UMe(t),this.framebuffer=VMe(t,this.texture),this.transform=jMe(t,r)}start(t,r){let n=this.currentLength,o=this.currentStartIndices;super.start(t,r);let{buffers:i,attribute:s}=this;for(let u=0;u<2;u++)i[u]=YS({device:this.device,buffer:i[u],attribute:s,fromLength:n,toLength:this.currentLength,fromStartIndices:o,getData:t.enter});i[2]=ZS({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?a.setConstantAttributes({aTo:s.value}):a.setAttributes({aTo:s.getBuffer()})}onUpdate(){let{buffers:t,transform:r,framebuffer:n,transition:o}=this,i=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]}),r.model.setUniforms({stiffness:i.stiffness,damping:i.damping}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),WS(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||o.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},FMe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,BMe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function jMe(e,t){let r=US(t.size),n=VS(t.size);return new pd(e,{vs:FMe,fs:BMe,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function UMe(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function VMe(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}var WMe={interpolation:Mv,spring:Sv},Tv=class{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(let o in t){let i=t[o],s=i.getTransitionSetting(r);s&&this._updateAttribute(o,i,s)}for(let o in this.transitions){let i=t[o];(!i||!i.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(t){let r=this.transitions[t];return r&&r.inProgress}getAttributes(){let t={};for(let r in this.transitions){let n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){let o=this.transitions[t],i=!o||o.type!==n.type;if(i){o&&this._removeTransition(t);let s=WMe[n.type];s?this.transitions[t]=new s({attribute:r,timeline:this.timeline,device:this.device}):(Vr.error(`unsupported transition type '${n.type}'`)(),i=!1)}(i||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}};var Qq="attributeManager.invalidate",ZMe="attributeManager.updateStart",YMe="attributeManager.updateEnd",qMe="attribute.updateStart",GMe="attribute.allocate",HMe="attribute.updateEnd",Ev=class{constructor(t,{id:r="attribute-manager",stats:n,timeline:o}={}){this.mergeBoundsMemoized=du(uY),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Tv(t,{id:`${r}-transitions`,timeline:o}),Object.seal(this)}finalize(){for(let t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(let r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){let n=this._invalidateTrigger(t,r);oo(Qq,this,t,n)}invalidateAll(t){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);oo(Qq,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:o,props:i={},buffers:s={},context:a={}}){let u=!1;oo(ZMe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let h in this.attributes){let p=this.attributes[h],_=p.settings.accessor;p.startIndices=n,p.numInstances=r,i[h]&&Vr.removed(`props.${h}`,`data.attributes.${h}`)(),p.setExternalBuffer(s[h])||p.setBinaryValue(typeof _=="string"?s[_]:void 0,t.startIndices)||typeof _=="string"&&!s[_]&&p.setConstantValue(i[_])||p.needsUpdate()&&(u=!0,this._updateAttribute({attribute:p,numInstances:r,data:t,props:i,context:a})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}u&&oo(YMe,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){let{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){let r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:n}=this,o={...n.getAttributes()};for(let i in r){let s=r[i];s.needsRedraw(t)&&!n.hasAttribute(i)&&(o[i]=s)}return o}getBufferLayouts(t){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(t))}_add(t,r){for(let n in t){let o=t[n],i={...o,id:n,size:o.isIndexed&&1||o.size||1,...r};this.attributes[n]=new Qm(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let t={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(o=>{t[o]||(t[o]=[]),t[o].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){let{attributes:n,updateTriggers:o}=this,i=o[t];return i&&i.forEach(s=>{let a=n[s];a&&a.setNeedsUpdate(a.id,r)}),i}_updateAttribute(t){let{attribute:r,numInstances:n}=t;if(oo(qMe,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&oo(GMe,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,oo(HMe,r,n))}};var Iv=class extends pc{get value(){return this._value}_onUpdate(){let{time:t,settings:{fromValue:r,toValue:n,duration:o,easing:i}}=this,s=i(t/o);this._value=Ma(r,n,s)}};var Jq=1e-5;function eG(e,t,r,n,o){let i=t-e,a=(r-t)*o,u=-i*n;return a+u+i+t}function XMe(e,t,r,n,o){if(Array.isArray(r)){let i=[];for(let s=0;s<r.length;s++)i[s]=eG(e[s],t[s],r[s],n,o);return i}return eG(e,t,r,n,o)}function tG(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){let o=e[n]-t[n];r+=o*o}return Math.sqrt(r)}return Math.abs(e-t)}var Cv=class extends pc{get value(){return this._currValue}_onUpdate(){let{fromValue:t,toValue:r,damping:n,stiffness:o}=this.settings,{_prevValue:i=t,_currValue:s=t}=this,a=XMe(i,s,r,n,o),u=tG(a,r),h=tG(a,s);u<Jq&&h<Jq&&(a=r,this.end()),this._prevValue=s,this._currValue=a}};var KMe={interpolation:Iv,spring:Cv},kv=class{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,o){let{transitions:i}=this;if(i.has(t)){let u=i.get(t),{value:h=u.settings.fromValue}=u;r=h,this.remove(t)}if(o=jS(o),!o)return;let s=KMe[o.type];if(!s){Vr.error(`unsupported transition type '${o.type}'`)();return}let a=new s(this.timeline);a.start({...o,fromValue:r,toValue:n}),i.set(t,a)}remove(t){let{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){let t={};for(let[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(let t of this.transitions.keys())this.remove(t)}};function nG(e){let t=e[kl];for(let r in t){let n=t[r],{validate:o}=n;if(o&&!o(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function iG(e,t){let r=oG({newProps:e,oldProps:t,propTypes:e[kl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=QMe(e,t),o=!1;return n||(o=JMe(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:o,extensionsChanged:eSe(e,t),transitionsChanged:$Me(e,t)}}function $Me(e,t){if(!e.transitions)return!1;let r={},n=e[kl],o=!1;for(let i in e.transitions){let s=n[i],a=s&&s.type;(a==="number"||a==="color"||a==="array")&&k6(e[i],t[i],s)&&(r[i]=!0,o=!0)}return o?r:!1}function oG({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:o="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${o} changed shallowly`;if(typeof t!="object"||t===null)return`${o} changed shallowly`;for(let i of Object.keys(e))if(!(i in r)){if(!(i in t))return`${o}.${i} added`;let s=k6(e[i],t[i],n[i]);if(s)return`${o}.${i} ${s}`}for(let i of Object.keys(t))if(!(i in r)){if(!(i in e))return`${o}.${i} dropped`;if(!Object.hasOwnProperty.call(e,i)){let s=k6(e[i],t[i],n[i]);if(s)return`${o}.${i} ${s}`}}return!1}function k6(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function QMe(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:n,_dataDiff:o}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&o&&(r=o(e.data,t.data)||r),r}function JMe(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&rG(e,t,"all"))return{all:!0};let r={},n=!1;for(let o in e.updateTriggers)o!=="all"&&rG(e,t,o)&&(r[o]=!0,n=!0);return n?r:!1}function eSe(e,t){if(t===null)return!0;let r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let o=0;o<n.length;o++)if(!n[o].equals(r[o]))return!0;return!1}function rG(e,t,r){let n=e.updateTriggers[r];n=n??{};let o=t.updateTriggers[r];return o=o??{},oG({oldProps:o,newProps:n,triggerName:r})}var tSe="count(): argument not an object",rSe="count(): argument not a container";function sG(e){if(!iSe(e))throw new Error(tSe);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(nSe(e))return Object.keys(e).length;throw new Error(rSe)}function nSe(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function iSe(e){return e!==null&&typeof e=="object"}function P6(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){let n=r.modules.findIndex(o=>o.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{let n={...e.inject};for(let o in t.inject)n[o]=(n[o]||"")+t.inject[o];r.inject=n}return r}var oSe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},O6={};function aG(e,t,r,n){if(r instanceof Io)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let o=null;r.compressed&&(o={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let i=t.createTexture({...r,sampler:{...oSe,...o,...n}});return O6[i.id]=e,i}function lG(e,t){!t||!(t instanceof Io)||O6[t.id]===e&&(t.delete(),delete O6[t.id])}var sSe={boolean:{validate(e,t){return!0},equal(e,t,r){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||R6(e)&&(e.length===3||e.length===4)},equal(e,t,r){return jo(e,t,1)}},accessor:{validate(e,t){let r=qS(e);return r==="function"||r===qS(t.value)},equal(e,t,r){return typeof t=="function"?!0:jo(e,t,1)}},array:{validate(e,t){return t.optional&&!e||R6(e)},equal(e,t,r){let{compare:n}=r,o=Number.isInteger(n)?n:n?1:0;return n?jo(e,t,o):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:n}=r,o=Number.isInteger(n)?n:n?1:0;return n?jo(e,t,o):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let n=r.context;return!n||!n.device?null:aG(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{lG(r.id,e)}}};function cG(e){let t={},r={},n={};for(let[o,i]of Object.entries(e)){let s=i?.deprecatedFor;if(s)n[o]=Array.isArray(s)?s:[s];else{let a=aSe(o,i);t[o]=a,r[o]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function aSe(e,t){switch(qS(t)){case"object":return Pv(e,t);case"array":return Pv(e,{type:"array",value:t,compare:!1});case"boolean":return Pv(e,{type:"boolean",value:t});case"number":return Pv(e,{type:"number",value:t});case"function":return Pv(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Pv(e,t){return"type"in t?{name:e,...sSe[t.type],...t}:"value"in t?{name:e,type:qS(t.value),...t}:{name:e,type:"object",value:t}}function R6(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function qS(e){return R6(e)?"array":e===null?"null":typeof e}function uG(e,t){let r;for(let i=t.length-1;i>=0;i--){let s=t[i];"extensions"in s&&(r=s.extensions)}let n=N6(e.constructor,r),o=Object.create(n);o[m0]=e,o[pu]={},o[dc]={};for(let i=0;i<t.length;++i){let s=t[i];for(let a in s)o[a]=s[a]}return Object.freeze(o),o}var lSe="_mergedDefaultProps";function N6(e,t){let r=lSe;if(t)for(let o of t){let i=o.constructor;i&&(r+=`:${i.extensionName||i.name}`)}let n=fG(e,r);return n||(e[r]=cSe(e,t||[]))}function cSe(e,t){if(!e.prototype)return null;let n=Object.getPrototypeOf(e),o=N6(n),i=fG(e,"defaultProps")||{},s=cG(i),a=Object.assign(Object.create(null),o,s.defaultProps),u=Object.assign(Object.create(null),o?.[kl],s.propTypes),h=Object.assign(Object.create(null),o?.[fS],s.deprecatedProps);for(let p of t){let _=N6(p.constructor);_&&(Object.assign(a,_),Object.assign(u,_[kl]),Object.assign(h,_[fS]))}return uSe(a,e),hSe(a,u),fSe(a,h),a[kl]=u,a[fS]=h,t.length===0&&!z6(e,"_propTypes")&&(e._propTypes=u),a}function uSe(e,t){let r=pSe(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function fSe(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){let o=`${this.id}: ${r}`;for(let i of t[r])z6(this,i)||(this[i]=n);Vr.deprecated(o,t[r].join("/"))()}})}function hSe(e,t){let r={},n={};for(let o in t){let i=t[o],{name:s,value:a}=i;i.async&&(r[s]=a,n[s]=dSe(s))}e[Nf]=r,e[pu]={},Object.defineProperties(e,n)}function dSe(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||FS(t)?this[pu][e]=t:this[dc][e]=t},get(){if(this[dc]){if(e in this[dc])return this[dc][e]||this[Nf][e];if(e in this[pu]){let t=this[m0]&&this[m0].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[Nf][e]}}return this[Nf][e]}}}function z6(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function fG(e,t){return z6(e,t)&&e[t]}function pSe(e){let t=e.componentName;return t||Vr.warn(`${e.name}.componentName not specified`)(),t||e.name}var mSe=0,Ov=class{static{this.componentName="Component"}static{this.defaultProps={}}constructor(...t){this.props=uG(this,t),this.id=this.props.id,this.count=mSe++}clone(t){let{props:r}=this,n={};for(let o in r[Nf])o in r[dc]?n[o]=r[dc][o]:o in r[pu]&&(n[o]=r[pu][o]);return new this.constructor({...r,...n,...t})}};var gSe=Object.freeze({}),Rv=class{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let t in this.asyncProps){let r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||gSe}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){let r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){let r=this.asyncProps[t];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[m0]||this.component;let r=t[dc]||{},n=t[pu]||t,o=t[Nf]||{};for(let i in r){let s=r[i];this._createAsyncPropData(i,o[i]),this._updateAsyncProp(i,s),r[i]=this.getAsyncProp(i)}for(let i in n){let s=n[i];this._createAsyncPropData(i,o[i]),this._updateAsyncProp(i,s)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(FS(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){let n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();let n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){let o=this.asyncProps[t];o&&n>=o.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=r,o.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){let n=this.asyncProps[t];if(n){n.pendingLoadCount++;let o=n.pendingLoadCount;r.then(i=>{this.component&&(i=this._postProcessValue(n,i),this._setAsyncPropValue(t,i,o),this._onResolve(t,i))}).catch(i=>{this._onError(t,i)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}let n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;let o=n.pendingLoadCount,i=[],s=0;for await(let a of r){if(!this.component)return;let{dataTransform:u}=this.component.props;u?i=u(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:s,endRow:i.length}]}),s=i.length,this._setAsyncPropValue(t,i,o)}this._onResolve(t,i)}_postProcessValue(t,r){let n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){let o=this.component&&this.component.props[kl];this.asyncProps[t]={type:o&&o[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var Nv=class extends Rv{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){let n=this.layer,o=n?.props.fetch;return o?o(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){let n=this.layer;if(n){let o=n.props.onDataLoad;t==="data"&&o&&o(r,{propName:t,layer:n})}}_onError(t,r){let n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}};var _Se="layer.changeFlag",ySe="layer.initialize",xSe="layer.update",bSe="layer.finalize",vSe="layer.matched",hG=2**24-1,wSe=Object.freeze([]),ASe=du(({oldViewport:e,viewport:t})=>e.equals(t)),yu=new Uint8ClampedArray(0),MSe={data:{type:"data",value:wSe,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:o,signal:i})=>{let{resourceManager:s}=r.context;o=o||r.getLoadOptions(),n=n||r.props.loaders,i&&(o={...o,fetch:{...o?.fetch,signal:i}});let a=s.contains(e);return!a&&!o&&(s.add({resourceId:e,data:su(e,n),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:u=>r.internalState?.reloadAsyncProp(t,u),consumerId:r.id,requestId:t}):su(e,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Mn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},rs=class extends Ov{constructor(){super(...arguments),this.internalState=null,this.lifecycle=md.NO_STATE,this.parent=null}static{this.defaultProps=MSe}static{this.layerName="Layer"}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){hi(this.internalState);let r=this.internalState.viewport||this.context.viewport,n=t6(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,i,s]=u0(n,r.pixelProjectionMatrix);return t.length===2?[o,i]:[o,i,s]}unproject(t){return hi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){hi(this.internalState);let n=this.internalState.viewport||this.context.viewport;return dY(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setModuleParameters(t){for(let r of this.getModels())r.updateModuleSettings(t)}setShaderModuleProps(...t){for(let r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:t}=this.props;return t===Mn.DEFAULT||t===Mn.LNGLAT||t===Mn.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){hi(t instanceof Uint8Array);let[r,n,o]=t;return r+n*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:sG(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=P6(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)t=P6(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){let r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(let o of n)r.invalidateAll(o);else r.invalidateAll();if(r){let{props:o}=t,i=this.internalState.hasPickingBuffer,s=Number.isInteger(o.highlightedObjectIndex)||o.pickable||o.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==s){this.internalState.hasPickingBuffer=s;let{pickingColors:a,instancePickingColors:u}=r.attributes,h=a||u;h&&(s&&h.constant&&(h.constant=!1,r.invalidate(h.id)),!h.value&&!s&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(t){for(let n of this.getModels())n.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(let r of this.getModels())r.draw(t)}getPickingInfo({info:t,mode:r,sourceLayer:n}){let{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=t,(!r||!ASe({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){let r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(let n in t)t[n].layoutChanged()&&(r=!0);for(let n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){let t=this.getAttributeManager();if(!t)return;let r=this.props,n=this.getNumInstances(),o=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:o,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let i=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){let t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){let{uniformTransitions:t}=this.internalState;if(t.active){let r=t.update(),n=Object.create(this.props);for(let o in r)Object.defineProperty(n,o,{value:r[o]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;let n=Math.floor(yu.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>hG&&Vr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),yu=hc.allocate(yu,r,{size:4,copy:!0,maxCount:Math.max(r,hG)});let o=Math.floor(yu.length/4),i=[];for(let s=n;s<o;s++)this.encodePickingColor(s,i),yu[s*4+0]=i[0],yu[s*4+1]=i[1],yu[s*4+2]=i[2]}t.value=yu.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){let a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts(t)),r=a.getAttributes()}let o=t.userData?.excludeAttributes||{},i={},s={};for(let a in r){if(o[a])continue;let u=r[a].getValue();for(let h in u){let p=u[h];p instanceof qn?r[a].settings.isIndexed?t.setIndexBuffer(p):i[h]=p:p&&(s[h]=p)}}t.setAttributes(i),t.setConstantAttributes(s)}disablePickingIndex(t){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}let{pickingColors:n,instancePickingColors:o}=this.getAttributeManager().attributes,i=n||o,s=i&&r.attributes&&r.attributes[i.id];if(s&&s.value){let a=s.value,u=this.encodePickingColor(t);for(let h=0;h<r.length;h++){let p=i.getVertexOffset(h);a[p]===u[0]&&a[p+1]===u[1]&&a[p+2]===u[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){let{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n;if(!o)return;let i=o.getVertexOffset(t),s=o.getVertexOffset(t+1);o.buffer.write(new Uint8Array(s-i),i)}restorePickingColors(){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==yu.buffer&&(n.value=yu.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){hi(!this.internalState),hi(Number.isFinite(this.props.coordinateSystem)),oo(ySe,this);let t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Nv({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Vr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new kv(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){oo(vSe,this,this===t);let{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let t=this.needsUpdate();if(oo(xSe,this,t),!t)return;let r=this.props,n=this.context,o=this.internalState,i=n.viewport,s=this._updateUniformTransition();o.propsInTransition=s,n.viewport=o.viewport||i,this.props=s;try{let a=this._getUpdateParams(),u=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let p of this.props.extensions)p.updateState.call(this,a,p);let h=this.getModels()[0]!==u[0];this._postUpdate(a,h)}finally{n.viewport=i,this.props=r,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){oo(bSe,this),this.finalizeState(this.context);for(let t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,moduleParameters:r=null,uniforms:n={},parameters:o={}}){this._updateAttributeTransition();let i=this.props,s=this.context;this.props=this.internalState.propsInTransition||i;let a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(r){let{isActive:p,isAttribute:_}=r.picking;this.setModuleParameters(r),this.setShaderModuleProps({picking:{isActive:p,isAttribute:_}})}let{getPolygonOffset:u}=this.props,h=u&&u(n)||[0,0];s.device.setParametersWebGL({polygonOffset:h});for(let p of this.getModels())p.setParameters(o);s.device.withParametersWebGL(o,()=>{let p={renderPass:t,moduleParameters:r,uniforms:n,parameters:o,context:s};for(let _ of this.props.extensions)_.draw.call(this,p,_);this.draw(p)})}finally{this.props=i}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let o in t)if(t[o]){let i=!1;switch(o){case"dataChanged":let s=t[o],a=r[o];s&&Array.isArray(a)&&(r.dataChanged=Array.isArray(s)?a.concat(s):s,i=!0);default:r[o]||(r[o]=t[o],i=!0)}i&&oo(_Se,this,o,t)}let n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){let n=iG(t,r);if(n.updateTriggersChanged)for(let o in n.updateTriggersChanged)n.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(n.transitionsChanged)for(let o in n.transitionsChanged)this.internalState.uniformTransitions.add(o,r[o],t[o],t.transitions?.[o]);return this.setChangeFlags(n)}validateProps(){nG(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){let r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let t=this.context;return new Ev(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){let{props:n,oldProps:o}=t;this.setNeedsRedraw(),this._updateAttributes();let i=this.state.model;i?.isInstanced&&i.setInstanceCount(this.getNumInstances());let{autoHighlight:s,highlightedObjectIndex:a,highlightColor:u}=n;if(r||o.autoHighlight!==s||o.highlightedObjectIndex!==a||o.highlightColor!==u){let h={};s||(h.highlightedObjectColor=null),Array.isArray(u)&&(h.highlightColor=u),(r||a!==o.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let n=this.getAttributeManager(),o=n?n.getNeedsRedraw(t):!1;if(r=r||o,r)for(let i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};var SSe="compositeLayer.renderLayers",xu=class extends rs{static{this.layerName="CompositeLayer"}get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){let{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){let{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){let r={index:-1,data:this.props.data,target:[]};return(n,o)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,o)}return t}getSubLayerProps(t={}){let{opacity:r,pickable:n,visible:o,parameters:i,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:A,modelMatrix:E,extensions:k,fetch:P,operation:R,_subLayerProps:V}=this.props,N={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:i,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:A,modelMatrix:E,extensions:k,fetch:P,operation:R},j=V&&t.id&&V[t.id],J=j&&j.updateTriggers,ne=t.id||"sublayer";if(j){let de=this.props[kl],fe=t.type?t.type._propTypes:{};for(let ye in j){let ve=fe[ye]||de[ye];ve&&ve.type==="accessor"&&(j[ye]=this.getSubLayerAccessor(j[ye]))}}Object.assign(N,t,j),N.id=`${this.props.id}-${ne}`,N.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...J};for(let de of k){let fe=de.getSubLayerProps.call(this,de);fe&&Object.assign(N,fe,{updateTriggers:Object.assign(N.updateTriggers,fe.updateTriggers)})}return N}_updateAutoHighlight(t){for(let r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers,o=!n||this.needsUpdate();if(o){let i=this.renderLayers();n=ka(i,Boolean),this.internalState.subLayers=n}oo(SSe,this,o,n);for(let i of n)i.parent=this}};var GS=Math.PI/180,dG=180/Math.PI,HS=6370972,A0=256;function TSe(){let e=A0/HS,t=Math.PI/180*A0;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}var M0=class extends Rf{constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:o=0,nearZMultiplier:i=.1,farZMultiplier:s=2,resolution:a=10}=t,{height:u,altitude:h=1.5}=t;u=u||1,h=Math.max(.75,h);let p=new Ci().lookAt({eye:[0,-h,0],up:[0,0,1]}),_=Math.pow(2,o);p.rotateX(r*GS),p.rotateZ(-n*GS),p.scale(_/u);let y=Math.atan(.5/h),A=A0*2*_/u;super({...t,height:u,viewMatrix:p,longitude:n,latitude:r,zoom:o,distanceScales:TSe(),fovyRadians:y*2,focalDistance:h,near:i,far:Math.min(2,1/A+1)*h*s}),this.latitude=r,this.longitude=n,this.resolution=a}get projectionMode(){return Ds.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,this.height/2],r),o=this.unproject([this.width/2,0],r),i=this.unproject([this.width,this.height/2],r),s=this.unproject([this.width/2,this.height],r);return i[0]<this.longitude&&(i[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],i[0],o[0],s[0]),Math.min(n[1],i[1],o[1],s[1]),Math.max(n[0],i[0],o[0],s[0]),Math.max(n[1],i[1],o[1],s[1])]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[o,i,s]=t,a=r?i:this.height-i,{pixelUnprojectionMatrix:u}=this,h;if(Number.isFinite(s))h=D6(u,[o,a,s,1]);else{let A=D6(u,[o,a,-1,1]),E=D6(u,[o,a,1,1]),k=((n||0)/HS+1)*A0,P=Sa.sqrLen(Sa.sub([],A,E)),R=Sa.sqrLen(A),V=Sa.sqrLen(E),j=4*((4*R*V-(P-R-V)**2)/16)/P,J=Math.sqrt(R-j),ne=Math.sqrt(Math.max(0,k*k-j)),de=(J-ne)/Math.sqrt(P);h=Sa.lerp([],A,E,de)}let[p,_,y]=this.unprojectPosition(h);return Number.isFinite(s)?[p,_,y]:Number.isFinite(n)?[p,_,n]:[p,_]}projectPosition(t){let[r,n,o=0]=t,i=r*GS,s=n*GS,a=Math.cos(s),u=(o/HS+1)*A0;return[Math.sin(i)*a*u,-Math.cos(i)*a*u,Math.sin(s)*u]}unprojectPosition(t){let[r,n,o]=t,i=Sa.len(t),s=Math.asin(o/i),u=Math.atan2(r,-n)*dG,h=s*dG,p=(i/A0-1)*HS;return[u,h,p]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,r){let n=this.unproject(r);return{longitude:t[0]-n[0]+this.longitude,latitude:t[1]-n[1]+this.latitude}}};function D6(e,t){let r=Ta.transformMat4([],t,e);return Ta.scale(r,r,1/r[3]),r}var S0=class{static{this.defaultProps={}}static{this.extensionName="LayerExtension"}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&jo(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){let{defaultProps:r}=t.constructor,n={updateTriggers:{}};for(let o in r)if(o in this.props){let i=r[o],s=this.props[o];n[o]=s,i&&i.type==="accessor"&&(n.updateTriggers[o]=this.props.updateTriggers[o],typeof s=="function"&&(n[o]=this.getSubLayerAccessor(s)))}return n}initializeState(t,r){}updateState(t,r){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,r){}finalizeState(t,r){}};var wd=class{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:r={}}=t;this.typedArrayManager=hc,this.attributes={},this._attributeDefs=r,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);let{data:r,buffers:n={},getGeometry:o,geometryBuffer:i,positionFormat:s,dataChanged:a,normalize:u=!0}=this.opts;if(this.data=r,this.getGeometry=o,this.positionSize=i&&i.size||(s==="XY"?2:3),this.buffers=n,this.normalize=u,i&&(hi(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),u||(n.vertexPositions=i)),this.geometryBuffer=n.vertexPositions,Array.isArray(a))for(let h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:r}){this._rebuildGeometry({startRow:t,endRow:r})}getGeometryFromBuffer(t){let r=t.value||t;return ArrayBuffer.isView(r)?BS(r,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,r){let{attributes:n,buffers:o,_attributeDefs:i,typedArrayManager:s}=this;for(let a in i)if(a in o)s.release(n[a]),n[a]=null;else{let u=i[a];u.copy=r,n[a]=s.allocate(n[a],t,u)}}_forEachGeometry(t,r,n){let{data:o,getGeometry:i}=this,{iterable:s,objectInfo:a}=Bf(o,r,n);for(let u of s){a.index++;let h=i?i(u,a):null;t(h,a.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:o}=this,{data:i,geometryBuffer:s}=this,{startRow:a=0,endRow:u=1/0}=t||{},h={};if(t||(r=[0],n=[0]),this.normalize||!s)this._forEachGeometry((_,y)=>{let A=_&&this.normalizeGeometry(_);h[y]=A,n[y+1]=n[y]+(A?this.getGeometrySize(A):0)},a,u),o=n[n.length-1];else if(n=i.startIndices,o=n[i.length]||0,ArrayBuffer.isView(s))o=o||s.length/this.positionSize;else if(s instanceof qn){let _=this.positionSize*4;o=o||s.byteLength/_}else if(s.buffer){let _=s.stride||this.positionSize*4;o=o||s.buffer.byteLength/_}else if(s.value){let _=s.value,y=s.stride/_.BYTES_PER_ELEMENT||this.positionSize;o=o||_.length/y}this._allocate(o,!!t),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=o;let p={};this._forEachGeometry((_,y)=>{let A=h[y]||_;p.vertexStart=n[y],p.indexStart=r[y];let E=y<n.length-1?n[y+1]:o;p.geometrySize=E-n[y],p.geometryIndex=y,this.updateGeometryAttributes(A,p)},a,u),this.vertexCount=r[r.length-1]}};var L6=512,ESe=Math.PI/180;function XS({map:e,gl:t,deck:r}){if(e.__deck)return e.__deck;let n=r?.props._customRender,o=r?.props.onLoad,i=B6({...r?.props,_customRender:()=>{e.triggerRepaint(),n?.("")}}),s;return(!r||r.props.gl===t)&&(Object.assign(i,{gl:t,width:null,height:null,touchAction:"unset",viewState:T0(e)}),r?.isInitialized?pG(r,e):i.onLoad=()=>{o?.(),pG(s,e)}),r?(s=r,r.setProps(i),r.userData.isExternal=!0):(s=new Ff(i),e.on("remove",()=>{F6(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&CSe(s,e)}),s}function pG(e,t){let r=()=>{e.isInitialized?kSe(e,t):t.off("move",r)};t.on("move",r)}function F6(e){e.__deck?.finalize(),e.__deck=null}function B6(e){return{...e,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...e.parameters},views:e.views||[new _d({id:"mapbox"})]}}function mG(e,t){e.userData.mapboxLayers.add(t),j6(e)}function gG(e,t){e.userData.mapboxLayers.delete(t),j6(e)}function _G(e,t){j6(e)}function yG(e,t,r){let{currentViewport:n}=e.userData,o=!1;n||(n=xG(e,t,!0),e.userData.currentViewport=n,o=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:i})=>r.id===i.id||i.props.operation.includes("terrain"),clearStack:o,clearCanvas:!1})}function T0(e){let{lng:t,lat:r}=e.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&ISe(e,n),n}function ISe(e,t){if(e.getFreeCameraOptions){let{position:r}=e.getFreeCameraOptions();if(!r||r.z===void 0)return;let n=e.transform.height,{longitude:o,latitude:i,pitch:s}=t,a=r.x*L6,u=(1-r.y)*L6,h=r.z*L6,p=ps([o,i]),_=a-p[0],y=u-p[1],A=Math.sqrt(_*_+y*y),E=s*ESe,k=1.5*n,P=E<.001?k*Math.cos(E)/h:k*Math.sin(E)/A;t.zoom=Math.log2(P);let R=k*Math.cos(E)/P,V=h-R;t.position=[0,0,V/Um(i)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function xG(e,t,r=!0){return new Ja({id:"mapbox",x:0,y:0,width:e.width,height:e.height,...T0(t),nearZMultiplier:r?.02:.1,nearZ:t.transform._nearZ/t.transform.height,farZ:t.transform._farZ/t.transform.height})}function CSe(e,t){let{mapboxLayers:r,isExternal:n}=e.userData;if(n){let o=Array.from(r,p=>p.id),s=ka(e.props.layers,Boolean).some(p=>p&&!o.includes(p.id)),a=e.getViewports(),u=a.findIndex(p=>p.id==="mapbox"),h=a.length>1||u<0;(s||h)&&(u>=0&&(a=a.slice(),a[u]=xG(e,t,!1)),e._drawLayers("mapbox-repaint",{viewports:a,layerFilter:p=>(!e.props.layerFilter||e.props.layerFilter(p))&&(p.viewport.id!=="mapbox"||!o.includes(p.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function kSe(e,t){e.setProps({viewState:T0(t)}),e.needsRedraw({clearRedrawFlags:!0})}function j6(e){if(e.userData.isExternal)return;let t=[];e.userData.mapboxLayers.forEach(r=>{let n=r.props.type,o=new n(r.props);t.push(o)}),e.setProps({layers:t})}var zv=class{constructor(t){if(!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,r){this.map=t,this.deck=XS({map:t,gl:r,deck:this.props.deck}),mG(this.deck,this)}onRemove(){this.deck&&gG(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&_G(this.deck,this)}render(){yG(this.deck,this.map,this)}};var U6="__UNDEFINED__";function Dv(e,t,r,n){if(!e||!t||!e.style||!e.style._loaded)return;let o=ka(n,Boolean);if(r!==n){let a=ka(r,Boolean),u=new Set(a.map(h=>h.id));for(let h of o)u.delete(h.id);for(let h of u)e.getLayer(h)&&e.removeLayer(h)}for(let a of o){let u=e.getLayer(a.id);u?u.implementation.setProps(a.props):e.addLayer(new zv({id:a.id,deck:t}),a.props.beforeId)}let i=e.style._order,s={};for(let a of o){let{beforeId:u}=a.props;(!u||!i.includes(u))&&(u=U6),s[u]=s[u]||[],s[u].push(a.id)}for(let a in s){let u=s[a],h=a===U6?i.length:i.indexOf(a),p=a===U6?void 0:a;for(let _=u.length-1;_>=0;_--){let y=u[_],A=i.indexOf(y);A!==h-1&&(e.moveLayer(y,p),A>h&&h++),h--,p=y}}}var E0=class{constructor(t){this._handleStyleChange=()=>{Dv(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:o,clientHeight:i}=this._map.getContainer();Object.assign(this._container.style,{width:`${o}px`,height:`${i}px`})}},this._updateViewState=()=>{let o=this._deck;o&&(o.setProps({viewState:T0(this._map)}),o.isInitialized&&o.redraw())},this._handleMouseEvent=o=>{let i=this._deck;if(!i||!i.isInitialized)return;let s={type:o.type,offsetCenter:o.point,srcEvent:o},a=this._lastMouseDownPoint;switch(!o.point&&a&&(s.deltaX=o.originalEvent.clientX-a.clientX,s.deltaY=o.originalEvent.clientY-a.clientY,s.offsetCenter={x:a.x+s.deltaX,y:a.y+s.deltaY}),s.type){case"mousedown":i._onPointerDown(s),this._lastMouseDownPoint={...o.point,clientX:o.originalEvent.clientX,clientY:o.originalEvent.clientY};break;case"dragstart":s.type="panstart",i._onEvent(s);break;case"drag":s.type="panmove",i._onEvent(s);break;case"dragend":s.type="panend",i._onEvent(s);break;case"click":s.tapCount=1,i._onEvent(s);break;case"dblclick":s.type="click",s.tapCount=2,i._onEvent(s);break;case"mousemove":s.type="pointermove",i._onPointerMove(s);break;case"mouseout":s.type="pointerleave",i._onPointerMove(s);break;default:return}};let{interleaved:r=!1,...n}=t;this._interleaved=r,this._props=n}setProps(t){this._interleaved&&t.layers&&Dv(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._deck.setProps(this._interleaved?B6(this._props):this._props)}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){let r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new Ff({...this._props,parent:r,viewState:T0(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(t){let r=t.painter.context.gl;return r instanceof WebGLRenderingContext&&Vr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=XS({map:t,gl:r,deck:new Ff({...this._props,gl:r})}),t.on("styledata",this._handleStyleChange),Dv(t,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),Dv(t,this._deck,this._props.layers,[]),F6(t)}getDefaultPosition(){return"top-left"}pickObject(t){return hi(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return hi(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return hi(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};var PSe=new Uint32Array([0,2,1,0,3,2]),OSe=new Float32Array([0,1,0,0,1,0,1,1]);function V6(e,t){if(!t)return RSe(e);let r=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),o=Math.ceil(r/t)+1,i=Math.ceil(n/t)+1,s=(o-1)*(i-1)*6,a=new Uint32Array(s),u=new Float32Array(o*i*2),h=new Float64Array(o*i*3),p=0,_=0;for(let y=0;y<o;y++){let A=y/(o-1);for(let E=0;E<i;E++){let k=E/(i-1),P=NSe(e,A,k);h[p*3+0]=P[0],h[p*3+1]=P[1],h[p*3+2]=P[2]||0,u[p*2+0]=A,u[p*2+1]=1-k,y>0&&E>0&&(a[_++]=p-i,a[_++]=p-i-1,a[_++]=p-1,a[_++]=p-i,a[_++]=p-1,a[_++]=p),p++}}return{vertexCount:s,positions:h,indices:a,texCoords:u}}function RSe(e){let t=new Float64Array(12);for(let r=0;r<e.length;r++)t[r*3+0]=e[r][0],t[r*3+1]=e[r][1],t[r*3+2]=e[r][2]||0;return{vertexCount:6,positions:t,indices:PSe,texCoords:OSe}}function NSe(e,t,r){return Ma(Ma(e[0],e[1],r),Ma(e[3],e[2],r),t)}var bG=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var zSe=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,vG=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

${zSe}

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`;var DSe={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Mn.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},I0=class extends rs{static{this.layerName="BitmapLayer"}static{this.defaultProps=DSe}getShaders(){return super.getShaders({vs:bG,fs:vG,modules:[Ea,Ia]})}initializeState(){let t=this.getAttributeManager();t.remove(["instancePickingColors"]);let r=!0;t.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:t,oldProps:r,changeFlags:n}){let o=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll()),t.bounds!==r.bounds){let i=this.state.mesh,s=this._createMesh();this.state.model.setVertexCount(s.vertexCount);for(let a in s)i&&i[a]!==s[a]&&o.invalidate(a);this.setState({mesh:s,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){let{image:r}=this.props,n=t.info;if(!n.color||!r)return n.bitmap=null,n;let{width:o,height:i}=r;n.index=0;let s=LSe(n.color);return n.bitmap={size:{width:o,height:i},uv:s,pixel:[Math.floor(s[0]*o),Math.floor(s[1]*i)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:t}=this.props,r=t;return wG(t)&&(r=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),V6(r,this.context.viewport.resolution)}_getModel(){return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){let{uniforms:r,moduleParameters:n}=t,{model:o,coordinateConversion:i,bounds:s,disablePicking:a}=this.state,{image:u,desaturate:h,transparentColor:p,tintColor:_}=this.props;n.picking.isActive&&a||u&&o&&(o.setUniforms(r),o.setBindings({bitmapTexture:u}),o.setUniforms({desaturate:h,transparentColor:p.map(y=>y/255),tintColor:_.slice(0,3).map(y=>y/255),coordinateConversion:i,bounds:s}),o.draw(this.context.renderPass))}_getCoordinateUniforms(){let{LNGLAT:t,CARTESIAN:r,DEFAULT:n}=Mn,{_imageCoordinateSystem:o}=this.props;if(o!==n){let{bounds:i}=this.props;if(!wG(i))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let s=this.context.viewport.resolution?t:r;if(o=o===t?t:r,o===t&&s===r)return{coordinateConversion:-1,bounds:i};if(o===r&&s===t){let a=ps([i[0],i[1]]),u=ps([i[2],i[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};function LSe(e){let[t,r,n]=e,o=(n&240)/256,i=(n&15)/16;return[(t+i)/256,(r+o)/256]}function wG(e){return Number.isFinite(e[0])}var AG=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`;var MG=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var FSe=1024,BSe=4,SG=()=>{},TG={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},jSe={x:0,y:0,width:0,height:0};function USe(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function VSe(e,t,r,n){let o=Math.min(r/t.width,n/t.height),i=Math.floor(t.width*o),s=Math.floor(t.height*o);return o===1?{data:t,width:i,height:s}:(e.canvas.height=s,e.canvas.width=i,e.clearRect(0,0,i,s),e.drawImage(t,0,0,t.width,t.height,0,0,i,s),{data:e.canvas,width:i,height:s})}function Lv(e){return e&&(e.id||e.url)}function WSe(e,t,r,n){let{width:o,height:i,device:s}=e,a=s.createTexture({format:"rgba8unorm",width:t,height:r,sampler:n}),u=s.createCommandEncoder();return u.copyTextureToTexture({source:e,destination:a,width:o,height:i}),u.finish(),e.destroy(),a}function EG(e,t,r){for(let n=0;n<t.length;n++){let{icon:o,xOffset:i}=t[n],s=Lv(o);e[s]={...o,x:i,y:r}}}function ZSe({icons:e,buffer:t,mapping:r={},xOffset:n=0,yOffset:o=0,rowHeight:i=0,canvasWidth:s}){let a=[];for(let u=0;u<e.length;u++){let h=e[u],p=Lv(h);if(!r[p]){let{height:_,width:y}=h;n+y+t>s&&(EG(r,a,o),n=0,o=i+o+t,i=0,a=[]),a.push({icon:h,xOffset:n}),n=n+y+t,i=Math.max(i,_)}}return a.length>0&&EG(r,a,o),{mapping:r,rowHeight:i,xOffset:n,yOffset:o,canvasWidth:s,canvasHeight:USe(i+o+t)}}function YSe(e,t,r){if(!e||!t)return null;r=r||{};let n={},{iterable:o,objectInfo:i}=Bf(e);for(let s of o){i.index++;let a=t(s,i),u=Lv(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[u]&&(!r[u]||a.url!==r[u].url)&&(n[u]={...a,source:s,sourceIndex:i.index})}return n}var Fv=class{constructor(t,{onUpdate:r=SG,onError:n=SG}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=BSe,this._canvasWidth=FSe,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){let r=this._autoPacking?Lv(t):t;return this._mapping[r]||jSe}setProps({loadOptions:t,autoPacking:r,iconAtlas:n,iconMapping:o,textureParameters:i}){t&&(this._loadOptions=t),r!==void 0&&(this._autoPacking=r),o&&(this._mapping=o),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),i&&(this._textureParameters=i)}get isLoaded(){return this._pendingCount===0}packIcons(t,r){if(!this._autoPacking||typeof document>"u")return;let n=Object.values(YSe(t,r,this._mapping)||{});if(n.length>0){let{mapping:o,xOffset:i,yOffset:s,rowHeight:a,canvasHeight:u}=ZSe({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=o,this._xOffset=i,this._yOffset=s,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||TG})),this._texture.height!==this._canvasHeight&&(this._texture=WSe(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||TG)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){let r=this._canvas.getContext("2d",{willReadFrequently:!0});for(let n of t)this._pendingCount++,su(n.url,this._loadOptions).then(o=>{let i=Lv(n),s=this._mapping[i],{x:a,y:u,width:h,height:p}=s,{data:_,width:y,height:A}=VSe(r,o,h,p);this._texture.setSubImageData({data:_,x:a+(h-y)/2,y:u+(p-A)/2,width:y,height:A}),s.width=y,s.height=A,this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}};var IG=[0,0,0,255],qSe={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:IG},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},Jm=class extends rs{static{this.defaultProps=qSe}static{this.layerName="IconLayer"}getShaders(){return super.getShaders({vs:AG,fs:MG,modules:[Ea,Ia]})}initializeState(){this.state={iconManager:new Fv(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:IG},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:o}=t,i=this.getAttributeManager(),{iconAtlas:s,iconMapping:a,data:u,getIcon:h,textureParameters:p}=r,{iconManager:_}=this.state;if(typeof s=="string")return;let y=s||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:r.loadOptions,autoPacking:!y,iconAtlas:s,iconMapping:y?a:null,textureParameters:p}),y?n.iconMapping!==r.iconMapping&&i.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&_.packIcons(u,h),o.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){let{sizeScale:r,sizeMinPixels:n,sizeMaxPixels:o,sizeUnits:i,billboard:s,alphaCutoff:a}=this.props,{iconManager:u}=this.state,h=u.getTexture();if(h){let p=this.state.model;p.setBindings({iconsTexture:h}),p.setUniforms(t),p.setUniforms({iconsTextureDim:[h.width,h.height],sizeUnits:$a[i],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:o,billboard:s,alphaCutoff:a}),p.draw(this.context.renderPass)}}_getModel(){let t=[-1,-1,1,-1,-1,1,1,1];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ca({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){let r=this.getCurrentLayer()?.props.onIconError;r?r(t):Vr.error(t.error.message)()}getInstanceOffset(t){let{width:r,height:n,anchorX:o=r/2,anchorY:i=n/2}=this.state.iconManager.getIconMapping(t);return[r/2-o,n/2-i]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){let{x:r,y:n,width:o,height:i}=this.state.iconManager.getIconMapping(t);return[r,n,o,i]}};var CG=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var kG=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var PG=[0,0,0,255],GSe={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:PG},getLineColor:{type:"accessor",value:PG},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Bv=class extends rs{static{this.defaultProps=GSe}static{this.layerName="ScatterplotLayer"}getShaders(){return super.getShaders({vs:CG,fs:kG,modules:[Ea,Ia]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{radiusUnits:r,radiusScale:n,radiusMinPixels:o,radiusMaxPixels:i,stroked:s,filled:a,billboard:u,antialiasing:h,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:A}=this.props,E=this.state.model;E.setUniforms(t),E.setUniforms({stroked:s?1:0,filled:a,billboard:u,antialiasing:h,radiusUnits:$a[r],radiusScale:n,radiusMinPixels:o,radiusMaxPixels:i,lineWidthUnits:$a[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:A}),E.draw(this.context.renderPass)}_getModel(){let t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ca({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};var KS={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Uv(e,t,r={}){return OG(e,r)!==t?(HSe(e,r),!0):!1}function OG(e,t={}){return Math.sign(Ad(e,t))}var jv={x:0,y:1,z:2};function Ad(e,t={}){let{start:r=0,end:n=e.length,plane:o="xy"}=t,i=t.size||2,s=0,a=jv[o[0]],u=jv[o[1]];for(let h=r,p=n-i;h<n;h+=i)s+=(e[h+a]-e[p+a])*(e[h+u]+e[p+u]),p=h;return s/2}function HSe(e,t){let{start:r=0,end:n=e.length,size:o=2}=t,i=(n-r)/o,s=Math.floor(i/2);for(let a=0;a<s;++a){let u=r+a*o,h=r+(i-1-a)*o;for(let p=0;p<o;++p){let _=e[u+p];e[u+p]=e[h+p],e[h+p]=_}}}function Z6(e,t,r=2,n,o="xy"){let i=t&&t.length,s=i?t[0]*r:e.length,a=NG(e,0,s,r,!0,n&&n[0],o),u=[];if(!a||a.next===a.prev)return u;let h,p,_,y,A,E,k;if(i&&(a=eTe(e,t,a,r,n,o)),e.length>80*r){y=p=e[0],A=_=e[1];for(let P=r;P<s;P+=r)E=e[P],k=e[P+1],E<y&&(y=E),k<A&&(A=k),E>p&&(p=E),k>_&&(_=k);h=Math.max(p-y,_-A),h=h!==0?32767/h:0}return Vv(a,u,r,y,A,h,0),u}function NG(e,t,r,n,o,i,s){let a,u;i===void 0&&(i=Ad(e,{start:t,end:r,size:n,plane:s}));let h=jv[s[0]],p=jv[s[1]];if(o===i<0)for(a=t;a<r;a+=n)u=RG(a,e[a+h],e[a+p],u);else for(a=r-n;a>=t;a-=n)u=RG(a,e[a+h],e[a+p],u);return u&&JS(u,u.next)&&(Zv(u),u=u.next),u}function eg(e,t){if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(JS(r,r.next)||Xi(r.prev,r,r.next)===0)){if(Zv(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function Vv(e,t,r,n,o,i,s){if(!e)return;!s&&i&&oTe(e,n,o,i);let a=e,u,h;for(;e.prev!==e.next;){if(u=e.prev,h=e.next,i?$Se(e,n,o,i):KSe(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(h.i/r|0),Zv(e),e=h.next,a=h.next;continue}if(e=h,e===a){s?s===1?(e=QSe(eg(e),t,r),Vv(e,t,r,n,o,i,2)):s===2&&JSe(e,t,r,n,o,i):Vv(eg(e),t,r,n,o,i,1);break}}}function KSe(e){let t=e.prev,r=e,n=e.next;if(Xi(t,r,n)>=0)return!1;let o=t.x,i=r.x,s=n.x,a=t.y,u=r.y,h=n.y,p=o<i?o<s?o:s:i<s?i:s,_=a<u?a<h?a:h:u<h?u:h,y=o>i?o>s?o:s:i>s?i:s,A=a>u?a>h?a:h:u>h?u:h,E=n.next;for(;E!==t;){if(E.x>=p&&E.x<=y&&E.y>=_&&E.y<=A&&C0(o,a,i,u,s,h,E.x,E.y)&&Xi(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function $Se(e,t,r,n){let o=e.prev,i=e,s=e.next;if(Xi(o,i,s)>=0)return!1;let a=o.x,u=i.x,h=s.x,p=o.y,_=i.y,y=s.y,A=a<u?a<h?a:h:u<h?u:h,E=p<_?p<y?p:y:_<y?_:y,k=a>u?a>h?a:h:u>h?u:h,P=p>_?p>y?p:y:_>y?_:y,R=W6(A,E,t,r,n),V=W6(k,P,t,r,n),N=e.prevZ,j=e.nextZ;for(;N&&N.z>=R&&j&&j.z<=V;){if(N.x>=A&&N.x<=k&&N.y>=E&&N.y<=P&&N!==o&&N!==s&&C0(a,p,u,_,h,y,N.x,N.y)&&Xi(N.prev,N,N.next)>=0||(N=N.prevZ,j.x>=A&&j.x<=k&&j.y>=E&&j.y<=P&&j!==o&&j!==s&&C0(a,p,u,_,h,y,j.x,j.y)&&Xi(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;N&&N.z>=R;){if(N.x>=A&&N.x<=k&&N.y>=E&&N.y<=P&&N!==o&&N!==s&&C0(a,p,u,_,h,y,N.x,N.y)&&Xi(N.prev,N,N.next)>=0)return!1;N=N.prevZ}for(;j&&j.z<=V;){if(j.x>=A&&j.x<=k&&j.y>=E&&j.y<=P&&j!==o&&j!==s&&C0(a,p,u,_,h,y,j.x,j.y)&&Xi(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function QSe(e,t,r){let n=e;do{let o=n.prev,i=n.next.next;!JS(o,i)&&zG(o,n,n.next,i)&&Wv(o,i)&&Wv(i,o)&&(t.push(o.i/r|0),t.push(n.i/r|0),t.push(i.i/r|0),Zv(n),Zv(n.next),n=e=i),n=n.next}while(n!==e);return eg(n)}function JSe(e,t,r,n,o,i){let s=e;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&lTe(s,a)){let u=DG(s,a);s=eg(s,s.next),u=eg(u,u.next),Vv(s,t,r,n,o,i,0),Vv(u,t,r,n,o,i,0);return}a=a.next}s=s.next}while(s!==e)}function eTe(e,t,r,n,o,i){let s=[],a,u,h,p,_;for(a=0,u=t.length;a<u;a++)h=t[a]*n,p=a<u-1?t[a+1]*n:e.length,_=NG(e,h,p,n,!1,o&&o[a+1],i),_===_.next&&(_.steiner=!0),s.push(aTe(_));for(s.sort(tTe),a=0;a<s.length;a++)r=rTe(s[a],r);return r}function tTe(e,t){return e.x-t.x}function rTe(e,t){let r=nTe(e,t);if(!r)return t;let n=DG(r,e);return eg(n,n.next),eg(r,r.next)}function nTe(e,t){let r=t,n=e.x,o=e.y,i=-1/0,s;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){let y=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(y<=n&&y>i&&(i=y,s=r.x<r.next.x?r:r.next,y===n))return s}r=r.next}while(r!==t);if(!s)return null;let a=s,u=s.x,h=s.y,p=1/0,_;r=s;do n>=r.x&&r.x>=u&&n!==r.x&&C0(o<h?n:i,o,u,h,o<h?i:n,o,r.x,r.y)&&(_=Math.abs(o-r.y)/(n-r.x),Wv(r,e)&&(_<p||_===p&&(r.x>s.x||r.x===s.x&&iTe(s,r)))&&(s=r,p=_)),r=r.next;while(r!==a);return s}function iTe(e,t){return Xi(e.prev,e,t.prev)<0&&Xi(t.next,e,e.next)<0}function oTe(e,t,r,n){let o=e;do o.z===0&&(o.z=W6(o.x,o.y,t,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,sTe(o)}function sTe(e){let t,r,n=1,o,i,s,a,u,h;do{for(i=e,e=null,h=null,o=0;i;){for(o++,a=i,s=0,r=0;r<n&&(s++,a=a.nextZ,!!a);r++);for(u=n;s>0||u>0&&a;)s!==0&&(u===0||!a||i.z<=a.z)?(t=i,i=i.nextZ,s--):(t=a,a=a.nextZ,u--),h?h.nextZ=t:e=t,t.prevZ=h,h=t;i=a}h.nextZ=null,n*=2}while(o>1);return e}function W6(e,t,r,n,o){return e=(e-r)*o|0,t=(t-n)*o|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function aTe(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function C0(e,t,r,n,o,i,s,a){return(o-s)*(t-a)>=(e-s)*(i-a)&&(e-s)*(n-a)>=(r-s)*(t-a)&&(r-s)*(i-a)>=(o-s)*(n-a)}function lTe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!cTe(e,t)&&(Wv(e,t)&&Wv(t,e)&&uTe(e,t)&&(Xi(e.prev,e,t.prev)||Xi(e,t.prev,t))||JS(e,t)&&Xi(e.prev,e,e.next)>0&&Xi(t.prev,t,t.next)>0)}function Xi(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function JS(e,t){return e.x===t.x&&e.y===t.y}function zG(e,t,r,n){let o=QS(Xi(e,t,r)),i=QS(Xi(e,t,n)),s=QS(Xi(r,n,e)),a=QS(Xi(r,n,t));return!!(o!==i&&s!==a||o===0&&$S(e,r,t)||i===0&&$S(e,n,t)||s===0&&$S(r,e,n)||a===0&&$S(r,t,n))}function $S(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function QS(e){return e>0?1:e<0?-1:0}function cTe(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&zG(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Wv(e,t){return Xi(e.prev,e,e.next)<0?Xi(e,t,e.next)>=0&&Xi(e,e.prev,t)>=0:Xi(e,t,e.prev)<0||Xi(e,e.next,t)<0}function uTe(e,t){let r=e,n=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function DG(e,t){let r=new Yv(e.i,e.x,e.y),n=new Yv(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function RG(e,t,r,n){let o=new Yv(e,t,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Zv(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}var Yv=class{constructor(t,r,n){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=r,this.y=n}};function Ra(e,t){let r=t.length,n=e.length;if(n>0){let o=!0;for(let i=0;i<r;i++)if(e[n-r+i]!==t[i]){o=!1;break}if(o)return!1}for(let o=0;o<r;o++)e[n+o]=t[o];return!0}function qv(e,t){let r=t.length;for(let n=0;n<r;n++)e[n]=t[n]}function Md(e,t,r,n,o=[]){let i=n+t*r;for(let s=0;s<r;s++)o[s]=e[i+s];return o}function eT(e,t,r,n,o=[]){let i,s;if(r&8)i=(n[3]-e[1])/(t[1]-e[1]),s=3;else if(r&4)i=(n[1]-e[1])/(t[1]-e[1]),s=1;else if(r&2)i=(n[2]-e[0])/(t[0]-e[0]),s=2;else if(r&1)i=(n[0]-e[0])/(t[0]-e[0]),s=0;else return null;for(let a=0;a<e.length;a++)o[a]=(s&1)===a?n[s]:i*(t[a]-e[a])+e[a];return o}function Gv(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function Hv(e,t){let{size:r=2,broken:n=!1,gridResolution:o=10,gridOffset:i=[0,0],startIndex:s=0,endIndex:a=e.length}=t||{},u=(a-s)/r,h=[],p=[h],_=Md(e,0,r,s),y,A,E=BG(_,o,i,[]),k=[];Ra(h,_);for(let P=1;P<u;P++){for(y=Md(e,P,r,s,y),A=Gv(y,E);A;){eT(_,y,A,E,k);let R=Gv(k,E);R&&(eT(_,k,R,E,k),A=R),Ra(h,k),qv(_,k),hTe(E,o,A),n&&h.length>r&&(h=[],p.push(h),Ra(h,_)),A=Gv(y,E)}Ra(h,y),qv(_,y)}return n?p:p[0]}var LG=0,fTe=1;function Xv(e,t=null,r){if(!e.length)return[];let{size:n=2,gridResolution:o=10,gridOffset:i=[0,0],edgeTypes:s=!1}=r||{},a=[],u=[{pos:e,types:s?new Array(e.length/n).fill(fTe):null,holes:t||[]}],h=[[],[]],p=[];for(;u.length;){let{pos:_,types:y,holes:A}=u.shift();dTe(_,n,A[0]||_.length,h),p=BG(h[0],o,i,p);let E=Gv(h[1],p);if(E){let k=FG(_,y,n,0,A[0]||_.length,p,E),P={pos:k[0].pos,types:k[0].types,holes:[]},R={pos:k[1].pos,types:k[1].types,holes:[]};u.push(P,R);for(let V=0;V<A.length;V++)k=FG(_,y,n,A[V],A[V+1]||_.length,p,E),k[0]&&(P.holes.push(P.pos.length),P.pos=tT(P.pos,k[0].pos),s&&(P.types=tT(P.types,k[0].types))),k[1]&&(R.holes.push(R.pos.length),R.pos=tT(R.pos,k[1].pos),s&&(R.types=tT(R.types,k[1].types)))}else{let k={positions:_};s&&(k.edgeTypes=y),A.length&&(k.holeIndices=A),a.push(k)}}return a}function FG(e,t,r,n,o,i,s){let a=(o-n)/r,u=[],h=[],p=[],_=[],y=[],A,E,k,P=Md(e,a-1,r,n),R=Math.sign(s&8?P[1]-i[3]:P[0]-i[2]),V=t&&t[a-1],N=0,j=0;for(let J=0;J<a;J++)A=Md(e,J,r,n,A),E=Math.sign(s&8?A[1]-i[3]:A[0]-i[2]),k=t&&t[n/r+J],E&&R&&R!==E&&(eT(P,A,s,i,y),Ra(u,y)&&p.push(V),Ra(h,y)&&_.push(V)),E<=0?(Ra(u,A)&&p.push(k),N-=E):p.length&&(p[p.length-1]=LG),E>=0?(Ra(h,A)&&_.push(k),j+=E):_.length&&(_[_.length-1]=LG),qv(P,A),R=E,V=k;return[N?{pos:u,types:t&&p}:null,j?{pos:h,types:t&&_}:null]}function BG(e,t,r,n){let o=Math.floor((e[0]-r[0])/t)*t+r[0],i=Math.floor((e[1]-r[1])/t)*t+r[1];return n[0]=o,n[1]=i,n[2]=o+t,n[3]=i+t,n}function hTe(e,t,r){r&8?(e[1]+=t,e[3]+=t):r&4?(e[1]-=t,e[3]-=t):r&2?(e[0]+=t,e[2]+=t):r&1&&(e[0]-=t,e[2]-=t)}function dTe(e,t,r,n){let o=1/0,i=-1/0,s=1/0,a=-1/0;for(let u=0;u<r;u+=t){let h=e[u],p=e[u+1];o=h<o?h:o,i=h>i?h:i,s=p<s?p:s,a=p>a?p:a}return n[0][0]=o,n[0][1]=s,n[1][0]=i,n[1][1]=a,n}function tT(e,t){for(let r=0;r<t.length;r++)e.push(t[r]);return e}var pTe=85.051129;function Y6(e,t){let{size:r=2,startIndex:n=0,endIndex:o=e.length,normalize:i=!0}=t||{},s=e.slice(n,o);jG(s,r,0,o-n);let a=Hv(s,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(i)for(let u of a)UG(u,r);return a}function q6(e,t=null,r){let{size:n=2,normalize:o=!0,edgeTypes:i=!1}=r||{};t=t||[];let s=[],a=[],u=0,h=0;for(let _=0;_<=t.length;_++){let y=t[_]||e.length,A=h,E=mTe(e,n,u,y);for(let k=E;k<y;k++)s[h++]=e[k];for(let k=u;k<E;k++)s[h++]=e[k];jG(s,n,A,h),gTe(s,n,A,h,r?.maxLatitude),u=y,a[_]=h}a.pop();let p=Xv(s,a,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:i});if(o)for(let _ of p)UG(_.positions,n);return p}function mTe(e,t,r,n){let o=-1,i=-1;for(let s=r+1;s<n;s+=t){let a=Math.abs(e[s]);a>o&&(o=a,i=s-1)}return i}function gTe(e,t,r,n,o=pTe){let i=e[r],s=e[n-t];if(Math.abs(i-s)>180){let a=Md(e,0,t,r);a[0]+=Math.round((s-i)/360)*360,Ra(e,a),a[1]=Math.sign(a[1])*o,Ra(e,a),a[0]=i,Ra(e,a)}}function jG(e,t,r,n){let o=e[0],i;for(let s=r;s<n;s+=t){i=e[s];let a=i-o;(a>180||a<-180)&&(i-=Math.round(a/360)*360),e[s]=o=i}}function UG(e,t){let r,n=e.length/t;for(let i=0;i<n&&(r=e[i*t],(r+180)%360===0);i++);let o=-Math.round(r/360)*360;if(o!==0)for(let i=0;i<n;i++)e[i*t]+=o}function VG(e,t,r,n){let o;if(Array.isArray(e[0])){let i=e.length*t;o=new Array(i);for(let s=0;s<e.length;s++)for(let a=0;a<t;a++)o[s*t+a]=e[s][a]||0}else o=e;return r?Hv(o,{size:t,gridResolution:r}):n?Y6(o,{size:t}):o}var yTe=1,xTe=2,G6=4,Kv=class extends wd{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?VG(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(WG(t)){let n=0;for(let o of t)n+=this.getGeometrySize(o);return n}let r=this.getPathLength(t);return r<2?0:this.isClosed(t)?r<3?0:r+2:r}updateGeometryAttributes(t,r){if(r.geometrySize!==0)if(t&&WG(t))for(let n of t){let o=this.getGeometrySize(n);r.geometrySize=o,this.updateGeometryAttributes(n,r),r.vertexStart+=o}else this._updateSegmentTypes(t,r),this._updatePositions(t,r)}_updateSegmentTypes(t,r){let n=this.attributes.segmentTypes,o=t?this.isClosed(t):!1,{vertexStart:i,geometrySize:s}=r;n.fill(0,i,i+s),o?(n[i]=G6,n[i+s-2]=G6):(n[i]+=yTe,n[i+s-2]+=xTe),n[i+s-1]=G6}_updatePositions(t,r){let{positions:n}=this.attributes;if(!n||!t)return;let{vertexStart:o,geometrySize:i}=r,s=new Array(3);for(let a=o,u=0;u<i;a++,u++)this.getPointOnPath(t,u,s),n[a*3]=s[0],n[a*3+1]=s[1],n[a*3+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,r,n=[]){let{positionSize:o}=this;r*o>=t.length&&(r+=1-t.length/o);let i=r*o;return n[0]=t[i],n[1]=t[i+1],n[2]=o===3&&t[i+2]||0,n}isClosed(t){if(!this.normalize)return!!this.opts.loop;let{positionSize:r}=this,n=t.length-r;return t[0]===t[n]&&t[1]===t[n+1]&&(r===2||t[2]===t[n+2])}};function WG(e){return Array.isArray(e[0])}var ZG=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var YG=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var qG=[0,0,0,255],bTe={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:qG},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},H6={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},$v=class extends rs{static{this.defaultProps=bTe}static{this.layerName="PathLayer"}getShaders(){return super.getShaders({vs:ZG,fs:YG,modules:[Ea,Ia]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:H6,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:H6,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:H6,defaultValue:qG},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:o,target:i})=>this.encodePickingColor(n&&n.__source?n.__source.index:o,i)}}),this.setState({pathTesselator:new Kv({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);let{props:r,changeFlags:n}=t,o=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){let{pathTesselator:s}=this.state,a=r.data.attributes||{};s.updateGeometry({data:r.data,geometryBuffer:a.getPath,buffers:a,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),n.dataChanged||o.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n}=r,o=this.props.data;return o[0]&&o[0].__source&&(r.object=o.find(i=>i.__source.index===n)),r}disablePickingIndex(t){let r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){let{jointRounded:r,capRounded:n,billboard:o,miterLimit:i,widthUnits:s,widthScale:a,widthMinPixels:u,widthMaxPixels:h}=this.props,p=this.state.model;p.setUniforms(t),p.setUniforms({jointType:Number(r),capType:Number(n),billboard:o,widthUnits:$a[s],widthScale:a,miterLimit:i,widthMinPixels:u,widthMaxPixels:h}),p.draw(this.context.renderPass)}_getModel(){let t=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ca({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(t){let{pathTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("positions")}calculateSegmentTypes(t){let{pathTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("segmentTypes")}};var rH=In($G(),1);var sT=KS.CLOCKWISE,QG=KS.COUNTER_CLOCKWISE,Sd={isClosed:!0};function DTe(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function P0(e){return"positions"in e?e.positions:e}function t1(e){return"holeIndices"in e?e.holeIndices:null}function LTe(e){return Array.isArray(e[0])}function FTe(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function BTe(e){let t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}function jTe(e,t,r,n){for(let o=0;o<t;o++)if(e[r+o]!==e[n-t+o])return!1;return!0}function JG(e,t,r,n,o){let i=t,s=r.length;for(let a=0;a<s;a++)for(let u=0;u<n;u++)e[i++]=r[a][u]||0;if(!BTe(r))for(let a=0;a<n;a++)e[i++]=r[0][a]||0;return Sd.start=t,Sd.end=i,Sd.size=n,Uv(e,o,Sd),i}function eH(e,t,r,n,o=0,i,s){i=i||r.length;let a=i-o;if(a<=0)return t;let u=t;for(let h=0;h<a;h++)e[u++]=r[o+h];if(!jTe(r,n,o,i))for(let h=0;h<n;h++)e[u++]=r[o+h];return Sd.start=t,Sd.end=u,Sd.size=n,Uv(e,s,Sd),u}function nH(e,t){DTe(e);let r=[],n=[];if("positions"in e){let{positions:o,holeIndices:i}=e;if(i){let s=0;for(let a=0;a<=i.length;a++)s=eH(r,s,o,t,i[a-1],i[a],a===0?sT:QG),n.push(s);return n.pop(),{positions:r,holeIndices:n}}e=o}if(!LTe(e))return eH(r,0,e,t,0,r.length,sT),r;if(!FTe(e)){let o=0;for(let[i,s]of e.entries())o=JG(r,o,s,t,i===0?sT:QG),n.push(o);return n.pop(),{positions:r,holeIndices:n}}return JG(r,0,e,t,sT),r}function J6(e,t,r){let n=e.length/3,o=0;for(let i=0;i<n;i++){let s=(i+1)%n;o+=e[i*3+t]*e[s*3+r],o-=e[s*3+t]*e[i*3+r]}return Math.abs(o/2)}function tH(e,t,r,n){let o=e.length/3;for(let i=0;i<o;i++){let s=i*3,a=e[s+0],u=e[s+1],h=e[s+2];e[s+t]=a,e[s+r]=u,e[s+n]=h}}function iH(e,t,r,n){let o=t1(e);o&&(o=o.map(a=>a/t));let i=P0(e),s=n&&t===3;if(r){let a=i.length;i=i.slice();let u=[];for(let h=0;h<a;h+=t){u[0]=i[h],u[1]=i[h+1],s&&(u[2]=i[h+2]);let p=r(u);i[h]=p[0],i[h+1]=p[1],s&&(i[h+2]=p[2])}}if(s){let a=J6(i,0,1),u=J6(i,0,2),h=J6(i,1,2);if(!a&&!u&&!h)return[];a>u&&a>h||(u>h?(r||(i=i.slice()),tH(i,0,2,1)):(r||(i=i.slice()),tH(i,2,0,1)))}return(0,rH.default)(i,o,t)}var r1=class extends wd{constructor(t){let{fp64:r,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){let{attributes:r}=this;return t==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[t]}updateGeometry(t){super.updateGeometry(t);let r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){let r=nH(t,this.positionSize);return this.opts.resolution?Xv(P0(r),t1(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?q6(P0(r),t1(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return t}getGeometrySize(t){if(oH(t)){let r=0;for(let n of t)r+=this.getGeometrySize(n);return r}return P0(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,r){if(t&&oH(t))for(let n of t){let o=this.getGeometrySize(n);r.geometrySize=o,this.updateGeometryAttributes(n,r),r.vertexStart+=o,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{let n=t;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(t,{geometryIndex:r,vertexStart:n,indexStart:o}){let{attributes:i,indexStarts:s,typedArrayManager:a}=this,u=i.indices;if(!u||!t)return;let h=o,p=iH(t,this.positionSize,this.opts.preproject,this.opts.full3d);u=a.allocate(u,o+p.length,{copy:!0});for(let _=0;_<p.length;_++)u[h++]=p[_]+n;s[r+1]=o+p.length,i.indices=u}_updatePositions(t,{vertexStart:r,geometrySize:n}){let{attributes:{positions:o},positionSize:i}=this;if(!o||!t)return;let s=P0(t);for(let a=r,u=0;u<n;a++,u++){let h=s[u*i],p=s[u*i+1],_=i>2?s[u*i+2]:0;o[a*3]=h,o[a*3+1]=p,o[a*3+2]=_}}_updateVertexValid(t,{vertexStart:r,geometrySize:n}){let{positionSize:o}=this,i=this.attributes.vertexValid,s=t&&t1(t);if(t&&t.edgeTypes?i.set(t.edgeTypes,r):i.fill(1,r,r+n),s)for(let a=0;a<s.length;a++)i[r+s[a]/o-1]=0;i[r+n-1]=0}};function oH(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var aT=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var sH=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${aT}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`;var aH=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${aT}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`;var lH=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var cT=[0,0,0,255],VTe={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:cT},getLineColor:{type:"accessor",value:cT},material:!0},lT={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},n1=class extends rs{static{this.defaultProps=VTe}static{this.layerName="SolidPolygonLayer"}getShaders(t){return super.getShaders({vs:t==="top"?sH:aH,fs:lH,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Ea,Lb,Ia]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:t}=this.context,{coordinateSystem:r}=this.props,{_full3d:n}=this.props;t.isGeospatial&&r===Mn.DEFAULT&&(r=Mn.LNGLAT);let o;r===Mn.LNGLAT&&(n?o=t.projectPosition.bind(t):o=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new r1({preproject:o,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let i=this.getAttributeManager(),s=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:lT,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:lT,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:lT,accessor:"getFillColor",defaultValue:cT},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:lT,accessor:"getLineColor",defaultValue:cT},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:u,target:h})=>this.encodePickingColor(a&&a.__source?a.__source.index:u,h)}})}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n}=r,o=this.props.data;return o[0]&&o[0].__source&&(r.object=o.find(i=>i.__source.index===n)),r}disablePickingIndex(t){let r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){let{extruded:r,filled:n,wireframe:o,elevationScale:i}=this.props,{topModel:s,sideModel:a,wireframeModel:u,polygonTesselator:h}=this.state,p={...t,extruded:!!r,elevationScale:i};u&&o&&(u.setInstanceCount(h.instanceCount-1),u.setUniforms(p),u.draw(this.context.renderPass)),a&&n&&(a.setInstanceCount(h.instanceCount-1),a.setUniforms(p),a.draw(this.context.renderPass)),s&&n&&(s.setVertexCount(h.vertexCount),s.setUniforms(p),s.draw(this.context.renderPass))}updateState(t){super.updateState(t),this.updateGeometry(t);let{props:r,oldProps:n,changeFlags:o}=t,i=this.getAttributeManager();(o.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),i.invalidateAll())}updateGeometry({props:t,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){let{polygonTesselator:i}=this.state,s=t.data.attributes||{};i.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:t,filled:r,extruded:n}=this.props,o,i,s;if(r){let a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;let u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});o=new Co(this.context.device,{...a,id:`${t}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){let a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});i=new Co(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new Ca({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new Co(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new Ca({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[i,s,o].filter(Boolean),topModel:o,sideModel:i,wireframeModel:s}}calculateIndices(t){let{polygonTesselator:r}=this.state;t.startIndices=r.indexStarts,t.value=r.get("indices")}calculatePositions(t){let{polygonTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}};function cH({data:e,getIndex:t,dataRange:r,replace:n}){let{startRow:o=0,endRow:i=1/0}=r,s=e.length,a=s,u=s;for(let y=0;y<s;y++){let A=t(e[y]);if(a>y&&A>=o&&(a=y),A>=i){u=y;break}}let h=a,_=u-a!==n.length?e.slice(u):void 0;for(let y=0;y<n.length;y++)e[h++]=n[y];if(_){for(let y=0;y<_.length;y++)e[h++]=_[y];e.length=h}return{startRow:a,endRow:a+n.length}}function uH(e,t){if(!e)return null;let r="startIndices"in e?e.startIndices[t]:t,n=e.featureIds.value[r];return r!==-1?WTe(e,n,r):null}function WTe(e,t,r){let n={properties:{...e.properties[t]}};for(let o in e.numericProps)n.properties[o]=e.numericProps[o].value[r];return n}function fH(e,t){let r={points:null,lines:null,polygons:null};for(let n in r){let o=e[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(o.length*3);let i=[];for(let s=0;s<o.length;s++)t(o[s],i),r[n][s*3+0]=i[0],r[n][s*3+1]=i[1],r[n][s*3+2]=i[2]}return r}var hH=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var eR=192/256,dH=[],ZTe={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},i1=class extends Jm{static{this.defaultProps=ZTe}static{this.layerName="MultiIconLayer"}getShaders(){return{...super.getShaders(),fs:hH}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:n,target:o})=>this.encodePickingColor(n,o)}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t,{outlineColor:o}=r;o!==n.outlineColor&&(o=o.map(i=>i/255),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!r.sdf&&r.outlineWidth&&Vr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){let{sdf:r,smoothing:n,outlineWidth:o}=this.props,{outlineColor:i}=this.state,s=o?Math.max(n,eR*(1-o)):-1;if(t.uniforms={...t.uniforms,sdfBuffer:eR,outlineBuffer:s,gamma:n,sdf:!!r,outlineColor:i},super.draw(t),r&&o){let{iconManager:a}=this.state,u=a.getTexture(),h=this.state.model;u&&(h.setUniforms({outlineBuffer:eR}),h.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(r=>super.getInstanceOffset(r)):dH}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(r=>super.getInstanceIconFrame(r)):dH}};var o1=class{constructor({fontSize:t=24,buffer:r=3,radius:n=8,cutoff:o=.25,fontFamily:i="sans-serif",fontWeight:s="normal",fontStyle:a="normal"}={}){this.buffer=r,this.cutoff=o,this.radius=n;let u=this.size=t+r*4,h=this._createCanvas(u),p=this.ctx=h.getContext("2d",{willReadFrequently:!0});p.font=`${a} ${s} ${t}px ${i}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(t){let r=document.createElement("canvas");return r.width=r.height=t,r}draw(t){let{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:i,actualBoundingBoxRight:s}=this.ctx.measureText(t),a=Math.ceil(n),u=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-i))),p=Math.min(this.size-this.buffer,a+Math.ceil(o)),_=h+2*this.buffer,y=p+2*this.buffer,A=Math.max(_*y,0),E=new Uint8ClampedArray(A),k={data:E,width:_,height:y,glyphWidth:h,glyphHeight:p,glyphTop:a,glyphLeft:u,glyphAdvance:r};if(h===0||p===0)return k;let{ctx:P,buffer:R,gridInner:V,gridOuter:N}=this;P.clearRect(R,R,h,p),P.fillText(t,R,R+a);let j=P.getImageData(R,R,h,p);N.fill(1e20,0,A),V.fill(0,0,A);for(let J=0;J<p;J++)for(let ne=0;ne<h;ne++){let de=j.data[4*(J*h+ne)+3]/255;if(de===0)continue;let fe=(J+R)*_+ne+R;if(de===1)N[fe]=0,V[fe]=1e20;else{let ye=.5-de;N[fe]=ye>0?ye*ye:0,V[fe]=ye<0?ye*ye:0}}pH(N,0,0,_,y,_,this.f,this.v,this.z),pH(V,R,R,h,p,_,this.f,this.v,this.z);for(let J=0;J<A;J++){let ne=Math.sqrt(N[J])-Math.sqrt(V[J]);E[J]=Math.round(255-255*(ne/this.radius+this.cutoff))}return k}};function pH(e,t,r,n,o,i,s,a,u){for(let h=t;h<t+n;h++)mH(e,r*i+h,i,o,s,a,u);for(let h=r;h<r+o;h++)mH(e,h*i+t,1,n,s,a,u)}function mH(e,t,r,n,o,i,s){i[0]=0,s[0]=-1e20,s[1]=1e20,o[0]=e[t];for(let a=1,u=0,h=0;a<n;a++){o[a]=e[t+a*r];let p=a*a;do{let _=i[u];h=(o[a]-o[_]+p-_*_)/(a-_)/2}while(h<=s[u]&&--u>-1);u++,i[u]=a,s[u]=h,s[u+1]=1e20}for(let a=0,u=0;a<n;a++){for(;s[u+1]<a;)u++;let h=i[u],p=a-h;e[t+a*r]=o[h]+p*p}}var YTe=32,qTe=[];function GTe(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function gH({characterSet:e,getFontWidth:t,fontHeight:r,buffer:n,maxCanvasWidth:o,mapping:i={},xOffset:s=0,yOffset:a=0}){let u=0,h=s,p=r+n*2;for(let _ of e)if(!i[_]){let y=t(_);h+y+n*2>o&&(h=0,u++),i[_]={x:h+n,y:a+u*p+n,width:y,height:p,layoutWidth:y,layoutHeight:r},h+=y+n*2}return{mapping:i,xOffset:h,yOffset:a+u*p,canvasHeight:GTe(a+(u+1)*p)}}function _H(e,t,r,n){let o=0;for(let i=t;i<r;i++){let s=e[i];o+=n[s]?.layoutWidth||0}return o}function yH(e,t,r,n,o,i){let s=t,a=0;for(let u=t;u<r;u++){let h=_H(e,u,u+1,o);a+h>n&&(s<u&&i.push(u),s=u,a=0),a+=h}return a}function HTe(e,t,r,n,o,i){let s=t,a=t,u=t,h=0;for(let p=t;p<r;p++)if((e[p]===" "||e[p+1]===" "||p+1===r)&&(u=p+1),u>a){let _=_H(e,a,u,o);h+_>n&&(s<a&&(i.push(a),s=a,h=0),_>n&&(_=yH(e,a,u,n,o,i),s=i[i.length-1])),a=u,h+=_}return h}function XTe(e,t,r,n,o=0,i){i===void 0&&(i=e.length);let s=[];return t==="break-all"?yH(e,o,i,r,n,s):HTe(e,o,i,r,n,s),s}function KTe(e,t,r,n,o,i){let s=0,a=0;for(let u=t;u<r;u++){let h=e[u],p=n[h];p?(a||(a=p.layoutHeight),o[u]=s+p.layoutWidth/2,s+=p.layoutWidth):(Vr.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),o[u]=s,s+=YTe)}i[0]=s,i[1]=a}function xH(e,t,r,n,o){let i=Array.from(e),s=i.length,a=new Array(s),u=new Array(s),h=new Array(s),p=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,_=[0,0],y=[0,0],A=0,E=0,k=0;for(let P=0;P<=s;P++){let R=i[P];if((R===`
`||P===s)&&(k=P),k>E){let V=p?XTe(i,r,n,o,E,k):qTe;for(let N=0;N<=V.length;N++){let j=N===0?E:V[N-1],J=N<V.length?V[N]:k;KTe(i,j,J,o,a,y);for(let ne=j;ne<J;ne++){let de=i[ne],fe=o[de]?.layoutOffsetY||0;u[ne]=A+y[1]/2+fe,h[ne]=y[0]}A=A+y[1]*t,_[0]=Math.max(_[0],y[0])}E=k}R===`
`&&(a[E]=0,u[E]=0,h[E]=0,E++)}return _[1]=A,{x:a,y:u,rowWidth:h,size:_}}function bH({value:e,length:t,stride:r,offset:n,startIndices:o,characterSet:i}){let s=e.BYTES_PER_ELEMENT,a=r?r/s:1,u=n?n/s:0,h=o[t]||Math.ceil((e.length-u)/a),p=i&&new Set,_=new Array(t),y=e;if(a>1||u>0){let A=e.constructor;y=new A(h);for(let E=0;E<h;E++)y[E]=e[E*a+u]}for(let A=0;A<t;A++){let E=o[A],k=o[A+1]||h,P=y.subarray(E,k);_[A]=String.fromCodePoint.apply(null,P),p&&P.forEach(p.add,p)}if(p)for(let A of p)i.add(String.fromCodePoint(A));return{texts:_,characterCount:h}}var O0=class{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){let r=this._cache[t];return r&&(this._deleteOrder(t),this._appendOrder(t)),r}set(t,r){this._cache[t]?(this.delete(t),this._cache[t]=r,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=r,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){let r=this._order.indexOf(t);r>=0&&this._order.splice(r,1)}_appendOrder(t){this._order.push(t)}};function $Te(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}var rg={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:$Te(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},vH=1024,wH=.9,AH=1.2,SH=3,uT=new O0(SH);function QTe(e,t){let r;typeof t=="string"?r=new Set(Array.from(t)):r=new Set(t);let n=uT.get(e);if(!n)return r;for(let o in n.mapping)r.has(o)&&r.delete(o);return r}function JTe(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}function MH(e,t,r,n){e.font=`${n} ${r}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function TH(e){Vr.assert(Number.isFinite(e)&&e>=SH,"Invalid cache limit"),uT=new O0(e)}var s1=class{constructor(){this.props={...rg}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:t,buffer:r}=this.props;return(t*AH+r*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();let r=QTe(this._key,this.props.characterSet),n=uT.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}let o=this._generateFontAtlas(r,n);this._atlas=o,uT.set(this._key,o)}_generateFontAtlas(t,r){let{fontFamily:n,fontWeight:o,fontSize:i,buffer:s,sdf:a,radius:u,cutoff:h}=this.props,p=r&&r.data;p||(p=document.createElement("canvas"),p.width=vH);let _=p.getContext("2d",{willReadFrequently:!0});MH(_,n,i,o);let{mapping:y,canvasHeight:A,xOffset:E,yOffset:k}=gH({getFontWidth:P=>_.measureText(P).width,fontHeight:i*AH,buffer:s,characterSet:t,maxCanvasWidth:vH,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(p.height!==A){let P=_.getImageData(0,0,p.width,p.height);p.height=A,_.putImageData(P,0,0)}if(MH(_,n,i,o),a){let P=new o1({fontSize:i,buffer:s,radius:u,cutoff:h,fontFamily:n,fontWeight:`${o}`});for(let R of t){let{data:V,width:N,height:j,glyphTop:J}=P.draw(R);y[R].width=N,y[R].layoutOffsetY=i*wH-J;let ne=_.createImageData(N,j);JTe(V,ne),_.putImageData(ne,y[R].x,y[R].y)}}else for(let P of t)_.fillText(P,y[P].x,y[P].y+s+i*wH);return{xOffset:E,yOffset:k,mapping:y,data:p,width:p.width,height:p.height}}_getKey(){let{fontFamily:t,fontWeight:r,fontSize:n,buffer:o,sdf:i,radius:s,cutoff:a}=this.props;return i?`${t} ${r} ${n} ${o} ${s} ${a}`:`${t} ${r} ${n} ${o}`}};var EH=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var IH=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var e3e={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},a1=class extends rs{static{this.defaultProps=e3e}static{this.layerName="TextBackgroundLayer"}getShaders(){return super.getShaders({vs:EH,fs:IH,modules:[Ea,Ia]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);let{changeFlags:r}=t;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{billboard:r,sizeScale:n,sizeUnits:o,sizeMinPixels:i,sizeMaxPixels:s,getLineWidth:a}=this.props,{padding:u}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]);let h=this.state.model;h.setUniforms(t),h.setUniforms({billboard:r,stroked:!!a,padding:u,sizeUnits:$a[o],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:s}),h.draw(this.context.renderPass)}_getModel(){let t=[0,0,1,0,1,1,0,1];return new Co(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ca({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}};var CH={start:1,middle:0,end:-1},kH={top:1,center:0,bottom:-1},tR=[0,0,0,255],t3e=1,r3e={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:tR},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:rg.characterSet},fontFamily:rg.fontFamily,fontWeight:rg.fontWeight,lineHeight:t3e,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:tR},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:tR},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},l1=class extends xu{constructor(){super(...arguments),this.getBoundingRect=(t,r)=>{let{size:[n,o]}=this.transformParagraph(t,r),{fontSize:i}=this.state.fontAtlasManager.props;n/=i,o/=i;let{getTextAnchor:s,getAlignmentBaseline:a}=this.props,u=CH[typeof s=="function"?s(t,r):s],h=kH[typeof a=="function"?a(t,r):a];return[(u-1)*n/2,(h-1)*o/2,n,o]},this.getIconOffsets=(t,r)=>{let{getTextAnchor:n,getAlignmentBaseline:o}=this.props,{x:i,y:s,rowWidth:a,size:[u,h]}=this.transformParagraph(t,r),p=CH[typeof n=="function"?n(t,r):n],_=kH[typeof o=="function"?o(t,r):o],y=i.length,A=new Array(y*2),E=0;for(let k=0;k<y;k++){let P=(1-p)*(u-a[k])/2;A[E++]=(p-1)*u/2+P+i[k],A[E++]=(_-1)*h/2+s[k]}return A}}static{this.defaultProps=r3e}static{this.layerName="TextLayer"}initializeState(){this.state={styleVersion:0,fontAtlasManager:new s1},this.props.maxWidth>0&&Vr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){let{props:r,oldProps:n,changeFlags:o}=t;(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){let{fontSettings:t,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:o,characterSet:i}=this.state,s={...t,characterSet:i,fontFamily:r,fontWeight:n};if(!o.mapping)return o.setProps(s),!0;for(let a in s)if(s[a]!==o.props[a])return o.setProps(s),!0;return!1}_updateText(){let{data:t,characterSet:r}=this.props,n=t.attributes?.getText,{getText:o}=this.props,i=t.startIndices,s,a=r==="auto"&&new Set;if(n&&i){let{texts:u,characterCount:h}=bH({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:i,characterSet:a});s=h,o=(p,{index:_})=>u[_]}else{let{iterable:u,objectInfo:h}=Bf(t);i=[0],s=0;for(let p of u){h.index++;let _=Array.from(o(p,h)||"");a&&_.forEach(a.add,a),s+=_.length,i.push(s)}}this.setState({getText:o,startIndices:i,numInstances:s,characterSet:a||r})}transformParagraph(t,r){let{fontAtlasManager:n}=this.state,o=n.mapping,i=this.state.getText,{wordBreak:s,lineHeight:a,maxWidth:u}=this.props,h=i(t,r)||"";return xH(h,a,s,u*n.props.fontSize,o)}renderLayers(){let{startIndices:t,numInstances:r,getText:n,fontAtlasManager:{scale:o,atlas:i,mapping:s},styleVersion:a}=this.state,{data:u,_dataDiff:h,getPosition:p,getColor:_,getSize:y,getAngle:A,getPixelOffset:E,getBackgroundColor:k,getBorderColor:P,getBorderWidth:R,backgroundPadding:V,background:N,billboard:j,fontSettings:J,outlineWidth:ne,outlineColor:de,sizeScale:fe,sizeUnits:ye,sizeMinPixels:ve,sizeMaxPixels:be,transitions:je,updateTriggers:Re}=this.props,Se=this.getSubLayerClass("characters",i1),Ue=this.getSubLayerClass("background",a1);return[N&&new Ue({getFillColor:k,getLineColor:P,getLineWidth:R,padding:V,getPosition:p,getSize:y,getAngle:A,getPixelOffset:E,billboard:j,sizeScale:fe,sizeUnits:ye,sizeMinPixels:ve,sizeMaxPixels:be,transitions:je&&{getPosition:je.getPosition,getAngle:je.getAngle,getSize:je.getSize,getFillColor:je.getBackgroundColor,getLineColor:je.getBorderColor,getLineWidth:je.getBorderWidth,getPixelOffset:je.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Re.getPosition,getAngle:Re.getAngle,getSize:Re.getSize,getFillColor:Re.getBackgroundColor,getLineColor:Re.getBorderColor,getLineWidth:Re.getBorderWidth,getPixelOffset:Re.getPixelOffset,getBoundingRect:{getText:Re.getText,getTextAnchor:Re.getTextAnchor,getAlignmentBaseline:Re.getAlignmentBaseline,styleVersion:a}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Se({sdf:J.sdf,smoothing:Number.isFinite(J.smoothing)?J.smoothing:rg.smoothing,outlineWidth:ne/(J.radius||rg.radius),outlineColor:de,iconAtlas:i,iconMapping:s,getPosition:p,getColor:_,getSize:y,getAngle:A,getPixelOffset:E,billboard:j,sizeScale:fe*o,sizeUnits:ye,sizeMinPixels:ve*o,sizeMaxPixels:be*o,transitions:je&&{getPosition:je.getPosition,getAngle:je.getAngle,getColor:je.getColor,getSize:je.getSize,getPixelOffset:je.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Re.getText,getPosition:Re.getPosition,getAngle:Re.getAngle,getColor:Re.getColor,getSize:Re.getSize,getPixelOffset:Re.getPixelOffset,getIconOffsets:{getTextAnchor:Re.getTextAnchor,getAlignmentBaseline:Re.getAlignmentBaseline,styleVersion:a}}}),{data:u,_dataDiff:h,startIndices:t,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){TH(t)}};var c1={circle:{type:Bv,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Jm,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:l1,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},u1={type:$v,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},fT={type:n1,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function R0({type:e,props:t}){let r={};for(let n in t)r[n]=e.defaultProps[t[n]];return r}function hT(e,t){let{transitions:r,updateTriggers:n}=e.props,o={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let i in t){let s=t[i],a=e.props[i];i.startsWith("get")&&(a=e.getSubLayerAccessor(a),o.updateTriggers[s]=n[i],r&&(o.transitions[s]=r[i])),o[s]=a}return o}function OH(e){if(Array.isArray(e))return e;switch(Vr.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Vr.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function rR(e,t,r={}){let n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:i=e.length}=r;for(let s=o;s<i;s++){let a=e[s],{geometry:u}=a;if(u)if(u.type==="GeometryCollection"){Vr.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");let{geometries:h}=u;for(let p=0;p<h.length;p++){let _=h[p];PH(_,n,t,a,s)}}else PH(u,n,t,a,s)}return n}function PH(e,t,r,n,o){let{type:i,coordinates:s}=e,{pointFeatures:a,lineFeatures:u,polygonFeatures:h,polygonOutlineFeatures:p}=t;if(!i3e(i,s)){Vr.warn(`${i} coordinates are malformed`)();return}switch(i){case"Point":a.push(r({geometry:e},n,o));break;case"MultiPoint":s.forEach(_=>{a.push(r({geometry:{type:"Point",coordinates:_}},n,o))});break;case"LineString":u.push(r({geometry:e},n,o));break;case"MultiLineString":s.forEach(_=>{u.push(r({geometry:{type:"LineString",coordinates:_}},n,o))});break;case"Polygon":h.push(r({geometry:e},n,o)),s.forEach(_=>{p.push(r({geometry:{type:"LineString",coordinates:_}},n,o))});break;case"MultiPolygon":s.forEach(_=>{h.push(r({geometry:{type:"Polygon",coordinates:_}},n,o)),_.forEach(y=>{p.push(r({geometry:{type:"LineString",coordinates:y}},n,o))})});break;default:}}var n3e={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function i3e(e,t){let r=n3e[e];for(Vr.assert(r,`Unknown GeoJSON type ${e}`);t&&--r>0;)t=t[0];return t&&Number.isFinite(t[0])}function RH(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function dT(e){return e.geometry.coordinates}function NH(e,t){let r=RH(),{pointFeatures:n,lineFeatures:o,polygonFeatures:i,polygonOutlineFeatures:s}=e;return r.points.data=n,r.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),r.points.getPosition=dT,r.lines.data=o,r.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),r.lines.getPath=dT,r.polygons.data=i,r.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),r.polygons.getPolygon=dT,r.polygonsOutline.data=s,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),r.polygonsOutline.getPath=dT,r}function zH(e,t){let r=RH(),{points:n,lines:o,polygons:i}=e,s=fH(e,t);return r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:3,value:s.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:s.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.lines._pathType="open",r.polygons.data={length:i.polygonIndices.value.length-1,startIndices:i.polygonIndices.value,attributes:{...i.attributes,getPolygon:i.positions,pickingColors:{size:3,value:s.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.polygons._normalize=!1,i.triangles&&(r.polygons.data.attributes.indices=i.triangles.value),r.polygonsOutline.data={length:i.primitivePolygonIndices.value.length-1,startIndices:i.primitivePolygonIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:s.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.polygonsOutline._pathType="open",r}var o3e=["points","linestrings","polygons"],s3e={...R0(c1.circle),...R0(c1.icon),...R0(c1.text),...R0(u1),...R0(fT),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},jf=class extends xu{static{this.layerName="GeoJsonLayer"}static{this.defaultProps=s3e}initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:r}){if(!r.dataChanged)return;let{data:n}=this.props,o=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:o}),o?this._updateStateBinary({props:t,changeFlags:r}):this._updateStateJSON({props:t,changeFlags:r})}_updateStateBinary({props:t,changeFlags:r}){let n=zH(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:r}){let n=OH(t.data),o=this.getSubLayerRow.bind(this),i={},s={};if(Array.isArray(r.dataChanged)){let u=this.state.features;for(let h in u)i[h]=u[h].slice(),s[h]=[];for(let h of r.dataChanged){let p=rR(n,o,h);for(let _ in u)s[_].push(cH({data:i[_],getIndex:y=>y.__source.index,dataRange:h,replace:p[_]}))}}else i=rR(n,o);let a=NH(i,s);this.setState({features:i,featuresDiff:s,layerProps:a})}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n,sourceLayer:o}=r;return r.featureType=o3e.find(i=>o.id.startsWith(`${this.id}-${i}-`)),n>=0&&o.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(t){let r=`${this.id}-points-`,n=t.featureType==="points";for(let o of this.getSubLayers())o.id.startsWith(r)===n&&o.updateAutoHighlight(t)}_renderPolygonLayer(){let{extruded:t,wireframe:r}=this.props,{layerProps:n}=this.state,o="polygons-fill",i=this.shouldRenderSubLayer(o,n.polygons?.data)&&this.getSubLayerClass(o,fT.type);if(i){let s=hT(this,fT.props),a=t&&r;return a||delete s.getLineColor,s.updateTriggers.lineColors=a,new i(s,this.getSubLayerProps({id:o,updateTriggers:s.updateTriggers}),n.polygons)}return null}_renderLineLayers(){let{extruded:t,stroked:r}=this.props,{layerProps:n}=this.state,o="polygons-stroke",i="linestrings",s=!t&&r&&this.shouldRenderSubLayer(o,n.polygonsOutline?.data)&&this.getSubLayerClass(o,u1.type),a=this.shouldRenderSubLayer(i,n.lines?.data)&&this.getSubLayerClass(i,u1.type);if(s||a){let u=hT(this,u1.props);return[s&&new s(u,this.getSubLayerProps({id:o,updateTriggers:u.updateTriggers}),n.polygonsOutline),a&&new a(u,this.getSubLayerProps({id:i,updateTriggers:u.updateTriggers}),n.lines)]}return null}_renderPointLayers(){let{pointType:t}=this.props,{layerProps:r,binary:n}=this.state,{highlightedObjectIndex:o}=this.props;!n&&Number.isFinite(o)&&(o=r.points.data.findIndex(a=>a.__source.index===o));let i=new Set(t.split("+")),s=[];for(let a of i){let u=`points-${a}`,h=c1[a],p=h&&this.shouldRenderSubLayer(u,r.points?.data)&&this.getSubLayerClass(u,h.type);if(p){let _=hT(this,h.props),y=r.points;if(a==="text"&&n){let{instancePickingColors:A,...E}=y.data.attributes;y={...y,data:{...y.data,attributes:E}}}s.push(new p(_,this.getSubLayerProps({id:u,updateTriggers:_.updateTriggers,highlightedObjectIndex:o}),y))}}return s}renderLayers(){let{extruded:t}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),o=this._renderPointLayers();return[!t&&r,n,o,t&&r]}getSubLayerAccessor(t){let{binary:r}=this.state;return!r||typeof t!="function"?super.getSubLayerAccessor(t):(n,o)=>{let{data:i,index:s}=o,a=uH(i,s);return t(a,o)}}};var pT=class{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:r,onLoad:n,onError:o}){let{index:i,id:s,bbox:a,userData:u,zoom:h}=this,p=this._loaderId;this._abortController=new AbortController;let{signal:_}=this._abortController,y=await r.scheduleRequest(this,k=>k.isSelected?1:-1);if(!y){this._isCancelled=!0;return}if(this._isCancelled){y.done();return}let A=null,E;try{A=await t({index:i,id:s,bbox:a,userData:u,zoom:h,signal:_})}catch(k){E=k||!0}finally{y.done()}if(p===this._loaderId){if(this._loader=void 0,this.content=A,this._isCancelled&&!A){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,E?o(E,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var xo={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var DH=new mr,a3e=new mr,N0=class e{constructor(t=[0,0,0],r=[0,0,0],n){n=n||DH.copy(t).add(r).scale(.5),this.center=new mr(n),this.halfDiagonal=new mr(r).subtract(this.center),this.minimum=new mr(t),this.maximum=new mr(r)}clone(){return new e(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){let{halfDiagonal:r}=this,n=a3e.from(t.normal),o=r.x*Math.abs(n.x)+r.y*Math.abs(n.y)+r.z*Math.abs(n.z),i=this.center.dot(n)+t.distance;return i-o>0?xo.INSIDE:i+o<0?xo.OUTSIDE:xo.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){let r=DH.from(t).subtract(this.center),{halfDiagonal:n}=this,o=0,i;return i=Math.abs(r.x)-n.x,i>0&&(o+=i*i),i=Math.abs(r.y)-n.y,i>0&&(o+=i*i),i=Math.abs(r.z)-n.z,i>0&&(o+=i*i),o}};var f1=new mr,LH=new mr,z0=class e{constructor(t=[0,0,0],r=0){this.radius=-0,this.center=new mr,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=f1.from(r),this.center=new mr().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new e(this.center,this.radius)}union(t){let r=this.center,n=this.radius,o=t.center,i=t.radius,s=f1.copy(o).subtract(r),a=s.magnitude();if(n>=a+i)return this.clone();if(i>=a+n)return t.clone();let u=(n+a+i)*.5;return LH.copy(s).scale((-n+u)/a).add(r),this.center.copy(LH),this.radius=u,this}expand(t){let n=f1.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);let r=yo.getScaling(f1,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){let r=this.distanceTo(t);return r*r}distanceTo(t){let n=f1.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){let r=this.center,n=this.radius,i=t.normal.dot(r)+t.distance;return i<-n?xo.OUTSIDE:i<n?xo.INTERSECTING:xo.INSIDE}};var l3e=new mr,c3e=new mr,mT=new mr,gT=new mr,_T=new mr,u3e=new mr,f3e=new mr,Uf={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},h1=class e{constructor(t=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new mr().from(t),this.halfAxes=new Hi(r)}get halfSize(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new mr(t).len(),new mr(r).len(),new mr(n).len()]}get quaternion(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),o=new mr(t).normalize(),i=new mr(r).normalize(),s=new mr(n).normalize();return new o0().fromMatrix3(new Hi([...o,...i,...s]))}fromCenterHalfSizeQuaternion(t,r,n){let o=new o0(n),i=new Hi().fromQuaternion(o);return i[0]=i[0]*r[0],i[1]=i[1]*r[0],i[2]=i[2]*r[0],i[3]=i[3]*r[1],i[4]=i[4]*r[1],i[5]=i[5]*r[1],i[6]=i[6]*r[2],i[7]=i[7]*r[2],i[8]=i[8]*r[2],this.center=new mr().from(t),this.halfAxes=i,this}clone(){return new e(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new z0){let r=this.halfAxes,n=r.getColumn(0,mT),o=r.getColumn(1,gT),i=r.getColumn(2,_T),s=l3e.copy(n).add(o).add(i);return t.center.copy(this.center),t.radius=s.magnitude(),t}intersectPlane(t){let r=this.center,n=t.normal,o=this.halfAxes,i=n.x,s=n.y,a=n.z,u=Math.abs(i*o[Uf.COLUMN0ROW0]+s*o[Uf.COLUMN0ROW1]+a*o[Uf.COLUMN0ROW2])+Math.abs(i*o[Uf.COLUMN1ROW0]+s*o[Uf.COLUMN1ROW1]+a*o[Uf.COLUMN1ROW2])+Math.abs(i*o[Uf.COLUMN2ROW0]+s*o[Uf.COLUMN2ROW1]+a*o[Uf.COLUMN2ROW2]),h=n.dot(r)+t.distance;return h<=-u?xo.OUTSIDE:h>=u?xo.INSIDE:xo.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){let r=c3e.from(t).subtract(this.center),n=this.halfAxes,o=n.getColumn(0,mT),i=n.getColumn(1,gT),s=n.getColumn(2,_T),a=o.magnitude(),u=i.magnitude(),h=s.magnitude();o.normalize(),i.normalize(),s.normalize();let p=0,_;return _=Math.abs(r.dot(o))-a,_>0&&(p+=_*_),_=Math.abs(r.dot(i))-u,_>0&&(p+=_*_),_=Math.abs(r.dot(s))-h,_>0&&(p+=_*_),p}computePlaneDistances(t,r,n=[-0,-0]){let o=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=this.center,a=this.halfAxes,u=a.getColumn(0,mT),h=a.getColumn(1,gT),p=a.getColumn(2,_T),_=u3e.copy(u).add(h).add(p).add(s),y=f3e.copy(_).subtract(t),A=r.dot(y);return o=Math.min(A,o),i=Math.max(A,i),_.copy(s).add(u).add(h).subtract(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),_.copy(s).add(u).subtract(h).add(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),_.copy(s).add(u).subtract(h).subtract(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),s.copy(_).subtract(u).add(h).add(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),s.copy(_).subtract(u).add(h).subtract(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),s.copy(_).subtract(u).subtract(h).add(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),s.copy(_).subtract(u).subtract(h).subtract(p),y.copy(_).subtract(t),A=r.dot(y),o=Math.min(A,o),i=Math.max(A,i),n[0]=o,n[1]=i,n}transform(t){this.center.transformAsPoint(t);let r=this.halfAxes.getColumn(0,mT);r.transformAsPoint(t);let n=this.halfAxes.getColumn(1,gT);n.transformAsPoint(t);let o=this.halfAxes.getColumn(2,_T);return o.transformAsPoint(t),this.halfAxes=new Hi([...r,...n,...o]),this}getTransform(){throw new Error("not implemented")}};var FH=new mr,BH=new mr,Vf=class e{constructor(t=[0,0,1],r=0){this.normal=new mr,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return uu(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=FH.from(t),this.normal.from(r).normalize();let n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,r,n,o){return this.normal.set(t,r,n),uu(na(this.normal.len(),1)),this.distance=o,this}clone(){return new e(this.normal,this.distance)}equals(t){return na(this.distance,t.distance)&&na(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){let r=BH.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,r)}projectPointOntoPlane(t,r=[0,0,0]){let n=FH.from(t),o=this.getPointDistance(n),i=BH.copy(this.normal).scale(o);return n.subtract(i).to(r)}};var jH=[new mr([1,0,0]),new mr([0,1,0]),new mr([0,0,1])],UH=new mr,h3e=new mr,Wf=class e{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*jH.length;let r=t.center,n=t.radius,o=0;for(let i of jH){let s=this.planes[o],a=this.planes[o+1];s||(s=this.planes[o]=new Vf),a||(a=this.planes[o+1]=new Vf);let u=UH.copy(i).scale(-n).add(r);s.fromPointNormal(u,i);let h=UH.copy(i).scale(n).add(r),p=h3e.copy(i).negate();a.fromPointNormal(h,p),o+=2}return this}computeVisibility(t){let r=xo.INSIDE;for(let n of this.planes)switch(t.intersectPlane(n)){case xo.OUTSIDE:return xo.OUTSIDE;case xo.INTERSECTING:r=xo.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(t,r){if(uu(Number.isFinite(r),"parentPlaneMask is required."),r===e.MASK_OUTSIDE||r===e.MASK_INSIDE)return r;let n=e.MASK_INSIDE,o=this.planes;for(let i=0;i<this.planes.length;++i){let s=i<31?1<<i:0;if(i<31&&!(r&s))continue;let a=o[i],u=t.intersectPlane(a);if(u===xo.OUTSIDE)return e.MASK_OUTSIDE;u===xo.INTERSECTING&&(n|=s)}return n}};Wf.MASK_OUTSIDE=4294967295;Wf.MASK_INSIDE=0;Wf.MASK_INDETERMINATE=2147483647;var oot=new mr,sot=new mr,aot=new mr,lot=new mr,cot=new mr;var mot=new mr,got=new mr,_ot=new mr,yot=new mr,xot=new mr,bot=new mr,vot=new mr,wot=new mr,Aot=new mr,Mot=new mr,Sot=new mr,Tot=new mr;var bu=new Hi,p3e=new Hi,m3e=new Hi,yT=new Hi,VH=new Hi;function oR(e,t={}){let r=Db.EPSILON20,n=10,o=0,i=0,s=p3e,a=m3e;s.identity(),a.copy(e);let u=r*g3e(a);for(;i<n&&_3e(a)>u;)y3e(a,yT),VH.copy(yT).transpose(),a.multiplyRight(yT),a.multiplyLeft(VH),s.multiplyRight(yT),++o>2&&(++i,o=0);return t.unitary=s.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function g3e(e){let t=0;for(let r=0;r<9;++r){let n=e[r];t+=n*n}return Math.sqrt(t)}var nR=[1,0,0],iR=[2,2,1];function _3e(e){let t=0;for(let r=0;r<3;++r){let n=e[bu.getElementIndex(iR[r],nR[r])];t+=2*n*n}return Math.sqrt(t)}function y3e(e,t){let r=Db.EPSILON15,n=0,o=1;for(let h=0;h<3;++h){let p=Math.abs(e[bu.getElementIndex(iR[h],nR[h])]);p>n&&(o=h,n=p)}let i=nR[o],s=iR[o],a=1,u=0;if(Math.abs(e[bu.getElementIndex(s,i)])>r){let h=e[bu.getElementIndex(s,s)],p=e[bu.getElementIndex(i,i)],_=e[bu.getElementIndex(s,i)],y=(h-p)/2/_,A;y<0?A=-1/(-y+Math.sqrt(1+y*y)):A=1/(y+Math.sqrt(1+y*y)),a=1/Math.sqrt(1+A*A),u=A*a}return Hi.IDENTITY.to(t),t[bu.getElementIndex(i,i)]=t[bu.getElementIndex(s,s)]=a,t[bu.getElementIndex(s,i)]=u,t[bu.getElementIndex(i,s)]=-u,t}var Td=new mr,x3e=new mr,b3e=new mr,v3e=new mr,w3e=new mr,A3e=new Hi,M3e={diagonal:new Hi,unitary:new Hi};function sR(e,t=new h1){if(!e||e.length===0)return t.halfAxes=new Hi([0,0,0,0,0,0,0,0,0]),t.center=new mr,t;let r=e.length,n=new mr(0,0,0);for(let ye of e)n.add(ye);let o=1/r;n.multiplyByScalar(o);let i=0,s=0,a=0,u=0,h=0,p=0;for(let ye of e){let ve=Td.copy(ye).subtract(n);i+=ve.x*ve.x,s+=ve.x*ve.y,a+=ve.x*ve.z,u+=ve.y*ve.y,h+=ve.y*ve.z,p+=ve.z*ve.z}i*=o,s*=o,a*=o,u*=o,h*=o,p*=o;let _=A3e;_[0]=i,_[1]=s,_[2]=a,_[3]=s,_[4]=u,_[5]=h,_[6]=a,_[7]=h,_[8]=p;let{unitary:y}=oR(_,M3e),A=t.halfAxes.copy(y),E=A.getColumn(0,b3e),k=A.getColumn(1,v3e),P=A.getColumn(2,w3e),R=-Number.MAX_VALUE,V=-Number.MAX_VALUE,N=-Number.MAX_VALUE,j=Number.MAX_VALUE,J=Number.MAX_VALUE,ne=Number.MAX_VALUE;for(let ye of e)Td.copy(ye),R=Math.max(Td.dot(E),R),V=Math.max(Td.dot(k),V),N=Math.max(Td.dot(P),N),j=Math.min(Td.dot(E),j),J=Math.min(Td.dot(k),J),ne=Math.min(Td.dot(P),ne);E=E.multiplyByScalar(.5*(j+R)),k=k.multiplyByScalar(.5*(J+V)),P=P.multiplyByScalar(.5*(ne+N)),t.center.copy(E).add(k).add(P);let de=x3e.set(R-j,V-J,N-ne).multiplyByScalar(.5),fe=new Hi([de[0],0,0,0,de[1],0,0,0,de[2]]);return t.halfAxes.multiplyRight(fe),t}var D0=512,WH=3,ZH=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],YH=ZH.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),S3e=YH.concat([[.25,.5],[.75,.5]]),aR=class e{constructor(t,r,n){this.x=t,this.y=r,this.z=n}get children(){if(!this._children){let t=this.x*2,r=this.y*2,n=this.z+1;this._children=[new e(t,r,n),new e(t,r+1,n),new e(t+1,r,n),new e(t+1,r+1,n)]}return this._children}update(t){let{viewport:r,cullingVolume:n,elevationBounds:o,minZ:i,maxZ:s,bounds:a,offset:u,project:h}=t,p=this.getBoundingVolume(o,u,h);if(a&&!this.insideBounds(a)||n.computeVisibility(p)<0)return!1;if(!this.childVisible){let{z:y}=this;if(y<s&&y>=i){let A=p.distanceTo(r.cameraPosition)*r.scale/r.height;y+=Math.floor(Math.log2(A))}if(y>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let y of this.children)y.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(let r of this._children)r.getSelected(t);return t}insideBounds([t,r,n,o]){let i=Math.pow(2,this.z),s=D0/i;return this.x*s<n&&this.y*s<o&&(this.x+1)*s>t&&(this.y+1)*s>r}getBoundingVolume(t,r,n){if(n){let u=this.z<1?S3e:this.z<2?YH:ZH,h=[];for(let p of u){let _=xT(this.x+p[0],this.y+p[1],this.z);_[2]=t[0],h.push(n(_)),t[0]!==t[1]&&(_[2]=t[1],h.push(n(_)))}return sR(h)}let o=Math.pow(2,this.z),i=D0/o,s=this.x*i+r*D0,a=D0-(this.y+1)*i;return new N0([s,a,t[0]],[s+i,a+i,t[1]])}};function qH(e,t,r,n){let o=e instanceof M0&&e.resolution?e.projectPosition:null,i=Object.values(e.getFrustumPlanes()).map(({normal:A,distance:E})=>new Vf(A.clone().negate(),E)),s=new Wf(i),a=e.distanceScales.unitsPerMeter[2],u=r&&r[0]*a||0,h=r&&r[1]*a||0,p=e instanceof Ja&&e.pitch<=60?t:0;if(n){let[A,E,k,P]=n,R=ps([A,P]),V=ps([k,E]);n=[R[0],D0-R[1],V[0],D0-V[1]]}let _=new aR(0,0,0),y={viewport:e,project:o,cullingVolume:s,elevationBounds:[u,h],minZ:p,maxZ:t,bounds:n,offset:0};if(_.update(y),e instanceof Ja&&e.subViewports&&e.subViewports.length>1){for(y.offset=-1;_.update(y)&&!(--y.offset<-WH););for(y.offset=1;_.update(y)&&!(++y.offset>WH););}return _.getSelected()}var Zf=512,T3e=[-1/0,-1/0,1/0,1/0],d1={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(r=>typeof r=="string"),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}};function HH(e,t){let r=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...r.map(o=>o[0])),Math.min(...r.map(o=>o[1])),Math.max(...r.map(o=>o[0])),Math.max(...r.map(o=>o[1]))]}function E3e(e){return Math.abs(e.split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0)|0,0))}function p1(e,t){if(!e||!e.length)return null;let{index:r,id:n}=t;if(Array.isArray(e)){let i=E3e(n)%e.length;e=e[i]}let o=e;for(let i of Object.keys(r)){let s=new RegExp(`{${i}}`,"g");o=o.replace(s,String(r[i]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(o=o.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),o}function I3e(e,t,r){let n;if(t&&t.length===2){let[o,i]=t,s=e.getBounds({z:o}),a=e.getBounds({z:i});n=[Math.min(s[0],a[0]),Math.min(s[1],a[1]),Math.max(s[2],a[2]),Math.max(s[3],a[3])]}else n=e.getBounds();return e.isGeospatial?[Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.min(n[2],r[2]),Math.min(n[3],r[3])]:[Math.max(Math.min(n[0],r[2]),r[0]),Math.max(Math.min(n[1],r[3]),r[1]),Math.min(Math.max(n[2],r[0]),r[2]),Math.min(Math.max(n[3],r[1]),r[3])]}function XH({viewport:e,z:t,cullRect:r}){return(e.subViewports||[e]).map(o=>lR(o,t||0,r))}function lR(e,t,r){if(!Array.isArray(t)){let i=r.x-e.x,s=r.y-e.y,{width:a,height:u}=r,h={targetZ:t},p=e.unproject([i,s],h),_=e.unproject([i+a,s],h),y=e.unproject([i,s+u],h),A=e.unproject([i+a,s+u],h);return[Math.min(p[0],_[0],y[0],A[0]),Math.min(p[1],_[1],y[1],A[1]),Math.max(p[0],_[0],y[0],A[0]),Math.max(p[1],_[1],y[1],A[1])]}let n=lR(e,t[0],r),o=lR(e,t[1],r);return[Math.min(n[0],o[0]),Math.min(n[1],o[1]),Math.max(n[2],o[2]),Math.max(n[3],o[3])]}function C3e(e,t,r){return r?HH(e,r).map(o=>o*t/Zf):e.map(n=>n*t/Zf)}function cR(e,t){return Math.pow(2,e)*Zf/t}function xT(e,t,r){let n=cR(r,Zf),o=e/n*360-180,i=Math.PI-2*Math.PI*t/n,s=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[o,s]}function GH(e,t,r,n){let o=cR(r,n);return[e/o*Zf,t/o*Zf]}function uR(e,t,r,n,o=Zf){if(e.isGeospatial){let[h,p]=xT(t,r,n),[_,y]=xT(t+1,r+1,n);return{west:h,north:p,east:_,south:y}}let[i,s]=GH(t,r,n,o),[a,u]=GH(t+1,r+1,n,o);return{left:i,top:s,right:a,bottom:u}}function k3e(e,t,r,n,o){let i=I3e(e,null,n),s=cR(t,r),[a,u,h,p]=C3e(i,s,o),_=[];for(let y=Math.floor(a);y<h;y++)for(let A=Math.floor(u);A<p;A++)_.push({x:y,y:A,z:t});return _}function fR({viewport:e,maxZoom:t,minZoom:r,zRange:n,extent:o,tileSize:i=Zf,modelMatrix:s,modelMatrixInverse:a,zoomOffset:u=0}){let h=e.isGeospatial?Math.round(e.zoom+Math.log2(Zf/i))+u:Math.ceil(e.zoom)+u;if(typeof r=="number"&&Number.isFinite(r)&&h<r){if(!o)return[];h=r}typeof t=="number"&&Number.isFinite(t)&&h>t&&(h=t);let p=o;return s&&a&&o&&!e.isGeospatial&&(p=HH(o,s)),e.isGeospatial?qH(e,h,n,o):k3e(e,h,i,p||T3e,a)}function hR(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function dR(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}function KH(e){let t={},r;return n=>{for(let o in n)if(!P3e(n[o],t[o])){r=e(n),t=n;break}return r}}function P3e(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}var $H=1,bT=2,O3e="never",R3e="no-overlap",g1="best-available",N3e=5,z3e={[g1]:L3e,[R3e]:F3e,[O3e]:()=>{}},D3e={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},m1=class{constructor(t){this._getCullBounds=KH(XH),this.opts={...D3e,...t},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new q_({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ci,this._modelMatrixInverse=new Ci}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(let t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let t of this._cache.keys()){let r=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(t):r.setNeedsReload()}}update(t,{zRange:r,modelMatrix:n}={zRange:null,modelMatrix:null}){let o=n?new Ci(n):new Ci,i=!o.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!na(this._zRange,r)||i){i&&(this._modelMatrixInverse=o.clone().invert(),this._modelMatrix=o),this._viewport=t,this._zRange=r;let a=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));let s=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),s&&this._frameNumber++,this._frameNumber}isTileVisible(t,r){if(!t.isVisible)return!1;if(r&&this._viewport){let n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:o}=t;for(let[i,s,a,u]of n){let h;if("west"in o)h=o.west<a&&o.east>i&&o.south<u&&o.north>s;else{let p=Math.min(o.top,o.bottom),_=Math.max(o.top,o.bottom);h=o.left<a&&o.right>i&&p<u&&_>s}if(h)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:r,minZoom:n,zRange:o,modelMatrix:i,modelMatrixInverse:s}){let{tileSize:a,extent:u,zoomOffset:h}=this.opts;return fR({viewport:t,maxZoom:r,minZoom:n,zRange:o,tileSize:a,extent:u,modelMatrix:i,modelMatrixInverse:s,zoomOffset:h})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){let{tileSize:r}=this.opts;return{bbox:uR(this._viewport,t.x,t.y,t.z,r)}}getParentIndex(t){let r=Math.floor(t.x/2),n=Math.floor(t.y/2),o=t.z-1;return{x:r,y:n,z:o}}updateTileStates(){let t=this.opts.refinementStrategy||g1,r=new Array(this._cache.size),n=0;for(let o of this._cache.values())r[n++]=o.isVisible,o.isSelected=!1,o.isVisible=!1;for(let o of this._selectedTiles)o.isSelected=!0,o.isVisible=!0;(typeof t=="function"?t:z3e[t])(Array.from(this._cache.values())),n=0;for(let o of this._cache.values())if(r[n++]!==o.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:t=0}=this.opts,r=[],n=0;for(let o of this._cache.values())o.isLoading&&(n++,!o.isSelected&&!o.isVisible&&r.push(o));for(;t>0&&n>t&&r.length>0;)r.shift().abort(),n--}_rebuildTree(){let{_cache:t}=this;for(let r of t.values())r.parent=null,r.children&&(r.children.length=0);for(let r of t.values()){let n=this._getNearestAncestor(r);r.parent=n,n?.children&&n.children.push(r)}}_resizeCache(){let{_cache:t,opts:r}=this,n=r.maxCacheSize||(r.maxCacheByteSize?1/0:N3e*this.selectedTiles.length),o=r.maxCacheByteSize||1/0;if(t.size>n||this._cacheByteSize>o){for(let[s,a]of t)if(!a.isVisible&&!a.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize?a.byteLength:0,t.delete(s),this.opts.onTileUnload?.(a)),t.size<=n&&this._cacheByteSize<=o)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((s,a)=>s.zoom-a.zoom),this._dirty=!1)}_getTile(t,r){let n=this.getTileId(t),o=this._cache.get(n),i=!1;return!o&&r?(o=new pT(t),Object.assign(o,this.getTileMetadata(o.index)),Object.assign(o,{id:n,zoom:this.getTileZoom(o.index)}),i=!0,this._cache.set(n,o),this._dirty=!0):o&&o.needsReload&&(i=!0),o&&i&&o.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),o}_getNearestAncestor(t){let{_minZoom:r=0}=this,n=t.index;for(;this.getTileZoom(n)>r;){n=this.getParentIndex(n);let o=this._getTile(n);if(o)return o}return null}};function L3e(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&!QH(t)&&pR(t);for(let t of e)t.isVisible=!!(t.state&bT)}function F3e(e){for(let r of e)r.state=0;for(let r of e)r.isSelected&&QH(r);let t=Array.from(e).sort((r,n)=>r.zoom-n.zoom);for(let r of t)if(r.isVisible=!!(r.state&bT),r.children&&(r.isVisible||r.state&$H))for(let n of r.children)n.state=$H;else r.isSelected&&pR(r)}function QH(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=bT,!0;t=t.parent}return!1}function pR(e){for(let t of e.children)t.isLoaded||t.content?t.state|=bT:pR(t)}var B3e={TilesetClass:m1,data:{type:"data",value:[]},dataComparator:d1.equal,renderSubLayers:{type:"function",value:e=>new jf(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:g1,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Ed=class extends xu{static{this.defaultProps=B3e}static{this.layerName="TileLayer"}initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(t=>t.isLoaded&&t.layers&&t.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:r}=this.state,n=t.propsOrDataChanged||t.updateTriggersChanged,o=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);r?n&&(r.setOptions(this._getTilesetOptions()),o?r.reloadAll():r.tiles.forEach(i=>{i.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){let{tileSize:t,maxCacheSize:r,maxCacheByteSize:n,refinementStrategy:o,extent:i,maxZoom:s,minZoom:a,maxRequests:u,debounceTime:h,zoomOffset:p}=this.props;return{maxCacheSize:r,maxCacheByteSize:n,maxZoom:s,minZoom:a,tileSize:t,refinementStrategy:o,extent:i,maxRequests:u,debounceTime:h,zoomOffset:p,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let t=this.state.tileset,{zRange:r,modelMatrix:n}=this.props,o=t.update(this.context.viewport,{zRange:r,modelMatrix:n}),{isLoaded:i}=t,s=this.state.isLoaded!==i,a=this.state.frameNumber!==o;i&&(s||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:o}),this.state.isLoaded=i}_onViewportLoad(){let{tileset:t}=this.state,{onViewportLoad:r}=this.props;r&&r(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,r){this.props.onTileError(t),r.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){let{data:r,getTileData:n,fetch:o}=this.props,{signal:i}=t;return t.url=typeof r=="string"||Array.isArray(r)?p1(r,t):null,n?n(t):o&&t.url?o(t.url,{propName:"data",layer:this,signal:i}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){let r=t.sourceLayer,n=r.props.tile,o=t.info;return o.picked&&(o.tile=n),o.sourceTile=n,o.sourceTileSubLayer=r,o}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{let r=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)r&&t.layers[0]&&Object.keys(r).some(n=>t.layers[0].props[n]!==r[n])&&(t.layers=t.layers.map(n=>n.clone(r)));else{let n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=ka(n,Boolean).map(o=>o.clone({tile:t,...r}))}return t.layers})}filterSubLayer({layer:t,cullRect:r}){let{tile:n}=t.props;return this.state.tileset.isTileVisible(n,r)}};var j3e={clipBounds:[0,0,1,1],clipByInstance:void 0},JH=`
uniform vec4 clip_bounds;
bool clip_isInBounds(vec2 position) {
return position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];
}
`,U3e={name:"clip-vs",vs:JH},V3e={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
if (clip_isVisible < 0.5) discard;
`},W3e={name:"clip-fs",fs:JH},Z3e={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
if (!clip_isInBounds(clip_commonPosition)) discard;
`},L0=class extends S0{static{this.defaultProps=j3e}static{this.extensionName="ClipExtension"}getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[U3e],inject:V3e}:{modules:[W3e],inject:Z3e}}draw({uniforms:t}){let{clipBounds:r}=this.props;if(this.state.clipByInstance)t.clip_bounds=r;else{let n=this.projectPosition([r[0],r[1],0]),o=this.projectPosition([r[2],r[3],0]);t.clip_bounds=[Math.min(n[0],o[0]),Math.min(n[1],o[1]),Math.max(n[0],o[0]),Math.max(n[1],o[1])]}}};function _R(e,t,r){let n=Y3e(e),o=Object.keys(n).filter(i=>n[i]!==Array);return q3e(e,{propArrayTypes:n,...t},{numericPropKeys:r&&r.numericPropKeys||o,PositionDataType:r?r.PositionDataType:Float32Array,triangulate:r?r.triangulate:!0})}function Y3e(e){let t={};for(let r of e)if(r.properties)for(let n in r.properties){let o=r.properties[n];t[n]=Q3e(o,t[n])}return t}function q3e(e,t,r){let{pointPositionsCount:n,pointFeaturesCount:o,linePositionsCount:i,linePathsCount:s,lineFeaturesCount:a,polygonPositionsCount:u,polygonObjectsCount:h,polygonRingsCount:p,polygonFeaturesCount:_,propArrayTypes:y,coordLength:A}=t,{numericPropKeys:E=[],PositionDataType:k=Float32Array,triangulate:P=!0}=r,R=e[0]&&"id"in e[0],V=e.length>65535?Uint32Array:Uint16Array,N={type:"Point",positions:new k(n*A),globalFeatureIds:new V(n),featureIds:o>65535?new Uint32Array(n):new Uint16Array(n),numericProps:{},properties:[],fields:[]},j={type:"LineString",pathIndices:i>65535?new Uint32Array(s+1):new Uint16Array(s+1),positions:new k(i*A),globalFeatureIds:new V(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},J={type:"Polygon",polygonIndices:u>65535?new Uint32Array(h+1):new Uint16Array(h+1),primitivePolygonIndices:u>65535?new Uint32Array(p+1):new Uint16Array(p+1),positions:new k(u*A),globalFeatureIds:new V(u),featureIds:_>65535?new Uint32Array(u):new Uint16Array(u),numericProps:{},properties:[],fields:[]};P&&(J.triangles=[]);for(let de of[N,j,J])for(let fe of E){let ye=y[fe];de.numericProps[fe]=new ye(de.positions.length/A)}j.pathIndices[s]=i,J.polygonIndices[h]=u,J.primitivePolygonIndices[p]=u;let ne={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let de of e){let fe=de.geometry,ye=de.properties||{};switch(fe.type){case"Point":G3e(fe,N,ne,A,ye),N.properties.push(gR(ye,E)),R&&N.fields.push({id:de.id}),ne.pointFeature++;break;case"LineString":H3e(fe,j,ne,A,ye),j.properties.push(gR(ye,E)),R&&j.fields.push({id:de.id}),ne.lineFeature++;break;case"Polygon":X3e(fe,J,ne,A,ye),J.properties.push(gR(ye,E)),R&&J.fields.push({id:de.id}),ne.polygonFeature++;break;default:throw new Error("Invalid geometry type")}ne.feature++}return $3e(N,j,J,A)}function G3e(e,t,r,n,o){t.positions.set(e.data,r.pointPosition*n);let i=e.data.length/n;yR(t,o,r.pointPosition,i),t.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+i),t.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+i),r.pointPosition+=i}function H3e(e,t,r,n,o){t.positions.set(e.data,r.linePosition*n);let i=e.data.length/n;yR(t,o,r.linePosition,i),t.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+i),t.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+i);for(let s=0,a=e.indices.length;s<a;++s){let u=e.indices[s],h=s===a-1?e.data.length:e.indices[s+1];t.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(h-u)/n}}function X3e(e,t,r,n,o){t.positions.set(e.data,r.polygonPosition*n);let i=e.data.length/n;yR(t,o,r.polygonPosition,i),t.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+i),t.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+i);for(let s=0,a=e.indices.length;s<a;++s){let u=r.polygonPosition;t.polygonIndices[r.polygonObject++]=u;let h=e.areas[s],p=e.indices[s],_=e.indices[s+1];for(let A=0,E=p.length;A<E;++A){let k=p[A],P=A===E-1?_===void 0?e.data.length:_[0]:p[A+1];t.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(P-k)/n}let y=r.polygonPosition;K3e(t,h,p,{startPosition:u,endPosition:y,coordLength:n})}}function K3e(e,t,r,{startPosition:n,endPosition:o,coordLength:i}){if(!e.triangles)return;let s=n*i,a=o*i,u=e.positions.subarray(s,a),h=r[0],p=r.slice(1).map(y=>(y-h)/i),_=Z6(u,p,i,t);for(let y=0,A=_.length;y<A;++y)e.triangles.push(n+_[y])}function mR(e,t){let r={};for(let n in e)r[n]={value:e[n],size:t};return r}function $3e(e,t,r,n){let o={shape:"binary-feature-collection",points:{...e,positions:{value:e.positions,size:n},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:mR(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:n},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:mR(t.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:n},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:mR(r.numericProps,1)}};return o.polygons&&r.triangles&&(o.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),o}function yR(e,t,r,n){for(let o in e.numericProps)if(o in t){let i=t[o];e.numericProps[o].fill(i,r,r+n)}}function gR(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}function Q3e(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function AT(e,t){let r=t?.globalFeatureId;return r!==void 0?J3e(e,r):eEe(e,t?.type)}function J3e(e,t){let r=tX(e);for(let n of r){let o=0,i=n.featureIds.value[0];for(let s=0;s<n.featureIds.value.length;s++){let a=n.featureIds.value[s];if(a!==i){if(t===n.globalFeatureIds.value[o])return vT(n,o,s);o=s,i=a}}if(t===n.globalFeatureIds.value[o])return vT(n,o,n.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function eEe(e,t){let r=tX(e,t);return tEe(r)}function eX(e,t,r){switch(e.type){case"Point":return oEe(e,t,r);case"LineString":return iEe(e,t,r);case"Polygon":return rX(e,t,r);default:let n=e;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function tX(e,t){let r=[];return e.points&&(e.points.type="Point",r.push(e.points)),e.lines&&(e.lines.type="LineString",r.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",r.push(e.polygons)),r}function tEe(e){let t=[];for(let r of e){if(r.featureIds.value.length===0)continue;let n=0,o=r.featureIds.value[0];for(let i=0;i<r.featureIds.value.length;i++){let s=r.featureIds.value[i];s!==o&&(t.push(vT(r,n,i)),n=i,o=s)}t.push(vT(r,n,r.featureIds.value.length))}return t}function vT(e,t,r){let n=eX(e,t,r),o=nEe(e,t,r),i=rEe(e,t,r);return{type:"Feature",geometry:n,properties:o,...i}}function rEe(e,t=0,r){return e.fields&&e.fields[e.featureIds.value[t]]}function nEe(e,t=0,r){let n=Object.assign({},e.properties[e.featureIds.value[t]]);for(let o in e.numericProps)n[o]=e.numericProps[o].value[t];return n}function rX(e,t=-1/0,r=1/0){let{positions:n}=e,o=e.polygonIndices.value.filter(u=>u>=t&&u<=r),i=e.primitivePolygonIndices.value.filter(u=>u>=t&&u<=r);if(!(o.length>2)){let u=[];for(let h=0;h<i.length-1;h++){let p=i[h],_=i[h+1],y=wT(n,p,_);u.push(y)}return{type:"Polygon",coordinates:u}}let a=[];for(let u=0;u<o.length-1;u++){let h=o[u],p=o[u+1],_=rX(e,h,p).coordinates;a.push(_)}return{type:"MultiPolygon",coordinates:a}}function iEe(e,t=-1/0,r=1/0){let{positions:n}=e,o=e.pathIndices.value.filter(a=>a>=t&&a<=r);if(!(o.length>2))return{type:"LineString",coordinates:wT(n,o[0],o[1])};let s=[];for(let a=0;a<o.length-1;a++){let u=wT(n,o[a],o[a+1]);s.push(u)}return{type:"MultiLineString",coordinates:s}}function oEe(e,t,r){let{positions:n}=e,o=wT(n,t,r);return o.length>1?{type:"MultiPoint",coordinates:o}:{type:"Point",coordinates:o[0]}}function wT(e,t,r){t=t||0,r=r||e.value.length/e.size;let n=[];for(let o=t;o<r;o++){let i=Array();for(let s=o*e.size;s<(o+1)*e.size;s++)i.push(Number(e.value[s]));n.push(i)}return n}var SR=In(cX(),1);function uX(e){let t=e.length;if(t<=1)return[e];let r=[],n,o;for(let i=0;i<t;i++){let s=AEe(e[i]);s!==0&&(o===void 0&&(o=s<0),o===s<0?(n&&r.push(n),n=[e[i]]):n&&n.push(e[i]))}return n&&r.push(n),r}function AEe(e){let t=0;for(let r=0,n=e.length-1,o,i;r<e.length;n=r++)o=e[r],i=e[n],t+=(i[0]-o[0])*(o[1]+i[1]);return t}function fX(e,t,r){t&&r&&(e===1?t.id=r.readVarint():e===2?MEe(r,t):e===3?t.type=r.readVarint():e===4&&(t._geometry=r.pos))}function MEe(e,t){let r=e.readVarint()+e.pos;for(;e.pos<r;){let n=t._keys[e.readVarint()],o=t._values[e.readVarint()];t.properties[n]=o}}var TT=class e{properties;extent;type;id;_pbf;_geometry;_keys;_values;static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(t,r,n,o,i){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=o,this._values=i,t.readFields(fX,this,r)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,n=1,o=0,i=0,s=0,a=[],u;for(;t.pos<r;){if(o<=0){let h=t.readVarint();n=h&7,o=h>>3}if(o--,n===1||n===2)i+=t.readSVarint(),s+=t.readSVarint(),n===1&&(u&&a.push(u),u=[]),u&&u.push([i,s]);else if(n===7)u&&u.push(u[0].slice());else throw new Error(`unknown command ${n}`)}return u&&a.push(u),a}bbox(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,n=1,o=0,i=0,s=0,a=1/0,u=-1/0,h=1/0,p=-1/0;for(;t.pos<r;){if(o<=0){let _=t.readVarint();n=_&7,o=_>>3}if(o--,n===1||n===2)i+=t.readSVarint(),s+=t.readSVarint(),i<a&&(a=i),i>u&&(u=i),s<h&&(h=s),s>p&&(p=s);else if(n!==7)throw new Error(`unknown command ${n}`)}return[a,h,u,p]}_toGeoJSON(t){let r=this.loadGeometry(),n=e.types[this.type],o,i;switch(this.type){case 1:let a=[];for(o=0;o<r.length;o++)a[o]=r[o][0];r=a,t(r,this);break;case 2:for(o=0;o<r.length;o++)t(r[o],this);break;case 3:for(r=uX(r),o=0;o<r.length;o++)for(i=0;i<r[o].length;i++)t(r[o][i],this);break}r.length===1?r=r[0]:n=`Multi${n}`;let s={type:"Feature",geometry:{type:n,coordinates:r},properties:this.properties};return this.id!==null&&(s.id=this.id),s}toGeoJSON(t){if(typeof t=="function")return this._toGeoJSON(t);let{x:r,y:n,z:o}=t,i=this.extent*Math.pow(2,o),s=this.extent*r,a=this.extent*n;function u(h){for(let p=0;p<h.length;p++){let _=h[p];_[0]=(_[0]+s)*360/i-180;let y=180-(_[1]+a)*360/i;_[1]=360/Math.PI*Math.atan(Math.exp(y*Math.PI/180))-90}}return this._toGeoJSON(u)}};var ET=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(SEe,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let r=this._pbf.readVarint()+this._pbf.pos;return new TT(this._pbf,r,this.extent,this._keys,this._values)}};function SEe(e,t,r){t&&r&&(e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(TEe(r)))}function TEe(e){let t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){let n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}var IT=class{layers;constructor(t,r){this.layers=t.readFields(EEe,{},r)}};function EEe(e,t,r){if(e===3&&r){let n=new ET(r,r.readVarint()+r.pos);n.length&&t&&(t[n.name]=n)}}function hX(e){let t=e.indices.length,r="Polygon";if(t<=1)return{type:r,data:e.data,areas:[[Ad(e.data)]],indices:[e.indices]};let n=[],o=[],i=[],s=[],a,u=0;for(let h,p=0,_;p<t;p++){_=e.indices[p]-u,h=e.indices[p+1]-u||e.data.length;let y=e.data.slice(_,h),A=Ad(y);if(A===0){let E=e.data.slice(0,_),k=e.data.slice(h);e.data=E.concat(k),u+=h-_;continue}a===void 0&&(a=A<0),a===A<0?(s.length&&(n.push(i),o.push(s)),s=[_],i=[A]):(i.push(A),s.push(_))}return i&&n.push(i),s.length&&o.push(s),{type:r,areas:n,indices:o,data:e.data}}function dX(e,t,r,n){for(let o=0,i=e.length;o<i;o+=2){e[o]=(e[o]+t)*360/n-180;let s=180-(e[o+1]+r)*360/n;e[o+1]=360/Math.PI*Math.atan(Math.exp(s*Math.PI/180))-90}}function pX(e,t,r){t&&r&&(e===1?t.id=r.readVarint():e===2?IEe(r,t):e===3?t.type=r.readVarint():e===4&&(t._geometry=r.pos))}function IEe(e,t){let r=e.readVarint()+e.pos;for(;e.pos<r;){let n=t._keys[e.readVarint()],o=t._values[e.readVarint()];t.properties[n]=o}}var mX,ng,vR,CT,wR,AR,_1;var kT=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;constructor(t,r,n,o,i,s){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=o,this._values=i,this._geometryInfo=s,t.readFields(pX,this,r)}loadGeometry(){let t=this._pbf;t.pos=this._geometry,mX=t.readVarint()+t.pos,ng=1,CT=0,wR=0,AR=0,_1=0;let r=[],n=[];for(;t.pos<mX;)if(CT<=0&&(vR=t.readVarint(),ng=vR&7,CT=vR>>3),CT--,ng===1||ng===2)wR+=t.readSVarint(),AR+=t.readSVarint(),ng===1&&r.push(_1),n.push(wR,AR),_1+=2;else if(ng===7){if(_1>0){let o=r[r.length-1];n.push(n[o],n[o+1]),_1+=2}}else throw new Error(`unknown command ${ng}`);return{data:n,indices:r}}_toBinaryCoordinates(t){let r=this.loadGeometry(),n;t(r.data,this);let o=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=r.indices.length,n={type:"Point",...r};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=r.indices.length,this._geometryInfo.linePositionsCount+=r.data.length/o,n={type:"LineString",...r};break;case 3:n=hX(r),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=n.indices.length;for(let s of n.indices)this._geometryInfo.polygonRingsCount+=s.length;this._geometryInfo.polygonPositionsCount+=n.data.length/o;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let i={type:"Feature",geometry:n,properties:this.properties};return this.id!==null&&(i.id=this.id),i}toBinaryCoordinates(t){if(typeof t=="function")return this._toBinaryCoordinates(t);let{x:r,y:n,z:o}=t,i=this.extent*Math.pow(2,o),s=this.extent*r,a=this.extent*n;return this._toBinaryCoordinates(u=>dX(u,s,a,i))}};var PT=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(CEe,this,r),this.length=this._features.length}feature(t,r){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let n=this._pbf.readVarint()+this._pbf.pos;return new kT(this._pbf,n,this.extent,this._keys,this._values,r)}};function CEe(e,t,r){t&&r&&(e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(kEe(r)))}function kEe(e){let t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){let n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}var OT=class{layers;constructor(t,r){this.layers=t.readFields(PEe,{},r)}};function PEe(e,t,r){if(e===3&&r){let n=new PT(r,r.readVarint()+r.pos);n.length&&t&&(t[n.name]=n)}}function TR(e,t){let r=REe(t),n=t?.gis?.format||t?.mvt?.shape||t?.shape;switch(n){case"columnar-table":return{shape:"columnar-table",data:MR(e,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:gX(e,r)};case"geojson":return gX(e,r);case"binary-geometry":return MR(e,r);case"binary":return MR(e,r);default:throw new Error(n||"undefined shape")}}function MR(e,t){let[r,n]=OEe(e,t),o=_R(r,n);return o.byteLength=e.byteLength,o}function OEe(e,t){let r=[],n={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(e.byteLength<=0)return[r,n];let o=new OT(new SR.default(e));return(t&&Array.isArray(t.layers)?t.layers:Object.keys(o.layers)).forEach(s=>{let a=o.layers[s];if(a)for(let u=0;u<a.length;u++){let h=a.feature(u,n),p=zEe(h,t,s);r.push(p)}}),[r,n]}function gX(e,t){if(e.byteLength<=0)return[];let r=[],n=new IT(new SR.default(e));return(Array.isArray(t.layers)?t.layers:Object.keys(n.layers)).forEach(i=>{let s=n.layers[i];if(s)for(let a=0;a<s.length;a++){let u=s.feature(a),h=NEe(u,t,i);r.push(h)}}),r}function REe(e){if(!e?.mvt)throw new Error("mvt options required");let t=e.mvt?.coordinates==="wgs84",{tileIndex:r}=e.mvt,n=r&&Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z);if(t&&!n)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return e.mvt}function NEe(e,t,r){let n=e.toGeoJSON(t.coordinates==="wgs84"?t.tileIndex:DEe);return t.layerProperty&&(n.properties[t.layerProperty]=r),n}function zEe(e,t,r){let n=e.toBinaryCoordinates(t.coordinates==="wgs84"?t.tileIndex:LEe);return t.layerProperty&&n.properties&&(n.properties[t.layerProperty]=r),n}function DEe(e,t){let{extent:r}=t;for(let n=0;n<e.length;n++){let o=e[n];o[0]/=r,o[1]/=r}}function LEe(e,t){let{extent:r}=t;for(let n=0,o=e.length;n<o;++n)e[n]/=r}var FEe="4.2.0",RT={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:FEe,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}},BEe={...RT,parse:async(e,t)=>TR(e,t),parseSync:TR,binary:!0};var jEe={Point:_X,MultiPoint:UEe,LineString:yX,MultiLineString:VEe,Polygon:xX,MultiPolygon:WEe};function _X([e,t],[r,n],o){let i=Ma(r[0],n[0],e),s=Ma(r[1],n[1],t);return o.unprojectFlat([i,s])}function ER(e,t,r){return e.map(n=>_X(n,t,r))}function UEe(e,t,r){return ER(e,t,r)}function yX(e,t,r){return ER(e,t,r)}function VEe(e,t,r){return e.map(n=>yX(n,t,r))}function xX(e,t,r){return e.map(n=>ER(n,t,r))}function WEe(e,t,r){return e.map(n=>xX(n,t,r))}function bX(e,t,r){let n=r.projectFlat([t.west,t.north]),o=r.projectFlat([t.east,t.south]),i=[n,o];return{...e,coordinates:jEe[e.type](e.coordinates,i,r)}}var ZEe=["points","lines","polygons"];function IR(e,t,r,n){for(let o of ZEe){let i=e[o]&&YEe(e[o],t,r,n);if(i>=0)return i}return-1}function YEe(e,t,r,n){let o=e.featureIds.value;if(!o.length)return-1;let i=0,s=o[o.length-1]+1;if(n){let u=qEe(e,n);if(u)i=u[0],s=u[1]+1;else return-1}let a=-1;if(t in e.numericProps){let u=e.numericProps[t].value.findIndex((h,p)=>h===r&&o[p]>=i&&o[p]<s);return u>=0?e.globalFeatureIds.value[u]:-1}else t?a=vX(e.properties,u=>u[t]===r,i,s):e.fields&&(a=vX(e.fields,u=>u.id===r,i,s));return a>=0?GEe(e,a):-1}function qEe(e,t){if(!e.__layers){let r={},{properties:n}=e;for(let o=0;o<n.length;o++){let{layerName:i}=n[o];i&&(r[i]?r[i][1]=o:r[i]=[o,o])}e.__layers=r}return e.__layers[t]}function GEe(e,t){if(!e.__ids){let r=[],n=e.featureIds.value,o=e.globalFeatureIds.value;for(let i=0;i<n.length;i++)r[n[i]]=o[i];e.__ids=r}return e.__ids[t]}function vX(e,t,r,n){for(let o=r;o<n;o++)if(t(e[o],o))return o;return-1}var CR=512,HEe={...jf.defaultProps,data:d1,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[RT],binary:!0},j0=class extends Ed{static{this.layerName="MVTLayer"}static{this.defaultProps=HEe}initializeState(){super.initializeState();let t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:t,oldProps:r,context:n,changeFlags:o}){o.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:t,oldProps:r,context:n,changeFlags:o}),this._setWGS84PropertyForTiles());let{highlightColor:i}=t;i!==r.highlightColor&&Array.isArray(i)&&this.setState({highlightColor:i})}async _updateTileData(){let t=this.props.data,r=null;if(typeof t=="string"&&!hR(t)){let{onDataLoad:n,fetch:o}=this.props;this.setState({data:null,tileJSON:null});try{r=await o(t,{propName:"data",layer:this,loaders:[]})}catch(i){this.raiseError(i,"loading TileJSON"),t=null}n&&n(r,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(r=t);r&&(t=r.tiles),this.setState({data:t,tileJSON:r})}_getTilesetOptions(){let t=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:n,maxZoom:o}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>n&&(t.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(o)||r.maxzoom<o)&&(t.maxZoom=r.maxzoom)),t}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(t){let{data:r,binary:n}=this.state,{index:o,signal:i}=t,s=p1(r,t);if(!s)return Promise.reject("Invalid URL");let a=this.getLoadOptions(),{fetch:u}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:o},gis:n?{format:"binary"}:{}},u(s,{propName:"data",layer:this,loadOptions:a,signal:i})}renderSubLayers(t){let{x:r,y:n,z:o}=t.tile.index,i=Math.pow(2,o),s=CR/i,a=-s,u=CR*r/i,h=CR*(1-n/i),p=new Ci().scale([s,a,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=p,t.coordinateOrigin=[u,h,0],t.coordinateSystem=Mn.CARTESIAN,t.extensions=[...t.extensions||[],new L0]);let _=super.renderSubLayers(t);return this.state.binary&&!(_ instanceof jf)&&Vr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),_}_updateAutoHighlight(t){let{uniqueIdProperty:r}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:o}=this.state,i=t.object,s=null,a=null;i&&(s=kR(i,r),a=wX(i));let{highlightColor:u}=this.props;typeof u=="function"&&(u=u(t)),(n!==s||o!==a)&&this.setState({highlightColor:u,hoveredFeatureId:s,hoveredFeatureLayerName:a})}getPickingInfo(t){let r=super.getPickingInfo(t),n=!!this.context.viewport.resolution;if(this.state.binary&&r.index!==-1){let{data:o}=t.sourceLayer.props;r.object=AT(o,{globalFeatureId:r.index})}return r.object&&!n&&(r.object=MX(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){let{hoveredFeatureId:r,hoveredFeatureLayerName:n,binary:o}=this.state,{uniqueIdProperty:i,highlightedFeatureId:s}=this.props,a=t.content,u=AX(s);if(!(AX(r)||u))return-1;let p=u?s:r;return Array.isArray(a)?a.findIndex(_=>{let y=kR(_,i)===p,A=u||wX(_)===n;return y&&A}):a&&o?IR(a,i,p,u?"":n):-1}_pickObjects(t){let{deck:r,viewport:n}=this.context,o=n.width,i=n.height,s=n.x,a=n.y,u=[this.id];return r.pickObjects({x:s,y:a,width:o,height:i,layerIds:u,maxObjects:t})}getRenderedFeatures(t=null){let r=this._pickObjects(t),n=new Set,o=[];for(let i of r){let s=kR(i.object,this.props.uniqueIdProperty);s===void 0?o.push(i.object):n.has(s)||(n.add(s),o.push(i.object))}return o}_setWGS84PropertyForTiles(){let t="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(t)||Object.defineProperty(n,t,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];let{bbox:o}=n;if(n._contentWGS84===void 0&&dR(o)){let i=this.state.binary?AT(n.content):n.content;n._contentWGS84=i.map(s=>MX(s,o,this.context.viewport))}return n._contentWGS84}})})}};function kR(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function wX(e){return e.properties?.layerName||null}function AX(e){return e!=null&&e!==""}function MX(e,t,r){let n={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>bX(e.geometry,t,r).coordinates}),n}var SX="\uFEFF",vu={parse:XEe,unparse:KEe,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:SX,BAD_DELIMITERS:["\r",`
`,'"',SX],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:10485760,RemoteChunkSize:5242880,DefaultDelimiter:",",Parser:PR,ParserHandle:EX,ChunkStreamer:TX,StringStreamer:U0},V0=vu;function XEe(e,t,r){t=t||{};var n=t.dynamicTyping||!1;if(oa(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=oa(t.transform)?t.transform:!1,t.worker&&vu.WORKERS_SUPPORTED){var o=newWorker();o.userStep=t.step,o.userChunk=t.chunk,o.userComplete=t.complete,o.userError=t.error,t.step=oa(t.step),t.chunk=oa(t.chunk),t.complete=oa(t.complete),t.error=oa(t.error),delete t.worker,o.postMessage({input:e,config:t,workerId:o.id});return}var i=null;return typeof e=="string"&&(i=new U0(t)),i||(i=new r(t)),i.stream(e)}function KEe(e,t){var r=!1,n=!0,o=",",i=`\r
`,s='"',a=s+s,u=!1,h=null;_();var p=new RegExp(y1(s),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return A(null,e,u);if(typeof e[0]=="object")return A(h||y(e[0]),e,u)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:y(e.data[0])),!Array.isArray(e.data[0])&&typeof e.data[0]!="object"&&(e.data=[e.data])),A(e.fields||[],e.data||[],u);throw new Error("Unable to serialize unrecognized input");function _(){if(typeof t=="object"){if(typeof t.delimiter=="string"&&!vu.BAD_DELIMITERS.filter(function(P){return t.delimiter.indexOf(P)!==-1}).length&&(o=t.delimiter),(typeof t.quotes=="boolean"||Array.isArray(t.quotes))&&(r=t.quotes),(typeof t.skipEmptyLines=="boolean"||typeof t.skipEmptyLines=="string")&&(u=t.skipEmptyLines),typeof t.newline=="string"&&(i=t.newline),typeof t.quoteChar=="string"&&(s=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");h=t.columns}t.escapeChar!==void 0&&(a=t.escapeChar+s)}}function y(P){if(typeof P!="object")return[];var R=[];for(var V in P)R.push(V);return R}function A(P,R,V){var N="";typeof P=="string"&&(P=JSON.parse(P)),typeof R=="string"&&(R=JSON.parse(R));var j=Array.isArray(P)&&P.length>0,J=!Array.isArray(R[0]);if(j&&n){for(var ne=0;ne<P.length;ne++)ne>0&&(N+=o),N+=E(P[ne],ne);R.length>0&&(N+=i)}for(var de=0;de<R.length;de++){var fe=j?P.length:R[de].length,ye=!1,ve=j?Object.keys(R[de]).length===0:R[de].length===0;if(V&&!j&&(ye=V==="greedy"?R[de].join("").trim()==="":R[de].length===1&&R[de][0].length===0),V==="greedy"&&j){for(var be=[],je=0;je<fe;je++){var Re=J?P[je]:je;be.push(R[de][Re])}ye=be.join("").trim()===""}if(!ye){for(var Se=0;Se<fe;Se++){Se>0&&!ve&&(N+=o);var Ue=j&&J?P[Se]:Se;N+=E(R[de][Ue],Se)}de<R.length-1&&(!V||fe>0&&!ve)&&(N+=i)}}return N}function E(P,R){if(typeof P>"u"||P===null)return"";if(P.constructor===Date)return JSON.stringify(P).slice(1,25);P=P.toString().replace(p,a);var V=typeof r=="boolean"&&r||Array.isArray(r)&&r[R]||k(P,vu.BAD_DELIMITERS)||P.indexOf(o)>-1||P.charAt(0)===" "||P.charAt(P.length-1)===" ";return V?s+P+s:P}function k(P,R){for(var V=0;V<R.length;V++)if(P.indexOf(R[V])>-1)return!0;return!1}}function TX(e){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},t.call(this,e),this.parseChunk=function(r,n){if(this.isFirstChunk&&oa(this._config.beforeFirstChunk)){var o=this._config.beforeFirstChunk(r);o!==void 0&&(r=o)}this.isFirstChunk=!1;var i=this._partialLine+r;this._partialLine="";var s=this._handle.parse(i,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var a=s.meta.cursor;this._finished||(this._partialLine=i.substring(a-this._baseIndex),this._baseIndex=a),s&&s.data&&(this._rowCount+=s.data.length);var u=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(oa(this._config.chunk)&&!n){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return;s=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),!this._completed&&u&&oa(this._config.complete)&&(!s||!s.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!u&&(!s||!s.meta.paused)&&this._nextChunk(),s}},this._sendError=function(r){oa(this._config.error)&&this._config.error(r)};function t(r){var n=OR(r);n.chunkSize=parseInt(n.chunkSize),!r.step&&!r.chunk&&(n.chunkSize=null),this._handle=new EX(n),this._handle.streamer=this,this._config=n}}function U0(e){e=e||{},TX.call(this,e);var t;this.stream=function(r){return t=r,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var r=this._config.chunkSize,n=r?t.substr(0,r):t;return t=r?t.substr(r):"",this._finished=!t,this.parseChunk(n)}}}U0.prototype=Object.create(U0.prototype);U0.prototype.constructor=U0;function EX(e){var t=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,r=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,n=this,o=0,i=0,s,a,u=!1,h=!1,p,_=[],y={data:[],errors:[],meta:{}};if(oa(e.step)){var A=e.step;e.step=function(fe){if(y=fe,P())k();else{if(k(),!y.data||y.data.length===0)return;o+=fe.data.length,e.preview&&o>e.preview?a.abort():A(y,n)}}}this.parse=function(fe,ye,ve){var be=e.quoteChar||'"';if(e.newline||(e.newline=ne(fe,be)),p=!1,e.delimiter)oa(e.delimiter)&&(e.delimiter=e.delimiter(fe),y.meta.delimiter=e.delimiter);else{var je=J(fe,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);je.successful?e.delimiter=je.bestDelimiter:(p=!0,e.delimiter=vu.DefaultDelimiter),y.meta.delimiter=e.delimiter}var Re=OR(e);return e.preview&&e.header&&Re.preview++,s=fe,a=new PR(Re),y=a.parse(s,ye,ve),k(),u?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return u},this.pause=function(){u=!0,a.abort(),s=s.substr(a.getCharIndex())},this.resume=function(){u=!1,n.streamer.parseChunk(s,!0)},this.aborted=function(){return h},this.abort=function(){h=!0,a.abort(),y.meta.aborted=!0,oa(e.complete)&&e.complete(y),s=""};function E(fe){return e.skipEmptyLines==="greedy"?fe.join("").trim()==="":fe.length===1&&fe[0].length===0}function k(){if(y&&p&&(de("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+vu.DefaultDelimiter+"'"),p=!1),e.skipEmptyLines)for(var fe=0;fe<y.data.length;fe++)E(y.data[fe])&&y.data.splice(fe--,1);return P()&&R(),j()}function P(){return e.header&&_.length===0}function R(){if(!y)return;function fe(ve){oa(e.transformHeader)&&(ve=e.transformHeader(ve)),_.push(ve)}if(Array.isArray(y.data[0])){for(var ye=0;P()&&ye<y.data.length;ye++)y.data[ye].forEach(fe);y.data.splice(0,1)}else y.data.forEach(fe)}function V(fe){return e.dynamicTypingFunction&&e.dynamicTyping[fe]===void 0&&(e.dynamicTyping[fe]=e.dynamicTypingFunction(fe)),(e.dynamicTyping[fe]||e.dynamicTyping)===!0}function N(fe,ye){return V(fe)?ye==="true"||ye==="TRUE"?!0:ye==="false"||ye==="FALSE"?!1:t.test(ye)?parseFloat(ye):r.test(ye)?new Date(ye):ye===""?null:ye:ye}function j(){if(!y||!y.data||!e.header&&!e.dynamicTyping&&!e.transform)return y;function fe(ve,be){var je=e.header?{}:[],Re;for(Re=0;Re<ve.length;Re++){var Se=Re,Ue=ve[Re];e.header&&(Se=Re>=_.length?"__parsed_extra":_[Re]),e.transform&&(Ue=e.transform(Ue,Se)),Ue=N(Se,Ue),Se==="__parsed_extra"?(je[Se]=je[Se]||[],je[Se].push(Ue)):je[Se]=Ue}return e.header&&(Re>_.length?de("FieldMismatch","TooManyFields","Too many fields: expected "+_.length+" fields but parsed "+Re,i+be):Re<_.length&&de("FieldMismatch","TooFewFields","Too few fields: expected "+_.length+" fields but parsed "+Re,i+be)),je}var ye=1;return!y.data[0]||Array.isArray(y.data[0])?(y.data=y.data.map(fe),ye=y.data.length):y.data=fe(y.data,0),e.header&&y.meta&&(y.meta.fields=_),i+=ye,y}function J(fe,ye,ve,be,je){var Re,Se,Ue;je=je||[",","	","|",";",vu.RECORD_SEP,vu.UNIT_SEP];for(var qe=0;qe<je.length;qe++){var Je=je[qe],gt=0,rt=0,At=0;Ue=void 0;for(var St=new PR({comments:be,delimiter:Je,newline:ye,preview:10}).parse(fe),kt=0;kt<St.data.length;kt++){if(ve&&E(St.data[kt])){At++;continue}var yt=St.data[kt].length;if(rt+=yt,typeof Ue>"u"){Ue=0;continue}else yt>1&&(gt+=Math.abs(yt-Ue),Ue=yt)}St.data.length>0&&(rt/=St.data.length-At),(typeof Se>"u"||gt>Se)&&rt>1.99&&(Se=gt,Re=Je)}return e.delimiter=Re,{successful:!!Re,bestDelimiter:Re}}function ne(fe,ye){fe=fe.substr(0,1024*1024);var ve=new RegExp(y1(ye)+"([^]*?)"+y1(ye),"gm");fe=fe.replace(ve,"");var be=fe.split("\r"),je=fe.split(`
`),Re=je.length>1&&je[0].length<be[0].length;if(be.length===1||Re)return`
`;for(var Se=0,Ue=0;Ue<be.length;Ue++)be[Ue][0]===`
`&&Se++;return Se>=be.length/2?`\r
`:"\r"}function de(fe,ye,ve,be){y.errors.push({type:fe,code:ye,message:ve,row:be})}}function y1(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function PR(e){e=e||{};var t=e.delimiter,r=e.newline,n=e.comments,o=e.step,i=e.preview,s=e.fastMode,a;e.quoteChar===void 0?a='"':a=e.quoteChar;var u=a;if(e.escapeChar!==void 0&&(u=e.escapeChar),(typeof t!="string"||vu.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||vu.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),r!==`
`&&r!=="\r"&&r!==`\r
`&&(r=`
`);var h=0,p=!1;this.parse=function(_,y,A){if(typeof _!="string")throw new Error("Input must be a string");var E=_.length,k=t.length,P=r.length,R=n.length,V=oa(o);h=0;var N=[],j=[],J=[],ne=0;if(!_)return St();if(s||s!==!1&&_.indexOf(a)===-1){for(var de=_.split(r),fe=0;fe<de.length;fe++){if(J=de[fe],h+=J.length,fe!==de.length-1)h+=r.length;else if(A)return St();if(!(n&&J.substr(0,R)===n)){if(V){if(N=[],Je(J.split(t)),kt(),p)return St()}else Je(J.split(t));if(i&&fe>=i)return N=N.slice(0,i),St(!0)}}return St()}for(var ye=_.indexOf(t,h),ve=_.indexOf(r,h),be=new RegExp(y1(u)+y1(a),"g"),je;;){if(_[h]===a){for(je=h,h++;;){if(je=_.indexOf(a,je+1),je===-1)return A||j.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:N.length,index:h}),rt();if(je===E-1){var Re=_.substring(h,je).replace(be,a);return rt(Re)}if(a===u&&_[je+1]===u){je++;continue}if(!(a!==u&&je!==0&&_[je-1]===u)){var Se=ve===-1?ye:Math.min(ye,ve),Ue=gt(Se);if(_[je+1+Ue]===t){if(J.push(_.substring(h,je).replace(be,a)),h=je+1+Ue+k,ye=_.indexOf(t,h),ve=_.indexOf(r,h),V&&(kt(),p))return St();if(i&&N.length>=i)return St(!0);break}var qe=gt(ve);if(_.substr(je+1+qe,P)===r){if(J.push(_.substring(h,je).replace(be,a)),At(je+1+qe+P),ye=_.indexOf(t,h),V&&(kt(),p))return St();if(i&&N.length>=i)return St(!0);break}j.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:N.length,index:h}),je++}}if(V&&(kt(),p))return St();if(i&&N.length>=i)return St(!0);continue}if(n&&J.length===0&&_.substr(h,R)===n){if(ve===-1)return St();h=ve+P,ve=_.indexOf(r,h),ye=_.indexOf(t,h);continue}if(ye!==-1&&(ye<ve||ve===-1)){J.push(_.substring(h,ye)),h=ye+k,ye=_.indexOf(t,h);continue}if(ve!==-1){if(J.push(_.substring(h,ve)),At(ve+P),V&&(kt(),p))return St();if(i&&N.length>=i)return St(!0);continue}break}return rt();function Je(yt){N.push(yt),ne=h}function gt(yt){var tr=0;if(yt!==-1){var vr=_.substring(je+1,yt);vr&&vr.trim()===""&&(tr=vr.length)}return tr}function rt(yt){return A||(typeof yt>"u"&&(yt=_.substr(h)),J.push(yt),h=E,Je(J),V&&kt()),St()}function At(yt){h=yt,Je(J),J=[],ve=_.indexOf(r,h)}function St(yt,tr){var vr=tr||!1;return{data:vr?N[0]:N,errors:j,meta:{delimiter:t,linebreak:r,aborted:p,truncated:!!yt,cursor:ne+(y||0)}}}function kt(){o(St(void 0,!0)),N=[],j=[]}},this.abort=function(){p=!0},this.getCharIndex=function(){return h}}function OR(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=OR(e[r]);return t}function oa(e){return typeof e=="function"}var{ChunkStreamer:IX}=V0;function W0(e){e=e||{},IX.call(this,e),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(t){this._input=t;try{for await(let r of t)this.parseChunk(this.getStringChunk(r));this._finished=!0,this.parseChunk("")}catch(r){this._sendError(r)}},this._nextChunk=function(){},this.getStringChunk=function(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}W0.prototype=Object.create(IX.prototype);W0.prototype.constructor=W0;var $Ee="4.2.0",RR="object-row-table",x1={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:$Ee,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(e,t)=>CX(new TextDecoder().decode(e),t),parseText:(e,t)=>CX(e,t),parseInBatches:QEe,options:{csv:{shape:RR,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function CX(e,t){let r={...x1.options.csv,...t?.csv},n=JEe(e),i=r.header==="auto"?kX(n):!!r.header,s={...r,header:i,download:!1,transformHeader:i?PX():void 0,error:_=>{throw new Error(_)}},a=V0.parse(e,s),u=a.data,h=a.meta.fields||OX(r.columnPrefix,n.length),p=r.shape||RR;switch(p){case"object-row-table":return{shape:"object-row-table",data:u.map(_=>Array.isArray(_)?lb(_,h):_)};case"array-row-table":return{shape:"array-row-table",data:u.map(_=>Array.isArray(_)?_:cb(_,h))};default:throw new Error(p)}}function QEe(e,t){t={...t},t.batchSize==="auto"&&(t.batchSize=4e3);let r={...x1.options.csv,...t?.csv},n=new H_,o=!0,i=null,s=null,a=null,u={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(h){let p=h.data;if(r.skipEmptyLines&&p.flat().join("").trim()==="")return;let _=h.meta.cursor;if(o&&!i&&(r.header==="auto"?kX(p):!!r.header)){i=p.map(PX());return}o&&(o=!1,i||(i=OX(r.columnPrefix,p.length)),a=eIe(p,i)),r.optimizeMemoryUsage&&(p=JSON.parse(JSON.stringify(p)));let y=r.shape||RR;s=s||new ub(a,{shape:y,...t});try{s.addRow(p);let A=s&&s.getFullBatch({bytesUsed:_});A&&n.enqueue(A)}catch(A){n.enqueue(A)}},complete(h){try{let p=h.meta.cursor,_=s&&s.getFinalBatch({bytesUsed:p});_&&n.enqueue(_)}catch(p){n.enqueue(p)}n.close()}};return V0.parse(e,u,W0),n}function kX(e){return e&&e.every(t=>typeof t=="string")}function JEe(e){return V0.parse(e,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function PX(){let e=new Set;return t=>{let r=t,n=1;for(;e.has(r);)r=`${t}.${n}`,n++;return e.add(r),r}}function OX(e,t=0){let r=[];for(let n=0;n<t;n++)r.push(`${e}${n+1}`);return r}function eIe(e,t){let r=t?{}:[];for(let n=0;n<e.length;n++){let o=t&&t[n]||n;switch(typeof e[n]){case"number":case"boolean":r[o]={name:String(o),index:n,type:Float32Array};break;case"string":default:r[o]={name:String(o),index:n,type:Array}}}return r}var JB=In(QX());Qn();var W8={};io(W8,{legend:()=>fk,swatches:()=>qOe});function ZOe(e,{title:t,tickSize:r=6,width:n=320,height:o=44+r,marginTop:i=18,marginRight:s=0,marginBottom:a=16+r,marginLeft:u=0,ticks:h=n/64,tickFormat:p,tickValues:_}={}){function y(P,R=256){let V=document.createElement("canvas");V.width=R,V.height=1;let N=V.getContext("2d");for(let j=0;j<R;++j)N.fillStyle=P(j/(R-1)),N.fillRect(j,0,1,1);return V}let A=d3.create("svg").attr("width",n).attr("height",o).attr("viewBox",[0,0,n,o]).style("overflow","visible").style("display","block"),E=P=>P.selectAll(".tick line").attr("y1",i+a-o),k;if(e.interpolate){let P=Math.min(e.domain().length,e.range().length);k=e.copy().rangeRound(d3.quantize(d3.interpolate(u,n-s),P)),A.append("image").attr("x",u).attr("y",i).attr("width",n-u-s).attr("height",o-i-a).attr("preserveAspectRatio","none").attr("xlink:href",y(e.copy().domain(d3.quantize(d3.interpolate(0,1),P))).toDataURL())}else if(e.interpolator){if(k=Object.assign(e.copy().interpolator(d3.interpolateRound(u,n-s)),{range(){return[u,n-s]}}),A.append("image").attr("x",u).attr("y",i).attr("width",n-u-s).attr("height",o-i-a).attr("preserveAspectRatio","none").attr("xlink:href",y(e.interpolator()).toDataURL()),!k.ticks){if(_===void 0){let P=Math.round(h+1);_=d3.range(P).map(R=>d3.quantile(e.domain(),R/(P-1)))}typeof p!="function"&&(p=d3.format(p===void 0?",f":p))}}else if(e.invertExtent){let P=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain(),R=p===void 0?V=>V:typeof p=="string"?d3.format(p):p;k=d3.scaleLinear().domain([-1,e.range().length-1]).rangeRound([u,n-s]),A.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(V,N)=>k(N-1)).attr("y",i).attr("width",(V,N)=>k(N)-k(N-1)).attr("height",o-i-a).attr("fill",V=>V),_=d3.range(P.length),p=V=>R(P[V],V)}else k=d3.scaleBand().domain(e.domain()).rangeRound([u,n-s]),A.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",k).attr("y",i).attr("width",Math.max(0,k.bandwidth()-1)).attr("height",o-i-a).attr("fill",e),E=()=>{};return A.append("g").attr("transform",`translate(0,${o-a})`).call(d3.axisBottom(k).ticks(h,typeof p=="string"?p:void 0).tickFormat(typeof p=="function"?p:void 0).tickSize(r).tickValues(_)).call(E).call(P=>P.select(".domain").remove()).call(P=>P.append("text").attr("x",u).attr("y",i+a-o-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(t)),A.node()}function fk({color:e,...t}){return ZOe(e,t)}function YOe(e,{columns:t=null,format:r,unknown:n,swatchSize:o=15,swatchWidth:i=o,swatchHeight:s=o,marginLeft:a=0}={}){let u=`-swatches-${Math.random().toString(16).slice(2)}`,h=n==null?void 0:e.unknown(),p=h==null||h===d3.scaleImplicit?[]:[h],_=e.domain().concat(p);r===void 0&&(r=A=>A===h?n:A);function y(A){return`&#${A.charCodeAt(0).toString()};`}return t!==null?htl.html`<div style="display: flex; align-items: center; margin-left: ${+a}px; min-height: 33px; font: 10px sans-serif;">
  <style>

.${u}-item {
  break-inside: avoid;
  display: flex;
  align-items: center;
  padding-bottom: 1px;
}

.${u}-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: calc(100% - ${+i}px - 0.5em);
}

.${u}-swatch {
  width: ${+i}px;
  height: ${+s}px;
  margin: 0 0.5em 0 0;
}

  </style>
  <div style=${{width:"100%",columns:t}}>${_.map(A=>{let E=`${r(A)}`;return htl.html`<div class=${u}-item>
      <div class=${u}-swatch style=${{background:e(A)}}></div>
      <div class=${u}-label title=${E}>${E}</div>
    </div>`})}
  </div>
</div>`:htl.html`<div style="display: flex; align-items: center; min-height: 33px; margin-left: ${+a}px; font: 10px sans-serif;">
  <style>

.${u} {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}

.${u}::before {
  content: "";
  width: ${+i}px;
  height: ${+s}px;
  margin-right: 0.5em;
  background: var(--color);
}

  </style>
  <div>${_.map(A=>htl.html`<span class="${u}" style="--color: ${e(A)}">${r(A)}</span>`)}</div>`}function qOe({color:e,...t}){return YOe(e,t)}var E4="";window.location.hostname=="localhost"?E4="https://api.maptiler.com/maps/toner-v2/style.json?key=Y4leWPnhJFGnTFFk1cru":window.location.hostname=="o.blanthorn.com"?E4="https://api.maptiler.com/maps/toner-v2/style.json?key=L7Sd3jHa1AR1dtyLCTgq":E4="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json";var GB={x:.45,y:51.47,z:4,...Object.fromEntries(new URLSearchParams(window.location.hash.slice(1)))},TA=new JB.default.Map({container:"map",style:E4,center:[GB.x,GB.y],zoom:GB.z,minZoom:5.5,bearing:0,pitch:0}),HB=mh(x2).domain([0,1]);function ZFe(e){e.sort((r,n)=>r-n);let t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}var YFe=e=>Object.values(Vo(HB(e))).slice(0,-1),Qge=e=>new j0({id:"IrisLayer",minZoom:6,maxZoom:9,data:"data/shapefiles/CONTOURS-IRIS_2-1_SHP_LAMB93_FXX-2020/tiles/{z}/{x}/{y}.pbf",extruded:!1,stroked:!0,getFillColor:t=>{let n=t.properties.CODE_IRIS.split(",").map(i=>e.get(i)),o=ZFe(n);return o==null?[255,255,255,0]:YFe(o)},pickable:!0});function qFe({object:e}){if(!e)return;let t=o=>`<div>${o[0]}: ${typeof o[1]=="number"?parseFloat(o[1].toPrecision(3)):o[1]}</div>`,r=Uc().get("expression")??"percent_zero_voitures";return{html:XB?Object.entries({...e.properties,[r]:e_e?.get(e.properties.CODE_IRIS),[r+"_quantile"]:jp?.get(e.properties.CODE_IRIS)}).map(t).join(" "):Object.entries({...e.properties,[r]:jp?.get(e.properties.CODE_IRIS)}).map(t).join(" "),style:{backgroundColor:"#fff",fontFamily:"sans-serif",fontSize:"0.8em",padding:"0.5em"}}}var C4=new E0({interleaved:!1,onClick:(e,t)=>{e.layer&&console.log(e.object)},getTooltip:qFe});TA.addControl(C4);TA.addControl(new JB.default.NavigationControl);var Jge=new Ed({id:"OpenRailwayMapLayer",data:"https://tiles.openrailwaymap.org/maxspeed/{z}/{x}/{y}.png",maxZoom:19,minZoom:0,renderSubLayers:e=>{let{boundingBox:t}=e.tile;return new I0(e,{data:null,image:e.data,bounds:[t[0][0],t[0][1],t[1][0],t[1][1]]})},pickable:!1}),jp=new Map,e_e=new Map;window.csvmap=jp;var Uc=()=>new URLSearchParams(window.location.search);window.d3=zi;window.observablehq=W8;var XB=Uc().get("quantiles")!=null;async function t_e(){let e=await Promise.resolve().then(()=>(Qce(),$ce));await wue().then(()=>vue),await Promise.resolve().then(()=>(Que(),lNe)),await Promise.resolve().then(()=>(Kge(),WFe));let t=document.createElement("perspective-viewer");document.getElementById("settings").appendChild(t),window.viewer=t,e.worker().then(async r=>{window.w=r;let o=await(await fetch("data/base-ic-logement-2020.arrow")).arrayBuffer(),i=await w.table(o);window.table=i,t.load(i),KB(),t.addEventListener("perspective-config-update",s=>{if(s?.detail?.expressions?.chloropleth!=$ge){let a=new URL(window.location);a.searchParams.set("expression",s?.detail?.expressions?.chloropleth),history.replaceState({},"",a.toString()),$ge=s?.detail?.expressions?.chloropleth,KB()}})})}async function KB(){C4.setProps({layers:[]});let e=(await r_e())?.chloropleth??Uc().get("expression")??'1 - ("P20_RP_VOIT1P" / "P20_RP")',t=await table.view({columns:["IRIS","value"],expressions:{value:e}}),r=await t.to_columns();t.delete();let n=XB?"quantile":"value";if(XB){let[i,s]=GFe(r.value),a=r.value.map(i);QB(s),jp=new Map(I4(r.IRIS,a)),e_e=new Map(I4(r.IRIS,r.value))}else QB(),jp=new Map(I4(r.IRIS,r.value));let o=[Qge(jp)];Uc().get("trains")!==null&&o.push(Jge),C4.setProps({layers:o})}window.perspectiveUpdate=KB;var $ge=null,$B=document.getElementById("attribution");$B.innerText="\xA9 "+["INSEE","MapTiler","OpenStreetMap contributors",Uc().get("trains")!==null?"OpenRailwayMap":null].filter(e=>e!==null).join(" \xA9 ");var Bp=document.createElement("div");Bp.id="observable_legend";$B.insertBefore(Bp,$B.firstChild);if(Uc().get("expression")===null){let e=(await su("data/iris_data.csv",x1,{csv:{header:!0,dynamicTyping:!1}})).data;jp=new Map(e.map(r=>[r.IRIS,r.perc_voit]));let t=[Qge(jp)];Uc().get("trains")!==null&&t.push(Jge),C4.setProps({layers:t}),QB()}else t_e();function*I4(e,t){if(e.length!=t.length)throw new Error("unequal lengths");for(let r=0;r<e.length;r++)yield[e[r],t[r]]}window.lazyZip=I4;async function QB(e){if(e!==void 0){let t=fk({color:HB,title:Uc().get("t")??Uc().get("expression")??"Fraction of principal residences with zero cars",tickFormat:r=>parseFloat(e(r).toPrecision(3))});Bp.innerHTML="",Bp.insertBefore(t,Bp.firstChild)}else{let t=fk({color:HB,title:Uc().get("t")??Uc().get("expression")??"Fraction of principal residences with zero cars"});Bp.innerHTML="",Bp.insertBefore(t,Bp.firstChild)}}TA.on("moveend",()=>{let e=TA.getCenter(),t=TA.getZoom();window.location.hash=`x=${e.lng.toFixed(2)}&y=${e.lat.toFixed(2)}&z=${t.toFixed(2)}`});function GFe(e){let t=Array.from({length:Math.min(8192,e.length)},()=>Math.floor(Math.random()*e.length)).map(o=>e[o]).sort((o,i)=>o-i).filter(o=>o!=null),r=t.map((o,i)=>i+1).map(o=>o/t.length);function n(o){return o=Math.min(Math.max(.01,o),.99),t[r.findIndex(s=>s>=o)]??t[0]}return[o=>r[t.findIndex(i=>i>o)]??1,n]}async function r_e(){return(await viewer.save())?.expressions}document.getElementById("loadviewer").addEventListener("click",()=>{t_e(),document.getElementById("loadviewer").remove()});window.grabExpressions=r_e;
/*! Bundled license information:

hammerjs/hammer.js:
  (*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

chroma-js/chroma.js:
  (**
   * @license
   *
   * chroma.js - JavaScript library for color conversions
   * 
   * Copyright (c) 2011-2017, Gregor Aisch
   * All rights reserved.
   * 
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   * 
   * 1. Redistributions of source code must retain the above copyright notice, this
   *    list of conditions and the following disclaimer.
   * 
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   *    this list of conditions and the following disclaimer in the documentation
   *    and/or other materials provided with the distribution.
   * 
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   *    derived from this software without specific prior written permission.
   * 
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   *)
  (**
  	ColorBrewer colors for chroma.js
  
  	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
  	Pennsylvania State University.
  
  	Licensed under the Apache License, Version 2.0 (the "License"); 
  	you may not use this file except in compliance with the License.
  	You may obtain a copy of the License at	
  	http://www.apache.org/licenses/LICENSE-2.0
  
  	Unless required by applicable law or agreed to in writing, software distributed
  	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
  	CONDITIONS OF ANY KIND, either express or implied. See the License for the
  	specific language governing permissions and limitations under the License.
  
      @preserve
   *)

@loaders.gl/csv/dist/papaparse/papaparse.js:
  (* @license
  Papa Parse
  v5.0.0-beta.0
  https://github.com/mholt/PapaParse
  License: MIT
  *)
*/
